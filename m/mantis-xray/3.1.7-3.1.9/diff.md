# Comparing `tmp/mantis-xray-3.1.7.tar.gz` & `tmp/mantis-xray-3.1.9.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "mantis-xray-3.1.7.tar", last modified: Sun Apr  3 19:56:33 2022, max compression
+gzip compressed data, was "mantis-xray-3.1.9.tar", last modified: Thu Feb 23 14:46:15 2023, max compression
```

## Comparing `mantis-xray-3.1.7.tar` & `mantis-xray-3.1.9.tar`

### file list

```diff
@@ -1,71 +1,71 @@
-drwxrwxr-x   0 watts     (1000) watts     (1000)        0 2022-04-03 19:56:33.179124 mantis-xray-3.1.7/
--rw-rw-r--   0 watts     (1000) watts     (1000)    32474 2021-03-10 16:55:24.000000 mantis-xray-3.1.7/LICENSE
--rw-rw-r--   0 watts     (1000) watts     (1000)      220 2022-01-10 10:33:26.000000 mantis-xray-3.1.7/MANIFEST.in
--rw-rw-r--   0 watts     (1000) watts     (1000)     2478 2022-04-03 19:56:33.179124 mantis-xray-3.1.7/PKG-INFO
--rw-rw-r--   0 watts     (1000) watts     (1000)     1773 2022-01-10 12:49:03.000000 mantis-xray-3.1.7/README.md
-drwxrwxr-x   0 watts     (1000) watts     (1000)        0 2022-04-03 19:56:33.171123 mantis-xray-3.1.7/mantis_xray/
--rw-rw-r--   0 watts     (1000) watts     (1000)      434 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/Mantis_batch_settings.txt
--rw-rw-r--   0 watts     (1000) watts     (1000)   176994 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/Mrc.py
-drwxrwxr-x   0 watts     (1000) watts     (1000)        0 2022-04-03 19:56:33.171123 mantis-xray-3.1.7/mantis_xray/TomoCS/
--rw-rw-r--   0 watts     (1000) watts     (1000)        1 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/TomoCS/__init__.py
--rw-rw-r--   0 watts     (1000) watts     (1000)     2063 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/TomoCS/_rank_order.py
--rw-rw-r--   0 watts     (1000) watts     (1000)    19464 2021-03-12 11:58:24.000000 mantis-xray-3.1.7/mantis_xray/TomoCS/forward_backward_tv.py
--rw-rw-r--   0 watts     (1000) watts     (1000)    13541 2021-03-12 11:59:20.000000 mantis-xray-3.1.7/mantis_xray/TomoCS/projections.py
--rw-rw-r--   0 watts     (1000) watts     (1000)    10052 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/TomoCS/sirt.py
--rw-rw-r--   0 watts     (1000) watts     (1000)     6119 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/TomoCS/tv_denoising.py
--rw-rw-r--   0 watts     (1000) watts     (1000)     2984 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/TomoCS/util.py
--rw-rw-r--   0 watts     (1000) watts     (1000)       23 2022-04-03 19:27:46.000000 mantis-xray-3.1.7/mantis_xray/__init__.py
--rw-rw-r--   0 watts     (1000) watts     (1000)      785 2022-01-08 12:24:45.000000 mantis-xray-3.1.7/mantis_xray/__main__.py
--rwxrwxr-x   0 watts     (1000) watts     (1000)    96520 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/analyze.py
--rwxrwxr-x   0 watts     (1000) watts     (1000)    35041 2022-01-07 14:38:05.000000 mantis-xray-3.1.7/mantis_xray/data_stack.py
--rwxrwxr-x   0 watts     (1000) watts     (1000)     6861 2022-01-06 13:06:40.000000 mantis-xray-3.1.7/mantis_xray/data_struct.py
--rw-rw-r--   0 watts     (1000) watts     (1000)     2034 2022-01-06 13:06:40.000000 mantis-xray-3.1.7/mantis_xray/dialogalign.ui
-drwxrwxr-x   0 watts     (1000) watts     (1000)        0 2022-04-03 19:56:33.175123 mantis-xray-3.1.7/mantis_xray/file_plugins/
--rw-rw-r--   0 watts     (1000) watts     (1000)     8772 2021-03-12 11:52:38.000000 mantis-xray-3.1.7/mantis_xray/file_plugins/__init__.py
--rw-rw-r--   0 watts     (1000) watts     (1000)     6452 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/file_plugins/file_bim.py
--rw-rw-r--   0 watts     (1000) watts     (1000)     2734 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/file_plugins/file_csv.py
--rwxrwxr-x   0 watts     (1000) watts     (1000)    87045 2022-01-06 13:06:40.000000 mantis-xray-3.1.7/mantis_xray/file_plugins/file_dataexch_hdf5.py
--rw-rw-r--   0 watts     (1000) watts     (1000)    10269 2022-01-06 13:06:40.000000 mantis-xray-3.1.7/mantis_xray/file_plugins/file_json.py
--rw-rw-r--   0 watts     (1000) watts     (1000)    21338 2022-01-06 13:06:40.000000 mantis-xray-3.1.7/mantis_xray/file_plugins/file_ncb.py
--rwxrwxr-x   0 watts     (1000) watts     (1000)     6671 2022-04-03 19:27:46.000000 mantis-xray-3.1.7/mantis_xray/file_plugins/file_nexus_hdf5.py
--rw-rw-r--   0 watts     (1000) watts     (1000)    13605 2022-01-06 13:06:40.000000 mantis-xray-3.1.7/mantis_xray/file_plugins/file_sdf.py
--rw-rw-r--   0 watts     (1000) watts     (1000)     9498 2021-03-12 12:37:10.000000 mantis-xray-3.1.7/mantis_xray/file_plugins/file_sm_netcdf.py
--rw-rw-r--   0 watts     (1000) watts     (1000)     6904 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/file_plugins/file_stk.py
--rw-rw-r--   0 watts     (1000) watts     (1000)     3785 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/file_plugins/file_tif.py
--rw-rw-r--   0 watts     (1000) watts     (1000)   134489 2021-03-12 12:38:12.000000 mantis-xray-3.1.7/mantis_xray/file_plugins/file_xrm.py
--rw-rw-r--   0 watts     (1000) watts     (1000)     1286 2022-01-07 20:52:07.000000 mantis-xray-3.1.7/mantis_xray/helpers.py
--rw-rw-r--   0 watts     (1000) watts     (1000)    28313 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/henke.py
--rw-rw-r--   0 watts     (1000) watts     (1000)   389888 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/henke.xdr
-drwxrwxr-x   0 watts     (1000) watts     (1000)        0 2022-04-03 19:56:33.179124 mantis-xray-3.1.7/mantis_xray/images/
--rw-rw-r--   0 watts     (1000) watts     (1000)   119382 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/images/Mantis_logo.icns
--rw-rw-r--   0 watts     (1000) watts     (1000)   211585 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/images/Mantis_logo.ico
--rw-rw-r--   0 watts     (1000) watts     (1000)   124228 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/images/Mantis_logo_about.png
--rw-rw-r--   0 watts     (1000) watts     (1000)    57364 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/images/document-open.png
--rw-rw-r--   0 watts     (1000) watts     (1000)   121111 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/images/help-browser.png
--rw-rw-r--   0 watts     (1000) watts     (1000)     2238 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/images/logo-2l-32.ico
--rw-rw-r--   0 watts     (1000) watts     (1000)    33765 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/images/media-floppy.png
--rw-rw-r--   0 watts     (1000) watts     (1000)      346 2022-01-06 13:06:40.000000 mantis-xray-3.1.7/mantis_xray/images/mirror.png
--rw-rw-r--   0 watts     (1000) watts     (1000)      207 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/images/open-sl.png
--rw-rw-r--   0 watts     (1000) watts     (1000)      398 2022-01-06 13:06:40.000000 mantis-xray-3.1.7/mantis_xray/images/rotate.png
--rwxrwxr-x   0 watts     (1000) watts     (1000)   480376 2021-02-25 14:32:32.000000 mantis-xray-3.1.7/mantis_xray/logos.py
--rw-rw-r--   0 watts     (1000) watts     (1000)    27045 2022-01-08 12:27:10.000000 mantis-xray-3.1.7/mantis_xray/mantis.py
--rw-rw-r--   0 watts     (1000) watts     (1000)   632157 2022-04-03 19:27:46.000000 mantis-xray-3.1.7/mantis_xray/mantis_qt.py
--rw-rw-r--   0 watts     (1000) watts     (1000)     8427 2021-03-12 11:55:04.000000 mantis-xray-3.1.7/mantis_xray/nnma.py
--rwxrwxr-x   0 watts     (1000) watts     (1000)    28086 2022-01-06 13:06:40.000000 mantis-xray-3.1.7/mantis_xray/pageloaddata.ui
--rwxrwxr-x   0 watts     (1000) watts     (1000)    61292 2022-01-06 13:06:40.000000 mantis-xray-3.1.7/mantis_xray/pagemap.ui
--rw-rw-r--   0 watts     (1000) watts     (1000)    20733 2022-01-06 13:06:40.000000 mantis-xray-3.1.7/mantis_xray/showalign2.ui
--rwxrwxr-x   0 watts     (1000) watts     (1000)    14578 2022-01-06 13:06:40.000000 mantis-xray-3.1.7/mantis_xray/showartefacts.ui
--rwxrwxr-x   0 watts     (1000) watts     (1000)     6394 2022-01-06 13:06:40.000000 mantis-xray-3.1.7/mantis_xray/showhistogram.ui
--rw-rw-r--   0 watts     (1000) watts     (1000)    21866 2022-01-06 13:06:40.000000 mantis-xray-3.1.7/mantis_xray/showmulticrop.ui
--rw-rw-r--   0 watts     (1000) watts     (1000)     3795 2022-01-06 13:06:40.000000 mantis-xray-3.1.7/mantis_xray/showspectralroi.ui
--rw-rw-r--   0 watts     (1000) watts     (1000)      352 2022-01-06 13:06:40.000000 mantis-xray-3.1.7/mantis_xray/stylesheet_global.qss
--rw-rw-r--   0 watts     (1000) watts     (1000)    18709 2021-03-12 11:56:54.000000 mantis-xray-3.1.7/mantis_xray/tomo_reconstruction.py
-drwxrwxr-x   0 watts     (1000) watts     (1000)        0 2022-04-03 19:56:33.171123 mantis-xray-3.1.7/mantis_xray.egg-info/
--rw-rw-r--   0 watts     (1000) watts     (1000)     2478 2022-04-03 19:56:32.000000 mantis-xray-3.1.7/mantis_xray.egg-info/PKG-INFO
--rw-rw-r--   0 watts     (1000) watts     (1000)     1920 2022-04-03 19:56:33.000000 mantis-xray-3.1.7/mantis_xray.egg-info/SOURCES.txt
--rw-rw-r--   0 watts     (1000) watts     (1000)        1 2022-04-03 19:56:32.000000 mantis-xray-3.1.7/mantis_xray.egg-info/dependency_links.txt
--rw-rw-r--   0 watts     (1000) watts     (1000)       55 2022-04-03 19:56:32.000000 mantis-xray-3.1.7/mantis_xray.egg-info/entry_points.txt
--rw-rw-r--   0 watts     (1000) watts     (1000)       94 2022-04-03 19:56:33.000000 mantis-xray-3.1.7/mantis_xray.egg-info/requires.txt
--rw-rw-r--   0 watts     (1000) watts     (1000)       12 2022-04-03 19:56:33.000000 mantis-xray-3.1.7/mantis_xray.egg-info/top_level.txt
--rw-rw-r--   0 watts     (1000) watts     (1000)       38 2022-04-03 19:56:33.179124 mantis-xray-3.1.7/setup.cfg
--rw-rw-r--   0 watts     (1000) watts     (1000)     1265 2022-01-10 10:36:19.000000 mantis-xray-3.1.7/setup.py
+drwxrwxr-x   0 watts     (1000) watts     (1000)        0 2023-02-23 14:46:15.333140 mantis-xray-3.1.9/
+-rw-r--r--   0 watts     (1000) watts     (1000)    32474 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/LICENSE
+-rw-r--r--   0 watts     (1000) watts     (1000)      220 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/MANIFEST.in
+-rw-rw-r--   0 watts     (1000) watts     (1000)     2441 2023-02-23 14:46:15.333140 mantis-xray-3.1.9/PKG-INFO
+-rw-r--r--   0 watts     (1000) watts     (1000)     1773 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/README.md
+drwxrwxr-x   0 watts     (1000) watts     (1000)        0 2023-02-23 14:46:15.329140 mantis-xray-3.1.9/mantis_xray/
+-rw-r--r--   0 watts     (1000) watts     (1000)      434 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/Mantis_batch_settings.txt
+-rw-r--r--   0 watts     (1000) watts     (1000)   176994 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/Mrc.py
+drwxrwxr-x   0 watts     (1000) watts     (1000)        0 2023-02-23 14:46:15.329140 mantis-xray-3.1.9/mantis_xray/TomoCS/
+-rw-r--r--   0 watts     (1000) watts     (1000)        1 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/TomoCS/__init__.py
+-rw-r--r--   0 watts     (1000) watts     (1000)     2063 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/TomoCS/_rank_order.py
+-rw-r--r--   0 watts     (1000) watts     (1000)    19464 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/TomoCS/forward_backward_tv.py
+-rw-rw-r--   0 watts     (1000) watts     (1000)    13529 2023-02-23 11:02:33.000000 mantis-xray-3.1.9/mantis_xray/TomoCS/projections.py
+-rw-r--r--   0 watts     (1000) watts     (1000)    10052 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/TomoCS/sirt.py
+-rw-rw-r--   0 watts     (1000) watts     (1000)     6113 2023-02-23 11:02:33.000000 mantis-xray-3.1.9/mantis_xray/TomoCS/tv_denoising.py
+-rw-rw-r--   0 watts     (1000) watts     (1000)     2981 2023-02-23 11:02:33.000000 mantis-xray-3.1.9/mantis_xray/TomoCS/util.py
+-rw-rw-r--   0 watts     (1000) watts     (1000)       23 2023-02-23 11:02:33.000000 mantis-xray-3.1.9/mantis_xray/__init__.py
+-rw-r--r--   0 watts     (1000) watts     (1000)      785 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/__main__.py
+-rwxr-xr-x   0 watts     (1000) watts     (1000)    96520 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/analyze.py
+-rwxrwxr-x   0 watts     (1000) watts     (1000)    35402 2023-02-23 11:02:33.000000 mantis-xray-3.1.9/mantis_xray/data_stack.py
+-rwxr-xr-x   0 watts     (1000) watts     (1000)     6861 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/data_struct.py
+-rw-r--r--   0 watts     (1000) watts     (1000)     2034 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/dialogalign.ui
+drwxrwxr-x   0 watts     (1000) watts     (1000)        0 2023-02-23 14:46:15.333140 mantis-xray-3.1.9/mantis_xray/file_plugins/
+-rw-r--r--   0 watts     (1000) watts     (1000)     8772 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/file_plugins/__init__.py
+-rw-rw-r--   0 watts     (1000) watts     (1000)     6434 2023-02-23 11:02:33.000000 mantis-xray-3.1.9/mantis_xray/file_plugins/file_bim.py
+-rw-r--r--   0 watts     (1000) watts     (1000)     2734 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/file_plugins/file_csv.py
+-rwxr-xr-x   0 watts     (1000) watts     (1000)    87045 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/file_plugins/file_dataexch_hdf5.py
+-rw-r--r--   0 watts     (1000) watts     (1000)    10269 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/file_plugins/file_json.py
+-rw-rw-r--   0 watts     (1000) watts     (1000)    21296 2023-02-23 11:02:33.000000 mantis-xray-3.1.9/mantis_xray/file_plugins/file_ncb.py
+-rwxr-xr-x   0 watts     (1000) watts     (1000)     6671 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/file_plugins/file_nexus_hdf5.py
+-rw-r--r--   0 watts     (1000) watts     (1000)    13605 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/file_plugins/file_sdf.py
+-rw-r--r--   0 watts     (1000) watts     (1000)     9498 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/file_plugins/file_sm_netcdf.py
+-rw-r--r--   0 watts     (1000) watts     (1000)     6904 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/file_plugins/file_stk.py
+-rw-rw-r--   0 watts     (1000) watts     (1000)     3779 2023-02-23 11:02:33.000000 mantis-xray-3.1.9/mantis_xray/file_plugins/file_tif.py
+-rw-rw-r--   0 watts     (1000) watts     (1000)   134471 2023-02-23 11:02:33.000000 mantis-xray-3.1.9/mantis_xray/file_plugins/file_xrm.py
+-rw-r--r--   0 watts     (1000) watts     (1000)     1286 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/helpers.py
+-rw-r--r--   0 watts     (1000) watts     (1000)    28313 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/henke.py
+-rw-r--r--   0 watts     (1000) watts     (1000)   389888 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/henke.xdr
+drwxrwxr-x   0 watts     (1000) watts     (1000)        0 2023-02-23 14:46:15.333140 mantis-xray-3.1.9/mantis_xray/images/
+-rw-r--r--   0 watts     (1000) watts     (1000)   119382 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/images/Mantis_logo.icns
+-rw-r--r--   0 watts     (1000) watts     (1000)   211585 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/images/Mantis_logo.ico
+-rw-r--r--   0 watts     (1000) watts     (1000)   124228 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/images/Mantis_logo_about.png
+-rw-r--r--   0 watts     (1000) watts     (1000)    57364 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/images/document-open.png
+-rw-r--r--   0 watts     (1000) watts     (1000)   121111 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/images/help-browser.png
+-rw-r--r--   0 watts     (1000) watts     (1000)     2238 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/images/logo-2l-32.ico
+-rw-r--r--   0 watts     (1000) watts     (1000)    33765 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/images/media-floppy.png
+-rw-r--r--   0 watts     (1000) watts     (1000)      346 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/images/mirror.png
+-rw-r--r--   0 watts     (1000) watts     (1000)      207 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/images/open-sl.png
+-rw-r--r--   0 watts     (1000) watts     (1000)      398 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/images/rotate.png
+-rwxr-xr-x   0 watts     (1000) watts     (1000)   480376 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/logos.py
+-rw-r--r--   0 watts     (1000) watts     (1000)    27045 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/mantis.py
+-rw-rw-r--   0 watts     (1000) watts     (1000)   632396 2023-02-23 11:02:33.000000 mantis-xray-3.1.9/mantis_xray/mantis_qt.py
+-rw-r--r--   0 watts     (1000) watts     (1000)     8427 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/nnma.py
+-rwxr-xr-x   0 watts     (1000) watts     (1000)    28086 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/pageloaddata.ui
+-rwxr-xr-x   0 watts     (1000) watts     (1000)    61292 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/pagemap.ui
+-rw-r--r--   0 watts     (1000) watts     (1000)    20733 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/showalign2.ui
+-rwxr-xr-x   0 watts     (1000) watts     (1000)    14578 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/showartefacts.ui
+-rwxr-xr-x   0 watts     (1000) watts     (1000)     6394 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/showhistogram.ui
+-rw-r--r--   0 watts     (1000) watts     (1000)    21866 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/showmulticrop.ui
+-rw-r--r--   0 watts     (1000) watts     (1000)     3795 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/showspectralroi.ui
+-rw-r--r--   0 watts     (1000) watts     (1000)      352 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/stylesheet_global.qss
+-rw-r--r--   0 watts     (1000) watts     (1000)    18709 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/mantis_xray/tomo_reconstruction.py
+drwxrwxr-x   0 watts     (1000) watts     (1000)        0 2023-02-23 14:46:15.329140 mantis-xray-3.1.9/mantis_xray.egg-info/
+-rw-rw-r--   0 watts     (1000) watts     (1000)     2441 2023-02-23 14:46:15.000000 mantis-xray-3.1.9/mantis_xray.egg-info/PKG-INFO
+-rw-rw-r--   0 watts     (1000) watts     (1000)     1920 2023-02-23 14:46:15.000000 mantis-xray-3.1.9/mantis_xray.egg-info/SOURCES.txt
+-rw-rw-r--   0 watts     (1000) watts     (1000)        1 2023-02-23 14:46:15.000000 mantis-xray-3.1.9/mantis_xray.egg-info/dependency_links.txt
+-rw-rw-r--   0 watts     (1000) watts     (1000)       55 2023-02-23 14:46:15.000000 mantis-xray-3.1.9/mantis_xray.egg-info/entry_points.txt
+-rw-rw-r--   0 watts     (1000) watts     (1000)       94 2023-02-23 14:46:15.000000 mantis-xray-3.1.9/mantis_xray.egg-info/requires.txt
+-rw-rw-r--   0 watts     (1000) watts     (1000)       12 2023-02-23 14:46:15.000000 mantis-xray-3.1.9/mantis_xray.egg-info/top_level.txt
+-rw-rw-r--   0 watts     (1000) watts     (1000)       38 2023-02-23 14:46:15.333140 mantis-xray-3.1.9/setup.cfg
+-rw-r--r--   0 watts     (1000) watts     (1000)     1265 2022-11-08 14:29:59.000000 mantis-xray-3.1.9/setup.py
```

### Comparing `mantis-xray-3.1.7/LICENSE` & `mantis-xray-3.1.9/LICENSE`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/PKG-INFO` & `mantis-xray-3.1.9/PKG-INFO`

 * *Files 6% similar despite different names*

```diff
@@ -1,18 +1,16 @@
 Metadata-Version: 2.1
 Name: mantis-xray
-Version: 3.1.7
+Version: 3.1.9
 Summary: MANTiS is a Multivariate ANalysis Tool for x-ray Spectromicroscopy
 Home-page: https://spectromicroscopy.com/
 Author: Mirna Lerotic
 Author-email: mirna@2ndlookconsulting.com
-License: UNKNOWN
 Project-URL: Code, https://github.com/mlerotic/spectromicroscopy
 Project-URL: Documentation, https://docs.spectromicroscopy.com
-Platform: UNKNOWN
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: GNU General Public License v3 or later (GPLv3+)
 Classifier: Operating System :: OS Independent
 Classifier: Topic :: Scientific/Engineering
 Requires-Python: >=3
 Description-Content-Type: text/markdown
 Provides-Extra: netCDF
@@ -44,9 +42,7 @@
 Mantis User Guide can be found on the project Wiki pages [Home](https://github.com/mlerotic/spectromicroscopy/wiki).
 
 ## References ##
 
 Please use the following reference when quoting Mantis
 
 Lerotic M, Mak R, Wirick S, Meirer F, Jacobsen C. MANTiS: a program for the analysis of X-ray spectromicroscopy data. J. Synchrotron Rad. 2014 Sep; 21(5); 1206â€“1212 [http://dx.doi.org/10.1107/S1600577514013964]
-
-
```

### Comparing `mantis-xray-3.1.7/README.md` & `mantis-xray-3.1.9/README.md`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/Mrc.py` & `mantis-xray-3.1.9/mantis_xray/Mrc.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/TomoCS/_rank_order.py` & `mantis-xray-3.1.9/mantis_xray/TomoCS/_rank_order.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/TomoCS/forward_backward_tv.py` & `mantis-xray-3.1.9/mantis_xray/TomoCS/forward_backward_tv.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/TomoCS/projections.py` & `mantis-xray-3.1.9/mantis_xray/TomoCS/projections.py`

 * *Files 1% similar despite different names*

```diff
@@ -170,15 +170,15 @@
     Compute linear interpolation weights for projection array `x`
     and regularly spaced detector pixels separated by `dx` and
     starting at `orig`.
     """
     if ravel:
         x = np.ravel(x)
     floor_x = np.floor((x - orig) / dx).astype(np.int32)
-    alpha = ((x - orig - floor_x * dx) / dx).astype(np.float32)
+    alpha = ((x - orig - floor_x * dx) / dx).astype(float32)
     inds = np.hstack((floor_x, floor_x + 1))
     weights = np.hstack((1 - alpha, alpha))
     data_inds = np.arange(x.size, dtype=np.int32)
     data_inds = np.hstack((data_inds, data_inds))
     if labels is not None:
         data_inds = np.hstack((labels, labels))
         order = np.argsort(inds)
@@ -208,15 +208,15 @@
     Compute linear interpolation weights for projection array `x`
     and regularly spaced detector pixels separated by `dx` and
     starting at `orig`.
     """
     if ravel:
         x = np.ravel(x)
     floor_x = np.floor((x - orig) / dx).astype(np.int32)
-    alpha = ((x - orig - floor_x * dx) / dx).astype(np.float32)
+    alpha = ((x - orig - floor_x * dx) / dx).astype(float32)
     inds = np.hstack((floor_x, floor_x + 1))
     weights = np.hstack((1 - alpha, alpha))
     data_inds = np.arange(x.size, dtype=np.int32)
     data_inds = np.hstack((data_inds, data_inds))
     if labels is not None:
         data_inds = np.hstack((labels, labels))
         w = np.histogram2d(data_inds, inds,
@@ -229,15 +229,15 @@
 def _weights_nn(x, dx=1, orig=0, ravel=True):
     """
     Nearest-neighbour interpolation
     """
     if ravel:
         x = np.ravel(x)
     floor_x = np.floor(x - orig)
-    return floor_x.astype(np.float32)
+    return floor_x.astype(float32)
 
 
 
 def _generate_center_coordinates(l_x):
     """
     Compute the coordinates of pixels centers for an image of
     linear size l_x
@@ -273,15 +273,15 @@
 
     Notes
     -----
     A linear interpolation is used when rotating the back-projection.
     This function uses ``scipy.ndimage.rotate`` for the rotation.
     """
     n_dir, l_x = projections.shape
-    recons = np.zeros((l_x, l_x), dtype=np.float)
+    recons = np.zeros((l_x, l_x), dtype=float)
     angles = np.linspace(0, 180, n_dir, endpoint=False)
     for angle, line in zip(angles, projections):
         # BP: repeat the detector line along the direction of the beam
         tmp = np.tile(line[:, np.newaxis], (1, l_x))
         # Rotate the back-projection of the detector line, and add
         # it to the reconstructed image
         recons += ndimage.rotate(tmp, -angle, order=1, \
```

### Comparing `mantis-xray-3.1.7/mantis_xray/TomoCS/sirt.py` & `mantis-xray-3.1.9/mantis_xray/TomoCS/sirt.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/TomoCS/tv_denoising.py` & `mantis-xray-3.1.9/mantis_xray/TomoCS/tv_denoising.py`

 * *Files 2% similar despite different names*

```diff
@@ -139,15 +139,15 @@
     This function implements the FISTA (Fast Iterative Shrinkage
     Thresholding Algorithm) algorithm of Beck et Teboulle, adapted to
     total variation denoising in "Fast gradient-based algorithms for
     constrained total variation image denoising and deblurring problems"
     (2009).
     """
     if not im.dtype.kind == 'f':
-        im = im.astype(np.float)
+        im = im.astype(float)
     shape = [im.ndim, ] + list(im.shape)
     grad_im = np.zeros(shape)
     grad_aux = np.zeros(shape)
     t = 1.
     i = 0
     while i < n_iter_max:
         error = weight * div(grad_aux) - im
@@ -170,15 +170,15 @@
     return new
 
 
 if __name__ == '__main__':
     from scipy.misc import face
     import matplotlib.pyplot as plt
     from time import time
-    l = face().astype(np.float)
+    l = face().astype(float)
     # normalize image between 0 and 1
     l /= l.max()
     l += 0.1 * l.std() * np.random.randn(*l.shape)
     t0 = time()
     res = tv_denoise_fista(l, weight=0.05, eps=5.e-5)
     t1 = time()
     print(t1 - t0)
```

### Comparing `mantis-xray-3.1.7/mantis_xray/TomoCS/util.py` & `mantis-xray-3.1.9/mantis_xray/TomoCS/util.py`

 * *Files 0% similar despite different names*

```diff
@@ -66,15 +66,15 @@
     mask = ndimage.gaussian_filter(mask, sigma=l_x / (4. * np.sqrt(n_pts)))
     # Limit the non-zero data to a central circle
     if crop:
         mask_outer = (x - l_x / 2) ** 2 + (y - l_x / 2) ** 2 < (l_x / 2) ** 2
         mask = np.logical_and(mask > mask.mean(), mask_outer)
     else:
         mask = mask > mask.mean()
-    return mask.astype(np.float32)
+    return mask.astype(float32)
 
 def tv_l0_norm(im):
     """Compute the (isotropic) TV norm of an image"""
     grad_x1 = np.diff(im, axis=0)
     grad_x2 = np.diff(im, axis=1)
     return (grad_x1[:, :-1]**2 + grad_x2[:-1, :]**2 > 0).mean()
```

### Comparing `mantis-xray-3.1.7/mantis_xray/__main__.py` & `mantis-xray-3.1.9/mantis_xray/__main__.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/analyze.py` & `mantis-xray-3.1.9/mantis_xray/analyze.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/data_stack.py` & `mantis-xray-3.1.9/mantis_xray/data_stack.py`

 * *Files 0% similar despite different names*

```diff
@@ -207,16 +207,16 @@
 
         self.n_cols = imgstack.shape[0]
         self.n_rows = imgstack.shape[1]
         self.n_ev = imgstack.shape[2]
 
         pixelsize = 1
         # Since we do not have a scanning microscope we fill the x_dist and y_dist from pixel_size
-        self.x_dist = np.arange(np.float(self.n_cols)) * pixelsize
-        self.y_dist = np.arange(np.float(self.n_rows)) * pixelsize
+        self.x_dist = np.arange(float(self.n_cols)) * pixelsize
+        self.y_dist = np.arange(float(self.n_rows)) * pixelsize
 
         self.ev = np.array(elist)
 
         msec = np.ones((self.n_ev))
 
         self.data_dwell = msec
 
@@ -289,15 +289,15 @@
             self.data_struct.spectromicroscopy.optical_density = self.od
         else:
             self.data_struct.spectromicroscopy.optical_density = self.od4D
 
     # ----------------------------------------------------------------------
     def calc_histogram(self):
         # calculate average flux for each pixel
-        self.averageflux = np.mean(self.absdata, axis=2)
+        self.averageflux = np.nanmean(self.absdata, axis=2)
         self.histogram = self.averageflux
 
         return
 
     # ----------------------------------------------------------------------
     def i0_from_histogram(self, i0_indices):
 
@@ -309,18 +309,23 @@
 
         self.i0_dwell = self.data_dwell
 
         if self.stack4D is None:
             self.i0datahist = np.zeros((self.n_ev))
             self.i0data = self.i0datahist
             if np.any(i0_indices):
-                invnumel = 1. / self.averageflux[i0_indices].shape[0]
+                #invnumel = 1. / self.averageflux[i0_indices].shape[0]
                 for ie in range(self.n_ev):
                     thiseng_abs = self.absdata[:, :, ie]
-                    self.i0datahist[ie] = np.sum(thiseng_abs[i0_indices]) * invnumel
+                    #self.i0datahist[ie] = np.sum(thiseng_abs[i0_indices]) * invnumel
+                    finite_vals = thiseng_abs[i0_indices][np.isfinite(thiseng_abs[i0_indices])]
+                    if len(finite_vals)>0:
+                        self.i0datahist[ie] = np.nanmean(finite_vals)
+                    else:
+                        self.i0datahist[ie] = self.i0datahist[ie-1] #If this fails on the first image then the data is probably completely empty anyway
 
             self.calculate_optical_density()
 
         else:
             self.i0datahist = np.zeros((self.n_ev, self.n_theta))
             self.i0data = self.i0datahist
             self.od4D = np.zeros((self.n_cols, self.n_rows, self.n_ev, self.n_theta))
@@ -811,16 +816,16 @@
         ypts = fr[xpts, yc]
         xf, fit = self.peak_fit(xpts, ypts)
 
         xpts = [yc - 1, yc, yc + 1]
         ypts = fr[xc, xpts]
         yf, fit = self.peak_fit(xpts, ypts)
 
-        xshift = xf - np.float(shape[0]) / 2.0
-        yshift = yf - np.float(shape[1]) / 2.0
+        xshift = xf - float(shape[0]) / 2.0
+        yshift = yf - float(shape[1]) / 2.0
 
         return xshift, yshift, fr
 
     # ----------------------------------------------------------------------
     # Apply image registration
     def apply_image_registration(self, image, xshift, yshift):
 
@@ -865,46 +870,46 @@
     # ----------------------------------------------------------------------
     # Quadratic peak fit: Fits the 3 data pairs to y=a+bx+cx^2, returning fit=[a,b,c]'
     #  and xpeak at position of inflection'
     def peak_fit(self, x, y):
 
         y1y0 = y[1] - y[0]
         y2y0 = y[2] - y[0]
-        x1x0 = np.float(x[1] - x[0])
-        x2x0 = np.float(x[2] - x[0])
-        x1x0sq = np.float(x[1] * x[1] - x[0] * x[0])
-        x2x0sq = np.float(x[2] * x[2] - x[0] * x[0])
+        x1x0 = float(x[1] - x[0])
+        x2x0 = float(x[2] - x[0])
+        x1x0sq = float(x[1] * x[1] - x[0] * x[0])
+        x2x0sq = float(x[2] * x[2] - x[0] * x[0])
 
         c_num = y2y0 * x1x0 - y1y0 * x2x0
         c_denom = x2x0sq * x1x0 - x1x0sq * x2x0
 
         if c_denom == 0:
             print('Divide by zero error')
             return
 
-        c = c_num / np.float(c_denom)
+        c = c_num / float(c_denom)
         if x1x0 == 0:
             print('Divide by zero error')
             return
 
-        b = (y1y0 - c * x1x0sq) / np.float(x1x0)
+        b = (y1y0 - c * x1x0sq) / float(x1x0)
         a = y[0] - b * x[0] - c * x[0] * x[0]
 
         fit = [a, b, c]
         if c == 0:
             xpeak = 0.
             print('Cannot find xpeak')
             return
         else:
             # Constrain the fit to be within these three points.
             xpeak = -b / (2.0 * c)
             if xpeak < x[0]:
-                xpeak = np.float(x[0])
+                xpeak = float(x[0])
             if xpeak > x[2]:
-                xpeak = np.float(x[2])
+                xpeak = float(x[2])
 
         return xpeak, fit
 
     # -----------------------------------------------------------------------------
     # Despike image using Enhanced Lee Filter
     def despike(self, image, leefilt_percent=50.0):
```

### Comparing `mantis-xray-3.1.7/mantis_xray/data_struct.py` & `mantis-xray-3.1.9/mantis_xray/data_struct.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/dialogalign.ui` & `mantis-xray-3.1.9/mantis_xray/dialogalign.ui`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/file_plugins/__init__.py` & `mantis-xray-3.1.9/mantis_xray/file_plugins/__init__.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/file_plugins/file_bim.py` & `mantis-xray-3.1.9/mantis_xray/file_plugins/file_bim.py`

 * *Files 7% similar despite different names*

```diff
@@ -37,16 +37,16 @@
     self.n_rows = data[5]
     self.n_ev = 1
      
 
     angles = np.fromfile(f, np.float64, 1)
     pixelsize = np.fromfile(f, np.float32, 1)
     
-    self.x_dist = np.arange(np.float(self.n_cols))*pixelsize
-    self.y_dist = np.arange(np.float(self.n_rows))*pixelsize
+    self.x_dist = np.arange(float(self.n_cols))*pixelsize
+    self.y_dist = np.arange(float(self.n_rows))*pixelsize
     
     data = np.fromfile(f, np.uint32, 2)
     
     hbin = data[0]
     vbin = data[1]
     
     energy = np.fromfile(f, np.float64, 1)
@@ -124,16 +124,16 @@
     absdata = np.zeros((ncols, nrows, nev))
     ev = np.zeros((nev))
     
     
     angles = np.fromfile(f, np.float64, 1)
     pixelsize = np.fromfile(f, np.float32, 1)
     
-    x_dist = np.arange(np.float(ncols))*pixelsize
-    y_dist = np.arange(np.float(nrows))*pixelsize
+    x_dist = np.arange(float(ncols))*pixelsize
+    y_dist = np.arange(float(nrows))*pixelsize
     
     data = np.fromfile(f, np.uint32, 2)
     
     hbin = data[0]
     vbin = data[1]
     
     energy = np.fromfile(f, np.float64, 1)
@@ -209,16 +209,16 @@
     ds.exchange.data_axes='x:y'
     
     ds.exchange.energy=ev
     ds.exchange.energy_units = 'ev'
     
     
     #Since we do not have a scanning microscope we fill the x_dist and y_dist from pixel_size
-    x_dist = np.arange(np.float(ncols))*pixelsize
-    y_dist = np.arange(np.float(nrows))*pixelsize
+    x_dist = np.arange(float(ncols))*pixelsize
+    y_dist = np.arange(float(nrows))*pixelsize
 
     ds.exchange.x = x_dist
     ds.exchange.x_units = 'um'
     ds.exchange.y = y_dist
     ds.exchange.y_units = 'um'
```

### Comparing `mantis-xray-3.1.7/mantis_xray/file_plugins/file_csv.py` & `mantis-xray-3.1.9/mantis_xray/file_plugins/file_csv.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/file_plugins/file_dataexch_hdf5.py` & `mantis-xray-3.1.9/mantis_xray/file_plugins/file_dataexch_hdf5.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/file_plugins/file_json.py` & `mantis-xray-3.1.9/mantis_xray/file_plugins/file_json.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/file_plugins/file_ncb.py` & `mantis-xray-3.1.9/mantis_xray/file_plugins/file_ncb.py`

 * *Files 1% similar despite different names*

```diff
@@ -92,29 +92,29 @@
             self.data_dwell[i] = float(temp[2])
     except:
         self.data_dwell = np.ones((self.n_ev))
 
     f.close()
 
     if scale < 0:
-        dataformat = np.float32
+        dataformat = float32
     else:
         dataformat = np.int16
 
     # print 'data format', dataformat
 
     f = open(str(filename), 'rb')
     big_array = np.fromfile(f, dataformat, self.n_cols * self.n_rows * self.n_ev)
     f.close()
 
     if scale > 0 and scale != 1:
-        image_stack = big_array.astype(np.float) / scale
+        image_stack = big_array.astype(float) / scale
         print("data rescaled by ", 1. / scale)
     else:
-        image_stack = big_array.astype(np.float)
+        image_stack = big_array.astype(float)
 
     if (x_start > x_stop):
         image_stack = image_stack[::-1, :, :]
         t = x_start
         x_start = x_stop
         x_stop = t
         print('x data reversed')
@@ -225,27 +225,27 @@
             self.data_dwell[i] = float(temp[2])
     except:
         self.data_dwell = np.ones((self.n_theta))
 
     f.close()
 
     if scale < 0:
-        dataformat = np.float32
+        dataformat = float32
     else:
         dataformat = np.int16
 
     f = open(str(filename), 'rb')
     big_array = np.fromfile(f, dataformat, self.n_cols * self.n_rows * self.n_theta)
     f.close()
 
     if scale > 0 and scale != 1:
-        image_stack = big_array.astype(np.float) / scale
+        image_stack = big_array.astype(float) / scale
         if verbose: print("data rescaled by ", 1. / scale)
     else:
-        image_stack = big_array.astype(np.float)
+        image_stack = big_array.astype(float)
 
     if (x_start > x_stop):
         image_stack = image_stack[::-1, :, :]
         t = x_start
         x_start = x_stop
         x_stop = t
         if verbose: print('x data reversed')
@@ -352,15 +352,15 @@
     f = open(str(filename), 'wb')
     if scale != 1.0:
         print('Scaling the data by ', scale)
         saveddata = image_stack * scale
         saveddata.astype(np.int16).tofile(f)
     else:
         scale = -1.0
-        image_stack.astype(np.float32).tofile(f)
+        image_stack.astype(float32).tofile(f)
     f.close()
 
     # print 'imagedims', image_stack.shape
 
     f = open(str(dat_fn), 'w')
 
     print('\t%d\t%d\t%.6f' % (stack.n_rows, stack.n_cols, scale), file=f)
@@ -455,29 +455,29 @@
                 self.data_dwell[i] = float(temp[2])
         except:
             self.data_dwell = np.ones((self.n_ev))
 
         f.close()
 
         if scale < 0:
-            dataformat = np.float32
+            dataformat = float32
         else:
             dataformat = np.int16
 
         # print 'data format', dataformat
 
         f = open(str(filename), 'rb')
         big_array = np.fromfile(f, dataformat, self.n_cols * self.n_rows * self.n_ev)
         f.close()
 
         if scale > 0 and scale != 1:
-            image_stack = big_array.astype(np.float) / scale
+            image_stack = big_array.astype(float) / scale
             print("data rescaled by ", 1. / scale)
         else:
-            image_stack = big_array.astype(np.float)
+            image_stack = big_array.astype(float)
 
         if (x_start > x_stop):
             image_stack = image_stack[::-1, :, :]
             t = x_start
             x_start = x_stop
             x_stop = t
             print('x data reversed')
@@ -528,15 +528,15 @@
         f = open(str(filename), 'wb')
         if scale != 1.0:
             print('Scaling the data by ', scale)
             saveddata = image_stack * scale
             saveddata.astype(np.int16).tofile(f)
         else:
             scale = -1.0
-            image_stack.astype(np.float32).tofile(f)
+            image_stack.astype(float32).tofile(f)
         f.close()
 
         # print 'imagedims', image_stack.shape
 
         f = open(str(dat_fn), 'w')
 
         print('\t%d\t%d\t%.6f' % (self.n_rows, self.n_cols, scale), file=f)
@@ -620,29 +620,29 @@
                 self.data_dwell[i] = float(temp[2])
         except:
             self.data_dwell = np.ones((self.n_theta))
 
         f.close()
 
         if scale < 0:
-            dataformat = np.float32
+            dataformat = float32
         else:
             dataformat = np.int16
 
         # print 'data format', dataformat
 
         f = open(str(filename), 'rb')
         big_array = np.fromfile(f, dataformat, self.n_cols * self.n_rows * self.n_theta)
         f.close()
 
         if scale > 0 and scale != 1:
-            image_stack = big_array.astype(np.float) / scale
+            image_stack = big_array.astype(float) / scale
             if verbose: print("data rescaled by ", 1. / scale)
         else:
-            image_stack = big_array.astype(np.float)
+            image_stack = big_array.astype(float)
 
         if (x_start > x_stop):
             image_stack = image_stack[::-1, :, :]
             t = x_start
             x_start = x_stop
             x_stop = t
             if verbose: print('x data reversed')
```

### Comparing `mantis-xray-3.1.7/mantis_xray/file_plugins/file_nexus_hdf5.py` & `mantis-xray-3.1.9/mantis_xray/file_plugins/file_nexus_hdf5.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/file_plugins/file_sdf.py` & `mantis-xray-3.1.9/mantis_xray/file_plugins/file_sdf.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/file_plugins/file_sm_netcdf.py` & `mantis-xray-3.1.9/mantis_xray/file_plugins/file_sm_netcdf.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/file_plugins/file_stk.py` & `mantis-xray-3.1.9/mantis_xray/file_plugins/file_stk.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/file_plugins/file_tif.py` & `mantis-xray-3.1.9/mantis_xray/file_plugins/file_tif.py`

 * *Files 1% similar despite different names*

```diff
@@ -63,16 +63,16 @@
     self.n_rows = imgstack.shape[1]
     self.n_ev = imgstack.shape[2]
 
     print('File {0} dims: [{1},{2},{3}]'.format(filename, self.n_cols, self.n_rows, self.n_ev))
 
     pixelsize = 1
     #Since we do not have a scanning microscope we fill the x_dist and y_dist from pixel_size
-    self.x_dist = np.arange(np.float(self.n_cols))*pixelsize
-    self.y_dist = np.arange(np.float(self.n_rows))*pixelsize
+    self.x_dist = np.arange(float(self.n_cols))*pixelsize
+    self.y_dist = np.arange(float(self.n_rows))*pixelsize
 
     #Read energies from file
     basename, extension = os.path.splitext(filename)
     engfilename = basename+'.txt'
     f = open(str(engfilename),'r')
 
     elist = []
```

### Comparing `mantis-xray-3.1.7/mantis_xray/file_plugins/file_xrm.py` & `mantis-xray-3.1.9/mantis_xray/file_plugins/file_xrm.py`

 * *Files 0% similar despite different names*

```diff
@@ -354,16 +354,16 @@
     ds.exchange.data_axes='x:y'
     
     ds.exchange.energy=ev
     ds.exchange.energy_units = 'ev'
     
     
     #Since we do not have a scanning microscope we fill the x_dist and y_dist from pixel_size
-    x_dist = np.arange(np.float(ncols))*pixelsize
-    y_dist = np.arange(np.float(nrows))*pixelsize
+    x_dist = np.arange(float(ncols))*pixelsize
+    y_dist = np.arange(float(nrows))*pixelsize
 
     ds.exchange.x = x_dist
     ds.exchange.x_units = 'um'
     ds.exchange.y = y_dist
     ds.exchange.y_units = 'um'     
     
     
@@ -550,16 +550,16 @@
     ds.exchange.energy=self.ev
     ds.exchange.energy_units = 'ev'
     
     ds.exchange.angles = angles
     
     
     #Since we do not have a scanning microscope we fill the x_dist and y_dist from pixel_size
-    self.x_dist = np.arange(np.float(self.n_cols))*pixelsize
-    self.y_dist = np.arange(np.float(self.n_rows))*pixelsize
+    self.x_dist = np.arange(float(self.n_cols))*pixelsize
+    self.y_dist = np.arange(float(self.n_rows))*pixelsize
 
     ds.exchange.x = self.x_dist
     ds.exchange.x_units = 'um'
     ds.exchange.y = self.y_dist
     ds.exchange.y_units = 'um'     
 
     
@@ -787,16 +787,16 @@
     ds.exchange.energy=self.ev
     ds.exchange.energy_units = 'ev'
     
     ds.exchange.angles = angles
     
     
     #Since we do not have a scanning microscope we fill the x_dist and y_dist from pixel_size
-    self.x_dist = np.arange(np.float(self.n_cols))*pixelsize
-    self.y_dist = np.arange(np.float(self.n_rows))*pixelsize
+    self.x_dist = np.arange(float(self.n_cols))*pixelsize
+    self.y_dist = np.arange(float(self.n_rows))*pixelsize
 
     ds.exchange.x = self.x_dist
     ds.exchange.x_units = 'um'
     ds.exchange.y = self.y_dist
     ds.exchange.y_units = 'um'    
     
     ds.spectromicroscopy.data_dwell = exptimes
```

### Comparing `mantis-xray-3.1.7/mantis_xray/helpers.py` & `mantis-xray-3.1.9/mantis_xray/helpers.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/henke.py` & `mantis-xray-3.1.9/mantis_xray/henke.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/henke.xdr` & `mantis-xray-3.1.9/mantis_xray/henke.xdr`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/images/Mantis_logo.icns` & `mantis-xray-3.1.9/mantis_xray/images/Mantis_logo.icns`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/images/Mantis_logo.ico` & `mantis-xray-3.1.9/mantis_xray/images/Mantis_logo.ico`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/images/Mantis_logo_about.png` & `mantis-xray-3.1.9/mantis_xray/images/Mantis_logo_about.png`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/images/document-open.png` & `mantis-xray-3.1.9/mantis_xray/images/document-open.png`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/images/help-browser.png` & `mantis-xray-3.1.9/mantis_xray/images/help-browser.png`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/images/logo-2l-32.ico` & `mantis-xray-3.1.9/mantis_xray/images/logo-2l-32.ico`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/images/media-floppy.png` & `mantis-xray-3.1.9/mantis_xray/images/media-floppy.png`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/logos.py` & `mantis-xray-3.1.9/mantis_xray/logos.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/mantis.py` & `mantis-xray-3.1.9/mantis_xray/mantis.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/mantis_qt.py` & `mantis-xray-3.1.9/mantis_xray/mantis_qt.py`

 * *Files 0% similar despite different names*

```diff
@@ -21434,18077 +21434,18092 @@
 00053b90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
 00053ba0: 2e74 635f 7370 6563 2e73 6574 5465 7874  .tc_spec.setText
 00053bb0: 2827 5370 6563 7472 756d 2061 7420 7069  ('Spectrum at pi
 00053bc0: 7865 6c20 5b7b 307d 2c20 7b31 7d5d 206f  xel [{0}, {1}] o
 00053bd0: 7220 706f 7369 7469 6f6e 205b 7b32 3a35  r position [{2:5
 00053be0: 2e32 667d 2c20 7b33 3a35 2e32 667d 5d27  .2f}, {3:5.2f}]'
 00053bf0: 2e66 6f72 6d61 7428 7374 7228 7870 6f73  .format(str(xpos
-00053c00: 292c 2020 7374 7228 7970 6f73 292c 206e  ),  str(ypos), n
-00053c10: 702e 666c 6f61 7428 7365 6c66 2e73 746b  p.float(self.stk
-00053c20: 2e78 5f64 6973 745b 696e 7428 7870 6f73  .x_dist[int(xpos
-00053c30: 295d 292c 206e 702e 666c 6f61 7428 7365  )]), np.float(se
-00053c40: 6c66 2e73 746b 2e79 5f64 6973 745b 696e  lf.stk.y_dist[in
-00053c50: 7428 7970 6f73 295d 2929 290d 0a20 2020  t(ypos)])))..   
-00053c60: 2020 2020 2020 2020 2073 7065 6370 6c6f           specplo
-00053c70: 7420 3d20 6178 6573 2e70 6c6f 7428 7365  t = axes.plot(se
-00053c80: 6c66 2e73 746b 2e65 762c 7365 6c66 2e73  lf.stk.ev,self.s
-00053c90: 7065 6374 7275 6d29 0d0a 2020 2020 2020  pectrum)..      
-00053ca0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00053cb0: 2020 2020 2073 656c 662e 7463 5f73 7065       self.tc_spe
-00053cc0: 632e 7365 7454 6578 7428 2241 7665 7261  c.setText("Avera
-00053cd0: 6765 2052 4f49 2053 7065 6374 7275 6d3a  ge ROI Spectrum:
-00053ce0: 2022 290d 0a20 2020 2020 2020 2020 2020   ")..           
-00053cf0: 2073 656c 662e 4361 6c63 524f 4953 7065   self.CalcROISpe
-00053d00: 6374 7275 6d28 290d 0a20 2020 2020 2020  ctrum()..       
-00053d10: 2020 2020 2073 7065 6370 6c6f 7420 3d20       specplot = 
-00053d20: 6178 6573 2e70 6c6f 7428 7365 6c66 2e73  axes.plot(self.s
-00053d30: 746b 2e65 762c 7365 6c66 2e52 4f49 7370  tk.ev,self.ROIsp
-00053d40: 6563 7472 756d 290d 0a0d 0a20 2020 2020  ectrum)....     
-00053d50: 2020 200d 0a0d 0a20 2020 2020 2020 2061     ....        a
-00053d60: 7865 732e 6178 766c 696e 6528 783d 7365  xes.axvline(x=se
-00053d70: 6c66 2e73 746b 2e65 765b 7365 6c66 2e69  lf.stk.ev[self.i
-00053d80: 6576 5d2c 2063 6f6c 6f72 203d 2027 6727  ev], color = 'g'
-00053d90: 2c20 616c 7068 613d 302e 3529 0d0a 0d0a  , alpha=0.5)....
-00053da0: 0d0a 2020 2020 2020 2020 7365 6c66 2e53  ..        self.S
-00053db0: 7065 6374 7275 6d50 616e 656c 2e64 7261  pectrumPanel.dra
-00053dc0: 7728 290d 0a0d 0a0d 0a23 2d2d 2d2d 2d2d  w()......#------
+00053c00: 292c 2020 7374 7228 7970 6f73 292c 2066  ),  str(ypos), f
+00053c10: 6c6f 6174 2873 656c 662e 7374 6b2e 785f  loat(self.stk.x_
+00053c20: 6469 7374 5b69 6e74 2878 706f 7329 5d29  dist[int(xpos)])
+00053c30: 2c20 666c 6f61 7428 7365 6c66 2e73 746b  , float(self.stk
+00053c40: 2e79 5f64 6973 745b 696e 7428 7970 6f73  .y_dist[int(ypos
+00053c50: 295d 2929 290d 0a20 2020 2020 2020 2020  )])))..         
+00053c60: 2020 2073 7065 6370 6c6f 7420 3d20 6178     specplot = ax
+00053c70: 6573 2e70 6c6f 7428 7365 6c66 2e73 746b  es.plot(self.stk
+00053c80: 2e65 762c 7365 6c66 2e73 7065 6374 7275  .ev,self.spectru
+00053c90: 6d29 0d0a 2020 2020 2020 2020 656c 7365  m)..        else
+00053ca0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00053cb0: 656c 662e 7463 5f73 7065 632e 7365 7454  elf.tc_spec.setT
+00053cc0: 6578 7428 2241 7665 7261 6765 2052 4f49  ext("Average ROI
+00053cd0: 2053 7065 6374 7275 6d3a 2022 290d 0a20   Spectrum: ").. 
+00053ce0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00053cf0: 4361 6c63 524f 4953 7065 6374 7275 6d28  CalcROISpectrum(
+00053d00: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00053d10: 7065 6370 6c6f 7420 3d20 6178 6573 2e70  pecplot = axes.p
+00053d20: 6c6f 7428 7365 6c66 2e73 746b 2e65 762c  lot(self.stk.ev,
+00053d30: 7365 6c66 2e52 4f49 7370 6563 7472 756d  self.ROIspectrum
+00053d40: 290d 0a0d 0a20 2020 2020 2020 200d 0a0d  )....        ...
+00053d50: 0a20 2020 2020 2020 2061 7865 732e 6178  .        axes.ax
+00053d60: 766c 696e 6528 783d 7365 6c66 2e73 746b  vline(x=self.stk
+00053d70: 2e65 765b 7365 6c66 2e69 6576 5d2c 2063  .ev[self.iev], c
+00053d80: 6f6c 6f72 203d 2027 6727 2c20 616c 7068  olor = 'g', alph
+00053d90: 613d 302e 3529 0d0a 0d0a 0d0a 2020 2020  a=0.5)......    
+00053da0: 2020 2020 7365 6c66 2e53 7065 6374 7275      self.Spectru
+00053db0: 6d50 616e 656c 2e64 7261 7728 290d 0a0d  mPanel.draw()...
+00053dc0: 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ...#------------
 00053dd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00053de0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00053df0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00053e00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00053e10: 0d0a 2020 2020 6465 6620 5265 7365 7444  ..    def ResetD
-00053e20: 6973 706c 6179 5365 7474 696e 6773 2873  isplaySettings(s
-00053e30: 656c 6629 3a0d 0a0d 0a0d 0a0d 0a20 2020  elf):........   
-00053e40: 2020 2020 2073 656c 662e 6465 6661 756c       self.defaul
-00053e50: 7464 6973 706c 6179 203d 2031 2e30 0d0a  tdisplay = 1.0..
-00053e60: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
-00053e70: 6973 7062 7269 6768 746e 6573 735f 6d69  ispbrightness_mi
-00053e80: 6e20 3d20 300d 0a20 2020 2020 2020 2073  n = 0..        s
-00053e90: 656c 662e 6469 7370 6272 6967 6874 6e65  elf.dispbrightne
-00053ea0: 7373 5f6d 6178 203d 2031 3030 0d0a 2020  ss_max = 100..  
-00053eb0: 2020 2020 2020 7365 6c66 2e64 6973 706c        self.displ
-00053ec0: 6179 6761 6d6d 6120 3d20 3130 2e30 0d0a  aygamma = 10.0..
-00053ed0: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
-00053ee0: 7269 6768 746e 6573 735f 6d69 6e20 3d20  rightness_min = 
-00053ef0: 302e 300d 0a20 2020 2020 2020 2073 656c  0.0..        sel
-00053f00: 662e 6272 6967 6874 6e65 7373 5f6d 6178  f.brightness_max
-00053f10: 203d 2031 2e30 0d0a 2020 2020 2020 2020   = 1.0..        
-00053f20: 7365 6c66 2e67 616d 6d61 203d 2031 2e30  self.gamma = 1.0
-00053f30: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00053f40: 2e73 6c69 6465 725f 6272 6967 6874 6e65  .slider_brightne
-00053f50: 7373 5f6d 6178 2e73 6574 5661 6c75 6528  ss_max.setValue(
-00053f60: 7365 6c66 2e64 6973 7062 7269 6768 746e  self.dispbrightn
-00053f70: 6573 735f 6d61 7829 0d0a 2020 2020 2020  ess_max)..      
-00053f80: 2020 7365 6c66 2e73 6c69 6465 725f 6272    self.slider_br
-00053f90: 6967 6874 6e65 7373 5f6d 696e 2e73 6574  ightness_min.set
-00053fa0: 5661 6c75 6528 7365 6c66 2e64 6973 7062  Value(self.dispb
-00053fb0: 7269 6768 746e 6573 735f 6d69 6e29 0d0a  rightness_min)..
-00053fc0: 2020 2020 2020 2020 7365 6c66 2e73 6c69          self.sli
-00053fd0: 6465 725f 6761 6d6d 612e 7365 7456 616c  der_gamma.setVal
-00053fe0: 7565 2869 6e74 2873 656c 662e 6469 7370  ue(int(self.disp
-00053ff0: 6c61 7967 616d 6d61 2929 0d0a 0d0a 2020  laygamma))....  
-00054000: 2020 2020 2020 7365 6c66 2e74 635f 6d69        self.tc_mi
-00054010: 6e2e 7365 7454 6578 7428 274d 696e 696d  n.setText('Minim
-00054020: 756d 3a20 5c74 7b30 3a35 647d 2527 2e66  um: \t{0:5d}%'.f
-00054030: 6f72 6d61 7428 696e 7428 3130 302a 7365  ormat(int(100*se
-00054040: 6c66 2e62 7269 6768 746e 6573 735f 6d69  lf.brightness_mi
-00054050: 6e29 2929 0d0a 2020 2020 2020 2020 7365  n)))..        se
-00054060: 6c66 2e74 635f 6d61 782e 7365 7454 6578  lf.tc_max.setTex
-00054070: 7428 274d 6178 696d 756d 3a7b 303a 3564  t('Maximum:{0:5d
-00054080: 7d25 272e 666f 726d 6174 2869 6e74 2831  }%'.format(int(1
-00054090: 3030 2a73 656c 662e 6272 6967 6874 6e65  00*self.brightne
-000540a0: 7373 5f6d 6178 2929 290d 0a20 2020 2020  ss_max)))..     
-000540b0: 2020 2073 656c 662e 7463 5f67 616d 6d61     self.tc_gamma
-000540c0: 2e73 6574 5465 7874 2827 4761 6d6d 613a  .setText('Gamma:
-000540d0: 2020 5c74 7b30 3a35 2e32 667d 272e 666f    \t{0:5.2f}'.fo
-000540e0: 726d 6174 2873 656c 662e 6761 6d6d 6129  rmat(self.gamma)
-000540f0: 290d 0a0d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d  )......#--------
+00053e00: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
+00053e10: 6465 6620 5265 7365 7444 6973 706c 6179  def ResetDisplay
+00053e20: 5365 7474 696e 6773 2873 656c 6629 3a0d  Settings(self):.
+00053e30: 0a0d 0a0d 0a0d 0a20 2020 2020 2020 2073  .......        s
+00053e40: 656c 662e 6465 6661 756c 7464 6973 706c  elf.defaultdispl
+00053e50: 6179 203d 2031 2e30 0d0a 0d0a 2020 2020  ay = 1.0....    
+00053e60: 2020 2020 7365 6c66 2e64 6973 7062 7269      self.dispbri
+00053e70: 6768 746e 6573 735f 6d69 6e20 3d20 300d  ghtness_min = 0.
+00053e80: 0a20 2020 2020 2020 2073 656c 662e 6469  .        self.di
+00053e90: 7370 6272 6967 6874 6e65 7373 5f6d 6178  spbrightness_max
+00053ea0: 203d 2031 3030 0d0a 2020 2020 2020 2020   = 100..        
+00053eb0: 7365 6c66 2e64 6973 706c 6179 6761 6d6d  self.displaygamm
+00053ec0: 6120 3d20 3130 2e30 0d0a 0d0a 2020 2020  a = 10.0....    
+00053ed0: 2020 2020 7365 6c66 2e62 7269 6768 746e      self.brightn
+00053ee0: 6573 735f 6d69 6e20 3d20 302e 300d 0a20  ess_min = 0.0.. 
+00053ef0: 2020 2020 2020 2073 656c 662e 6272 6967         self.brig
+00053f00: 6874 6e65 7373 5f6d 6178 203d 2031 2e30  htness_max = 1.0
+00053f10: 0d0a 2020 2020 2020 2020 7365 6c66 2e67  ..        self.g
+00053f20: 616d 6d61 203d 2031 2e30 0d0a 0d0a 2020  amma = 1.0....  
+00053f30: 2020 2020 2020 7365 6c66 2e73 6c69 6465        self.slide
+00053f40: 725f 6272 6967 6874 6e65 7373 5f6d 6178  r_brightness_max
+00053f50: 2e73 6574 5661 6c75 6528 7365 6c66 2e64  .setValue(self.d
+00053f60: 6973 7062 7269 6768 746e 6573 735f 6d61  ispbrightness_ma
+00053f70: 7829 0d0a 2020 2020 2020 2020 7365 6c66  x)..        self
+00053f80: 2e73 6c69 6465 725f 6272 6967 6874 6e65  .slider_brightne
+00053f90: 7373 5f6d 696e 2e73 6574 5661 6c75 6528  ss_min.setValue(
+00053fa0: 7365 6c66 2e64 6973 7062 7269 6768 746e  self.dispbrightn
+00053fb0: 6573 735f 6d69 6e29 0d0a 2020 2020 2020  ess_min)..      
+00053fc0: 2020 7365 6c66 2e73 6c69 6465 725f 6761    self.slider_ga
+00053fd0: 6d6d 612e 7365 7456 616c 7565 2869 6e74  mma.setValue(int
+00053fe0: 2873 656c 662e 6469 7370 6c61 7967 616d  (self.displaygam
+00053ff0: 6d61 2929 0d0a 0d0a 2020 2020 2020 2020  ma))....        
+00054000: 7365 6c66 2e74 635f 6d69 6e2e 7365 7454  self.tc_min.setT
+00054010: 6578 7428 274d 696e 696d 756d 3a20 5c74  ext('Minimum: \t
+00054020: 7b30 3a35 647d 2527 2e66 6f72 6d61 7428  {0:5d}%'.format(
+00054030: 696e 7428 3130 302a 7365 6c66 2e62 7269  int(100*self.bri
+00054040: 6768 746e 6573 735f 6d69 6e29 2929 0d0a  ghtness_min)))..
+00054050: 2020 2020 2020 2020 7365 6c66 2e74 635f          self.tc_
+00054060: 6d61 782e 7365 7454 6578 7428 274d 6178  max.setText('Max
+00054070: 696d 756d 3a7b 303a 3564 7d25 272e 666f  imum:{0:5d}%'.fo
+00054080: 726d 6174 2869 6e74 2831 3030 2a73 656c  rmat(int(100*sel
+00054090: 662e 6272 6967 6874 6e65 7373 5f6d 6178  f.brightness_max
+000540a0: 2929 290d 0a20 2020 2020 2020 2073 656c  )))..        sel
+000540b0: 662e 7463 5f67 616d 6d61 2e73 6574 5465  f.tc_gamma.setTe
+000540c0: 7874 2827 4761 6d6d 613a 2020 5c74 7b30  xt('Gamma:  \t{0
+000540d0: 3a35 2e32 667d 272e 666f 726d 6174 2873  :5.2f}'.format(s
+000540e0: 656c 662e 6761 6d6d 6129 290d 0a0d 0a0d  elf.gamma)).....
+000540f0: 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  .#--------------
 00054100: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054110: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054120: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00054130: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a  --------------..
-00054140: 2020 2020 6465 6620 4f6e 4164 6452 4f49      def OnAddROI
-00054150: 2873 656c 662c 2065 7674 293a 0d0a 0d0a  (self, evt):....
-00054160: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-00054170: 726f 6920 3d20 310d 0a20 2020 2020 2020  roi = 1..       
-00054180: 2073 656c 662e 4162 7349 6d61 6765 5061   self.AbsImagePa
-00054190: 6e65 6c2e 6d70 6c5f 6469 7363 6f6e 6e65  nel.mpl_disconne
-000541a0: 6374 2873 656c 662e 6369 6431 290d 0a0d  ct(self.cid1)...
-000541b0: 0a20 2020 2020 2020 206c 696e 6570 726f  .        linepro
-000541c0: 7073 203d 2064 6963 7428 636f 6c6f 723d  ps = dict(color=
-000541d0: 2772 6564 272c 206c 696e 6573 7479 6c65  'red', linestyle
-000541e0: 3d27 2d27 2c20 6c69 6e65 7769 6474 6820  ='-', linewidth 
-000541f0: 3d20 312c 2061 6c70 6861 3d31 290d 0a0d  = 1, alpha=1)...
-00054200: 0a20 2020 2020 2020 2073 656c 662e 6c61  .        self.la
-00054210: 7373 6f20 3d20 4c61 7373 6f53 656c 6563  sso = LassoSelec
-00054220: 746f 7228 7365 6c66 2e61 7865 732c 206f  tor(self.axes, o
-00054230: 6e73 656c 6563 743d 7365 6c66 2e4f 6e53  nselect=self.OnS
-00054240: 656c 6563 744c 6173 736f 2c20 7573 6562  electLasso, useb
-00054250: 6c69 743d 4661 6c73 652c 206c 696e 6570  lit=False, linep
-00054260: 726f 7073 3d6c 696e 6570 726f 7073 290d  rops=lineprops).
-00054270: 0a0d 0a20 2020 2020 2020 2066 6967 203d  ...        fig =
-00054280: 2073 656c 662e 7370 6563 6669 670d 0a20   self.specfig.. 
-00054290: 2020 2020 2020 2066 6967 2e63 6c66 2829         fig.clf()
-000542a0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-000542b0: 2e62 7574 746f 6e5f 7265 7365 7452 4f49  .button_resetROI
-000542c0: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
-000542d0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000542e0: 6275 7474 6f6e 5f52 4f49 646f 7365 6361  button_ROIdoseca
-000542f0: 6c63 2e73 6574 456e 6162 6c65 6428 4661  lc.setEnabled(Fa
-00054300: 6c73 6529 0d0a 2020 2020 2020 2020 7365  lse)..        se
-00054310: 6c66 2e77 696e 646f 7728 292e 7265 6672  lf.window().refr
-00054320: 6573 685f 7769 6467 6574 7328 290d 0a0d  esh_widgets()...
-00054330: 0a20 2020 2020 2020 2072 6574 7572 6e0d  .        return.
-00054340: 0a0d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d  .....#----------
+00054130: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 6465  --------..    de
+00054140: 6620 4f6e 4164 6452 4f49 2873 656c 662c  f OnAddROI(self,
+00054150: 2065 7674 293a 0d0a 0d0a 2020 2020 2020   evt):....      
+00054160: 2020 7365 6c66 2e61 6464 726f 6920 3d20    self.addroi = 
+00054170: 310d 0a20 2020 2020 2020 2073 656c 662e  1..        self.
+00054180: 4162 7349 6d61 6765 5061 6e65 6c2e 6d70  AbsImagePanel.mp
+00054190: 6c5f 6469 7363 6f6e 6e65 6374 2873 656c  l_disconnect(sel
+000541a0: 662e 6369 6431 290d 0a0d 0a20 2020 2020  f.cid1)....     
+000541b0: 2020 206c 696e 6570 726f 7073 203d 2064     lineprops = d
+000541c0: 6963 7428 636f 6c6f 723d 2772 6564 272c  ict(color='red',
+000541d0: 206c 696e 6573 7479 6c65 3d27 2d27 2c20   linestyle='-', 
+000541e0: 6c69 6e65 7769 6474 6820 3d20 312c 2061  linewidth = 1, a
+000541f0: 6c70 6861 3d31 290d 0a0d 0a20 2020 2020  lpha=1)....     
+00054200: 2020 2073 656c 662e 6c61 7373 6f20 3d20     self.lasso = 
+00054210: 4c61 7373 6f53 656c 6563 746f 7228 7365  LassoSelector(se
+00054220: 6c66 2e61 7865 732c 206f 6e73 656c 6563  lf.axes, onselec
+00054230: 743d 7365 6c66 2e4f 6e53 656c 6563 744c  t=self.OnSelectL
+00054240: 6173 736f 2c20 7573 6562 6c69 743d 4661  asso, useblit=Fa
+00054250: 6c73 652c 206c 696e 6570 726f 7073 3d6c  lse, lineprops=l
+00054260: 696e 6570 726f 7073 290d 0a0d 0a20 2020  ineprops)....   
+00054270: 2020 2020 2066 6967 203d 2073 656c 662e       fig = self.
+00054280: 7370 6563 6669 670d 0a20 2020 2020 2020  specfig..       
+00054290: 2066 6967 2e63 6c66 2829 0d0a 0d0a 2020   fig.clf()....  
+000542a0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+000542b0: 6e5f 7265 7365 7452 4f49 2e73 6574 456e  n_resetROI.setEn
+000542c0: 6162 6c65 6428 5472 7565 290d 0a20 2020  abled(True)..   
+000542d0: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
+000542e0: 5f52 4f49 646f 7365 6361 6c63 2e73 6574  _ROIdosecalc.set
+000542f0: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
+00054300: 2020 2020 2020 2020 7365 6c66 2e77 696e          self.win
+00054310: 646f 7728 292e 7265 6672 6573 685f 7769  dow().refresh_wi
+00054320: 6467 6574 7328 290d 0a0d 0a20 2020 2020  dgets()....     
+00054330: 2020 2072 6574 7572 6e0d 0a0d 0a0d 0a23     return......#
+00054340: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054350: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054360: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054370: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00054380: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020  ------------..  
-00054390: 2020 6465 6620 4361 6c63 524f 4953 7065    def CalcROISpe
-000543a0: 6374 7275 6d28 7365 6c66 293a 0d0a 0d0a  ctrum(self):....
-000543b0: 2020 2020 2020 2020 7365 6c66 2e52 4f49          self.ROI
-000543c0: 7370 6563 7472 756d 203d 206e 702e 7a65  spectrum = np.ze
-000543d0: 726f 7328 2873 656c 662e 7374 6b2e 6e5f  ros((self.stk.n_
-000543e0: 6576 2929 0d0a 0d0a 0d0a 2020 2020 2020  ev))......      
-000543f0: 2020 696e 6469 6365 7320 3d20 6e70 2e77    indices = np.w
-00054400: 6865 7265 2873 656c 662e 524f 4961 7272  here(self.ROIarr
-00054410: 6179 203d 3d20 3235 3529 0d0a 2020 2020  ay == 255)..    
-00054420: 2020 2020 6e75 6d72 6f69 7069 7820 3d20      numroipix = 
-00054430: 7365 6c66 2e52 4f49 6172 7261 795b 696e  self.ROIarray[in
-00054440: 6469 6365 735d 2e73 6861 7065 5b30 5d0d  dices].shape[0].
-00054450: 0a0d 0a0d 0a0d 0a20 2020 2020 2020 2069  .......        i
-00054460: 6620 7365 6c66 2e63 6f6d 2e69 305f 6c6f  f self.com.i0_lo
-00054470: 6164 6564 203d 3d20 313a 0d0a 2020 2020  aded == 1:..    
-00054480: 2020 2020 2020 2020 666f 7220 6965 2069          for ie i
-00054490: 6e20 7261 6e67 6528 7365 6c66 2e73 746b  n range(self.stk
-000544a0: 2e6e 5f65 7629 3a0d 0a20 2020 2020 2020  .n_ev):..       
-000544b0: 2020 2020 2020 2020 2074 6869 7365 6e67           thiseng
-000544c0: 5f6f 6420 3d20 7365 6c66 2e73 746b 2e6f  _od = self.stk.o
-000544d0: 6433 645b 3a2c 3a2c 6965 5d0d 0a20 2020  d3d[:,:,ie]..   
-000544e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000544f0: 662e 524f 4973 7065 6374 7275 6d5b 6965  f.ROIspectrum[ie
-00054500: 5d20 3d20 6e70 2e73 756d 2874 6869 7365  ] = np.sum(thise
-00054510: 6e67 5f6f 645b 696e 6469 6365 735d 292f  ng_od[indices])/
-00054520: 6e75 6d72 6f69 7069 780d 0a20 2020 2020  numroipix..     
-00054530: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00054540: 2020 2020 2020 666f 7220 6965 2069 6e20        for ie in 
-00054550: 7261 6e67 6528 7365 6c66 2e73 746b 2e6e  range(self.stk.n
-00054560: 5f65 7629 3a0d 0a20 2020 2020 2020 2020  _ev):..         
-00054570: 2020 2020 2020 2074 6869 7365 6e67 5f61         thiseng_a
-00054580: 6273 203d 2073 656c 662e 7374 6b2e 6162  bs = self.stk.ab
-00054590: 7364 6174 615b 3a2c 3a2c 6965 5d0d 0a20  sdata[:,:,ie].. 
-000545a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000545b0: 656c 662e 524f 4973 7065 6374 7275 6d5b  elf.ROIspectrum[
-000545c0: 6965 5d20 3d20 6e70 2e73 756d 2874 6869  ie] = np.sum(thi
-000545d0: 7365 6e67 5f61 6273 5b69 6e64 6963 6573  seng_abs[indices
-000545e0: 5d29 2f6e 756d 726f 6970 6978 0d0a 2020  ])/numroipix..  
-000545f0: 2020 2020 2020 2020 2020 0d0a 0d0a 232d            ....#-
+00054380: 2d2d 2d2d 2d2d 0d0a 2020 2020 6465 6620  ------..    def 
+00054390: 4361 6c63 524f 4953 7065 6374 7275 6d28  CalcROISpectrum(
+000543a0: 7365 6c66 293a 0d0a 0d0a 2020 2020 2020  self):....      
+000543b0: 2020 7365 6c66 2e52 4f49 7370 6563 7472    self.ROIspectr
+000543c0: 756d 203d 206e 702e 7a65 726f 7328 2873  um = np.zeros((s
+000543d0: 656c 662e 7374 6b2e 6e5f 6576 2929 0d0a  elf.stk.n_ev))..
+000543e0: 0d0a 0d0a 2020 2020 2020 2020 696e 6469  ....        indi
+000543f0: 6365 7320 3d20 6e70 2e77 6865 7265 2873  ces = np.where(s
+00054400: 656c 662e 524f 4961 7272 6179 203d 3d20  elf.ROIarray == 
+00054410: 3235 3529 0d0a 2020 2020 2020 2020 6e75  255)..        nu
+00054420: 6d72 6f69 7069 7820 3d20 7365 6c66 2e52  mroipix = self.R
+00054430: 4f49 6172 7261 795b 696e 6469 6365 735d  OIarray[indices]
+00054440: 2e73 6861 7065 5b30 5d0d 0a0d 0a0d 0a0d  .shape[0].......
+00054450: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00054460: 2e63 6f6d 2e69 305f 6c6f 6164 6564 203d  .com.i0_loaded =
+00054470: 3d20 313a 0d0a 2020 2020 2020 2020 2020  = 1:..          
+00054480: 2020 666f 7220 6965 2069 6e20 7261 6e67    for ie in rang
+00054490: 6528 7365 6c66 2e73 746b 2e6e 5f65 7629  e(self.stk.n_ev)
+000544a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000544b0: 2020 2074 6869 7365 6e67 5f6f 6420 3d20     thiseng_od = 
+000544c0: 7365 6c66 2e73 746b 2e6f 6433 645b 3a2c  self.stk.od3d[:,
+000544d0: 3a2c 6965 5d0d 0a20 2020 2020 2020 2020  :,ie]..         
+000544e0: 2020 2020 2020 2073 656c 662e 524f 4973         self.ROIs
+000544f0: 7065 6374 7275 6d5b 6965 5d20 3d20 6e70  pectrum[ie] = np
+00054500: 2e73 756d 2874 6869 7365 6e67 5f6f 645b  .sum(thiseng_od[
+00054510: 696e 6469 6365 735d 292f 6e75 6d72 6f69  indices])/numroi
+00054520: 7069 780d 0a20 2020 2020 2020 2065 6c73  pix..        els
+00054530: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00054540: 666f 7220 6965 2069 6e20 7261 6e67 6528  for ie in range(
+00054550: 7365 6c66 2e73 746b 2e6e 5f65 7629 3a0d  self.stk.n_ev):.
+00054560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00054570: 2074 6869 7365 6e67 5f61 6273 203d 2073   thiseng_abs = s
+00054580: 656c 662e 7374 6b2e 6162 7364 6174 615b  elf.stk.absdata[
+00054590: 3a2c 3a2c 6965 5d0d 0a20 2020 2020 2020  :,:,ie]..       
+000545a0: 2020 2020 2020 2020 2073 656c 662e 524f           self.RO
+000545b0: 4973 7065 6374 7275 6d5b 6965 5d20 3d20  Ispectrum[ie] = 
+000545c0: 6e70 2e73 756d 2874 6869 7365 6e67 5f61  np.sum(thiseng_a
+000545d0: 6273 5b69 6e64 6963 6573 5d29 2f6e 756d  bs[indices])/num
+000545e0: 726f 6970 6978 0d0a 2020 2020 2020 2020  roipix..        
+000545f0: 2020 2020 0d0a 0d0a 232d 2d2d 2d2d 2d2d      ....#-------
 00054600: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054610: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054620: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00054630: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00054640: 2d2d 2d2d 2d0d 0a0d 0a20 2020 2064 6566  -----....    def
-00054650: 204f 6e53 656c 6563 744c 6173 736f 2873   OnSelectLasso(s
-00054660: 656c 662c 7665 7274 7329 3a0d 0a0d 0a20  elf,verts):.... 
-00054670: 2020 2020 2020 2070 6174 6820 3d20 6d61         path = ma
-00054680: 7470 6c6f 746c 6962 2e70 6174 682e 5061  tplotlib.path.Pa
-00054690: 7468 2876 6572 7473 290d 0a20 2020 2020  th(verts)..     
-000546a0: 2020 2023 6669 6e64 2070 6978 656c 7320     #find pixels 
-000546b0: 696e 7369 6465 2074 6865 2070 6f6c 7967  inside the polyg
-000546c0: 6f6e 0d0a 0d0a 2020 2020 2020 2020 524f  on....        RO
-000546d0: 4970 6978 203d 206e 702e 7a65 726f 7328  Ipix = np.zeros(
-000546e0: 2873 656c 662e 7374 6b2e 6e5f 636f 6c73  (self.stk.n_cols
-000546f0: 2c73 656c 662e 7374 6b2e 6e5f 726f 7773  ,self.stk.n_rows
-00054700: 2929 0d0a 0d0a 2020 2020 2020 2020 666f  ))....        fo
-00054710: 7220 6920 696e 2072 616e 6765 2873 656c  r i in range(sel
-00054720: 662e 7374 6b2e 6e5f 636f 6c73 293a 0d0a  f.stk.n_cols):..
-00054730: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00054740: 6a20 696e 2072 616e 6765 2873 656c 662e  j in range(self.
-00054750: 7374 6b2e 6e5f 726f 7773 293a 0d0a 2020  stk.n_rows):..  
-00054760: 2020 2020 2020 2020 2020 2020 2020 5069                Pi
-00054770: 6e73 6964 6520 3d20 7061 7468 2e63 6f6e  nside = path.con
-00054780: 7461 696e 735f 706f 696e 7428 2869 2c6a  tains_point((i,j
-00054790: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-000547a0: 2020 2020 6966 2050 696e 7369 6465 203d      if Pinside =
-000547b0: 3d20 5472 7565 3a0d 0a20 2020 2020 2020  = True:..       
-000547c0: 2020 2020 2020 2020 2020 2020 2052 4f49               ROI
-000547d0: 7069 785b 692c 2073 656c 662e 7374 6b2e  pix[i, self.stk.
-000547e0: 6e5f 726f 7773 2d31 2d6a 5d20 3d20 3235  n_rows-1-j] = 25
-000547f0: 350d 0a0d 0a0d 0a0d 0a20 2020 2020 2020  5........       
-00054800: 2052 4f49 7069 7820 3d20 6e70 2e6d 612e   ROIpix = np.ma.
-00054810: 6172 7261 7928 524f 4970 6978 290d 0a0d  array(ROIpix)...
-00054820: 0a20 2020 2020 2020 2073 656c 662e 524f  .        self.RO
-00054830: 4970 6978 5f6d 6173 6b65 6420 3d20 206e  Ipix_masked =  n
-00054840: 702e 6d61 2e6d 6173 6b65 645f 7661 6c75  p.ma.masked_valu
-00054850: 6573 2852 4f49 7069 782c 2030 290d 0a0d  es(ROIpix, 0)...
-00054860: 0a20 2020 2020 2020 2073 656c 662e 524f  .        self.RO
-00054870: 4961 7272 6179 203d 2052 4f49 7069 785b  Iarray = ROIpix[
-00054880: 3a5d 0d0a 0d0a 0d0a 2020 2020 2020 2020  :]......        
-00054890: 7365 6c66 2e73 686f 7752 4f49 6d61 736b  self.showROImask
-000548a0: 203d 2031 0d0a 2020 2020 2020 2020 7365   = 1..        se
-000548b0: 6c66 2e6c 696e 6520 3d20 4e6f 6e65 0d0a  lf.line = None..
-000548c0: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
-000548d0: 7669 6f75 735f 706f 696e 7420 3d20 5b5d  vious_point = []
-000548e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-000548f0: 7461 7274 5f70 6f69 6e74 203d 205b 5d0d  tart_point = [].
-00054900: 0a20 2020 2020 2020 2073 656c 662e 656e  .        self.en
-00054910: 645f 706f 696e 7420 3d20 5b5d 0d0a 2020  d_point = []..  
-00054920: 2020 2020 2020 7365 6c66 2e72 6f69 7864        self.roixd
-00054930: 6174 6120 3d20 5b5d 0d0a 2020 2020 2020  ata = []..      
-00054940: 2020 7365 6c66 2e72 6f69 7964 6174 6120    self.roiydata 
-00054950: 3d20 5b5d 0d0a 0d0a 2020 2020 2020 2020  = []....        
-00054960: 7365 6c66 2e62 7574 746f 6e5f 7361 7665  self.button_save
-00054970: 524f 4973 7065 6374 722e 7365 7445 6e61  ROIspectr.setEna
-00054980: 626c 6564 2854 7275 6529 0d0a 2020 2020  bled(True)..    
-00054990: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-000549a0: 7365 7452 4f49 4930 2e73 6574 456e 6162  setROII0.setEnab
-000549b0: 6c65 6428 5472 7565 290d 0a20 2020 2020  led(True)..     
-000549c0: 2020 2073 656c 662e 6275 7474 6f6e 5f52     self.button_R
-000549d0: 4f49 646f 7365 6361 6c63 2e73 6574 456e  OIdosecalc.setEn
-000549e0: 6162 6c65 6428 5472 7565 290d 0a20 2020  abled(True)..   
-000549f0: 2020 2020 2073 656c 662e 7769 6e64 6f77       self.window
-00054a00: 2829 2e72 6566 7265 7368 5f77 6964 6765  ().refresh_widge
-00054a10: 7473 2829 0d0a 0d0a 2020 2020 2020 2020  ts()....        
-00054a20: 7365 6c66 2e6c 6f61 6449 6d61 6765 2829  self.loadImage()
-00054a30: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-00054a40: 686f 7753 7065 6374 7275 6d28 302c 2030  howSpectrum(0, 0
-00054a50: 290d 0a0d 0a20 2020 2020 2020 2051 7457  )....        QtW
-00054a60: 6964 6765 7473 2e51 4170 706c 6963 6174  idgets.QApplicat
-00054a70: 696f 6e2e 7265 7374 6f72 654f 7665 7272  ion.restoreOverr
-00054a80: 6964 6543 7572 736f 7228 290d 0a0d 0a0d  ideCursor().....
-00054a90: 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  .#--------------
+00054630: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
+00054640: 0a0d 0a20 2020 2064 6566 204f 6e53 656c  ...    def OnSel
+00054650: 6563 744c 6173 736f 2873 656c 662c 7665  ectLasso(self,ve
+00054660: 7274 7329 3a0d 0a0d 0a20 2020 2020 2020  rts):....       
+00054670: 2070 6174 6820 3d20 6d61 7470 6c6f 746c   path = matplotl
+00054680: 6962 2e70 6174 682e 5061 7468 2876 6572  ib.path.Path(ver
+00054690: 7473 290d 0a20 2020 2020 2020 2023 6669  ts)..        #fi
+000546a0: 6e64 2070 6978 656c 7320 696e 7369 6465  nd pixels inside
+000546b0: 2074 6865 2070 6f6c 7967 6f6e 0d0a 0d0a   the polygon....
+000546c0: 2020 2020 2020 2020 524f 4970 6978 203d          ROIpix =
+000546d0: 206e 702e 7a65 726f 7328 2873 656c 662e   np.zeros((self.
+000546e0: 7374 6b2e 6e5f 636f 6c73 2c73 656c 662e  stk.n_cols,self.
+000546f0: 7374 6b2e 6e5f 726f 7773 2929 0d0a 0d0a  stk.n_rows))....
+00054700: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+00054710: 2072 616e 6765 2873 656c 662e 7374 6b2e   range(self.stk.
+00054720: 6e5f 636f 6c73 293a 0d0a 2020 2020 2020  n_cols):..      
+00054730: 2020 2020 2020 666f 7220 6a20 696e 2072        for j in r
+00054740: 616e 6765 2873 656c 662e 7374 6b2e 6e5f  ange(self.stk.n_
+00054750: 726f 7773 293a 0d0a 2020 2020 2020 2020  rows):..        
+00054760: 2020 2020 2020 2020 5069 6e73 6964 6520          Pinside 
+00054770: 3d20 7061 7468 2e63 6f6e 7461 696e 735f  = path.contains_
+00054780: 706f 696e 7428 2869 2c6a 2929 0d0a 2020  point((i,j))..  
+00054790: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000547a0: 2050 696e 7369 6465 203d 3d20 5472 7565   Pinside == True
+000547b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000547c0: 2020 2020 2020 2052 4f49 7069 785b 692c         ROIpix[i,
+000547d0: 2073 656c 662e 7374 6b2e 6e5f 726f 7773   self.stk.n_rows
+000547e0: 2d31 2d6a 5d20 3d20 3235 350d 0a0d 0a0d  -1-j] = 255.....
+000547f0: 0a0d 0a20 2020 2020 2020 2052 4f49 7069  ...        ROIpi
+00054800: 7820 3d20 6e70 2e6d 612e 6172 7261 7928  x = np.ma.array(
+00054810: 524f 4970 6978 290d 0a0d 0a20 2020 2020  ROIpix)....     
+00054820: 2020 2073 656c 662e 524f 4970 6978 5f6d     self.ROIpix_m
+00054830: 6173 6b65 6420 3d20 206e 702e 6d61 2e6d  asked =  np.ma.m
+00054840: 6173 6b65 645f 7661 6c75 6573 2852 4f49  asked_values(ROI
+00054850: 7069 782c 2030 290d 0a0d 0a20 2020 2020  pix, 0)....     
+00054860: 2020 2073 656c 662e 524f 4961 7272 6179     self.ROIarray
+00054870: 203d 2052 4f49 7069 785b 3a5d 0d0a 0d0a   = ROIpix[:]....
+00054880: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00054890: 686f 7752 4f49 6d61 736b 203d 2031 0d0a  howROImask = 1..
+000548a0: 2020 2020 2020 2020 7365 6c66 2e6c 696e          self.lin
+000548b0: 6520 3d20 4e6f 6e65 0d0a 2020 2020 2020  e = None..      
+000548c0: 2020 7365 6c66 2e70 7265 7669 6f75 735f    self.previous_
+000548d0: 706f 696e 7420 3d20 5b5d 0d0a 2020 2020  point = []..    
+000548e0: 2020 2020 7365 6c66 2e73 7461 7274 5f70      self.start_p
+000548f0: 6f69 6e74 203d 205b 5d0d 0a20 2020 2020  oint = []..     
+00054900: 2020 2073 656c 662e 656e 645f 706f 696e     self.end_poin
+00054910: 7420 3d20 5b5d 0d0a 2020 2020 2020 2020  t = []..        
+00054920: 7365 6c66 2e72 6f69 7864 6174 6120 3d20  self.roixdata = 
+00054930: 5b5d 0d0a 2020 2020 2020 2020 7365 6c66  []..        self
+00054940: 2e72 6f69 7964 6174 6120 3d20 5b5d 0d0a  .roiydata = []..
+00054950: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
+00054960: 7574 746f 6e5f 7361 7665 524f 4973 7065  utton_saveROIspe
+00054970: 6374 722e 7365 7445 6e61 626c 6564 2854  ctr.setEnabled(T
+00054980: 7275 6529 0d0a 2020 2020 2020 2020 7365  rue)..        se
+00054990: 6c66 2e62 7574 746f 6e5f 7365 7452 4f49  lf.button_setROI
+000549a0: 4930 2e73 6574 456e 6162 6c65 6428 5472  I0.setEnabled(Tr
+000549b0: 7565 290d 0a20 2020 2020 2020 2073 656c  ue)..        sel
+000549c0: 662e 6275 7474 6f6e 5f52 4f49 646f 7365  f.button_ROIdose
+000549d0: 6361 6c63 2e73 6574 456e 6162 6c65 6428  calc.setEnabled(
+000549e0: 5472 7565 290d 0a20 2020 2020 2020 2073  True)..        s
+000549f0: 656c 662e 7769 6e64 6f77 2829 2e72 6566  elf.window().ref
+00054a00: 7265 7368 5f77 6964 6765 7473 2829 0d0a  resh_widgets()..
+00054a10: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+00054a20: 6f61 6449 6d61 6765 2829 0d0a 2020 2020  oadImage()..    
+00054a30: 2020 2020 7365 6c66 2e73 686f 7753 7065      self.showSpe
+00054a40: 6374 7275 6d28 302c 2030 290d 0a0d 0a20  ctrum(0, 0).... 
+00054a50: 2020 2020 2020 2051 7457 6964 6765 7473         QtWidgets
+00054a60: 2e51 4170 706c 6963 6174 696f 6e2e 7265  .QApplication.re
+00054a70: 7374 6f72 654f 7665 7272 6964 6543 7572  storeOverrideCur
+00054a80: 736f 7228 290d 0a0d 0a0d 0a23 2d2d 2d2d  sor()......#----
+00054a90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054aa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054ab0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054ac0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00054ad0: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 6465  --------..    de
-00054ae0: 6620 4f6e 5265 7365 7452 4f49 2873 656c  f OnResetROI(sel
-00054af0: 662c 2065 7674 293a 0d0a 0d0a 2020 2020  f, evt):....    
-00054b00: 2020 2020 7365 6c66 2e52 6573 6574 524f      self.ResetRO
-00054b10: 4928 290d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d  I()....#--------
+00054ad0: 2d2d 0d0a 2020 2020 6465 6620 4f6e 5265  --..    def OnRe
+00054ae0: 7365 7452 4f49 2873 656c 662c 2065 7674  setROI(self, evt
+00054af0: 293a 0d0a 0d0a 2020 2020 2020 2020 7365  ):....        se
+00054b00: 6c66 2e52 6573 6574 524f 4928 290d 0a0d  lf.ResetROI()...
+00054b10: 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  .#--------------
 00054b20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054b30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054b40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00054b50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a  --------------..
-00054b60: 2020 2020 6465 6620 5265 7365 7452 4f49      def ResetROI
-00054b70: 2873 656c 6629 3a0d 0a0d 0a20 2020 2020  (self):....     
-00054b80: 2020 2073 656c 662e 6164 6472 6f69 203d     self.addroi =
-00054b90: 2030 0d0a 2020 2020 2020 2020 7365 6c66   0..        self
-00054ba0: 2e73 686f 7752 4f49 6d61 736b 203d 2030  .showROImask = 0
-00054bb0: 0d0a 2020 2020 2020 2020 7365 6c66 2e52  ..        self.R
-00054bc0: 4f49 7069 7820 3d20 4e6f 6e65 0d0a 0d0a  OIpix = None....
-00054bd0: 2020 2020 2020 2020 2373 656c 662e 6275          #self.bu
-00054be0: 7474 6f6e 5f61 6363 6570 7452 4f49 2e73  tton_acceptROI.s
-00054bf0: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
-00054c00: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
-00054c10: 7574 746f 6e5f 7365 7452 4f49 4930 2e73  utton_setROII0.s
-00054c20: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
-00054c30: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
-00054c40: 7574 746f 6e5f 7265 7365 7452 4f49 2e73  utton_resetROI.s
-00054c50: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
-00054c60: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
-00054c70: 7574 746f 6e5f 7361 7665 524f 4973 7065  utton_saveROIspe
-00054c80: 6374 722e 7365 7445 6e61 626c 6564 2846  ctr.setEnabled(F
-00054c90: 616c 7365 290d 0a20 2020 2020 2020 2073  alse)..        s
-00054ca0: 656c 662e 6275 7474 6f6e 5f52 4f49 646f  elf.button_ROIdo
-00054cb0: 7365 6361 6c63 2e73 6574 456e 6162 6c65  secalc.setEnable
-00054cc0: 6428 4661 6c73 6529 0d0a 2020 2020 2020  d(False)..      
-00054cd0: 2020 7365 6c66 2e63 6964 3120 3d20 7365    self.cid1 = se
-00054ce0: 6c66 2e41 6273 496d 6167 6550 616e 656c  lf.AbsImagePanel
-00054cf0: 2e6d 706c 5f63 6f6e 6e65 6374 2827 6275  .mpl_connect('bu
-00054d00: 7474 6f6e 5f70 7265 7373 5f65 7665 6e74  tton_press_event
-00054d10: 272c 2073 656c 662e 4f6e 506f 696e 7441  ', self.OnPointA
-00054d20: 6273 696d 6167 6529 0d0a 2020 2020 2020  bsimage)..      
-00054d30: 2020 7365 6c66 2e41 6273 496d 6167 6550    self.AbsImageP
-00054d40: 616e 656c 2e64 7261 7728 290d 0a20 2020  anel.draw()..   
-00054d50: 2020 2020 2073 656c 662e 7769 6e64 6f77       self.window
-00054d60: 2829 2e72 6566 7265 7368 5f77 6964 6765  ().refresh_widge
-00054d70: 7473 2829 0d0a 0d0a 2020 2020 2020 2020  ts()....        
-00054d80: 7365 6c66 2e6c 6f61 6449 6d61 6765 2829  self.loadImage()
-00054d90: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-00054da0: 686f 7753 7065 6374 7275 6d28 7365 6c66  howSpectrum(self
-00054db0: 2e69 782c 2073 656c 662e 6979 290d 0a0d  .ix, self.iy)...
-00054dc0: 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  .#--------------
+00054b50: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 6465  --------..    de
+00054b60: 6620 5265 7365 7452 4f49 2873 656c 6629  f ResetROI(self)
+00054b70: 3a0d 0a0d 0a20 2020 2020 2020 2073 656c  :....        sel
+00054b80: 662e 6164 6472 6f69 203d 2030 0d0a 2020  f.addroi = 0..  
+00054b90: 2020 2020 2020 7365 6c66 2e73 686f 7752        self.showR
+00054ba0: 4f49 6d61 736b 203d 2030 0d0a 2020 2020  OImask = 0..    
+00054bb0: 2020 2020 7365 6c66 2e52 4f49 7069 7820      self.ROIpix 
+00054bc0: 3d20 4e6f 6e65 0d0a 0d0a 2020 2020 2020  = None....      
+00054bd0: 2020 2373 656c 662e 6275 7474 6f6e 5f61    #self.button_a
+00054be0: 6363 6570 7452 4f49 2e73 6574 456e 6162  cceptROI.setEnab
+00054bf0: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
+00054c00: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+00054c10: 7365 7452 4f49 4930 2e73 6574 456e 6162  setROII0.setEnab
+00054c20: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
+00054c30: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+00054c40: 7265 7365 7452 4f49 2e73 6574 456e 6162  resetROI.setEnab
+00054c50: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
+00054c60: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+00054c70: 7361 7665 524f 4973 7065 6374 722e 7365  saveROIspectr.se
+00054c80: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
+00054c90: 0a20 2020 2020 2020 2073 656c 662e 6275  .        self.bu
+00054ca0: 7474 6f6e 5f52 4f49 646f 7365 6361 6c63  tton_ROIdosecalc
+00054cb0: 2e73 6574 456e 6162 6c65 6428 4661 6c73  .setEnabled(Fals
+00054cc0: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
+00054cd0: 2e63 6964 3120 3d20 7365 6c66 2e41 6273  .cid1 = self.Abs
+00054ce0: 496d 6167 6550 616e 656c 2e6d 706c 5f63  ImagePanel.mpl_c
+00054cf0: 6f6e 6e65 6374 2827 6275 7474 6f6e 5f70  onnect('button_p
+00054d00: 7265 7373 5f65 7665 6e74 272c 2073 656c  ress_event', sel
+00054d10: 662e 4f6e 506f 696e 7441 6273 696d 6167  f.OnPointAbsimag
+00054d20: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
+00054d30: 2e41 6273 496d 6167 6550 616e 656c 2e64  .AbsImagePanel.d
+00054d40: 7261 7728 290d 0a20 2020 2020 2020 2073  raw()..        s
+00054d50: 656c 662e 7769 6e64 6f77 2829 2e72 6566  elf.window().ref
+00054d60: 7265 7368 5f77 6964 6765 7473 2829 0d0a  resh_widgets()..
+00054d70: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+00054d80: 6f61 6449 6d61 6765 2829 0d0a 2020 2020  oadImage()..    
+00054d90: 2020 2020 7365 6c66 2e73 686f 7753 7065      self.showSpe
+00054da0: 6374 7275 6d28 7365 6c66 2e69 782c 2073  ctrum(self.ix, s
+00054db0: 656c 662e 6979 290d 0a0d 0a23 2d2d 2d2d  elf.iy)....#----
+00054dc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054dd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054de0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054df0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00054e00: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 6465  --------..    de
-00054e10: 6620 4361 6c63 524f 495f 4930 5370 6563  f CalcROI_I0Spec
-00054e20: 7472 756d 2873 656c 6629 3a0d 0a0d 0a20  trum(self):.... 
-00054e30: 2020 2020 2020 2073 656c 662e 524f 4973         self.ROIs
-00054e40: 7065 6374 7275 6d20 3d20 6e70 2e7a 6572  pectrum = np.zer
-00054e50: 6f73 2828 7365 6c66 2e73 746b 2e6e 5f65  os((self.stk.n_e
-00054e60: 7629 290d 0a0d 0a0d 0a20 2020 2020 2020  v))......       
-00054e70: 2069 6e64 6963 6573 203d 206e 702e 7768   indices = np.wh
-00054e80: 6572 6528 7365 6c66 2e52 4f49 6172 7261  ere(self.ROIarra
-00054e90: 7920 3d3d 2032 3535 290d 0a20 2020 2020  y == 255)..     
-00054ea0: 2020 206e 756d 726f 6970 6978 203d 2073     numroipix = s
-00054eb0: 656c 662e 524f 4961 7272 6179 5b69 6e64  elf.ROIarray[ind
-00054ec0: 6963 6573 5d2e 7368 6170 655b 305d 0d0a  ices].shape[0]..
-00054ed0: 0d0a 2020 2020 2020 2020 666f 7220 6965  ..        for ie
-00054ee0: 2069 6e20 7261 6e67 6528 7365 6c66 2e73   in range(self.s
-00054ef0: 746b 2e6e 5f65 7629 3a0d 0a20 2020 2020  tk.n_ev):..     
-00054f00: 2020 2020 2020 2074 6869 7365 6e67 5f61         thiseng_a
-00054f10: 6273 203d 2073 656c 662e 7374 6b2e 6162  bs = self.stk.ab
-00054f20: 7364 6174 615b 3a2c 3a2c 6965 5d0d 0a20  sdata[:,:,ie].. 
-00054f30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00054f40: 524f 4973 7065 6374 7275 6d5b 6965 5d20  ROIspectrum[ie] 
-00054f50: 3d20 6e70 2e73 756d 2874 6869 7365 6e67  = np.sum(thiseng
-00054f60: 5f61 6273 5b69 6e64 6963 6573 5d29 2f6e  _abs[indices])/n
-00054f70: 756d 726f 6970 6978 0d0a 0d0a 232d 2d2d  umroipix....#---
+00054e00: 2d2d 0d0a 2020 2020 6465 6620 4361 6c63  --..    def Calc
+00054e10: 524f 495f 4930 5370 6563 7472 756d 2873  ROI_I0Spectrum(s
+00054e20: 656c 6629 3a0d 0a0d 0a20 2020 2020 2020  elf):....       
+00054e30: 2073 656c 662e 524f 4973 7065 6374 7275   self.ROIspectru
+00054e40: 6d20 3d20 6e70 2e7a 6572 6f73 2828 7365  m = np.zeros((se
+00054e50: 6c66 2e73 746b 2e6e 5f65 7629 290d 0a0d  lf.stk.n_ev))...
+00054e60: 0a0d 0a20 2020 2020 2020 2069 6e64 6963  ...        indic
+00054e70: 6573 203d 206e 702e 7768 6572 6528 7365  es = np.where(se
+00054e80: 6c66 2e52 4f49 6172 7261 7920 3d3d 2032  lf.ROIarray == 2
+00054e90: 3535 290d 0a20 2020 2020 2020 206e 756d  55)..        num
+00054ea0: 726f 6970 6978 203d 2073 656c 662e 524f  roipix = self.RO
+00054eb0: 4961 7272 6179 5b69 6e64 6963 6573 5d2e  Iarray[indices].
+00054ec0: 7368 6170 655b 305d 0d0a 0d0a 2020 2020  shape[0]....    
+00054ed0: 2020 2020 666f 7220 6965 2069 6e20 7261      for ie in ra
+00054ee0: 6e67 6528 7365 6c66 2e73 746b 2e6e 5f65  nge(self.stk.n_e
+00054ef0: 7629 3a0d 0a20 2020 2020 2020 2020 2020  v):..           
+00054f00: 2074 6869 7365 6e67 5f61 6273 203d 2073   thiseng_abs = s
+00054f10: 656c 662e 7374 6b2e 6162 7364 6174 615b  elf.stk.absdata[
+00054f20: 3a2c 3a2c 6965 5d0d 0a20 2020 2020 2020  :,:,ie]..       
+00054f30: 2020 2020 2073 656c 662e 524f 4973 7065       self.ROIspe
+00054f40: 6374 7275 6d5b 6965 5d20 3d20 6e70 2e73  ctrum[ie] = np.s
+00054f50: 756d 2874 6869 7365 6e67 5f61 6273 5b69  um(thiseng_abs[i
+00054f60: 6e64 6963 6573 5d29 2f6e 756d 726f 6970  ndices])/numroip
+00054f70: 6978 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d  ix....#---------
 00054f80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054f90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00054fa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00054fb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00054fc0: 2d2d 2d0d 0a20 2020 2064 6566 204f 6e53  ---..    def OnS
-00054fd0: 6574 524f 4949 3028 7365 6c66 2c20 6576  etROII0(self, ev
-00054fe0: 7429 3a0d 0a20 2020 2020 2020 2073 656c  t):..        sel
-00054ff0: 662e 4361 6c63 524f 495f 4930 5370 6563  f.CalcROI_I0Spec
-00055000: 7472 756d 2829 0d0a 0d0a 2020 2020 2020  trum()....      
-00055010: 2020 7365 6c66 2e73 746b 2e73 6574 5f69    self.stk.set_i
-00055020: 3028 7365 6c66 2e52 4f49 7370 6563 7472  0(self.ROIspectr
-00055030: 756d 2c20 7365 6c66 2e73 746b 2e65 7629  um, self.stk.ev)
-00055040: 0d0a 0d0a 2020 2020 2020 2020 706c 6f74  ....        plot
-00055050: 203d 2050 6c6f 7446 7261 6d65 2873 656c   = PlotFrame(sel
-00055060: 662c 2073 656c 662e 7374 6b2e 6576 6930  f, self.stk.evi0
-00055070: 2c73 656c 662e 7374 6b2e 6930 6461 7461  ,self.stk.i0data
-00055080: 290d 0a20 2020 2020 2020 2070 6c6f 742e  )..        plot.
-00055090: 7368 6f77 2829 0d0a 0d0a 2020 2020 2020  show()....      
-000550a0: 2020 783d 7365 6c66 2e73 746b 2e6e 5f63    x=self.stk.n_c
-000550b0: 6f6c 730d 0a20 2020 2020 2020 2079 3d73  ols..        y=s
-000550c0: 656c 662e 7374 6b2e 6e5f 726f 7773 0d0a  elf.stk.n_rows..
-000550d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
-000550e0: 7820 3d20 696e 7428 782f 3229 0d0a 2020  x = int(x/2)..  
-000550f0: 2020 2020 2020 7365 6c66 2e69 7920 3d20        self.iy = 
-00055100: 696e 7428 792f 3229 0d0a 0d0a 2020 2020  int(y/2)....    
-00055110: 2020 2020 7365 6c66 2e63 6f6d 2e69 305f      self.com.i0_
-00055120: 6c6f 6164 6564 203d 2031 0d0a 0d0a 2020  loaded = 1....  
-00055130: 2020 2020 2020 7365 6c66 2e61 6464 726f        self.addro
-00055140: 6920 3d20 300d 0a20 2020 2020 2020 2073  i = 0..        s
-00055150: 656c 662e 7368 6f77 524f 496d 6173 6b20  elf.showROImask 
-00055160: 3d20 300d 0a20 2020 2020 2020 2073 656c  = 0..        sel
-00055170: 662e 524f 4970 6978 203d 204e 6f6e 650d  f.ROIpix = None.
-00055180: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00055190: 7368 6f77 5370 6563 7472 756d 2873 656c  showSpectrum(sel
-000551a0: 662e 6978 2c20 7365 6c66 2e69 7929 0d0a  f.ix, self.iy)..
-000551b0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
-000551c0: 6449 6d61 6765 2829 0d0a 0d0a 2020 2020  dImage()....    
-000551d0: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-000551e0: 6163 6365 7074 524f 492e 7365 7445 6e61  acceptROI.setEna
-000551f0: 626c 6564 2846 616c 7365 290d 0a20 2020  bled(False)..   
-00055200: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-00055210: 5f73 6574 524f 4949 302e 7365 7445 6e61  _setROII0.setEna
-00055220: 626c 6564 2846 616c 7365 290d 0a20 2020  bled(False)..   
-00055230: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-00055240: 5f72 6573 6574 524f 492e 7365 7445 6e61  _resetROI.setEna
-00055250: 626c 6564 2846 616c 7365 290d 0a20 2020  bled(False)..   
-00055260: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-00055270: 5f73 6176 6552 4f49 7370 6563 7472 2e73  _saveROIspectr.s
-00055280: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
-00055290: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
-000552a0: 7574 746f 6e5f 524f 4964 6f73 6563 616c  utton_ROIdosecal
-000552b0: 632e 7365 7445 6e61 626c 6564 2846 616c  c.setEnabled(Fal
-000552c0: 7365 290d 0a0d 0a20 2020 2020 2020 2073  se)....        s
-000552d0: 656c 662e 7769 6e64 6f77 2829 2e72 6566  elf.window().ref
-000552e0: 7265 7368 5f77 6964 6765 7473 2829 0d0a  resh_widgets()..
-000552f0: 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ..#-------------
+00054fb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20  -------------.. 
+00054fc0: 2020 2064 6566 204f 6e53 6574 524f 4949     def OnSetROII
+00054fd0: 3028 7365 6c66 2c20 6576 7429 3a0d 0a20  0(self, evt):.. 
+00054fe0: 2020 2020 2020 2073 656c 662e 4361 6c63         self.Calc
+00054ff0: 524f 495f 4930 5370 6563 7472 756d 2829  ROI_I0Spectrum()
+00055000: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00055010: 2e73 746b 2e73 6574 5f69 3028 7365 6c66  .stk.set_i0(self
+00055020: 2e52 4f49 7370 6563 7472 756d 2c20 7365  .ROIspectrum, se
+00055030: 6c66 2e73 746b 2e65 7629 0d0a 0d0a 2020  lf.stk.ev)....  
+00055040: 2020 2020 2020 706c 6f74 203d 2050 6c6f        plot = Plo
+00055050: 7446 7261 6d65 2873 656c 662c 2073 656c  tFrame(self, sel
+00055060: 662e 7374 6b2e 6576 6930 2c73 656c 662e  f.stk.evi0,self.
+00055070: 7374 6b2e 6930 6461 7461 290d 0a20 2020  stk.i0data)..   
+00055080: 2020 2020 2070 6c6f 742e 7368 6f77 2829       plot.show()
+00055090: 0d0a 0d0a 2020 2020 2020 2020 783d 7365  ....        x=se
+000550a0: 6c66 2e73 746b 2e6e 5f63 6f6c 730d 0a20  lf.stk.n_cols.. 
+000550b0: 2020 2020 2020 2079 3d73 656c 662e 7374         y=self.st
+000550c0: 6b2e 6e5f 726f 7773 0d0a 0d0a 2020 2020  k.n_rows....    
+000550d0: 2020 2020 7365 6c66 2e69 7820 3d20 696e      self.ix = in
+000550e0: 7428 782f 3229 0d0a 2020 2020 2020 2020  t(x/2)..        
+000550f0: 7365 6c66 2e69 7920 3d20 696e 7428 792f  self.iy = int(y/
+00055100: 3229 0d0a 0d0a 2020 2020 2020 2020 7365  2)....        se
+00055110: 6c66 2e63 6f6d 2e69 305f 6c6f 6164 6564  lf.com.i0_loaded
+00055120: 203d 2031 0d0a 0d0a 2020 2020 2020 2020   = 1....        
+00055130: 7365 6c66 2e61 6464 726f 6920 3d20 300d  self.addroi = 0.
+00055140: 0a20 2020 2020 2020 2073 656c 662e 7368  .        self.sh
+00055150: 6f77 524f 496d 6173 6b20 3d20 300d 0a20  owROImask = 0.. 
+00055160: 2020 2020 2020 2073 656c 662e 524f 4970         self.ROIp
+00055170: 6978 203d 204e 6f6e 650d 0a0d 0a20 2020  ix = None....   
+00055180: 2020 2020 2073 656c 662e 7368 6f77 5370       self.showSp
+00055190: 6563 7472 756d 2873 656c 662e 6978 2c20  ectrum(self.ix, 
+000551a0: 7365 6c66 2e69 7929 0d0a 2020 2020 2020  self.iy)..      
+000551b0: 2020 7365 6c66 2e6c 6f61 6449 6d61 6765    self.loadImage
+000551c0: 2829 0d0a 0d0a 2020 2020 2020 2020 7365  ()....        se
+000551d0: 6c66 2e62 7574 746f 6e5f 6163 6365 7074  lf.button_accept
+000551e0: 524f 492e 7365 7445 6e61 626c 6564 2846  ROI.setEnabled(F
+000551f0: 616c 7365 290d 0a20 2020 2020 2020 2073  alse)..        s
+00055200: 656c 662e 6275 7474 6f6e 5f73 6574 524f  elf.button_setRO
+00055210: 4949 302e 7365 7445 6e61 626c 6564 2846  II0.setEnabled(F
+00055220: 616c 7365 290d 0a20 2020 2020 2020 2073  alse)..        s
+00055230: 656c 662e 6275 7474 6f6e 5f72 6573 6574  elf.button_reset
+00055240: 524f 492e 7365 7445 6e61 626c 6564 2846  ROI.setEnabled(F
+00055250: 616c 7365 290d 0a20 2020 2020 2020 2073  alse)..        s
+00055260: 656c 662e 6275 7474 6f6e 5f73 6176 6552  elf.button_saveR
+00055270: 4f49 7370 6563 7472 2e73 6574 456e 6162  OIspectr.setEnab
+00055280: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
+00055290: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+000552a0: 524f 4964 6f73 6563 616c 632e 7365 7445  ROIdosecalc.setE
+000552b0: 6e61 626c 6564 2846 616c 7365 290d 0a0d  nabled(False)...
+000552c0: 0a20 2020 2020 2020 2073 656c 662e 7769  .        self.wi
+000552d0: 6e64 6f77 2829 2e72 6566 7265 7368 5f77  ndow().refresh_w
+000552e0: 6964 6765 7473 2829 0d0a 0d0a 232d 2d2d  idgets()....#---
+000552f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00055300: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00055310: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00055320: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00055330: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
-00055340: 6566 204f 6e52 4f49 5f44 6f73 6543 616c  ef OnROI_DoseCal
-00055350: 6328 7365 6c66 2c20 6576 656e 7429 3a0d  c(self, event):.
-00055360: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00055370: 4361 6c63 524f 4953 7065 6374 7275 6d28  CalcROISpectrum(
-00055380: 290d 0a0d 0a20 2020 2020 2020 2064 6f73  )....        dos
-00055390: 6577 696e 203d 2044 6f73 6543 616c 6375  ewin = DoseCalcu
-000553a0: 6c61 7469 6f6e 2873 656c 662c 2073 656c  lation(self, sel
-000553b0: 662e 7374 6b2c 2073 656c 662e 524f 4973  f.stk, self.ROIs
-000553c0: 7065 6374 7275 6d29 0d0a 2020 2020 2020  pectrum)..      
-000553d0: 2020 646f 7365 7769 6e2e 7368 6f77 2829    dosewin.show()
-000553e0: 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d  ......#---------
+00055330: 2d2d 2d0d 0a20 2020 2064 6566 204f 6e52  ---..    def OnR
+00055340: 4f49 5f44 6f73 6543 616c 6328 7365 6c66  OI_DoseCalc(self
+00055350: 2c20 6576 656e 7429 3a0d 0a0d 0a20 2020  , event):....   
+00055360: 2020 2020 2073 656c 662e 4361 6c63 524f       self.CalcRO
+00055370: 4953 7065 6374 7275 6d28 290d 0a0d 0a20  ISpectrum().... 
+00055380: 2020 2020 2020 2064 6f73 6577 696e 203d         dosewin =
+00055390: 2044 6f73 6543 616c 6375 6c61 7469 6f6e   DoseCalculation
+000553a0: 2873 656c 662c 2073 656c 662e 7374 6b2c  (self, self.stk,
+000553b0: 2073 656c 662e 524f 4973 7065 6374 7275   self.ROIspectru
+000553c0: 6d29 0d0a 2020 2020 2020 2020 646f 7365  m)..        dose
+000553d0: 7769 6e2e 7368 6f77 2829 0d0a 0d0a 0d0a  win.show()......
+000553e0: 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  #---------------
 000553f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00055400: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00055410: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00055420: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20  -------------.. 
-00055430: 2020 2064 6566 204f 6e53 6176 6552 4f49     def OnSaveROI
-00055440: 5370 6563 7472 756d 2873 656c 662c 2065  Spectrum(self, e
-00055450: 7665 6e74 293a 0d0a 0d0a 0d0a 0d0a 0d0a  vent):..........
-00055460: 2020 2020 2020 2020 7769 6c64 6361 7264          wildcard
-00055470: 203d 2022 4353 5620 6669 6c65 7320 282a   = "CSV files (*
-00055480: 2e63 7376 2922 0d0a 0d0a 2020 2020 2020  .csv)"....      
-00055490: 2020 6669 6c65 4e61 6d65 2c20 5f66 696c    fileName, _fil
-000554a0: 7465 7220 3d20 5174 5769 6467 6574 732e  ter = QtWidgets.
-000554b0: 5146 696c 6544 6961 6c6f 672e 6765 7453  QFileDialog.getS
-000554c0: 6176 6546 696c 654e 616d 6528 7365 6c66  aveFileName(self
-000554d0: 2c20 2753 6176 6520 524f 4920 5370 6563  , 'Save ROI Spec
-000554e0: 7472 756d 2028 2e63 7376 2927 2c20 2727  trum (.csv)', ''
-000554f0: 2c20 7769 6c64 6361 7264 290d 0a0d 0a20  , wildcard).... 
-00055500: 2020 2020 2020 2066 696c 654e 616d 6520         fileName 
-00055510: 3d20 7374 7228 6669 6c65 4e61 6d65 290d  = str(fileName).
-00055520: 0a20 2020 2020 2020 2069 6620 6669 6c65  .        if file
-00055530: 4e61 6d65 203d 3d20 2727 3a0d 0a20 2020  Name == '':..   
-00055540: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
-00055550: 0a0d 0a20 2020 2020 2020 2070 6174 682c  ...        path,
-00055560: 2065 7874 203d 206f 732e 7061 7468 2e73   ext = os.path.s
-00055570: 706c 6974 6578 7428 6669 6c65 4e61 6d65  plitext(fileName
-00055580: 290d 0a20 2020 2020 2020 2065 7874 203d  )..        ext =
-00055590: 2065 7874 5b31 3a5d 2e6c 6f77 6572 2829   ext[1:].lower()
-000555a0: 0d0a 0d0a 2020 2020 2020 2020 7472 793a  ....        try:
-000555b0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000555c0: 2028 7365 6c66 2e63 6f6d 2e69 305f 6c6f   (self.com.i0_lo
-000555d0: 6164 6564 203d 3d20 3129 3a0d 0a20 2020  aded == 1):..   
-000555e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000555f0: 662e 7374 6b2e 7772 6974 655f 6373 7628  f.stk.write_csv(
-00055600: 6669 6c65 4e61 6d65 2c20 7365 6c66 2e73  fileName, self.s
-00055610: 746b 2e65 762c 2073 656c 662e 524f 4973  tk.ev, self.ROIs
-00055620: 7065 6374 7275 6d2c 2063 6e61 6d65 3d27  pectrum, cname='
-00055630: 6672 6f6d 2052 4f49 2729 0d0a 2020 2020  from ROI')..    
-00055640: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00055650: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00055660: 656c 662e 4361 6c63 524f 495f 4930 5370  elf.CalcROI_I0Sp
-00055670: 6563 7472 756d 2829 0d0a 2020 2020 2020  ectrum()..      
-00055680: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-00055690: 746b 2e77 7269 7465 5f63 7376 2866 696c  tk.write_csv(fil
-000556a0: 654e 616d 652c 2073 656c 662e 7374 6b2e  eName, self.stk.
-000556b0: 6576 2c20 7365 6c66 2e52 4f49 7370 6563  ev, self.ROIspec
-000556c0: 7472 756d 2c20 636e 616d 653d 2766 726f  trum, cname='fro
-000556d0: 6d20 524f 4927 290d 0a0d 0a0d 0a20 2020  m ROI')......   
-000556e0: 2020 2020 2065 7863 6570 7420 494f 4572       except IOEr
-000556f0: 726f 7220 6173 2065 3a0d 0a20 2020 2020  ror as e:..     
-00055700: 2020 2020 2020 2069 6620 652e 7374 7265         if e.stre
-00055710: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-00055720: 2020 2020 2020 2065 7272 203d 2065 2e73         err = e.s
-00055730: 7472 6572 726f 720d 0a20 2020 2020 2020  trerror..       
-00055740: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00055750: 2020 2020 2020 2020 2020 2020 6572 7220              err 
-00055760: 3d20 650d 0a0d 0a20 2020 2020 2020 2020  = e....         
-00055770: 2020 2051 7447 7569 2e51 4d65 7373 6167     QtGui.QMessag
-00055780: 6542 6f78 2e77 6172 6e69 6e67 2873 656c  eBox.warning(sel
-00055790: 662c 2745 7272 6f72 272c 2743 6f75 6c64  f,'Error','Could
-000557a0: 206e 6f74 2073 6176 6520 6669 6c65 3a20   not save file: 
-000557b0: 2573 2720 2520 6572 7229 0d0a 0d0a 0d0a  %s' % err)......
-000557c0: 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  #---------------
+00055420: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6566  -------..    def
+00055430: 204f 6e53 6176 6552 4f49 5370 6563 7472   OnSaveROISpectr
+00055440: 756d 2873 656c 662c 2065 7665 6e74 293a  um(self, event):
+00055450: 0d0a 0d0a 0d0a 0d0a 0d0a 2020 2020 2020  ..........      
+00055460: 2020 7769 6c64 6361 7264 203d 2022 4353    wildcard = "CS
+00055470: 5620 6669 6c65 7320 282a 2e63 7376 2922  V files (*.csv)"
+00055480: 0d0a 0d0a 2020 2020 2020 2020 6669 6c65  ....        file
+00055490: 4e61 6d65 2c20 5f66 696c 7465 7220 3d20  Name, _filter = 
+000554a0: 5174 5769 6467 6574 732e 5146 696c 6544  QtWidgets.QFileD
+000554b0: 6961 6c6f 672e 6765 7453 6176 6546 696c  ialog.getSaveFil
+000554c0: 654e 616d 6528 7365 6c66 2c20 2753 6176  eName(self, 'Sav
+000554d0: 6520 524f 4920 5370 6563 7472 756d 2028  e ROI Spectrum (
+000554e0: 2e63 7376 2927 2c20 2727 2c20 7769 6c64  .csv)', '', wild
+000554f0: 6361 7264 290d 0a0d 0a20 2020 2020 2020  card)....       
+00055500: 2066 696c 654e 616d 6520 3d20 7374 7228   fileName = str(
+00055510: 6669 6c65 4e61 6d65 290d 0a20 2020 2020  fileName)..     
+00055520: 2020 2069 6620 6669 6c65 4e61 6d65 203d     if fileName =
+00055530: 3d20 2727 3a0d 0a20 2020 2020 2020 2020  = '':..         
+00055540: 2020 2072 6574 7572 6e0d 0a0d 0a20 2020     return....   
+00055550: 2020 2020 2070 6174 682c 2065 7874 203d       path, ext =
+00055560: 206f 732e 7061 7468 2e73 706c 6974 6578   os.path.splitex
+00055570: 7428 6669 6c65 4e61 6d65 290d 0a20 2020  t(fileName)..   
+00055580: 2020 2020 2065 7874 203d 2065 7874 5b31       ext = ext[1
+00055590: 3a5d 2e6c 6f77 6572 2829 0d0a 0d0a 2020  :].lower()....  
+000555a0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+000555b0: 2020 2020 2020 2020 6966 2028 7365 6c66          if (self
+000555c0: 2e63 6f6d 2e69 305f 6c6f 6164 6564 203d  .com.i0_loaded =
+000555d0: 3d20 3129 3a0d 0a20 2020 2020 2020 2020  = 1):..         
+000555e0: 2020 2020 2020 2073 656c 662e 7374 6b2e         self.stk.
+000555f0: 7772 6974 655f 6373 7628 6669 6c65 4e61  write_csv(fileNa
+00055600: 6d65 2c20 7365 6c66 2e73 746b 2e65 762c  me, self.stk.ev,
+00055610: 2073 656c 662e 524f 4973 7065 6374 7275   self.ROIspectru
+00055620: 6d2c 2063 6e61 6d65 3d27 6672 6f6d 2052  m, cname='from R
+00055630: 4f49 2729 0d0a 2020 2020 2020 2020 2020  OI')..          
+00055640: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00055650: 2020 2020 2020 2020 2073 656c 662e 4361           self.Ca
+00055660: 6c63 524f 495f 4930 5370 6563 7472 756d  lcROI_I0Spectrum
+00055670: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00055680: 2020 2020 7365 6c66 2e73 746b 2e77 7269      self.stk.wri
+00055690: 7465 5f63 7376 2866 696c 654e 616d 652c  te_csv(fileName,
+000556a0: 2073 656c 662e 7374 6b2e 6576 2c20 7365   self.stk.ev, se
+000556b0: 6c66 2e52 4f49 7370 6563 7472 756d 2c20  lf.ROIspectrum, 
+000556c0: 636e 616d 653d 2766 726f 6d20 524f 4927  cname='from ROI'
+000556d0: 290d 0a0d 0a0d 0a20 2020 2020 2020 2065  )......        e
+000556e0: 7863 6570 7420 494f 4572 726f 7220 6173  xcept IOError as
+000556f0: 2065 3a0d 0a20 2020 2020 2020 2020 2020   e:..           
+00055700: 2069 6620 652e 7374 7265 7272 6f72 3a0d   if e.strerror:.
+00055710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00055720: 2065 7272 203d 2065 2e73 7472 6572 726f   err = e.strerro
+00055730: 720d 0a20 2020 2020 2020 2020 2020 2065  r..            e
+00055740: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00055750: 2020 2020 2020 6572 7220 3d20 650d 0a0d        err = e...
+00055760: 0a20 2020 2020 2020 2020 2020 2051 7447  .            QtG
+00055770: 7569 2e51 4d65 7373 6167 6542 6f78 2e77  ui.QMessageBox.w
+00055780: 6172 6e69 6e67 2873 656c 662c 2745 7272  arning(self,'Err
+00055790: 6f72 272c 2743 6f75 6c64 206e 6f74 2073  or','Could not s
+000557a0: 6176 6520 6669 6c65 3a20 2573 2720 2520  ave file: %s' % 
+000557b0: 6572 7229 0d0a 0d0a 0d0a 232d 2d2d 2d2d  err)......#-----
+000557c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 000557d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 000557e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 000557f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00055800: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6566  -------..    def
-00055810: 204f 6e53 7065 6374 7261 6c52 4f49 2873   OnSpectralROI(s
-00055820: 656c 662c 2065 7674 293a 0d0a 2020 2020  elf, evt):..    
-00055830: 2020 2020 7370 6563 726f 6977 696e 203d      specroiwin =
-00055840: 2053 7065 6374 7261 6c52 4f49 2873 656c   SpectralROI(sel
-00055850: 662c 2073 656c 662e 636f 6d2c 2073 656c  f, self.com, sel
-00055860: 662e 7374 6b29 0d0a 2020 2020 2020 2020  f.stk)..        
-00055870: 7370 6563 726f 6977 696e 2e73 686f 7728  specroiwin.show(
-00055880: 290d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d  )....#----------
+00055800: 2d0d 0a20 2020 2064 6566 204f 6e53 7065  -..    def OnSpe
+00055810: 6374 7261 6c52 4f49 2873 656c 662c 2065  ctralROI(self, e
+00055820: 7674 293a 0d0a 2020 2020 2020 2020 7370  vt):..        sp
+00055830: 6563 726f 6977 696e 203d 2053 7065 6374  ecroiwin = Spect
+00055840: 7261 6c52 4f49 2873 656c 662c 2073 656c  ralROI(self, sel
+00055850: 662e 636f 6d2c 2073 656c 662e 7374 6b29  f.com, self.stk)
+00055860: 0d0a 2020 2020 2020 2020 7370 6563 726f  ..        specro
+00055870: 6977 696e 2e73 686f 7728 290d 0a0d 0a23  iwin.show()....#
+00055880: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00055890: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 000558a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 000558b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000558c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 636c  ------------..cl
-000558d0: 6173 7320 5361 7665 5769 6e50 3128 5174  ass SaveWinP1(Qt
-000558e0: 5769 6467 6574 732e 5144 6961 6c6f 6729  Widgets.QDialog)
-000558f0: 3a0d 0a0d 0a20 2020 2064 6566 205f 5f69  :....    def __i
-00055900: 6e69 745f 5f28 7365 6c66 2c20 7061 7265  nit__(self, pare
-00055910: 6e74 293a 0d0a 2020 2020 2020 2020 5174  nt):..        Qt
-00055920: 5769 6467 6574 732e 5157 6964 6765 742e  Widgets.QWidget.
-00055930: 5f5f 696e 6974 5f5f 2873 656c 662c 2070  __init__(self, p
-00055940: 6172 656e 7429 0d0a 0d0a 2020 2020 2020  arent)....      
-00055950: 2020 7365 6c66 2e70 6172 656e 7420 3d20    self.parent = 
-00055960: 7061 7265 6e74 0d0a 0d0a 0d0a 2020 2020  parent......    
-00055970: 2020 2020 7365 6c66 2e72 6573 697a 6528      self.resize(
-00055980: 3430 302c 2033 3030 290d 0a20 2020 2020  400, 300)..     
-00055990: 2020 2073 656c 662e 7365 7457 696e 646f     self.setWindo
-000559a0: 7754 6974 6c65 2827 5361 7665 2729 0d0a  wTitle('Save')..
-000559b0: 0d0a 2020 2020 2020 2020 7061 6c20 3d20  ..        pal = 
-000559c0: 5174 4775 692e 5150 616c 6574 7465 2829  QtGui.QPalette()
-000559d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-000559e0: 6574 4175 746f 4669 6c6c 4261 636b 6772  etAutoFillBackgr
-000559f0: 6f75 6e64 2854 7275 6529 0d0a 2020 2020  ound(True)..    
-00055a00: 2020 2020 7061 6c2e 7365 7443 6f6c 6f72      pal.setColor
-00055a10: 2851 7447 7569 2e51 5061 6c65 7474 652e  (QtGui.QPalette.
-00055a20: 5769 6e64 6f77 2c51 7447 7569 2e51 436f  Window,QtGui.QCo
-00055a30: 6c6f 7228 2777 6869 7465 2729 290d 0a20  lor('white')).. 
-00055a40: 2020 2020 2020 2073 656c 662e 7365 7450         self.setP
-00055a50: 616c 6574 7465 2870 616c 290d 0a0d 0a0d  alette(pal).....
-00055a60: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
-00055a70: 6d20 3d20 7365 6c66 2e70 6172 656e 742e  m = self.parent.
-00055a80: 636f 6d6d 6f6e 0d0a 0d0a 2020 2020 2020  common....      
-00055a90: 2020 7061 7468 2c20 6578 7420 3d20 6f73    path, ext = os
-00055aa0: 2e70 6174 682e 7370 6c69 7465 7874 2873  .path.splitext(s
-00055ab0: 656c 662e 636f 6d2e 6669 6c65 6e61 6d65  elf.com.filename
-00055ac0: 290d 0a20 2020 2020 2020 2065 7874 203d  )..        ext =
-00055ad0: 2065 7874 5b31 3a5d 2e6c 6f77 6572 2829   ext[1:].lower()
-00055ae0: 0d0a 2020 2020 2020 2020 7375 6666 6978  ..        suffix
-00055af0: 203d 2022 2e22 202b 2065 7874 0d0a 2020   = "." + ext..  
-00055b00: 2020 2020 2020 7061 7468 2c20 666e 203d        path, fn =
-00055b10: 206f 732e 7061 7468 2e73 706c 6974 2873   os.path.split(s
-00055b20: 656c 662e 636f 6d2e 6669 6c65 6e61 6d65  elf.com.filename
-00055b30: 290d 0a20 2020 2020 2020 2066 696c 656e  )..        filen
-00055b40: 616d 6520 3d20 666e 5b3a 2d6c 656e 2873  ame = fn[:-len(s
-00055b50: 7566 6669 7829 5d0d 0a0d 0a20 2020 2020  uffix)]....     
-00055b60: 2020 2073 656c 662e 7061 7468 203d 2073     self.path = s
-00055b70: 656c 662e 636f 6d2e 7061 7468 0d0a 2020  elf.com.path..  
-00055b80: 2020 2020 2020 7365 6c66 2e66 696c 656e        self.filen
-00055b90: 616d 6520 3d20 6669 6c65 6e61 6d65 0d0a  ame = filename..
-00055ba0: 0d0a 0d0a 2020 2020 2020 2020 7662 6f78  ....        vbox
-00055bb0: 746f 7020 3d20 5174 5769 6467 6574 732e  top = QtWidgets.
-00055bc0: 5156 426f 784c 6179 6f75 7428 290d 0a20  QVBoxLayout().. 
-00055bd0: 2020 2020 2020 2076 626f 7874 6f70 2e73         vboxtop.s
-00055be0: 6574 436f 6e74 656e 7473 4d61 7267 696e  etContentsMargin
-00055bf0: 7328 3230 2c32 302c 3230 2c32 3029 0d0a  s(20,20,20,20)..
-00055c00: 0d0a 2020 2020 2020 2020 6772 6964 746f  ..        gridto
-00055c10: 7020 3d20 5174 5769 6467 6574 732e 5147  p = QtWidgets.QG
-00055c20: 7269 644c 6179 6f75 7428 290d 0a20 2020  ridLayout()..   
-00055c30: 2020 2020 2067 7269 6474 6f70 2e73 6574       gridtop.set
-00055c40: 5665 7274 6963 616c 5370 6163 696e 6728  VerticalSpacing(
-00055c50: 3230 290d 0a0d 0a20 2020 2020 2020 2066  20)....        f
-00055c60: 6f6e 7462 203d 2051 7447 7569 2e51 466f  ontb = QtGui.QFo
-00055c70: 6e74 2829 0d0a 2020 2020 2020 2020 666f  nt()..        fo
-00055c80: 6e74 622e 7365 7442 6f6c 6428 5472 7565  ntb.setBold(True
-00055c90: 290d 0a0d 0a20 2020 2020 2020 2073 7431  )....        st1
-00055ca0: 203d 2051 7457 6964 6765 7473 2e51 4c61   = QtWidgets.QLa
-00055cb0: 6265 6c28 7365 6c66 290d 0a20 2020 2020  bel(self)..     
-00055cc0: 2020 2073 7431 2e73 6574 5465 7874 2827     st1.setText('
-00055cd0: 5361 7665 2729 0d0a 2020 2020 2020 2020  Save')..        
-00055ce0: 7374 312e 7365 7446 6f6e 7428 666f 6e74  st1.setFont(font
-00055cf0: 6229 0d0a 2020 2020 2020 2020 7374 3220  b)..        st2 
-00055d00: 3d20 5174 5769 6467 6574 732e 514c 6162  = QtWidgets.QLab
-00055d10: 656c 2873 656c 6629 0d0a 2020 2020 2020  el(self)..      
-00055d20: 2020 7374 322e 7365 7454 6578 7428 272e    st2.setText('.
-00055d30: 7064 6627 290d 0a20 2020 2020 2020 2073  pdf')..        s
-00055d40: 7432 2e73 6574 466f 6e74 2866 6f6e 7462  t2.setFont(fontb
-00055d50: 290d 0a20 2020 2020 2020 2073 7433 203d  )..        st3 =
-00055d60: 2051 7457 6964 6765 7473 2e51 4c61 6265   QtWidgets.QLabe
-00055d70: 6c28 7365 6c66 290d 0a20 2020 2020 2020  l(self)..       
-00055d80: 2073 7433 2e73 6574 5465 7874 2827 2e70   st3.setText('.p
-00055d90: 6e67 2729 0d0a 2020 2020 2020 2020 7374  ng')..        st
-00055da0: 332e 7365 7446 6f6e 7428 666f 6e74 6229  3.setFont(fontb)
-00055db0: 0d0a 2020 2020 2020 2020 7374 3420 3d20  ..        st4 = 
-00055dc0: 5174 5769 6467 6574 732e 514c 6162 656c  QtWidgets.QLabel
-00055dd0: 2873 656c 6629 0d0a 2020 2020 2020 2020  (self)..        
-00055de0: 7374 342e 7365 7454 6578 7428 272e 7376  st4.setText('.sv
-00055df0: 6727 290d 0a20 2020 2020 2020 2073 7434  g')..        st4
-00055e00: 2e73 6574 466f 6e74 2866 6f6e 7462 290d  .setFont(fontb).
-00055e10: 0a20 2020 2020 2020 2073 7439 203d 2051  .        st9 = Q
-00055e20: 7457 6964 6765 7473 2e51 4c61 6265 6c28  tWidgets.QLabel(
-00055e30: 7365 6c66 290d 0a20 2020 2020 2020 2073  self)..        s
-00055e40: 7439 2e73 6574 5465 7874 2827 2e74 6966  t9.setText('.tif
-00055e50: 2028 6461 7461 2927 290d 0a20 2020 2020   (data)')..     
-00055e60: 2020 2073 7439 2e73 6574 466f 6e74 2866     st9.setFont(f
-00055e70: 6f6e 7462 290d 0a20 2020 2020 2020 2073  ontb)..        s
-00055e80: 7435 203d 2051 7457 6964 6765 7473 2e51  t5 = QtWidgets.Q
-00055e90: 4c61 6265 6c28 7365 6c66 290d 0a20 2020  Label(self)..   
-00055ea0: 2020 2020 2073 7435 2e73 6574 5465 7874       st5.setText
-00055eb0: 2827 2e63 7376 2729 0d0a 2020 2020 2020  ('.csv')..      
-00055ec0: 2020 7374 352e 7365 7446 6f6e 7428 666f    st5.setFont(fo
-00055ed0: 6e74 6229 0d0a 0d0a 0d0a 2020 2020 2020  ntb)......      
-00055ee0: 2020 7374 3620 3d20 5174 5769 6467 6574    st6 = QtWidget
-00055ef0: 732e 514c 6162 656c 2873 656c 6629 0d0a  s.QLabel(self)..
-00055f00: 2020 2020 2020 2020 7374 362e 7365 7454          st6.setT
-00055f10: 6578 7428 275f 7370 6563 7472 756d 2729  ext('_spectrum')
-00055f20: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00055f30: 2e63 6231 3120 3d20 5174 5769 6467 6574  .cb11 = QtWidget
-00055f40: 732e 5143 6865 636b 426f 7828 2727 2c20  s.QCheckBox('', 
-00055f50: 7365 6c66 290d 0a20 2020 2020 2020 2073  self)..        s
-00055f60: 656c 662e 6362 3131 2e73 6574 4368 6563  elf.cb11.setChec
-00055f70: 6b65 6428 5472 7565 290d 0a0d 0a20 2020  ked(True)....   
-00055f80: 2020 2020 2073 656c 662e 6362 3132 203d       self.cb12 =
-00055f90: 2051 7457 6964 6765 7473 2e51 4368 6563   QtWidgets.QChec
-00055fa0: 6b42 6f78 2827 272c 2073 656c 6629 0d0a  kBox('', self)..
-00055fb0: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00055fc0: 6231 3320 3d20 5174 5769 6467 6574 732e  b13 = QtWidgets.
-00055fd0: 5143 6865 636b 426f 7828 2727 2c20 7365  QCheckBox('', se
-00055fe0: 6c66 290d 0a0d 0a20 2020 2020 2020 2073  lf)....        s
-00055ff0: 656c 662e 6362 3134 203d 2051 7457 6964  elf.cb14 = QtWid
-00056000: 6765 7473 2e51 4368 6563 6b42 6f78 2827  gets.QCheckBox('
-00056010: 272c 2073 656c 6629 0d0a 0d0a 2020 2020  ', self)....    
-00056020: 2020 2020 7374 3720 3d20 5174 5769 6467      st7 = QtWidg
-00056030: 6574 732e 514c 6162 656c 2873 656c 6629  ets.QLabel(self)
-00056040: 0d0a 2020 2020 2020 2020 7374 372e 7365  ..        st7.se
-00056050: 7454 6578 7428 275f 696d 6167 6527 290d  tText('_image').
-00056060: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00056070: 6362 3231 203d 2051 7457 6964 6765 7473  cb21 = QtWidgets
-00056080: 2e51 4368 6563 6b42 6f78 2827 272c 2073  .QCheckBox('', s
-00056090: 656c 6629 0d0a 2020 2020 2020 2020 7365  elf)..        se
-000560a0: 6c66 2e63 6232 312e 7365 7443 6865 636b  lf.cb21.setCheck
-000560b0: 6564 2854 7275 6529 0d0a 0d0a 2020 2020  ed(True)....    
-000560c0: 2020 2020 7365 6c66 2e63 6232 3220 3d20      self.cb22 = 
-000560d0: 5174 5769 6467 6574 732e 5143 6865 636b  QtWidgets.QCheck
-000560e0: 426f 7828 2727 2c20 7365 6c66 290d 0a0d  Box('', self)...
-000560f0: 0a20 2020 2020 2020 2073 656c 662e 6362  .        self.cb
-00056100: 3233 203d 2051 7457 6964 6765 7473 2e51  23 = QtWidgets.Q
-00056110: 4368 6563 6b42 6f78 2827 272c 2073 656c  CheckBox('', sel
-00056120: 6629 0d0a 0d0a 2020 2020 2020 2020 7365  f)....        se
-00056130: 6c66 2e63 6232 3420 3d20 5174 5769 6467  lf.cb24 = QtWidg
-00056140: 6574 732e 5143 6865 636b 426f 7828 2727  ets.QCheckBox(''
-00056150: 2c20 7365 6c66 290d 0a0d 0a20 2020 2020  , self)....     
-00056160: 2020 2073 7438 203d 2051 7457 6964 6765     st8 = QtWidge
-00056170: 7473 2e51 4c61 6265 6c28 7365 6c66 290d  ts.QLabel(self).
-00056180: 0a20 2020 2020 2020 2073 7438 2e73 6574  .        st8.set
-00056190: 5465 7874 2827 616c 6c20 696d 6167 6573  Text('all images
-000561a0: 2729 0d0a 0d0a 2020 2020 2020 2020 7365  ')....        se
-000561b0: 6c66 2e63 6233 3220 3d20 5174 5769 6467  lf.cb32 = QtWidg
-000561c0: 6574 732e 5143 6865 636b 426f 7828 2727  ets.QCheckBox(''
-000561d0: 2c20 7365 6c66 290d 0a0d 0a20 2020 2020  , self)....     
-000561e0: 2020 2073 656c 662e 6362 3334 203d 2051     self.cb34 = Q
-000561f0: 7457 6964 6765 7473 2e51 4368 6563 6b42  tWidgets.QCheckB
-00056200: 6f78 2827 272c 2073 656c 6629 0d0a 0d0a  ox('', self)....
-00056210: 0d0a 2020 2020 2020 2020 6772 6964 746f  ..        gridto
-00056220: 702e 6164 6457 6964 6765 7428 7374 312c  p.addWidget(st1,
-00056230: 2030 2c20 3029 0d0a 2020 2020 2020 2020   0, 0)..        
-00056240: 6772 6964 746f 702e 6164 6457 6964 6765  gridtop.addWidge
-00056250: 7428 7374 322c 2030 2c20 3129 0d0a 2020  t(st2, 0, 1)..  
-00056260: 2020 2020 2020 6772 6964 746f 702e 6164        gridtop.ad
-00056270: 6457 6964 6765 7428 7374 332c 2030 2c20  dWidget(st3, 0, 
-00056280: 3229 0d0a 2020 2020 2020 2020 6772 6964  2)..        grid
-00056290: 746f 702e 6164 6457 6964 6765 7428 7374  top.addWidget(st
-000562a0: 342c 2030 2c20 3329 0d0a 2020 2020 2020  4, 0, 3)..      
-000562b0: 2020 6772 6964 746f 702e 6164 6457 6964    gridtop.addWid
-000562c0: 6765 7428 7374 392c 2030 2c20 3529 0d0a  get(st9, 0, 5)..
-000562d0: 2020 2020 2020 2020 6772 6964 746f 702e          gridtop.
-000562e0: 6164 6457 6964 6765 7428 7374 352c 2030  addWidget(st5, 0
-000562f0: 2c20 3429 0d0a 0d0a 2020 2020 2020 2020  , 4)....        
-00056300: 6772 6964 746f 702e 6164 6457 6964 6765  gridtop.addWidge
-00056310: 7428 7374 362c 2031 2c20 3029 0d0a 2020  t(st6, 1, 0)..  
-00056320: 2020 2020 2020 6772 6964 746f 702e 6164        gridtop.ad
-00056330: 6457 6964 6765 7428 7365 6c66 2e63 6231  dWidget(self.cb1
-00056340: 312c 2031 2c20 3129 0d0a 2020 2020 2020  1, 1, 1)..      
-00056350: 2020 6772 6964 746f 702e 6164 6457 6964    gridtop.addWid
-00056360: 6765 7428 7365 6c66 2e63 6231 322c 2031  get(self.cb12, 1
-00056370: 2c20 3229 0d0a 2020 2020 2020 2020 6772  , 2)..        gr
-00056380: 6964 746f 702e 6164 6457 6964 6765 7428  idtop.addWidget(
-00056390: 7365 6c66 2e63 6231 332c 2031 2c20 3329  self.cb13, 1, 3)
-000563a0: 0d0a 2020 2020 2020 2020 6772 6964 746f  ..        gridto
-000563b0: 702e 6164 6457 6964 6765 7428 7365 6c66  p.addWidget(self
-000563c0: 2e63 6231 342c 2031 2c20 3429 0d0a 0d0a  .cb14, 1, 4)....
-000563d0: 2020 2020 2020 2020 6772 6964 746f 702e          gridtop.
-000563e0: 6164 6457 6964 6765 7428 7374 372c 2032  addWidget(st7, 2
-000563f0: 2c20 3029 0d0a 2020 2020 2020 2020 6772  , 0)..        gr
-00056400: 6964 746f 702e 6164 6457 6964 6765 7428  idtop.addWidget(
-00056410: 7365 6c66 2e63 6232 312c 2032 2c20 3129  self.cb21, 2, 1)
-00056420: 0d0a 2020 2020 2020 2020 6772 6964 746f  ..        gridto
-00056430: 702e 6164 6457 6964 6765 7428 7365 6c66  p.addWidget(self
-00056440: 2e63 6232 322c 2032 2c20 3229 0d0a 2020  .cb22, 2, 2)..  
-00056450: 2020 2020 2020 6772 6964 746f 702e 6164        gridtop.ad
-00056460: 6457 6964 6765 7428 7365 6c66 2e63 6232  dWidget(self.cb2
-00056470: 332c 2032 2c20 3329 0d0a 2020 2020 2020  3, 2, 3)..      
-00056480: 2020 6772 6964 746f 702e 6164 6457 6964    gridtop.addWid
-00056490: 6765 7428 7365 6c66 2e63 6232 342c 2032  get(self.cb24, 2
-000564a0: 2c20 3529 0d0a 0d0a 2020 2020 2020 2020  , 5)....        
-000564b0: 6772 6964 746f 702e 6164 6457 6964 6765  gridtop.addWidge
-000564c0: 7428 7374 382c 2033 2c20 3029 0d0a 2020  t(st8, 3, 0)..  
-000564d0: 2020 2020 2020 6772 6964 746f 702e 6164        gridtop.ad
-000564e0: 6457 6964 6765 7428 7365 6c66 2e63 6233  dWidget(self.cb3
-000564f0: 322c 2033 2c20 3229 0d0a 2020 2020 2020  2, 3, 2)..      
-00056500: 2020 6772 6964 746f 702e 6164 6457 6964    gridtop.addWid
-00056510: 6765 7428 7365 6c66 2e63 6233 342c 2033  get(self.cb34, 3
-00056520: 2c20 3529 0d0a 0d0a 2020 2020 2020 2020  , 5)....        
-00056530: 7662 6f78 746f 702e 6164 6453 7472 6574  vboxtop.addStret
-00056540: 6368 2830 2e35 290d 0a20 2020 2020 2020  ch(0.5)..       
-00056550: 2076 626f 7874 6f70 2e61 6464 4c61 796f   vboxtop.addLayo
-00056560: 7574 2867 7269 6474 6f70 290d 0a20 2020  ut(gridtop)..   
-00056570: 2020 2020 2076 626f 7874 6f70 2e61 6464       vboxtop.add
-00056580: 5374 7265 7463 6828 3129 0d0a 0d0a 0d0a  Stretch(1)......
-00056590: 2020 2020 2020 2020 6862 6f78 3020 3d20          hbox0 = 
-000565a0: 5174 5769 6467 6574 732e 5148 426f 784c  QtWidgets.QHBoxL
-000565b0: 6179 6f75 7428 290d 0a0d 0a20 2020 2020  ayout()....     
-000565c0: 2020 2073 7466 203d 2051 7457 6964 6765     stf = QtWidge
-000565d0: 7473 2e51 4c61 6265 6c28 7365 6c66 290d  ts.QLabel(self).
-000565e0: 0a20 2020 2020 2020 2073 7466 2e73 6574  .        stf.set
-000565f0: 5465 7874 2827 4669 6c65 6e61 6d65 3a5c  Text('Filename:\
-00056600: 7427 290d 0a20 2020 2020 2020 2073 656c  t')..        sel
-00056610: 662e 7463 5f73 6176 6566 6e20 3d20 5174  f.tc_savefn = Qt
-00056620: 5769 6467 6574 732e 514c 696e 6545 6469  Widgets.QLineEdi
-00056630: 7428 7365 6c66 290d 0a20 2020 2020 2020  t(self)..       
-00056640: 2073 656c 662e 7463 5f73 6176 6566 6e2e   self.tc_savefn.
-00056650: 7365 7454 6578 7428 7365 6c66 2e66 696c  setText(self.fil
-00056660: 656e 616d 6529 0d0a 0d0a 2020 2020 2020  ename)....      
-00056670: 2020 6862 6f78 302e 6164 6457 6964 6765    hbox0.addWidge
-00056680: 7428 7374 6629 0d0a 2020 2020 2020 2020  t(stf)..        
-00056690: 6862 6f78 302e 6164 6457 6964 6765 7428  hbox0.addWidget(
-000566a0: 7365 6c66 2e74 635f 7361 7665 666e 290d  self.tc_savefn).
-000566b0: 0a0d 0a20 2020 2020 2020 2068 626f 7831  ...        hbox1
-000566c0: 203d 2051 7457 6964 6765 7473 2e51 4842   = QtWidgets.QHB
-000566d0: 6f78 4c61 796f 7574 2829 0d0a 0d0a 2020  oxLayout()....  
-000566e0: 2020 2020 2020 7374 7020 3d20 5174 5769        stp = QtWi
-000566f0: 6467 6574 732e 514c 6162 656c 2873 656c  dgets.QLabel(sel
-00056700: 6629 0d0a 2020 2020 2020 2020 7374 702e  f)..        stp.
-00056710: 7365 7454 6578 7428 2750 6174 683a 2020  setText('Path:  
-00056720: 5c74 2729 0d0a 2020 2020 2020 2020 7365  \t')..        se
-00056730: 6c66 2e74 635f 7361 7665 7061 7468 203d  lf.tc_savepath =
-00056740: 2051 7457 6964 6765 7473 2e51 4c69 6e65   QtWidgets.QLine
-00056750: 4564 6974 2873 656c 6629 0d0a 2020 2020  Edit(self)..    
-00056760: 2020 2020 7365 6c66 2e74 635f 7361 7665      self.tc_save
-00056770: 7061 7468 2e73 6574 5265 6164 4f6e 6c79  path.setReadOnly
-00056780: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
-00056790: 7365 6c66 2e74 635f 7361 7665 7061 7468  self.tc_savepath
-000567a0: 2e73 6574 5465 7874 2873 656c 662e 7061  .setText(self.pa
-000567b0: 7468 290d 0a20 2020 2020 2020 2073 656c  th)..        sel
-000567c0: 662e 7463 5f73 6176 6570 6174 682e 7365  f.tc_savepath.se
-000567d0: 744d 696e 696d 756d 5769 6474 6828 3130  tMinimumWidth(10
-000567e0: 3029 0d0a 2020 2020 2020 2020 6862 6f78  0)..        hbox
-000567f0: 312e 6164 6457 6964 6765 7428 7374 7029  1.addWidget(stp)
-00056800: 0d0a 2020 2020 2020 2020 6862 6f78 312e  ..        hbox1.
-00056810: 6164 6457 6964 6765 7428 7365 6c66 2e74  addWidget(self.t
-00056820: 635f 7361 7665 7061 7468 290d 0a0d 0a20  c_savepath).... 
-00056830: 2020 2020 2020 2062 7574 746f 6e5f 7061         button_pa
-00056840: 7468 203d 2051 7457 6964 6765 7473 2e51  th = QtWidgets.Q
-00056850: 5075 7368 4275 7474 6f6e 2827 4272 6f77  PushButton('Brow
-00056860: 7365 2e2e 2e27 290d 0a20 2020 2020 2020  se...')..       
-00056870: 2062 7574 746f 6e5f 7061 7468 2e63 6c69   button_path.cli
-00056880: 636b 6564 2e63 6f6e 6e65 6374 2873 656c  cked.connect(sel
-00056890: 662e 4f6e 4272 6f77 7365 4469 7229 0d0a  f.OnBrowseDir)..
-000568a0: 2020 2020 2020 2020 6862 6f78 312e 6164          hbox1.ad
-000568b0: 6457 6964 6765 7428 6275 7474 6f6e 5f70  dWidget(button_p
-000568c0: 6174 6829 0d0a 0d0a 0d0a 2020 2020 2020  ath)......      
-000568d0: 2020 6862 6f78 3220 3d20 5174 5769 6467    hbox2 = QtWidg
-000568e0: 6574 732e 5148 426f 784c 6179 6f75 7428  ets.QHBoxLayout(
-000568f0: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
-00056900: 6e5f 7361 7665 203d 2051 7457 6964 6765  n_save = QtWidge
-00056910: 7473 2e51 5075 7368 4275 7474 6f6e 2827  ts.QPushButton('
-00056920: 5361 7665 2729 0d0a 2020 2020 2020 2020  Save')..        
-00056930: 6275 7474 6f6e 5f73 6176 652e 636c 6963  button_save.clic
-00056940: 6b65 642e 636f 6e6e 6563 7428 7365 6c66  ked.connect(self
-00056950: 2e4f 6e53 6176 6529 0d0a 2020 2020 2020  .OnSave)..      
-00056960: 2020 6862 6f78 322e 6164 6457 6964 6765    hbox2.addWidge
-00056970: 7428 6275 7474 6f6e 5f73 6176 6529 0d0a  t(button_save)..
-00056980: 0d0a 2020 2020 2020 2020 6275 7474 6f6e  ..        button
-00056990: 5f63 616e 6365 6c20 3d20 5174 5769 6467  _cancel = QtWidg
-000569a0: 6574 732e 5150 7573 6842 7574 746f 6e28  ets.QPushButton(
-000569b0: 2743 616e 6365 6c27 290d 0a20 2020 2020  'Cancel')..     
-000569c0: 2020 2062 7574 746f 6e5f 6361 6e63 656c     button_cancel
-000569d0: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
-000569e0: 2873 656c 662e 636c 6f73 6529 0d0a 2020  (self.close)..  
-000569f0: 2020 2020 2020 6862 6f78 322e 6164 6457        hbox2.addW
-00056a00: 6964 6765 7428 6275 7474 6f6e 5f63 616e  idget(button_can
-00056a10: 6365 6c29 0d0a 0d0a 2020 2020 2020 2020  cel)....        
-00056a20: 7662 6f78 746f 702e 6164 644c 6179 6f75  vboxtop.addLayou
-00056a30: 7428 6862 6f78 3029 0d0a 2020 2020 2020  t(hbox0)..      
-00056a40: 2020 7662 6f78 746f 702e 6164 644c 6179    vboxtop.addLay
-00056a50: 6f75 7428 6862 6f78 3129 0d0a 2020 2020  out(hbox1)..    
-00056a60: 2020 2020 7662 6f78 746f 702e 6164 6453      vboxtop.addS
-00056a70: 7472 6574 6368 2831 2e30 290d 0a20 2020  tretch(1.0)..   
-00056a80: 2020 2020 2076 626f 7874 6f70 2e61 6464       vboxtop.add
-00056a90: 4c61 796f 7574 2868 626f 7832 290d 0a0d  Layout(hbox2)...
-00056aa0: 0a0d 0a0d 0a20 2020 2020 2020 2073 656c  .....        sel
-00056ab0: 662e 7365 744c 6179 6f75 7428 7662 6f78  f.setLayout(vbox
-00056ac0: 746f 7029 0d0a 0d0a 232d 2d2d 2d2d 2d2d  top)....#-------
+000558c0: 2d2d 2d2d 2d2d 0d0a 636c 6173 7320 5361  ------..class Sa
+000558d0: 7665 5769 6e50 3128 5174 5769 6467 6574  veWinP1(QtWidget
+000558e0: 732e 5144 6961 6c6f 6729 3a0d 0a0d 0a20  s.QDialog):.... 
+000558f0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00055900: 7365 6c66 2c20 7061 7265 6e74 293a 0d0a  self, parent):..
+00055910: 2020 2020 2020 2020 5174 5769 6467 6574          QtWidget
+00055920: 732e 5157 6964 6765 742e 5f5f 696e 6974  s.QWidget.__init
+00055930: 5f5f 2873 656c 662c 2070 6172 656e 7429  __(self, parent)
+00055940: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00055950: 2e70 6172 656e 7420 3d20 7061 7265 6e74  .parent = parent
+00055960: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7365  ......        se
+00055970: 6c66 2e72 6573 697a 6528 3430 302c 2033  lf.resize(400, 3
+00055980: 3030 290d 0a20 2020 2020 2020 2073 656c  00)..        sel
+00055990: 662e 7365 7457 696e 646f 7754 6974 6c65  f.setWindowTitle
+000559a0: 2827 5361 7665 2729 0d0a 0d0a 2020 2020  ('Save')....    
+000559b0: 2020 2020 7061 6c20 3d20 5174 4775 692e      pal = QtGui.
+000559c0: 5150 616c 6574 7465 2829 0d0a 2020 2020  QPalette()..    
+000559d0: 2020 2020 7365 6c66 2e73 6574 4175 746f      self.setAuto
+000559e0: 4669 6c6c 4261 636b 6772 6f75 6e64 2854  FillBackground(T
+000559f0: 7275 6529 0d0a 2020 2020 2020 2020 7061  rue)..        pa
+00055a00: 6c2e 7365 7443 6f6c 6f72 2851 7447 7569  l.setColor(QtGui
+00055a10: 2e51 5061 6c65 7474 652e 5769 6e64 6f77  .QPalette.Window
+00055a20: 2c51 7447 7569 2e51 436f 6c6f 7228 2777  ,QtGui.QColor('w
+00055a30: 6869 7465 2729 290d 0a20 2020 2020 2020  hite'))..       
+00055a40: 2073 656c 662e 7365 7450 616c 6574 7465   self.setPalette
+00055a50: 2870 616c 290d 0a0d 0a0d 0a20 2020 2020  (pal)......     
+00055a60: 2020 2073 656c 662e 636f 6d20 3d20 7365     self.com = se
+00055a70: 6c66 2e70 6172 656e 742e 636f 6d6d 6f6e  lf.parent.common
+00055a80: 0d0a 0d0a 2020 2020 2020 2020 7061 7468  ....        path
+00055a90: 2c20 6578 7420 3d20 6f73 2e70 6174 682e  , ext = os.path.
+00055aa0: 7370 6c69 7465 7874 2873 656c 662e 636f  splitext(self.co
+00055ab0: 6d2e 6669 6c65 6e61 6d65 290d 0a20 2020  m.filename)..   
+00055ac0: 2020 2020 2065 7874 203d 2065 7874 5b31       ext = ext[1
+00055ad0: 3a5d 2e6c 6f77 6572 2829 0d0a 2020 2020  :].lower()..    
+00055ae0: 2020 2020 7375 6666 6978 203d 2022 2e22      suffix = "."
+00055af0: 202b 2065 7874 0d0a 2020 2020 2020 2020   + ext..        
+00055b00: 7061 7468 2c20 666e 203d 206f 732e 7061  path, fn = os.pa
+00055b10: 7468 2e73 706c 6974 2873 656c 662e 636f  th.split(self.co
+00055b20: 6d2e 6669 6c65 6e61 6d65 290d 0a20 2020  m.filename)..   
+00055b30: 2020 2020 2066 696c 656e 616d 6520 3d20       filename = 
+00055b40: 666e 5b3a 2d6c 656e 2873 7566 6669 7829  fn[:-len(suffix)
+00055b50: 5d0d 0a0d 0a20 2020 2020 2020 2073 656c  ]....        sel
+00055b60: 662e 7061 7468 203d 2073 656c 662e 636f  f.path = self.co
+00055b70: 6d2e 7061 7468 0d0a 2020 2020 2020 2020  m.path..        
+00055b80: 7365 6c66 2e66 696c 656e 616d 6520 3d20  self.filename = 
+00055b90: 6669 6c65 6e61 6d65 0d0a 0d0a 0d0a 2020  filename......  
+00055ba0: 2020 2020 2020 7662 6f78 746f 7020 3d20        vboxtop = 
+00055bb0: 5174 5769 6467 6574 732e 5156 426f 784c  QtWidgets.QVBoxL
+00055bc0: 6179 6f75 7428 290d 0a20 2020 2020 2020  ayout()..       
+00055bd0: 2076 626f 7874 6f70 2e73 6574 436f 6e74   vboxtop.setCont
+00055be0: 656e 7473 4d61 7267 696e 7328 3230 2c32  entsMargins(20,2
+00055bf0: 302c 3230 2c32 3029 0d0a 0d0a 2020 2020  0,20,20)....    
+00055c00: 2020 2020 6772 6964 746f 7020 3d20 5174      gridtop = Qt
+00055c10: 5769 6467 6574 732e 5147 7269 644c 6179  Widgets.QGridLay
+00055c20: 6f75 7428 290d 0a20 2020 2020 2020 2067  out()..        g
+00055c30: 7269 6474 6f70 2e73 6574 5665 7274 6963  ridtop.setVertic
+00055c40: 616c 5370 6163 696e 6728 3230 290d 0a0d  alSpacing(20)...
+00055c50: 0a20 2020 2020 2020 2066 6f6e 7462 203d  .        fontb =
+00055c60: 2051 7447 7569 2e51 466f 6e74 2829 0d0a   QtGui.QFont()..
+00055c70: 2020 2020 2020 2020 666f 6e74 622e 7365          fontb.se
+00055c80: 7442 6f6c 6428 5472 7565 290d 0a0d 0a20  tBold(True).... 
+00055c90: 2020 2020 2020 2073 7431 203d 2051 7457         st1 = QtW
+00055ca0: 6964 6765 7473 2e51 4c61 6265 6c28 7365  idgets.QLabel(se
+00055cb0: 6c66 290d 0a20 2020 2020 2020 2073 7431  lf)..        st1
+00055cc0: 2e73 6574 5465 7874 2827 5361 7665 2729  .setText('Save')
+00055cd0: 0d0a 2020 2020 2020 2020 7374 312e 7365  ..        st1.se
+00055ce0: 7446 6f6e 7428 666f 6e74 6229 0d0a 2020  tFont(fontb)..  
+00055cf0: 2020 2020 2020 7374 3220 3d20 5174 5769        st2 = QtWi
+00055d00: 6467 6574 732e 514c 6162 656c 2873 656c  dgets.QLabel(sel
+00055d10: 6629 0d0a 2020 2020 2020 2020 7374 322e  f)..        st2.
+00055d20: 7365 7454 6578 7428 272e 7064 6627 290d  setText('.pdf').
+00055d30: 0a20 2020 2020 2020 2073 7432 2e73 6574  .        st2.set
+00055d40: 466f 6e74 2866 6f6e 7462 290d 0a20 2020  Font(fontb)..   
+00055d50: 2020 2020 2073 7433 203d 2051 7457 6964       st3 = QtWid
+00055d60: 6765 7473 2e51 4c61 6265 6c28 7365 6c66  gets.QLabel(self
+00055d70: 290d 0a20 2020 2020 2020 2073 7433 2e73  )..        st3.s
+00055d80: 6574 5465 7874 2827 2e70 6e67 2729 0d0a  etText('.png')..
+00055d90: 2020 2020 2020 2020 7374 332e 7365 7446          st3.setF
+00055da0: 6f6e 7428 666f 6e74 6229 0d0a 2020 2020  ont(fontb)..    
+00055db0: 2020 2020 7374 3420 3d20 5174 5769 6467      st4 = QtWidg
+00055dc0: 6574 732e 514c 6162 656c 2873 656c 6629  ets.QLabel(self)
+00055dd0: 0d0a 2020 2020 2020 2020 7374 342e 7365  ..        st4.se
+00055de0: 7454 6578 7428 272e 7376 6727 290d 0a20  tText('.svg').. 
+00055df0: 2020 2020 2020 2073 7434 2e73 6574 466f         st4.setFo
+00055e00: 6e74 2866 6f6e 7462 290d 0a20 2020 2020  nt(fontb)..     
+00055e10: 2020 2073 7439 203d 2051 7457 6964 6765     st9 = QtWidge
+00055e20: 7473 2e51 4c61 6265 6c28 7365 6c66 290d  ts.QLabel(self).
+00055e30: 0a20 2020 2020 2020 2073 7439 2e73 6574  .        st9.set
+00055e40: 5465 7874 2827 2e74 6966 2028 6461 7461  Text('.tif (data
+00055e50: 2927 290d 0a20 2020 2020 2020 2073 7439  )')..        st9
+00055e60: 2e73 6574 466f 6e74 2866 6f6e 7462 290d  .setFont(fontb).
+00055e70: 0a20 2020 2020 2020 2073 7435 203d 2051  .        st5 = Q
+00055e80: 7457 6964 6765 7473 2e51 4c61 6265 6c28  tWidgets.QLabel(
+00055e90: 7365 6c66 290d 0a20 2020 2020 2020 2073  self)..        s
+00055ea0: 7435 2e73 6574 5465 7874 2827 2e63 7376  t5.setText('.csv
+00055eb0: 2729 0d0a 2020 2020 2020 2020 7374 352e  ')..        st5.
+00055ec0: 7365 7446 6f6e 7428 666f 6e74 6229 0d0a  setFont(fontb)..
+00055ed0: 0d0a 0d0a 2020 2020 2020 2020 7374 3620  ....        st6 
+00055ee0: 3d20 5174 5769 6467 6574 732e 514c 6162  = QtWidgets.QLab
+00055ef0: 656c 2873 656c 6629 0d0a 2020 2020 2020  el(self)..      
+00055f00: 2020 7374 362e 7365 7454 6578 7428 275f    st6.setText('_
+00055f10: 7370 6563 7472 756d 2729 0d0a 0d0a 2020  spectrum')....  
+00055f20: 2020 2020 2020 7365 6c66 2e63 6231 3120        self.cb11 
+00055f30: 3d20 5174 5769 6467 6574 732e 5143 6865  = QtWidgets.QChe
+00055f40: 636b 426f 7828 2727 2c20 7365 6c66 290d  ckBox('', self).
+00055f50: 0a20 2020 2020 2020 2073 656c 662e 6362  .        self.cb
+00055f60: 3131 2e73 6574 4368 6563 6b65 6428 5472  11.setChecked(Tr
+00055f70: 7565 290d 0a0d 0a20 2020 2020 2020 2073  ue)....        s
+00055f80: 656c 662e 6362 3132 203d 2051 7457 6964  elf.cb12 = QtWid
+00055f90: 6765 7473 2e51 4368 6563 6b42 6f78 2827  gets.QCheckBox('
+00055fa0: 272c 2073 656c 6629 0d0a 0d0a 2020 2020  ', self)....    
+00055fb0: 2020 2020 7365 6c66 2e63 6231 3320 3d20      self.cb13 = 
+00055fc0: 5174 5769 6467 6574 732e 5143 6865 636b  QtWidgets.QCheck
+00055fd0: 426f 7828 2727 2c20 7365 6c66 290d 0a0d  Box('', self)...
+00055fe0: 0a20 2020 2020 2020 2073 656c 662e 6362  .        self.cb
+00055ff0: 3134 203d 2051 7457 6964 6765 7473 2e51  14 = QtWidgets.Q
+00056000: 4368 6563 6b42 6f78 2827 272c 2073 656c  CheckBox('', sel
+00056010: 6629 0d0a 0d0a 2020 2020 2020 2020 7374  f)....        st
+00056020: 3720 3d20 5174 5769 6467 6574 732e 514c  7 = QtWidgets.QL
+00056030: 6162 656c 2873 656c 6629 0d0a 2020 2020  abel(self)..    
+00056040: 2020 2020 7374 372e 7365 7454 6578 7428      st7.setText(
+00056050: 275f 696d 6167 6527 290d 0a0d 0a20 2020  '_image')....   
+00056060: 2020 2020 2073 656c 662e 6362 3231 203d       self.cb21 =
+00056070: 2051 7457 6964 6765 7473 2e51 4368 6563   QtWidgets.QChec
+00056080: 6b42 6f78 2827 272c 2073 656c 6629 0d0a  kBox('', self)..
+00056090: 2020 2020 2020 2020 7365 6c66 2e63 6232          self.cb2
+000560a0: 312e 7365 7443 6865 636b 6564 2854 7275  1.setChecked(Tru
+000560b0: 6529 0d0a 0d0a 2020 2020 2020 2020 7365  e)....        se
+000560c0: 6c66 2e63 6232 3220 3d20 5174 5769 6467  lf.cb22 = QtWidg
+000560d0: 6574 732e 5143 6865 636b 426f 7828 2727  ets.QCheckBox(''
+000560e0: 2c20 7365 6c66 290d 0a0d 0a20 2020 2020  , self)....     
+000560f0: 2020 2073 656c 662e 6362 3233 203d 2051     self.cb23 = Q
+00056100: 7457 6964 6765 7473 2e51 4368 6563 6b42  tWidgets.QCheckB
+00056110: 6f78 2827 272c 2073 656c 6629 0d0a 0d0a  ox('', self)....
+00056120: 2020 2020 2020 2020 7365 6c66 2e63 6232          self.cb2
+00056130: 3420 3d20 5174 5769 6467 6574 732e 5143  4 = QtWidgets.QC
+00056140: 6865 636b 426f 7828 2727 2c20 7365 6c66  heckBox('', self
+00056150: 290d 0a0d 0a20 2020 2020 2020 2073 7438  )....        st8
+00056160: 203d 2051 7457 6964 6765 7473 2e51 4c61   = QtWidgets.QLa
+00056170: 6265 6c28 7365 6c66 290d 0a20 2020 2020  bel(self)..     
+00056180: 2020 2073 7438 2e73 6574 5465 7874 2827     st8.setText('
+00056190: 616c 6c20 696d 6167 6573 2729 0d0a 0d0a  all images')....
+000561a0: 2020 2020 2020 2020 7365 6c66 2e63 6233          self.cb3
+000561b0: 3220 3d20 5174 5769 6467 6574 732e 5143  2 = QtWidgets.QC
+000561c0: 6865 636b 426f 7828 2727 2c20 7365 6c66  heckBox('', self
+000561d0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+000561e0: 662e 6362 3334 203d 2051 7457 6964 6765  f.cb34 = QtWidge
+000561f0: 7473 2e51 4368 6563 6b42 6f78 2827 272c  ts.QCheckBox('',
+00056200: 2073 656c 6629 0d0a 0d0a 0d0a 2020 2020   self)......    
+00056210: 2020 2020 6772 6964 746f 702e 6164 6457      gridtop.addW
+00056220: 6964 6765 7428 7374 312c 2030 2c20 3029  idget(st1, 0, 0)
+00056230: 0d0a 2020 2020 2020 2020 6772 6964 746f  ..        gridto
+00056240: 702e 6164 6457 6964 6765 7428 7374 322c  p.addWidget(st2,
+00056250: 2030 2c20 3129 0d0a 2020 2020 2020 2020   0, 1)..        
+00056260: 6772 6964 746f 702e 6164 6457 6964 6765  gridtop.addWidge
+00056270: 7428 7374 332c 2030 2c20 3229 0d0a 2020  t(st3, 0, 2)..  
+00056280: 2020 2020 2020 6772 6964 746f 702e 6164        gridtop.ad
+00056290: 6457 6964 6765 7428 7374 342c 2030 2c20  dWidget(st4, 0, 
+000562a0: 3329 0d0a 2020 2020 2020 2020 6772 6964  3)..        grid
+000562b0: 746f 702e 6164 6457 6964 6765 7428 7374  top.addWidget(st
+000562c0: 392c 2030 2c20 3529 0d0a 2020 2020 2020  9, 0, 5)..      
+000562d0: 2020 6772 6964 746f 702e 6164 6457 6964    gridtop.addWid
+000562e0: 6765 7428 7374 352c 2030 2c20 3429 0d0a  get(st5, 0, 4)..
+000562f0: 0d0a 2020 2020 2020 2020 6772 6964 746f  ..        gridto
+00056300: 702e 6164 6457 6964 6765 7428 7374 362c  p.addWidget(st6,
+00056310: 2031 2c20 3029 0d0a 2020 2020 2020 2020   1, 0)..        
+00056320: 6772 6964 746f 702e 6164 6457 6964 6765  gridtop.addWidge
+00056330: 7428 7365 6c66 2e63 6231 312c 2031 2c20  t(self.cb11, 1, 
+00056340: 3129 0d0a 2020 2020 2020 2020 6772 6964  1)..        grid
+00056350: 746f 702e 6164 6457 6964 6765 7428 7365  top.addWidget(se
+00056360: 6c66 2e63 6231 322c 2031 2c20 3229 0d0a  lf.cb12, 1, 2)..
+00056370: 2020 2020 2020 2020 6772 6964 746f 702e          gridtop.
+00056380: 6164 6457 6964 6765 7428 7365 6c66 2e63  addWidget(self.c
+00056390: 6231 332c 2031 2c20 3329 0d0a 2020 2020  b13, 1, 3)..    
+000563a0: 2020 2020 6772 6964 746f 702e 6164 6457      gridtop.addW
+000563b0: 6964 6765 7428 7365 6c66 2e63 6231 342c  idget(self.cb14,
+000563c0: 2031 2c20 3429 0d0a 0d0a 2020 2020 2020   1, 4)....      
+000563d0: 2020 6772 6964 746f 702e 6164 6457 6964    gridtop.addWid
+000563e0: 6765 7428 7374 372c 2032 2c20 3029 0d0a  get(st7, 2, 0)..
+000563f0: 2020 2020 2020 2020 6772 6964 746f 702e          gridtop.
+00056400: 6164 6457 6964 6765 7428 7365 6c66 2e63  addWidget(self.c
+00056410: 6232 312c 2032 2c20 3129 0d0a 2020 2020  b21, 2, 1)..    
+00056420: 2020 2020 6772 6964 746f 702e 6164 6457      gridtop.addW
+00056430: 6964 6765 7428 7365 6c66 2e63 6232 322c  idget(self.cb22,
+00056440: 2032 2c20 3229 0d0a 2020 2020 2020 2020   2, 2)..        
+00056450: 6772 6964 746f 702e 6164 6457 6964 6765  gridtop.addWidge
+00056460: 7428 7365 6c66 2e63 6232 332c 2032 2c20  t(self.cb23, 2, 
+00056470: 3329 0d0a 2020 2020 2020 2020 6772 6964  3)..        grid
+00056480: 746f 702e 6164 6457 6964 6765 7428 7365  top.addWidget(se
+00056490: 6c66 2e63 6232 342c 2032 2c20 3529 0d0a  lf.cb24, 2, 5)..
+000564a0: 0d0a 2020 2020 2020 2020 6772 6964 746f  ..        gridto
+000564b0: 702e 6164 6457 6964 6765 7428 7374 382c  p.addWidget(st8,
+000564c0: 2033 2c20 3029 0d0a 2020 2020 2020 2020   3, 0)..        
+000564d0: 6772 6964 746f 702e 6164 6457 6964 6765  gridtop.addWidge
+000564e0: 7428 7365 6c66 2e63 6233 322c 2033 2c20  t(self.cb32, 3, 
+000564f0: 3229 0d0a 2020 2020 2020 2020 6772 6964  2)..        grid
+00056500: 746f 702e 6164 6457 6964 6765 7428 7365  top.addWidget(se
+00056510: 6c66 2e63 6233 342c 2033 2c20 3529 0d0a  lf.cb34, 3, 5)..
+00056520: 0d0a 2020 2020 2020 2020 7662 6f78 746f  ..        vboxto
+00056530: 702e 6164 6453 7472 6574 6368 2830 2e35  p.addStretch(0.5
+00056540: 290d 0a20 2020 2020 2020 2076 626f 7874  )..        vboxt
+00056550: 6f70 2e61 6464 4c61 796f 7574 2867 7269  op.addLayout(gri
+00056560: 6474 6f70 290d 0a20 2020 2020 2020 2076  dtop)..        v
+00056570: 626f 7874 6f70 2e61 6464 5374 7265 7463  boxtop.addStretc
+00056580: 6828 3129 0d0a 0d0a 0d0a 2020 2020 2020  h(1)......      
+00056590: 2020 6862 6f78 3020 3d20 5174 5769 6467    hbox0 = QtWidg
+000565a0: 6574 732e 5148 426f 784c 6179 6f75 7428  ets.QHBoxLayout(
+000565b0: 290d 0a0d 0a20 2020 2020 2020 2073 7466  )....        stf
+000565c0: 203d 2051 7457 6964 6765 7473 2e51 4c61   = QtWidgets.QLa
+000565d0: 6265 6c28 7365 6c66 290d 0a20 2020 2020  bel(self)..     
+000565e0: 2020 2073 7466 2e73 6574 5465 7874 2827     stf.setText('
+000565f0: 4669 6c65 6e61 6d65 3a5c 7427 290d 0a20  Filename:\t').. 
+00056600: 2020 2020 2020 2073 656c 662e 7463 5f73         self.tc_s
+00056610: 6176 6566 6e20 3d20 5174 5769 6467 6574  avefn = QtWidget
+00056620: 732e 514c 696e 6545 6469 7428 7365 6c66  s.QLineEdit(self
+00056630: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00056640: 7463 5f73 6176 6566 6e2e 7365 7454 6578  tc_savefn.setTex
+00056650: 7428 7365 6c66 2e66 696c 656e 616d 6529  t(self.filename)
+00056660: 0d0a 0d0a 2020 2020 2020 2020 6862 6f78  ....        hbox
+00056670: 302e 6164 6457 6964 6765 7428 7374 6629  0.addWidget(stf)
+00056680: 0d0a 2020 2020 2020 2020 6862 6f78 302e  ..        hbox0.
+00056690: 6164 6457 6964 6765 7428 7365 6c66 2e74  addWidget(self.t
+000566a0: 635f 7361 7665 666e 290d 0a0d 0a20 2020  c_savefn)....   
+000566b0: 2020 2020 2068 626f 7831 203d 2051 7457       hbox1 = QtW
+000566c0: 6964 6765 7473 2e51 4842 6f78 4c61 796f  idgets.QHBoxLayo
+000566d0: 7574 2829 0d0a 0d0a 2020 2020 2020 2020  ut()....        
+000566e0: 7374 7020 3d20 5174 5769 6467 6574 732e  stp = QtWidgets.
+000566f0: 514c 6162 656c 2873 656c 6629 0d0a 2020  QLabel(self)..  
+00056700: 2020 2020 2020 7374 702e 7365 7454 6578        stp.setTex
+00056710: 7428 2750 6174 683a 2020 5c74 2729 0d0a  t('Path:  \t')..
+00056720: 2020 2020 2020 2020 7365 6c66 2e74 635f          self.tc_
+00056730: 7361 7665 7061 7468 203d 2051 7457 6964  savepath = QtWid
+00056740: 6765 7473 2e51 4c69 6e65 4564 6974 2873  gets.QLineEdit(s
+00056750: 656c 6629 0d0a 2020 2020 2020 2020 7365  elf)..        se
+00056760: 6c66 2e74 635f 7361 7665 7061 7468 2e73  lf.tc_savepath.s
+00056770: 6574 5265 6164 4f6e 6c79 2854 7275 6529  etReadOnly(True)
+00056780: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
+00056790: 635f 7361 7665 7061 7468 2e73 6574 5465  c_savepath.setTe
+000567a0: 7874 2873 656c 662e 7061 7468 290d 0a20  xt(self.path).. 
+000567b0: 2020 2020 2020 2073 656c 662e 7463 5f73         self.tc_s
+000567c0: 6176 6570 6174 682e 7365 744d 696e 696d  avepath.setMinim
+000567d0: 756d 5769 6474 6828 3130 3029 0d0a 2020  umWidth(100)..  
+000567e0: 2020 2020 2020 6862 6f78 312e 6164 6457        hbox1.addW
+000567f0: 6964 6765 7428 7374 7029 0d0a 2020 2020  idget(stp)..    
+00056800: 2020 2020 6862 6f78 312e 6164 6457 6964      hbox1.addWid
+00056810: 6765 7428 7365 6c66 2e74 635f 7361 7665  get(self.tc_save
+00056820: 7061 7468 290d 0a0d 0a20 2020 2020 2020  path)....       
+00056830: 2062 7574 746f 6e5f 7061 7468 203d 2051   button_path = Q
+00056840: 7457 6964 6765 7473 2e51 5075 7368 4275  tWidgets.QPushBu
+00056850: 7474 6f6e 2827 4272 6f77 7365 2e2e 2e27  tton('Browse...'
+00056860: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
+00056870: 6e5f 7061 7468 2e63 6c69 636b 6564 2e63  n_path.clicked.c
+00056880: 6f6e 6e65 6374 2873 656c 662e 4f6e 4272  onnect(self.OnBr
+00056890: 6f77 7365 4469 7229 0d0a 2020 2020 2020  owseDir)..      
+000568a0: 2020 6862 6f78 312e 6164 6457 6964 6765    hbox1.addWidge
+000568b0: 7428 6275 7474 6f6e 5f70 6174 6829 0d0a  t(button_path)..
+000568c0: 0d0a 0d0a 2020 2020 2020 2020 6862 6f78  ....        hbox
+000568d0: 3220 3d20 5174 5769 6467 6574 732e 5148  2 = QtWidgets.QH
+000568e0: 426f 784c 6179 6f75 7428 290d 0a20 2020  BoxLayout()..   
+000568f0: 2020 2020 2062 7574 746f 6e5f 7361 7665       button_save
+00056900: 203d 2051 7457 6964 6765 7473 2e51 5075   = QtWidgets.QPu
+00056910: 7368 4275 7474 6f6e 2827 5361 7665 2729  shButton('Save')
+00056920: 0d0a 2020 2020 2020 2020 6275 7474 6f6e  ..        button
+00056930: 5f73 6176 652e 636c 6963 6b65 642e 636f  _save.clicked.co
+00056940: 6e6e 6563 7428 7365 6c66 2e4f 6e53 6176  nnect(self.OnSav
+00056950: 6529 0d0a 2020 2020 2020 2020 6862 6f78  e)..        hbox
+00056960: 322e 6164 6457 6964 6765 7428 6275 7474  2.addWidget(butt
+00056970: 6f6e 5f73 6176 6529 0d0a 0d0a 2020 2020  on_save)....    
+00056980: 2020 2020 6275 7474 6f6e 5f63 616e 6365      button_cance
+00056990: 6c20 3d20 5174 5769 6467 6574 732e 5150  l = QtWidgets.QP
+000569a0: 7573 6842 7574 746f 6e28 2743 616e 6365  ushButton('Cance
+000569b0: 6c27 290d 0a20 2020 2020 2020 2062 7574  l')..        but
+000569c0: 746f 6e5f 6361 6e63 656c 2e63 6c69 636b  ton_cancel.click
+000569d0: 6564 2e63 6f6e 6e65 6374 2873 656c 662e  ed.connect(self.
+000569e0: 636c 6f73 6529 0d0a 2020 2020 2020 2020  close)..        
+000569f0: 6862 6f78 322e 6164 6457 6964 6765 7428  hbox2.addWidget(
+00056a00: 6275 7474 6f6e 5f63 616e 6365 6c29 0d0a  button_cancel)..
+00056a10: 0d0a 2020 2020 2020 2020 7662 6f78 746f  ..        vboxto
+00056a20: 702e 6164 644c 6179 6f75 7428 6862 6f78  p.addLayout(hbox
+00056a30: 3029 0d0a 2020 2020 2020 2020 7662 6f78  0)..        vbox
+00056a40: 746f 702e 6164 644c 6179 6f75 7428 6862  top.addLayout(hb
+00056a50: 6f78 3129 0d0a 2020 2020 2020 2020 7662  ox1)..        vb
+00056a60: 6f78 746f 702e 6164 6453 7472 6574 6368  oxtop.addStretch
+00056a70: 2831 2e30 290d 0a20 2020 2020 2020 2076  (1.0)..        v
+00056a80: 626f 7874 6f70 2e61 6464 4c61 796f 7574  boxtop.addLayout
+00056a90: 2868 626f 7832 290d 0a0d 0a0d 0a0d 0a20  (hbox2)........ 
+00056aa0: 2020 2020 2020 2073 656c 662e 7365 744c         self.setL
+00056ab0: 6179 6f75 7428 7662 6f78 746f 7029 0d0a  ayout(vboxtop)..
+00056ac0: 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ..#-------------
 00056ad0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00056ae0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00056af0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00056b00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
-00056b10: 0a20 2020 2064 6566 204f 6e42 726f 7773  .    def OnBrows
-00056b20: 6544 6972 2873 656c 662c 2065 7674 293a  eDir(self, evt):
-00056b30: 0d0a 0d0a 2020 2020 2020 2020 6469 7265  ....        dire
-00056b40: 6374 6f72 7920 3d20 5174 5769 6467 6574  ctory = QtWidget
-00056b50: 732e 5146 696c 6544 6961 6c6f 672e 6765  s.QFileDialog.ge
-00056b60: 7445 7869 7374 696e 6744 6972 6563 746f  tExistingDirecto
-00056b70: 7279 2873 656c 662c 2022 4368 6f6f 7365  ry(self, "Choose
-00056b80: 2061 2064 6972 6563 746f 7279 222c 2073   a directory", s
-00056b90: 656c 662e 7061 7468 2c20 5174 5769 6467  elf.path, QtWidg
-00056ba0: 6574 732e 5146 696c 6544 6961 6c6f 672e  ets.QFileDialog.
-00056bb0: 5368 6f77 4469 7273 4f6e 6c79 7c51 7457  ShowDirsOnly|QtW
-00056bc0: 6964 6765 7473 2e51 4669 6c65 4469 616c  idgets.QFileDial
-00056bd0: 6f67 2e52 6561 644f 6e6c 7929 0d0a 0d0a  og.ReadOnly)....
-00056be0: 0d0a 0d0a 2020 2020 2020 2020 6966 2064  ....        if d
-00056bf0: 6972 6563 746f 7279 203d 3d20 2727 3a0d  irectory == '':.
-00056c00: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00056c10: 7572 6e0d 0a0d 0a20 2020 2020 2020 2064  urn....        d
-00056c20: 6972 6563 746f 7279 203d 2073 7472 2864  irectory = str(d
-00056c30: 6972 6563 746f 7279 290d 0a20 2020 2020  irectory)..     
-00056c40: 2020 2073 656c 662e 636f 6d2e 7061 7468     self.com.path
-00056c50: 203d 2064 6972 6563 746f 7279 0d0a 0d0a   = directory....
-00056c60: 2020 2020 2020 2020 7365 6c66 2e70 6174          self.pat
-00056c70: 6820 3d20 6469 7265 6374 6f72 790d 0a0d  h = directory...
-00056c80: 0a20 2020 2020 2020 2073 656c 662e 7463  .        self.tc
-00056c90: 5f73 6176 6570 6174 682e 7365 7454 6578  _savepath.setTex
-00056ca0: 7428 7365 6c66 2e70 6174 6829 0d0a 0d0a  t(self.path)....
-00056cb0: 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d  ....#-----------
+00056b00: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
+00056b10: 6566 204f 6e42 726f 7773 6544 6972 2873  ef OnBrowseDir(s
+00056b20: 656c 662c 2065 7674 293a 0d0a 0d0a 2020  elf, evt):....  
+00056b30: 2020 2020 2020 6469 7265 6374 6f72 7920        directory 
+00056b40: 3d20 5174 5769 6467 6574 732e 5146 696c  = QtWidgets.QFil
+00056b50: 6544 6961 6c6f 672e 6765 7445 7869 7374  eDialog.getExist
+00056b60: 696e 6744 6972 6563 746f 7279 2873 656c  ingDirectory(sel
+00056b70: 662c 2022 4368 6f6f 7365 2061 2064 6972  f, "Choose a dir
+00056b80: 6563 746f 7279 222c 2073 656c 662e 7061  ectory", self.pa
+00056b90: 7468 2c20 5174 5769 6467 6574 732e 5146  th, QtWidgets.QF
+00056ba0: 696c 6544 6961 6c6f 672e 5368 6f77 4469  ileDialog.ShowDi
+00056bb0: 7273 4f6e 6c79 7c51 7457 6964 6765 7473  rsOnly|QtWidgets
+00056bc0: 2e51 4669 6c65 4469 616c 6f67 2e52 6561  .QFileDialog.Rea
+00056bd0: 644f 6e6c 7929 0d0a 0d0a 0d0a 0d0a 2020  dOnly)........  
+00056be0: 2020 2020 2020 6966 2064 6972 6563 746f        if directo
+00056bf0: 7279 203d 3d20 2727 3a0d 0a20 2020 2020  ry == '':..     
+00056c00: 2020 2020 2020 2072 6574 7572 6e0d 0a0d         return...
+00056c10: 0a20 2020 2020 2020 2064 6972 6563 746f  .        directo
+00056c20: 7279 203d 2073 7472 2864 6972 6563 746f  ry = str(directo
+00056c30: 7279 290d 0a20 2020 2020 2020 2073 656c  ry)..        sel
+00056c40: 662e 636f 6d2e 7061 7468 203d 2064 6972  f.com.path = dir
+00056c50: 6563 746f 7279 0d0a 0d0a 2020 2020 2020  ectory....      
+00056c60: 2020 7365 6c66 2e70 6174 6820 3d20 6469    self.path = di
+00056c70: 7265 6374 6f72 790d 0a0d 0a20 2020 2020  rectory....     
+00056c80: 2020 2073 656c 662e 7463 5f73 6176 6570     self.tc_savep
+00056c90: 6174 682e 7365 7454 6578 7428 7365 6c66  ath.setText(self
+00056ca0: 2e70 6174 6829 0d0a 0d0a 0d0a 0d0a 232d  .path)........#-
+00056cb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00056cc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00056cd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00056ce0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00056cf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020  -----------..   
-00056d00: 2064 6566 204f 6e53 6176 6528 7365 6c66   def OnSave(self
-00056d10: 2c20 6576 7429 3a0d 0a0d 0a20 2020 2020  , evt):....     
-00056d20: 2020 2073 656c 662e 6669 6c65 6e61 6d65     self.filename
-00056d30: 203d 2073 7472 2873 656c 662e 7463 5f73   = str(self.tc_s
-00056d40: 6176 6566 6e2e 7465 7874 2829 290d 0a0d  avefn.text())...
-00056d50: 0a20 2020 2020 2020 2073 705f 7064 6620  .        sp_pdf 
-00056d60: 3d20 7365 6c66 2e63 6231 312e 6973 4368  = self.cb11.isCh
-00056d70: 6563 6b65 6428 290d 0a20 2020 2020 2020  ecked()..       
-00056d80: 2073 705f 706e 6720 3d20 7365 6c66 2e63   sp_png = self.c
-00056d90: 6231 322e 6973 4368 6563 6b65 6428 290d  b12.isChecked().
-00056da0: 0a20 2020 2020 2020 2073 705f 7376 6720  .        sp_svg 
-00056db0: 3d20 7365 6c66 2e63 6231 332e 6973 4368  = self.cb13.isCh
-00056dc0: 6563 6b65 6428 290d 0a20 2020 2020 2020  ecked()..       
-00056dd0: 2073 705f 6373 7620 3d20 7365 6c66 2e63   sp_csv = self.c
-00056de0: 6231 342e 6973 4368 6563 6b65 6428 290d  b14.isChecked().
-00056df0: 0a20 2020 2020 2020 2069 6d5f 7064 6620  .        im_pdf 
-00056e00: 3d20 7365 6c66 2e63 6232 312e 6973 4368  = self.cb21.isCh
-00056e10: 6563 6b65 6428 290d 0a20 2020 2020 2020  ecked()..       
-00056e20: 2069 6d5f 706e 6720 3d20 7365 6c66 2e63   im_png = self.c
-00056e30: 6232 322e 6973 4368 6563 6b65 6428 290d  b22.isChecked().
-00056e40: 0a20 2020 2020 2020 2069 6d5f 7376 6720  .        im_svg 
-00056e50: 3d20 7365 6c66 2e63 6232 332e 6973 4368  = self.cb23.isCh
-00056e60: 6563 6b65 6428 290d 0a20 2020 2020 2020  ecked()..       
-00056e70: 2069 6d5f 7469 6620 3d20 7365 6c66 2e63   im_tif = self.c
-00056e80: 6232 342e 6973 4368 6563 6b65 6428 290d  b24.isChecked().
-00056e90: 0a20 2020 2020 2020 2069 6d5f 616c 6c20  .        im_all 
-00056ea0: 3d20 7365 6c66 2e63 6233 322e 6973 4368  = self.cb32.isCh
-00056eb0: 6563 6b65 6428 290d 0a20 2020 2020 2020  ecked()..       
-00056ec0: 2069 6d5f 616c 6c5f 7469 6620 3d20 7365   im_all_tif = se
-00056ed0: 6c66 2e63 6233 342e 6973 4368 6563 6b65  lf.cb34.isChecke
-00056ee0: 6428 290d 0a0d 0a20 2020 2020 2020 2073  d()....        s
-00056ef0: 656c 662e 636c 6f73 6528 290d 0a20 2020  elf.close()..   
-00056f00: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
-00056f10: 2e70 6167 6531 2e53 6176 6528 7365 6c66  .page1.Save(self
-00056f20: 2e66 696c 656e 616d 652c 2073 656c 662e  .filename, self.
-00056f30: 7061 7468 2c0d 0a20 2020 2020 2020 2020  path,..         
+00056cf0: 2d2d 2d2d 2d0d 0a20 2020 2064 6566 204f  -----..    def O
+00056d00: 6e53 6176 6528 7365 6c66 2c20 6576 7429  nSave(self, evt)
+00056d10: 3a0d 0a0d 0a20 2020 2020 2020 2073 656c  :....        sel
+00056d20: 662e 6669 6c65 6e61 6d65 203d 2073 7472  f.filename = str
+00056d30: 2873 656c 662e 7463 5f73 6176 6566 6e2e  (self.tc_savefn.
+00056d40: 7465 7874 2829 290d 0a0d 0a20 2020 2020  text())....     
+00056d50: 2020 2073 705f 7064 6620 3d20 7365 6c66     sp_pdf = self
+00056d60: 2e63 6231 312e 6973 4368 6563 6b65 6428  .cb11.isChecked(
+00056d70: 290d 0a20 2020 2020 2020 2073 705f 706e  )..        sp_pn
+00056d80: 6720 3d20 7365 6c66 2e63 6231 322e 6973  g = self.cb12.is
+00056d90: 4368 6563 6b65 6428 290d 0a20 2020 2020  Checked()..     
+00056da0: 2020 2073 705f 7376 6720 3d20 7365 6c66     sp_svg = self
+00056db0: 2e63 6231 332e 6973 4368 6563 6b65 6428  .cb13.isChecked(
+00056dc0: 290d 0a20 2020 2020 2020 2073 705f 6373  )..        sp_cs
+00056dd0: 7620 3d20 7365 6c66 2e63 6231 342e 6973  v = self.cb14.is
+00056de0: 4368 6563 6b65 6428 290d 0a20 2020 2020  Checked()..     
+00056df0: 2020 2069 6d5f 7064 6620 3d20 7365 6c66     im_pdf = self
+00056e00: 2e63 6232 312e 6973 4368 6563 6b65 6428  .cb21.isChecked(
+00056e10: 290d 0a20 2020 2020 2020 2069 6d5f 706e  )..        im_pn
+00056e20: 6720 3d20 7365 6c66 2e63 6232 322e 6973  g = self.cb22.is
+00056e30: 4368 6563 6b65 6428 290d 0a20 2020 2020  Checked()..     
+00056e40: 2020 2069 6d5f 7376 6720 3d20 7365 6c66     im_svg = self
+00056e50: 2e63 6232 332e 6973 4368 6563 6b65 6428  .cb23.isChecked(
+00056e60: 290d 0a20 2020 2020 2020 2069 6d5f 7469  )..        im_ti
+00056e70: 6620 3d20 7365 6c66 2e63 6232 342e 6973  f = self.cb24.is
+00056e80: 4368 6563 6b65 6428 290d 0a20 2020 2020  Checked()..     
+00056e90: 2020 2069 6d5f 616c 6c20 3d20 7365 6c66     im_all = self
+00056ea0: 2e63 6233 322e 6973 4368 6563 6b65 6428  .cb32.isChecked(
+00056eb0: 290d 0a20 2020 2020 2020 2069 6d5f 616c  )..        im_al
+00056ec0: 6c5f 7469 6620 3d20 7365 6c66 2e63 6233  l_tif = self.cb3
+00056ed0: 342e 6973 4368 6563 6b65 6428 290d 0a0d  4.isChecked()...
+00056ee0: 0a20 2020 2020 2020 2073 656c 662e 636c  .        self.cl
+00056ef0: 6f73 6528 290d 0a20 2020 2020 2020 2073  ose()..        s
+00056f00: 656c 662e 7061 7265 6e74 2e70 6167 6531  elf.parent.page1
+00056f10: 2e53 6176 6528 7365 6c66 2e66 696c 656e  .Save(self.filen
+00056f20: 616d 652c 2073 656c 662e 7061 7468 2c0d  ame, self.path,.
+00056f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00056f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056f60: 7370 6563 5f70 6e67 203d 2073 705f 706e  spec_png = sp_pn
-00056f70: 672c 0d0a 2020 2020 2020 2020 2020 2020  g,..            
+00056f50: 2020 2020 2020 2020 2020 7370 6563 5f70            spec_p
+00056f60: 6e67 203d 2073 705f 706e 672c 0d0a 2020  ng = sp_png,..  
+00056f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00056f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056f90: 2020 2020 2020 2020 2020 2020 2073 7065               spe
-00056fa0: 635f 7064 6620 3d20 7370 5f70 6466 2c0d  c_pdf = sp_pdf,.
-00056fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00056f90: 2020 2020 2020 2073 7065 635f 7064 6620         spec_pdf 
+00056fa0: 3d20 7370 5f70 6466 2c0d 0a20 2020 2020  = sp_pdf,..     
+00056fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00056fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056fd0: 2020 2020 2020 2020 2020 7370 6563 5f73            spec_s
-00056fe0: 7667 203d 2073 705f 7376 672c 0d0a 2020  vg = sp_svg,..  
+00056fd0: 2020 2020 7370 6563 5f73 7667 203d 2073      spec_svg = s
+00056fe0: 705f 7376 672c 0d0a 2020 2020 2020 2020  p_svg,..        
 00056ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00057000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057010: 2020 2020 2020 2073 705f 6373 7620 3d20         sp_csv = 
-00057020: 7370 5f63 7376 2c0d 0a20 2020 2020 2020  sp_csv,..       
+00057010: 2073 705f 6373 7620 3d20 7370 5f63 7376   sp_csv = sp_csv
+00057020: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 00057030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057050: 2020 696d 675f 706e 6720 3d20 696d 5f70    img_png = im_p
-00057060: 6e67 2c0d 0a20 2020 2020 2020 2020 2020  ng,..           
+00057040: 2020 2020 2020 2020 2020 2020 696d 675f              img_
+00057050: 706e 6720 3d20 696d 5f70 6e67 2c0d 0a20  png = im_png,.. 
+00057060: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00057070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057080: 2020 2020 2020 2020 2020 2020 2020 696d                im
-00057090: 675f 7064 6620 3d20 696d 5f70 6466 2c0d  g_pdf = im_pdf,.
-000570a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00057080: 2020 2020 2020 2020 696d 675f 7064 6620          img_pdf 
+00057090: 3d20 696d 5f70 6466 2c0d 0a20 2020 2020  = im_pdf,..     
+000570a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000570b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000570c0: 2020 2020 2020 2020 2020 696d 675f 7376            img_sv
-000570d0: 6720 3d20 696d 5f73 7667 2c0d 0a20 2020  g = im_svg,..   
+000570c0: 2020 2020 696d 675f 7376 6720 3d20 696d      img_svg = im
+000570d0: 5f73 7667 2c0d 0a20 2020 2020 2020 2020  _svg,..         
 000570e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000570f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057100: 2020 2020 2020 696d 675f 7469 6620 3d20        img_tif = 
-00057110: 696d 5f74 6966 2c0d 0a20 2020 2020 2020  im_tif,..       
+00057100: 696d 675f 7469 6620 3d20 696d 5f74 6966  img_tif = im_tif
+00057110: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 00057120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057140: 2020 696d 675f 616c 6c20 3d20 696d 5f61    img_all = im_a
-00057150: 6c6c 2c0d 0a20 2020 2020 2020 2020 2020  ll,..           
+00057130: 2020 2020 2020 2020 2020 2020 696d 675f              img_
+00057140: 616c 6c20 3d20 696d 5f61 6c6c 2c0d 0a20  all = im_all,.. 
+00057150: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00057160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057170: 2020 2020 2020 2020 2020 2020 2020 696d                im
-00057180: 675f 616c 6c5f 7469 6620 3d20 696d 5f61  g_all_tif = im_a
-00057190: 6c6c 5f74 6966 290d 0a0d 0a23 2d2d 2d2d  ll_tif)....#----
+00057170: 2020 2020 2020 2020 696d 675f 616c 6c5f          img_all_
+00057180: 7469 6620 3d20 696d 5f61 6c6c 5f74 6966  tif = im_all_tif
+00057190: 290d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d  )....#----------
 000571a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 000571b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 000571c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000571d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000571e0: 2d2d 0d0a 636c 6173 7320 5368 6f77 4869  --..class ShowHi
-000571f0: 7374 6f67 7261 6d28 5174 5769 6467 6574  stogram(QtWidget
-00057200: 732e 5144 6961 6c6f 672c 2051 7457 6964  s.QDialog, QtWid
-00057210: 6765 7473 2e51 4772 6170 6869 6373 5363  gets.QGraphicsSc
-00057220: 656e 6529 3a0d 0a20 2020 2064 6566 205f  ene):..    def _
-00057230: 5f69 6e69 745f 5f28 7365 6c66 2c20 7061  _init__(self, pa
-00057240: 7265 6e74 2c20 7374 6163 6b29 3a0d 0a20  rent, stack):.. 
-00057250: 2020 2020 2020 2051 7457 6964 6765 7473         QtWidgets
-00057260: 2e51 5769 6467 6574 2e5f 5f69 6e69 745f  .QWidget.__init_
-00057270: 5f28 7365 6c66 2c20 7061 7265 6e74 290d  _(self, parent).
-00057280: 0a20 2020 2020 2020 2064 6972 5f70 6174  .        dir_pat
-00057290: 6820 3d20 6f73 2e70 6174 682e 6469 726e  h = os.path.dirn
-000572a0: 616d 6528 6f73 2e70 6174 682e 7265 616c  ame(os.path.real
-000572b0: 7061 7468 285f 5f66 696c 655f 5f29 290d  path(__file__)).
-000572c0: 0a20 2020 2020 2020 2075 6963 2e6c 6f61  .        uic.loa
-000572d0: 6455 6928 6f73 2e70 6174 682e 6a6f 696e  dUi(os.path.join
-000572e0: 2864 6972 5f70 6174 682c 2773 686f 7768  (dir_path,'showh
-000572f0: 6973 746f 6772 616d 2e75 6927 292c 2073  istogram.ui'), s
-00057300: 656c 6629 0d0a 0d0a 2020 2020 2020 2020  elf)....        
-00057310: 7365 6c66 2e48 6973 746f 5769 6467 6574  self.HistoWidget
-00057320: 2e73 6574 4261 636b 6772 6f75 6e64 2822  .setBackground("
-00057330: 7722 290d 0a20 2020 2020 2020 2073 656c  w")..        sel
-00057340: 662e 4930 5769 6467 6574 2e73 6574 4261  f.I0Widget.setBa
-00057350: 636b 6772 6f75 6e64 2822 7722 290d 0a0d  ckground("w")...
-00057360: 0a20 2020 2020 2020 2073 656c 662e 6275  .        self.bu
-00057370: 7474 6f6e 5f6f 6b2e 636c 6963 6b65 642e  tton_ok.clicked.
-00057380: 636f 6e6e 6563 7428 7365 6c66 2e4f 6e41  connect(self.OnA
-00057390: 6363 6570 7429 0d0a 2020 2020 2020 2020  ccept)..        
-000573a0: 7365 6c66 2e62 7574 746f 6e5f 6361 6e63  self.button_canc
-000573b0: 656c 2e63 6c69 636b 6564 2e63 6f6e 6e65  el.clicked.conne
-000573c0: 6374 2873 656c 662e 636c 6f73 6529 0d0a  ct(self.close)..
-000573d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-000573e0: 6172 656e 7420 3d20 7061 7265 6e74 0d0a  arent = parent..
-000573f0: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-00057400: 5769 6e64 6f77 5469 746c 6528 2753 656c  WindowTitle('Sel
-00057410: 6563 7420 4930 2729 0d0a 0d0a 2020 2020  ect I0')....    
-00057420: 2020 2020 7365 6c66 2e73 7461 636b 203d      self.stack =
-00057430: 2073 7461 636b 0d0a 2020 2020 2020 2020   stack..        
-00057440: 7365 6c66 2e73 7461 636b 2e63 616c 635f  self.stack.calc_
-00057450: 6869 7374 6f67 7261 6d28 290d 0a0d 0a20  histogram().... 
-00057460: 2020 2020 2020 2073 656c 662e 7662 203d         self.vb =
-00057470: 2073 656c 662e 4930 5769 6467 6574 2e61   self.I0Widget.a
-00057480: 6464 5669 6577 426f 7828 290d 0a20 2020  ddViewBox()..   
-00057490: 2020 2020 2073 656c 662e 7662 2e73 6574       self.vb.set
-000574a0: 4173 7065 6374 4c6f 636b 6564 2829 0d0a  AspectLocked()..
-000574b0: 2020 2020 2020 2020 7365 6c66 2e41 6273          self.Abs
-000574c0: 496d 6167 6520 3d20 7067 2e49 6d61 6765  Image = pg.Image
-000574d0: 4974 656d 2862 6f72 6465 723d 226b 222c  Item(border="k",
-000574e0: 7061 7265 6e74 3d20 7365 6c66 290d 0a20  parent= self).. 
-000574f0: 2020 2020 2020 2073 656c 662e 6c61 7373         self.lass
-00057500: 6f70 6f69 6e74 733d 205b 5d0d 0a20 2020  opoints= []..   
-00057510: 2020 2020 2073 656c 662e 7662 2e73 6574       self.vb.set
-00057520: 4d6f 7573 6545 6e61 626c 6564 2878 3d46  MouseEnabled(x=F
-00057530: 616c 7365 2c20 793d 4661 6c73 6529 0d0a  alse, y=False)..
-00057540: 2020 2020 2020 2020 7365 6c66 2e76 622e          self.vb.
-00057550: 6164 6449 7465 6d28 7365 6c66 2e41 6273  addItem(self.Abs
-00057560: 496d 6167 652c 2069 676e 6f72 6542 6f75  Image, ignoreBou
-00057570: 6e64 733d 4661 6c73 6529 0d0a 2020 2020  nds=False)..    
-00057580: 2020 2020 7365 6c66 2e4d 6173 6b49 6d61      self.MaskIma
-00057590: 6765 203d 2070 672e 496d 6167 6549 7465  ge = pg.ImageIte
-000575a0: 6d28 626f 7264 6572 3d22 6b22 290d 0a20  m(border="k").. 
-000575b0: 2020 2020 2020 2073 656c 662e 7662 2e61         self.vb.a
-000575c0: 6464 4974 656d 2873 656c 662e 4d61 736b  ddItem(self.Mask
-000575d0: 496d 6167 6529 0d0a 2020 2020 2020 2020  Image)..        
-000575e0: 7365 6c66 2e72 6564 7069 7820 3d20 6e70  self.redpix = np
-000575f0: 2e7a 6572 6f73 285b 7365 6c66 2e73 7461  .zeros([self.sta
-00057600: 636b 2e6e 5f63 6f6c 732c 2073 656c 662e  ck.n_cols, self.
-00057610: 7374 6163 6b2e 6e5f 726f 7773 2c20 345d  stack.n_rows, 4]
-00057620: 2c20 6474 7970 653d 6e70 2e75 696e 7438  , dtype=np.uint8
-00057630: 290d 0a20 2020 2020 2020 2070 7820 3d20  )..        px = 
-00057640: 696e 7428 7365 6c66 2e73 7461 636b 2e6e  int(self.stack.n
-00057650: 5f63 6f6c 732a 7365 6c66 2e73 7461 636b  _cols*self.stack
-00057660: 2e6e 5f72 6f77 7320 2a20 302e 3938 2920  .n_rows * 0.98) 
-00057670: 2023 2039 3825 206f 6620 746f 7461 6c20   # 98% of total 
-00057680: 7069 7865 6c73 0d0a 2020 2020 2020 2020  pixels..        
-00057690: 666c 7578 6d61 785f 6c69 6d69 7420 3d20  fluxmax_limit = 
-000576a0: 6e70 2e6d 6561 6e28 6e70 2e70 6172 7469  np.mean(np.parti
-000576b0: 7469 6f6e 286e 702e 7261 7665 6c28 7365  tion(np.ravel(se
-000576c0: 6c66 2e73 7461 636b 2e61 7665 7261 6765  lf.stack.average
-000576d0: 666c 7578 292c 2070 7829 5b3a 7078 5d29  flux), px)[:px])
-000576e0: 2023 2061 7665 7261 6765 2062 7269 6768   # average brigh
-000576f0: 746e 6573 7320 6f66 2074 6865 2032 2520  tness of the 2% 
-00057700: 6f66 2070 6978 656c 7320 7769 7468 2068  of pixels with h
-00057710: 6967 6865 7374 2066 6c75 780d 0a20 2020  ighest flux..   
-00057720: 2020 2020 2073 656c 662e 6869 7374 6d69       self.histmi
-00057730: 6e20 3d20 666c 7578 6d61 785f 6c69 6d69  n = fluxmax_limi
-00057740: 740d 0a20 2020 2020 2020 2073 656c 662e  t..        self.
-00057750: 6869 7374 6d61 7820 3d20 6e70 2e6d 6178  histmax = np.max
-00057760: 2873 656c 662e 7374 6163 6b2e 6176 6572  (self.stack.aver
-00057770: 6167 6566 6c75 7829 2b31 0d0a 2020 2020  ageflux)+1..    
-00057780: 2020 2020 7365 6c66 2e64 7261 775f 6869      self.draw_hi
-00057790: 7374 6f67 7261 6d28 290d 0a20 2020 2020  stogram()..     
-000577a0: 2020 2073 656c 662e 6472 6177 5f69 6d61     self.draw_ima
-000577b0: 6765 2873 656c 662e 6869 7374 6d69 6e2c  ge(self.histmin,
-000577c0: 7365 6c66 2e68 6973 746d 6178 290d 0a0d  self.histmax)...
-000577d0: 0a20 2020 2020 2020 2073 656c 662e 4930  .        self.I0
-000577e0: 626f 7820 3d20 7067 2e50 6f6c 794c 696e  box = pg.PolyLin
-000577f0: 6552 4f49 285b 5b31 2c20 315d 2c20 5b30  eROI([[1, 1], [0
-00057800: 2c20 315d 2c20 5b30 2c20 305d 2c20 5b31  , 1], [0, 0], [1
-00057810: 2c20 305d 5d2c 2070 656e 3d28 352c 2038  , 0]], pen=(5, 8
-00057820: 292c 2063 6c6f 7365 643d 5472 7565 290d  ), closed=True).
-00057830: 0a20 2020 2020 2020 2073 656c 662e 7662  .        self.vb
-00057840: 2e61 6464 4974 656d 2873 656c 662e 4930  .addItem(self.I0
-00057850: 626f 782c 2069 676e 6f72 6542 6f75 6e64  box, ignoreBound
-00057860: 733d 4661 6c73 6529 0d0a 2020 2020 2020  s=False)..      
-00057870: 2020 7365 6c66 2e49 3062 6f78 2e63 6c65    self.I0box.cle
-00057880: 6172 506f 696e 7473 2829 0d0a 0d0a 2020  arPoints()....  
-00057890: 2020 2020 2020 7365 6c66 2e63 6c69 636b        self.click
-000578a0: 6465 7465 6374 6f72 203d 2051 7443 6f72  detector = QtCor
-000578b0: 652e 5154 696d 6572 2829 0d0a 2020 2020  e.QTimer()..    
-000578c0: 2020 2020 7365 6c66 2e63 6c69 636b 6465      self.clickde
-000578d0: 7465 6374 6f72 2e74 696d 656f 7574 2e63  tector.timeout.c
-000578e0: 6f6e 6e65 6374 2873 656c 662e 4f6e 5265  onnect(self.OnRe
-000578f0: 6c65 6173 6529 0d0a 2020 2020 2020 2020  lease)..        
-00057900: 7365 6c66 2e72 6164 696f 4c61 7373 6f52  self.radioLassoR
-00057910: 4f49 2e74 6f67 676c 6564 2e63 6f6e 6e65  OI.toggled.conne
-00057920: 6374 2873 656c 662e 5365 7475 7052 4f49  ct(self.SetupROI
-00057930: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00057940: 5365 7475 7052 4f49 2829 0d0a 0d0a 2020  SetupROI()....  
-00057950: 2020 6465 6620 5365 7475 7052 4f49 2873    def SetupROI(s
-00057960: 656c 6629 3a0d 0a20 2020 2020 2020 2073  elf):..        s
-00057970: 656c 662e 4930 696e 7374 7275 6374 696f  elf.I0instructio
-00057980: 6e73 2e73 6574 5465 7874 2822 5365 6c65  ns.setText("Sele
-00057990: 6374 2049 3020 6279 2064 7261 6767 696e  ct I0 by draggin
-000579a0: 6720 7468 6520 6869 7374 6f67 7261 6d20  g the histogram 
-000579b0: 6c69 6e65 7320 6f72 2062 7920 6472 6177  lines or by draw
-000579c0: 696e 6720 6120 524f 492e 2229 0d0a 2020  ing a ROI.")..  
-000579d0: 2020 2020 2020 7365 6c66 2e6c 6173 736f        self.lasso
-000579e0: 706f 696e 7473 203d 205b 5d0d 0a20 2020  points = []..   
-000579f0: 2020 2020 2073 656c 662e 4930 626f 782e       self.I0box.
-00057a00: 7365 745a 5661 6c75 6528 2d31 3029 0d0a  setZValue(-10)..
-00057a10: 2020 2020 2020 2020 7365 6c66 2e4d 6173          self.Mas
-00057a20: 6b49 6d61 6765 2e73 6574 5a56 616c 7565  kImage.setZValue
-00057a30: 282d 3130 290d 0a20 2020 2020 2020 2069  (-10)..        i
-00057a40: 6620 7365 6c66 2e72 6164 696f 4c61 7373  f self.radioLass
-00057a50: 6f52 4f49 2e69 7343 6865 636b 6564 2829  oROI.isChecked()
-00057a60: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00057a70: 656c 662e 7072 6f78 7920 3d20 7067 2e53  elf.proxy = pg.S
-00057a80: 6967 6e61 6c50 726f 7879 2873 656c 662e  ignalProxy(self.
-00057a90: 7662 2e73 6365 6e65 2829 2e73 6967 4d6f  vb.scene().sigMo
-00057aa0: 7573 654d 6f76 6564 2c20 7261 7465 4c69  useMoved, rateLi
-00057ab0: 6d69 743d 3135 2c20 736c 6f74 3d73 656c  mit=15, slot=sel
-00057ac0: 662e 4f6e 4d6f 7573 6548 6f76 6572 2920  f.OnMouseHover) 
-00057ad0: 2320 7261 7465 206c 696d 6974 2074 6f20  # rate limit to 
-00057ae0: 6176 6f69 6420 746f 6f20 6d61 6e79 2068  avoid too many h
-00057af0: 616e 646c 6573 0d0a 2020 2020 2020 2020  andles..        
-00057b00: 2020 2020 7365 6c66 2e49 3062 6f78 2e68      self.I0box.h
-00057b10: 616e 646c 6550 656e 203d 2051 7447 7569  andlePen = QtGui
-00057b20: 2e51 5065 6e28 5174 4775 692e 5143 6f6c  .QPen(QtGui.QCol
-00057b30: 6f72 2832 3535 2c20 302c 2031 3238 2c20  or(255, 0, 128, 
-00057b40: 3029 290d 0a20 2020 2020 2020 2023 2350  0))..        ##P
-00057b50: 6f6c 7967 6f6e 2069 7320 6375 7272 656e  olygon is curren
-00057b60: 746c 7920 6272 6f6b 656e 0d0a 2020 2020  tly broken..    
-00057b70: 2020 2020 2320 656c 6966 2073 656c 662e      # elif self.
-00057b80: 7261 6469 6f50 6f6c 7952 4f49 2e69 7343  radioPolyROI.isC
-00057b90: 6865 636b 6564 2829 3a0d 0a20 2020 2020  hecked():..     
-00057ba0: 2020 2023 2020 2020 2073 656c 662e 7072     #     self.pr
-00057bb0: 6f78 7920 3d20 7067 2e53 6967 6e61 6c50  oxy = pg.SignalP
-00057bc0: 726f 7879 2873 656c 662e 7662 2e73 6365  roxy(self.vb.sce
-00057bd0: 6e65 2829 2e73 6967 4d6f 7573 654d 6f76  ne().sigMouseMov
-00057be0: 6564 2c20 7261 7465 4c69 6d69 743d 3330  ed, rateLimit=30
-00057bf0: 2c20 736c 6f74 3d73 656c 662e 4f6e 4d6f  , slot=self.OnMo
-00057c00: 7573 6548 6f76 6572 290d 0a20 2020 2020  useHover)..     
-00057c10: 2020 2023 2020 2020 2073 656c 662e 4930     #     self.I0
-00057c20: 626f 782e 6861 6e64 6c65 5065 6e20 3d20  box.handlePen = 
-00057c30: 5174 4775 692e 5150 656e 2851 7447 7569  QtGui.QPen(QtGui
-00057c40: 2e51 436f 6c6f 7228 3235 352c 2030 2c20  .QColor(255, 0, 
-00057c50: 3132 382c 2032 3535 2929 0d0a 2020 2020  128, 255))..    
-00057c60: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-00057c70: 2020 2020 2020 7365 6c66 2e49 3062 6f78        self.I0box
-00057c80: 2e73 6967 5265 6769 6f6e 4368 616e 6765  .sigRegionChange
-00057c90: 4669 6e69 7368 6564 2e64 6973 636f 6e6e  Finished.disconn
-00057ca0: 6563 7428 290d 0a20 2020 2020 2020 2020  ect()..         
-00057cb0: 2020 2073 656c 662e 4930 626f 782e 636c     self.I0box.cl
-00057cc0: 6561 7250 6f69 6e74 7328 290d 0a20 2020  earPoints()..   
-00057cd0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-00057ce0: 6f78 792e 626c 6f63 6b20 3d20 4661 6c73  oxy.block = Fals
-00057cf0: 650d 0a20 2020 2020 2020 2065 7863 6570  e..        excep
-00057d00: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-00057d10: 7061 7373 0d0a 0d0a 232d 2d2d 2d2d 2d2d  pass....#-------
+000571d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 636c  ------------..cl
+000571e0: 6173 7320 5368 6f77 4869 7374 6f67 7261  ass ShowHistogra
+000571f0: 6d28 5174 5769 6467 6574 732e 5144 6961  m(QtWidgets.QDia
+00057200: 6c6f 672c 2051 7457 6964 6765 7473 2e51  log, QtWidgets.Q
+00057210: 4772 6170 6869 6373 5363 656e 6529 3a0d  GraphicsScene):.
+00057220: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00057230: 5f28 7365 6c66 2c20 7061 7265 6e74 2c20  _(self, parent, 
+00057240: 7374 6163 6b29 3a0d 0a20 2020 2020 2020  stack):..       
+00057250: 2051 7457 6964 6765 7473 2e51 5769 6467   QtWidgets.QWidg
+00057260: 6574 2e5f 5f69 6e69 745f 5f28 7365 6c66  et.__init__(self
+00057270: 2c20 7061 7265 6e74 290d 0a20 2020 2020  , parent)..     
+00057280: 2020 2064 6972 5f70 6174 6820 3d20 6f73     dir_path = os
+00057290: 2e70 6174 682e 6469 726e 616d 6528 6f73  .path.dirname(os
+000572a0: 2e70 6174 682e 7265 616c 7061 7468 285f  .path.realpath(_
+000572b0: 5f66 696c 655f 5f29 290d 0a20 2020 2020  _file__))..     
+000572c0: 2020 2075 6963 2e6c 6f61 6455 6928 6f73     uic.loadUi(os
+000572d0: 2e70 6174 682e 6a6f 696e 2864 6972 5f70  .path.join(dir_p
+000572e0: 6174 682c 2773 686f 7768 6973 746f 6772  ath,'showhistogr
+000572f0: 616d 2e75 6927 292c 2073 656c 6629 0d0a  am.ui'), self)..
+00057300: 0d0a 2020 2020 2020 2020 7365 6c66 2e48  ..        self.H
+00057310: 6973 746f 5769 6467 6574 2e73 6574 4261  istoWidget.setBa
+00057320: 636b 6772 6f75 6e64 2822 7722 290d 0a20  ckground("w").. 
+00057330: 2020 2020 2020 2073 656c 662e 4930 5769         self.I0Wi
+00057340: 6467 6574 2e73 6574 4261 636b 6772 6f75  dget.setBackgrou
+00057350: 6e64 2822 7722 290d 0a0d 0a20 2020 2020  nd("w")....     
+00057360: 2020 2073 656c 662e 6275 7474 6f6e 5f6f     self.button_o
+00057370: 6b2e 636c 6963 6b65 642e 636f 6e6e 6563  k.clicked.connec
+00057380: 7428 7365 6c66 2e4f 6e41 6363 6570 7429  t(self.OnAccept)
+00057390: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
+000573a0: 7574 746f 6e5f 6361 6e63 656c 2e63 6c69  utton_cancel.cli
+000573b0: 636b 6564 2e63 6f6e 6e65 6374 2873 656c  cked.connect(sel
+000573c0: 662e 636c 6f73 6529 0d0a 0d0a 2020 2020  f.close)....    
+000573d0: 2020 2020 7365 6c66 2e70 6172 656e 7420      self.parent 
+000573e0: 3d20 7061 7265 6e74 0d0a 2020 2020 2020  = parent..      
+000573f0: 2020 7365 6c66 2e73 6574 5769 6e64 6f77    self.setWindow
+00057400: 5469 746c 6528 2753 656c 6563 7420 4930  Title('Select I0
+00057410: 2729 0d0a 0d0a 2020 2020 2020 2020 7365  ')....        se
+00057420: 6c66 2e73 7461 636b 203d 2073 7461 636b  lf.stack = stack
+00057430: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00057440: 7461 636b 2e63 616c 635f 6869 7374 6f67  tack.calc_histog
+00057450: 7261 6d28 290d 0a0d 0a20 2020 2020 2020  ram()....       
+00057460: 2073 656c 662e 7662 203d 2073 656c 662e   self.vb = self.
+00057470: 4930 5769 6467 6574 2e61 6464 5669 6577  I0Widget.addView
+00057480: 426f 7828 290d 0a20 2020 2020 2020 2073  Box()..        s
+00057490: 656c 662e 7662 2e73 6574 4173 7065 6374  elf.vb.setAspect
+000574a0: 4c6f 636b 6564 2829 0d0a 2020 2020 2020  Locked()..      
+000574b0: 2020 7365 6c66 2e41 6273 496d 6167 6520    self.AbsImage 
+000574c0: 3d20 7067 2e49 6d61 6765 4974 656d 2862  = pg.ImageItem(b
+000574d0: 6f72 6465 723d 226b 222c 7061 7265 6e74  order="k",parent
+000574e0: 3d20 7365 6c66 290d 0a20 2020 2020 2020  = self)..       
+000574f0: 2073 656c 662e 6c61 7373 6f70 6f69 6e74   self.lassopoint
+00057500: 733d 205b 5d0d 0a20 2020 2020 2020 2073  s= []..        s
+00057510: 656c 662e 7662 2e73 6574 4d6f 7573 6545  elf.vb.setMouseE
+00057520: 6e61 626c 6564 2878 3d46 616c 7365 2c20  nabled(x=False, 
+00057530: 793d 4661 6c73 6529 0d0a 2020 2020 2020  y=False)..      
+00057540: 2020 7365 6c66 2e76 622e 6164 6449 7465    self.vb.addIte
+00057550: 6d28 7365 6c66 2e41 6273 496d 6167 652c  m(self.AbsImage,
+00057560: 2069 676e 6f72 6542 6f75 6e64 733d 4661   ignoreBounds=Fa
+00057570: 6c73 6529 0d0a 2020 2020 2020 2020 7365  lse)..        se
+00057580: 6c66 2e4d 6173 6b49 6d61 6765 203d 2070  lf.MaskImage = p
+00057590: 672e 496d 6167 6549 7465 6d28 626f 7264  g.ImageItem(bord
+000575a0: 6572 3d22 6b22 290d 0a20 2020 2020 2020  er="k")..       
+000575b0: 2073 656c 662e 7662 2e61 6464 4974 656d   self.vb.addItem
+000575c0: 2873 656c 662e 4d61 736b 496d 6167 6529  (self.MaskImage)
+000575d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+000575e0: 6564 7069 7820 3d20 6e70 2e7a 6572 6f73  edpix = np.zeros
+000575f0: 285b 7365 6c66 2e73 7461 636b 2e6e 5f63  ([self.stack.n_c
+00057600: 6f6c 732c 2073 656c 662e 7374 6163 6b2e  ols, self.stack.
+00057610: 6e5f 726f 7773 2c20 345d 2c20 6474 7970  n_rows, 4], dtyp
+00057620: 653d 6e70 2e75 696e 7438 290d 0a20 2020  e=np.uint8)..   
+00057630: 2020 2020 2070 7820 3d20 696e 7428 7365       px = int(se
+00057640: 6c66 2e73 7461 636b 2e6e 5f63 6f6c 732a  lf.stack.n_cols*
+00057650: 7365 6c66 2e73 7461 636b 2e6e 5f72 6f77  self.stack.n_row
+00057660: 7320 2a20 302e 3938 2920 2023 2039 3825  s * 0.98)  # 98%
+00057670: 206f 6620 746f 7461 6c20 7069 7865 6c73   of total pixels
+00057680: 0d0a 2020 2020 2020 2020 666c 7578 6d61  ..        fluxma
+00057690: 785f 6c69 6d69 7420 3d20 6e70 2e6d 6561  x_limit = np.mea
+000576a0: 6e28 6e70 2e70 6172 7469 7469 6f6e 286e  n(np.partition(n
+000576b0: 702e 7261 7665 6c28 7365 6c66 2e73 7461  p.ravel(self.sta
+000576c0: 636b 2e61 7665 7261 6765 666c 7578 292c  ck.averageflux),
+000576d0: 2070 7829 5b3a 7078 5d29 2023 2061 7665   px)[:px]) # ave
+000576e0: 7261 6765 2062 7269 6768 746e 6573 7320  rage brightness 
+000576f0: 6f66 2074 6865 2032 2520 6f66 2070 6978  of the 2% of pix
+00057700: 656c 7320 7769 7468 2068 6967 6865 7374  els with highest
+00057710: 2066 6c75 780d 0a20 2020 2020 2020 2073   flux..        s
+00057720: 656c 662e 6869 7374 6d69 6e20 3d20 666c  elf.histmin = fl
+00057730: 7578 6d61 785f 6c69 6d69 740d 0a20 2020  uxmax_limit..   
+00057740: 2020 2020 2073 656c 662e 6869 7374 6d61       self.histma
+00057750: 7820 3d20 6e70 2e6d 6178 2873 656c 662e  x = np.max(self.
+00057760: 7374 6163 6b2e 6176 6572 6167 6566 6c75  stack.averageflu
+00057770: 7829 2b31 0d0a 2020 2020 2020 2020 7365  x)+1..        se
+00057780: 6c66 2e64 7261 775f 6869 7374 6f67 7261  lf.draw_histogra
+00057790: 6d28 290d 0a20 2020 2020 2020 2073 656c  m()..        sel
+000577a0: 662e 6472 6177 5f69 6d61 6765 2873 656c  f.draw_image(sel
+000577b0: 662e 6869 7374 6d69 6e2c 7365 6c66 2e68  f.histmin,self.h
+000577c0: 6973 746d 6178 290d 0a0d 0a20 2020 2020  istmax)....     
+000577d0: 2020 2073 656c 662e 4930 626f 7820 3d20     self.I0box = 
+000577e0: 7067 2e50 6f6c 794c 696e 6552 4f49 285b  pg.PolyLineROI([
+000577f0: 5b31 2c20 315d 2c20 5b30 2c20 315d 2c20  [1, 1], [0, 1], 
+00057800: 5b30 2c20 305d 2c20 5b31 2c20 305d 5d2c  [0, 0], [1, 0]],
+00057810: 2070 656e 3d28 352c 2038 292c 2063 6c6f   pen=(5, 8), clo
+00057820: 7365 643d 5472 7565 290d 0a20 2020 2020  sed=True)..     
+00057830: 2020 2073 656c 662e 7662 2e61 6464 4974     self.vb.addIt
+00057840: 656d 2873 656c 662e 4930 626f 782c 2069  em(self.I0box, i
+00057850: 676e 6f72 6542 6f75 6e64 733d 4661 6c73  gnoreBounds=Fals
+00057860: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
+00057870: 2e49 3062 6f78 2e63 6c65 6172 506f 696e  .I0box.clearPoin
+00057880: 7473 2829 0d0a 0d0a 2020 2020 2020 2020  ts()....        
+00057890: 7365 6c66 2e63 6c69 636b 6465 7465 6374  self.clickdetect
+000578a0: 6f72 203d 2051 7443 6f72 652e 5154 696d  or = QtCore.QTim
+000578b0: 6572 2829 0d0a 2020 2020 2020 2020 7365  er()..        se
+000578c0: 6c66 2e63 6c69 636b 6465 7465 6374 6f72  lf.clickdetector
+000578d0: 2e74 696d 656f 7574 2e63 6f6e 6e65 6374  .timeout.connect
+000578e0: 2873 656c 662e 4f6e 5265 6c65 6173 6529  (self.OnRelease)
+000578f0: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+00057900: 6164 696f 4c61 7373 6f52 4f49 2e74 6f67  adioLassoROI.tog
+00057910: 676c 6564 2e63 6f6e 6e65 6374 2873 656c  gled.connect(sel
+00057920: 662e 5365 7475 7052 4f49 290d 0a20 2020  f.SetupROI)..   
+00057930: 2020 2020 2073 656c 662e 5365 7475 7052       self.SetupR
+00057940: 4f49 2829 0d0a 0d0a 2020 2020 6465 6620  OI()....    def 
+00057950: 5365 7475 7052 4f49 2873 656c 6629 3a0d  SetupROI(self):.
+00057960: 0a20 2020 2020 2020 2073 656c 662e 4930  .        self.I0
+00057970: 696e 7374 7275 6374 696f 6e73 2e73 6574  instructions.set
+00057980: 5465 7874 2822 5365 6c65 6374 2049 3020  Text("Select I0 
+00057990: 6279 2064 7261 6767 696e 6720 7468 6520  by dragging the 
+000579a0: 6869 7374 6f67 7261 6d20 6c69 6e65 7320  histogram lines 
+000579b0: 6f72 2062 7920 6472 6177 696e 6720 6120  or by drawing a 
+000579c0: 524f 492e 2229 0d0a 2020 2020 2020 2020  ROI.")..        
+000579d0: 7365 6c66 2e6c 6173 736f 706f 696e 7473  self.lassopoints
+000579e0: 203d 205b 5d0d 0a20 2020 2020 2020 2073   = []..        s
+000579f0: 656c 662e 4930 626f 782e 7365 745a 5661  elf.I0box.setZVa
+00057a00: 6c75 6528 2d31 3029 0d0a 2020 2020 2020  lue(-10)..      
+00057a10: 2020 7365 6c66 2e4d 6173 6b49 6d61 6765    self.MaskImage
+00057a20: 2e73 6574 5a56 616c 7565 282d 3130 290d  .setZValue(-10).
+00057a30: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00057a40: 2e72 6164 696f 4c61 7373 6f52 4f49 2e69  .radioLassoROI.i
+00057a50: 7343 6865 636b 6564 2829 3a0d 0a20 2020  sChecked():..   
+00057a60: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+00057a70: 6f78 7920 3d20 7067 2e53 6967 6e61 6c50  oxy = pg.SignalP
+00057a80: 726f 7879 2873 656c 662e 7662 2e73 6365  roxy(self.vb.sce
+00057a90: 6e65 2829 2e73 6967 4d6f 7573 654d 6f76  ne().sigMouseMov
+00057aa0: 6564 2c20 7261 7465 4c69 6d69 743d 3135  ed, rateLimit=15
+00057ab0: 2c20 736c 6f74 3d73 656c 662e 4f6e 4d6f  , slot=self.OnMo
+00057ac0: 7573 6548 6f76 6572 2920 2320 7261 7465  useHover) # rate
+00057ad0: 206c 696d 6974 2074 6f20 6176 6f69 6420   limit to avoid 
+00057ae0: 746f 6f20 6d61 6e79 2068 616e 646c 6573  too many handles
+00057af0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00057b00: 6c66 2e49 3062 6f78 2e68 616e 646c 6550  lf.I0box.handleP
+00057b10: 656e 203d 2051 7447 7569 2e51 5065 6e28  en = QtGui.QPen(
+00057b20: 5174 4775 692e 5143 6f6c 6f72 2832 3535  QtGui.QColor(255
+00057b30: 2c20 302c 2031 3238 2c20 3029 290d 0a20  , 0, 128, 0)).. 
+00057b40: 2020 2020 2020 2023 2350 6f6c 7967 6f6e         ##Polygon
+00057b50: 2069 7320 6375 7272 656e 746c 7920 6272   is currently br
+00057b60: 6f6b 656e 0d0a 2020 2020 2020 2020 2320  oken..        # 
+00057b70: 656c 6966 2073 656c 662e 7261 6469 6f50  elif self.radioP
+00057b80: 6f6c 7952 4f49 2e69 7343 6865 636b 6564  olyROI.isChecked
+00057b90: 2829 3a0d 0a20 2020 2020 2020 2023 2020  ():..        #  
+00057ba0: 2020 2073 656c 662e 7072 6f78 7920 3d20     self.proxy = 
+00057bb0: 7067 2e53 6967 6e61 6c50 726f 7879 2873  pg.SignalProxy(s
+00057bc0: 656c 662e 7662 2e73 6365 6e65 2829 2e73  elf.vb.scene().s
+00057bd0: 6967 4d6f 7573 654d 6f76 6564 2c20 7261  igMouseMoved, ra
+00057be0: 7465 4c69 6d69 743d 3330 2c20 736c 6f74  teLimit=30, slot
+00057bf0: 3d73 656c 662e 4f6e 4d6f 7573 6548 6f76  =self.OnMouseHov
+00057c00: 6572 290d 0a20 2020 2020 2020 2023 2020  er)..        #  
+00057c10: 2020 2073 656c 662e 4930 626f 782e 6861     self.I0box.ha
+00057c20: 6e64 6c65 5065 6e20 3d20 5174 4775 692e  ndlePen = QtGui.
+00057c30: 5150 656e 2851 7447 7569 2e51 436f 6c6f  QPen(QtGui.QColo
+00057c40: 7228 3235 352c 2030 2c20 3132 382c 2032  r(255, 0, 128, 2
+00057c50: 3535 2929 0d0a 2020 2020 2020 2020 7472  55))..        tr
+00057c60: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00057c70: 7365 6c66 2e49 3062 6f78 2e73 6967 5265  self.I0box.sigRe
+00057c80: 6769 6f6e 4368 616e 6765 4669 6e69 7368  gionChangeFinish
+00057c90: 6564 2e64 6973 636f 6e6e 6563 7428 290d  ed.disconnect().
+00057ca0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00057cb0: 662e 4930 626f 782e 636c 6561 7250 6f69  f.I0box.clearPoi
+00057cc0: 6e74 7328 290d 0a20 2020 2020 2020 2020  nts()..         
+00057cd0: 2020 2073 656c 662e 7072 6f78 792e 626c     self.proxy.bl
+00057ce0: 6f63 6b20 3d20 4661 6c73 650d 0a20 2020  ock = False..   
+00057cf0: 2020 2020 2065 7863 6570 743a 0d0a 2020       except:..  
+00057d00: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
+00057d10: 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ..#-------------
 00057d20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00057d30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00057d40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00057d50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
-00057d60: 0a20 2020 2064 6566 2064 7261 775f 6869  .    def draw_hi
-00057d70: 7374 6f67 7261 6d28 7365 6c66 293a 0d0a  stogram(self):..
-00057d80: 2020 2020 2020 2020 6869 7374 6f67 7261          histogra
-00057d90: 6d5f 6461 7461 203d 2020 6e70 2e72 6573  m_data =  np.res
-00057da0: 6861 7065 2873 656c 662e 7374 6163 6b2e  hape(self.stack.
-00057db0: 6869 7374 6f67 7261 6d2c 2028 7365 6c66  histogram, (self
-00057dc0: 2e73 7461 636b 2e6e 5f63 6f6c 732a 7365  .stack.n_cols*se
-00057dd0: 6c66 2e73 7461 636b 2e6e 5f72 6f77 7329  lf.stack.n_rows)
-00057de0: 2c20 6f72 6465 723d 2746 2729 0d0a 0d0a  , order='F')....
-00057df0: 2020 2020 2020 2020 792c 2078 203d 206e          y, x = n
-00057e00: 702e 6869 7374 6f67 7261 6d28 6869 7374  p.histogram(hist
-00057e10: 6f67 7261 6d5f 6461 7461 2c20 6269 6e73  ogram_data, bins
-00057e20: 3d31 3030 290d 0a0d 0a20 2020 2020 2020  =100)....       
-00057e30: 2073 656c 662e 7265 6769 6f6e 203d 2070   self.region = p
-00057e40: 672e 4c69 6e65 6172 5265 6769 6f6e 4974  g.LinearRegionIt
-00057e50: 656d 2862 7275 7368 3d5b 3235 352c 302c  em(brush=[255,0,
-00057e60: 302c 3435 5d2c 626f 756e 6473 3d5b 6e70  0,45],bounds=[np
-00057e70: 2e6d 696e 2878 292c 6e70 2e6d 6178 2878  .min(x),np.max(x
-00057e80: 295d 290d 0a0d 0a20 2020 2020 2020 2073  )])....        s
-00057e90: 656c 662e 7265 6769 6f6e 2e73 6574 5a56  elf.region.setZV
-00057ea0: 616c 7565 2831 3029 0d0a 0d0a 2020 2020  alue(10)....    
-00057eb0: 2020 2020 706c 6f74 203d 2073 656c 662e      plot = self.
-00057ec0: 4869 7374 6f57 6964 6765 740d 0a20 2020  HistoWidget..   
-00057ed0: 2020 2020 2070 6c6f 742e 6164 6449 7465       plot.addIte
-00057ee0: 6d28 7365 6c66 2e72 6567 696f 6e2c 2069  m(self.region, i
-00057ef0: 676e 6f72 6542 6f75 6e64 733d 4661 6c73  gnoreBounds=Fals
-00057f00: 6529 0d0a 2020 2020 2020 2020 706c 6f74  e)..        plot
-00057f10: 2e73 6574 4d6f 7573 6545 6e61 626c 6564  .setMouseEnabled
-00057f20: 2878 3d46 616c 7365 2c20 793d 4661 6c73  (x=False, y=Fals
-00057f30: 6529 0d0a 2020 2020 2020 2020 706c 6f74  e)..        plot
-00057f40: 2e73 686f 7747 7269 6428 793d 5472 7565  .showGrid(y=True
-00057f50: 290d 0a0d 0a20 2020 2020 2020 2070 6c6f  )....        plo
-00057f60: 742e 7368 6f77 4178 6973 2822 746f 7022  t.showAxis("top"
-00057f70: 2c20 7368 6f77 3d54 7275 6529 0d0a 2020  , show=True)..  
-00057f80: 2020 2020 2020 706c 6f74 2e73 686f 7741        plot.showA
-00057f90: 7869 7328 2272 6967 6874 222c 2073 686f  xis("right", sho
-00057fa0: 773d 5472 7565 290d 0a20 2020 2020 2020  w=True)..       
-00057fb0: 2062 7920 3d20 706c 6f74 2e67 6574 4178   by = plot.getAx
-00057fc0: 6973 2822 7269 6768 7422 290d 0a20 2020  is("right")..   
-00057fd0: 2020 2020 2062 7820 3d20 706c 6f74 2e67       bx = plot.g
-00057fe0: 6574 4178 6973 2822 746f 7022 290d 0a20  etAxis("top").. 
-00057ff0: 2020 2020 2020 2062 792e 7365 7453 7479         by.setSty
-00058000: 6c65 2873 686f 7756 616c 7565 733d 4661  le(showValues=Fa
-00058010: 6c73 652c 7469 636b 4c65 6e67 7468 3d30  lse,tickLength=0
-00058020: 290d 0a20 2020 2020 2020 2062 782e 7365  )..        bx.se
-00058030: 7453 7479 6c65 2873 686f 7756 616c 7565  tStyle(showValue
-00058040: 733d 4661 6c73 652c 7469 636b 4c65 6e67  s=False,tickLeng
-00058050: 7468 3d30 290d 0a20 2020 2020 2020 2061  th=0)..        a
-00058060: 7920 3d20 706c 6f74 2e67 6574 4178 6973  y = plot.getAxis
-00058070: 2822 6c65 6674 2229 0d0a 2020 2020 2020  ("left")..      
-00058080: 2020 6178 203d 2070 6c6f 742e 6765 7441    ax = plot.getA
-00058090: 7869 7328 2262 6f74 746f 6d22 290d 0a0d  xis("bottom")...
-000580a0: 0a20 2020 2020 2020 2061 782e 7365 744c  .        ax.setL
-000580b0: 6162 656c 2874 6578 743d 2241 7665 7261  abel(text="Avera
-000580c0: 6765 2046 6c75 7822 290d 0a20 2020 2020  ge Flux")..     
-000580d0: 2020 2023 2320 4c69 7474 6c65 2068 6163     ## Little hac
-000580e0: 6b20 746f 2064 6973 706c 6179 2076 6572  k to display ver
-000580f0: 7469 6361 6c20 6178 6973 2061 7320 6c6f  tical axis as lo
-00058100: 672e 0d0a 2020 2020 2020 2020 706c 6f74  g...        plot
-00058110: 2e67 6574 5669 6577 426f 7828 292e 7365  .getViewBox().se
-00058120: 744c 696d 6974 7328 794d 696e 3d30 2c79  tLimits(yMin=0,y
-00058130: 4d61 783d 6e70 2e6d 6178 2879 2929 0d0a  Max=np.max(y))..
-00058140: 2020 2020 2020 2020 6179 2e73 6574 4c61          ay.setLa
-00058150: 6265 6c28 7465 7874 3d22 6c6f 673c 7375  bel(text="log<su
-00058160: 623e 3130 3c2f 7375 623e 2028 4e75 6d62  b>10</sub> (Numb
-00058170: 6572 206f 6620 7069 7865 6c73 2922 290d  er of pixels)").
-00058180: 0a20 2020 2020 2020 2079 5b79 203c 2031  .        y[y < 1
-00058190: 5d20 3d20 310d 0a20 2020 2020 2020 2079  ] = 1..        y
-000581a0: 203d 206e 702e 6c6f 6731 3028 7929 0d0a   = np.log10(y)..
-000581b0: 2020 2020 2020 2020 706c 6f74 2e73 6574          plot.set
-000581c0: 4c6f 674d 6f64 6528 783d 4661 6c73 652c  LogMode(x=False,
-000581d0: 2079 3d46 616c 7365 2920 2323 204c 6f67   y=False) ## Log
-000581e0: 206d 6f64 6520 6973 206e 6f74 2077 6f72   mode is not wor
-000581f0: 6b69 6e67 2063 6f72 7265 6374 6c79 2061  king correctly a
-00058200: 7420 7468 6520 6d6f 6d65 6e74 2e0d 0a20  t the moment... 
-00058210: 2020 2020 2020 2023 230d 0a20 2020 2020         ##..     
-00058220: 2020 2070 6c6f 742e 706c 6f74 2878 2c20     plot.plot(x, 
-00058230: 792c 2073 7465 704d 6f64 653d 5472 7565  y, stepMode=True
-00058240: 2c20 6669 6c6c 4c65 7665 6c3d 302c 2062  , fillLevel=0, b
-00058250: 7275 7368 3d28 302c 2030 2c20 3235 352c  rush=(0, 0, 255,
-00058260: 2031 3530 2929 0d0a 2020 2020 2020 2020   150))..        
-00058270: 6465 6620 7570 6461 7465 2872 6567 696f  def update(regio
-00058280: 6e29 3a0d 0a20 2020 2020 2020 2020 2020  n):..           
-00058290: 2073 656c 662e 7265 6769 6f6e 2e73 6574   self.region.set
-000582a0: 5a56 616c 7565 2831 3029 0d0a 2020 2020  ZValue(10)..    
-000582b0: 2020 2020 2020 2020 6d69 6e58 2c20 6d61          minX, ma
-000582c0: 7858 203d 2072 6567 696f 6e0d 0a20 2020  xX = region..   
-000582d0: 2020 2020 2020 2020 2073 656c 662e 6472           self.dr
-000582e0: 6177 5f69 6d61 6765 286d 696e 582c 206d  aw_image(minX, m
-000582f0: 6178 5829 0d0a 2020 2020 2020 2020 2020  axX)..          
-00058300: 2020 7365 6c66 2e53 6574 7570 524f 4928    self.SetupROI(
-00058310: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00058320: 656c 662e 4d61 736b 496d 6167 652e 7365  elf.MaskImage.se
-00058330: 745a 5661 6c75 6528 3130 290d 0a0d 0a20  tZValue(10).... 
-00058340: 2020 2020 2020 2073 656c 662e 7265 6769         self.regi
-00058350: 6f6e 2e73 6574 5265 6769 6f6e 2828 7365  on.setRegion((se
-00058360: 6c66 2e68 6973 746d 696e 2c73 656c 662e  lf.histmin,self.
-00058370: 6869 7374 6d61 7829 290d 0a20 2020 2020  histmax))..     
-00058380: 2020 2073 656c 662e 7265 6769 6f6e 2e73     self.region.s
-00058390: 6967 5265 6769 6f6e 4368 616e 6765 642e  igRegionChanged.
-000583a0: 636f 6e6e 6563 7428 6c61 6d62 6461 3a20  connect(lambda: 
-000583b0: 7570 6461 7465 2873 656c 662e 7265 6769  update(self.regi
-000583c0: 6f6e 2e67 6574 5265 6769 6f6e 2829 2929  on.getRegion()))
-000583d0: 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ..#-------------
-000583e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000583f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00058400: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00058410: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
-00058420: 6566 204f 6e52 656c 6561 7365 2873 656c  ef OnRelease(sel
-00058430: 6629 3a0d 0a20 2020 2020 2020 2069 6620  f):..        if 
-00058440: 6e6f 7420 7365 6c66 2e76 622e 7363 656e  not self.vb.scen
-00058450: 6528 292e 636c 6963 6b45 7665 6e74 733a  e().clickEvents:
-00058460: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00058470: 6c66 2e70 726f 7879 2e62 6c6f 636b 203d  lf.proxy.block =
-00058480: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
-00058490: 2020 2073 656c 662e 4472 6177 524f 4928     self.DrawROI(
-000584a0: 290d 0a20 2020 2020 2020 2020 2020 2023  )..            #
-000584b0: 7365 6c66 2e49 3069 6e73 7472 7563 7469  self.I0instructi
-000584c0: 6f6e 732e 7365 7454 6578 7428 2244 7261  ons.setText("Dra
-000584d0: 6720 7468 6520 706f 6c79 676f 6e20 6f72  g the polygon or
-000584e0: 2074 6865 2068 616e 646c 6573 2e20 4164   the handles. Ad
-000584f0: 6420 6861 6e64 6c65 7320 6279 2063 6c69  d handles by cli
-00058500: 636b 696e 6720 6f6e 2061 206c 696e 6520  cking on a line 
-00058510: 7365 676d 656e 742e 2229 0d0a 2020 2020  segment.")..    
-00058520: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00058530: 7261 6469 6f4c 6173 736f 524f 492e 6973  radioLassoROI.is
-00058540: 4368 6563 6b65 6428 293a 0d0a 2020 2020  Checked():..    
-00058550: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00058560: 2e6c 6173 736f 706f 696e 7473 3d20 5b5d  .lassopoints= []
-00058570: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00058580: 2020 7365 6c66 2e49 3069 6e73 7472 7563    self.I0instruc
-00058590: 7469 6f6e 732e 7365 7454 6578 7428 2222  tions.setText(""
-000585a0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000585b0: 2020 2077 6869 6c65 206c 656e 2873 656c     while len(sel
-000585c0: 662e 4930 626f 782e 6765 7448 616e 646c  f.I0box.getHandl
-000585d0: 6573 2829 2920 3e20 303a 0d0a 2020 2020  es()) > 0:..    
-000585e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000585f0: 7365 6c66 2e49 3062 6f78 2e72 656d 6f76  self.I0box.remov
-00058600: 6548 616e 646c 6528 7365 6c66 2e49 3062  eHandle(self.I0b
-00058610: 6f78 2e67 6574 4861 6e64 6c65 7328 295b  ox.getHandles()[
-00058620: 305d 2c20 7570 6461 7465 5365 676d 656e  0], updateSegmen
-00058630: 7473 3d54 7275 6529 0d0a 2020 2020 2020  ts=True)..      
-00058640: 2020 2020 2020 7365 6c66 2e49 3062 6f78        self.I0box
-00058650: 2e73 6967 5265 6769 6f6e 4368 616e 6765  .sigRegionChange
-00058660: 4669 6e69 7368 6564 2e63 6f6e 6e65 6374  Finished.connect
-00058670: 2873 656c 662e 4472 6177 524f 4929 0d0a  (self.DrawROI)..
-00058680: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00058690: 2e63 6c69 636b 6465 7465 6374 6f72 2e73  .clickdetector.s
-000586a0: 746f 7028 290d 0a0d 0a0d 0a20 2020 2064  top()......    d
-000586b0: 6566 2044 7261 7752 4f49 2873 656c 6629  ef DrawROI(self)
-000586c0: 3a0d 0a20 2020 2020 2020 206c 6566 7420  :..        left 
-000586d0: 3d20 696e 7428 726f 756e 6428 7365 6c66  = int(round(self
-000586e0: 2e76 622e 6974 656d 426f 756e 6469 6e67  .vb.itemBounding
-000586f0: 5265 6374 2873 656c 662e 4930 626f 7829  Rect(self.I0box)
-00058700: 2e6c 6566 7428 292c 3029 290d 0a20 2020  .left(),0))..   
-00058710: 2020 2020 2072 6967 6874 203d 2069 6e74       right = int
-00058720: 2872 6f75 6e64 2873 656c 662e 7662 2e69  (round(self.vb.i
-00058730: 7465 6d42 6f75 6e64 696e 6752 6563 7428  temBoundingRect(
-00058740: 7365 6c66 2e49 3062 6f78 292e 7269 6768  self.I0box).righ
-00058750: 7428 292c 3029 290d 0a20 2020 2020 2020  t(),0))..       
-00058760: 2074 6f70 203d 2069 6e74 2872 6f75 6e64   top = int(round
-00058770: 2873 656c 662e 7662 2e69 7465 6d42 6f75  (self.vb.itemBou
-00058780: 6e64 696e 6752 6563 7428 7365 6c66 2e49  ndingRect(self.I
-00058790: 3062 6f78 292e 626f 7474 6f6d 2829 2c30  0box).bottom(),0
-000587a0: 2929 0d0a 2020 2020 2020 2020 626f 7474  ))..        bott
-000587b0: 6f6d 203d 2069 6e74 2872 6f75 6e64 2873  om = int(round(s
-000587c0: 656c 662e 7662 2e69 7465 6d42 6f75 6e64  elf.vb.itemBound
-000587d0: 696e 6752 6563 7428 7365 6c66 2e49 3062  ingRect(self.I0b
-000587e0: 6f78 292e 746f 7028 292c 3029 290d 0a20  ox).top(),0)).. 
-000587f0: 2020 2020 2020 2023 6669 6c6c 2074 6865         #fill the
-00058800: 2073 656c 6563 7469 6f6e 2070 6f6c 7967   selection polyg
-00058810: 6f6e 2077 6974 6820 6f6e 6573 2061 6e64  on with ones and
-00058820: 206d 6170 2074 6f20 696d 6167 6520 636f   map to image co
-00058830: 6f72 6473 0d0a 2020 2020 2020 2020 696f  ords..        io
-00058840: 203d 2073 656c 662e 4930 626f 782e 6765   = self.I0box.ge
-00058850: 7441 7272 6179 5265 6769 6f6e 286e 702e  tArrayRegion(np.
-00058860: 6f6e 6573 2828 7365 6c66 2e73 7461 636b  ones((self.stack
-00058870: 2e6e 5f63 6f6c 732c 7365 6c66 2e73 7461  .n_cols,self.sta
-00058880: 636b 2e6e 5f72 6f77 7329 292c 7365 6c66  ck.n_rows)),self
-00058890: 2e41 6273 496d 6167 6529 0d0a 2020 2020  .AbsImage)..    
-000588a0: 2020 2020 2366 696c 6c20 6c65 6674 2061      #fill left a
-000588b0: 6e64 2072 6967 6874 206d 6172 6769 6e73  nd right margins
-000588c0: 2077 6974 6820 7a65 726f 730d 0a20 2020   with zeros..   
-000588d0: 2020 2020 206c 7a65 726f 7320 3d20 6e70       lzeros = np
-000588e0: 2e7a 6572 6f73 2828 6d61 7828 302c 6c65  .zeros((max(0,le
-000588f0: 6674 292c 6e70 2e73 6861 7065 2869 6f29  ft),np.shape(io)
-00058900: 5b31 5d29 2c20 6474 7970 653d 696f 2e64  [1]), dtype=io.d
-00058910: 7479 7065 290d 0a20 2020 2020 2020 2072  type)..        r
-00058920: 7a65 726f 7320 3d20 6e70 2e7a 6572 6f73  zeros = np.zeros
-00058930: 2828 6d61 7828 302c 7365 6c66 2e73 7461  ((max(0,self.sta
-00058940: 636b 2e6e 5f63 6f6c 732d 7269 6768 7429  ck.n_cols-right)
-00058950: 2c20 6e70 2e73 6861 7065 2869 6f29 5b31  , np.shape(io)[1
-00058960: 5d29 2c20 6474 7970 653d 696f 2e64 7479  ]), dtype=io.dty
-00058970: 7065 290d 0a20 2020 2020 2020 2069 6f20  pe)..        io 
-00058980: 3d20 6e70 2e76 7374 6163 6b28 286c 7a65  = np.vstack((lze
-00058990: 726f 732c 2069 6f2c 727a 6572 6f73 2929  ros, io,rzeros))
-000589a0: 0d0a 2020 2020 2020 2020 2320 6669 6c6c  ..        # fill
-000589b0: 2062 6f74 746f 6d20 616e 6420 746f 7020   bottom and top 
-000589c0: 6d61 7267 696e 7320 7769 7468 207a 6572  margins with zer
-000589d0: 6f73 0d0a 2020 2020 2020 2020 627a 6572  os..        bzer
-000589e0: 6f73 203d 206e 702e 7a65 726f 7328 286e  os = np.zeros((n
-000589f0: 702e 7368 6170 6528 696f 295b 305d 2c28  p.shape(io)[0],(
-00058a00: 6d61 7828 302c 626f 7474 6f6d 2929 292c  max(0,bottom))),
-00058a10: 2064 7479 7065 3d69 6f2e 6474 7970 6529   dtype=io.dtype)
-00058a20: 0d0a 2020 2020 2020 2020 747a 6572 6f73  ..        tzeros
-00058a30: 203d 206e 702e 7a65 726f 7328 286e 702e   = np.zeros((np.
-00058a40: 7368 6170 6528 696f 295b 305d 2c28 6d61  shape(io)[0],(ma
-00058a50: 7828 302c 7365 6c66 2e73 7461 636b 2e6e  x(0,self.stack.n
-00058a60: 5f72 6f77 732d 746f 7029 2929 2c20 6474  _rows-top))), dt
-00058a70: 7970 653d 696f 2e64 7479 7065 290d 0a20  ype=io.dtype).. 
-00058a80: 2020 2020 2020 2069 6f20 3d20 6e70 2e68         io = np.h
-00058a90: 7374 6163 6b28 2862 7a65 726f 732c 2069  stack((bzeros, i
-00058aa0: 6f2c 747a 6572 6f73 2929 0d0a 2020 2020  o,tzeros))..    
-00058ab0: 2020 2020 2364 696c 6174 6520 6d61 736b      #dilate mask
-00058ac0: 2074 6f20 696e 636c 7564 6520 626f 7264   to include bord
-00058ad0: 6572 2070 6978 656c 733a 0d0a 2020 2020  er pixels:..    
-00058ae0: 2020 2020 6966 206c 6566 7420 3c3d 2030      if left <= 0
-00058af0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00058b00: 6f20 3d20 6e64 696d 6167 652e 6269 6e61  o = ndimage.bina
-00058b10: 7279 5f64 696c 6174 696f 6e28 696f 2c73  ry_dilation(io,s
-00058b20: 7472 7563 7475 7265 3d28 5b5b 302c 2031  tructure=([[0, 1
-00058b30: 2c20 305d 2c20 5b30 2c20 312c 2030 5d2c  , 0], [0, 1, 0],
-00058b40: 205b 302c 2030 2c20 305d 5d29 290d 0a20   [0, 0, 0]])).. 
-00058b50: 2020 2020 2020 2069 6620 7269 6768 7420         if right 
-00058b60: 3e3d 2073 656c 662e 7374 6163 6b2e 6e5f  >= self.stack.n_
-00058b70: 636f 6c73 3a0d 0a20 2020 2020 2020 2020  cols:..         
-00058b80: 2020 2069 6f20 3d20 6e64 696d 6167 652e     io = ndimage.
-00058b90: 6269 6e61 7279 5f64 696c 6174 696f 6e28  binary_dilation(
-00058ba0: 696f 2c73 7472 7563 7475 7265 3d28 5b5b  io,structure=([[
-00058bb0: 302c 2030 2c20 305d 2c20 5b30 2c20 312c  0, 0, 0], [0, 1,
-00058bc0: 2030 5d2c 205b 302c 2031 2c20 305d 5d29   0], [0, 1, 0]])
-00058bd0: 290d 0a20 2020 2020 2020 2069 6620 626f  )..        if bo
-00058be0: 7474 6f6d 203c 3d20 303a 0d0a 2020 2020  ttom <= 0:..    
-00058bf0: 2020 2020 2020 2020 696f 203d 206e 6469          io = ndi
-00058c00: 6d61 6765 2e62 696e 6172 795f 6469 6c61  mage.binary_dila
-00058c10: 7469 6f6e 2869 6f2c 7374 7275 6374 7572  tion(io,structur
-00058c20: 653d 285b 5b30 2c20 302c 2030 5d2c 205b  e=([[0, 0, 0], [
-00058c30: 312c 2031 2c20 305d 2c20 5b30 2c20 302c  1, 1, 0], [0, 0,
-00058c40: 2030 5d5d 2929 0d0a 2020 2020 2020 2020   0]]))..        
-00058c50: 6966 2074 6f70 203e 3d20 7365 6c66 2e73  if top >= self.s
-00058c60: 7461 636b 2e6e 5f72 6f77 733a 0d0a 2020  tack.n_rows:..  
-00058c70: 2020 2020 2020 2020 2020 696f 203d 206e            io = n
-00058c80: 6469 6d61 6765 2e62 696e 6172 795f 6469  dimage.binary_di
-00058c90: 6c61 7469 6f6e 2869 6f2c 7374 7275 6374  lation(io,struct
-00058ca0: 7572 653d 285b 5b30 2c20 302c 2030 5d2c  ure=([[0, 0, 0],
-00058cb0: 205b 302c 2031 2c20 315d 2c20 5b30 2c20   [0, 1, 1], [0, 
-00058cc0: 302c 2030 5d5d 2929 0d0a 2020 2020 2020  0, 0]]))..      
-00058cd0: 2020 2363 726f 7020 6d61 736b 2074 6f20    #crop mask to 
-00058ce0: 636f 6d6d 6f6e 2072 6567 696f 6e3a 0d0a  common region:..
-00058cf0: 2020 2020 2020 2020 696f 203d 2069 6f5b          io = io[
-00058d00: 6162 7328 6d69 6e28 6c65 6674 2c30 2929  abs(min(left,0))
-00058d10: 3a73 656c 662e 7374 6163 6b2e 6e5f 636f  :self.stack.n_co
-00058d20: 6c73 2b61 6273 286d 696e 286c 6566 742c  ls+abs(min(left,
-00058d30: 3029 292c 6162 7328 6d69 6e28 626f 7474  0)),abs(min(bott
-00058d40: 6f6d 2c30 2929 3a73 656c 662e 7374 6163  om,0)):self.stac
-00058d50: 6b2e 6e5f 726f 7773 2b61 6273 286d 696e  k.n_rows+abs(min
-00058d60: 2862 6f74 746f 6d2c 3029 295d 0d0a 2020  (bottom,0))]..  
-00058d70: 2020 2020 2020 7365 6c66 2e69 305f 696e        self.i0_in
-00058d80: 6469 6365 7320 3d20 6e70 2e77 6865 7265  dices = np.where
-00058d90: 2869 6f20 3d3d 2031 290d 0a20 2020 2020  (io == 1)..     
-00058da0: 2020 2073 656c 662e 7265 6470 6978 5b3a     self.redpix[:
-00058db0: 2c20 3a5d 203d 205b 302c 2030 2c20 302c  , :] = [0, 0, 0,
-00058dc0: 2030 5d0d 0a20 2020 2020 2020 2073 656c   0]..        sel
-00058dd0: 662e 7265 6470 6978 5b73 656c 662e 6930  f.redpix[self.i0
-00058de0: 5f69 6e64 6963 6573 5d20 3d20 2832 3535  _indices] = (255
-00058df0: 2c30 2c30 2c32 3535 290d 0a20 2020 2020  ,0,0,255)..     
-00058e00: 2020 2073 656c 662e 4d61 736b 496d 6167     self.MaskImag
-00058e10: 652e 7365 7449 6d61 6765 2873 656c 662e  e.setImage(self.
-00058e20: 7265 6470 6978 2c20 6f70 6163 6974 793d  redpix, opacity=
-00058e30: 302e 3329 0d0a 2020 2020 2020 2020 7365  0.3)..        se
-00058e40: 6c66 2e4d 6173 6b49 6d61 6765 2e73 6574  lf.MaskImage.set
-00058e50: 5a56 616c 7565 2831 3029 0d0a 0d0a 2020  ZValue(10)....  
-00058e60: 2020 6465 6620 4f6e 4d6f 7573 6548 6f76    def OnMouseHov
-00058e70: 6572 2873 656c 662c 6576 293a 0d0a 2020  er(self,ev):..  
-00058e80: 2020 2020 2020 706f 7320 3d20 7365 6c66        pos = self
-00058e90: 2e76 622e 6d61 7053 6365 6e65 546f 5669  .vb.mapSceneToVi
-00058ea0: 6577 2865 765b 305d 290d 0a20 2020 2020  ew(ev[0])..     
-00058eb0: 2020 2072 6f69 706f 7320 3d20 706f 732d     roipos = pos-
-00058ec0: 7365 6c66 2e76 622e 6d61 7046 726f 6d56  self.vb.mapFromV
-00058ed0: 6965 7754 6f49 7465 6d28 7365 6c66 2e49  iewToItem(self.I
-00058ee0: 3062 6f78 2c70 6f73 290d 0a20 2020 2020  0box,pos)..     
-00058ef0: 2020 2069 6620 7365 6c66 2e76 622e 6974     if self.vb.it
-00058f00: 656d 426f 756e 6469 6e67 5265 6374 2873  emBoundingRect(s
-00058f10: 656c 662e 4162 7349 6d61 6765 292e 636f  elf.AbsImage).co
-00058f20: 6e74 6169 6e73 2870 6f73 293a 0d0a 2020  ntains(pos):..  
-00058f30: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00058f40: 662e 7662 2e73 6365 6e65 2829 2e63 6c69  f.vb.scene().cli
-00058f50: 636b 4576 656e 7473 3a0d 0a20 2020 2020  ckEvents:..     
-00058f60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00058f70: 4d61 736b 496d 6167 652e 7365 745a 5661  MaskImage.setZVa
-00058f80: 6c75 6528 2d31 3029 0d0a 2020 2020 2020  lue(-10)..      
-00058f90: 2020 2020 2020 2020 2020 7365 6c66 2e49            self.I
-00058fa0: 3062 6f78 2e73 6574 5a56 616c 7565 2831  0box.setZValue(1
-00058fb0: 3029 0d0a 2020 2020 2020 2020 2020 2020  0)..            
-00058fc0: 2020 2020 7365 6c66 2e63 6c69 636b 6465      self.clickde
-00058fd0: 7465 6374 6f72 2e73 7461 7274 2831 3029  tector.start(10)
+00057d50: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
+00057d60: 6566 2064 7261 775f 6869 7374 6f67 7261  ef draw_histogra
+00057d70: 6d28 7365 6c66 293a 0d0a 2020 2020 2020  m(self):..      
+00057d80: 2020 6869 7374 6f67 7261 6d5f 6461 7461    histogram_data
+00057d90: 203d 2020 6e70 2e72 6573 6861 7065 2873   =  np.reshape(s
+00057da0: 656c 662e 7374 6163 6b2e 6869 7374 6f67  elf.stack.histog
+00057db0: 7261 6d2c 2028 7365 6c66 2e73 7461 636b  ram, (self.stack
+00057dc0: 2e6e 5f63 6f6c 732a 7365 6c66 2e73 7461  .n_cols*self.sta
+00057dd0: 636b 2e6e 5f72 6f77 7329 2c20 6f72 6465  ck.n_rows), orde
+00057de0: 723d 2746 2729 0d0a 2020 2020 2020 2020  r='F')..        
+00057df0: 6869 7374 6f67 7261 6d5f 6461 7461 203d  histogram_data =
+00057e00: 2068 6973 746f 6772 616d 5f64 6174 615b   histogram_data[
+00057e10: 7e6e 702e 6973 6e61 6e28 6869 7374 6f67  ~np.isnan(histog
+00057e20: 7261 6d5f 6461 7461 295d 2023 7265 6d6f  ram_data)] #remo
+00057e30: 7665 206e 6f6e 2d66 696e 6974 6520 7661  ve non-finite va
+00057e40: 6c75 6573 0d0a 0d0a 2020 2020 2020 2020  lues....        
+00057e50: 792c 2078 203d 206e 702e 6869 7374 6f67  y, x = np.histog
+00057e60: 7261 6d28 6869 7374 6f67 7261 6d5f 6461  ram(histogram_da
+00057e70: 7461 2c20 6269 6e73 3d31 3030 290d 0a0d  ta, bins=100)...
+00057e80: 0a20 2020 2020 2020 2073 656c 662e 7265  .        self.re
+00057e90: 6769 6f6e 203d 2070 672e 4c69 6e65 6172  gion = pg.Linear
+00057ea0: 5265 6769 6f6e 4974 656d 2862 7275 7368  RegionItem(brush
+00057eb0: 3d5b 3235 352c 302c 302c 3435 5d2c 626f  =[255,0,0,45],bo
+00057ec0: 756e 6473 3d5b 6e70 2e6d 696e 2878 292c  unds=[np.min(x),
+00057ed0: 6e70 2e6d 6178 2878 295d 290d 0a0d 0a20  np.max(x)]).... 
+00057ee0: 2020 2020 2020 2073 656c 662e 7265 6769         self.regi
+00057ef0: 6f6e 2e73 6574 5a56 616c 7565 2831 3029  on.setZValue(10)
+00057f00: 0d0a 0d0a 2020 2020 2020 2020 706c 6f74  ....        plot
+00057f10: 203d 2073 656c 662e 4869 7374 6f57 6964   = self.HistoWid
+00057f20: 6765 740d 0a20 2020 2020 2020 2070 6c6f  get..        plo
+00057f30: 742e 6164 6449 7465 6d28 7365 6c66 2e72  t.addItem(self.r
+00057f40: 6567 696f 6e2c 2069 676e 6f72 6542 6f75  egion, ignoreBou
+00057f50: 6e64 733d 4661 6c73 6529 0d0a 2020 2020  nds=False)..    
+00057f60: 2020 2020 706c 6f74 2e73 6574 4d6f 7573      plot.setMous
+00057f70: 6545 6e61 626c 6564 2878 3d46 616c 7365  eEnabled(x=False
+00057f80: 2c20 793d 4661 6c73 6529 0d0a 2020 2020  , y=False)..    
+00057f90: 2020 2020 706c 6f74 2e73 686f 7747 7269      plot.showGri
+00057fa0: 6428 793d 5472 7565 290d 0a0d 0a20 2020  d(y=True)....   
+00057fb0: 2020 2020 2070 6c6f 742e 7368 6f77 4178       plot.showAx
+00057fc0: 6973 2822 746f 7022 2c20 7368 6f77 3d54  is("top", show=T
+00057fd0: 7275 6529 0d0a 2020 2020 2020 2020 706c  rue)..        pl
+00057fe0: 6f74 2e73 686f 7741 7869 7328 2272 6967  ot.showAxis("rig
+00057ff0: 6874 222c 2073 686f 773d 5472 7565 290d  ht", show=True).
+00058000: 0a20 2020 2020 2020 2062 7920 3d20 706c  .        by = pl
+00058010: 6f74 2e67 6574 4178 6973 2822 7269 6768  ot.getAxis("righ
+00058020: 7422 290d 0a20 2020 2020 2020 2062 7820  t")..        bx 
+00058030: 3d20 706c 6f74 2e67 6574 4178 6973 2822  = plot.getAxis("
+00058040: 746f 7022 290d 0a20 2020 2020 2020 2062  top")..        b
+00058050: 792e 7365 7453 7479 6c65 2873 686f 7756  y.setStyle(showV
+00058060: 616c 7565 733d 4661 6c73 652c 7469 636b  alues=False,tick
+00058070: 4c65 6e67 7468 3d30 290d 0a20 2020 2020  Length=0)..     
+00058080: 2020 2062 782e 7365 7453 7479 6c65 2873     bx.setStyle(s
+00058090: 686f 7756 616c 7565 733d 4661 6c73 652c  howValues=False,
+000580a0: 7469 636b 4c65 6e67 7468 3d30 290d 0a20  tickLength=0).. 
+000580b0: 2020 2020 2020 2061 7920 3d20 706c 6f74         ay = plot
+000580c0: 2e67 6574 4178 6973 2822 6c65 6674 2229  .getAxis("left")
+000580d0: 0d0a 2020 2020 2020 2020 6178 203d 2070  ..        ax = p
+000580e0: 6c6f 742e 6765 7441 7869 7328 2262 6f74  lot.getAxis("bot
+000580f0: 746f 6d22 290d 0a0d 0a20 2020 2020 2020  tom")....       
+00058100: 2061 782e 7365 744c 6162 656c 2874 6578   ax.setLabel(tex
+00058110: 743d 2241 7665 7261 6765 2046 6c75 7822  t="Average Flux"
+00058120: 290d 0a20 2020 2020 2020 2023 2320 4c69  )..        ## Li
+00058130: 7474 6c65 2068 6163 6b20 746f 2064 6973  ttle hack to dis
+00058140: 706c 6179 2076 6572 7469 6361 6c20 6178  play vertical ax
+00058150: 6973 2061 7320 6c6f 672e 0d0a 2020 2020  is as log...    
+00058160: 2020 2020 706c 6f74 2e67 6574 5669 6577      plot.getView
+00058170: 426f 7828 292e 7365 744c 696d 6974 7328  Box().setLimits(
+00058180: 794d 696e 3d30 2c79 4d61 783d 6e70 2e6d  yMin=0,yMax=np.m
+00058190: 6178 2879 2929 0d0a 2020 2020 2020 2020  ax(y))..        
+000581a0: 6179 2e73 6574 4c61 6265 6c28 7465 7874  ay.setLabel(text
+000581b0: 3d22 6c6f 673c 7375 623e 3130 3c2f 7375  ="log<sub>10</su
+000581c0: 623e 2028 4e75 6d62 6572 206f 6620 7069  b> (Number of pi
+000581d0: 7865 6c73 2922 290d 0a20 2020 2020 2020  xels)")..       
+000581e0: 2079 5b79 203c 2031 5d20 3d20 310d 0a20   y[y < 1] = 1.. 
+000581f0: 2020 2020 2020 2079 203d 206e 702e 6c6f         y = np.lo
+00058200: 6731 3028 7929 0d0a 2020 2020 2020 2020  g10(y)..        
+00058210: 706c 6f74 2e73 6574 4c6f 674d 6f64 6528  plot.setLogMode(
+00058220: 783d 4661 6c73 652c 2079 3d46 616c 7365  x=False, y=False
+00058230: 2920 2323 204c 6f67 206d 6f64 6520 6973  ) ## Log mode is
+00058240: 206e 6f74 2077 6f72 6b69 6e67 2063 6f72   not working cor
+00058250: 7265 6374 6c79 2061 7420 7468 6520 6d6f  rectly at the mo
+00058260: 6d65 6e74 2e0d 0a20 2020 2020 2020 2023  ment...        #
+00058270: 230d 0a20 2020 2020 2020 2070 6c6f 742e  #..        plot.
+00058280: 706c 6f74 2878 2c20 792c 2073 7465 704d  plot(x, y, stepM
+00058290: 6f64 653d 5472 7565 2c20 6669 6c6c 4c65  ode=True, fillLe
+000582a0: 7665 6c3d 302c 2062 7275 7368 3d28 302c  vel=0, brush=(0,
+000582b0: 2030 2c20 3235 352c 2031 3530 2929 0d0a   0, 255, 150))..
+000582c0: 2020 2020 2020 2020 6465 6620 7570 6461          def upda
+000582d0: 7465 2872 6567 696f 6e29 3a0d 0a20 2020  te(region):..   
+000582e0: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
+000582f0: 6769 6f6e 2e73 6574 5a56 616c 7565 2831  gion.setZValue(1
+00058300: 3029 0d0a 2020 2020 2020 2020 2020 2020  0)..            
+00058310: 6d69 6e58 2c20 6d61 7858 203d 2072 6567  minX, maxX = reg
+00058320: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
+00058330: 2073 656c 662e 6472 6177 5f69 6d61 6765   self.draw_image
+00058340: 286d 696e 582c 206d 6178 5829 0d0a 2020  (minX, maxX)..  
+00058350: 2020 2020 2020 2020 2020 7365 6c66 2e53            self.S
+00058360: 6574 7570 524f 4928 290d 0a20 2020 2020  etupROI()..     
+00058370: 2020 2020 2020 2073 656c 662e 4d61 736b         self.Mask
+00058380: 496d 6167 652e 7365 745a 5661 6c75 6528  Image.setZValue(
+00058390: 3130 290d 0a0d 0a20 2020 2020 2020 2073  10)....        s
+000583a0: 656c 662e 7265 6769 6f6e 2e73 6574 5265  elf.region.setRe
+000583b0: 6769 6f6e 2828 7365 6c66 2e68 6973 746d  gion((self.histm
+000583c0: 696e 2c73 656c 662e 6869 7374 6d61 7829  in,self.histmax)
+000583d0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000583e0: 7265 6769 6f6e 2e73 6967 5265 6769 6f6e  region.sigRegion
+000583f0: 4368 616e 6765 642e 636f 6e6e 6563 7428  Changed.connect(
+00058400: 6c61 6d62 6461 3a20 7570 6461 7465 2873  lambda: update(s
+00058410: 656c 662e 7265 6769 6f6e 2e67 6574 5265  elf.region.getRe
+00058420: 6769 6f6e 2829 2929 0d0a 232d 2d2d 2d2d  gion()))..#-----
+00058430: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00058440: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00058450: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00058460: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00058470: 2d0d 0a20 2020 2064 6566 204f 6e52 656c  -..    def OnRel
+00058480: 6561 7365 2873 656c 6629 3a0d 0a20 2020  ease(self):..   
+00058490: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+000584a0: 2e76 622e 7363 656e 6528 292e 636c 6963  .vb.scene().clic
+000584b0: 6b45 7665 6e74 733a 0d0a 2020 2020 2020  kEvents:..      
+000584c0: 2020 2020 2020 7365 6c66 2e70 726f 7879        self.proxy
+000584d0: 2e62 6c6f 636b 203d 2054 7275 650d 0a20  .block = True.. 
+000584e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000584f0: 4472 6177 524f 4928 290d 0a20 2020 2020  DrawROI()..     
+00058500: 2020 2020 2020 2023 7365 6c66 2e49 3069         #self.I0i
+00058510: 6e73 7472 7563 7469 6f6e 732e 7365 7454  nstructions.setT
+00058520: 6578 7428 2244 7261 6720 7468 6520 706f  ext("Drag the po
+00058530: 6c79 676f 6e20 6f72 2074 6865 2068 616e  lygon or the han
+00058540: 646c 6573 2e20 4164 6420 6861 6e64 6c65  dles. Add handle
+00058550: 7320 6279 2063 6c69 636b 696e 6720 6f6e  s by clicking on
+00058560: 2061 206c 696e 6520 7365 676d 656e 742e   a line segment.
+00058570: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00058580: 6966 2073 656c 662e 7261 6469 6f4c 6173  if self.radioLas
+00058590: 736f 524f 492e 6973 4368 6563 6b65 6428  soROI.isChecked(
+000585a0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000585b0: 2020 2020 7365 6c66 2e6c 6173 736f 706f      self.lassopo
+000585c0: 696e 7473 3d20 5b5d 0d0a 2020 2020 2020  ints= []..      
+000585d0: 2020 2020 2020 2020 2020 7365 6c66 2e49            self.I
+000585e0: 3069 6e73 7472 7563 7469 6f6e 732e 7365  0instructions.se
+000585f0: 7454 6578 7428 2222 290d 0a20 2020 2020  tText("")..     
+00058600: 2020 2020 2020 2020 2020 2077 6869 6c65             while
+00058610: 206c 656e 2873 656c 662e 4930 626f 782e   len(self.I0box.
+00058620: 6765 7448 616e 646c 6573 2829 2920 3e20  getHandles()) > 
+00058630: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
+00058640: 2020 2020 2020 2020 7365 6c66 2e49 3062          self.I0b
+00058650: 6f78 2e72 656d 6f76 6548 616e 646c 6528  ox.removeHandle(
+00058660: 7365 6c66 2e49 3062 6f78 2e67 6574 4861  self.I0box.getHa
+00058670: 6e64 6c65 7328 295b 305d 2c20 7570 6461  ndles()[0], upda
+00058680: 7465 5365 676d 656e 7473 3d54 7275 6529  teSegments=True)
+00058690: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000586a0: 6c66 2e49 3062 6f78 2e73 6967 5265 6769  lf.I0box.sigRegi
+000586b0: 6f6e 4368 616e 6765 4669 6e69 7368 6564  onChangeFinished
+000586c0: 2e63 6f6e 6e65 6374 2873 656c 662e 4472  .connect(self.Dr
+000586d0: 6177 524f 4929 0d0a 2020 2020 2020 2020  awROI)..        
+000586e0: 2020 2020 7365 6c66 2e63 6c69 636b 6465      self.clickde
+000586f0: 7465 6374 6f72 2e73 746f 7028 290d 0a0d  tector.stop()...
+00058700: 0a0d 0a20 2020 2064 6566 2044 7261 7752  ...    def DrawR
+00058710: 4f49 2873 656c 6629 3a0d 0a20 2020 2020  OI(self):..     
+00058720: 2020 206c 6566 7420 3d20 696e 7428 726f     left = int(ro
+00058730: 756e 6428 7365 6c66 2e76 622e 6974 656d  und(self.vb.item
+00058740: 426f 756e 6469 6e67 5265 6374 2873 656c  BoundingRect(sel
+00058750: 662e 4930 626f 7829 2e6c 6566 7428 292c  f.I0box).left(),
+00058760: 3029 290d 0a20 2020 2020 2020 2072 6967  0))..        rig
+00058770: 6874 203d 2069 6e74 2872 6f75 6e64 2873  ht = int(round(s
+00058780: 656c 662e 7662 2e69 7465 6d42 6f75 6e64  elf.vb.itemBound
+00058790: 696e 6752 6563 7428 7365 6c66 2e49 3062  ingRect(self.I0b
+000587a0: 6f78 292e 7269 6768 7428 292c 3029 290d  ox).right(),0)).
+000587b0: 0a20 2020 2020 2020 2074 6f70 203d 2069  .        top = i
+000587c0: 6e74 2872 6f75 6e64 2873 656c 662e 7662  nt(round(self.vb
+000587d0: 2e69 7465 6d42 6f75 6e64 696e 6752 6563  .itemBoundingRec
+000587e0: 7428 7365 6c66 2e49 3062 6f78 292e 626f  t(self.I0box).bo
+000587f0: 7474 6f6d 2829 2c30 2929 0d0a 2020 2020  ttom(),0))..    
+00058800: 2020 2020 626f 7474 6f6d 203d 2069 6e74      bottom = int
+00058810: 2872 6f75 6e64 2873 656c 662e 7662 2e69  (round(self.vb.i
+00058820: 7465 6d42 6f75 6e64 696e 6752 6563 7428  temBoundingRect(
+00058830: 7365 6c66 2e49 3062 6f78 292e 746f 7028  self.I0box).top(
+00058840: 292c 3029 290d 0a20 2020 2020 2020 2023  ),0))..        #
+00058850: 6669 6c6c 2074 6865 2073 656c 6563 7469  fill the selecti
+00058860: 6f6e 2070 6f6c 7967 6f6e 2077 6974 6820  on polygon with 
+00058870: 6f6e 6573 2061 6e64 206d 6170 2074 6f20  ones and map to 
+00058880: 696d 6167 6520 636f 6f72 6473 0d0a 2020  image coords..  
+00058890: 2020 2020 2020 696f 203d 2073 656c 662e        io = self.
+000588a0: 4930 626f 782e 6765 7441 7272 6179 5265  I0box.getArrayRe
+000588b0: 6769 6f6e 286e 702e 6f6e 6573 2828 7365  gion(np.ones((se
+000588c0: 6c66 2e73 7461 636b 2e6e 5f63 6f6c 732c  lf.stack.n_cols,
+000588d0: 7365 6c66 2e73 7461 636b 2e6e 5f72 6f77  self.stack.n_row
+000588e0: 7329 292c 7365 6c66 2e41 6273 496d 6167  s)),self.AbsImag
+000588f0: 6529 0d0a 2020 2020 2020 2020 2366 696c  e)..        #fil
+00058900: 6c20 6c65 6674 2061 6e64 2072 6967 6874  l left and right
+00058910: 206d 6172 6769 6e73 2077 6974 6820 7a65   margins with ze
+00058920: 726f 730d 0a20 2020 2020 2020 206c 7a65  ros..        lze
+00058930: 726f 7320 3d20 6e70 2e7a 6572 6f73 2828  ros = np.zeros((
+00058940: 6d61 7828 302c 6c65 6674 292c 6e70 2e73  max(0,left),np.s
+00058950: 6861 7065 2869 6f29 5b31 5d29 2c20 6474  hape(io)[1]), dt
+00058960: 7970 653d 696f 2e64 7479 7065 290d 0a20  ype=io.dtype).. 
+00058970: 2020 2020 2020 2072 7a65 726f 7320 3d20         rzeros = 
+00058980: 6e70 2e7a 6572 6f73 2828 6d61 7828 302c  np.zeros((max(0,
+00058990: 7365 6c66 2e73 7461 636b 2e6e 5f63 6f6c  self.stack.n_col
+000589a0: 732d 7269 6768 7429 2c20 6e70 2e73 6861  s-right), np.sha
+000589b0: 7065 2869 6f29 5b31 5d29 2c20 6474 7970  pe(io)[1]), dtyp
+000589c0: 653d 696f 2e64 7479 7065 290d 0a20 2020  e=io.dtype)..   
+000589d0: 2020 2020 2069 6f20 3d20 6e70 2e76 7374       io = np.vst
+000589e0: 6163 6b28 286c 7a65 726f 732c 2069 6f2c  ack((lzeros, io,
+000589f0: 727a 6572 6f73 2929 0d0a 2020 2020 2020  rzeros))..      
+00058a00: 2020 2320 6669 6c6c 2062 6f74 746f 6d20    # fill bottom 
+00058a10: 616e 6420 746f 7020 6d61 7267 696e 7320  and top margins 
+00058a20: 7769 7468 207a 6572 6f73 0d0a 2020 2020  with zeros..    
+00058a30: 2020 2020 627a 6572 6f73 203d 206e 702e      bzeros = np.
+00058a40: 7a65 726f 7328 286e 702e 7368 6170 6528  zeros((np.shape(
+00058a50: 696f 295b 305d 2c28 6d61 7828 302c 626f  io)[0],(max(0,bo
+00058a60: 7474 6f6d 2929 292c 2064 7479 7065 3d69  ttom))), dtype=i
+00058a70: 6f2e 6474 7970 6529 0d0a 2020 2020 2020  o.dtype)..      
+00058a80: 2020 747a 6572 6f73 203d 206e 702e 7a65    tzeros = np.ze
+00058a90: 726f 7328 286e 702e 7368 6170 6528 696f  ros((np.shape(io
+00058aa0: 295b 305d 2c28 6d61 7828 302c 7365 6c66  )[0],(max(0,self
+00058ab0: 2e73 7461 636b 2e6e 5f72 6f77 732d 746f  .stack.n_rows-to
+00058ac0: 7029 2929 2c20 6474 7970 653d 696f 2e64  p))), dtype=io.d
+00058ad0: 7479 7065 290d 0a20 2020 2020 2020 2069  type)..        i
+00058ae0: 6f20 3d20 6e70 2e68 7374 6163 6b28 2862  o = np.hstack((b
+00058af0: 7a65 726f 732c 2069 6f2c 747a 6572 6f73  zeros, io,tzeros
+00058b00: 2929 0d0a 2020 2020 2020 2020 2364 696c  ))..        #dil
+00058b10: 6174 6520 6d61 736b 2074 6f20 696e 636c  ate mask to incl
+00058b20: 7564 6520 626f 7264 6572 2070 6978 656c  ude border pixel
+00058b30: 733a 0d0a 2020 2020 2020 2020 6966 206c  s:..        if l
+00058b40: 6566 7420 3c3d 2030 3a0d 0a20 2020 2020  eft <= 0:..     
+00058b50: 2020 2020 2020 2069 6f20 3d20 6e64 696d         io = ndim
+00058b60: 6167 652e 6269 6e61 7279 5f64 696c 6174  age.binary_dilat
+00058b70: 696f 6e28 696f 2c73 7472 7563 7475 7265  ion(io,structure
+00058b80: 3d28 5b5b 302c 2031 2c20 305d 2c20 5b30  =([[0, 1, 0], [0
+00058b90: 2c20 312c 2030 5d2c 205b 302c 2030 2c20  , 1, 0], [0, 0, 
+00058ba0: 305d 5d29 290d 0a20 2020 2020 2020 2069  0]]))..        i
+00058bb0: 6620 7269 6768 7420 3e3d 2073 656c 662e  f right >= self.
+00058bc0: 7374 6163 6b2e 6e5f 636f 6c73 3a0d 0a20  stack.n_cols:.. 
+00058bd0: 2020 2020 2020 2020 2020 2069 6f20 3d20             io = 
+00058be0: 6e64 696d 6167 652e 6269 6e61 7279 5f64  ndimage.binary_d
+00058bf0: 696c 6174 696f 6e28 696f 2c73 7472 7563  ilation(io,struc
+00058c00: 7475 7265 3d28 5b5b 302c 2030 2c20 305d  ture=([[0, 0, 0]
+00058c10: 2c20 5b30 2c20 312c 2030 5d2c 205b 302c  , [0, 1, 0], [0,
+00058c20: 2031 2c20 305d 5d29 290d 0a20 2020 2020   1, 0]]))..     
+00058c30: 2020 2069 6620 626f 7474 6f6d 203c 3d20     if bottom <= 
+00058c40: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
+00058c50: 696f 203d 206e 6469 6d61 6765 2e62 696e  io = ndimage.bin
+00058c60: 6172 795f 6469 6c61 7469 6f6e 2869 6f2c  ary_dilation(io,
+00058c70: 7374 7275 6374 7572 653d 285b 5b30 2c20  structure=([[0, 
+00058c80: 302c 2030 5d2c 205b 312c 2031 2c20 305d  0, 0], [1, 1, 0]
+00058c90: 2c20 5b30 2c20 302c 2030 5d5d 2929 0d0a  , [0, 0, 0]]))..
+00058ca0: 2020 2020 2020 2020 6966 2074 6f70 203e          if top >
+00058cb0: 3d20 7365 6c66 2e73 7461 636b 2e6e 5f72  = self.stack.n_r
+00058cc0: 6f77 733a 0d0a 2020 2020 2020 2020 2020  ows:..          
+00058cd0: 2020 696f 203d 206e 6469 6d61 6765 2e62    io = ndimage.b
+00058ce0: 696e 6172 795f 6469 6c61 7469 6f6e 2869  inary_dilation(i
+00058cf0: 6f2c 7374 7275 6374 7572 653d 285b 5b30  o,structure=([[0
+00058d00: 2c20 302c 2030 5d2c 205b 302c 2031 2c20  , 0, 0], [0, 1, 
+00058d10: 315d 2c20 5b30 2c20 302c 2030 5d5d 2929  1], [0, 0, 0]]))
+00058d20: 0d0a 2020 2020 2020 2020 2363 726f 7020  ..        #crop 
+00058d30: 6d61 736b 2074 6f20 636f 6d6d 6f6e 2072  mask to common r
+00058d40: 6567 696f 6e3a 0d0a 2020 2020 2020 2020  egion:..        
+00058d50: 696f 203d 2069 6f5b 6162 7328 6d69 6e28  io = io[abs(min(
+00058d60: 6c65 6674 2c30 2929 3a73 656c 662e 7374  left,0)):self.st
+00058d70: 6163 6b2e 6e5f 636f 6c73 2b61 6273 286d  ack.n_cols+abs(m
+00058d80: 696e 286c 6566 742c 3029 292c 6162 7328  in(left,0)),abs(
+00058d90: 6d69 6e28 626f 7474 6f6d 2c30 2929 3a73  min(bottom,0)):s
+00058da0: 656c 662e 7374 6163 6b2e 6e5f 726f 7773  elf.stack.n_rows
+00058db0: 2b61 6273 286d 696e 2862 6f74 746f 6d2c  +abs(min(bottom,
+00058dc0: 3029 295d 0d0a 2020 2020 2020 2020 7365  0))]..        se
+00058dd0: 6c66 2e69 305f 696e 6469 6365 7320 3d20  lf.i0_indices = 
+00058de0: 6e70 2e77 6865 7265 2869 6f20 3d3d 2031  np.where(io == 1
+00058df0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00058e00: 7265 6470 6978 5b3a 2c20 3a5d 203d 205b  redpix[:, :] = [
+00058e10: 302c 2030 2c20 302c 2030 5d0d 0a20 2020  0, 0, 0, 0]..   
+00058e20: 2020 2020 2073 656c 662e 7265 6470 6978       self.redpix
+00058e30: 5b73 656c 662e 6930 5f69 6e64 6963 6573  [self.i0_indices
+00058e40: 5d20 3d20 2832 3535 2c30 2c30 2c32 3535  ] = (255,0,0,255
+00058e50: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00058e60: 4d61 736b 496d 6167 652e 7365 7449 6d61  MaskImage.setIma
+00058e70: 6765 2873 656c 662e 7265 6470 6978 2c20  ge(self.redpix, 
+00058e80: 6f70 6163 6974 793d 302e 3329 0d0a 2020  opacity=0.3)..  
+00058e90: 2020 2020 2020 7365 6c66 2e4d 6173 6b49        self.MaskI
+00058ea0: 6d61 6765 2e73 6574 5a56 616c 7565 2831  mage.setZValue(1
+00058eb0: 3029 0d0a 0d0a 2020 2020 6465 6620 4f6e  0)....    def On
+00058ec0: 4d6f 7573 6548 6f76 6572 2873 656c 662c  MouseHover(self,
+00058ed0: 6576 293a 0d0a 2020 2020 2020 2020 706f  ev):..        po
+00058ee0: 7320 3d20 7365 6c66 2e76 622e 6d61 7053  s = self.vb.mapS
+00058ef0: 6365 6e65 546f 5669 6577 2865 765b 305d  ceneToView(ev[0]
+00058f00: 290d 0a20 2020 2020 2020 2072 6f69 706f  )..        roipo
+00058f10: 7320 3d20 706f 732d 7365 6c66 2e76 622e  s = pos-self.vb.
+00058f20: 6d61 7046 726f 6d56 6965 7754 6f49 7465  mapFromViewToIte
+00058f30: 6d28 7365 6c66 2e49 3062 6f78 2c70 6f73  m(self.I0box,pos
+00058f40: 290d 0a20 2020 2020 2020 2069 6620 7365  )..        if se
+00058f50: 6c66 2e76 622e 6974 656d 426f 756e 6469  lf.vb.itemBoundi
+00058f60: 6e67 5265 6374 2873 656c 662e 4162 7349  ngRect(self.AbsI
+00058f70: 6d61 6765 292e 636f 6e74 6169 6e73 2870  mage).contains(p
+00058f80: 6f73 293a 0d0a 2020 2020 2020 2020 2020  os):..          
+00058f90: 2020 6966 2073 656c 662e 7662 2e73 6365    if self.vb.sce
+00058fa0: 6e65 2829 2e63 6c69 636b 4576 656e 7473  ne().clickEvents
+00058fb0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00058fc0: 2020 2073 656c 662e 4d61 736b 496d 6167     self.MaskImag
+00058fd0: 652e 7365 745a 5661 6c75 6528 2d31 3029  e.setZValue(-10)
 00058fe0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00058ff0: 2020 6966 2073 656c 662e 7261 6469 6f4c    if self.radioL
-00059000: 6173 736f 524f 492e 6973 4368 6563 6b65  assoROI.isChecke
-00059010: 6428 293a 0d0a 2020 2020 2020 2020 2020  d():..          
-00059020: 2020 2020 2020 2020 2020 6861 6e64 6c65            handle
-00059030: 203d 2073 656c 662e 4930 626f 782e 6164   = self.I0box.ad
-00059040: 6446 7265 6548 616e 646c 6528 286e 702e  dFreeHandle((np.
-00059050: 726f 756e 6428 706f 732e 7828 292d 726f  round(pos.x()-ro
-00059060: 6970 6f73 2e78 2829 2c30 292c 6e70 2e72  ipos.x(),0),np.r
-00059070: 6f75 6e64 2870 6f73 2e79 2829 2d72 6f69  ound(pos.y()-roi
-00059080: 706f 732e 7928 292c 3029 2929 0d0a 2020  pos.y(),0)))..  
-00059090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000590a0: 2020 7365 6c66 2e6c 6173 736f 706f 696e    self.lassopoin
-000590b0: 7473 2e61 7070 656e 6428 6861 6e64 6c65  ts.append(handle
-000590c0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000590d0: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
-000590e0: 6c66 2e6c 6173 736f 706f 696e 7473 2920  lf.lassopoints) 
-000590f0: 3e20 313a 0d0a 2020 2020 2020 2020 2020  > 1:..          
-00059100: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00059110: 6c66 2e49 3062 6f78 2e61 6464 5365 676d  lf.I0box.addSegm
-00059120: 656e 7428 7365 6c66 2e6c 6173 736f 706f  ent(self.lassopo
-00059130: 696e 7473 5b30 5d2c 2073 656c 662e 6c61  ints[0], self.la
-00059140: 7373 6f70 6f69 6e74 735b 315d 290d 0a20  ssopoints[1]).. 
+00058ff0: 2020 7365 6c66 2e49 3062 6f78 2e73 6574    self.I0box.set
+00059000: 5a56 616c 7565 2831 3029 0d0a 2020 2020  ZValue(10)..    
+00059010: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00059020: 2e63 6c69 636b 6465 7465 6374 6f72 2e73  .clickdetector.s
+00059030: 7461 7274 2831 3029 0d0a 2020 2020 2020  tart(10)..      
+00059040: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00059050: 662e 7261 6469 6f4c 6173 736f 524f 492e  f.radioLassoROI.
+00059060: 6973 4368 6563 6b65 6428 293a 0d0a 2020  isChecked():..  
+00059070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059080: 2020 6861 6e64 6c65 203d 2073 656c 662e    handle = self.
+00059090: 4930 626f 782e 6164 6446 7265 6548 616e  I0box.addFreeHan
+000590a0: 646c 6528 286e 702e 726f 756e 6428 706f  dle((np.round(po
+000590b0: 732e 7828 292d 726f 6970 6f73 2e78 2829  s.x()-roipos.x()
+000590c0: 2c30 292c 6e70 2e72 6f75 6e64 2870 6f73  ,0),np.round(pos
+000590d0: 2e79 2829 2d72 6f69 706f 732e 7928 292c  .y()-roipos.y(),
+000590e0: 3029 2929 0d0a 2020 2020 2020 2020 2020  0)))..          
+000590f0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+00059100: 6173 736f 706f 696e 7473 2e61 7070 656e  assopoints.appen
+00059110: 6428 6861 6e64 6c65 290d 0a20 2020 2020  d(handle)..     
+00059120: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00059130: 6620 6c65 6e28 7365 6c66 2e6c 6173 736f  f len(self.lasso
+00059140: 706f 696e 7473 2920 3e20 313a 0d0a 2020  points) > 1:..  
 00059150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059160: 2020 2020 2020 2073 656c 662e 6c61 7373         self.lass
-00059170: 6f70 6f69 6e74 732e 706f 7028 3029 0d0a  opoints.pop(0)..
-00059180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059190: 2323 2050 6f6c 7967 6f6e 2052 4f49 2069  ## Polygon ROI i
-000591a0: 7320 6375 7272 656e 746c 7920 6272 6f6b  s currently brok
-000591b0: 656e 2069 6e20 7265 6365 6e74 2070 7971  en in recent pyq
-000591c0: 7467 7261 7068 2076 6572 7369 6f6e 0d0a  tgraph version..
-000591d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000591e0: 2320 656c 6966 2073 656c 662e 7261 6469  # elif self.radi
-000591f0: 6f50 6f6c 7952 4f49 2e69 7343 6865 636b  oPolyROI.isCheck
-00059200: 6564 2829 3a0d 0a20 2020 2020 2020 2020  ed():..         
-00059210: 2020 2020 2020 2023 2020 2020 206f 7269         #     ori
-00059220: 6769 6e20 3d20 7365 6c66 2e76 622e 6d61  gin = self.vb.ma
-00059230: 7053 6365 6e65 546f 5669 6577 2873 656c  pSceneToView(sel
-00059240: 662e 7662 2e73 6365 6e65 2829 2e63 6c69  f.vb.scene().cli
-00059250: 636b 4576 656e 7473 5b30 5d2e 7363 656e  ckEvents[0].scen
-00059260: 6550 6f73 2829 290d 0a20 2020 2020 2020  ePos())..       
-00059270: 2020 2020 2020 2020 2023 2020 2020 2069           #     i
-00059280: 6620 6f72 6967 696e 2e78 2829 203c 2030  f origin.x() < 0
-00059290: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000592a0: 2020 2023 2020 2020 2020 2020 2078 3020     #         x0 
-000592b0: 3d20 302d 726f 6970 6f73 2e78 2829 0d0a  = 0-roipos.x()..
-000592c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000592d0: 2320 2020 2020 656c 6966 206f 7269 6769  #     elif origi
-000592e0: 6e2e 7828 2920 3e20 7365 6c66 2e73 7461  n.x() > self.sta
-000592f0: 636b 2e6e 5f63 6f6c 733a 0d0a 2020 2020  ck.n_cols:..    
-00059300: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-00059310: 2020 2020 2020 7830 203d 2073 656c 662e        x0 = self.
-00059320: 7374 6163 6b2e 6e5f 636f 6c73 202d 2072  stack.n_cols - r
-00059330: 6f69 706f 732e 7828 290d 0a20 2020 2020  oipos.x()..     
-00059340: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00059350: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00059360: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-00059370: 2020 7830 203d 206e 702e 726f 756e 6428    x0 = np.round(
-00059380: 6f72 6967 696e 2e78 2829 2d72 6f69 706f  origin.x()-roipo
-00059390: 732e 7828 292c 3029 0d0a 2020 2020 2020  s.x(),0)..      
-000593a0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-000593b0: 6966 206f 7269 6769 6e2e 7928 2920 3c20  if origin.y() < 
-000593c0: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-000593d0: 2020 2020 2320 2020 2020 2020 2020 7930      #         y0
-000593e0: 203d 2030 2d72 6f69 706f 732e 7928 290d   = 0-roipos.y().
-000593f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00059400: 2023 2020 2020 2065 6c69 6620 6f72 6967   #     elif orig
-00059410: 696e 2e79 2829 203e 2073 656c 662e 7374  in.y() > self.st
-00059420: 6163 6b2e 6e5f 726f 7773 3a0d 0a20 2020  ack.n_rows:..   
-00059430: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-00059440: 2020 2020 2020 2079 3020 3d20 7365 6c66         y0 = self
-00059450: 2e73 7461 636b 2e6e 5f72 6f77 7320 2d20  .stack.n_rows - 
-00059460: 726f 6970 6f73 2e79 2829 0d0a 2020 2020  roipos.y()..    
-00059470: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-00059480: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00059490: 2020 2020 2020 2020 2023 2020 2020 2020           #      
-000594a0: 2020 2079 3020 3d20 6e70 2e72 6f75 6e64     y0 = np.round
-000594b0: 286f 7269 6769 6e2e 7928 292d 726f 6970  (origin.y()-roip
-000594c0: 6f73 2e79 2829 2c30 290d 0a20 2020 2020  os.y(),0)..     
-000594d0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-000594e0: 2073 656c 662e 4930 626f 782e 7365 7450   self.I0box.setP
-000594f0: 6f69 6e74 7328 5b28 6e70 2e72 6f75 6e64  oints([(np.round
-00059500: 2870 6f73 2e78 2829 2d72 6f69 706f 732e  (pos.x()-roipos.
-00059510: 7828 292c 3029 2c6e 702e 726f 756e 6428  x(),0),np.round(
-00059520: 706f 732e 7928 292d 726f 6970 6f73 2e79  pos.y()-roipos.y
-00059530: 2829 2c30 2929 2c20 2878 302c 6e70 2e72  (),0)), (x0,np.r
-00059540: 6f75 6e64 2870 6f73 2e79 2829 2d72 6f69  ound(pos.y()-roi
-00059550: 706f 732e 7928 292c 3029 292c 2878 302c  pos.y(),0)),(x0,
-00059560: 7930 292c 286e 702e 726f 756e 6428 706f  y0),(np.round(po
-00059570: 732e 7828 292d 726f 6970 6f73 2e78 2829  s.x()-roipos.x()
-00059580: 2c30 292c 7930 295d 2c20 636c 6f73 6564  ,0),y0)], closed
-00059590: 3d54 7275 6529 0d0a 0d0a 2020 2020 6465  =True)....    de
-000595a0: 6620 6472 6177 5f69 6d61 6765 2873 656c  f draw_image(sel
-000595b0: 662c 666c 7578 6d69 6e2c 2066 6c75 786d  f,fluxmin, fluxm
-000595c0: 6178 293a 0d0a 2020 2020 2020 2020 7365  ax):..        se
-000595d0: 6c66 2e49 3069 6e73 7472 7563 7469 6f6e  lf.I0instruction
-000595e0: 732e 7365 7454 6578 7428 0d0a 2020 2020  s.setText(..    
-000595f0: 2020 2020 2020 2020 2253 656c 6563 7420          "Select 
-00059600: 4930 2062 7920 6472 6167 6769 6e67 2074  I0 by dragging t
-00059610: 6865 2068 6973 746f 6772 616d 206c 696e  he histogram lin
-00059620: 6573 206f 7220 6279 2064 7261 7769 6e67  es or by drawing
-00059630: 2061 2052 4f49 2e22 290d 0a20 2020 2020   a ROI.")..     
-00059640: 2020 2073 656c 662e 6930 5f69 6e64 6963     self.i0_indic
-00059650: 6573 203d 206e 702e 7768 6572 6528 2866  es = np.where((f
-00059660: 6c75 786d 696e 3c3d 7365 6c66 2e73 7461  luxmin<=self.sta
-00059670: 636b 2e68 6973 746f 6772 616d 2926 2873  ck.histogram)&(s
-00059680: 656c 662e 7374 6163 6b2e 6869 7374 6f67  elf.stack.histog
-00059690: 7261 6d3c 3d66 6c75 786d 6178 2929 0d0a  ram<=fluxmax))..
-000596a0: 2020 2020 2020 2020 7365 6c66 2e72 6564          self.red
-000596b0: 7069 785b 3a2c 203a 5d20 3d20 5b30 2c20  pix[:, :] = [0, 
-000596c0: 302c 2030 2c20 305d 0d0a 2020 2020 2020  0, 0, 0]..      
-000596d0: 2020 7365 6c66 2e72 6564 7069 785b 7365    self.redpix[se
-000596e0: 6c66 2e69 305f 696e 6469 6365 735d 203d  lf.i0_indices] =
-000596f0: 2028 3235 352c 302c 302c 3235 3529 0d0a   (255,0,0,255)..
-00059700: 2020 2020 2020 2020 7365 6c66 2e41 6273          self.Abs
-00059710: 496d 6167 652e 7365 7449 6d61 6765 2873  Image.setImage(s
-00059720: 656c 662e 7374 6163 6b2e 6869 7374 6f67  elf.stack.histog
-00059730: 7261 6d29 0d0a 2020 2020 2020 2020 7365  ram)..        se
-00059740: 6c66 2e4d 6173 6b49 6d61 6765 2e73 6574  lf.MaskImage.set
-00059750: 496d 6167 6528 7365 6c66 2e72 6564 7069  Image(self.redpi
-00059760: 782c 206f 7061 6369 7479 203d 2030 2e33  x, opacity = 0.3
-00059770: 290d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d  )....#----------
-00059780: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00059790: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000597a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000597b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020  ------------..  
-000597c0: 2020 6465 6620 4f6e 4163 6365 7074 2873    def OnAccept(s
-000597d0: 656c 662c 2065 7674 293a 0d0a 2020 2020  elf, evt):..    
-000597e0: 2020 2020 6966 2073 656c 662e 4d61 736b      if self.Mask
-000597f0: 496d 6167 652e 7a56 616c 7565 2829 203e  Image.zValue() >
-00059800: 2030 2061 6e64 206e 702e 616e 7928 7365   0 and np.any(se
-00059810: 6c66 2e69 305f 696e 6469 6365 735b 305d  lf.i0_indices[0]
-00059820: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00059830: 7365 6c66 2e73 7461 636b 2e69 305f 6672  self.stack.i0_fr
-00059840: 6f6d 5f68 6973 746f 6772 616d 2873 656c  om_histogram(sel
-00059850: 662e 6930 5f69 6e64 6963 6573 290d 0a20  f.i0_indices).. 
-00059860: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00059870: 7061 7265 6e74 2e49 3068 6973 746f 6772  parent.I0histogr
-00059880: 616d 4361 6c63 756c 6174 6564 2829 0d0a  amCalculated()..
-00059890: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000598a0: 2e73 7461 636b 2e69 305f 6d61 736b 203d  .stack.i0_mask =
-000598b0: 2073 656c 662e 7265 6470 6978 0d0a 2020   self.redpix..  
-000598c0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-000598d0: 7461 636b 2e69 305f 6d61 736b 5b3a 2c20  tack.i0_mask[:, 
-000598e0: 3a5d 203d 2046 616c 7365 0d0a 2020 2020  :] = False..    
-000598f0: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
-00059900: 636b 2e69 305f 6d61 736b 5b73 656c 662e  ck.i0_mask[self.
-00059910: 6930 5f69 6e64 6963 6573 5d20 3d20 5472  i0_indices] = Tr
-00059920: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-00059930: 7365 6c66 2e63 6c6f 7365 2829 0d0a 2020  self.close()..  
-00059940: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00059950: 2020 2020 2020 2020 2073 656c 662e 6930           self.i0
-00059960: 5f69 6e64 6963 6573 203d 205b 5d0d 0a20  _indices = [].. 
-00059970: 2020 2020 2020 2020 2020 2051 7457 6964             QtWid
-00059980: 6765 7473 2e51 4d65 7373 6167 6542 6f78  gets.QMessageBox
-00059990: 2e77 6172 6e69 6e67 2873 656c 662c 2027  .warning(self, '
-000599a0: 4572 726f 7227 2c20 2749 3020 7265 6769  Error', 'I0 regi
-000599b0: 6f6e 2069 7320 656d 7074 7921 2729 0d0a  on is empty!')..
-000599c0: 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ..#-------------
-000599d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000599e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000599f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00059a00: 2d2d 2d2d 2d2d 2d2d 2d0d 0a63 6c61 7373  ---------..class
-00059a10: 2053 686f 7741 7274 6566 6163 7473 2851   ShowArtefacts(Q
-00059a20: 7457 6964 6765 7473 2e51 4469 616c 6f67  tWidgets.QDialog
-00059a30: 293a 0d0a 2020 2020 6465 6620 5f5f 696e  ):..    def __in
-00059a40: 6974 5f5f 2873 656c 662c 2070 6172 656e  it__(self, paren
-00059a50: 742c 2063 6f6d 6d6f 6e2c 2073 7461 636b  t, common, stack
-00059a60: 293a 0d0a 2020 2020 2020 2020 5174 5769  ):..        QtWi
-00059a70: 6467 6574 732e 5157 6964 6765 742e 5f5f  dgets.QWidget.__
-00059a80: 696e 6974 5f5f 2873 656c 662c 2070 6172  init__(self, par
-00059a90: 656e 7429 0d0a 2020 2020 2020 2020 7569  ent)..        ui
-00059aa0: 632e 6c6f 6164 5569 286f 732e 7061 7468  c.loadUi(os.path
-00059ab0: 2e6a 6f69 6e28 6f73 2e70 6174 682e 6469  .join(os.path.di
-00059ac0: 726e 616d 6528 6f73 2e70 6174 682e 6162  rname(os.path.ab
-00059ad0: 7370 6174 6828 5f5f 6669 6c65 5f5f 2929  spath(__file__))
-00059ae0: 2c20 2773 686f 7761 7274 6566 6163 7473  , 'showartefacts
-00059af0: 2e75 6927 292c 2073 656c 6629 0d0a 2020  .ui'), self)..  
-00059b00: 2020 2020 2020 7365 6c66 2e70 6172 656e        self.paren
-00059b10: 7420 3d20 7061 7265 6e74 0d0a 2020 2020  t = parent..    
-00059b20: 2020 2020 7365 6c66 2e63 6f6d 203d 2063      self.com = c
-00059b30: 6f6d 6d6f 6e0d 0a20 2020 2020 2020 2073  ommon..        s
-00059b40: 656c 662e 7374 6163 6b20 3d20 7374 6163  elf.stack = stac
-00059b50: 6b0d 0a20 2020 2020 2020 2073 656c 662e  k..        self.
-00059b60: 6930 5f68 5f77 6172 6e66 6c61 6720 3d20  i0_h_warnflag = 
-00059b70: 4661 6c73 650d 0a20 2020 2020 2020 2073  False..        s
-00059b80: 656c 662e 6930 5f76 5f77 6172 6e66 6c61  elf.i0_v_warnfla
-00059b90: 6720 3d20 4661 6c73 650d 0a20 2020 2020  g = False..     
-00059ba0: 2020 2073 656c 662e 7067 6c61 796f 7574     self.pglayout
-00059bb0: 203d 2070 672e 4772 6170 6869 6373 4c61   = pg.GraphicsLa
-00059bc0: 796f 7574 2862 6f72 6465 723d 4e6f 6e65  yout(border=None
-00059bd0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00059be0: 6361 6e76 6173 2e73 6574 4261 636b 6772  canvas.setBackgr
-00059bf0: 6f75 6e64 2822 7722 2920 2320 6361 6e76  ound("w") # canv
-00059c00: 6173 2069 7320 6120 7067 2e47 7261 7068  as is a pg.Graph
-00059c10: 6963 7356 6965 7720 7769 6467 6574 0d0a  icsView widget..
-00059c20: 2020 2020 2020 2020 7365 6c66 2e63 616e          self.can
-00059c30: 7661 732e 7365 7443 656e 7472 616c 5769  vas.setCentralWi
-00059c40: 6467 6574 2873 656c 662e 7067 6c61 796f  dget(self.pglayo
-00059c50: 7574 290d 0a0d 0a20 2020 2020 2020 2073  ut)....        s
-00059c60: 656c 662e 7662 203d 2073 656c 662e 7067  elf.vb = self.pg
-00059c70: 6c61 796f 7574 2e61 6464 5669 6577 426f  layout.addViewBo
-00059c80: 7828 290d 0a20 2020 2020 2020 2073 656c  x()..        sel
-00059c90: 662e 7662 2e73 6574 4173 7065 6374 4c6f  f.vb.setAspectLo
-00059ca0: 636b 6564 2829 0d0a 2020 2020 2020 2020  cked()..        
-00059cb0: 7365 6c66 2e69 5f69 7465 6d20 3d20 7067  self.i_item = pg
-00059cc0: 2e49 6d61 6765 4974 656d 2862 6f72 6465  .ImageItem(borde
-00059cd0: 723d 226b 222c 7061 7265 6e74 3d20 7365  r="k",parent= se
-00059ce0: 6c66 290d 0a0d 0a0d 0a20 2020 2020 2020  lf)......       
-00059cf0: 2073 656c 662e 6275 7474 6f6e 5f6f 6b2e   self.button_ok.
-00059d00: 636c 6963 6b65 642e 636f 6e6e 6563 7428  clicked.connect(
-00059d10: 7365 6c66 2e4f 6e41 6363 6570 7429 0d0a  self.OnAccept)..
-00059d20: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-00059d30: 746f 6e5f 6361 6e63 656c 2e63 6c69 636b  ton_cancel.click
-00059d40: 6564 2e63 6f6e 6e65 6374 2873 656c 662e  ed.connect(self.
-00059d50: 636c 6f73 6529 0d0a 2020 2020 2020 2020  close)..        
-00059d60: 7365 6c66 2e63 625f 682e 7374 6174 6543  self.cb_h.stateC
-00059d70: 6861 6e67 6564 2e63 6f6e 6e65 6374 2873  hanged.connect(s
-00059d80: 656c 662e 5368 6f77 496d 6167 6529 0d0a  elf.ShowImage)..
-00059d90: 2020 2020 2020 2020 7365 6c66 2e63 625f          self.cb_
-00059da0: 762e 7374 6174 6543 6861 6e67 6564 2e63  v.stateChanged.c
-00059db0: 6f6e 6e65 6374 2873 656c 662e 5368 6f77  onnect(self.Show
-00059dc0: 496d 6167 6529 0d0a 2020 2020 2020 2020  Image)..        
-00059dd0: 2354 6f44 6f3a 2049 2069 6e69 7469 616c  #ToDo: I initial
-00059de0: 6c79 2077 616e 7465 6420 746f 2075 7365  ly wanted to use
-00059df0: 2051 742e 5175 6575 6564 436f 6e6e 6563   Qt.QueuedConnec
-00059e00: 7469 6f6e 2074 6f20 6372 6561 7465 2061  tion to create a
-00059e10: 206e 6f6e 2d62 6c6f 636b 696e 6720 536c   non-blocking Sl
-00059e20: 6964 6572 2e0d 0a20 2020 2020 2020 2073  ider...        s
-00059e30: 656c 662e 7765 6967 6874 5f73 6c69 6465  elf.weight_slide
-00059e40: 722e 7661 6c75 6543 6861 6e67 6564 2e63  r.valueChanged.c
-00059e50: 6f6e 6e65 6374 2873 656c 662e 5368 6f77  onnect(self.Show
-00059e60: 4361 6c63 496d 6167 6529 0d0a 2020 2020  CalcImage)..    
-00059e70: 2020 2020 7365 6c66 2e73 6c69 6465 725f      self.slider_
-00059e80: 656e 672e 736c 6964 6572 5072 6573 7365  eng.sliderPresse
-00059e90: 642e 636f 6e6e 6563 7428 7365 6c66 2e53  d.connect(self.S
-00059ea0: 686f 7749 6d61 6765 290d 0a20 2020 2020  howImage)..     
-00059eb0: 2020 2073 656c 662e 736c 6964 6572 5f65     self.slider_e
-00059ec0: 6e67 2e73 6c69 6465 7252 656c 6561 7365  ng.sliderRelease
-00059ed0: 642e 636f 6e6e 6563 7428 7365 6c66 2e53  d.connect(self.S
-00059ee0: 686f 7749 6d61 6765 290d 0a20 2020 2020  howImage)..     
-00059ef0: 2020 2073 656c 662e 736c 6964 6572 5f65     self.slider_e
-00059f00: 6e67 2e76 616c 7565 4368 616e 6765 645b  ng.valueChanged[
-00059f10: 696e 745d 2e63 6f6e 6e65 6374 2873 656c  int].connect(sel
-00059f20: 662e 4f6e 5363 726f 6c6c 456e 6729 0d0a  f.OnScrollEng)..
-00059f30: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-00059f40: 6574 5769 6e64 6f77 5469 746c 6528 2741  etWindowTitle('A
-00059f50: 7274 6566 6163 7473 2026 204c 6576 656c  rtefacts & Level
-00059f60: 696e 6727 290d 0a20 2020 2020 2020 2073  ing')..        s
-00059f70: 656c 662e 736c 6964 6572 5f65 6e67 2e73  elf.slider_eng.s
-00059f80: 6574 5261 6e67 6528 302c 2073 656c 662e  etRange(0, self.
-00059f90: 7374 6163 6b2e 6e5f 6576 202d 2031 290d  stack.n_ev - 1).
-00059fa0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00059fb0: 7662 2e73 6574 4d6f 7573 6545 6e61 626c  vb.setMouseEnabl
-00059fc0: 6564 2878 3d46 616c 7365 2c20 793d 4661  ed(x=False, y=Fa
-00059fd0: 6c73 6529 0d0a 2020 2020 2020 2020 7365  lse)..        se
-00059fe0: 6c66 2e76 622e 6164 6449 7465 6d28 7365  lf.vb.addItem(se
-00059ff0: 6c66 2e69 5f69 7465 6d2c 2069 676e 6f72  lf.i_item, ignor
-0005a000: 6542 6f75 6e64 733d 4661 6c73 6529 0d0a  eBounds=False)..
-0005a010: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-0005a020: 7461 636b 2e61 6273 6461 7461 5f6c 6576  tack.absdata_lev
-0005a030: 656c 203d 2073 656c 662e 7374 6163 6b2e  el = self.stack.
-0005a040: 6162 7364 6174 612e 636f 7079 2829 0d0a  absdata.copy()..
-0005a050: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0005a060: 636f 6d2e 6930 5f6c 6f61 6465 643a 0d0a  com.i0_loaded:..
-0005a070: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005a080: 2e72 625f 6d65 6469 616e 5f69 302e 7365  .rb_median_i0.se
-0005a090: 7443 6865 636b 6162 6c65 2854 7275 6529  tCheckable(True)
-0005a0a0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0005a0b0: 6c66 2e72 625f 6d65 6469 616e 5f69 302e  lf.rb_median_i0.
-0005a0c0: 7365 7443 6865 636b 6564 2854 7275 6529  setChecked(True)
-0005a0d0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0005a0e0: 6c66 2e6c 6162 656c 5f34 2e73 6574 5465  lf.label_4.setTe
-0005a0f0: 7874 2827 4930 206d 6173 6b20 636f 6e74  xt('I0 mask cont
-0005a100: 7269 6275 7469 6f6e 3a27 290d 0a20 2020  ribution:')..   
-0005a110: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0005a120: 2020 2020 2020 2020 7365 6c66 2e73 6c69          self.sli
-0005a130: 6465 7257 6964 6765 742e 6869 6465 2829  derWidget.hide()
-0005a140: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
-0005a150: 625f 6d65 6469 616e 2e74 6f67 676c 6564  b_median.toggled
-0005a160: 2e63 6f6e 6e65 6374 2873 656c 662e 5368  .connect(self.Sh
-0005a170: 6f77 496d 6167 6529 0d0a 2020 2020 2020  owImage)..      
-0005a180: 2020 7365 6c66 2e4f 6e53 6372 6f6c 6c45    self.OnScrollE
-0005a190: 6e67 2830 290d 0a0d 0a20 2020 2064 6566  ng(0)....    def
-0005a1a0: 2053 686f 7743 616c 6349 6d61 6765 2873   ShowCalcImage(s
-0005a1b0: 656c 6629 3a0d 0a20 2020 2020 2020 2069  elf):..        i
-0005a1c0: 6620 616e 7928 5b73 656c 662e 6362 5f68  f any([self.cb_h
-0005a1d0: 2e69 7343 6865 636b 6564 2829 2c73 656c  .isChecked(),sel
-0005a1e0: 662e 6362 5f76 2e69 7343 6865 636b 6564  f.cb_v.isChecked
-0005a1f0: 2829 5d29 3a0d 0a20 2020 2020 2020 2020  ()]):..         
-0005a200: 2020 2061 203d 2073 656c 662e 7374 6163     a = self.stac
-0005a210: 6b2e 6162 7364 6174 615b 3a2c 203a 2c20  k.absdata[:, :, 
-0005a220: 7365 6c66 2e73 6c69 6465 725f 656e 672e  self.slider_eng.
-0005a230: 7661 6c75 6528 295d 2e61 7374 7970 6528  value()].astype(
-0005a240: 2766 6c6f 6174 3634 2729 0d0a 2020 2020  'float64')..    
-0005a250: 2020 2020 2020 2020 612c 2077 6620 3d20          a, wf = 
-0005a260: 7365 6c66 2e4c 6576 656c 4361 6c63 2861  self.LevelCalc(a
-0005a270: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0005a280: 6620 7365 6c66 2e72 625f 6d65 6469 616e  f self.rb_median
-0005a290: 5f69 302e 6973 4368 6563 6b65 6428 293a  _i0.isChecked():
-0005a2a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005a2b0: 2020 7365 6c66 2e6c 6162 656c 5f33 2e73    self.label_3.s
-0005a2c0: 6574 5465 7874 2873 7472 2827 7b3a 647d  etText(str('{:d}
-0005a2d0: 2729 2e66 6f72 6d61 7428 696e 7428 7766  ').format(int(wf
-0005a2e0: 2929 2b27 2025 2729 0d0a 2020 2020 2020  ))+' %')..      
-0005a2f0: 2020 2020 2020 7365 6c66 2e69 5f69 7465        self.i_ite
-0005a300: 6d2e 7365 7449 6d61 6765 2861 290d 0a0d  m.setImage(a)...
-0005a310: 0a20 2020 2064 6566 2043 6f72 7265 6374  .    def Correct
-0005a320: 696f 6e41 7272 6179 2873 656c 662c 6172  ionArray(self,ar
-0005a330: 7261 792c 6178 6973 2c77 662c 6d61 736b  ray,axis,wf,mask
-0005a340: 203d 204e 6f6e 652c 293a 0d0a 2020 2020   = None,):..    
-0005a350: 2020 2020 2320 6361 6c63 756c 6174 6520      # calculate 
-0005a360: 6d65 6469 616e 2061 6c6f 6e67 2067 6976  median along giv
-0005a370: 656e 2061 7869 732c 2069 676e 6f72 696e  en axis, ignorin
-0005a380: 6720 6e61 6e73 2069 6620 7072 6573 656e  g nans if presen
-0005a390: 740d 0a20 2020 2020 2020 2061 7272 6179  t..        array
-0005a3a0: 5f69 203d 206e 702e 6e61 6e6d 6564 6961  _i = np.nanmedia
-0005a3b0: 6e28 6172 7261 792c 2061 7869 733d 6178  n(array, axis=ax
-0005a3c0: 6973 2c20 6b65 6570 6469 6d73 3d46 616c  is, keepdims=Fal
-0005a3d0: 7365 290d 0a20 2020 2020 2020 2069 6620  se)..        if 
-0005a3e0: 6d61 736b 2069 7320 6e6f 7420 4e6f 6e65  mask is not None
-0005a3f0: 2061 6e64 2077 6620 213d 2030 2e30 3a0d   and wf != 0.0:.
-0005a400: 0a20 2020 2020 2020 2020 2020 2061 7272  .            arr
-0005a410: 6179 203d 206e 702e 7768 6572 6528 6d61  ay = np.where(ma
-0005a420: 736b 2c20 6172 7261 792c 206e 702e 6e61  sk, array, np.na
-0005a430: 6e29 2023 2072 6570 6c61 6365 206d 6173  n) # replace mas
-0005a440: 6b65 6420 7069 7865 6c73 2062 7920 6e61  ked pixels by na
-0005a450: 6e73 0d0a 2020 2020 2020 2020 2020 2020  ns..            
-0005a460: 2320 6361 6c63 756c 6174 6520 6d65 6469  # calculate medi
-0005a470: 616e 2061 6c6f 6e67 2067 6976 656e 2061  an along given a
-0005a480: 7869 732c 2069 676e 6f72 696e 6720 6e61  xis, ignoring na
-0005a490: 6e73 2069 6620 7072 6573 656e 740d 0a20  ns if present.. 
-0005a4a0: 2020 2020 2020 2020 2020 2061 7272 6179             array
-0005a4b0: 203d 206e 702e 6e61 6e6d 6564 6961 6e28   = np.nanmedian(
-0005a4c0: 6172 7261 792c 2061 7869 733d 6178 6973  array, axis=axis
-0005a4d0: 2c20 6b65 6570 6469 6d73 3d46 616c 7365  , keepdims=False
-0005a4e0: 290d 0a20 2020 2020 2020 2020 2020 2062  )..            b
-0005a4f0: 675f 6d65 6469 616e 203d 206e 702e 6e61  g_median = np.na
-0005a500: 6e6d 6564 6961 6e28 6172 7261 792c 2061  nmedian(array, a
-0005a510: 7869 733d 302c 206b 6565 7064 696d 733d  xis=0, keepdims=
-0005a520: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-0005a530: 6966 206d 6173 6b20 6973 204e 6f6e 6520  if mask is None 
-0005a540: 6f72 2077 6620 3d3d 2030 2e30 3a0d 0a20  or wf == 0.0:.. 
-0005a550: 2020 2020 2020 2020 2020 2023 2072 6574             # ret
-0005a560: 7572 6e73 2074 6865 206d 6564 6961 6e20  urns the median 
-0005a570: 6669 6c74 6572 6564 2061 7272 6179 206e  filtered array n
-0005a580: 6567 6c65 6374 696e 6720 7468 6520 6930  eglecting the i0
-0005a590: 206d 6173 6b0d 0a20 2020 2020 2020 2020   mask..         
-0005a5a0: 2020 2072 6574 7572 6e20 286e 702e 6e61     return (np.na
-0005a5b0: 6e6d 6564 6961 6e28 6172 7261 795f 692c  nmedian(array_i,
-0005a5c0: 2061 7869 733d 302c 206b 6565 7064 696d   axis=0, keepdim
-0005a5d0: 733d 4661 6c73 6529 202d 2061 7272 6179  s=False) - array
-0005a5e0: 5f69 290d 0a20 2020 2020 2020 2065 6c69  _i)..        eli
-0005a5f0: 6620 7766 203d 3d20 313a 0d0a 2020 2020  f wf == 1:..    
-0005a600: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-0005a610: 2862 675f 6d65 6469 616e 202d 2061 7272  (bg_median - arr
-0005a620: 6179 292a 2877 6629 290d 0a20 2020 2020  ay)*(wf))..     
-0005a630: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0005a640: 2020 2020 2020 7265 7475 726e 2028 2862        return ((b
-0005a650: 675f 6d65 6469 616e 202d 2061 7272 6179  g_median - array
-0005a660: 292a 2877 6629 202b 2028 6267 5f6d 6564  )*(wf) + (bg_med
-0005a670: 6961 6e20 2d20 6172 7261 795f 6929 2a28  ian - array_i)*(
-0005a680: 312d 7766 2929 0d0a 0d0a 2020 2020 6465  1-wf))....    de
-0005a690: 6620 4c65 7665 6c43 616c 6328 7365 6c66  f LevelCalc(self
-0005a6a0: 2c61 2c66 696e 616c 3d46 616c 7365 293a  ,a,final=False):
-0005a6b0: 0d0a 2020 2020 2020 2020 7766 203d 2030  ..        wf = 0
-0005a6c0: 2e30 0d0a 2020 2020 2020 2020 6d61 736b  .0..        mask
-0005a6d0: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-0005a6e0: 2064 6966 665f 7620 3d20 300d 0a20 2020   diff_v = 0..   
-0005a6f0: 2020 2020 2064 6966 665f 6820 3d20 300d       diff_h = 0.
-0005a700: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0005a710: 2e63 625f 682e 6973 4368 6563 6b65 6428  .cb_h.isChecked(
-0005a720: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0005a730: 7766 203d 2028 7365 6c66 2e77 6569 6768  wf = (self.weigh
-0005a740: 745f 736c 6964 6572 2e76 616c 7565 2829  t_slider.value()
-0005a750: 2920 2f20 3130 300d 0a20 2020 2020 2020  ) / 100..       
-0005a760: 2020 2020 2069 6620 7365 6c66 2e72 625f       if self.rb_
-0005a770: 6d65 6469 616e 5f69 302e 6973 4368 6563  median_i0.isChec
-0005a780: 6b65 6428 293a 0d0a 2020 2020 2020 2020  ked():..        
-0005a790: 2020 2020 2020 2020 6d61 736b 203d 2073          mask = s
-0005a7a0: 656c 662e 7374 6163 6b2e 6930 5f6d 6173  elf.stack.i0_mas
-0005a7b0: 6b5b 3a2c 203a 2c20 305d 0d0a 2020 2020  k[:, :, 0]..    
-0005a7c0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-0005a7d0: 696e 616c 3a0d 0a20 2020 2020 2020 2020  inal:..         
-0005a7e0: 2020 2020 2020 2020 2020 206d 6173 6b20             mask 
-0005a7f0: 3d20 6d61 736b 5b3a 2c20 3a2c 204e 6f6e  = mask[:, :, Non
-0005a800: 655d 0d0a 2020 2020 2020 2020 2020 2020  e]..            
-0005a810: 6469 6666 5f68 203d 2073 656c 662e 436f  diff_h = self.Co
-0005a820: 7272 6563 7469 6f6e 4172 7261 7928 612c  rrectionArray(a,
-0005a830: 2030 2c20 666c 6f61 7428 7766 292c 206d   0, float(wf), m
-0005a840: 6173 6b29 5b4e 6f6e 652c 203a 5d0d 0a20  ask)[None, :].. 
-0005a850: 2020 2020 2020 2020 2020 2023 6120 2b3d             #a +=
-0005a860: 2064 6966 665b 4e6f 6e65 2c20 3a5d 0d0a   diff[None, :]..
-0005a870: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0005a880: 6362 5f76 2e69 7343 6865 636b 6564 2829  cb_v.isChecked()
-0005a890: 3a0d 0a20 2020 2020 2020 2020 2020 2077  :..            w
-0005a8a0: 6620 3d20 2873 656c 662e 7765 6967 6874  f = (self.weight
-0005a8b0: 5f73 6c69 6465 722e 7661 6c75 6528 2929  _slider.value())
-0005a8c0: 202f 2031 3030 0d0a 2020 2020 2020 2020   / 100..        
-0005a8d0: 2020 2020 6966 2073 656c 662e 7262 5f6d      if self.rb_m
-0005a8e0: 6564 6961 6e5f 6930 2e69 7343 6865 636b  edian_i0.isCheck
-0005a8f0: 6564 2829 3a0d 0a20 2020 2020 2020 2020  ed():..         
-0005a900: 2020 2020 2020 206d 6173 6b20 3d20 7365         mask = se
-0005a910: 6c66 2e73 7461 636b 2e69 305f 6d61 736b  lf.stack.i0_mask
-0005a920: 5b3a 2c20 3a2c 2030 5d0d 0a20 2020 2020  [:, :, 0]..     
-0005a930: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
-0005a940: 6e61 6c3a 0d0a 2020 2020 2020 2020 2020  nal:..          
-0005a950: 2020 2020 2020 2020 2020 6d61 736b 203d            mask =
-0005a960: 206d 6173 6b5b 3a2c 203a 2c20 4e6f 6e65   mask[:, :, None
-0005a970: 5d0d 0a20 2020 2020 2020 2020 2020 2064  ]..            d
-0005a980: 6966 665f 7620 3d20 7365 6c66 2e43 6f72  iff_v = self.Cor
-0005a990: 7265 6374 696f 6e41 7272 6179 2861 2c20  rectionArray(a, 
-0005a9a0: 312c 2066 6c6f 6174 2877 6629 2c20 6d61  1, float(wf), ma
-0005a9b0: 736b 295b 3a20 2c4e 6f6e 655d 0d0a 2020  sk)[: ,None]..  
-0005a9c0: 2020 2020 2020 6120 3d20 6120 2b20 6469        a = a + di
-0005a9d0: 6666 5f76 202b 2064 6966 665f 680d 0a20  ff_v + diff_h.. 
-0005a9e0: 2020 2020 2020 2072 6574 7572 6e28 612c         return(a,
-0005a9f0: 696e 7428 7766 2a31 3030 2929 0d0a 2320  int(wf*100))..# 
-0005aa00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005aa10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005aa20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005aa30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005aa40: 2d2d 2d2d 2d2d 0d0a 2020 2020 6465 6620  ------..    def 
-0005aa50: 4f6e 5363 726f 6c6c 456e 6728 7365 6c66  OnScrollEng(self
-0005aa60: 2c20 7661 6c75 6529 3a0d 0a20 2020 2020  , value):..     
-0005aa70: 2020 2073 656c 662e 736c 6964 6572 5f65     self.slider_e
-0005aa80: 6e67 2e73 6574 5661 6c75 6528 7661 6c75  ng.setValue(valu
-0005aa90: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-0005aaa0: 2e69 6576 203d 2076 616c 7565 0d0a 0d0a  .iev = value....
-0005aab0: 2020 2020 2020 2020 7365 6c66 2e53 686f          self.Sho
-0005aac0: 7749 6d61 6765 2829 0d0a 2020 2020 6465  wImage()..    de
-0005aad0: 6620 5368 6f77 496d 6167 6528 7365 6c66  f ShowImage(self
-0005aae0: 293a 0d0a 2020 2020 2020 2020 6966 2028  ):..        if (
-0005aaf0: 7365 6c66 2e73 6c69 6465 725f 656e 672e  self.slider_eng.
-0005ab00: 6973 536c 6964 6572 446f 776e 2829 293a  isSliderDown()):
-0005ab10: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0005ab20: 6c66 2e69 5f69 7465 6d2e 7365 7449 6d61  lf.i_item.setIma
-0005ab30: 6765 2873 656c 662e 7374 6163 6b2e 6162  ge(self.stack.ab
-0005ab40: 7364 6174 615b 3a2c 203a 2c20 696e 7428  sdata[:, :, int(
-0005ab50: 7365 6c66 2e69 6576 295d 290d 0a20 2020  self.iev)])..   
-0005ab60: 2020 2020 2065 6c69 6620 616e 7928 5b73       elif any([s
-0005ab70: 656c 662e 6362 5f68 2e69 7343 6865 636b  elf.cb_h.isCheck
-0005ab80: 6564 2829 2c20 7365 6c66 2e63 625f 762e  ed(), self.cb_v.
-0005ab90: 6973 4368 6563 6b65 6428 295d 293a 0d0a  isChecked()]):..
-0005aba0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005abb0: 2e53 686f 7743 616c 6349 6d61 6765 2829  .ShowCalcImage()
-0005abc0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-0005abd0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0005abe0: 662e 695f 6974 656d 2e73 6574 496d 6167  f.i_item.setImag
-0005abf0: 6528 7365 6c66 2e73 7461 636b 2e61 6273  e(self.stack.abs
-0005ac00: 6461 7461 5b3a 2c20 3a2c 2069 6e74 2873  data[:, :, int(s
-0005ac10: 656c 662e 6965 7629 5d29 0d0a 0d0a 2020  elf.iev)])....  
-0005ac20: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-0005ac30: 6162 656c 5f33 2e73 6574 5465 7874 2873  abel_3.setText(s
-0005ac40: 7472 2827 2729 290d 0a20 2020 2020 2020  tr(''))..       
-0005ac50: 2073 656c 662e 6772 6f75 7042 6f78 2e73   self.groupBox.s
-0005ac60: 6574 5469 746c 6528 7374 7228 2753 7461  etTitle(str('Sta
-0005ac70: 636b 2042 726f 7773 6572 207c 2049 6d61  ck Browser | Ima
-0005ac80: 6765 2061 7420 7b30 3a35 2e32 667d 2065  ge at {0:5.2f} e
-0005ac90: 5627 292e 666f 726d 6174 2866 6c6f 6174  V').format(float
-0005aca0: 2873 656c 662e 7374 6163 6b2e 6576 5b73  (self.stack.ev[s
-0005acb0: 656c 662e 6965 765d 2929 290d 0a23 2d2d  elf.iev])))..#--
-0005acc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005acd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005ace0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005acf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005ad00: 2d2d 2d2d 0d0a 2020 2020 6465 6620 4f6e  ----..    def On
-0005ad10: 4163 6365 7074 2873 656c 662c 2065 7674  Accept(self, evt
-0005ad20: 293a 0d0a 2020 2020 2020 2020 612c 2077  ):..        a, w
-0005ad30: 6620 3d20 7365 6c66 2e4c 6576 656c 4361  f = self.LevelCa
-0005ad40: 6c63 2873 656c 662e 7374 6163 6b2e 6162  lc(self.stack.ab
-0005ad50: 7364 6174 612e 6173 7479 7065 2827 666c  sdata.astype('fl
-0005ad60: 6f61 7436 3427 292c 6669 6e61 6c3d 5472  oat64'),final=Tr
-0005ad70: 7565 290d 0a20 2020 2020 2020 2073 656c  ue)..        sel
-0005ad80: 662e 7374 6163 6b2e 6162 7364 6174 6120  f.stack.absdata 
-0005ad90: 3d20 610d 0a20 2020 2020 2020 2073 656c  = a..        sel
-0005ada0: 662e 7061 7265 6e74 2e70 6167 6531 2e73  f.parent.page1.s
-0005adb0: 686f 7753 7065 6374 7275 6d28 7365 6c66  howSpectrum(self
-0005adc0: 2e70 6172 656e 742e 7061 6765 312e 6978  .parent.page1.ix
-0005add0: 2c20 7365 6c66 2e70 6172 656e 742e 7061  , self.parent.pa
-0005ade0: 6765 312e 6979 290d 0a20 2020 2020 2020  ge1.iy)..       
-0005adf0: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
-0005ae00: 6531 2e6c 6f61 6449 6d61 6765 2829 0d0a  e1.loadImage()..
-0005ae10: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
-0005ae20: 656e 742e 7061 6765 302e 436c 6561 7228  ent.page0.Clear(
-0005ae30: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0005ae40: 7061 7265 6e74 2e70 6167 6530 2e4c 6f61  parent.page0.Loa
-0005ae50: 6445 6e74 7269 6573 2829 0d0a 0d0a 2020  dEntries()....  
-0005ae60: 2020 2020 2020 6966 2073 686f 776d 6170        if showmap
-0005ae70: 7461 623a 0d0a 2020 2020 2020 2020 2020  tab:..          
-0005ae80: 2020 7365 6c66 2e70 6172 656e 742e 7061    self.parent.pa
-0005ae90: 6765 392e 436c 6561 7228 290d 0a20 2020  ge9.Clear()..   
-0005aea0: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-0005aeb0: 7265 6e74 2e70 6167 6539 2e4c 6f61 6445  rent.page9.LoadE
-0005aec0: 6e74 7269 6573 2829 0d0a 0d0a 2020 2020  ntries()....    
-0005aed0: 2020 2020 7365 6c66 2e63 6c6f 7365 2829      self.close()
-0005aee0: 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ..#-------------
-0005aef0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005af00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005af10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005af20: 2d2d 2d2d 2d2d 2d2d 2d0d 0a63 6c61 7373  ---------..class
-0005af30: 204d 756c 7469 4372 6f70 2851 7457 6964   MultiCrop(QtWid
-0005af40: 6765 7473 2e51 4469 616c 6f67 2c20 5174  gets.QDialog, Qt
-0005af50: 5769 6467 6574 732e 5147 7261 7068 6963  Widgets.QGraphic
-0005af60: 7353 6365 6e65 293a 0d0a 2020 2020 6576  sScene):..    ev
-0005af70: 6c69 7374 6368 616e 6765 6420 3d20 7079  listchanged = py
-0005af80: 7174 5369 676e 616c 285b 6f62 6a65 6374  qtSignal([object
-0005af90: 5d29 0d0a 2020 2020 7468 6574 616c 6973  ])..    thetalis
-0005afa0: 7463 6861 6e67 6564 203d 2070 7971 7453  tchanged = pyqtS
-0005afb0: 6967 6e61 6c28 5b6f 626a 6563 745d 290d  ignal([object]).
-0005afc0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-0005afd0: 5f28 7365 6c66 2c20 7061 7265 6e74 2c20  _(self, parent, 
-0005afe0: 636f 6d6d 6f6e 2c20 7374 6163 6b29 3a0d  common, stack):.
-0005aff0: 0a20 2020 2020 2020 2051 7457 6964 6765  .        QtWidge
-0005b000: 7473 2e51 5769 6467 6574 2e5f 5f69 6e69  ts.QWidget.__ini
-0005b010: 745f 5f28 7365 6c66 2c20 7061 7265 6e74  t__(self, parent
-0005b020: 290d 0a20 2020 2020 2020 2075 6963 2e6c  )..        uic.l
-0005b030: 6f61 6455 6928 6f73 2e70 6174 682e 6a6f  oadUi(os.path.jo
-0005b040: 696e 286f 732e 7061 7468 2e64 6972 6e61  in(os.path.dirna
-0005b050: 6d65 286f 732e 7061 7468 2e61 6273 7061  me(os.path.abspa
-0005b060: 7468 285f 5f66 696c 655f 5f29 292c 2027  th(__file__)), '
-0005b070: 7368 6f77 6d75 6c74 6963 726f 702e 7569  showmulticrop.ui
-0005b080: 2729 2c20 7365 6c66 290d 0a20 2020 2020  '), self)..     
-0005b090: 2020 2073 656c 662e 7061 7265 6e74 203d     self.parent =
-0005b0a0: 2070 6172 656e 740d 0a20 2020 2020 2020   parent..       
-0005b0b0: 2073 656c 662e 7374 6163 6b20 3d20 7374   self.stack = st
-0005b0c0: 6163 6b0d 0a20 2020 2020 2020 2073 656c  ack..        sel
-0005b0d0: 662e 636f 6d20 3d20 636f 6d6d 6f6e 0d0a  f.com = common..
-0005b0e0: 2020 2020 2020 2020 7365 6c66 2e69 6576          self.iev
-0005b0f0: 203d 2030 0d0a 2020 2020 2020 2020 7365   = 0..        se
-0005b100: 6c66 2e69 7468 6574 6120 3d20 300d 0a20  lf.itheta = 0.. 
-0005b110: 2020 2020 2020 2023 7365 6c66 2e73 7461         #self.sta
-0005b120: 636b 2e61 6273 6461 7461 5f73 6869 6674  ck.absdata_shift
-0005b130: 6564 5f63 726f 7070 6564 203d 2073 656c  ed_cropped = sel
-0005b140: 662e 7374 6163 6b2e 6162 7364 6174 615f  f.stack.absdata_
-0005b150: 7368 6966 7465 642e 636f 7079 2829 0d0a  shifted.copy()..
-0005b160: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-0005b170: 6f6f 6c74 6872 6561 6420 3d20 5174 436f  oolthread = QtCo
-0005b180: 7265 2e51 5468 7265 6164 2829 0d0a 2020  re.QThread()..  
-0005b190: 2020 2020 2020 7365 6c66 2e61 6c69 676e        self.align
-0005b1a0: 6564 203d 2046 616c 7365 0d0a 2020 2020  ed = False..    
-0005b1b0: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-0005b1c0: 6f6b 2e73 6574 456e 6162 6c65 6428 5472  ok.setEnabled(Tr
-0005b1d0: 7565 290d 0a0d 0a20 2020 2020 2020 2073  ue)....        s
-0005b1e0: 656c 662e 7365 7457 696e 646f 7754 6974  elf.setWindowTit
-0005b1f0: 6c65 2827 5374 6163 6b20 4372 6f70 7069  le('Stack Croppi
-0005b200: 6e67 2729 0d0a 2020 2020 2020 2020 7365  ng')..        se
-0005b210: 6c66 2e70 676c 6179 6f75 7420 3d20 7067  lf.pglayout = pg
-0005b220: 2e47 7261 7068 6963 734c 6179 6f75 7428  .GraphicsLayout(
-0005b230: 626f 7264 6572 3d4e 6f6e 6529 0d0a 2020  border=None)..  
-0005b240: 2020 2020 2020 7365 6c66 2e63 616e 7661        self.canva
-0005b250: 732e 7365 7442 6163 6b67 726f 756e 6428  s.setBackground(
-0005b260: 2277 2229 2023 2063 616e 7661 7320 6973  "w") # canvas is
-0005b270: 2061 2070 672e 4772 6170 6869 6373 5669   a pg.GraphicsVi
-0005b280: 6577 2077 6964 6765 740d 0a20 2020 2020  ew widget..     
-0005b290: 2020 2073 656c 662e 6361 6e76 6173 2e73     self.canvas.s
-0005b2a0: 6574 4365 6e74 7261 6c57 6964 6765 7428  etCentralWidget(
-0005b2b0: 7365 6c66 2e70 676c 6179 6f75 7429 0d0a  self.pglayout)..
-0005b2c0: 2020 2020 2020 2020 7365 6c66 2e76 6220          self.vb 
-0005b2d0: 3d20 7365 6c66 2e70 676c 6179 6f75 742e  = self.pglayout.
-0005b2e0: 6164 6456 6965 7742 6f78 2829 0d0a 2020  addViewBox()..  
-0005b2f0: 2020 2020 2020 7365 6c66 2e76 622e 7365        self.vb.se
-0005b300: 7441 7370 6563 744c 6f63 6b65 6428 290d  tAspectLocked().
-0005b310: 0a20 2020 2020 2020 2073 656c 662e 695f  .        self.i_
-0005b320: 6974 656d 203d 2070 672e 496d 6167 6549  item = pg.ImageI
-0005b330: 7465 6d28 626f 7264 6572 3d22 6b22 2c70  tem(border="k",p
-0005b340: 6172 656e 743d 2073 656c 6629 0d0a 0d0a  arent= self)....
-0005b350: 2020 2020 2020 2020 7365 6c66 2e76 622e          self.vb.
-0005b360: 7365 744d 6f75 7365 456e 6162 6c65 6428  setMouseEnabled(
-0005b370: 783d 4661 6c73 652c 2079 3d46 616c 7365  x=False, y=False
-0005b380: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0005b390: 7662 2e61 6464 4974 656d 2873 656c 662e  vb.addItem(self.
-0005b3a0: 695f 6974 656d 2c20 6967 6e6f 7265 426f  i_item, ignoreBo
-0005b3b0: 756e 6473 3d46 616c 7365 290d 0a0d 0a20  unds=False).... 
-0005b3c0: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
-0005b3d0: 6f6e 5f6f 6b2e 636c 6963 6b65 642e 636f  on_ok.clicked.co
-0005b3e0: 6e6e 6563 7428 7365 6c66 2e4f 6e41 6363  nnect(self.OnAcc
-0005b3f0: 6570 7429 0d0a 2020 2020 2020 2020 7365  ept)..        se
-0005b400: 6c66 2e62 7574 746f 6e5f 6361 6e63 656c  lf.button_cancel
-0005b410: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
-0005b420: 2873 656c 662e 4f6e 4361 6e63 656c 290d  (self.OnCancel).
-0005b430: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
-0005b440: 6c66 2e63 6f6d 2e73 7461 636b 5f6c 6f61  lf.com.stack_loa
-0005b450: 6465 6420 3d3d 2031 3a0d 0a20 2020 2020  ded == 1:..     
-0005b460: 2020 2020 2020 2073 656c 662e 6c61 6265         self.labe
-0005b470: 6c5f 7468 6574 615f 7261 6e67 652e 7365  l_theta_range.se
-0005b480: 7456 6973 6962 6c65 2846 616c 7365 290d  tVisible(False).
-0005b490: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0005b4a0: 662e 736c 6964 6572 5f74 6865 7461 2e73  f.slider_theta.s
-0005b4b0: 6574 5669 7369 626c 6528 4661 6c73 6529  etVisible(False)
-0005b4c0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0005b4d0: 6c66 2e63 625f 7265 6d6f 7665 5f74 6865  lf.cb_remove_the
-0005b4e0: 7461 2e73 6574 5669 7369 626c 6528 4661  ta.setVisible(Fa
-0005b4f0: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
-0005b500: 2020 7365 6c66 2e67 726f 7570 426f 785f    self.groupBox_
-0005b510: 7468 6574 612e 7365 7456 6973 6962 6c65  theta.setVisible
-0005b520: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
-0005b530: 2020 2020 2069 6620 7365 6c66 2e63 6f6d       if self.com
-0005b540: 2e73 7461 636b 5f34 6420 3d3d 2031 3a0d  .stack_4d == 1:.
-0005b550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005b560: 2073 656c 662e 6c61 6265 6c5f 7468 6574   self.label_thet
-0005b570: 615f 7261 6e67 652e 7365 7456 6973 6962  a_range.setVisib
-0005b580: 6c65 2854 7275 6529 0d0a 2020 2020 2020  le(True)..      
-0005b590: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-0005b5a0: 6c69 6465 725f 7468 6574 612e 7365 7456  lider_theta.setV
-0005b5b0: 6973 6962 6c65 2854 7275 6529 0d0a 2020  isible(True)..  
-0005b5c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0005b5d0: 6c66 2e63 625f 7265 6d6f 7665 5f74 6865  lf.cb_remove_the
-0005b5e0: 7461 2e73 6574 5669 7369 626c 6528 5472  ta.setVisible(Tr
-0005b5f0: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-0005b600: 2020 2020 2073 656c 662e 6772 6f75 7042       self.groupB
-0005b610: 6f78 5f74 6865 7461 2e73 6574 5669 7369  ox_theta.setVisi
-0005b620: 626c 6528 5472 7565 290d 0a20 2020 2020  ble(True)..     
-0005b630: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0005b640: 736c 6964 6572 5f74 6865 7461 2e73 6574  slider_theta.set
-0005b650: 5261 6e67 6528 302c 2073 656c 662e 7374  Range(0, self.st
-0005b660: 6163 6b2e 6e5f 7468 6574 6120 2d20 3129  ack.n_theta - 1)
-0005b670: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005b680: 2020 7365 6c66 2e73 6c69 6465 725f 7468    self.slider_th
-0005b690: 6574 612e 7661 6c75 6543 6861 6e67 6564  eta.valueChanged
-0005b6a0: 5b69 6e74 5d2e 636f 6e6e 6563 7428 7365  [int].connect(se
-0005b6b0: 6c66 2e4f 6e53 6372 6f6c 6c54 6865 7461  lf.OnScrollTheta
-0005b6c0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0005b6d0: 2020 2073 656c 662e 5365 7475 704c 6973     self.SetupLis
-0005b6e0: 7454 6865 7461 2829 0d0a 2020 2020 2020  tTheta()..      
-0005b6f0: 2020 2020 2020 2320 7365 6c66 2e6d 6173        # self.mas
-0005b700: 6b65 6476 616c 7320 3d20 5b54 7275 655d  kedvals = [True]
-0005b710: 202a 2069 6e74 2873 656c 662e 7374 6163   * int(self.stac
-0005b720: 6b2e 6e5f 6576 290d 0a20 2020 2020 2020  k.n_ev)..       
-0005b730: 2020 2020 2023 2073 656c 662e 7370 696e       # self.spin
-0005b740: 426f 7845 7272 6f72 2e73 6574 456e 6162  BoxError.setEnab
-0005b750: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
-0005b760: 2020 2020 2020 2020 7365 6c66 2e73 6c69          self.sli
-0005b770: 6465 725f 656e 672e 736c 6964 6572 5072  der_eng.sliderPr
-0005b780: 6573 7365 642e 636f 6e6e 6563 7428 7365  essed.connect(se
-0005b790: 6c66 2e53 686f 7749 6d61 6765 290d 0a20  lf.ShowImage).. 
-0005b7a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0005b7b0: 736c 6964 6572 5f65 6e67 2e73 6c69 6465  slider_eng.slide
-0005b7c0: 7252 656c 6561 7365 642e 636f 6e6e 6563  rReleased.connec
-0005b7d0: 7428 7365 6c66 2e53 686f 7749 6d61 6765  t(self.ShowImage
-0005b7e0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-0005b7f0: 656c 662e 736c 6964 6572 5f65 6e67 2e76  elf.slider_eng.v
-0005b800: 616c 7565 4368 616e 6765 645b 696e 745d  alueChanged[int]
-0005b810: 2e63 6f6e 6e65 6374 2873 656c 662e 4f6e  .connect(self.On
-0005b820: 5363 726f 6c6c 456e 6729 0d0a 2020 2020  ScrollEng)..    
-0005b830: 2020 2020 2020 2020 7365 6c66 2e73 6c69          self.sli
-0005b840: 6465 725f 656e 672e 7365 7452 616e 6765  der_eng.setRange
-0005b850: 2830 2c20 7365 6c66 2e73 7461 636b 2e6e  (0, self.stack.n
-0005b860: 5f65 7620 2d20 3129 0d0a 2020 2020 2020  _ev - 1)..      
-0005b870: 2020 2020 2020 7365 6c66 2e70 625f 7365        self.pb_se
-0005b880: 6c65 6374 616c 6c2e 636c 6963 6b65 642e  lectall.clicked.
-0005b890: 636f 6e6e 6563 7428 7365 6c66 2e4f 6e53  connect(self.OnS
-0005b8a0: 656c 6563 7441 6c6c 290d 0a20 2020 2020  electAll)..     
-0005b8b0: 2020 2020 2020 2073 656c 662e 7062 5f63         self.pb_c
-0005b8c0: 6c65 6172 616c 6c2e 636c 6963 6b65 642e  learall.clicked.
-0005b8d0: 636f 6e6e 6563 7428 7365 6c66 2e4f 6e43  connect(self.OnC
-0005b8e0: 6c65 6172 416c 6c29 0d0a 2020 2020 2020  learAll)..      
-0005b8f0: 2020 2020 2020 7365 6c66 2e65 766c 6973        self.evlis
-0005b900: 7463 6861 6e67 6564 2e63 6f6e 6e65 6374  tchanged.connect
-0005b910: 286c 616d 6264 6120 726f 773a 2073 656c  (lambda row: sel
-0005b920: 662e 714c 6973 7443 6861 6e67 6548 616e  f.qListChangeHan
-0005b930: 646c 6572 2872 6f77 2c20 2265 6e65 7267  dler(row, "energ
-0005b940: 7922 2929 0d0a 2020 2020 2020 2020 2020  y"))..          
-0005b950: 2020 7365 6c66 2e74 6865 7461 6c69 7374    self.thetalist
-0005b960: 6368 616e 6765 642e 636f 6e6e 6563 7428  changed.connect(
-0005b970: 6c61 6d62 6461 2072 6f77 3a20 7365 6c66  lambda row: self
-0005b980: 2e71 4c69 7374 4368 616e 6765 4861 6e64  .qListChangeHand
-0005b990: 6c65 7228 726f 772c 2022 7468 6574 6122  ler(row, "theta"
-0005b9a0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0005b9b0: 2373 656c 662e 6576 5f77 6964 6765 742e  #self.ev_widget.
-0005b9c0: 6974 656d 436c 6963 6b65 642e 636f 6e6e  itemClicked.conn
-0005b9d0: 6563 7428 6c61 6d62 6461 2069 7465 6d3a  ect(lambda item:
-0005b9e0: 2073 656c 662e 4f6e 4974 656d 436c 6963   self.OnItemClic
-0005b9f0: 6b65 6428 6974 656d 2929 0d0a 2020 2020  ked(item))..    
-0005ba00: 2020 2020 2020 2020 7365 6c66 2e65 765f          self.ev_
-0005ba10: 7769 6467 6574 2e6d 6f75 7365 5072 6573  widget.mousePres
-0005ba20: 7345 7665 6e74 203d 2073 656c 662e 6d6f  sEvent = self.mo
-0005ba30: 7573 6545 7665 6e74 4f6e 4556 4c69 7374  useEventOnEVList
-0005ba40: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0005ba50: 6c66 2e65 765f 7769 6467 6574 2e6d 6f75  lf.ev_widget.mou
-0005ba60: 7365 4d6f 7665 4576 656e 7420 3d20 7365  seMoveEvent = se
-0005ba70: 6c66 2e6d 6f75 7365 4576 656e 744f 6e45  lf.mouseEventOnE
-0005ba80: 564c 6973 740d 0a20 2020 2020 2020 2020  VList..         
-0005ba90: 2020 2073 656c 662e 7468 6574 615f 7769     self.theta_wi
-0005baa0: 6467 6574 2e6d 6f75 7365 5072 6573 7345  dget.mousePressE
-0005bab0: 7665 6e74 203d 2073 656c 662e 6d6f 7573  vent = self.mous
-0005bac0: 6545 7665 6e74 4f6e 5468 6574 614c 6973  eEventOnThetaLis
-0005bad0: 740d 0a20 2020 2020 2020 2020 2020 2073  t..            s
-0005bae0: 656c 662e 7468 6574 615f 7769 6467 6574  elf.theta_widget
-0005baf0: 2e6d 6f75 7365 4d6f 7665 4576 656e 7420  .mouseMoveEvent 
-0005bb00: 3d20 7365 6c66 2e6d 6f75 7365 4576 656e  = self.mouseEven
-0005bb10: 744f 6e54 6865 7461 4c69 7374 0d0a 2020  tOnThetaList..  
-0005bb20: 2020 2020 2020 2020 2020 2373 656c 662e            #self.
-0005bb30: 6576 5f77 6964 6765 742e 6974 656d 5365  ev_widget.itemSe
-0005bb40: 6c65 6374 696f 6e43 6861 6e67 6564 2e63  lectionChanged.c
-0005bb50: 6f6e 6e65 6374 286c 616d 6264 6120 6974  onnect(lambda it
-0005bb60: 656d 3a20 7365 6c66 2e4f 6e49 7465 6d43  em: self.OnItemC
-0005bb70: 6c69 636b 6564 2869 7465 6d29 290d 0a20  licked(item)).. 
-0005bb80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0005bb90: 5365 7475 704c 6973 7445 5628 290d 0a20  SetupListEV().. 
-0005bba0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0005bbb0: 4f6e 5363 726f 6c6c 456e 6728 3029 0d0a  OnScrollEng(0)..
-0005bbc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005bbd0: 2e53 6574 7570 524f 4928 290d 0a20 2020  .SetupROI()..   
-0005bbe0: 2020 2020 2020 2020 2073 656c 662e 5365           self.Se
-0005bbf0: 7475 7050 6c6f 7428 290d 0a0d 0a20 2020  tupPlot()....   
-0005bc00: 2064 6566 206d 6f75 7365 4576 656e 744f   def mouseEventO
-0005bc10: 6e45 564c 6973 7428 7365 6c66 2c20 6529  nEVList(self, e)
-0005bc20: 3a0d 0a20 2020 2020 2020 2069 6620 652e  :..        if e.
-0005bc30: 7479 7065 2829 203d 3d20 5174 436f 7265  type() == QtCore
-0005bc40: 2e51 4576 656e 742e 4d6f 7573 654d 6f76  .QEvent.MouseMov
-0005bc50: 6520 6f72 2065 2e74 7970 6528 2920 3d3d  e or e.type() ==
-0005bc60: 2051 7443 6f72 652e 5145 7665 6e74 2e4d   QtCore.QEvent.M
-0005bc70: 6f75 7365 4275 7474 6f6e 5072 6573 733a  ouseButtonPress:
-0005bc80: 0d0a 2020 2020 2020 2020 2020 2020 716c  ..            ql
-0005bc90: 6973 7420 3d20 7365 6c66 2e65 765f 7769  ist = self.ev_wi
-0005bca0: 6467 6574 0d0a 2020 2020 2020 2020 2020  dget..          
-0005bcb0: 2020 706f 7320 3d20 716c 6973 742e 6d61    pos = qlist.ma
-0005bcc0: 7046 726f 6d47 6c6f 6261 6c28 5174 4775  pFromGlobal(QtGu
-0005bcd0: 692e 5143 7572 736f 722e 706f 7328 2929  i.QCursor.pos())
-0005bce0: 0d0a 2020 2020 2020 2020 2020 2020 726f  ..            ro
-0005bcf0: 7720 3d20 716c 6973 742e 696e 6465 7841  w = qlist.indexA
-0005bd00: 7428 706f 7329 2e72 6f77 2829 0d0a 2020  t(pos).row()..  
-0005bd10: 2020 2020 2020 2020 2020 6974 656d 203d            item =
-0005bd20: 2071 6c69 7374 2e69 7465 6d41 7428 706f   qlist.itemAt(po
-0005bd30: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-0005bd40: 2370 7269 6e74 2872 6f77 2c73 656c 662e  #print(row,self.
-0005bd50: 6c61 7465 7374 5f72 6f77 290d 0a20 2020  latest_row)..   
-0005bd60: 2020 2020 2020 2020 2069 6620 726f 7720           if row 
-0005bd70: 3e3d 2030 3a0d 0a20 2020 2020 2020 2020  >= 0:..         
-0005bd80: 2020 2020 2020 2069 6620 652e 7479 7065         if e.type
-0005bd90: 2829 2021 3d20 5174 436f 7265 2e51 4576  () != QtCore.QEv
-0005bda0: 656e 742e 4d6f 7573 654d 6f76 6520 6f72  ent.MouseMove or
-0005bdb0: 2072 6f77 2021 3d20 7365 6c66 2e6c 6174   row != self.lat
-0005bdc0: 6573 745f 726f 773a 0d0a 2020 2020 2020  est_row:..      
-0005bdd0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0005bde0: 2065 2e62 7574 746f 6e73 2829 203d 3d20   e.buttons() == 
-0005bdf0: 5174 436f 7265 2e51 742e 4c65 6674 4275  QtCore.Qt.LeftBu
-0005be00: 7474 6f6e 3a0d 0a20 2020 2020 2020 2020  tton:..         
-0005be10: 2020 2020 2020 2020 2020 2020 2020 2071                 q
-0005be20: 6c69 7374 2e73 6574 4375 7272 656e 7452  list.setCurrentR
-0005be30: 6f77 2872 6f77 290d 0a20 2020 2020 2020  ow(row)..       
-0005be40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005be50: 2073 656c 662e 6576 6c69 7374 6368 616e   self.evlistchan
-0005be60: 6765 642e 656d 6974 2869 7465 6d29 0d0a  ged.emit(item)..
-0005be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005be80: 2020 2020 2020 2020 7365 6c66 2e6c 6174          self.lat
-0005be90: 6573 745f 726f 7720 3d20 726f 770d 0a20  est_row = row.. 
-0005bea0: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
-0005beb0: 2020 2064 6566 206d 6f75 7365 4576 656e     def mouseEven
-0005bec0: 744f 6e54 6865 7461 4c69 7374 2873 656c  tOnThetaList(sel
-0005bed0: 662c 2065 293a 0d0a 2020 2020 2020 2020  f, e):..        
-0005bee0: 6966 2065 2e74 7970 6528 2920 3d3d 2051  if e.type() == Q
-0005bef0: 7443 6f72 652e 5145 7665 6e74 2e4d 6f75  tCore.QEvent.Mou
-0005bf00: 7365 4d6f 7665 206f 7220 652e 7479 7065  seMove or e.type
-0005bf10: 2829 203d 3d20 5174 436f 7265 2e51 4576  () == QtCore.QEv
-0005bf20: 656e 742e 4d6f 7573 6542 7574 746f 6e50  ent.MouseButtonP
-0005bf30: 7265 7373 3a0d 0a20 2020 2020 2020 2020  ress:..         
-0005bf40: 2020 2071 6c69 7374 203d 2073 656c 662e     qlist = self.
-0005bf50: 7468 6574 615f 7769 6467 6574 0d0a 2020  theta_widget..  
-0005bf60: 2020 2020 2020 2020 2020 706f 7320 3d20            pos = 
-0005bf70: 716c 6973 742e 6d61 7046 726f 6d47 6c6f  qlist.mapFromGlo
-0005bf80: 6261 6c28 5174 4775 692e 5143 7572 736f  bal(QtGui.QCurso
-0005bf90: 722e 706f 7328 2929 0d0a 2020 2020 2020  r.pos())..      
-0005bfa0: 2020 2020 2020 726f 7720 3d20 716c 6973        row = qlis
-0005bfb0: 742e 696e 6465 7841 7428 706f 7329 2e72  t.indexAt(pos).r
-0005bfc0: 6f77 2829 0d0a 2020 2020 2020 2020 2020  ow()..          
-0005bfd0: 2020 6974 656d 203d 2071 6c69 7374 2e69    item = qlist.i
-0005bfe0: 7465 6d41 7428 706f 7329 0d0a 2020 2020  temAt(pos)..    
-0005bff0: 2020 2020 2020 2020 2370 7269 6e74 2872          #print(r
-0005c000: 6f77 2c73 656c 662e 6c61 7465 7374 5f72  ow,self.latest_r
-0005c010: 6f77 290d 0a20 2020 2020 2020 2020 2020  ow)..           
-0005c020: 2069 6620 726f 7720 3e3d 2030 3a0d 0a20   if row >= 0:.. 
-0005c030: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0005c040: 6620 652e 7479 7065 2829 2021 3d20 5174  f e.type() != Qt
-0005c050: 436f 7265 2e51 4576 656e 742e 4d6f 7573  Core.QEvent.Mous
-0005c060: 654d 6f76 6520 6f72 2072 6f77 2021 3d20  eMove or row != 
-0005c070: 7365 6c66 2e6c 6174 6573 745f 726f 773a  self.latest_row:
-0005c080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005c090: 2020 2020 2020 6966 2065 2e62 7574 746f        if e.butto
-0005c0a0: 6e73 2829 203d 3d20 5174 436f 7265 2e51  ns() == QtCore.Q
-0005c0b0: 742e 4c65 6674 4275 7474 6f6e 3a0d 0a20  t.LeftButton:.. 
-0005c0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005c0d0: 2020 2020 2020 2071 6c69 7374 2e73 6574         qlist.set
-0005c0e0: 4375 7272 656e 7452 6f77 2872 6f77 290d  CurrentRow(row).
-0005c0f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005c100: 2020 2020 2020 2020 2073 656c 662e 7468           self.th
-0005c110: 6574 616c 6973 7463 6861 6e67 6564 2e65  etalistchanged.e
-0005c120: 6d69 7428 6974 656d 290d 0a20 2020 2020  mit(item)..     
-0005c130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005c140: 2020 2073 656c 662e 6c61 7465 7374 5f72     self.latest_r
-0005c150: 6f77 203d 2072 6f77 0d0a 2020 2020 2020  ow = row..      
-0005c160: 2020 7265 7475 726e 0d0a 2020 2020 6465    return..    de
-0005c170: 6620 4f6e 5365 6c65 6374 696f 6e43 6861  f OnSelectionCha
-0005c180: 6e67 6564 2873 656c 6629 3a0d 0a20 2020  nged(self):..   
-0005c190: 2020 2020 2073 656c 662e 5265 6472 6177       self.Redraw
-0005c1a0: 4e65 7750 6c6f 7428 290d 0a20 2020 2020  NewPlot()..     
-0005c1b0: 2020 2023 7365 6c66 2e55 7064 6174 6549     #self.UpdateI
-0005c1c0: 6e64 6963 6573 2829 0d0a 2020 2020 2020  ndices()..      
-0005c1d0: 2020 7365 6c66 2e72 6567 696f 6e2e 626c    self.region.bl
-0005c1e0: 6f63 6b53 6967 6e61 6c73 2854 7275 6529  ockSignals(True)
-0005c1f0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0005c200: 662e 6964 785f 7365 6c65 6374 6564 3a0d  f.idx_selected:.
-0005c210: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0005c220: 662e 7265 6769 6f6e 2e73 6574 5265 6769  f.region.setRegi
-0005c230: 6f6e 285b 7365 6c66 2e73 7461 636b 2e65  on([self.stack.e
-0005c240: 765b 6d69 6e28 7365 6c66 2e69 6478 5f73  v[min(self.idx_s
-0005c250: 656c 6563 7465 6429 5d2c 2073 656c 662e  elected)], self.
-0005c260: 7374 6163 6b2e 6576 5b6d 6178 2873 656c  stack.ev[max(sel
-0005c270: 662e 6964 785f 7365 6c65 6374 6564 295d  f.idx_selected)]
-0005c280: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-0005c290: 7365 6c66 2e72 6567 696f 6e2e 626c 6f63  self.region.bloc
-0005c2a0: 6b53 6967 6e61 6c73 2846 616c 7365 290d  kSignals(False).
-0005c2b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0005c2c0: 662e 7370 6563 7472 756d 5f70 6c6f 7477  f.spectrum_plotw
-0005c2d0: 6964 6765 742e 7365 7458 5261 6e67 6528  idget.setXRange(
-0005c2e0: 2a73 656c 662e 7265 6769 6f6e 2e67 6574  *self.region.get
-0005c2f0: 5265 6769 6f6e 2829 290d 0a20 2020 2020  Region())..     
-0005c300: 2020 2020 2020 2073 656c 662e 7370 6563         self.spec
-0005c310: 7472 756d 5f70 6c6f 7477 6964 6765 742e  trum_plotwidget.
-0005c320: 7365 7459 5261 6e67 6528 6e70 2e6d 696e  setYRange(np.min
-0005c330: 2873 656c 662e 706c 6f74 6974 656d 5f6e  (self.plotitem_n
-0005c340: 6577 2e79 4461 7461 292c 6e70 2e6d 6178  ew.yData),np.max
-0005c350: 2873 656c 662e 706c 6f74 6974 656d 5f6e  (self.plotitem_n
-0005c360: 6577 2e79 4461 7461 2929 0d0a 2020 2020  ew.yData))..    
-0005c370: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
-0005c380: 6465 6620 5570 6461 7465 496e 6469 6365  def UpdateIndice
-0005c390: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
-0005c3a0: 2020 7365 6c66 2e69 6478 5f73 656c 6563    self.idx_selec
-0005c3b0: 7465 6420 3d20 736f 7274 6564 285b 7365  ted = sorted([se
-0005c3c0: 6c66 2e65 765f 7769 6467 6574 2e72 6f77  lf.ev_widget.row
-0005c3d0: 2869 2920 666f 7220 6920 696e 2073 656c  (i) for i in sel
-0005c3e0: 662e 6576 5f73 656c 6563 7465 645d 290d  f.ev_selected]).
-0005c3f0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0005c400: 2e63 6f6d 2e73 7461 636b 5f34 643a 0d0a  .com.stack_4d:..
-0005c410: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005c420: 2e74 6865 7461 6964 785f 7365 6c65 6374  .thetaidx_select
-0005c430: 6564 203d 2073 6f72 7465 6428 5b73 656c  ed = sorted([sel
-0005c440: 662e 7468 6574 615f 7769 6467 6574 2e72  f.theta_widget.r
-0005c450: 6f77 2869 2920 666f 7220 6920 696e 2073  ow(i) for i in s
-0005c460: 656c 662e 7468 6574 615f 7365 6c65 6374  elf.theta_select
-0005c470: 6564 5d29 0d0a 2020 2020 6465 6620 5265  ed])..    def Re
-0005c480: 6472 6177 506c 6f74 7328 7365 6c66 293a  drawPlots(self):
-0005c490: 0d0a 2020 2020 2020 2020 782c 7920 3d20  ..        x,y = 
-0005c4a0: 7365 6c66 2e47 656e 6572 6174 6553 7065  self.GenerateSpe
-0005c4b0: 6374 7275 6d28 6c69 7374 2872 616e 6765  ctrum(list(range
-0005c4c0: 2873 656c 662e 7374 6163 6b2e 6e5f 6576  (self.stack.n_ev
-0005c4d0: 2929 290d 0a20 2020 2020 2020 2073 656c  )))..        sel
-0005c4e0: 662e 706c 6f74 6974 656d 2e73 6574 4461  f.plotitem.setDa
-0005c4f0: 7461 2878 2c79 290d 0a20 2020 2020 2020  ta(x,y)..       
-0005c500: 2073 656c 662e 4f6e 5365 6c65 6374 696f   self.OnSelectio
-0005c510: 6e43 6861 6e67 6564 2829 0d0a 2020 2020  nChanged()..    
-0005c520: 6465 6620 5265 6472 6177 4e65 7750 6c6f  def RedrawNewPlo
-0005c530: 7428 7365 6c66 293a 0d0a 2020 2020 2020  t(self):..      
-0005c540: 2020 7365 6c66 2e55 7064 6174 6549 6e64    self.UpdateInd
-0005c550: 6963 6573 2829 0d0a 2020 2020 2020 2020  ices()..        
-0005c560: 782c 7920 3d20 7365 6c66 2e47 656e 6572  x,y = self.Gener
-0005c570: 6174 6553 7065 6374 7275 6d28 7365 6c66  ateSpectrum(self
-0005c580: 2e69 6478 5f73 656c 6563 7465 6429 0d0a  .idx_selected)..
-0005c590: 2020 2020 2020 2020 7365 6c66 2e70 6c6f          self.plo
-0005c5a0: 7469 7465 6d5f 6e65 772e 7365 7444 6174  titem_new.setDat
-0005c5b0: 6128 782c 7929 0d0a 2020 2020 2020 2020  a(x,y)..        
-0005c5c0: 6966 2073 656c 662e 6964 785f 7365 6c65  if self.idx_sele
-0005c5d0: 6374 6564 3a0d 0a20 2020 2020 2020 2020  cted:..         
-0005c5e0: 2020 2073 656c 662e 7265 6769 6f6e 2e73     self.region.s
-0005c5f0: 686f 7728 290d 0a20 2020 2064 6566 2071  how()..    def q
-0005c600: 4c69 7374 4368 616e 6765 4861 6e64 6c65  ListChangeHandle
-0005c610: 7228 7365 6c66 2c72 6f77 2c20 6469 6d65  r(self,row, dime
-0005c620: 6e73 696f 6e29 3a0d 0a20 2020 2020 2020  nsion):..       
-0005c630: 2069 6620 6469 6d65 6e73 696f 6e20 3d3d   if dimension ==
-0005c640: 2022 7468 6574 6122 3a0d 0a20 2020 2020   "theta":..     
-0005c650: 2020 2020 2020 2073 656c 6563 7469 6f6e         selection
-0005c660: 203d 2073 656c 662e 7468 6574 615f 7365   = self.theta_se
-0005c670: 6c65 6374 6564 0d0a 2020 2020 2020 2020  lected..        
-0005c680: 2020 2020 7769 6467 6574 203d 2073 656c      widget = sel
-0005c690: 662e 7468 6574 615f 7769 6467 6574 0d0a  f.theta_widget..
-0005c6a0: 2020 2020 2020 2020 656c 6966 2064 696d          elif dim
-0005c6b0: 656e 7369 6f6e 203d 3d20 2265 6e65 7267  ension == "energ
-0005c6c0: 7922 3a0d 0a20 2020 2020 2020 2020 2020  y":..           
-0005c6d0: 2073 656c 6563 7469 6f6e 203d 2073 656c   selection = sel
-0005c6e0: 662e 6576 5f73 656c 6563 7465 640d 0a20  f.ev_selected.. 
-0005c6f0: 2020 2020 2020 2020 2020 2077 6964 6765             widge
-0005c700: 7420 3d20 7365 6c66 2e65 765f 7769 6467  t = self.ev_widg
-0005c710: 6574 0d0a 0d0a 2020 2020 2020 2020 6966  et....        if
-0005c720: 2072 6f77 2069 6e20 7365 6c65 6374 696f   row in selectio
-0005c730: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-0005c740: 7365 6c65 6374 696f 6e2e 7265 6d6f 7665  selection.remove
-0005c750: 2872 6f77 290d 0a20 2020 2020 2020 2020  (row)..         
-0005c760: 2020 2072 6f77 2e73 6574 4261 636b 6772     row.setBackgr
-0005c770: 6f75 6e64 2851 7447 7569 2e51 436f 6c6f  ound(QtGui.QColo
-0005c780: 7228 302c 2030 2c20 302c 2030 2929 0d0a  r(0, 0, 0, 0))..
-0005c790: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0005c7a0: 2020 2020 2020 2020 2020 2073 656c 6563             selec
-0005c7b0: 7469 6f6e 2e61 7070 656e 6428 726f 7729  tion.append(row)
-0005c7c0: 0d0a 2020 2020 2020 2020 2020 2020 726f  ..            ro
-0005c7d0: 772e 7365 7442 6163 6b67 726f 756e 6428  w.setBackground(
-0005c7e0: 5174 4775 692e 5143 6f6c 6f72 2827 2362  QtGui.QColor('#b
-0005c7f0: 6561 6564 3427 2929 0d0a 2020 2020 2020  eaed4'))..      
-0005c800: 2020 6966 2064 696d 656e 7369 6f6e 203d    if dimension =
-0005c810: 3d20 2274 6865 7461 223a 0d0a 2020 2020  = "theta":..    
-0005c820: 2020 2020 2020 2020 7365 6c66 2e4f 6e53          self.OnS
-0005c830: 6372 6f6c 6c54 6865 7461 2877 6964 6765  crollTheta(widge
-0005c840: 742e 726f 7728 726f 7729 290d 0a20 2020  t.row(row))..   
-0005c850: 2020 2020 2065 6c69 6620 6469 6d65 6e73       elif dimens
-0005c860: 696f 6e20 3d3d 2022 656e 6572 6779 223a  ion == "energy":
-0005c870: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0005c880: 6c66 2e4f 6e53 6372 6f6c 6c45 6e67 2877  lf.OnScrollEng(w
-0005c890: 6964 6765 742e 726f 7728 726f 7729 290d  idget.row(row)).
-0005c8a0: 0a20 2020 2020 2020 2073 656c 662e 4f6e  .        self.On
-0005c8b0: 5365 6c65 6374 696f 6e43 6861 6e67 6564  SelectionChanged
-0005c8c0: 2829 0d0a 0d0a 2020 2020 6465 6620 5365  ()....    def Se
-0005c8d0: 7475 7050 6c6f 7428 7365 6c66 293a 0d0a  tupPlot(self):..
-0005c8e0: 2020 2020 2020 2020 782c 7920 3d20 7365          x,y = se
-0005c8f0: 6c66 2e47 656e 6572 6174 6553 7065 6374  lf.GenerateSpect
-0005c900: 7275 6d28 6c69 7374 2872 616e 6765 2873  rum(list(range(s
-0005c910: 656c 662e 7374 6163 6b2e 6e5f 6576 2929  elf.stack.n_ev))
-0005c920: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0005c930: 7370 6563 7472 756d 5f70 6c6f 7477 6964  spectrum_plotwid
-0005c940: 6765 742e 7365 7442 6163 6b67 726f 756e  get.setBackgroun
-0005c950: 6428 2277 2229 0d0a 0d0a 2020 2020 2020  d("w")....      
-0005c960: 2020 7365 6c66 2e72 6567 696f 6e20 3d20    self.region = 
-0005c970: 7067 2e4c 696e 6561 7252 6567 696f 6e49  pg.LinearRegionI
-0005c980: 7465 6d28 6272 7573 683d 5b32 3535 2c30  tem(brush=[255,0
-0005c990: 2c30 2c34 355d 2c62 6f75 6e64 733d 5b6e  ,0,45],bounds=[n
-0005c9a0: 702e 6d69 6e28 7829 2c6e 702e 6d61 7828  p.min(x),np.max(
-0005c9b0: 7829 5d29 0d0a 0d0a 2020 2020 2020 2020  x)])....        
-0005c9c0: 7365 6c66 2e72 6567 696f 6e2e 7365 745a  self.region.setZ
-0005c9d0: 5661 6c75 6528 3130 290d 0a20 2020 2020  Value(10)..     
-0005c9e0: 2020 2070 6c6f 7420 3d20 7365 6c66 2e73     plot = self.s
-0005c9f0: 7065 6374 7275 6d5f 706c 6f74 7769 6467  pectrum_plotwidg
-0005ca00: 6574 0d0a 2020 2020 2020 2020 706c 6f74  et..        plot
-0005ca10: 2e73 6574 4261 636b 6772 6f75 6e64 2822  .setBackground("
-0005ca20: 7722 290d 0a20 2020 2020 2020 2070 6c6f  w")..        plo
-0005ca30: 742e 6164 6449 7465 6d28 7365 6c66 2e72  t.addItem(self.r
-0005ca40: 6567 696f 6e2c 2069 676e 6f72 6542 6f75  egion, ignoreBou
-0005ca50: 6e64 733d 4661 6c73 6529 0d0a 2020 2020  nds=False)..    
-0005ca60: 2020 2020 706c 6f74 2e73 6574 4d6f 7573      plot.setMous
-0005ca70: 6545 6e61 626c 6564 2878 3d46 616c 7365  eEnabled(x=False
-0005ca80: 2c20 793d 4661 6c73 6529 0d0a 2020 2020  , y=False)..    
-0005ca90: 2020 2020 706c 6f74 2e73 686f 7747 7269      plot.showGri
-0005caa0: 6428 793d 5472 7565 290d 0a0d 0a20 2020  d(y=True)....   
-0005cab0: 2020 2020 2070 6c6f 742e 7368 6f77 4178       plot.showAx
-0005cac0: 6973 2822 746f 7022 2c20 7368 6f77 3d54  is("top", show=T
-0005cad0: 7275 6529 0d0a 2020 2020 2020 2020 706c  rue)..        pl
-0005cae0: 6f74 2e73 686f 7741 7869 7328 2272 6967  ot.showAxis("rig
-0005caf0: 6874 222c 2073 686f 773d 5472 7565 290d  ht", show=True).
-0005cb00: 0a20 2020 2020 2020 2062 7920 3d20 706c  .        by = pl
-0005cb10: 6f74 2e67 6574 4178 6973 2822 7269 6768  ot.getAxis("righ
-0005cb20: 7422 290d 0a20 2020 2020 2020 2062 7820  t")..        bx 
-0005cb30: 3d20 706c 6f74 2e67 6574 4178 6973 2822  = plot.getAxis("
-0005cb40: 746f 7022 290d 0a20 2020 2020 2020 2062  top")..        b
-0005cb50: 792e 7365 7453 7479 6c65 2873 686f 7756  y.setStyle(showV
-0005cb60: 616c 7565 733d 4661 6c73 652c 7469 636b  alues=False,tick
-0005cb70: 4c65 6e67 7468 3d30 290d 0a20 2020 2020  Length=0)..     
-0005cb80: 2020 2062 782e 7365 7453 7479 6c65 2873     bx.setStyle(s
-0005cb90: 686f 7756 616c 7565 733d 4661 6c73 652c  howValues=False,
-0005cba0: 7469 636b 4c65 6e67 7468 3d30 290d 0a20  tickLength=0).. 
-0005cbb0: 2020 2020 2020 2061 7920 3d20 706c 6f74         ay = plot
-0005cbc0: 2e67 6574 4178 6973 2822 6c65 6674 2229  .getAxis("left")
-0005cbd0: 0d0a 2020 2020 2020 2020 6178 203d 2070  ..        ax = p
-0005cbe0: 6c6f 742e 6765 7441 7869 7328 2262 6f74  lot.getAxis("bot
-0005cbf0: 746f 6d22 290d 0a0d 0a20 2020 2020 2020  tom")....       
-0005cc00: 2061 782e 7365 744c 6162 656c 2874 6578   ax.setLabel(tex
-0005cc10: 743d 2250 686f 746f 6e20 656e 6572 6779  t="Photon energy
-0005cc20: 205b 6556 5d22 290d 0a20 2020 2020 2020   [eV]")..       
-0005cc30: 2069 6620 7365 6c66 2e63 6f6d 2e69 305f   if self.com.i0_
-0005cc40: 6c6f 6164 6564 3a0d 0a20 2020 2020 2020  loaded:..       
-0005cc50: 2020 2020 2061 792e 7365 744c 6162 656c       ay.setLabel
-0005cc60: 2874 6578 743d 224f 7074 6963 616c 2064  (text="Optical d
-0005cc70: 656e 7369 7479 2229 0d0a 2020 2020 2020  ensity")..      
-0005cc80: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-0005cc90: 2020 2020 2061 792e 7365 744c 6162 656c       ay.setLabel
-0005cca0: 2874 6578 743d 2250 686f 746f 6e20 666c  (text="Photon fl
-0005ccb0: 7578 205b 6370 735d 2229 0d0a 0d0a 2020  ux [cps]")....  
-0005ccc0: 2020 2020 2020 7365 6c66 2e70 6c6f 7469        self.ploti
-0005ccd0: 7465 6d20 3d20 706c 6f74 2e70 6c6f 7428  tem = plot.plot(
-0005cce0: 782c 2079 2c20 7065 6e3d 7067 2e6d 6b50  x, y, pen=pg.mkP
-0005ccf0: 656e 2863 6f6c 6f72 3d30 2e38 2c20 7769  en(color=0.8, wi
-0005cd00: 6474 683d 3229 290d 0a20 2020 2020 2020  dth=2))..       
-0005cd10: 2073 656c 662e 706c 6f74 6974 656d 5f6e   self.plotitem_n
-0005cd20: 6577 203d 2070 6c6f 742e 706c 6f74 2878  ew = plot.plot(x
-0005cd30: 2c20 792c 2070 656e 3d70 672e 6d6b 5065  , y, pen=pg.mkPe
-0005cd40: 6e28 636f 6c6f 723d 2262 222c 2077 6964  n(color="b", wid
-0005cd50: 7468 3d32 2929 0d0a 2020 2020 2020 2020  th=2))..        
-0005cd60: 7365 6c66 2e72 6566 6d61 726b 6572 203d  self.refmarker =
-0005cd70: 2070 672e 496e 6669 6e69 7465 4c69 6e65   pg.InfiniteLine
-0005cd80: 2861 6e67 6c65 3d39 302c 206d 6f76 6162  (angle=90, movab
-0005cd90: 6c65 3d46 616c 7365 2c0d 0a20 2020 2020  le=False,..     
-0005cda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005cdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005cdc0: 2020 2020 7065 6e3d 7067 2e6d 6b50 656e      pen=pg.mkPen
-0005cdd0: 2863 6f6c 6f72 3d22 6222 2c20 7769 6474  (color="b", widt
-0005cde0: 683d 322c 2073 7479 6c65 3d51 7443 6f72  h=2, style=QtCor
-0005cdf0: 652e 5174 2e44 6173 684c 696e 6529 290d  e.Qt.DashLine)).
-0005ce00: 0a20 2020 2020 2020 2070 6c6f 742e 6164  .        plot.ad
-0005ce10: 6449 7465 6d28 7365 6c66 2e72 6566 6d61  dItem(self.refma
-0005ce20: 726b 6572 2c20 6967 6e6f 7265 426f 756e  rker, ignoreBoun
-0005ce30: 6473 3d54 7275 6529 0d0a 2020 2020 2020  ds=True)..      
-0005ce40: 2020 7365 6c66 2e72 6567 696f 6e2e 7365    self.region.se
-0005ce50: 7452 6567 696f 6e28 286d 696e 2878 292c  tRegion((min(x),
-0005ce60: 6d61 7828 7829 2929 0d0a 2020 2020 2020  max(x)))..      
-0005ce70: 2020 7365 6c66 2e72 6567 696f 6e2e 7369    self.region.si
-0005ce80: 6752 6567 696f 6e43 6861 6e67 6546 696e  gRegionChangeFin
-0005ce90: 6973 6865 642e 636f 6e6e 6563 7428 6c61  ished.connect(la
-0005cea0: 6d62 6461 2072 6567 696f 6e3a 2073 656c  mbda region: sel
-0005ceb0: 662e 5570 6461 7465 4556 5265 6769 6f6e  f.UpdateEVRegion
-0005cec0: 2872 6567 696f 6e29 290d 0a20 2020 2023  (region))..    #
-0005ced0: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
-0005cee0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005cef0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005cf00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005cf10: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6566  -------..    def
-0005cf20: 2067 6574 4461 7461 436c 6f73 6573 7454   getDataClosestT
-0005cf30: 6f52 6567 696f 6e28 7365 6c66 2c72 6567  oRegion(self,reg
-0005cf40: 696f 6e2c 706c 6f74 6974 656d 2c73 6e61  ion,plotitem,sna
-0005cf50: 7072 6567 696f 6e3d 4661 6c73 6529 3a0d  pregion=False):.
-0005cf60: 0a20 2020 2020 2020 206d 696e 6964 782c  .        minidx,
-0005cf70: 206d 6178 6964 7820 3d20 7265 6769 6f6e   maxidx = region
-0005cf80: 2e67 6574 5265 6769 6f6e 2829 0d0a 2020  .getRegion()..  
-0005cf90: 2020 2020 2020 6461 7461 203d 2070 6c6f        data = plo
-0005cfa0: 7469 7465 6d2e 6765 7444 6174 6128 295b  titem.getData()[
-0005cfb0: 305d 0d0a 2020 2020 2020 2020 696e 6465  0]..        inde
-0005cfc0: 7820 3d20 6c61 6d62 6461 2078 3a20 6e70  x = lambda x: np
-0005cfd0: 2e61 7267 6d69 6e28 6e70 2e61 6273 2864  .argmin(np.abs(d
-0005cfe0: 6174 6120 2d20 7829 290d 0a20 2020 2020  ata - x))..     
-0005cff0: 2020 206d 696e 6964 7820 3d20 696e 6465     minidx = inde
-0005d000: 7828 6d69 6e69 6478 290d 0a20 2020 2020  x(minidx)..     
-0005d010: 2020 206d 6178 6964 7820 3d20 696e 6465     maxidx = inde
-0005d020: 7828 6d61 7869 6478 290d 0a20 2020 2020  x(maxidx)..     
-0005d030: 2020 2069 6620 6d69 6e69 6478 203d 3d20     if minidx == 
-0005d040: 6d61 7869 6478 3a0d 0a20 2020 2020 2020  maxidx:..       
-0005d050: 2020 2020 206d 696e 6964 7820 3d20 300d       minidx = 0.
-0005d060: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
-0005d070: 6964 7820 3d20 6e70 2e61 7267 6d61 7828  idx = np.argmax(
-0005d080: 6461 7461 290d 0a20 2020 2020 2020 206d  data)..        m
-0005d090: 696e 6461 7461 203d 2064 6174 615b 6d69  indata = data[mi
-0005d0a0: 6e69 6478 5d0d 0a20 2020 2020 2020 206d  nidx]..        m
-0005d0b0: 6178 6461 7461 203d 2064 6174 615b 6d61  axdata = data[ma
-0005d0c0: 7869 6478 5d0d 0a20 2020 2020 2020 2069  xidx]..        i
-0005d0d0: 6620 736e 6170 7265 6769 6f6e 3a0d 0a20  f snapregion:.. 
-0005d0e0: 2020 2020 2020 2020 2020 2072 6567 696f             regio
-0005d0f0: 6e2e 626c 6f63 6b53 6967 6e61 6c73 2854  n.blockSignals(T
-0005d100: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
-0005d110: 2020 7265 6769 6f6e 2e73 6574 5265 6769    region.setRegi
-0005d120: 6f6e 285b 6d69 6e64 6174 612c 206d 6178  on([mindata, max
-0005d130: 6461 7461 5d29 2020 2320 736e 6170 2072  data])  # snap r
-0005d140: 6567 696f 6e20 746f 2064 6174 6120 706f  egion to data po
-0005d150: 696e 7473 0d0a 2020 2020 2020 2020 2020  ints..          
-0005d160: 2020 7265 6769 6f6e 2e62 6c6f 636b 5369    region.blockSi
-0005d170: 676e 616c 7328 4661 6c73 6529 0d0a 2020  gnals(False)..  
-0005d180: 2020 2020 2020 7265 7475 726e 206d 696e        return min
-0005d190: 6964 782c 206d 6178 6964 782c 206d 696e  idx, maxidx, min
-0005d1a0: 6461 7461 2c20 6d61 7864 6174 610d 0a20  data, maxdata.. 
-0005d1b0: 2020 200d 0a20 2020 2064 6566 2055 7064     ..    def Upd
-0005d1c0: 6174 6545 5652 6567 696f 6e28 7365 6c66  ateEVRegion(self
-0005d1d0: 2c20 7265 6769 6f6e 293a 0d0a 2020 2020  , region):..    
-0005d1e0: 2020 2020 6d69 6e5f 6964 782c 206d 6178      min_idx, max
-0005d1f0: 5f69 6478 2c2a 5f20 203d 2073 656c 662e  _idx,*_  = self.
-0005d200: 6765 7444 6174 6143 6c6f 7365 7374 546f  getDataClosestTo
-0005d210: 5265 6769 6f6e 2872 6567 696f 6e2c 7365  Region(region,se
-0005d220: 6c66 2e70 6c6f 7469 7465 6d2c 2054 7275  lf.plotitem, Tru
-0005d230: 6529 0d0a 2020 2020 2020 2020 795f 7661  e)..        y_va
-0005d240: 6c73 203d 2073 656c 662e 706c 6f74 6974  ls = self.plotit
-0005d250: 656d 2e79 4461 7461 5b6d 696e 5f69 6478  em.yData[min_idx
-0005d260: 3a6d 6178 5f69 6478 202b 2031 5d0d 0a20  :max_idx + 1].. 
-0005d270: 2020 2020 2020 2078 5f76 616c 7320 3d20         x_vals = 
-0005d280: 7365 6c66 2e70 6c6f 7469 7465 6d2e 7844  self.plotitem.xD
-0005d290: 6174 615b 6d69 6e5f 6964 783a 6d61 785f  ata[min_idx:max_
-0005d2a0: 6964 7820 2b20 315d 0d0a 2020 2020 2020  idx + 1]..      
-0005d2b0: 2020 7365 6c66 2e73 7065 6374 7275 6d5f    self.spectrum_
-0005d2c0: 706c 6f74 7769 6467 6574 2e73 6574 5261  plotwidget.setRa
-0005d2d0: 6e67 6528 7952 616e 6765 3d5b 6e70 2e6d  nge(yRange=[np.m
-0005d2e0: 696e 2879 5f76 616c 7329 2c20 6e70 2e6d  in(y_vals), np.m
-0005d2f0: 6178 2879 5f76 616c 7329 5d2c 2078 5261  ax(y_vals)], xRa
-0005d300: 6e67 653d 5b6e 702e 6d69 6e28 785f 7661  nge=[np.min(x_va
-0005d310: 6c73 292c 206e 702e 6d61 7828 785f 7661  ls), np.max(x_va
-0005d320: 6c73 295d 2c20 6469 7361 626c 6541 7574  ls)], disableAut
-0005d330: 6f52 616e 6765 3d54 7275 652c 2070 6164  oRange=True, pad
-0005d340: 6469 6e67 3d30 2e30 3529 0d0a 2020 2020  ding=0.05)..    
-0005d350: 2020 2020 6966 206d 696e 5f69 6478 206e      if min_idx n
-0005d360: 6f74 2069 6e20 7365 6c66 2e69 6478 5f73  ot in self.idx_s
-0005d370: 656c 6563 7465 643a 0d0a 2020 2020 2020  elected:..      
-0005d380: 2020 2020 2020 666f 7220 6964 7820 696e        for idx in
-0005d390: 2072 616e 6765 2869 6e74 286d 696e 5f69   range(int(min_i
-0005d3a0: 6478 292c 6e70 2e6d 696e 2873 656c 662e  dx),np.min(self.
-0005d3b0: 6964 785f 7365 6c65 6374 6564 2929 3a0d  idx_selected)):.
-0005d3c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005d3d0: 2073 656c 662e 6576 5f73 656c 6563 7465   self.ev_selecte
-0005d3e0: 642e 6170 7065 6e64 2873 656c 662e 6576  d.append(self.ev
-0005d3f0: 5f77 6964 6765 742e 6974 656d 2869 6478  _widget.item(idx
-0005d400: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0005d410: 2020 2020 7365 6c66 2e65 765f 7769 6467      self.ev_widg
-0005d420: 6574 2e69 7465 6d28 6964 7829 2e73 6574  et.item(idx).set
-0005d430: 4261 636b 6772 6f75 6e64 2851 7447 7569  Background(QtGui
-0005d440: 2e51 436f 6c6f 7228 2723 6265 6165 6434  .QColor('#beaed4
-0005d450: 2729 290d 0a20 2020 2020 2020 2065 6c73  '))..        els
-0005d460: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0005d470: 666f 7220 6964 7820 696e 2072 616e 6765  for idx in range
-0005d480: 286e 702e 6d69 6e28 7365 6c66 2e69 6478  (np.min(self.idx
-0005d490: 5f73 656c 6563 7465 6429 2c69 6e74 286d  _selected),int(m
-0005d4a0: 696e 5f69 6478 2929 3a0d 0a20 2020 2020  in_idx)):..     
-0005d4b0: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
-0005d4c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005d4d0: 2020 2020 2073 656c 662e 6576 5f73 656c       self.ev_sel
-0005d4e0: 6563 7465 642e 7265 6d6f 7665 2873 656c  ected.remove(sel
-0005d4f0: 662e 6576 5f77 6964 6765 742e 6974 656d  f.ev_widget.item
-0005d500: 2869 6478 2929 0d0a 2020 2020 2020 2020  (idx))..        
-0005d510: 2020 2020 2020 2020 6578 6365 7074 2056          except V
-0005d520: 616c 7565 4572 726f 723a 0d0a 2020 2020  alueError:..    
-0005d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d540: 7061 7373 0d0a 2020 2020 2020 2020 2020  pass..          
-0005d550: 2020 2020 2020 7365 6c66 2e65 765f 7769        self.ev_wi
-0005d560: 6467 6574 2e69 7465 6d28 6964 7829 2e73  dget.item(idx).s
-0005d570: 6574 4261 636b 6772 6f75 6e64 2851 7447  etBackground(QtG
-0005d580: 7569 2e51 436f 6c6f 7228 302c 2030 2c20  ui.QColor(0, 0, 
-0005d590: 302c 2030 2929 0d0a 2020 2020 2020 2020  0, 0))..        
-0005d5a0: 6966 206d 6178 5f69 6478 206e 6f74 2069  if max_idx not i
-0005d5b0: 6e20 7365 6c66 2e69 6478 5f73 656c 6563  n self.idx_selec
-0005d5c0: 7465 643a 0d0a 2020 2020 2020 2020 2020  ted:..          
-0005d5d0: 2020 666f 7220 6964 7820 696e 2072 616e    for idx in ran
-0005d5e0: 6765 286e 702e 6d61 7828 7365 6c66 2e69  ge(np.max(self.i
-0005d5f0: 6478 5f73 656c 6563 7465 6429 2b31 2c69  dx_selected)+1,i
-0005d600: 6e74 286d 6178 5f69 6478 292b 3129 3a0d  nt(max_idx)+1):.
-0005d610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005d620: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-0005d630: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0005d640: 6576 5f73 656c 6563 7465 642e 6170 7065  ev_selected.appe
-0005d650: 6e64 2873 656c 662e 6576 5f77 6964 6765  nd(self.ev_widge
-0005d660: 742e 6974 656d 2869 6478 2929 0d0a 2020  t.item(idx))..  
-0005d670: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0005d680: 6365 7074 2056 616c 7565 4572 726f 723a  cept ValueError:
-0005d690: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005d6a0: 2020 2020 2020 7061 7373 0d0a 2020 2020        pass..    
-0005d6b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005d6c0: 2e65 765f 7769 6467 6574 2e69 7465 6d28  .ev_widget.item(
-0005d6d0: 6964 7829 2e73 6574 4261 636b 6772 6f75  idx).setBackgrou
-0005d6e0: 6e64 2851 7447 7569 2e51 436f 6c6f 7228  nd(QtGui.QColor(
-0005d6f0: 2723 6265 6165 6434 2729 290d 0a20 2020  '#beaed4'))..   
-0005d700: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0005d710: 2020 2020 2020 2020 666f 7220 6964 7820          for idx 
-0005d720: 696e 2072 616e 6765 2869 6e74 286d 6178  in range(int(max
-0005d730: 5f69 6478 292b 312c 6e70 2e6d 6178 2873  _idx)+1,np.max(s
-0005d740: 656c 662e 6964 785f 7365 6c65 6374 6564  elf.idx_selected
-0005d750: 292b 3129 3a0d 0a20 2020 2020 2020 2020  )+1):..         
-0005d760: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-0005d770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d780: 2073 656c 662e 6576 5f73 656c 6563 7465   self.ev_selecte
-0005d790: 642e 7265 6d6f 7665 2873 656c 662e 6576  d.remove(self.ev
-0005d7a0: 5f77 6964 6765 742e 6974 656d 2869 6478  _widget.item(idx
-0005d7b0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0005d7c0: 2020 2020 6578 6365 7074 2056 616c 7565      except Value
-0005d7d0: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
-0005d7e0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-0005d7f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005d800: 2020 7365 6c66 2e65 765f 7769 6467 6574    self.ev_widget
-0005d810: 2e69 7465 6d28 6964 7829 2e73 6574 4261  .item(idx).setBa
-0005d820: 636b 6772 6f75 6e64 2851 7447 7569 2e51  ckground(QtGui.Q
-0005d830: 436f 6c6f 7228 302c 2030 2c20 302c 2030  Color(0, 0, 0, 0
-0005d840: 2929 0d0a 2020 2020 2020 2020 7365 6c66  ))..        self
-0005d850: 2e52 6564 7261 774e 6577 506c 6f74 2829  .RedrawNewPlot()
-0005d860: 0d0a 2020 2020 6465 6620 4f6e 5365 6c65  ..    def OnSele
-0005d870: 6374 416c 6c28 7365 6c66 293a 0d0a 2020  ctAll(self):..  
-0005d880: 2020 2020 2020 7365 6c66 2e65 765f 7769        self.ev_wi
-0005d890: 6467 6574 2e63 6c65 6172 2829 0d0a 2020  dget.clear()..  
-0005d8a0: 2020 2020 2020 7365 6c66 2e53 6574 7570        self.Setup
-0005d8b0: 4c69 7374 4556 2829 0d0a 2020 2020 2020  ListEV()..      
-0005d8c0: 2020 6966 2073 656c 662e 636f 6d2e 7374    if self.com.st
-0005d8d0: 6163 6b5f 3464 3a0d 0a20 2020 2020 2020  ack_4d:..       
-0005d8e0: 2020 2020 2073 656c 662e 7468 6574 615f       self.theta_
-0005d8f0: 7769 6467 6574 2e63 6c65 6172 2829 0d0a  widget.clear()..
-0005d900: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005d910: 2e53 6574 7570 4c69 7374 5468 6574 6128  .SetupListTheta(
-0005d920: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0005d930: 7265 6769 6f6e 2e73 6574 5265 6769 6f6e  region.setRegion
-0005d940: 2828 6d69 6e28 7365 6c66 2e73 7461 636b  ((min(self.stack
-0005d950: 2e65 7629 2c20 6d61 7828 7365 6c66 2e73  .ev), max(self.s
-0005d960: 7461 636b 2e65 7629 2929 0d0a 2020 2020  tack.ev)))..    
-0005d970: 2020 2020 7365 6c66 2e72 6567 696f 6e2e      self.region.
-0005d980: 7368 6f77 2829 0d0a 2020 2020 2020 2020  show()..        
-0005d990: 7365 6c66 2e52 6564 7261 774e 6577 506c  self.RedrawNewPl
-0005d9a0: 6f74 2829 0d0a 2020 2020 6465 6620 4f6e  ot()..    def On
-0005d9b0: 436c 6561 7241 6c6c 2873 656c 6629 3a0d  ClearAll(self):.
-0005d9c0: 0a20 2020 2020 2020 2023 7365 6c66 2e65  .        #self.e
-0005d9d0: 765f 7769 6467 6574 2e63 6c65 6172 2829  v_widget.clear()
-0005d9e0: 0d0a 2020 2020 2020 2020 2373 656c 662e  ..        #self.
-0005d9f0: 5365 7475 704c 6973 7445 5628 290d 0a20  SetupListEV().. 
-0005da00: 2020 2020 2020 2073 656c 662e 7265 6769         self.regi
-0005da10: 6f6e 2e68 6964 6528 290d 0a20 2020 2020  on.hide()..     
-0005da20: 2020 2066 6f72 2069 6478 2069 6e20 7365     for idx in se
-0005da30: 6c66 2e69 6478 5f73 656c 6563 7465 643a  lf.idx_selected:
-0005da40: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0005da50: 6c66 2e65 765f 7769 6467 6574 2e69 7465  lf.ev_widget.ite
-0005da60: 6d28 6964 7829 2e73 6574 4261 636b 6772  m(idx).setBackgr
-0005da70: 6f75 6e64 2851 7447 7569 2e51 436f 6c6f  ound(QtGui.QColo
-0005da80: 7228 302c 2030 2c20 302c 2030 2929 0d0a  r(0, 0, 0, 0))..
-0005da90: 2020 2020 2020 2020 7365 6c66 2e65 765f          self.ev_
-0005daa0: 7365 6c65 6374 6564 203d 205b 5d0d 0a20  selected = [].. 
-0005dab0: 2020 2020 2020 2073 656c 662e 6964 785f         self.idx_
-0005dac0: 7365 6c65 6374 6564 203d 205b 5d0d 0a20  selected = [].. 
-0005dad0: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
-0005dae0: 6f6d 2e73 7461 636b 5f34 643a 0d0a 2020  om.stack_4d:..  
-0005daf0: 2020 2020 2020 2020 2020 666f 7220 6964            for id
-0005db00: 7820 696e 2073 656c 662e 7468 6574 6169  x in self.thetai
-0005db10: 6478 5f73 656c 6563 7465 643a 0d0a 2020  dx_selected:..  
-0005db20: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0005db30: 6c66 2e74 6865 7461 5f77 6964 6765 742e  lf.theta_widget.
-0005db40: 6974 656d 2869 6478 292e 7365 7442 6163  item(idx).setBac
-0005db50: 6b67 726f 756e 6428 5174 4775 692e 5143  kground(QtGui.QC
-0005db60: 6f6c 6f72 2830 2c20 302c 2030 2c20 3029  olor(0, 0, 0, 0)
-0005db70: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-0005db80: 656c 662e 7468 6574 615f 7365 6c65 6374  elf.theta_select
-0005db90: 6564 203d 205b 5d0d 0a20 2020 2020 2020  ed = []..       
-0005dba0: 2020 2020 2073 656c 662e 7468 6574 6169       self.thetai
-0005dbb0: 6478 5f73 656c 6563 7465 6420 3d20 5b5d  dx_selected = []
-0005dbc0: 0d0a 2020 2020 2020 2020 7365 6c66 2e52  ..        self.R
-0005dbd0: 6564 7261 774e 6577 506c 6f74 2829 0d0a  edrawNewPlot()..
-0005dbe0: 2020 2020 6465 6620 5365 7475 704c 6973      def SetupLis
-0005dbf0: 7454 6865 7461 2873 656c 6629 3a0d 0a20  tTheta(self):.. 
-0005dc00: 2020 2020 2020 2073 656c 662e 7468 6574         self.thet
-0005dc10: 615f 7365 6c65 6374 6564 203d 205b 5d0d  a_selected = [].
-0005dc20: 0a20 2020 2020 2020 2073 656c 662e 7468  .        self.th
-0005dc30: 6574 6169 6478 5f73 656c 6563 7465 6420  etaidx_selected 
-0005dc40: 3d20 5b5d 0d0a 2020 2020 2020 2020 666f  = []..        fo
-0005dc50: 7220 692c 6520 696e 2065 6e75 6d65 7261  r i,e in enumera
-0005dc60: 7465 2873 656c 662e 7374 6163 6b2e 7468  te(self.stack.th
-0005dc70: 6574 6129 3a20 2320 4669 6c6c 2051 4c69  eta): # Fill QLi
-0005dc80: 7374 2077 6974 6820 656e 6572 6769 6573  st with energies
-0005dc90: 0d0a 2020 2020 2020 2020 2020 2020 2373  ..            #s
-0005dca0: 656c 662e 7374 6b2e 7368 6966 7473 2e61  elf.stk.shifts.a
-0005dcb0: 7070 656e 6428 5b31 2c30 2c28 302e 302c  ppend([1,0,(0.0,
-0005dcc0: 302e 3029 5d29 2023 6368 6563 6b65 6420  0.0)]) #checked 
-0005dcd0: 5b30 2c31 5d3b 2070 7265 2c20 706f 7374  [0,1]; pre, post
-0005dce0: 2c20 756e 6465 6669 6e65 6420 7374 6174  , undefined stat
-0005dcf0: 6520 666f 7220 6d61 7020 5b2d 312c 312c  e for map [-1,1,
-0005dd00: 305d 2c28 7873 6869 6674 205b 666c 6f61  0],(xshift [floa
-0005dd10: 745d 2c79 7368 6966 7420 5b66 6c6f 6174  t],yshift [float
-0005dd20: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-0005dd30: 6974 656d 203d 2051 7457 6964 6765 7473  item = QtWidgets
-0005dd40: 2e51 4c69 7374 5769 6467 6574 4974 656d  .QListWidgetItem
-0005dd50: 2873 7472 2869 6e74 2869 2929 2e7a 6669  (str(int(i)).zfi
-0005dd60: 6c6c 2833 292b 2220 2020 2020 6174 2020  ll(3)+"     at  
-0005dd70: 2020 2022 202b 2066 6f72 6d61 7428 652c     " + format(e,
-0005dd80: 2027 2e31 6627 2920 2b20 22c2 b022 290d   '.1f') + "..").
-0005dd90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0005dda0: 662e 7468 6574 615f 7769 6467 6574 2e61  f.theta_widget.a
-0005ddb0: 6464 4974 656d 2869 7465 6d29 0d0a 2020  ddItem(item)..  
-0005ddc0: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-0005ddd0: 6865 7461 5f73 656c 6563 7465 642e 6170  heta_selected.ap
-0005dde0: 7065 6e64 2869 7465 6d29 0d0a 2020 2020  pend(item)..    
-0005ddf0: 2020 2020 2020 2020 7365 6c66 2e74 6865          self.the
-0005de00: 7461 6964 785f 7365 6c65 6374 6564 2e61  taidx_selected.a
-0005de10: 7070 656e 6428 6929 0d0a 2020 2020 2020  ppend(i)..      
-0005de20: 2020 2020 2020 6974 656d 2e73 6574 4261        item.setBa
-0005de30: 636b 6772 6f75 6e64 2851 7447 7569 2e51  ckground(QtGui.Q
-0005de40: 436f 6c6f 7228 2723 6265 6165 6434 2729  Color('#beaed4')
-0005de50: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0005de60: 7465 6d2e 7365 7446 6f72 6567 726f 756e  tem.setForegroun
-0005de70: 6428 5174 4775 692e 5143 6f6c 6f72 2830  d(QtGui.QColor(0
-0005de80: 2c20 302c 2030 2c20 3132 3829 290d 0a20  , 0, 0, 128)).. 
-0005de90: 2020 2064 6566 2053 6574 7570 4c69 7374     def SetupList
-0005dea0: 4556 2873 656c 6629 3a0d 0a20 2020 2020  EV(self):..     
-0005deb0: 2020 2073 656c 662e 6576 5f73 656c 6563     self.ev_selec
-0005dec0: 7465 6420 3d20 5b5d 0d0a 2020 2020 2020  ted = []..      
-0005ded0: 2020 7365 6c66 2e69 6478 5f73 656c 6563    self.idx_selec
-0005dee0: 7465 6420 3d20 5b5d 0d0a 2020 2020 2020  ted = []..      
-0005def0: 2020 666f 7220 692c 6520 696e 2065 6e75    for i,e in enu
-0005df00: 6d65 7261 7465 2873 656c 662e 7374 6163  merate(self.stac
-0005df10: 6b2e 6576 293a 2023 2046 696c 6c20 514c  k.ev): # Fill QL
-0005df20: 6973 7420 7769 7468 2065 6e65 7267 6965  ist with energie
-0005df30: 730d 0a20 2020 2020 2020 2020 2020 2023  s..            #
-0005df40: 7365 6c66 2e73 746b 2e73 6869 6674 732e  self.stk.shifts.
-0005df50: 6170 7065 6e64 285b 312c 302c 2830 2e30  append([1,0,(0.0
-0005df60: 2c30 2e30 295d 2920 2363 6865 636b 6564  ,0.0)]) #checked
-0005df70: 205b 302c 315d 3b20 7072 652c 2070 6f73   [0,1]; pre, pos
-0005df80: 742c 2075 6e64 6566 696e 6564 2073 7461  t, undefined sta
-0005df90: 7465 2066 6f72 206d 6170 205b 2d31 2c31  te for map [-1,1
-0005dfa0: 2c30 5d2c 2878 7368 6966 7420 5b66 6c6f  ,0],(xshift [flo
-0005dfb0: 6174 5d2c 7973 6869 6674 205b 666c 6f61  at],yshift [floa
-0005dfc0: 745d 290d 0a20 2020 2020 2020 2020 2020  t])..           
-0005dfd0: 2069 7465 6d20 3d20 5174 5769 6467 6574   item = QtWidget
-0005dfe0: 732e 514c 6973 7457 6964 6765 7449 7465  s.QListWidgetIte
-0005dff0: 6d28 7374 7228 696e 7428 6929 292e 7a66  m(str(int(i)).zf
-0005e000: 696c 6c28 3329 2b22 2020 2020 2061 7420  ill(3)+"     at 
-0005e010: 2020 2020 2220 2b20 666f 726d 6174 2865      " + format(e
-0005e020: 2c20 272e 3266 2729 202b 2022 2065 5622  , '.2f') + " eV"
-0005e030: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-0005e040: 656c 662e 6576 5f77 6964 6765 742e 6164  elf.ev_widget.ad
-0005e050: 6449 7465 6d28 6974 656d 290d 0a20 2020  dItem(item)..   
-0005e060: 2020 2020 2020 2020 2073 656c 662e 6576           self.ev
-0005e070: 5f73 656c 6563 7465 642e 6170 7065 6e64  _selected.append
-0005e080: 2869 7465 6d29 0d0a 2020 2020 2020 2020  (item)..        
-0005e090: 2020 2020 7365 6c66 2e69 6478 5f73 656c      self.idx_sel
-0005e0a0: 6563 7465 642e 6170 7065 6e64 2869 290d  ected.append(i).
-0005e0b0: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
-0005e0c0: 6d2e 7365 7442 6163 6b67 726f 756e 6428  m.setBackground(
-0005e0d0: 5174 4775 692e 5143 6f6c 6f72 2827 2362  QtGui.QColor('#b
-0005e0e0: 6561 6564 3427 2929 0d0a 2020 2020 2020  eaed4'))..      
-0005e0f0: 2020 2020 2020 6974 656d 2e73 6574 466f        item.setFo
-0005e100: 7265 6772 6f75 6e64 2851 7447 7569 2e51  reground(QtGui.Q
-0005e110: 436f 6c6f 7228 302c 2030 2c20 302c 2031  Color(0, 0, 0, 1
-0005e120: 3238 2929 0d0a 0d0a 2020 2020 6465 6620  28))....    def 
-0005e130: 4f6e 5363 726f 6c6c 5468 6574 6128 7365  OnScrollTheta(se
-0005e140: 6c66 2c20 7661 6c75 6529 3a0d 0a20 2020  lf, value):..   
-0005e150: 2020 2020 2073 656c 662e 736c 6964 6572       self.slider
-0005e160: 5f74 6865 7461 2e73 6574 5661 6c75 6528  _theta.setValue(
-0005e170: 7661 6c75 6529 0d0a 2020 2020 2020 2020  value)..        
-0005e180: 7365 6c66 2e52 6573 6574 416c 6c49 7465  self.ResetAllIte
-0005e190: 6d73 2873 656c 662e 7468 6574 615f 7769  ms(self.theta_wi
-0005e1a0: 6467 6574 290d 0a20 2020 2020 2020 2073  dget)..        s
-0005e1b0: 656c 662e 6974 6865 7461 203d 2076 616c  elf.itheta = val
-0005e1c0: 7565 0d0a 2020 2020 2020 2020 2373 656c  ue..        #sel
-0005e1d0: 662e 7374 6163 6b2e 6162 7364 6174 6120  f.stack.absdata 
-0005e1e0: 3d20 7365 6c66 2e73 7461 636b 2e73 7461  = self.stack.sta
-0005e1f0: 636b 3444 5b3a 2c3a 2c3a 2c73 656c 662e  ck4D[:,:,:,self.
-0005e200: 6974 6865 7461 5d2e 636f 7079 2829 0d0a  itheta].copy()..
-0005e210: 2020 2020 2020 2020 7365 6c66 2e53 686f          self.Sho
-0005e220: 7749 6d61 6765 2829 0d0a 2020 2020 2020  wImage()..      
-0005e230: 2020 7365 6c66 2e74 6865 7461 5f77 6964    self.theta_wid
-0005e240: 6765 742e 7365 7443 7572 7265 6e74 526f  get.setCurrentRo
-0005e250: 7728 7365 6c66 2e69 7468 6574 6129 0d0a  w(self.itheta)..
-0005e260: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0005e270: 636f 6d2e 7374 6163 6b5f 6c6f 6164 6564  com.stack_loaded
-0005e280: 203d 3d20 313a 0d0a 2020 2020 2020 2020   == 1:..        
-0005e290: 2020 2020 7365 6c66 2e74 6865 7461 5f77      self.theta_w
-0005e2a0: 6964 6765 742e 6974 656d 2876 616c 7565  idget.item(value
-0005e2b0: 292e 7365 7446 6f72 6567 726f 756e 6428  ).setForeground(
-0005e2c0: 5174 4775 692e 5143 6f6c 6f72 2830 2c20  QtGui.QColor(0, 
-0005e2d0: 302c 2030 2c20 3235 3529 290d 0a20 2020  0, 0, 255))..   
-0005e2e0: 2020 2020 2073 656c 662e 5265 6472 6177       self.Redraw
-0005e2f0: 506c 6f74 7328 290d 0a20 2020 2064 6566  Plots()..    def
-0005e300: 204f 6e53 6372 6f6c 6c45 6e67 2873 656c   OnScrollEng(sel
-0005e310: 662c 2076 616c 7565 293a 0d0a 2020 2020  f, value):..    
-0005e320: 2020 2020 7365 6c66 2e73 6c69 6465 725f      self.slider_
-0005e330: 656e 672e 7365 7456 616c 7565 2876 616c  eng.setValue(val
-0005e340: 7565 290d 0a20 2020 2020 2020 2073 656c  ue)..        sel
-0005e350: 662e 5265 7365 7441 6c6c 4974 656d 7328  f.ResetAllItems(
-0005e360: 7365 6c66 2e65 765f 7769 6467 6574 290d  self.ev_widget).
-0005e370: 0a20 2020 2020 2020 2073 656c 662e 6965  .        self.ie
-0005e380: 7620 3d20 7661 6c75 650d 0a20 2020 2020  v = value..     
-0005e390: 2020 2073 656c 662e 5368 6f77 496d 6167     self.ShowImag
-0005e3a0: 6528 290d 0a20 2020 2020 2020 2074 7279  e()..        try
-0005e3b0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0005e3c0: 656c 662e 7265 666d 6172 6b65 722e 7365  elf.refmarker.se
-0005e3d0: 7456 616c 7565 2873 656c 662e 7374 6163  tValue(self.stac
-0005e3e0: 6b2e 6576 5b73 656c 662e 6965 765d 290d  k.ev[self.iev]).
-0005e3f0: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
-0005e400: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
-0005e410: 7373 0d0a 2020 2020 2020 2020 7365 6c66  ss..        self
-0005e420: 2e65 765f 7769 6467 6574 2e73 6574 4375  .ev_widget.setCu
-0005e430: 7272 656e 7452 6f77 2873 656c 662e 6965  rrentRow(self.ie
-0005e440: 7629 0d0a 2020 2020 2020 2020 6966 2073  v)..        if s
-0005e450: 656c 662e 636f 6d2e 7374 6163 6b5f 6c6f  elf.com.stack_lo
-0005e460: 6164 6564 203d 3d20 313a 0d0a 2020 2020  aded == 1:..    
-0005e470: 2020 2020 2020 2020 7365 6c66 2e65 765f          self.ev_
-0005e480: 7769 6467 6574 2e69 7465 6d28 7661 6c75  widget.item(valu
-0005e490: 6529 2e73 6574 466f 7265 6772 6f75 6e64  e).setForeground
-0005e4a0: 2851 7447 7569 2e51 436f 6c6f 7228 302c  (QtGui.QColor(0,
-0005e4b0: 2030 2c20 302c 2032 3535 2929 0d0a 2020   0, 0, 255))..  
-0005e4c0: 2020 6465 6620 5368 6f77 496d 6167 6528    def ShowImage(
-0005e4d0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-0005e4e0: 6966 2073 656c 662e 636f 6d2e 7374 6163  if self.com.stac
-0005e4f0: 6b5f 3464 203d 3d20 313a 0d0a 2020 2020  k_4d == 1:..    
-0005e500: 2020 2020 2020 2020 7365 6c66 2e69 5f69          self.i_i
-0005e510: 7465 6d2e 7365 7449 6d61 6765 2873 656c  tem.setImage(sel
-0005e520: 662e 7374 6163 6b2e 7374 6163 6b34 445b  f.stack.stack4D[
-0005e530: 3a2c 203a 2c20 696e 7428 7365 6c66 2e69  :, :, int(self.i
-0005e540: 6576 292c 696e 7428 7365 6c66 2e69 7468  ev),int(self.ith
-0005e550: 6574 6129 5d29 0d0a 2020 2020 2020 2020  eta)])..        
-0005e560: 2020 2020 7365 6c66 2e67 726f 7570 426f      self.groupBo
-0005e570: 782e 7365 7454 6974 6c65 2873 7472 2827  x.setTitle(str('
-0005e580: 5374 6163 6b20 4272 6f77 7365 7220 7c20  Stack Browser | 
-0005e590: 496d 6167 6520 6174 207b 303a 352e 3266  Image at {0:5.2f
-0005e5a0: 7d20 6556 2061 6e64 207b 313a 352e 3166  } eV and {1:5.1f
-0005e5b0: 7dc2 b027 292e 666f 726d 6174 2866 6c6f  }..').format(flo
-0005e5c0: 6174 2873 656c 662e 7374 6163 6b2e 6576  at(self.stack.ev
-0005e5d0: 5b73 656c 662e 6965 765d 292c 666c 6f61  [self.iev]),floa
-0005e5e0: 7428 7365 6c66 2e73 7461 636b 2e74 6865  t(self.stack.the
-0005e5f0: 7461 5b73 656c 662e 6974 6865 7461 5d29  ta[self.itheta])
-0005e600: 2c20 2929 0d0a 2020 2020 2020 2020 656c  , ))..        el
-0005e610: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-0005e620: 2069 6620 7365 6c66 2e63 6f6d 2e69 305f   if self.com.i0_
-0005e630: 6c6f 6164 6564 3a0d 0a20 2020 2020 2020  loaded:..       
-0005e640: 2020 2020 2020 2020 2073 656c 662e 695f           self.i_
-0005e650: 6974 656d 2e73 6574 496d 6167 6528 7365  item.setImage(se
-0005e660: 6c66 2e73 7461 636b 2e6f 6433 645b 3a2c  lf.stack.od3d[:,
-0005e670: 203a 2c20 696e 7428 7365 6c66 2e69 6576   :, int(self.iev
-0005e680: 295d 290d 0a20 2020 2020 2020 2020 2020  )])..           
-0005e690: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0005e6a0: 2020 2020 2020 2020 7365 6c66 2e69 5f69          self.i_i
-0005e6b0: 7465 6d2e 7365 7449 6d61 6765 2873 656c  tem.setImage(sel
-0005e6c0: 662e 7374 6163 6b2e 6162 7364 6174 615b  f.stack.absdata[
-0005e6d0: 3a2c 203a 2c20 696e 7428 7365 6c66 2e69  :, :, int(self.i
-0005e6e0: 6576 295d 290d 0a20 2020 2020 2020 2020  ev)])..         
-0005e6f0: 2020 2073 656c 662e 6772 6f75 7042 6f78     self.groupBox
-0005e700: 2e73 6574 5469 746c 6528 7374 7228 2753  .setTitle(str('S
-0005e710: 7461 636b 2042 726f 7773 6572 207c 2049  tack Browser | I
-0005e720: 6d61 6765 2061 7420 7b30 3a35 2e32 667d  mage at {0:5.2f}
-0005e730: 2065 5627 292e 666f 726d 6174 2866 6c6f   eV').format(flo
-0005e740: 6174 2873 656c 662e 7374 6163 6b2e 6576  at(self.stack.ev
-0005e750: 5b73 656c 662e 6965 765d 2929 290d 0a0d  [self.iev])))...
-0005e760: 0a20 2020 2023 2320 5365 7475 7020 6120  .    ## Setup a 
-0005e770: 524f 4920 666f 7220 616e 2061 6c69 676e  ROI for an align
-0005e780: 6d65 6e74 2072 6563 7461 6e67 6c65 2e20  ment rectangle. 
-0005e790: 4279 2064 6566 6175 6c74 2074 6865 2077  By default the w
-0005e7a0: 686f 6c65 2069 6d61 6765 2061 7265 6120  hole image area 
-0005e7b0: 6973 2075 7365 642e 0d0a 2020 2020 6465  is used...    de
-0005e7c0: 6620 5365 7475 7052 4f49 2873 656c 6629  f SetupROI(self)
-0005e7d0: 3a0d 0a20 2020 2020 2020 2023 7365 6c66  :..        #self
-0005e7e0: 2e73 7461 636b 2e61 6273 6461 7461 203d  .stack.absdata =
-0005e7f0: 2073 656c 662e 7374 6163 6b2e 6162 7364   self.stack.absd
-0005e800: 6174 612e 636f 7079 2829 0d0a 2020 2020  ata.copy()..    
-0005e810: 2020 2020 7365 6c66 2e62 6f78 203d 2070      self.box = p
-0005e820: 672e 5265 6374 524f 4928 7365 6c66 2e69  g.RectROI(self.i
-0005e830: 5f69 7465 6d2e 626f 756e 6469 6e67 5265  _item.boundingRe
-0005e840: 6374 2829 2e74 6f70 4c65 6674 2829 2c20  ct().topLeft(), 
-0005e850: 7365 6c66 2e69 5f69 7465 6d2e 626f 756e  self.i_item.boun
-0005e860: 6469 6e67 5265 6374 2829 2e62 6f74 746f  dingRect().botto
-0005e870: 6d52 6967 6874 2829 2c0d 0a20 2020 2020  mRight(),..     
-0005e880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e890: 2020 2020 2020 2020 2070 656e 3d28 352c           pen=(5,
-0005e8a0: 2038 292c 2068 616e 646c 6550 656e 3d51   8), handlePen=Q
-0005e8b0: 7447 7569 2e51 5065 6e28 5174 4775 692e  tGui.QPen(QtGui.
-0005e8c0: 5143 6f6c 6f72 2832 3535 2c20 302c 2031  QColor(255, 0, 1
-0005e8d0: 3238 2c20 3235 3529 292c 2063 656e 7465  28, 255)), cente
-0005e8e0: 7265 643d 4661 6c73 652c 0d0a 2020 2020  red=False,..    
-0005e8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e900: 2020 2020 2020 2020 2020 7369 6465 5363            sideSc
-0005e910: 616c 6572 733d 4661 6c73 652c 2072 656d  alers=False, rem
-0005e920: 6f76 6162 6c65 3d46 616c 7365 2c20 7363  ovable=False, sc
-0005e930: 616c 6553 6e61 703d 5472 7565 2c20 7472  aleSnap=True, tr
-0005e940: 616e 736c 6174 6553 6e61 703d 5472 7565  anslateSnap=True
-0005e950: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0005e960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e970: 206d 6178 426f 756e 6473 3d73 656c 662e   maxBounds=self.
-0005e980: 695f 6974 656d 2e62 6f75 6e64 696e 6752  i_item.boundingR
-0005e990: 6563 7428 2929 0d0a 2020 2020 2020 2020  ect())..        
-0005e9a0: 7365 6c66 2e76 622e 6164 6449 7465 6d28  self.vb.addItem(
-0005e9b0: 7365 6c66 2e62 6f78 2c20 6967 6e6f 7265  self.box, ignore
-0005e9c0: 426f 756e 6473 3d46 616c 7365 290d 0a20  Bounds=False).. 
-0005e9d0: 2020 2020 2020 2073 656c 662e 626f 782e         self.box.
-0005e9e0: 7369 6752 6567 696f 6e43 6861 6e67 6546  sigRegionChangeF
-0005e9f0: 696e 6973 6865 642e 636f 6e6e 6563 7428  inished.connect(
-0005ea00: 7365 6c66 2e52 6564 7261 7750 6c6f 7473  self.RedrawPlots
-0005ea10: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0005ea20: 626f 782e 7369 6752 6567 696f 6e43 6861  box.sigRegionCha
-0005ea30: 6e67 6553 7461 7274 6564 2e63 6f6e 6e65  ngeStarted.conne
-0005ea40: 6374 2873 656c 662e 4f6e 426f 7843 6861  ct(self.OnBoxCha
-0005ea50: 6e67 696e 6729 0d0a 2020 2020 2020 2020  nging)..        
-0005ea60: 7365 6c66 2e62 7574 746f 6e5f 7273 7472  self.button_rstr
-0005ea70: 6f69 2e63 6c69 636b 6564 2e63 6f6e 6e65  oi.clicked.conne
-0005ea80: 6374 2873 656c 662e 4f6e 5265 7365 7452  ct(self.OnResetR
-0005ea90: 4f49 290d 0a20 2020 2023 2320 5468 6520  OI)..    ## The 
-0005eaa0: 524f 4920 6973 206c 696d 6974 6564 2074  ROI is limited t
-0005eab0: 6f20 7468 6520 7669 7369 626c 6520 696d  o the visible im
-0005eac0: 6167 6520 6172 6561 2e20 4f6e 4d6f 7573  age area. OnMous
-0005ead0: 654d 6f76 654f 7574 7369 6465 2068 616e  eMoveOutside han
-0005eae0: 646c 6573 2074 6865 2062 6568 6176 696f  dles the behavio
-0005eaf0: 7220 7768 656e 0d0a 2020 2020 6465 6620  r when..    def 
-0005eb00: 4f6e 5265 7365 7452 4f49 2873 656c 6629  OnResetROI(self)
-0005eb10: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-0005eb20: 626f 782e 7365 7450 6f73 2830 2c20 302c  box.setPos(0, 0,
-0005eb30: 2075 7064 6174 653d 4661 6c73 652c 2066   update=False, f
-0005eb40: 696e 6973 683d 4661 6c73 6529 0d0a 2020  inish=False)..  
-0005eb50: 2020 2020 2020 7365 6c66 2e62 6f78 2e73        self.box.s
-0005eb60: 6574 5369 7a65 2873 656c 662e 695f 6974  etSize(self.i_it
-0005eb70: 656d 2e62 6f75 6e64 696e 6752 6563 7428  em.boundingRect(
-0005eb80: 292e 626f 7474 6f6d 5269 6768 7428 2920  ).bottomRight() 
-0005eb90: 2d20 7365 6c66 2e62 6f78 2e70 6f73 2829  - self.box.pos()
-0005eba0: 2c20 7570 6461 7465 3d54 7275 652c 2073  , update=True, s
-0005ebb0: 6e61 703d 5472 7565 2c20 6669 6e69 7368  nap=True, finish
-0005ebc0: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-0005ebd0: 7365 6c66 2e62 6f78 2e73 686f 7728 290d  self.box.show().
-0005ebe0: 0a20 2020 2064 6566 204f 6e42 6f78 4368  .    def OnBoxCh
-0005ebf0: 616e 6769 6e67 2873 656c 6629 3a0d 0a20  anging(self):.. 
-0005ec00: 2020 2020 2020 2073 656c 662e 626f 7873         self.boxs
-0005ec10: 697a 6520 3d20 7365 6c66 2e62 6f78 2e73  ize = self.box.s
-0005ec20: 697a 6528 290d 0a20 2020 2020 2020 2073  ize()..        s
-0005ec30: 656c 662e 7072 6f78 7920 3d20 7067 2e53  elf.proxy = pg.S
-0005ec40: 6967 6e61 6c50 726f 7879 2873 656c 662e  ignalProxy(self.
-0005ec50: 7662 2e73 6365 6e65 2829 2e73 6967 4d6f  vb.scene().sigMo
-0005ec60: 7573 654d 6f76 6564 2c20 7261 7465 4c69  useMoved, rateLi
-0005ec70: 6d69 743d 3330 2c20 736c 6f74 3d73 656c  mit=30, slot=sel
-0005ec80: 662e 4f6e 4d6f 7573 654d 6f76 654f 7574  f.OnMouseMoveOut
-0005ec90: 7369 6465 290d 0a20 2020 2064 6566 2047  side)..    def G
-0005eca0: 6574 5265 6769 6f6e 2873 656c 6629 3a0d  etRegion(self):.
-0005ecb0: 0a20 2020 2020 2020 2074 7279 3a0d 0a20  .        try:.. 
-0005ecc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0005ecd0: 7072 6f78 792e 6469 7363 6f6e 6e65 6374  proxy.disconnect
-0005ece0: 2829 0d0a 2020 2020 2020 2020 6578 6365  ()..        exce
-0005ecf0: 7074 2041 7474 7269 6275 7465 4572 726f  pt AttributeErro
-0005ed00: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-0005ed10: 7061 7373 0d0a 2020 2020 2020 2020 6c65  pass..        le
-0005ed20: 6674 203d 2069 6e74 2873 656c 662e 626f  ft = int(self.bo
-0005ed30: 782e 706f 7328 292e 7828 2929 0d0a 2020  x.pos().x())..  
-0005ed40: 2020 2020 2020 7269 6768 7420 3d20 6c65        right = le
-0005ed50: 6674 202b 2069 6e74 2873 656c 662e 626f  ft + int(self.bo
-0005ed60: 782e 7369 7a65 2829 2e78 2829 290d 0a20  x.size().x()).. 
-0005ed70: 2020 2020 2020 2062 6f74 746f 6d20 3d20         bottom = 
-0005ed80: 696e 7428 7365 6c66 2e62 6f78 2e70 6f73  int(self.box.pos
-0005ed90: 2829 2e79 2829 290d 0a20 2020 2020 2020  ().y())..       
-0005eda0: 2074 6f70 203d 2062 6f74 746f 6d20 2b20   top = bottom + 
-0005edb0: 696e 7428 7365 6c66 2e62 6f78 2e73 697a  int(self.box.siz
-0005edc0: 6528 292e 7928 2929 0d0a 2020 2020 2020  e().y())..      
-0005edd0: 2020 7265 7475 726e 2028 6c65 6674 2c72    return (left,r
-0005ede0: 6967 6874 2c74 6f70 2c62 6f74 746f 6d29  ight,top,bottom)
-0005edf0: 0d0a 0d0a 2020 2020 6465 6620 4765 6e65  ....    def Gene
-0005ee00: 7261 7465 5370 6563 7472 756d 2873 656c  rateSpectrum(sel
-0005ee10: 662c 2065 7673 656c 6563 7469 6f6e 293a  f, evselection):
-0005ee20: 0d0a 2020 2020 2020 2020 6c65 6674 2c72  ..        left,r
-0005ee30: 6967 6874 2c74 6f70 2c62 6f74 746f 6d20  ight,top,bottom 
-0005ee40: 3d20 7365 6c66 2e47 6574 5265 6769 6f6e  = self.GetRegion
-0005ee50: 2829 0d0a 2020 2020 2020 2020 6966 2073  ()..        if s
-0005ee60: 656c 662e 636f 6d2e 6930 5f6c 6f61 6465  elf.com.i0_loade
-0005ee70: 6420 3d3d 2031 3a0d 0a20 2020 2020 2020  d == 1:..       
-0005ee80: 2020 2020 2069 6620 7365 6c66 2e63 6f6d       if self.com
-0005ee90: 2e73 7461 636b 5f34 6420 3d3d 2031 3a0d  .stack_4d == 1:.
-0005eea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005eeb0: 2074 6f74 616c 203d 2073 656c 662e 7374   total = self.st
-0005eec0: 6163 6b2e 6f64 3464 5b6c 6566 743a 7269  ack.od4d[left:ri
-0005eed0: 6768 742c 2062 6f74 746f 6d3a 746f 702c  ght, bottom:top,
-0005eee0: 203a 2c20 696e 7428 7365 6c66 2e69 7468   :, int(self.ith
-0005eef0: 6574 6129 5d2e 636f 7079 2829 0d0a 2020  eta)].copy()..  
-0005ef00: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0005ef10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005ef20: 2074 6f74 616c 203d 2073 656c 662e 7374   total = self.st
-0005ef30: 6163 6b2e 6f64 3364 5b6c 6566 743a 7269  ack.od3d[left:ri
-0005ef40: 6768 742c 2062 6f74 746f 6d3a 746f 702c  ght, bottom:top,
-0005ef50: 203a 5d2e 636f 7079 2829 0d0a 0d0a 2020   :].copy()....  
-0005ef60: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0005ef70: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0005ef80: 2e63 6f6d 2e73 7461 636b 5f34 6420 3d3d  .com.stack_4d ==
-0005ef90: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
-0005efa0: 2020 2020 2074 203d 205b 7365 6c66 2e73       t = [self.s
-0005efb0: 7461 636b 2e74 6865 7461 5b69 5d20 666f  tack.theta[i] fo
-0005efc0: 7220 6920 696e 2073 656c 662e 7468 6574  r i in self.thet
-0005efd0: 6169 6478 5f73 656c 6563 7465 645d 0d0a  aidx_selected]..
-0005efe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005eff0: 7365 6c66 2e6c 6162 656c 5f74 6865 7461  self.label_theta
-0005f000: 5f72 616e 6765 2e73 6574 5465 7874 280d  _range.setText(.
-0005f010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005f020: 2020 2020 2022 5468 6574 6120 7261 6e67       "Theta rang
-0005f030: 653a 205b 2022 202b 2073 7472 286d 696e  e: [ " + str(min
-0005f040: 2874 2c20 6465 6661 756c 743d 3029 2920  (t, default=0)) 
-0005f050: 2b20 22c2 b020 2e2e 2022 202b 2073 7472  + ".. .. " + str
-0005f060: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0005f070: 2020 2020 2020 2020 2020 206d 6178 2874             max(t
-0005f080: 2c20 6465 6661 756c 743d 3029 2920 2b20  , default=0)) + 
-0005f090: 22c2 b020 5d2c 2023 2076 616c 7565 733a  ".. ], # values:
-0005f0a0: 2022 202b 2073 7472 280d 0a20 2020 2020   " + str(..     
-0005f0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f0c0: 2020 206c 656e 2874 2929 290d 0a20 2020     len(t)))..   
-0005f0d0: 2020 2020 2020 2020 2020 2020 2074 6f74               tot
-0005f0e0: 616c 203d 2073 656c 662e 7374 6163 6b2e  al = self.stack.
-0005f0f0: 7374 6163 6b34 445b 6c65 6674 3a72 6967  stack4D[left:rig
-0005f100: 6874 2c20 626f 7474 6f6d 3a74 6f70 2c20  ht, bottom:top, 
-0005f110: 3a2c 2069 6e74 2873 656c 662e 6974 6865  :, int(self.ithe
-0005f120: 7461 295d 2e63 6f70 7928 290d 0a20 2020  ta)].copy()..   
-0005f130: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-0005f140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f150: 746f 7461 6c20 3d20 7365 6c66 2e73 7461  total = self.sta
-0005f160: 636b 2e61 6273 6461 7461 5b6c 6566 743a  ck.absdata[left:
-0005f170: 7269 6768 742c 2062 6f74 746f 6d3a 746f  right, bottom:to
-0005f180: 702c 203a 5d2e 636f 7079 2829 0d0a 2020  p, :].copy()..  
-0005f190: 2020 2020 2020 746f 7461 6c20 3d20 746f        total = to
-0005f1a0: 7461 6c2e 7375 6d28 6178 6973 3d28 302c  tal.sum(axis=(0,
-0005f1b0: 3129 2920 2f20 2869 6e74 2873 656c 662e  1)) / (int(self.
-0005f1c0: 626f 782e 7369 7a65 2829 2e78 2829 2920  box.size().x()) 
-0005f1d0: 2a20 696e 7428 7365 6c66 2e62 6f78 2e73  * int(self.box.s
-0005f1e0: 697a 6528 292e 7928 2929 290d 0a20 2020  ize().y()))..   
-0005f1f0: 2020 2020 2078 203d 205b 7365 6c66 2e73       x = [self.s
-0005f200: 7461 636b 2e65 765b 695d 2066 6f72 2069  tack.ev[i] for i
-0005f210: 2069 6e20 6576 7365 6c65 6374 696f 6e5d   in evselection]
-0005f220: 0d0a 2020 2020 2020 2020 7920 3d20 5b74  ..        y = [t
-0005f230: 6f74 616c 5b69 5d20 666f 7220 6920 696e  otal[i] for i in
-0005f240: 2065 7673 656c 6563 7469 6f6e 5d0d 0a20   evselection].. 
-0005f250: 2020 2020 2020 2073 656c 662e 6c61 6265         self.labe
-0005f260: 6c5f 7370 6174 6961 6c5f 7261 6e67 652e  l_spatial_range.
-0005f270: 7365 7454 6578 7428 2253 7461 636b 2073  setText("Stack s
-0005f280: 697a 653a 205b 2022 2b73 7472 2869 6e74  ize: [ "+str(int
-0005f290: 2873 656c 662e 626f 782e 7369 7a65 2829  (self.box.size()
-0005f2a0: 2e78 2829 2929 2b22 2078 2022 2b73 7472  .x()))+" x "+str
-0005f2b0: 2869 6e74 2873 656c 662e 626f 782e 7369  (int(self.box.si
-0005f2c0: 7a65 2829 2e79 2829 2929 2b22 205d 2070  ze().y()))+" ] p
-0005f2d0: 78c2 b222 290d 0a20 2020 2020 2020 2073  x..")..        s
-0005f2e0: 656c 662e 6c61 6265 6c5f 6576 5f72 616e  elf.label_ev_ran
-0005f2f0: 6765 2e73 6574 5465 7874 280d 0a20 2020  ge.setText(..   
-0005f300: 2020 2020 2020 2020 2022 456e 6572 6779           "Energy
-0005f310: 2072 616e 6765 3a20 5b20 2220 2b20 7374   range: [ " + st
-0005f320: 7228 6d69 6e28 782c 2064 6566 6175 6c74  r(min(x, default
-0005f330: 3d30 2929 202b 2022 202e 2e20 2220 2b20  =0)) + " .. " + 
-0005f340: 7374 7228 6d61 7828 782c 2064 6566 6175  str(max(x, defau
-0005f350: 6c74 3d30 2929 202b 2022 205d 2065 562c  lt=0)) + " ] eV,
-0005f360: 2023 2076 616c 7565 733a 2022 2b20 7374   # values: "+ st
-0005f370: 7228 6c65 6e28 7829 2929 0d0a 2020 2020  r(len(x)))..    
-0005f380: 2020 2020 7265 7475 726e 2028 782c 2079      return (x, y
-0005f390: 290d 0a0d 0a20 2020 2064 6566 2052 6573  )....    def Res
-0005f3a0: 6574 416c 6c49 7465 6d73 2873 656c 662c  etAllItems(self,
-0005f3b0: 7769 6467 6574 293a 0d0a 2020 2020 2020  widget):..      
-0005f3c0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-0005f3d0: 2877 6964 6765 742e 636f 756e 7428 2929  (widget.count())
-0005f3e0: 3a0d 0a20 2020 2020 2020 2020 2020 2077  :..            w
-0005f3f0: 6964 6765 742e 6974 656d 2869 292e 7365  idget.item(i).se
-0005f400: 7446 6f72 6567 726f 756e 6428 5174 4775  tForeground(QtGu
-0005f410: 692e 5143 6f6c 6f72 2830 2c20 302c 2030  i.QColor(0, 0, 0
-0005f420: 2c20 3132 3829 290d 0a0d 0a20 2020 2064  , 128))....    d
-0005f430: 6566 204f 6e4d 6f75 7365 4d6f 7665 4f75  ef OnMouseMoveOu
-0005f440: 7473 6964 6528 7365 6c66 2c20 6576 293a  tside(self, ev):
-0005f450: 0d0a 2020 2020 2020 2020 6d6f 7573 6570  ..        mousep
-0005f460: 6f73 203d 2073 656c 662e 7662 2e6d 6170  os = self.vb.map
-0005f470: 5363 656e 6554 6f56 6965 7728 6576 5b30  SceneToView(ev[0
-0005f480: 5d29 0d0a 2020 2020 2020 2020 6966 206e  ])..        if n
-0005f490: 6f74 2073 656c 662e 7662 2e69 7465 6d42  ot self.vb.itemB
-0005f4a0: 6f75 6e64 696e 6752 6563 7428 7365 6c66  oundingRect(self
-0005f4b0: 2e69 5f69 7465 6d29 2e63 6f6e 7461 696e  .i_item).contain
-0005f4c0: 7328 6d6f 7573 6570 6f73 293a 0d0a 2020  s(mousepos):..  
-0005f4d0: 2020 2020 2020 2020 2020 6d61 7872 6563            maxrec
-0005f4e0: 7420 3d20 7365 6c66 2e69 5f69 7465 6d2e  t = self.i_item.
-0005f4f0: 626f 756e 6469 6e67 5265 6374 2829 2e62  boundingRect().b
-0005f500: 6f74 746f 6d52 6967 6874 2829 0d0a 2020  ottomRight()..  
-0005f510: 2020 2020 2020 2020 2020 2320 6966 2062            # if b
-0005f520: 6f75 6e64 7320 6578 6365 6564 6564 0d0a  ounds exceeded..
-0005f530: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
-0005f540: 7820 3d20 6d61 7828 286d 6f75 7365 706f  x = max((mousepo
-0005f550: 732d 6d61 7872 6563 7429 2e78 2829 2c30  s-maxrect).x(),0
-0005f560: 290d 0a20 2020 2020 2020 2020 2020 206f  )..            o
-0005f570: 7574 5f79 203d 206d 6178 2828 6d6f 7573  ut_y = max((mous
-0005f580: 6570 6f73 2d6d 6178 7265 6374 292e 7928  epos-maxrect).y(
-0005f590: 292c 2030 290d 0a20 2020 2020 2020 2020  ), 0)..         
-0005f5a0: 2020 2069 6620 7365 6c66 2e62 6f78 2e73     if self.box.s
-0005f5b0: 697a 6528 2920 213d 2073 656c 662e 626f  ize() != self.bo
-0005f5c0: 7873 697a 653a 2023 2070 7265 7665 6e74  xsize: # prevent
-0005f5d0: 7320 7461 6b69 6e67 2061 6374 696f 6e20  s taking action 
-0005f5e0: 7768 656e 2074 6865 2062 6f78 2069 7320  when the box is 
-0005f5f0: 6a75 7374 2064 7261 6767 6564 2061 6e64  just dragged and
-0005f600: 206e 6f74 2072 6573 697a 6564 0d0a 2020   not resized..  
-0005f610: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0005f620: 206f 7574 5f78 2061 6e64 206f 7574 5f79   out_x and out_y
-0005f630: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0005f640: 2020 2020 2020 2073 656c 662e 626f 782e         self.box.
-0005f650: 7365 7453 697a 6528 7365 6c66 2e69 5f69  setSize(self.i_i
-0005f660: 7465 6d2e 626f 756e 6469 6e67 5265 6374  tem.boundingRect
-0005f670: 2829 2e62 6f74 746f 6d52 6967 6874 2829  ().bottomRight()
-0005f680: 2d73 656c 662e 626f 782e 706f 7328 292c  -self.box.pos(),
-0005f690: 2075 7064 6174 653d 5472 7565 2c20 736e   update=True, sn
-0005f6a0: 6170 3d54 7275 652c 2066 696e 6973 683d  ap=True, finish=
-0005f6b0: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-0005f6c0: 2020 2020 2020 2020 656c 6966 206f 7574          elif out
-0005f6d0: 5f78 3a0d 0a20 2020 2020 2020 2020 2020  _x:..           
-0005f6e0: 2020 2020 2020 2020 2073 656c 662e 626f           self.bo
-0005f6f0: 782e 7365 7453 697a 6528 5b73 656c 662e  x.setSize([self.
-0005f700: 695f 6974 656d 2e62 6f75 6e64 696e 6752  i_item.boundingR
-0005f710: 6563 7428 292e 7269 6768 7428 292d 7365  ect().right()-se
-0005f720: 6c66 2e62 6f78 2e70 6f73 2829 2e78 2829  lf.box.pos().x()
-0005f730: 2c6d 6f75 7365 706f 732e 7928 292d 7365  ,mousepos.y()-se
-0005f740: 6c66 2e62 6f78 2e70 6f73 2829 2e79 2829  lf.box.pos().y()
-0005f750: 5d2c 2075 7064 6174 653d 5472 7565 2c20  ], update=True, 
-0005f760: 736e 6170 3d54 7275 652c 2066 696e 6973  snap=True, finis
-0005f770: 683d 4661 6c73 6529 0d0a 2020 2020 2020  h=False)..      
-0005f780: 2020 2020 2020 2020 2020 656c 6966 206f            elif o
-0005f790: 7574 5f79 3a0d 0a20 2020 2020 2020 2020  ut_y:..         
-0005f7a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0005f7b0: 626f 782e 7365 7453 697a 6528 5b6d 6f75  box.setSize([mou
-0005f7c0: 7365 706f 732e 7828 292d 7365 6c66 2e62  sepos.x()-self.b
-0005f7d0: 6f78 2e70 6f73 2829 2e78 2829 2c73 656c  ox.pos().x(),sel
-0005f7e0: 662e 695f 6974 656d 2e62 6f75 6e64 696e  f.i_item.boundin
-0005f7f0: 6752 6563 7428 292e 626f 7474 6f6d 2829  gRect().bottom()
-0005f800: 2d73 656c 662e 626f 782e 706f 7328 292e  -self.box.pos().
-0005f810: 7928 295d 2c20 7570 6461 7465 3d54 7275  y()], update=Tru
-0005f820: 652c 2073 6e61 703d 5472 7565 2c20 6669  e, snap=True, fi
-0005f830: 6e69 7368 3d46 616c 7365 290d 0a20 2020  nish=False)..   
-0005f840: 2023 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   # -------------
-0005f850: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005f860: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005f870: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005f880: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
-0005f890: 6566 204f 6e43 616e 6365 6c28 7365 6c66  ef OnCancel(self
-0005f8a0: 2c20 6576 7429 3a0d 0a20 2020 2020 2020  , evt):..       
-0005f8b0: 2073 656c 662e 636c 6f73 6528 290d 0a20   self.close().. 
-0005f8c0: 2020 2023 202d 2d2d 2d2d 2d2d 2d2d 2d2d     # -----------
+00059160: 2020 2020 2020 7365 6c66 2e49 3062 6f78        self.I0box
+00059170: 2e61 6464 5365 676d 656e 7428 7365 6c66  .addSegment(self
+00059180: 2e6c 6173 736f 706f 696e 7473 5b30 5d2c  .lassopoints[0],
+00059190: 2073 656c 662e 6c61 7373 6f70 6f69 6e74   self.lassopoint
+000591a0: 735b 315d 290d 0a20 2020 2020 2020 2020  s[1])..         
+000591b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000591c0: 656c 662e 6c61 7373 6f70 6f69 6e74 732e  elf.lassopoints.
+000591d0: 706f 7028 3029 0d0a 2020 2020 2020 2020  pop(0)..        
+000591e0: 2020 2020 2020 2020 2323 2050 6f6c 7967          ## Polyg
+000591f0: 6f6e 2052 4f49 2069 7320 6375 7272 656e  on ROI is curren
+00059200: 746c 7920 6272 6f6b 656e 2069 6e20 7265  tly broken in re
+00059210: 6365 6e74 2070 7971 7467 7261 7068 2076  cent pyqtgraph v
+00059220: 6572 7369 6f6e 0d0a 2020 2020 2020 2020  ersion..        
+00059230: 2020 2020 2020 2020 2320 656c 6966 2073          # elif s
+00059240: 656c 662e 7261 6469 6f50 6f6c 7952 4f49  elf.radioPolyROI
+00059250: 2e69 7343 6865 636b 6564 2829 3a0d 0a20  .isChecked():.. 
+00059260: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00059270: 2020 2020 206f 7269 6769 6e20 3d20 7365       origin = se
+00059280: 6c66 2e76 622e 6d61 7053 6365 6e65 546f  lf.vb.mapSceneTo
+00059290: 5669 6577 2873 656c 662e 7662 2e73 6365  View(self.vb.sce
+000592a0: 6e65 2829 2e63 6c69 636b 4576 656e 7473  ne().clickEvents
+000592b0: 5b30 5d2e 7363 656e 6550 6f73 2829 290d  [0].scenePos()).
+000592c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000592d0: 2023 2020 2020 2069 6620 6f72 6967 696e   #     if origin
+000592e0: 2e78 2829 203c 2030 3a0d 0a20 2020 2020  .x() < 0:..     
+000592f0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00059300: 2020 2020 2078 3020 3d20 302d 726f 6970       x0 = 0-roip
+00059310: 6f73 2e78 2829 0d0a 2020 2020 2020 2020  os.x()..        
+00059320: 2020 2020 2020 2020 2320 2020 2020 656c          #     el
+00059330: 6966 206f 7269 6769 6e2e 7828 2920 3e20  if origin.x() > 
+00059340: 7365 6c66 2e73 7461 636b 2e6e 5f63 6f6c  self.stack.n_col
+00059350: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00059360: 2020 2020 2320 2020 2020 2020 2020 7830      #         x0
+00059370: 203d 2073 656c 662e 7374 6163 6b2e 6e5f   = self.stack.n_
+00059380: 636f 6c73 202d 2072 6f69 706f 732e 7828  cols - roipos.x(
+00059390: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000593a0: 2020 2023 2020 2020 2065 6c73 653a 0d0a     #     else:..
+000593b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000593c0: 2320 2020 2020 2020 2020 7830 203d 206e  #         x0 = n
+000593d0: 702e 726f 756e 6428 6f72 6967 696e 2e78  p.round(origin.x
+000593e0: 2829 2d72 6f69 706f 732e 7828 292c 3029  ()-roipos.x(),0)
+000593f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00059400: 2020 2320 2020 2020 6966 206f 7269 6769    #     if origi
+00059410: 6e2e 7928 2920 3c20 303a 0d0a 2020 2020  n.y() < 0:..    
+00059420: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+00059430: 2020 2020 2020 7930 203d 2030 2d72 6f69        y0 = 0-roi
+00059440: 706f 732e 7928 290d 0a20 2020 2020 2020  pos.y()..       
+00059450: 2020 2020 2020 2020 2023 2020 2020 2065           #     e
+00059460: 6c69 6620 6f72 6967 696e 2e79 2829 203e  lif origin.y() >
+00059470: 2073 656c 662e 7374 6163 6b2e 6e5f 726f   self.stack.n_ro
+00059480: 7773 3a0d 0a20 2020 2020 2020 2020 2020  ws:..           
+00059490: 2020 2020 2023 2020 2020 2020 2020 2079       #         y
+000594a0: 3020 3d20 7365 6c66 2e73 7461 636b 2e6e  0 = self.stack.n
+000594b0: 5f72 6f77 7320 2d20 726f 6970 6f73 2e79  _rows - roipos.y
+000594c0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+000594d0: 2020 2020 2320 2020 2020 656c 7365 3a0d      #     else:.
+000594e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000594f0: 2023 2020 2020 2020 2020 2079 3020 3d20   #         y0 = 
+00059500: 6e70 2e72 6f75 6e64 286f 7269 6769 6e2e  np.round(origin.
+00059510: 7928 292d 726f 6970 6f73 2e79 2829 2c30  y()-roipos.y(),0
+00059520: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00059530: 2020 2023 2020 2020 2073 656c 662e 4930     #     self.I0
+00059540: 626f 782e 7365 7450 6f69 6e74 7328 5b28  box.setPoints([(
+00059550: 6e70 2e72 6f75 6e64 2870 6f73 2e78 2829  np.round(pos.x()
+00059560: 2d72 6f69 706f 732e 7828 292c 3029 2c6e  -roipos.x(),0),n
+00059570: 702e 726f 756e 6428 706f 732e 7928 292d  p.round(pos.y()-
+00059580: 726f 6970 6f73 2e79 2829 2c30 2929 2c20  roipos.y(),0)), 
+00059590: 2878 302c 6e70 2e72 6f75 6e64 2870 6f73  (x0,np.round(pos
+000595a0: 2e79 2829 2d72 6f69 706f 732e 7928 292c  .y()-roipos.y(),
+000595b0: 3029 292c 2878 302c 7930 292c 286e 702e  0)),(x0,y0),(np.
+000595c0: 726f 756e 6428 706f 732e 7828 292d 726f  round(pos.x()-ro
+000595d0: 6970 6f73 2e78 2829 2c30 292c 7930 295d  ipos.x(),0),y0)]
+000595e0: 2c20 636c 6f73 6564 3d54 7275 6529 0d0a  , closed=True)..
+000595f0: 0d0a 2020 2020 6465 6620 6472 6177 5f69  ..    def draw_i
+00059600: 6d61 6765 2873 656c 662c 666c 7578 6d69  mage(self,fluxmi
+00059610: 6e2c 2066 6c75 786d 6178 293a 0d0a 2020  n, fluxmax):..  
+00059620: 2020 2020 2020 7365 6c66 2e49 3069 6e73        self.I0ins
+00059630: 7472 7563 7469 6f6e 732e 7365 7454 6578  tructions.setTex
+00059640: 7428 0d0a 2020 2020 2020 2020 2020 2020  t(..            
+00059650: 2253 656c 6563 7420 4930 2062 7920 6472  "Select I0 by dr
+00059660: 6167 6769 6e67 2074 6865 2068 6973 746f  agging the histo
+00059670: 6772 616d 206c 696e 6573 206f 7220 6279  gram lines or by
+00059680: 2064 7261 7769 6e67 2061 2052 4f49 2e22   drawing a ROI."
+00059690: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000596a0: 6930 5f69 6e64 6963 6573 203d 206e 702e  i0_indices = np.
+000596b0: 7768 6572 6528 2866 6c75 786d 696e 3c3d  where((fluxmin<=
+000596c0: 7365 6c66 2e73 7461 636b 2e68 6973 746f  self.stack.histo
+000596d0: 6772 616d 2926 2873 656c 662e 7374 6163  gram)&(self.stac
+000596e0: 6b2e 6869 7374 6f67 7261 6d3c 3d66 6c75  k.histogram<=flu
+000596f0: 786d 6178 2929 0d0a 2020 2020 2020 2020  xmax))..        
+00059700: 7365 6c66 2e72 6564 7069 785b 3a2c 203a  self.redpix[:, :
+00059710: 5d20 3d20 5b30 2c20 302c 2030 2c20 305d  ] = [0, 0, 0, 0]
+00059720: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+00059730: 6564 7069 785b 7365 6c66 2e69 305f 696e  edpix[self.i0_in
+00059740: 6469 6365 735d 203d 2028 3235 352c 302c  dices] = (255,0,
+00059750: 302c 3235 3529 0d0a 2020 2020 2020 2020  0,255)..        
+00059760: 7365 6c66 2e41 6273 496d 6167 652e 7365  self.AbsImage.se
+00059770: 7449 6d61 6765 2873 656c 662e 7374 6163  tImage(self.stac
+00059780: 6b2e 6869 7374 6f67 7261 6d29 0d0a 2020  k.histogram)..  
+00059790: 2020 2020 2020 7365 6c66 2e4d 6173 6b49        self.MaskI
+000597a0: 6d61 6765 2e73 6574 496d 6167 6528 7365  mage.setImage(se
+000597b0: 6c66 2e72 6564 7069 782c 206f 7061 6369  lf.redpix, opaci
+000597c0: 7479 203d 2030 2e33 290d 0a0d 0a23 2d2d  ty = 0.3)....#--
+000597d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000597e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000597f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00059800: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00059810: 2d2d 2d2d 0d0a 2020 2020 6465 6620 4f6e  ----..    def On
+00059820: 4163 6365 7074 2873 656c 662c 2065 7674  Accept(self, evt
+00059830: 293a 0d0a 2020 2020 2020 2020 6966 2073  ):..        if s
+00059840: 656c 662e 4d61 736b 496d 6167 652e 7a56  elf.MaskImage.zV
+00059850: 616c 7565 2829 203e 2030 2061 6e64 206e  alue() > 0 and n
+00059860: 702e 616e 7928 7365 6c66 2e69 305f 696e  p.any(self.i0_in
+00059870: 6469 6365 735b 305d 293a 0d0a 2020 2020  dices[0]):..    
+00059880: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
+00059890: 636b 2e69 305f 6672 6f6d 5f68 6973 746f  ck.i0_from_histo
+000598a0: 6772 616d 2873 656c 662e 6930 5f69 6e64  gram(self.i0_ind
+000598b0: 6963 6573 290d 0a20 2020 2020 2020 2020  ices)..         
+000598c0: 2020 2073 656c 662e 7061 7265 6e74 2e49     self.parent.I
+000598d0: 3068 6973 746f 6772 616d 4361 6c63 756c  0histogramCalcul
+000598e0: 6174 6564 2829 0d0a 2020 2020 2020 2020  ated()..        
+000598f0: 2020 2020 7365 6c66 2e73 7461 636b 2e69      self.stack.i
+00059900: 305f 6d61 736b 203d 2073 656c 662e 7265  0_mask = self.re
+00059910: 6470 6978 0d0a 2020 2020 2020 2020 2020  dpix..          
+00059920: 2020 7365 6c66 2e73 7461 636b 2e69 305f    self.stack.i0_
+00059930: 6d61 736b 5b3a 2c20 3a5d 203d 2046 616c  mask[:, :] = Fal
+00059940: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+00059950: 7365 6c66 2e73 7461 636b 2e69 305f 6d61  self.stack.i0_ma
+00059960: 736b 5b73 656c 662e 6930 5f69 6e64 6963  sk[self.i0_indic
+00059970: 6573 5d20 3d20 5472 7565 0d0a 2020 2020  es] = True..    
+00059980: 2020 2020 2020 2020 7365 6c66 2e63 6c6f          self.clo
+00059990: 7365 2829 0d0a 2020 2020 2020 2020 656c  se()..        el
+000599a0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+000599b0: 2073 656c 662e 6930 5f69 6e64 6963 6573   self.i0_indices
+000599c0: 203d 205b 5d0d 0a20 2020 2020 2020 2020   = []..         
+000599d0: 2020 2051 7457 6964 6765 7473 2e51 4d65     QtWidgets.QMe
+000599e0: 7373 6167 6542 6f78 2e77 6172 6e69 6e67  ssageBox.warning
+000599f0: 2873 656c 662c 2027 4572 726f 7227 2c20  (self, 'Error', 
+00059a00: 2749 3020 7265 6769 6f6e 2069 7320 656d  'I0 region is em
+00059a10: 7074 7921 2729 0d0a 0d0a 232d 2d2d 2d2d  pty!')....#-----
+00059a20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00059a30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00059a40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00059a50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00059a60: 2d0d 0a63 6c61 7373 2053 686f 7741 7274  -..class ShowArt
+00059a70: 6566 6163 7473 2851 7457 6964 6765 7473  efacts(QtWidgets
+00059a80: 2e51 4469 616c 6f67 293a 0d0a 2020 2020  .QDialog):..    
+00059a90: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00059aa0: 662c 2070 6172 656e 742c 2063 6f6d 6d6f  f, parent, commo
+00059ab0: 6e2c 2073 7461 636b 293a 0d0a 2020 2020  n, stack):..    
+00059ac0: 2020 2020 5174 5769 6467 6574 732e 5157      QtWidgets.QW
+00059ad0: 6964 6765 742e 5f5f 696e 6974 5f5f 2873  idget.__init__(s
+00059ae0: 656c 662c 2070 6172 656e 7429 0d0a 2020  elf, parent)..  
+00059af0: 2020 2020 2020 7569 632e 6c6f 6164 5569        uic.loadUi
+00059b00: 286f 732e 7061 7468 2e6a 6f69 6e28 6f73  (os.path.join(os
+00059b10: 2e70 6174 682e 6469 726e 616d 6528 6f73  .path.dirname(os
+00059b20: 2e70 6174 682e 6162 7370 6174 6828 5f5f  .path.abspath(__
+00059b30: 6669 6c65 5f5f 2929 2c20 2773 686f 7761  file__)), 'showa
+00059b40: 7274 6566 6163 7473 2e75 6927 292c 2073  rtefacts.ui'), s
+00059b50: 656c 6629 0d0a 2020 2020 2020 2020 7365  elf)..        se
+00059b60: 6c66 2e70 6172 656e 7420 3d20 7061 7265  lf.parent = pare
+00059b70: 6e74 0d0a 2020 2020 2020 2020 7365 6c66  nt..        self
+00059b80: 2e63 6f6d 203d 2063 6f6d 6d6f 6e0d 0a20  .com = common.. 
+00059b90: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
+00059ba0: 6b20 3d20 7374 6163 6b0d 0a20 2020 2020  k = stack..     
+00059bb0: 2020 2073 656c 662e 6930 5f68 5f77 6172     self.i0_h_war
+00059bc0: 6e66 6c61 6720 3d20 4661 6c73 650d 0a20  nflag = False.. 
+00059bd0: 2020 2020 2020 2073 656c 662e 6930 5f76         self.i0_v
+00059be0: 5f77 6172 6e66 6c61 6720 3d20 4661 6c73  _warnflag = Fals
+00059bf0: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+00059c00: 7067 6c61 796f 7574 203d 2070 672e 4772  pglayout = pg.Gr
+00059c10: 6170 6869 6373 4c61 796f 7574 2862 6f72  aphicsLayout(bor
+00059c20: 6465 723d 4e6f 6e65 290d 0a20 2020 2020  der=None)..     
+00059c30: 2020 2073 656c 662e 6361 6e76 6173 2e73     self.canvas.s
+00059c40: 6574 4261 636b 6772 6f75 6e64 2822 7722  etBackground("w"
+00059c50: 2920 2320 6361 6e76 6173 2069 7320 6120  ) # canvas is a 
+00059c60: 7067 2e47 7261 7068 6963 7356 6965 7720  pg.GraphicsView 
+00059c70: 7769 6467 6574 0d0a 2020 2020 2020 2020  widget..        
+00059c80: 7365 6c66 2e63 616e 7661 732e 7365 7443  self.canvas.setC
+00059c90: 656e 7472 616c 5769 6467 6574 2873 656c  entralWidget(sel
+00059ca0: 662e 7067 6c61 796f 7574 290d 0a0d 0a20  f.pglayout).... 
+00059cb0: 2020 2020 2020 2073 656c 662e 7662 203d         self.vb =
+00059cc0: 2073 656c 662e 7067 6c61 796f 7574 2e61   self.pglayout.a
+00059cd0: 6464 5669 6577 426f 7828 290d 0a20 2020  ddViewBox()..   
+00059ce0: 2020 2020 2073 656c 662e 7662 2e73 6574       self.vb.set
+00059cf0: 4173 7065 6374 4c6f 636b 6564 2829 0d0a  AspectLocked()..
+00059d00: 2020 2020 2020 2020 7365 6c66 2e69 5f69          self.i_i
+00059d10: 7465 6d20 3d20 7067 2e49 6d61 6765 4974  tem = pg.ImageIt
+00059d20: 656d 2862 6f72 6465 723d 226b 222c 7061  em(border="k",pa
+00059d30: 7265 6e74 3d20 7365 6c66 290d 0a0d 0a0d  rent= self).....
+00059d40: 0a20 2020 2020 2020 2073 656c 662e 6275  .        self.bu
+00059d50: 7474 6f6e 5f6f 6b2e 636c 6963 6b65 642e  tton_ok.clicked.
+00059d60: 636f 6e6e 6563 7428 7365 6c66 2e4f 6e41  connect(self.OnA
+00059d70: 6363 6570 7429 0d0a 2020 2020 2020 2020  ccept)..        
+00059d80: 7365 6c66 2e62 7574 746f 6e5f 6361 6e63  self.button_canc
+00059d90: 656c 2e63 6c69 636b 6564 2e63 6f6e 6e65  el.clicked.conne
+00059da0: 6374 2873 656c 662e 636c 6f73 6529 0d0a  ct(self.close)..
+00059db0: 2020 2020 2020 2020 7365 6c66 2e63 625f          self.cb_
+00059dc0: 682e 7374 6174 6543 6861 6e67 6564 2e63  h.stateChanged.c
+00059dd0: 6f6e 6e65 6374 2873 656c 662e 5368 6f77  onnect(self.Show
+00059de0: 496d 6167 6529 0d0a 2020 2020 2020 2020  Image)..        
+00059df0: 7365 6c66 2e63 625f 762e 7374 6174 6543  self.cb_v.stateC
+00059e00: 6861 6e67 6564 2e63 6f6e 6e65 6374 2873  hanged.connect(s
+00059e10: 656c 662e 5368 6f77 496d 6167 6529 0d0a  elf.ShowImage)..
+00059e20: 2020 2020 2020 2020 2354 6f44 6f3a 2049          #ToDo: I
+00059e30: 2069 6e69 7469 616c 6c79 2077 616e 7465   initially wante
+00059e40: 6420 746f 2075 7365 2051 742e 5175 6575  d to use Qt.Queu
+00059e50: 6564 436f 6e6e 6563 7469 6f6e 2074 6f20  edConnection to 
+00059e60: 6372 6561 7465 2061 206e 6f6e 2d62 6c6f  create a non-blo
+00059e70: 636b 696e 6720 536c 6964 6572 2e0d 0a20  cking Slider... 
+00059e80: 2020 2020 2020 2073 656c 662e 7765 6967         self.weig
+00059e90: 6874 5f73 6c69 6465 722e 7661 6c75 6543  ht_slider.valueC
+00059ea0: 6861 6e67 6564 2e63 6f6e 6e65 6374 2873  hanged.connect(s
+00059eb0: 656c 662e 5368 6f77 4361 6c63 496d 6167  elf.ShowCalcImag
+00059ec0: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
+00059ed0: 2e73 6c69 6465 725f 656e 672e 736c 6964  .slider_eng.slid
+00059ee0: 6572 5072 6573 7365 642e 636f 6e6e 6563  erPressed.connec
+00059ef0: 7428 7365 6c66 2e53 686f 7749 6d61 6765  t(self.ShowImage
+00059f00: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00059f10: 736c 6964 6572 5f65 6e67 2e73 6c69 6465  slider_eng.slide
+00059f20: 7252 656c 6561 7365 642e 636f 6e6e 6563  rReleased.connec
+00059f30: 7428 7365 6c66 2e53 686f 7749 6d61 6765  t(self.ShowImage
+00059f40: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00059f50: 736c 6964 6572 5f65 6e67 2e76 616c 7565  slider_eng.value
+00059f60: 4368 616e 6765 645b 696e 745d 2e63 6f6e  Changed[int].con
+00059f70: 6e65 6374 2873 656c 662e 4f6e 5363 726f  nect(self.OnScro
+00059f80: 6c6c 456e 6729 0d0a 0d0a 2020 2020 2020  llEng)....      
+00059f90: 2020 7365 6c66 2e73 6574 5769 6e64 6f77    self.setWindow
+00059fa0: 5469 746c 6528 2741 7274 6566 6163 7473  Title('Artefacts
+00059fb0: 2026 204c 6576 656c 696e 6727 290d 0a20   & Leveling').. 
+00059fc0: 2020 2020 2020 2073 656c 662e 736c 6964         self.slid
+00059fd0: 6572 5f65 6e67 2e73 6574 5261 6e67 6528  er_eng.setRange(
+00059fe0: 302c 2073 656c 662e 7374 6163 6b2e 6e5f  0, self.stack.n_
+00059ff0: 6576 202d 2031 290d 0a0d 0a20 2020 2020  ev - 1)....     
+0005a000: 2020 2073 656c 662e 7662 2e73 6574 4d6f     self.vb.setMo
+0005a010: 7573 6545 6e61 626c 6564 2878 3d46 616c  useEnabled(x=Fal
+0005a020: 7365 2c20 793d 4661 6c73 6529 0d0a 2020  se, y=False)..  
+0005a030: 2020 2020 2020 7365 6c66 2e76 622e 6164        self.vb.ad
+0005a040: 6449 7465 6d28 7365 6c66 2e69 5f69 7465  dItem(self.i_ite
+0005a050: 6d2c 2069 676e 6f72 6542 6f75 6e64 733d  m, ignoreBounds=
+0005a060: 4661 6c73 6529 0d0a 0d0a 2020 2020 2020  False)....      
+0005a070: 2020 7365 6c66 2e73 7461 636b 2e61 6273    self.stack.abs
+0005a080: 6461 7461 5f6c 6576 656c 203d 2073 656c  data_level = sel
+0005a090: 662e 7374 6163 6b2e 6162 7364 6174 612e  f.stack.absdata.
+0005a0a0: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
+0005a0b0: 6966 2073 656c 662e 636f 6d2e 6930 5f6c  if self.com.i0_l
+0005a0c0: 6f61 6465 643a 0d0a 2020 2020 2020 2020  oaded:..        
+0005a0d0: 2020 2020 7365 6c66 2e72 625f 6d65 6469      self.rb_medi
+0005a0e0: 616e 5f69 302e 7365 7443 6865 636b 6162  an_i0.setCheckab
+0005a0f0: 6c65 2854 7275 6529 0d0a 2020 2020 2020  le(True)..      
+0005a100: 2020 2020 2020 7365 6c66 2e72 625f 6d65        self.rb_me
+0005a110: 6469 616e 5f69 302e 7365 7443 6865 636b  dian_i0.setCheck
+0005a120: 6564 2854 7275 6529 0d0a 2020 2020 2020  ed(True)..      
+0005a130: 2020 2020 2020 7365 6c66 2e6c 6162 656c        self.label
+0005a140: 5f34 2e73 6574 5465 7874 2827 4930 206d  _4.setText('I0 m
+0005a150: 6173 6b20 636f 6e74 7269 6275 7469 6f6e  ask contribution
+0005a160: 3a27 290d 0a20 2020 2020 2020 2065 6c73  :')..        els
+0005a170: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0005a180: 7365 6c66 2e73 6c69 6465 7257 6964 6765  self.sliderWidge
+0005a190: 742e 6869 6465 2829 0d0a 2020 2020 2020  t.hide()..      
+0005a1a0: 2020 7365 6c66 2e72 625f 6d65 6469 616e    self.rb_median
+0005a1b0: 2e74 6f67 676c 6564 2e63 6f6e 6e65 6374  .toggled.connect
+0005a1c0: 2873 656c 662e 5368 6f77 496d 6167 6529  (self.ShowImage)
+0005a1d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e4f  ..        self.O
+0005a1e0: 6e53 6372 6f6c 6c45 6e67 2830 290d 0a0d  nScrollEng(0)...
+0005a1f0: 0a20 2020 2064 6566 2053 686f 7743 616c  .    def ShowCal
+0005a200: 6349 6d61 6765 2873 656c 6629 3a0d 0a20  cImage(self):.. 
+0005a210: 2020 2020 2020 2069 6620 616e 7928 5b73         if any([s
+0005a220: 656c 662e 6362 5f68 2e69 7343 6865 636b  elf.cb_h.isCheck
+0005a230: 6564 2829 2c73 656c 662e 6362 5f76 2e69  ed(),self.cb_v.i
+0005a240: 7343 6865 636b 6564 2829 5d29 3a0d 0a20  sChecked()]):.. 
+0005a250: 2020 2020 2020 2020 2020 2061 203d 2073             a = s
+0005a260: 656c 662e 7374 6163 6b2e 6162 7364 6174  elf.stack.absdat
+0005a270: 615b 3a2c 203a 2c20 7365 6c66 2e73 6c69  a[:, :, self.sli
+0005a280: 6465 725f 656e 672e 7661 6c75 6528 295d  der_eng.value()]
+0005a290: 2e61 7374 7970 6528 2766 6c6f 6174 3634  .astype('float64
+0005a2a0: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
+0005a2b0: 612c 2077 6620 3d20 7365 6c66 2e4c 6576  a, wf = self.Lev
+0005a2c0: 656c 4361 6c63 2861 290d 0a20 2020 2020  elCalc(a)..     
+0005a2d0: 2020 2020 2020 2069 6620 7365 6c66 2e72         if self.r
+0005a2e0: 625f 6d65 6469 616e 5f69 302e 6973 4368  b_median_i0.isCh
+0005a2f0: 6563 6b65 6428 293a 0d0a 2020 2020 2020  ecked():..      
+0005a300: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+0005a310: 6162 656c 5f33 2e73 6574 5465 7874 2873  abel_3.setText(s
+0005a320: 7472 2827 7b3a 647d 2729 2e66 6f72 6d61  tr('{:d}').forma
+0005a330: 7428 696e 7428 7766 2929 2b27 2025 2729  t(int(wf))+' %')
+0005a340: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0005a350: 6c66 2e69 5f69 7465 6d2e 7365 7449 6d61  lf.i_item.setIma
+0005a360: 6765 2861 290d 0a0d 0a20 2020 2064 6566  ge(a)....    def
+0005a370: 2043 6f72 7265 6374 696f 6e41 7272 6179   CorrectionArray
+0005a380: 2873 656c 662c 6172 7261 792c 6178 6973  (self,array,axis
+0005a390: 2c77 662c 6d61 736b 203d 204e 6f6e 652c  ,wf,mask = None,
+0005a3a0: 293a 0d0a 2020 2020 2020 2020 2320 6361  ):..        # ca
+0005a3b0: 6c63 756c 6174 6520 6d65 6469 616e 2061  lculate median a
+0005a3c0: 6c6f 6e67 2067 6976 656e 2061 7869 732c  long given axis,
+0005a3d0: 2069 676e 6f72 696e 6720 6e61 6e73 2069   ignoring nans i
+0005a3e0: 6620 7072 6573 656e 740d 0a20 2020 2020  f present..     
+0005a3f0: 2020 2061 7272 6179 5f69 203d 206e 702e     array_i = np.
+0005a400: 6e61 6e6d 6564 6961 6e28 6172 7261 792c  nanmedian(array,
+0005a410: 2061 7869 733d 6178 6973 2c20 6b65 6570   axis=axis, keep
+0005a420: 6469 6d73 3d46 616c 7365 290d 0a20 2020  dims=False)..   
+0005a430: 2020 2020 2069 6620 6d61 736b 2069 7320       if mask is 
+0005a440: 6e6f 7420 4e6f 6e65 2061 6e64 2077 6620  not None and wf 
+0005a450: 213d 2030 2e30 3a0d 0a20 2020 2020 2020  != 0.0:..       
+0005a460: 2020 2020 2061 7272 6179 203d 206e 702e       array = np.
+0005a470: 7768 6572 6528 6d61 736b 2c20 6172 7261  where(mask, arra
+0005a480: 792c 206e 702e 6e61 6e29 2023 2072 6570  y, np.nan) # rep
+0005a490: 6c61 6365 206d 6173 6b65 6420 7069 7865  lace masked pixe
+0005a4a0: 6c73 2062 7920 6e61 6e73 0d0a 2020 2020  ls by nans..    
+0005a4b0: 2020 2020 2020 2020 2320 6361 6c63 756c          # calcul
+0005a4c0: 6174 6520 6d65 6469 616e 2061 6c6f 6e67  ate median along
+0005a4d0: 2067 6976 656e 2061 7869 732c 2069 676e   given axis, ign
+0005a4e0: 6f72 696e 6720 6e61 6e73 2069 6620 7072  oring nans if pr
+0005a4f0: 6573 656e 740d 0a20 2020 2020 2020 2020  esent..         
+0005a500: 2020 2061 7272 6179 203d 206e 702e 6e61     array = np.na
+0005a510: 6e6d 6564 6961 6e28 6172 7261 792c 2061  nmedian(array, a
+0005a520: 7869 733d 6178 6973 2c20 6b65 6570 6469  xis=axis, keepdi
+0005a530: 6d73 3d46 616c 7365 290d 0a20 2020 2020  ms=False)..     
+0005a540: 2020 2020 2020 2062 675f 6d65 6469 616e         bg_median
+0005a550: 203d 206e 702e 6e61 6e6d 6564 6961 6e28   = np.nanmedian(
+0005a560: 6172 7261 792c 2061 7869 733d 302c 206b  array, axis=0, k
+0005a570: 6565 7064 696d 733d 4661 6c73 6529 0d0a  eepdims=False)..
+0005a580: 2020 2020 2020 2020 6966 206d 6173 6b20          if mask 
+0005a590: 6973 204e 6f6e 6520 6f72 2077 6620 3d3d  is None or wf ==
+0005a5a0: 2030 2e30 3a0d 0a20 2020 2020 2020 2020   0.0:..         
+0005a5b0: 2020 2023 2072 6574 7572 6e73 2074 6865     # returns the
+0005a5c0: 206d 6564 6961 6e20 6669 6c74 6572 6564   median filtered
+0005a5d0: 2061 7272 6179 206e 6567 6c65 6374 696e   array neglectin
+0005a5e0: 6720 7468 6520 6930 206d 6173 6b0d 0a20  g the i0 mask.. 
+0005a5f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0005a600: 6e20 286e 702e 6e61 6e6d 6564 6961 6e28  n (np.nanmedian(
+0005a610: 6172 7261 795f 692c 2061 7869 733d 302c  array_i, axis=0,
+0005a620: 206b 6565 7064 696d 733d 4661 6c73 6529   keepdims=False)
+0005a630: 202d 2061 7272 6179 5f69 290d 0a20 2020   - array_i)..   
+0005a640: 2020 2020 2065 6c69 6620 7766 203d 3d20       elif wf == 
+0005a650: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+0005a660: 7265 7475 726e 2028 2862 675f 6d65 6469  return ((bg_medi
+0005a670: 616e 202d 2061 7272 6179 292a 2877 6629  an - array)*(wf)
+0005a680: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+0005a690: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0005a6a0: 7475 726e 2028 2862 675f 6d65 6469 616e  turn ((bg_median
+0005a6b0: 202d 2061 7272 6179 292a 2877 6629 202b   - array)*(wf) +
+0005a6c0: 2028 6267 5f6d 6564 6961 6e20 2d20 6172   (bg_median - ar
+0005a6d0: 7261 795f 6929 2a28 312d 7766 2929 0d0a  ray_i)*(1-wf))..
+0005a6e0: 0d0a 2020 2020 6465 6620 4c65 7665 6c43  ..    def LevelC
+0005a6f0: 616c 6328 7365 6c66 2c61 2c66 696e 616c  alc(self,a,final
+0005a700: 3d46 616c 7365 293a 0d0a 2020 2020 2020  =False):..      
+0005a710: 2020 7766 203d 2030 2e30 0d0a 2020 2020    wf = 0.0..    
+0005a720: 2020 2020 6d61 736b 203d 204e 6f6e 650d      mask = None.
+0005a730: 0a20 2020 2020 2020 2064 6966 665f 7620  .        diff_v 
+0005a740: 3d20 300d 0a20 2020 2020 2020 2064 6966  = 0..        dif
+0005a750: 665f 6820 3d20 300d 0a20 2020 2020 2020  f_h = 0..       
+0005a760: 2069 6620 7365 6c66 2e63 625f 682e 6973   if self.cb_h.is
+0005a770: 4368 6563 6b65 6428 293a 0d0a 2020 2020  Checked():..    
+0005a780: 2020 2020 2020 2020 7766 203d 2028 7365          wf = (se
+0005a790: 6c66 2e77 6569 6768 745f 736c 6964 6572  lf.weight_slider
+0005a7a0: 2e76 616c 7565 2829 2920 2f20 3130 300d  .value()) / 100.
+0005a7b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0005a7c0: 7365 6c66 2e72 625f 6d65 6469 616e 5f69  self.rb_median_i
+0005a7d0: 302e 6973 4368 6563 6b65 6428 293a 0d0a  0.isChecked():..
+0005a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a7f0: 6d61 736b 203d 2073 656c 662e 7374 6163  mask = self.stac
+0005a800: 6b2e 6930 5f6d 6173 6b5b 3a2c 203a 2c20  k.i0_mask[:, :, 
+0005a810: 305d 0d0a 2020 2020 2020 2020 2020 2020  0]..            
+0005a820: 2020 2020 6966 2066 696e 616c 3a0d 0a20      if final:.. 
+0005a830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a840: 2020 206d 6173 6b20 3d20 6d61 736b 5b3a     mask = mask[:
+0005a850: 2c20 3a2c 204e 6f6e 655d 0d0a 2020 2020  , :, None]..    
+0005a860: 2020 2020 2020 2020 6469 6666 5f68 203d          diff_h =
+0005a870: 2073 656c 662e 436f 7272 6563 7469 6f6e   self.Correction
+0005a880: 4172 7261 7928 612c 2030 2c20 666c 6f61  Array(a, 0, floa
+0005a890: 7428 7766 292c 206d 6173 6b29 5b4e 6f6e  t(wf), mask)[Non
+0005a8a0: 652c 203a 5d0d 0a20 2020 2020 2020 2020  e, :]..         
+0005a8b0: 2020 2023 6120 2b3d 2064 6966 665b 4e6f     #a += diff[No
+0005a8c0: 6e65 2c20 3a5d 0d0a 2020 2020 2020 2020  ne, :]..        
+0005a8d0: 6966 2073 656c 662e 6362 5f76 2e69 7343  if self.cb_v.isC
+0005a8e0: 6865 636b 6564 2829 3a0d 0a20 2020 2020  hecked():..     
+0005a8f0: 2020 2020 2020 2077 6620 3d20 2873 656c         wf = (sel
+0005a900: 662e 7765 6967 6874 5f73 6c69 6465 722e  f.weight_slider.
+0005a910: 7661 6c75 6528 2929 202f 2031 3030 0d0a  value()) / 100..
+0005a920: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0005a930: 656c 662e 7262 5f6d 6564 6961 6e5f 6930  elf.rb_median_i0
+0005a940: 2e69 7343 6865 636b 6564 2829 3a0d 0a20  .isChecked():.. 
+0005a950: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0005a960: 6173 6b20 3d20 7365 6c66 2e73 7461 636b  ask = self.stack
+0005a970: 2e69 305f 6d61 736b 5b3a 2c20 3a2c 2030  .i0_mask[:, :, 0
+0005a980: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0005a990: 2020 2069 6620 6669 6e61 6c3a 0d0a 2020     if final:..  
+0005a9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a9b0: 2020 6d61 736b 203d 206d 6173 6b5b 3a2c    mask = mask[:,
+0005a9c0: 203a 2c20 4e6f 6e65 5d0d 0a20 2020 2020   :, None]..     
+0005a9d0: 2020 2020 2020 2064 6966 665f 7620 3d20         diff_v = 
+0005a9e0: 7365 6c66 2e43 6f72 7265 6374 696f 6e41  self.CorrectionA
+0005a9f0: 7272 6179 2861 2c20 312c 2066 6c6f 6174  rray(a, 1, float
+0005aa00: 2877 6629 2c20 6d61 736b 295b 3a20 2c4e  (wf), mask)[: ,N
+0005aa10: 6f6e 655d 0d0a 2020 2020 2020 2020 6120  one]..        a 
+0005aa20: 3d20 6120 2b20 6469 6666 5f76 202b 2064  = a + diff_v + d
+0005aa30: 6966 665f 680d 0a20 2020 2020 2020 2072  iff_h..        r
+0005aa40: 6574 7572 6e28 612c 696e 7428 7766 2a31  eturn(a,int(wf*1
+0005aa50: 3030 2929 0d0a 2320 2d2d 2d2d 2d2d 2d2d  00))..# --------
+0005aa60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005aa70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005aa80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005aa90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a  --------------..
+0005aaa0: 2020 2020 6465 6620 4f6e 5363 726f 6c6c      def OnScroll
+0005aab0: 456e 6728 7365 6c66 2c20 7661 6c75 6529  Eng(self, value)
+0005aac0: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+0005aad0: 736c 6964 6572 5f65 6e67 2e73 6574 5661  slider_eng.setVa
+0005aae0: 6c75 6528 7661 6c75 6529 0d0a 2020 2020  lue(value)..    
+0005aaf0: 2020 2020 7365 6c66 2e69 6576 203d 2076      self.iev = v
+0005ab00: 616c 7565 0d0a 0d0a 2020 2020 2020 2020  alue....        
+0005ab10: 7365 6c66 2e53 686f 7749 6d61 6765 2829  self.ShowImage()
+0005ab20: 0d0a 2020 2020 6465 6620 5368 6f77 496d  ..    def ShowIm
+0005ab30: 6167 6528 7365 6c66 293a 0d0a 2020 2020  age(self):..    
+0005ab40: 2020 2020 6966 2028 7365 6c66 2e73 6c69      if (self.sli
+0005ab50: 6465 725f 656e 672e 6973 536c 6964 6572  der_eng.isSlider
+0005ab60: 446f 776e 2829 293a 0d0a 2020 2020 2020  Down()):..      
+0005ab70: 2020 2020 2020 7365 6c66 2e69 5f69 7465        self.i_ite
+0005ab80: 6d2e 7365 7449 6d61 6765 2873 656c 662e  m.setImage(self.
+0005ab90: 7374 6163 6b2e 6162 7364 6174 615b 3a2c  stack.absdata[:,
+0005aba0: 203a 2c20 696e 7428 7365 6c66 2e69 6576   :, int(self.iev
+0005abb0: 295d 290d 0a20 2020 2020 2020 2065 6c69  )])..        eli
+0005abc0: 6620 616e 7928 5b73 656c 662e 6362 5f68  f any([self.cb_h
+0005abd0: 2e69 7343 6865 636b 6564 2829 2c20 7365  .isChecked(), se
+0005abe0: 6c66 2e63 625f 762e 6973 4368 6563 6b65  lf.cb_v.isChecke
+0005abf0: 6428 295d 293a 0d0a 2020 2020 2020 2020  d()]):..        
+0005ac00: 2020 2020 7365 6c66 2e53 686f 7743 616c      self.ShowCal
+0005ac10: 6349 6d61 6765 2829 0d0a 2020 2020 2020  cImage()..      
+0005ac20: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0005ac30: 2020 2020 2073 656c 662e 695f 6974 656d       self.i_item
+0005ac40: 2e73 6574 496d 6167 6528 7365 6c66 2e73  .setImage(self.s
+0005ac50: 7461 636b 2e61 6273 6461 7461 5b3a 2c20  tack.absdata[:, 
+0005ac60: 3a2c 2069 6e74 2873 656c 662e 6965 7629  :, int(self.iev)
+0005ac70: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
+0005ac80: 2020 7365 6c66 2e6c 6162 656c 5f33 2e73    self.label_3.s
+0005ac90: 6574 5465 7874 2873 7472 2827 2729 290d  etText(str('')).
+0005aca0: 0a20 2020 2020 2020 2073 656c 662e 6772  .        self.gr
+0005acb0: 6f75 7042 6f78 2e73 6574 5469 746c 6528  oupBox.setTitle(
+0005acc0: 7374 7228 2753 7461 636b 2042 726f 7773  str('Stack Brows
+0005acd0: 6572 207c 2049 6d61 6765 2061 7420 7b30  er | Image at {0
+0005ace0: 3a35 2e32 667d 2065 5627 292e 666f 726d  :5.2f} eV').form
+0005acf0: 6174 2866 6c6f 6174 2873 656c 662e 7374  at(float(self.st
+0005ad00: 6163 6b2e 6576 5b73 656c 662e 6965 765d  ack.ev[self.iev]
+0005ad10: 2929 290d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d  )))..#----------
+0005ad20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005ad30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005ad40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005ad50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020  ------------..  
+0005ad60: 2020 6465 6620 4f6e 4163 6365 7074 2873    def OnAccept(s
+0005ad70: 656c 662c 2065 7674 293a 0d0a 2020 2020  elf, evt):..    
+0005ad80: 2020 2020 612c 2077 6620 3d20 7365 6c66      a, wf = self
+0005ad90: 2e4c 6576 656c 4361 6c63 2873 656c 662e  .LevelCalc(self.
+0005ada0: 7374 6163 6b2e 6162 7364 6174 612e 6173  stack.absdata.as
+0005adb0: 7479 7065 2827 666c 6f61 7436 3427 292c  type('float64'),
+0005adc0: 6669 6e61 6c3d 5472 7565 290d 0a20 2020  final=True)..   
+0005add0: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
+0005ade0: 6162 7364 6174 6120 3d20 610d 0a20 2020  absdata = a..   
+0005adf0: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
+0005ae00: 2e70 6167 6531 2e73 686f 7753 7065 6374  .page1.showSpect
+0005ae10: 7275 6d28 7365 6c66 2e70 6172 656e 742e  rum(self.parent.
+0005ae20: 7061 6765 312e 6978 2c20 7365 6c66 2e70  page1.ix, self.p
+0005ae30: 6172 656e 742e 7061 6765 312e 6979 290d  arent.page1.iy).
+0005ae40: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+0005ae50: 7265 6e74 2e70 6167 6531 2e6c 6f61 6449  rent.page1.loadI
+0005ae60: 6d61 6765 2829 0d0a 2020 2020 2020 2020  mage()..        
+0005ae70: 7365 6c66 2e70 6172 656e 742e 7061 6765  self.parent.page
+0005ae80: 302e 436c 6561 7228 290d 0a20 2020 2020  0.Clear()..     
+0005ae90: 2020 2073 656c 662e 7061 7265 6e74 2e70     self.parent.p
+0005aea0: 6167 6530 2e4c 6f61 6445 6e74 7269 6573  age0.LoadEntries
+0005aeb0: 2829 0d0a 0d0a 2020 2020 2020 2020 6966  ()....        if
+0005aec0: 2073 686f 776d 6170 7461 623a 0d0a 2020   showmaptab:..  
+0005aed0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0005aee0: 6172 656e 742e 7061 6765 392e 436c 6561  arent.page9.Clea
+0005aef0: 7228 290d 0a20 2020 2020 2020 2020 2020  r()..           
+0005af00: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
+0005af10: 6539 2e4c 6f61 6445 6e74 7269 6573 2829  e9.LoadEntries()
+0005af20: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+0005af30: 2e63 6c6f 7365 2829 0d0a 232d 2d2d 2d2d  .close()..#-----
+0005af40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005af50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005af60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005af70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005af80: 2d0d 0a63 6c61 7373 204d 756c 7469 4372  -..class MultiCr
+0005af90: 6f70 2851 7457 6964 6765 7473 2e51 4469  op(QtWidgets.QDi
+0005afa0: 616c 6f67 2c20 5174 5769 6467 6574 732e  alog, QtWidgets.
+0005afb0: 5147 7261 7068 6963 7353 6365 6e65 293a  QGraphicsScene):
+0005afc0: 0d0a 2020 2020 6576 6c69 7374 6368 616e  ..    evlistchan
+0005afd0: 6765 6420 3d20 7079 7174 5369 676e 616c  ged = pyqtSignal
+0005afe0: 285b 6f62 6a65 6374 5d29 0d0a 2020 2020  ([object])..    
+0005aff0: 7468 6574 616c 6973 7463 6861 6e67 6564  thetalistchanged
+0005b000: 203d 2070 7971 7453 6967 6e61 6c28 5b6f   = pyqtSignal([o
+0005b010: 626a 6563 745d 290d 0a20 2020 2064 6566  bject])..    def
+0005b020: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+0005b030: 7061 7265 6e74 2c20 636f 6d6d 6f6e 2c20  parent, common, 
+0005b040: 7374 6163 6b29 3a0d 0a20 2020 2020 2020  stack):..       
+0005b050: 2051 7457 6964 6765 7473 2e51 5769 6467   QtWidgets.QWidg
+0005b060: 6574 2e5f 5f69 6e69 745f 5f28 7365 6c66  et.__init__(self
+0005b070: 2c20 7061 7265 6e74 290d 0a20 2020 2020  , parent)..     
+0005b080: 2020 2075 6963 2e6c 6f61 6455 6928 6f73     uic.loadUi(os
+0005b090: 2e70 6174 682e 6a6f 696e 286f 732e 7061  .path.join(os.pa
+0005b0a0: 7468 2e64 6972 6e61 6d65 286f 732e 7061  th.dirname(os.pa
+0005b0b0: 7468 2e61 6273 7061 7468 285f 5f66 696c  th.abspath(__fil
+0005b0c0: 655f 5f29 292c 2027 7368 6f77 6d75 6c74  e__)), 'showmult
+0005b0d0: 6963 726f 702e 7569 2729 2c20 7365 6c66  icrop.ui'), self
+0005b0e0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0005b0f0: 7061 7265 6e74 203d 2070 6172 656e 740d  parent = parent.
+0005b100: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
+0005b110: 6163 6b20 3d20 7374 6163 6b0d 0a20 2020  ack = stack..   
+0005b120: 2020 2020 2073 656c 662e 636f 6d20 3d20       self.com = 
+0005b130: 636f 6d6d 6f6e 0d0a 2020 2020 2020 2020  common..        
+0005b140: 7365 6c66 2e69 6576 203d 2030 0d0a 2020  self.iev = 0..  
+0005b150: 2020 2020 2020 7365 6c66 2e69 7468 6574        self.ithet
+0005b160: 6120 3d20 300d 0a20 2020 2020 2020 2023  a = 0..        #
+0005b170: 7365 6c66 2e73 7461 636b 2e61 6273 6461  self.stack.absda
+0005b180: 7461 5f73 6869 6674 6564 5f63 726f 7070  ta_shifted_cropp
+0005b190: 6564 203d 2073 656c 662e 7374 6163 6b2e  ed = self.stack.
+0005b1a0: 6162 7364 6174 615f 7368 6966 7465 642e  absdata_shifted.
+0005b1b0: 636f 7079 2829 0d0a 0d0a 2020 2020 2020  copy()....      
+0005b1c0: 2020 7365 6c66 2e70 6f6f 6c74 6872 6561    self.poolthrea
+0005b1d0: 6420 3d20 5174 436f 7265 2e51 5468 7265  d = QtCore.QThre
+0005b1e0: 6164 2829 0d0a 2020 2020 2020 2020 7365  ad()..        se
+0005b1f0: 6c66 2e61 6c69 676e 6564 203d 2046 616c  lf.aligned = Fal
+0005b200: 7365 0d0a 2020 2020 2020 2020 7365 6c66  se..        self
+0005b210: 2e62 7574 746f 6e5f 6f6b 2e73 6574 456e  .button_ok.setEn
+0005b220: 6162 6c65 6428 5472 7565 290d 0a0d 0a20  abled(True).... 
+0005b230: 2020 2020 2020 2073 656c 662e 7365 7457         self.setW
+0005b240: 696e 646f 7754 6974 6c65 2827 5374 6163  indowTitle('Stac
+0005b250: 6b20 4372 6f70 7069 6e67 2729 0d0a 2020  k Cropping')..  
+0005b260: 2020 2020 2020 7365 6c66 2e70 676c 6179        self.pglay
+0005b270: 6f75 7420 3d20 7067 2e47 7261 7068 6963  out = pg.Graphic
+0005b280: 734c 6179 6f75 7428 626f 7264 6572 3d4e  sLayout(border=N
+0005b290: 6f6e 6529 0d0a 2020 2020 2020 2020 7365  one)..        se
+0005b2a0: 6c66 2e63 616e 7661 732e 7365 7442 6163  lf.canvas.setBac
+0005b2b0: 6b67 726f 756e 6428 2277 2229 2023 2063  kground("w") # c
+0005b2c0: 616e 7661 7320 6973 2061 2070 672e 4772  anvas is a pg.Gr
+0005b2d0: 6170 6869 6373 5669 6577 2077 6964 6765  aphicsView widge
+0005b2e0: 740d 0a20 2020 2020 2020 2073 656c 662e  t..        self.
+0005b2f0: 6361 6e76 6173 2e73 6574 4365 6e74 7261  canvas.setCentra
+0005b300: 6c57 6964 6765 7428 7365 6c66 2e70 676c  lWidget(self.pgl
+0005b310: 6179 6f75 7429 0d0a 2020 2020 2020 2020  ayout)..        
+0005b320: 7365 6c66 2e76 6220 3d20 7365 6c66 2e70  self.vb = self.p
+0005b330: 676c 6179 6f75 742e 6164 6456 6965 7742  glayout.addViewB
+0005b340: 6f78 2829 0d0a 2020 2020 2020 2020 7365  ox()..        se
+0005b350: 6c66 2e76 622e 7365 7441 7370 6563 744c  lf.vb.setAspectL
+0005b360: 6f63 6b65 6428 290d 0a20 2020 2020 2020  ocked()..       
+0005b370: 2073 656c 662e 695f 6974 656d 203d 2070   self.i_item = p
+0005b380: 672e 496d 6167 6549 7465 6d28 626f 7264  g.ImageItem(bord
+0005b390: 6572 3d22 6b22 2c70 6172 656e 743d 2073  er="k",parent= s
+0005b3a0: 656c 6629 0d0a 0d0a 2020 2020 2020 2020  elf)....        
+0005b3b0: 7365 6c66 2e76 622e 7365 744d 6f75 7365  self.vb.setMouse
+0005b3c0: 456e 6162 6c65 6428 783d 4661 6c73 652c  Enabled(x=False,
+0005b3d0: 2079 3d46 616c 7365 290d 0a20 2020 2020   y=False)..     
+0005b3e0: 2020 2073 656c 662e 7662 2e61 6464 4974     self.vb.addIt
+0005b3f0: 656d 2873 656c 662e 695f 6974 656d 2c20  em(self.i_item, 
+0005b400: 6967 6e6f 7265 426f 756e 6473 3d46 616c  ignoreBounds=Fal
+0005b410: 7365 290d 0a0d 0a20 2020 2020 2020 2073  se)....        s
+0005b420: 656c 662e 6275 7474 6f6e 5f6f 6b2e 636c  elf.button_ok.cl
+0005b430: 6963 6b65 642e 636f 6e6e 6563 7428 7365  icked.connect(se
+0005b440: 6c66 2e4f 6e41 6363 6570 7429 0d0a 2020  lf.OnAccept)..  
+0005b450: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+0005b460: 6e5f 6361 6e63 656c 2e63 6c69 636b 6564  n_cancel.clicked
+0005b470: 2e63 6f6e 6e65 6374 2873 656c 662e 4f6e  .connect(self.On
+0005b480: 4361 6e63 656c 290d 0a0d 0a20 2020 2020  Cancel)....     
+0005b490: 2020 2069 6620 7365 6c66 2e63 6f6d 2e73     if self.com.s
+0005b4a0: 7461 636b 5f6c 6f61 6465 6420 3d3d 2031  tack_loaded == 1
+0005b4b0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0005b4c0: 656c 662e 6c61 6265 6c5f 7468 6574 615f  elf.label_theta_
+0005b4d0: 7261 6e67 652e 7365 7456 6973 6962 6c65  range.setVisible
+0005b4e0: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
+0005b4f0: 2020 2020 2073 656c 662e 736c 6964 6572       self.slider
+0005b500: 5f74 6865 7461 2e73 6574 5669 7369 626c  _theta.setVisibl
+0005b510: 6528 4661 6c73 6529 0d0a 2020 2020 2020  e(False)..      
+0005b520: 2020 2020 2020 7365 6c66 2e63 625f 7265        self.cb_re
+0005b530: 6d6f 7665 5f74 6865 7461 2e73 6574 5669  move_theta.setVi
+0005b540: 7369 626c 6528 4661 6c73 6529 0d0a 2020  sible(False)..  
+0005b550: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
+0005b560: 726f 7570 426f 785f 7468 6574 612e 7365  roupBox_theta.se
+0005b570: 7456 6973 6962 6c65 2846 616c 7365 290d  tVisible(False).
+0005b580: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0005b590: 7365 6c66 2e63 6f6d 2e73 7461 636b 5f34  self.com.stack_4
+0005b5a0: 6420 3d3d 2031 3a0d 0a20 2020 2020 2020  d == 1:..       
+0005b5b0: 2020 2020 2020 2020 2073 656c 662e 6c61           self.la
+0005b5c0: 6265 6c5f 7468 6574 615f 7261 6e67 652e  bel_theta_range.
+0005b5d0: 7365 7456 6973 6962 6c65 2854 7275 6529  setVisible(True)
+0005b5e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005b5f0: 2020 7365 6c66 2e73 6c69 6465 725f 7468    self.slider_th
+0005b600: 6574 612e 7365 7456 6973 6962 6c65 2854  eta.setVisible(T
+0005b610: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
+0005b620: 2020 2020 2020 7365 6c66 2e63 625f 7265        self.cb_re
+0005b630: 6d6f 7665 5f74 6865 7461 2e73 6574 5669  move_theta.setVi
+0005b640: 7369 626c 6528 5472 7565 290d 0a20 2020  sible(True)..   
+0005b650: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0005b660: 662e 6772 6f75 7042 6f78 5f74 6865 7461  f.groupBox_theta
+0005b670: 2e73 6574 5669 7369 626c 6528 5472 7565  .setVisible(True
+0005b680: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0005b690: 2020 2073 656c 662e 736c 6964 6572 5f74     self.slider_t
+0005b6a0: 6865 7461 2e73 6574 5261 6e67 6528 302c  heta.setRange(0,
+0005b6b0: 2073 656c 662e 7374 6163 6b2e 6e5f 7468   self.stack.n_th
+0005b6c0: 6574 6120 2d20 3129 0d0a 2020 2020 2020  eta - 1)..      
+0005b6d0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0005b6e0: 6c69 6465 725f 7468 6574 612e 7661 6c75  lider_theta.valu
+0005b6f0: 6543 6861 6e67 6564 5b69 6e74 5d2e 636f  eChanged[int].co
+0005b700: 6e6e 6563 7428 7365 6c66 2e4f 6e53 6372  nnect(self.OnScr
+0005b710: 6f6c 6c54 6865 7461 290d 0a20 2020 2020  ollTheta)..     
+0005b720: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0005b730: 5365 7475 704c 6973 7454 6865 7461 2829  SetupListTheta()
+0005b740: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0005b750: 7365 6c66 2e6d 6173 6b65 6476 616c 7320  self.maskedvals 
+0005b760: 3d20 5b54 7275 655d 202a 2069 6e74 2873  = [True] * int(s
+0005b770: 656c 662e 7374 6163 6b2e 6e5f 6576 290d  elf.stack.n_ev).
+0005b780: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
+0005b790: 656c 662e 7370 696e 426f 7845 7272 6f72  elf.spinBoxError
+0005b7a0: 2e73 6574 456e 6162 6c65 6428 4661 6c73  .setEnabled(Fals
+0005b7b0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0005b7c0: 7365 6c66 2e73 6c69 6465 725f 656e 672e  self.slider_eng.
+0005b7d0: 736c 6964 6572 5072 6573 7365 642e 636f  sliderPressed.co
+0005b7e0: 6e6e 6563 7428 7365 6c66 2e53 686f 7749  nnect(self.ShowI
+0005b7f0: 6d61 6765 290d 0a20 2020 2020 2020 2020  mage)..         
+0005b800: 2020 2073 656c 662e 736c 6964 6572 5f65     self.slider_e
+0005b810: 6e67 2e73 6c69 6465 7252 656c 6561 7365  ng.sliderRelease
+0005b820: 642e 636f 6e6e 6563 7428 7365 6c66 2e53  d.connect(self.S
+0005b830: 686f 7749 6d61 6765 290d 0a20 2020 2020  howImage)..     
+0005b840: 2020 2020 2020 2073 656c 662e 736c 6964         self.slid
+0005b850: 6572 5f65 6e67 2e76 616c 7565 4368 616e  er_eng.valueChan
+0005b860: 6765 645b 696e 745d 2e63 6f6e 6e65 6374  ged[int].connect
+0005b870: 2873 656c 662e 4f6e 5363 726f 6c6c 456e  (self.OnScrollEn
+0005b880: 6729 0d0a 2020 2020 2020 2020 2020 2020  g)..            
+0005b890: 7365 6c66 2e73 6c69 6465 725f 656e 672e  self.slider_eng.
+0005b8a0: 7365 7452 616e 6765 2830 2c20 7365 6c66  setRange(0, self
+0005b8b0: 2e73 7461 636b 2e6e 5f65 7620 2d20 3129  .stack.n_ev - 1)
+0005b8c0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0005b8d0: 6c66 2e70 625f 7365 6c65 6374 616c 6c2e  lf.pb_selectall.
+0005b8e0: 636c 6963 6b65 642e 636f 6e6e 6563 7428  clicked.connect(
+0005b8f0: 7365 6c66 2e4f 6e53 656c 6563 7441 6c6c  self.OnSelectAll
+0005b900: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0005b910: 656c 662e 7062 5f63 6c65 6172 616c 6c2e  elf.pb_clearall.
+0005b920: 636c 6963 6b65 642e 636f 6e6e 6563 7428  clicked.connect(
+0005b930: 7365 6c66 2e4f 6e43 6c65 6172 416c 6c29  self.OnClearAll)
+0005b940: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0005b950: 6c66 2e65 766c 6973 7463 6861 6e67 6564  lf.evlistchanged
+0005b960: 2e63 6f6e 6e65 6374 286c 616d 6264 6120  .connect(lambda 
+0005b970: 726f 773a 2073 656c 662e 714c 6973 7443  row: self.qListC
+0005b980: 6861 6e67 6548 616e 646c 6572 2872 6f77  hangeHandler(row
+0005b990: 2c20 2265 6e65 7267 7922 2929 0d0a 2020  , "energy"))..  
+0005b9a0: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
+0005b9b0: 6865 7461 6c69 7374 6368 616e 6765 642e  hetalistchanged.
+0005b9c0: 636f 6e6e 6563 7428 6c61 6d62 6461 2072  connect(lambda r
+0005b9d0: 6f77 3a20 7365 6c66 2e71 4c69 7374 4368  ow: self.qListCh
+0005b9e0: 616e 6765 4861 6e64 6c65 7228 726f 772c  angeHandler(row,
+0005b9f0: 2022 7468 6574 6122 2929 0d0a 2020 2020   "theta"))..    
+0005ba00: 2020 2020 2020 2020 2373 656c 662e 6576          #self.ev
+0005ba10: 5f77 6964 6765 742e 6974 656d 436c 6963  _widget.itemClic
+0005ba20: 6b65 642e 636f 6e6e 6563 7428 6c61 6d62  ked.connect(lamb
+0005ba30: 6461 2069 7465 6d3a 2073 656c 662e 4f6e  da item: self.On
+0005ba40: 4974 656d 436c 6963 6b65 6428 6974 656d  ItemClicked(item
+0005ba50: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+0005ba60: 7365 6c66 2e65 765f 7769 6467 6574 2e6d  self.ev_widget.m
+0005ba70: 6f75 7365 5072 6573 7345 7665 6e74 203d  ousePressEvent =
+0005ba80: 2073 656c 662e 6d6f 7573 6545 7665 6e74   self.mouseEvent
+0005ba90: 4f6e 4556 4c69 7374 0d0a 2020 2020 2020  OnEVList..      
+0005baa0: 2020 2020 2020 7365 6c66 2e65 765f 7769        self.ev_wi
+0005bab0: 6467 6574 2e6d 6f75 7365 4d6f 7665 4576  dget.mouseMoveEv
+0005bac0: 656e 7420 3d20 7365 6c66 2e6d 6f75 7365  ent = self.mouse
+0005bad0: 4576 656e 744f 6e45 564c 6973 740d 0a20  EventOnEVList.. 
+0005bae0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0005baf0: 7468 6574 615f 7769 6467 6574 2e6d 6f75  theta_widget.mou
+0005bb00: 7365 5072 6573 7345 7665 6e74 203d 2073  sePressEvent = s
+0005bb10: 656c 662e 6d6f 7573 6545 7665 6e74 4f6e  elf.mouseEventOn
+0005bb20: 5468 6574 614c 6973 740d 0a20 2020 2020  ThetaList..     
+0005bb30: 2020 2020 2020 2073 656c 662e 7468 6574         self.thet
+0005bb40: 615f 7769 6467 6574 2e6d 6f75 7365 4d6f  a_widget.mouseMo
+0005bb50: 7665 4576 656e 7420 3d20 7365 6c66 2e6d  veEvent = self.m
+0005bb60: 6f75 7365 4576 656e 744f 6e54 6865 7461  ouseEventOnTheta
+0005bb70: 4c69 7374 0d0a 2020 2020 2020 2020 2020  List..          
+0005bb80: 2020 2373 656c 662e 6576 5f77 6964 6765    #self.ev_widge
+0005bb90: 742e 6974 656d 5365 6c65 6374 696f 6e43  t.itemSelectionC
+0005bba0: 6861 6e67 6564 2e63 6f6e 6e65 6374 286c  hanged.connect(l
+0005bbb0: 616d 6264 6120 6974 656d 3a20 7365 6c66  ambda item: self
+0005bbc0: 2e4f 6e49 7465 6d43 6c69 636b 6564 2869  .OnItemClicked(i
+0005bbd0: 7465 6d29 290d 0a20 2020 2020 2020 2020  tem))..         
+0005bbe0: 2020 2073 656c 662e 5365 7475 704c 6973     self.SetupLis
+0005bbf0: 7445 5628 290d 0a20 2020 2020 2020 2020  tEV()..         
+0005bc00: 2020 2073 656c 662e 4f6e 5363 726f 6c6c     self.OnScroll
+0005bc10: 456e 6728 3029 0d0a 2020 2020 2020 2020  Eng(0)..        
+0005bc20: 2020 2020 7365 6c66 2e53 6574 7570 524f      self.SetupRO
+0005bc30: 4928 290d 0a20 2020 2020 2020 2020 2020  I()..           
+0005bc40: 2073 656c 662e 5365 7475 7050 6c6f 7428   self.SetupPlot(
+0005bc50: 290d 0a0d 0a20 2020 2064 6566 206d 6f75  )....    def mou
+0005bc60: 7365 4576 656e 744f 6e45 564c 6973 7428  seEventOnEVList(
+0005bc70: 7365 6c66 2c20 6529 3a0d 0a20 2020 2020  self, e):..     
+0005bc80: 2020 2069 6620 652e 7479 7065 2829 203d     if e.type() =
+0005bc90: 3d20 5174 436f 7265 2e51 4576 656e 742e  = QtCore.QEvent.
+0005bca0: 4d6f 7573 654d 6f76 6520 6f72 2065 2e74  MouseMove or e.t
+0005bcb0: 7970 6528 2920 3d3d 2051 7443 6f72 652e  ype() == QtCore.
+0005bcc0: 5145 7665 6e74 2e4d 6f75 7365 4275 7474  QEvent.MouseButt
+0005bcd0: 6f6e 5072 6573 733a 0d0a 2020 2020 2020  onPress:..      
+0005bce0: 2020 2020 2020 716c 6973 7420 3d20 7365        qlist = se
+0005bcf0: 6c66 2e65 765f 7769 6467 6574 0d0a 2020  lf.ev_widget..  
+0005bd00: 2020 2020 2020 2020 2020 706f 7320 3d20            pos = 
+0005bd10: 716c 6973 742e 6d61 7046 726f 6d47 6c6f  qlist.mapFromGlo
+0005bd20: 6261 6c28 5174 4775 692e 5143 7572 736f  bal(QtGui.QCurso
+0005bd30: 722e 706f 7328 2929 0d0a 2020 2020 2020  r.pos())..      
+0005bd40: 2020 2020 2020 726f 7720 3d20 716c 6973        row = qlis
+0005bd50: 742e 696e 6465 7841 7428 706f 7329 2e72  t.indexAt(pos).r
+0005bd60: 6f77 2829 0d0a 2020 2020 2020 2020 2020  ow()..          
+0005bd70: 2020 6974 656d 203d 2071 6c69 7374 2e69    item = qlist.i
+0005bd80: 7465 6d41 7428 706f 7329 0d0a 2020 2020  temAt(pos)..    
+0005bd90: 2020 2020 2020 2020 2370 7269 6e74 2872          #print(r
+0005bda0: 6f77 2c73 656c 662e 6c61 7465 7374 5f72  ow,self.latest_r
+0005bdb0: 6f77 290d 0a20 2020 2020 2020 2020 2020  ow)..           
+0005bdc0: 2069 6620 726f 7720 3e3d 2030 3a0d 0a20   if row >= 0:.. 
+0005bdd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0005bde0: 6620 652e 7479 7065 2829 2021 3d20 5174  f e.type() != Qt
+0005bdf0: 436f 7265 2e51 4576 656e 742e 4d6f 7573  Core.QEvent.Mous
+0005be00: 654d 6f76 6520 6f72 2072 6f77 2021 3d20  eMove or row != 
+0005be10: 7365 6c66 2e6c 6174 6573 745f 726f 773a  self.latest_row:
+0005be20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005be30: 2020 2020 2020 6966 2065 2e62 7574 746f        if e.butto
+0005be40: 6e73 2829 203d 3d20 5174 436f 7265 2e51  ns() == QtCore.Q
+0005be50: 742e 4c65 6674 4275 7474 6f6e 3a0d 0a20  t.LeftButton:.. 
+0005be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005be70: 2020 2020 2020 2071 6c69 7374 2e73 6574         qlist.set
+0005be80: 4375 7272 656e 7452 6f77 2872 6f77 290d  CurrentRow(row).
+0005be90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005bea0: 2020 2020 2020 2020 2073 656c 662e 6576           self.ev
+0005beb0: 6c69 7374 6368 616e 6765 642e 656d 6974  listchanged.emit
+0005bec0: 2869 7465 6d29 0d0a 2020 2020 2020 2020  (item)..        
+0005bed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005bee0: 7365 6c66 2e6c 6174 6573 745f 726f 7720  self.latest_row 
+0005bef0: 3d20 726f 770d 0a20 2020 2020 2020 2072  = row..        r
+0005bf00: 6574 7572 6e0d 0a20 2020 2064 6566 206d  eturn..    def m
+0005bf10: 6f75 7365 4576 656e 744f 6e54 6865 7461  ouseEventOnTheta
+0005bf20: 4c69 7374 2873 656c 662c 2065 293a 0d0a  List(self, e):..
+0005bf30: 2020 2020 2020 2020 6966 2065 2e74 7970          if e.typ
+0005bf40: 6528 2920 3d3d 2051 7443 6f72 652e 5145  e() == QtCore.QE
+0005bf50: 7665 6e74 2e4d 6f75 7365 4d6f 7665 206f  vent.MouseMove o
+0005bf60: 7220 652e 7479 7065 2829 203d 3d20 5174  r e.type() == Qt
+0005bf70: 436f 7265 2e51 4576 656e 742e 4d6f 7573  Core.QEvent.Mous
+0005bf80: 6542 7574 746f 6e50 7265 7373 3a0d 0a20  eButtonPress:.. 
+0005bf90: 2020 2020 2020 2020 2020 2071 6c69 7374             qlist
+0005bfa0: 203d 2073 656c 662e 7468 6574 615f 7769   = self.theta_wi
+0005bfb0: 6467 6574 0d0a 2020 2020 2020 2020 2020  dget..          
+0005bfc0: 2020 706f 7320 3d20 716c 6973 742e 6d61    pos = qlist.ma
+0005bfd0: 7046 726f 6d47 6c6f 6261 6c28 5174 4775  pFromGlobal(QtGu
+0005bfe0: 692e 5143 7572 736f 722e 706f 7328 2929  i.QCursor.pos())
+0005bff0: 0d0a 2020 2020 2020 2020 2020 2020 726f  ..            ro
+0005c000: 7720 3d20 716c 6973 742e 696e 6465 7841  w = qlist.indexA
+0005c010: 7428 706f 7329 2e72 6f77 2829 0d0a 2020  t(pos).row()..  
+0005c020: 2020 2020 2020 2020 2020 6974 656d 203d            item =
+0005c030: 2071 6c69 7374 2e69 7465 6d41 7428 706f   qlist.itemAt(po
+0005c040: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+0005c050: 2370 7269 6e74 2872 6f77 2c73 656c 662e  #print(row,self.
+0005c060: 6c61 7465 7374 5f72 6f77 290d 0a20 2020  latest_row)..   
+0005c070: 2020 2020 2020 2020 2069 6620 726f 7720           if row 
+0005c080: 3e3d 2030 3a0d 0a20 2020 2020 2020 2020  >= 0:..         
+0005c090: 2020 2020 2020 2069 6620 652e 7479 7065         if e.type
+0005c0a0: 2829 2021 3d20 5174 436f 7265 2e51 4576  () != QtCore.QEv
+0005c0b0: 656e 742e 4d6f 7573 654d 6f76 6520 6f72  ent.MouseMove or
+0005c0c0: 2072 6f77 2021 3d20 7365 6c66 2e6c 6174   row != self.lat
+0005c0d0: 6573 745f 726f 773a 0d0a 2020 2020 2020  est_row:..      
+0005c0e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0005c0f0: 2065 2e62 7574 746f 6e73 2829 203d 3d20   e.buttons() == 
+0005c100: 5174 436f 7265 2e51 742e 4c65 6674 4275  QtCore.Qt.LeftBu
+0005c110: 7474 6f6e 3a0d 0a20 2020 2020 2020 2020  tton:..         
+0005c120: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+0005c130: 6c69 7374 2e73 6574 4375 7272 656e 7452  list.setCurrentR
+0005c140: 6f77 2872 6f77 290d 0a20 2020 2020 2020  ow(row)..       
+0005c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005c160: 2073 656c 662e 7468 6574 616c 6973 7463   self.thetalistc
+0005c170: 6861 6e67 6564 2e65 6d69 7428 6974 656d  hanged.emit(item
+0005c180: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0005c190: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0005c1a0: 6c61 7465 7374 5f72 6f77 203d 2072 6f77  latest_row = row
+0005c1b0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0005c1c0: 0d0a 2020 2020 6465 6620 4f6e 5365 6c65  ..    def OnSele
+0005c1d0: 6374 696f 6e43 6861 6e67 6564 2873 656c  ctionChanged(sel
+0005c1e0: 6629 3a0d 0a20 2020 2020 2020 2073 656c  f):..        sel
+0005c1f0: 662e 5265 6472 6177 4e65 7750 6c6f 7428  f.RedrawNewPlot(
+0005c200: 290d 0a20 2020 2020 2020 2023 7365 6c66  )..        #self
+0005c210: 2e55 7064 6174 6549 6e64 6963 6573 2829  .UpdateIndices()
+0005c220: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+0005c230: 6567 696f 6e2e 626c 6f63 6b53 6967 6e61  egion.blockSigna
+0005c240: 6c73 2854 7275 6529 0d0a 2020 2020 2020  ls(True)..      
+0005c250: 2020 6966 2073 656c 662e 6964 785f 7365    if self.idx_se
+0005c260: 6c65 6374 6564 3a0d 0a20 2020 2020 2020  lected:..       
+0005c270: 2020 2020 2073 656c 662e 7265 6769 6f6e       self.region
+0005c280: 2e73 6574 5265 6769 6f6e 285b 7365 6c66  .setRegion([self
+0005c290: 2e73 7461 636b 2e65 765b 6d69 6e28 7365  .stack.ev[min(se
+0005c2a0: 6c66 2e69 6478 5f73 656c 6563 7465 6429  lf.idx_selected)
+0005c2b0: 5d2c 2073 656c 662e 7374 6163 6b2e 6576  ], self.stack.ev
+0005c2c0: 5b6d 6178 2873 656c 662e 6964 785f 7365  [max(self.idx_se
+0005c2d0: 6c65 6374 6564 295d 5d29 0d0a 2020 2020  lected)]])..    
+0005c2e0: 2020 2020 2020 2020 7365 6c66 2e72 6567          self.reg
+0005c2f0: 696f 6e2e 626c 6f63 6b53 6967 6e61 6c73  ion.blockSignals
+0005c300: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
+0005c310: 2020 2020 2073 656c 662e 7370 6563 7472       self.spectr
+0005c320: 756d 5f70 6c6f 7477 6964 6765 742e 7365  um_plotwidget.se
+0005c330: 7458 5261 6e67 6528 2a73 656c 662e 7265  tXRange(*self.re
+0005c340: 6769 6f6e 2e67 6574 5265 6769 6f6e 2829  gion.getRegion()
+0005c350: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0005c360: 656c 662e 7370 6563 7472 756d 5f70 6c6f  elf.spectrum_plo
+0005c370: 7477 6964 6765 742e 7365 7459 5261 6e67  twidget.setYRang
+0005c380: 6528 6e70 2e6d 696e 2873 656c 662e 706c  e(np.min(self.pl
+0005c390: 6f74 6974 656d 5f6e 6577 2e79 4461 7461  otitem_new.yData
+0005c3a0: 292c 6e70 2e6d 6178 2873 656c 662e 706c  ),np.max(self.pl
+0005c3b0: 6f74 6974 656d 5f6e 6577 2e79 4461 7461  otitem_new.yData
+0005c3c0: 2929 0d0a 2020 2020 2020 2020 7265 7475  ))..        retu
+0005c3d0: 726e 0d0a 2020 2020 6465 6620 5570 6461  rn..    def Upda
+0005c3e0: 7465 496e 6469 6365 7328 7365 6c66 293a  teIndices(self):
+0005c3f0: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
+0005c400: 6478 5f73 656c 6563 7465 6420 3d20 736f  dx_selected = so
+0005c410: 7274 6564 285b 7365 6c66 2e65 765f 7769  rted([self.ev_wi
+0005c420: 6467 6574 2e72 6f77 2869 2920 666f 7220  dget.row(i) for 
+0005c430: 6920 696e 2073 656c 662e 6576 5f73 656c  i in self.ev_sel
+0005c440: 6563 7465 645d 290d 0a20 2020 2020 2020  ected])..       
+0005c450: 2069 6620 7365 6c66 2e63 6f6d 2e73 7461   if self.com.sta
+0005c460: 636b 5f34 643a 0d0a 2020 2020 2020 2020  ck_4d:..        
+0005c470: 2020 2020 7365 6c66 2e74 6865 7461 6964      self.thetaid
+0005c480: 785f 7365 6c65 6374 6564 203d 2073 6f72  x_selected = sor
+0005c490: 7465 6428 5b73 656c 662e 7468 6574 615f  ted([self.theta_
+0005c4a0: 7769 6467 6574 2e72 6f77 2869 2920 666f  widget.row(i) fo
+0005c4b0: 7220 6920 696e 2073 656c 662e 7468 6574  r i in self.thet
+0005c4c0: 615f 7365 6c65 6374 6564 5d29 0d0a 2020  a_selected])..  
+0005c4d0: 2020 6465 6620 5265 6472 6177 506c 6f74    def RedrawPlot
+0005c4e0: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
+0005c4f0: 2020 782c 7920 3d20 7365 6c66 2e47 656e    x,y = self.Gen
+0005c500: 6572 6174 6553 7065 6374 7275 6d28 6c69  erateSpectrum(li
+0005c510: 7374 2872 616e 6765 2873 656c 662e 7374  st(range(self.st
+0005c520: 6163 6b2e 6e5f 6576 2929 290d 0a20 2020  ack.n_ev)))..   
+0005c530: 2020 2020 2073 656c 662e 706c 6f74 6974       self.plotit
+0005c540: 656d 2e73 6574 4461 7461 2878 2c79 290d  em.setData(x,y).
+0005c550: 0a20 2020 2020 2020 2073 656c 662e 4f6e  .        self.On
+0005c560: 5365 6c65 6374 696f 6e43 6861 6e67 6564  SelectionChanged
+0005c570: 2829 0d0a 2020 2020 6465 6620 5265 6472  ()..    def Redr
+0005c580: 6177 4e65 7750 6c6f 7428 7365 6c66 293a  awNewPlot(self):
+0005c590: 0d0a 2020 2020 2020 2020 7365 6c66 2e55  ..        self.U
+0005c5a0: 7064 6174 6549 6e64 6963 6573 2829 0d0a  pdateIndices()..
+0005c5b0: 2020 2020 2020 2020 782c 7920 3d20 7365          x,y = se
+0005c5c0: 6c66 2e47 656e 6572 6174 6553 7065 6374  lf.GenerateSpect
+0005c5d0: 7275 6d28 7365 6c66 2e69 6478 5f73 656c  rum(self.idx_sel
+0005c5e0: 6563 7465 6429 0d0a 2020 2020 2020 2020  ected)..        
+0005c5f0: 7365 6c66 2e70 6c6f 7469 7465 6d5f 6e65  self.plotitem_ne
+0005c600: 772e 7365 7444 6174 6128 782c 7929 0d0a  w.setData(x,y)..
+0005c610: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0005c620: 6964 785f 7365 6c65 6374 6564 3a0d 0a20  idx_selected:.. 
+0005c630: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0005c640: 7265 6769 6f6e 2e73 686f 7728 290d 0a20  region.show().. 
+0005c650: 2020 2064 6566 2071 4c69 7374 4368 616e     def qListChan
+0005c660: 6765 4861 6e64 6c65 7228 7365 6c66 2c72  geHandler(self,r
+0005c670: 6f77 2c20 6469 6d65 6e73 696f 6e29 3a0d  ow, dimension):.
+0005c680: 0a20 2020 2020 2020 2069 6620 6469 6d65  .        if dime
+0005c690: 6e73 696f 6e20 3d3d 2022 7468 6574 6122  nsion == "theta"
+0005c6a0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0005c6b0: 656c 6563 7469 6f6e 203d 2073 656c 662e  election = self.
+0005c6c0: 7468 6574 615f 7365 6c65 6374 6564 0d0a  theta_selected..
+0005c6d0: 2020 2020 2020 2020 2020 2020 7769 6467              widg
+0005c6e0: 6574 203d 2073 656c 662e 7468 6574 615f  et = self.theta_
+0005c6f0: 7769 6467 6574 0d0a 2020 2020 2020 2020  widget..        
+0005c700: 656c 6966 2064 696d 656e 7369 6f6e 203d  elif dimension =
+0005c710: 3d20 2265 6e65 7267 7922 3a0d 0a20 2020  = "energy":..   
+0005c720: 2020 2020 2020 2020 2073 656c 6563 7469           selecti
+0005c730: 6f6e 203d 2073 656c 662e 6576 5f73 656c  on = self.ev_sel
+0005c740: 6563 7465 640d 0a20 2020 2020 2020 2020  ected..         
+0005c750: 2020 2077 6964 6765 7420 3d20 7365 6c66     widget = self
+0005c760: 2e65 765f 7769 6467 6574 0d0a 0d0a 2020  .ev_widget....  
+0005c770: 2020 2020 2020 6966 2072 6f77 2069 6e20        if row in 
+0005c780: 7365 6c65 6374 696f 6e3a 0d0a 2020 2020  selection:..    
+0005c790: 2020 2020 2020 2020 7365 6c65 6374 696f          selectio
+0005c7a0: 6e2e 7265 6d6f 7665 2872 6f77 290d 0a20  n.remove(row).. 
+0005c7b0: 2020 2020 2020 2020 2020 2072 6f77 2e73             row.s
+0005c7c0: 6574 4261 636b 6772 6f75 6e64 2851 7447  etBackground(QtG
+0005c7d0: 7569 2e51 436f 6c6f 7228 302c 2030 2c20  ui.QColor(0, 0, 
+0005c7e0: 302c 2030 2929 0d0a 2020 2020 2020 2020  0, 0))..        
+0005c7f0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0005c800: 2020 2073 656c 6563 7469 6f6e 2e61 7070     selection.app
+0005c810: 656e 6428 726f 7729 0d0a 2020 2020 2020  end(row)..      
+0005c820: 2020 2020 2020 726f 772e 7365 7442 6163        row.setBac
+0005c830: 6b67 726f 756e 6428 5174 4775 692e 5143  kground(QtGui.QC
+0005c840: 6f6c 6f72 2827 2362 6561 6564 3427 2929  olor('#beaed4'))
+0005c850: 0d0a 2020 2020 2020 2020 6966 2064 696d  ..        if dim
+0005c860: 656e 7369 6f6e 203d 3d20 2274 6865 7461  ension == "theta
+0005c870: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
+0005c880: 7365 6c66 2e4f 6e53 6372 6f6c 6c54 6865  self.OnScrollThe
+0005c890: 7461 2877 6964 6765 742e 726f 7728 726f  ta(widget.row(ro
+0005c8a0: 7729 290d 0a20 2020 2020 2020 2065 6c69  w))..        eli
+0005c8b0: 6620 6469 6d65 6e73 696f 6e20 3d3d 2022  f dimension == "
+0005c8c0: 656e 6572 6779 223a 0d0a 2020 2020 2020  energy":..      
+0005c8d0: 2020 2020 2020 7365 6c66 2e4f 6e53 6372        self.OnScr
+0005c8e0: 6f6c 6c45 6e67 2877 6964 6765 742e 726f  ollEng(widget.ro
+0005c8f0: 7728 726f 7729 290d 0a20 2020 2020 2020  w(row))..       
+0005c900: 2073 656c 662e 4f6e 5365 6c65 6374 696f   self.OnSelectio
+0005c910: 6e43 6861 6e67 6564 2829 0d0a 0d0a 2020  nChanged()....  
+0005c920: 2020 6465 6620 5365 7475 7050 6c6f 7428    def SetupPlot(
+0005c930: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+0005c940: 782c 7920 3d20 7365 6c66 2e47 656e 6572  x,y = self.Gener
+0005c950: 6174 6553 7065 6374 7275 6d28 6c69 7374  ateSpectrum(list
+0005c960: 2872 616e 6765 2873 656c 662e 7374 6163  (range(self.stac
+0005c970: 6b2e 6e5f 6576 2929 290d 0a20 2020 2020  k.n_ev)))..     
+0005c980: 2020 2073 656c 662e 7370 6563 7472 756d     self.spectrum
+0005c990: 5f70 6c6f 7477 6964 6765 742e 7365 7442  _plotwidget.setB
+0005c9a0: 6163 6b67 726f 756e 6428 2277 2229 0d0a  ackground("w")..
+0005c9b0: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+0005c9c0: 6567 696f 6e20 3d20 7067 2e4c 696e 6561  egion = pg.Linea
+0005c9d0: 7252 6567 696f 6e49 7465 6d28 6272 7573  rRegionItem(brus
+0005c9e0: 683d 5b32 3535 2c30 2c30 2c34 355d 2c62  h=[255,0,0,45],b
+0005c9f0: 6f75 6e64 733d 5b6e 702e 6d69 6e28 7829  ounds=[np.min(x)
+0005ca00: 2c6e 702e 6d61 7828 7829 5d29 0d0a 0d0a  ,np.max(x)])....
+0005ca10: 2020 2020 2020 2020 7365 6c66 2e72 6567          self.reg
+0005ca20: 696f 6e2e 7365 745a 5661 6c75 6528 3130  ion.setZValue(10
+0005ca30: 290d 0a20 2020 2020 2020 2070 6c6f 7420  )..        plot 
+0005ca40: 3d20 7365 6c66 2e73 7065 6374 7275 6d5f  = self.spectrum_
+0005ca50: 706c 6f74 7769 6467 6574 0d0a 2020 2020  plotwidget..    
+0005ca60: 2020 2020 706c 6f74 2e73 6574 4261 636b      plot.setBack
+0005ca70: 6772 6f75 6e64 2822 7722 290d 0a20 2020  ground("w")..   
+0005ca80: 2020 2020 2070 6c6f 742e 6164 6449 7465       plot.addIte
+0005ca90: 6d28 7365 6c66 2e72 6567 696f 6e2c 2069  m(self.region, i
+0005caa0: 676e 6f72 6542 6f75 6e64 733d 4661 6c73  gnoreBounds=Fals
+0005cab0: 6529 0d0a 2020 2020 2020 2020 706c 6f74  e)..        plot
+0005cac0: 2e73 6574 4d6f 7573 6545 6e61 626c 6564  .setMouseEnabled
+0005cad0: 2878 3d46 616c 7365 2c20 793d 4661 6c73  (x=False, y=Fals
+0005cae0: 6529 0d0a 2020 2020 2020 2020 706c 6f74  e)..        plot
+0005caf0: 2e73 686f 7747 7269 6428 793d 5472 7565  .showGrid(y=True
+0005cb00: 290d 0a0d 0a20 2020 2020 2020 2070 6c6f  )....        plo
+0005cb10: 742e 7368 6f77 4178 6973 2822 746f 7022  t.showAxis("top"
+0005cb20: 2c20 7368 6f77 3d54 7275 6529 0d0a 2020  , show=True)..  
+0005cb30: 2020 2020 2020 706c 6f74 2e73 686f 7741        plot.showA
+0005cb40: 7869 7328 2272 6967 6874 222c 2073 686f  xis("right", sho
+0005cb50: 773d 5472 7565 290d 0a20 2020 2020 2020  w=True)..       
+0005cb60: 2062 7920 3d20 706c 6f74 2e67 6574 4178   by = plot.getAx
+0005cb70: 6973 2822 7269 6768 7422 290d 0a20 2020  is("right")..   
+0005cb80: 2020 2020 2062 7820 3d20 706c 6f74 2e67       bx = plot.g
+0005cb90: 6574 4178 6973 2822 746f 7022 290d 0a20  etAxis("top").. 
+0005cba0: 2020 2020 2020 2062 792e 7365 7453 7479         by.setSty
+0005cbb0: 6c65 2873 686f 7756 616c 7565 733d 4661  le(showValues=Fa
+0005cbc0: 6c73 652c 7469 636b 4c65 6e67 7468 3d30  lse,tickLength=0
+0005cbd0: 290d 0a20 2020 2020 2020 2062 782e 7365  )..        bx.se
+0005cbe0: 7453 7479 6c65 2873 686f 7756 616c 7565  tStyle(showValue
+0005cbf0: 733d 4661 6c73 652c 7469 636b 4c65 6e67  s=False,tickLeng
+0005cc00: 7468 3d30 290d 0a20 2020 2020 2020 2061  th=0)..        a
+0005cc10: 7920 3d20 706c 6f74 2e67 6574 4178 6973  y = plot.getAxis
+0005cc20: 2822 6c65 6674 2229 0d0a 2020 2020 2020  ("left")..      
+0005cc30: 2020 6178 203d 2070 6c6f 742e 6765 7441    ax = plot.getA
+0005cc40: 7869 7328 2262 6f74 746f 6d22 290d 0a0d  xis("bottom")...
+0005cc50: 0a20 2020 2020 2020 2061 782e 7365 744c  .        ax.setL
+0005cc60: 6162 656c 2874 6578 743d 2250 686f 746f  abel(text="Photo
+0005cc70: 6e20 656e 6572 6779 205b 6556 5d22 290d  n energy [eV]").
+0005cc80: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0005cc90: 2e63 6f6d 2e69 305f 6c6f 6164 6564 3a0d  .com.i0_loaded:.
+0005cca0: 0a20 2020 2020 2020 2020 2020 2061 792e  .            ay.
+0005ccb0: 7365 744c 6162 656c 2874 6578 743d 224f  setLabel(text="O
+0005ccc0: 7074 6963 616c 2064 656e 7369 7479 2229  ptical density")
+0005ccd0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+0005cce0: 0a20 2020 2020 2020 2020 2020 2061 792e  .            ay.
+0005ccf0: 7365 744c 6162 656c 2874 6578 743d 2250  setLabel(text="P
+0005cd00: 686f 746f 6e20 666c 7578 205b 6370 735d  hoton flux [cps]
+0005cd10: 2229 0d0a 0d0a 2020 2020 2020 2020 7365  ")....        se
+0005cd20: 6c66 2e70 6c6f 7469 7465 6d20 3d20 706c  lf.plotitem = pl
+0005cd30: 6f74 2e70 6c6f 7428 782c 2079 2c20 7065  ot.plot(x, y, pe
+0005cd40: 6e3d 7067 2e6d 6b50 656e 2863 6f6c 6f72  n=pg.mkPen(color
+0005cd50: 3d30 2e38 2c20 7769 6474 683d 3229 290d  =0.8, width=2)).
+0005cd60: 0a20 2020 2020 2020 2073 656c 662e 706c  .        self.pl
+0005cd70: 6f74 6974 656d 5f6e 6577 203d 2070 6c6f  otitem_new = plo
+0005cd80: 742e 706c 6f74 2878 2c20 792c 2070 656e  t.plot(x, y, pen
+0005cd90: 3d70 672e 6d6b 5065 6e28 636f 6c6f 723d  =pg.mkPen(color=
+0005cda0: 2262 222c 2077 6964 7468 3d32 2929 0d0a  "b", width=2))..
+0005cdb0: 2020 2020 2020 2020 7365 6c66 2e72 6566          self.ref
+0005cdc0: 6d61 726b 6572 203d 2070 672e 496e 6669  marker = pg.Infi
+0005cdd0: 6e69 7465 4c69 6e65 2861 6e67 6c65 3d39  niteLine(angle=9
+0005cde0: 302c 206d 6f76 6162 6c65 3d46 616c 7365  0, movable=False
+0005cdf0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0005ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ce10: 2020 2020 2020 2020 2020 2020 7065 6e3d              pen=
+0005ce20: 7067 2e6d 6b50 656e 2863 6f6c 6f72 3d22  pg.mkPen(color="
+0005ce30: 6222 2c20 7769 6474 683d 322c 2073 7479  b", width=2, sty
+0005ce40: 6c65 3d51 7443 6f72 652e 5174 2e44 6173  le=QtCore.Qt.Das
+0005ce50: 684c 696e 6529 290d 0a20 2020 2020 2020  hLine))..       
+0005ce60: 2070 6c6f 742e 6164 6449 7465 6d28 7365   plot.addItem(se
+0005ce70: 6c66 2e72 6566 6d61 726b 6572 2c20 6967  lf.refmarker, ig
+0005ce80: 6e6f 7265 426f 756e 6473 3d54 7275 6529  noreBounds=True)
+0005ce90: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+0005cea0: 6567 696f 6e2e 7365 7452 6567 696f 6e28  egion.setRegion(
+0005ceb0: 286d 696e 2878 292c 6d61 7828 7829 2929  (min(x),max(x)))
+0005cec0: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+0005ced0: 6567 696f 6e2e 7369 6752 6567 696f 6e43  egion.sigRegionC
+0005cee0: 6861 6e67 6546 696e 6973 6865 642e 636f  hangeFinished.co
+0005cef0: 6e6e 6563 7428 6c61 6d62 6461 2072 6567  nnect(lambda reg
+0005cf00: 696f 6e3a 2073 656c 662e 5570 6461 7465  ion: self.Update
+0005cf10: 4556 5265 6769 6f6e 2872 6567 696f 6e29  EVRegion(region)
+0005cf20: 290d 0a20 2020 2023 202d 2d2d 2d2d 2d2d  )..    # -------
+0005cf30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005cf40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005cf50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005cf60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
+0005cf70: 0a20 2020 2064 6566 2067 6574 4461 7461  .    def getData
+0005cf80: 436c 6f73 6573 7454 6f52 6567 696f 6e28  ClosestToRegion(
+0005cf90: 7365 6c66 2c72 6567 696f 6e2c 706c 6f74  self,region,plot
+0005cfa0: 6974 656d 2c73 6e61 7072 6567 696f 6e3d  item,snapregion=
+0005cfb0: 4661 6c73 6529 3a0d 0a20 2020 2020 2020  False):..       
+0005cfc0: 206d 696e 6964 782c 206d 6178 6964 7820   minidx, maxidx 
+0005cfd0: 3d20 7265 6769 6f6e 2e67 6574 5265 6769  = region.getRegi
+0005cfe0: 6f6e 2829 0d0a 2020 2020 2020 2020 6461  on()..        da
+0005cff0: 7461 203d 2070 6c6f 7469 7465 6d2e 6765  ta = plotitem.ge
+0005d000: 7444 6174 6128 295b 305d 0d0a 2020 2020  tData()[0]..    
+0005d010: 2020 2020 696e 6465 7820 3d20 6c61 6d62      index = lamb
+0005d020: 6461 2078 3a20 6e70 2e61 7267 6d69 6e28  da x: np.argmin(
+0005d030: 6e70 2e61 6273 2864 6174 6120 2d20 7829  np.abs(data - x)
+0005d040: 290d 0a20 2020 2020 2020 206d 696e 6964  )..        minid
+0005d050: 7820 3d20 696e 6465 7828 6d69 6e69 6478  x = index(minidx
+0005d060: 290d 0a20 2020 2020 2020 206d 6178 6964  )..        maxid
+0005d070: 7820 3d20 696e 6465 7828 6d61 7869 6478  x = index(maxidx
+0005d080: 290d 0a20 2020 2020 2020 2069 6620 6d69  )..        if mi
+0005d090: 6e69 6478 203d 3d20 6d61 7869 6478 3a0d  nidx == maxidx:.
+0005d0a0: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
+0005d0b0: 6964 7820 3d20 300d 0a20 2020 2020 2020  idx = 0..       
+0005d0c0: 2020 2020 206d 6178 6964 7820 3d20 6e70       maxidx = np
+0005d0d0: 2e61 7267 6d61 7828 6461 7461 290d 0a20  .argmax(data).. 
+0005d0e0: 2020 2020 2020 206d 696e 6461 7461 203d         mindata =
+0005d0f0: 2064 6174 615b 6d69 6e69 6478 5d0d 0a20   data[minidx].. 
+0005d100: 2020 2020 2020 206d 6178 6461 7461 203d         maxdata =
+0005d110: 2064 6174 615b 6d61 7869 6478 5d0d 0a20   data[maxidx].. 
+0005d120: 2020 2020 2020 2069 6620 736e 6170 7265         if snapre
+0005d130: 6769 6f6e 3a0d 0a20 2020 2020 2020 2020  gion:..         
+0005d140: 2020 2072 6567 696f 6e2e 626c 6f63 6b53     region.blockS
+0005d150: 6967 6e61 6c73 2854 7275 6529 0d0a 2020  ignals(True)..  
+0005d160: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
+0005d170: 2e73 6574 5265 6769 6f6e 285b 6d69 6e64  .setRegion([mind
+0005d180: 6174 612c 206d 6178 6461 7461 5d29 2020  ata, maxdata])  
+0005d190: 2320 736e 6170 2072 6567 696f 6e20 746f  # snap region to
+0005d1a0: 2064 6174 6120 706f 696e 7473 0d0a 2020   data points..  
+0005d1b0: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
+0005d1c0: 2e62 6c6f 636b 5369 676e 616c 7328 4661  .blockSignals(Fa
+0005d1d0: 6c73 6529 0d0a 2020 2020 2020 2020 7265  lse)..        re
+0005d1e0: 7475 726e 206d 696e 6964 782c 206d 6178  turn minidx, max
+0005d1f0: 6964 782c 206d 696e 6461 7461 2c20 6d61  idx, mindata, ma
+0005d200: 7864 6174 610d 0a20 2020 200d 0a20 2020  xdata..    ..   
+0005d210: 2064 6566 2055 7064 6174 6545 5652 6567   def UpdateEVReg
+0005d220: 696f 6e28 7365 6c66 2c20 7265 6769 6f6e  ion(self, region
+0005d230: 293a 0d0a 2020 2020 2020 2020 6d69 6e5f  ):..        min_
+0005d240: 6964 782c 206d 6178 5f69 6478 2c2a 5f20  idx, max_idx,*_ 
+0005d250: 203d 2073 656c 662e 6765 7444 6174 6143   = self.getDataC
+0005d260: 6c6f 7365 7374 546f 5265 6769 6f6e 2872  losestToRegion(r
+0005d270: 6567 696f 6e2c 7365 6c66 2e70 6c6f 7469  egion,self.ploti
+0005d280: 7465 6d2c 2054 7275 6529 0d0a 2020 2020  tem, True)..    
+0005d290: 2020 2020 795f 7661 6c73 203d 2073 656c      y_vals = sel
+0005d2a0: 662e 706c 6f74 6974 656d 2e79 4461 7461  f.plotitem.yData
+0005d2b0: 5b6d 696e 5f69 6478 3a6d 6178 5f69 6478  [min_idx:max_idx
+0005d2c0: 202b 2031 5d0d 0a20 2020 2020 2020 2078   + 1]..        x
+0005d2d0: 5f76 616c 7320 3d20 7365 6c66 2e70 6c6f  _vals = self.plo
+0005d2e0: 7469 7465 6d2e 7844 6174 615b 6d69 6e5f  titem.xData[min_
+0005d2f0: 6964 783a 6d61 785f 6964 7820 2b20 315d  idx:max_idx + 1]
+0005d300: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+0005d310: 7065 6374 7275 6d5f 706c 6f74 7769 6467  pectrum_plotwidg
+0005d320: 6574 2e73 6574 5261 6e67 6528 7952 616e  et.setRange(yRan
+0005d330: 6765 3d5b 6e70 2e6d 696e 2879 5f76 616c  ge=[np.min(y_val
+0005d340: 7329 2c20 6e70 2e6d 6178 2879 5f76 616c  s), np.max(y_val
+0005d350: 7329 5d2c 2078 5261 6e67 653d 5b6e 702e  s)], xRange=[np.
+0005d360: 6d69 6e28 785f 7661 6c73 292c 206e 702e  min(x_vals), np.
+0005d370: 6d61 7828 785f 7661 6c73 295d 2c20 6469  max(x_vals)], di
+0005d380: 7361 626c 6541 7574 6f52 616e 6765 3d54  sableAutoRange=T
+0005d390: 7275 652c 2070 6164 6469 6e67 3d30 2e30  rue, padding=0.0
+0005d3a0: 3529 0d0a 2020 2020 2020 2020 6966 206d  5)..        if m
+0005d3b0: 696e 5f69 6478 206e 6f74 2069 6e20 7365  in_idx not in se
+0005d3c0: 6c66 2e69 6478 5f73 656c 6563 7465 643a  lf.idx_selected:
+0005d3d0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+0005d3e0: 7220 6964 7820 696e 2072 616e 6765 2869  r idx in range(i
+0005d3f0: 6e74 286d 696e 5f69 6478 292c 6e70 2e6d  nt(min_idx),np.m
+0005d400: 696e 2873 656c 662e 6964 785f 7365 6c65  in(self.idx_sele
+0005d410: 6374 6564 2929 3a0d 0a20 2020 2020 2020  cted)):..       
+0005d420: 2020 2020 2020 2020 2073 656c 662e 6576           self.ev
+0005d430: 5f73 656c 6563 7465 642e 6170 7065 6e64  _selected.append
+0005d440: 2873 656c 662e 6576 5f77 6964 6765 742e  (self.ev_widget.
+0005d450: 6974 656d 2869 6478 2929 0d0a 2020 2020  item(idx))..    
+0005d460: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0005d470: 2e65 765f 7769 6467 6574 2e69 7465 6d28  .ev_widget.item(
+0005d480: 6964 7829 2e73 6574 4261 636b 6772 6f75  idx).setBackgrou
+0005d490: 6e64 2851 7447 7569 2e51 436f 6c6f 7228  nd(QtGui.QColor(
+0005d4a0: 2723 6265 6165 6434 2729 290d 0a20 2020  '#beaed4'))..   
+0005d4b0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0005d4c0: 2020 2020 2020 2020 666f 7220 6964 7820          for idx 
+0005d4d0: 696e 2072 616e 6765 286e 702e 6d69 6e28  in range(np.min(
+0005d4e0: 7365 6c66 2e69 6478 5f73 656c 6563 7465  self.idx_selecte
+0005d4f0: 6429 2c69 6e74 286d 696e 5f69 6478 2929  d),int(min_idx))
+0005d500: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0005d510: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+0005d520: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0005d530: 662e 6576 5f73 656c 6563 7465 642e 7265  f.ev_selected.re
+0005d540: 6d6f 7665 2873 656c 662e 6576 5f77 6964  move(self.ev_wid
+0005d550: 6765 742e 6974 656d 2869 6478 2929 0d0a  get.item(idx))..
+0005d560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d570: 6578 6365 7074 2056 616c 7565 4572 726f  except ValueErro
+0005d580: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+0005d590: 2020 2020 2020 2020 7061 7373 0d0a 2020          pass..  
+0005d5a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0005d5b0: 6c66 2e65 765f 7769 6467 6574 2e69 7465  lf.ev_widget.ite
+0005d5c0: 6d28 6964 7829 2e73 6574 4261 636b 6772  m(idx).setBackgr
+0005d5d0: 6f75 6e64 2851 7447 7569 2e51 436f 6c6f  ound(QtGui.QColo
+0005d5e0: 7228 302c 2030 2c20 302c 2030 2929 0d0a  r(0, 0, 0, 0))..
+0005d5f0: 2020 2020 2020 2020 6966 206d 6178 5f69          if max_i
+0005d600: 6478 206e 6f74 2069 6e20 7365 6c66 2e69  dx not in self.i
+0005d610: 6478 5f73 656c 6563 7465 643a 0d0a 2020  dx_selected:..  
+0005d620: 2020 2020 2020 2020 2020 666f 7220 6964            for id
+0005d630: 7820 696e 2072 616e 6765 286e 702e 6d61  x in range(np.ma
+0005d640: 7828 7365 6c66 2e69 6478 5f73 656c 6563  x(self.idx_selec
+0005d650: 7465 6429 2b31 2c69 6e74 286d 6178 5f69  ted)+1,int(max_i
+0005d660: 6478 292b 3129 3a0d 0a20 2020 2020 2020  dx)+1):..       
+0005d670: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
+0005d680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d690: 2020 2073 656c 662e 6576 5f73 656c 6563     self.ev_selec
+0005d6a0: 7465 642e 6170 7065 6e64 2873 656c 662e  ted.append(self.
+0005d6b0: 6576 5f77 6964 6765 742e 6974 656d 2869  ev_widget.item(i
+0005d6c0: 6478 2929 0d0a 2020 2020 2020 2020 2020  dx))..          
+0005d6d0: 2020 2020 2020 6578 6365 7074 2056 616c        except Val
+0005d6e0: 7565 4572 726f 723a 0d0a 2020 2020 2020  ueError:..      
+0005d6f0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0005d700: 7373 0d0a 2020 2020 2020 2020 2020 2020  ss..            
+0005d710: 2020 2020 7365 6c66 2e65 765f 7769 6467      self.ev_widg
+0005d720: 6574 2e69 7465 6d28 6964 7829 2e73 6574  et.item(idx).set
+0005d730: 4261 636b 6772 6f75 6e64 2851 7447 7569  Background(QtGui
+0005d740: 2e51 436f 6c6f 7228 2723 6265 6165 6434  .QColor('#beaed4
+0005d750: 2729 290d 0a20 2020 2020 2020 2065 6c73  '))..        els
+0005d760: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0005d770: 666f 7220 6964 7820 696e 2072 616e 6765  for idx in range
+0005d780: 2869 6e74 286d 6178 5f69 6478 292b 312c  (int(max_idx)+1,
+0005d790: 6e70 2e6d 6178 2873 656c 662e 6964 785f  np.max(self.idx_
+0005d7a0: 7365 6c65 6374 6564 292b 3129 3a0d 0a20  selected)+1):.. 
+0005d7b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0005d7c0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+0005d7d0: 2020 2020 2020 2020 2073 656c 662e 6576           self.ev
+0005d7e0: 5f73 656c 6563 7465 642e 7265 6d6f 7665  _selected.remove
+0005d7f0: 2873 656c 662e 6576 5f77 6964 6765 742e  (self.ev_widget.
+0005d800: 6974 656d 2869 6478 2929 0d0a 2020 2020  item(idx))..    
+0005d810: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0005d820: 7074 2056 616c 7565 4572 726f 723a 0d0a  pt ValueError:..
+0005d830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d840: 2020 2020 7061 7373 0d0a 2020 2020 2020      pass..      
+0005d850: 2020 2020 2020 2020 2020 7365 6c66 2e65            self.e
+0005d860: 765f 7769 6467 6574 2e69 7465 6d28 6964  v_widget.item(id
+0005d870: 7829 2e73 6574 4261 636b 6772 6f75 6e64  x).setBackground
+0005d880: 2851 7447 7569 2e51 436f 6c6f 7228 302c  (QtGui.QColor(0,
+0005d890: 2030 2c20 302c 2030 2929 0d0a 2020 2020   0, 0, 0))..    
+0005d8a0: 2020 2020 7365 6c66 2e52 6564 7261 774e      self.RedrawN
+0005d8b0: 6577 506c 6f74 2829 0d0a 2020 2020 6465  ewPlot()..    de
+0005d8c0: 6620 4f6e 5365 6c65 6374 416c 6c28 7365  f OnSelectAll(se
+0005d8d0: 6c66 293a 0d0a 2020 2020 2020 2020 7365  lf):..        se
+0005d8e0: 6c66 2e65 765f 7769 6467 6574 2e63 6c65  lf.ev_widget.cle
+0005d8f0: 6172 2829 0d0a 2020 2020 2020 2020 7365  ar()..        se
+0005d900: 6c66 2e53 6574 7570 4c69 7374 4556 2829  lf.SetupListEV()
+0005d910: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0005d920: 662e 636f 6d2e 7374 6163 6b5f 3464 3a0d  f.com.stack_4d:.
+0005d930: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0005d940: 662e 7468 6574 615f 7769 6467 6574 2e63  f.theta_widget.c
+0005d950: 6c65 6172 2829 0d0a 2020 2020 2020 2020  lear()..        
+0005d960: 2020 2020 7365 6c66 2e53 6574 7570 4c69      self.SetupLi
+0005d970: 7374 5468 6574 6128 290d 0a20 2020 2020  stTheta()..     
+0005d980: 2020 2073 656c 662e 7265 6769 6f6e 2e73     self.region.s
+0005d990: 6574 5265 6769 6f6e 2828 6d69 6e28 7365  etRegion((min(se
+0005d9a0: 6c66 2e73 7461 636b 2e65 7629 2c20 6d61  lf.stack.ev), ma
+0005d9b0: 7828 7365 6c66 2e73 7461 636b 2e65 7629  x(self.stack.ev)
+0005d9c0: 2929 0d0a 2020 2020 2020 2020 7365 6c66  ))..        self
+0005d9d0: 2e72 6567 696f 6e2e 7368 6f77 2829 0d0a  .region.show()..
+0005d9e0: 2020 2020 2020 2020 7365 6c66 2e52 6564          self.Red
+0005d9f0: 7261 774e 6577 506c 6f74 2829 0d0a 2020  rawNewPlot()..  
+0005da00: 2020 6465 6620 4f6e 436c 6561 7241 6c6c    def OnClearAll
+0005da10: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+0005da20: 2023 7365 6c66 2e65 765f 7769 6467 6574   #self.ev_widget
+0005da30: 2e63 6c65 6172 2829 0d0a 2020 2020 2020  .clear()..      
+0005da40: 2020 2373 656c 662e 5365 7475 704c 6973    #self.SetupLis
+0005da50: 7445 5628 290d 0a20 2020 2020 2020 2073  tEV()..        s
+0005da60: 656c 662e 7265 6769 6f6e 2e68 6964 6528  elf.region.hide(
+0005da70: 290d 0a20 2020 2020 2020 2066 6f72 2069  )..        for i
+0005da80: 6478 2069 6e20 7365 6c66 2e69 6478 5f73  dx in self.idx_s
+0005da90: 656c 6563 7465 643a 0d0a 2020 2020 2020  elected:..      
+0005daa0: 2020 2020 2020 7365 6c66 2e65 765f 7769        self.ev_wi
+0005dab0: 6467 6574 2e69 7465 6d28 6964 7829 2e73  dget.item(idx).s
+0005dac0: 6574 4261 636b 6772 6f75 6e64 2851 7447  etBackground(QtG
+0005dad0: 7569 2e51 436f 6c6f 7228 302c 2030 2c20  ui.QColor(0, 0, 
+0005dae0: 302c 2030 2929 0d0a 2020 2020 2020 2020  0, 0))..        
+0005daf0: 7365 6c66 2e65 765f 7365 6c65 6374 6564  self.ev_selected
+0005db00: 203d 205b 5d0d 0a20 2020 2020 2020 2073   = []..        s
+0005db10: 656c 662e 6964 785f 7365 6c65 6374 6564  elf.idx_selected
+0005db20: 203d 205b 5d0d 0a20 2020 2020 2020 2069   = []..        i
+0005db30: 6620 7365 6c66 2e63 6f6d 2e73 7461 636b  f self.com.stack
+0005db40: 5f34 643a 0d0a 2020 2020 2020 2020 2020  _4d:..          
+0005db50: 2020 666f 7220 6964 7820 696e 2073 656c    for idx in sel
+0005db60: 662e 7468 6574 6169 6478 5f73 656c 6563  f.thetaidx_selec
+0005db70: 7465 643a 0d0a 2020 2020 2020 2020 2020  ted:..          
+0005db80: 2020 2020 2020 7365 6c66 2e74 6865 7461        self.theta
+0005db90: 5f77 6964 6765 742e 6974 656d 2869 6478  _widget.item(idx
+0005dba0: 292e 7365 7442 6163 6b67 726f 756e 6428  ).setBackground(
+0005dbb0: 5174 4775 692e 5143 6f6c 6f72 2830 2c20  QtGui.QColor(0, 
+0005dbc0: 302c 2030 2c20 3029 290d 0a20 2020 2020  0, 0, 0))..     
+0005dbd0: 2020 2020 2020 2073 656c 662e 7468 6574         self.thet
+0005dbe0: 615f 7365 6c65 6374 6564 203d 205b 5d0d  a_selected = [].
+0005dbf0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0005dc00: 662e 7468 6574 6169 6478 5f73 656c 6563  f.thetaidx_selec
+0005dc10: 7465 6420 3d20 5b5d 0d0a 2020 2020 2020  ted = []..      
+0005dc20: 2020 7365 6c66 2e52 6564 7261 774e 6577    self.RedrawNew
+0005dc30: 506c 6f74 2829 0d0a 2020 2020 6465 6620  Plot()..    def 
+0005dc40: 5365 7475 704c 6973 7454 6865 7461 2873  SetupListTheta(s
+0005dc50: 656c 6629 3a0d 0a20 2020 2020 2020 2073  elf):..        s
+0005dc60: 656c 662e 7468 6574 615f 7365 6c65 6374  elf.theta_select
+0005dc70: 6564 203d 205b 5d0d 0a20 2020 2020 2020  ed = []..       
+0005dc80: 2073 656c 662e 7468 6574 6169 6478 5f73   self.thetaidx_s
+0005dc90: 656c 6563 7465 6420 3d20 5b5d 0d0a 2020  elected = []..  
+0005dca0: 2020 2020 2020 666f 7220 692c 6520 696e        for i,e in
+0005dcb0: 2065 6e75 6d65 7261 7465 2873 656c 662e   enumerate(self.
+0005dcc0: 7374 6163 6b2e 7468 6574 6129 3a20 2320  stack.theta): # 
+0005dcd0: 4669 6c6c 2051 4c69 7374 2077 6974 6820  Fill QList with 
+0005dce0: 656e 6572 6769 6573 0d0a 2020 2020 2020  energies..      
+0005dcf0: 2020 2020 2020 2373 656c 662e 7374 6b2e        #self.stk.
+0005dd00: 7368 6966 7473 2e61 7070 656e 6428 5b31  shifts.append([1
+0005dd10: 2c30 2c28 302e 302c 302e 3029 5d29 2023  ,0,(0.0,0.0)]) #
+0005dd20: 6368 6563 6b65 6420 5b30 2c31 5d3b 2070  checked [0,1]; p
+0005dd30: 7265 2c20 706f 7374 2c20 756e 6465 6669  re, post, undefi
+0005dd40: 6e65 6420 7374 6174 6520 666f 7220 6d61  ned state for ma
+0005dd50: 7020 5b2d 312c 312c 305d 2c28 7873 6869  p [-1,1,0],(xshi
+0005dd60: 6674 205b 666c 6f61 745d 2c79 7368 6966  ft [float],yshif
+0005dd70: 7420 5b66 6c6f 6174 5d29 0d0a 2020 2020  t [float])..    
+0005dd80: 2020 2020 2020 2020 6974 656d 203d 2051          item = Q
+0005dd90: 7457 6964 6765 7473 2e51 4c69 7374 5769  tWidgets.QListWi
+0005dda0: 6467 6574 4974 656d 2873 7472 2869 6e74  dgetItem(str(int
+0005ddb0: 2869 2929 2e7a 6669 6c6c 2833 292b 2220  (i)).zfill(3)+" 
+0005ddc0: 2020 2020 6174 2020 2020 2022 202b 2066      at     " + f
+0005ddd0: 6f72 6d61 7428 652c 2027 2e31 6627 2920  ormat(e, '.1f') 
+0005dde0: 2b20 22c2 b022 290d 0a20 2020 2020 2020  + "..")..       
+0005ddf0: 2020 2020 2073 656c 662e 7468 6574 615f       self.theta_
+0005de00: 7769 6467 6574 2e61 6464 4974 656d 2869  widget.addItem(i
+0005de10: 7465 6d29 0d0a 2020 2020 2020 2020 2020  tem)..          
+0005de20: 2020 7365 6c66 2e74 6865 7461 5f73 656c    self.theta_sel
+0005de30: 6563 7465 642e 6170 7065 6e64 2869 7465  ected.append(ite
+0005de40: 6d29 0d0a 2020 2020 2020 2020 2020 2020  m)..            
+0005de50: 7365 6c66 2e74 6865 7461 6964 785f 7365  self.thetaidx_se
+0005de60: 6c65 6374 6564 2e61 7070 656e 6428 6929  lected.append(i)
+0005de70: 0d0a 2020 2020 2020 2020 2020 2020 6974  ..            it
+0005de80: 656d 2e73 6574 4261 636b 6772 6f75 6e64  em.setBackground
+0005de90: 2851 7447 7569 2e51 436f 6c6f 7228 2723  (QtGui.QColor('#
+0005dea0: 6265 6165 6434 2729 290d 0a20 2020 2020  beaed4'))..     
+0005deb0: 2020 2020 2020 2069 7465 6d2e 7365 7446         item.setF
+0005dec0: 6f72 6567 726f 756e 6428 5174 4775 692e  oreground(QtGui.
+0005ded0: 5143 6f6c 6f72 2830 2c20 302c 2030 2c20  QColor(0, 0, 0, 
+0005dee0: 3132 3829 290d 0a20 2020 2064 6566 2053  128))..    def S
+0005def0: 6574 7570 4c69 7374 4556 2873 656c 6629  etupListEV(self)
+0005df00: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+0005df10: 6576 5f73 656c 6563 7465 6420 3d20 5b5d  ev_selected = []
+0005df20: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
+0005df30: 6478 5f73 656c 6563 7465 6420 3d20 5b5d  dx_selected = []
+0005df40: 0d0a 2020 2020 2020 2020 666f 7220 692c  ..        for i,
+0005df50: 6520 696e 2065 6e75 6d65 7261 7465 2873  e in enumerate(s
+0005df60: 656c 662e 7374 6163 6b2e 6576 293a 2023  elf.stack.ev): #
+0005df70: 2046 696c 6c20 514c 6973 7420 7769 7468   Fill QList with
+0005df80: 2065 6e65 7267 6965 730d 0a20 2020 2020   energies..     
+0005df90: 2020 2020 2020 2023 7365 6c66 2e73 746b         #self.stk
+0005dfa0: 2e73 6869 6674 732e 6170 7065 6e64 285b  .shifts.append([
+0005dfb0: 312c 302c 2830 2e30 2c30 2e30 295d 2920  1,0,(0.0,0.0)]) 
+0005dfc0: 2363 6865 636b 6564 205b 302c 315d 3b20  #checked [0,1]; 
+0005dfd0: 7072 652c 2070 6f73 742c 2075 6e64 6566  pre, post, undef
+0005dfe0: 696e 6564 2073 7461 7465 2066 6f72 206d  ined state for m
+0005dff0: 6170 205b 2d31 2c31 2c30 5d2c 2878 7368  ap [-1,1,0],(xsh
+0005e000: 6966 7420 5b66 6c6f 6174 5d2c 7973 6869  ift [float],yshi
+0005e010: 6674 205b 666c 6f61 745d 290d 0a20 2020  ft [float])..   
+0005e020: 2020 2020 2020 2020 2069 7465 6d20 3d20           item = 
+0005e030: 5174 5769 6467 6574 732e 514c 6973 7457  QtWidgets.QListW
+0005e040: 6964 6765 7449 7465 6d28 7374 7228 696e  idgetItem(str(in
+0005e050: 7428 6929 292e 7a66 696c 6c28 3329 2b22  t(i)).zfill(3)+"
+0005e060: 2020 2020 2061 7420 2020 2020 2220 2b20       at     " + 
+0005e070: 666f 726d 6174 2865 2c20 272e 3266 2729  format(e, '.2f')
+0005e080: 202b 2022 2065 5622 290d 0a20 2020 2020   + " eV")..     
+0005e090: 2020 2020 2020 2073 656c 662e 6576 5f77         self.ev_w
+0005e0a0: 6964 6765 742e 6164 6449 7465 6d28 6974  idget.addItem(it
+0005e0b0: 656d 290d 0a20 2020 2020 2020 2020 2020  em)..           
+0005e0c0: 2073 656c 662e 6576 5f73 656c 6563 7465   self.ev_selecte
+0005e0d0: 642e 6170 7065 6e64 2869 7465 6d29 0d0a  d.append(item)..
+0005e0e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0005e0f0: 2e69 6478 5f73 656c 6563 7465 642e 6170  .idx_selected.ap
+0005e100: 7065 6e64 2869 290d 0a20 2020 2020 2020  pend(i)..       
+0005e110: 2020 2020 2069 7465 6d2e 7365 7442 6163       item.setBac
+0005e120: 6b67 726f 756e 6428 5174 4775 692e 5143  kground(QtGui.QC
+0005e130: 6f6c 6f72 2827 2362 6561 6564 3427 2929  olor('#beaed4'))
+0005e140: 0d0a 2020 2020 2020 2020 2020 2020 6974  ..            it
+0005e150: 656d 2e73 6574 466f 7265 6772 6f75 6e64  em.setForeground
+0005e160: 2851 7447 7569 2e51 436f 6c6f 7228 302c  (QtGui.QColor(0,
+0005e170: 2030 2c20 302c 2031 3238 2929 0d0a 0d0a   0, 0, 128))....
+0005e180: 2020 2020 6465 6620 4f6e 5363 726f 6c6c      def OnScroll
+0005e190: 5468 6574 6128 7365 6c66 2c20 7661 6c75  Theta(self, valu
+0005e1a0: 6529 3a0d 0a20 2020 2020 2020 2073 656c  e):..        sel
+0005e1b0: 662e 736c 6964 6572 5f74 6865 7461 2e73  f.slider_theta.s
+0005e1c0: 6574 5661 6c75 6528 7661 6c75 6529 0d0a  etValue(value)..
+0005e1d0: 2020 2020 2020 2020 7365 6c66 2e52 6573          self.Res
+0005e1e0: 6574 416c 6c49 7465 6d73 2873 656c 662e  etAllItems(self.
+0005e1f0: 7468 6574 615f 7769 6467 6574 290d 0a20  theta_widget).. 
+0005e200: 2020 2020 2020 2073 656c 662e 6974 6865         self.ithe
+0005e210: 7461 203d 2076 616c 7565 0d0a 2020 2020  ta = value..    
+0005e220: 2020 2020 2373 656c 662e 7374 6163 6b2e      #self.stack.
+0005e230: 6162 7364 6174 6120 3d20 7365 6c66 2e73  absdata = self.s
+0005e240: 7461 636b 2e73 7461 636b 3444 5b3a 2c3a  tack.stack4D[:,:
+0005e250: 2c3a 2c73 656c 662e 6974 6865 7461 5d2e  ,:,self.itheta].
+0005e260: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
+0005e270: 7365 6c66 2e53 686f 7749 6d61 6765 2829  self.ShowImage()
+0005e280: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
+0005e290: 6865 7461 5f77 6964 6765 742e 7365 7443  heta_widget.setC
+0005e2a0: 7572 7265 6e74 526f 7728 7365 6c66 2e69  urrentRow(self.i
+0005e2b0: 7468 6574 6129 0d0a 2020 2020 2020 2020  theta)..        
+0005e2c0: 6966 2073 656c 662e 636f 6d2e 7374 6163  if self.com.stac
+0005e2d0: 6b5f 6c6f 6164 6564 203d 3d20 313a 0d0a  k_loaded == 1:..
+0005e2e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0005e2f0: 2e74 6865 7461 5f77 6964 6765 742e 6974  .theta_widget.it
+0005e300: 656d 2876 616c 7565 292e 7365 7446 6f72  em(value).setFor
+0005e310: 6567 726f 756e 6428 5174 4775 692e 5143  eground(QtGui.QC
+0005e320: 6f6c 6f72 2830 2c20 302c 2030 2c20 3235  olor(0, 0, 0, 25
+0005e330: 3529 290d 0a20 2020 2020 2020 2073 656c  5))..        sel
+0005e340: 662e 5265 6472 6177 506c 6f74 7328 290d  f.RedrawPlots().
+0005e350: 0a20 2020 2064 6566 204f 6e53 6372 6f6c  .    def OnScrol
+0005e360: 6c45 6e67 2873 656c 662c 2076 616c 7565  lEng(self, value
+0005e370: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+0005e380: 2e73 6c69 6465 725f 656e 672e 7365 7456  .slider_eng.setV
+0005e390: 616c 7565 2876 616c 7565 290d 0a20 2020  alue(value)..   
+0005e3a0: 2020 2020 2073 656c 662e 5265 7365 7441       self.ResetA
+0005e3b0: 6c6c 4974 656d 7328 7365 6c66 2e65 765f  llItems(self.ev_
+0005e3c0: 7769 6467 6574 290d 0a20 2020 2020 2020  widget)..       
+0005e3d0: 2073 656c 662e 6965 7620 3d20 7661 6c75   self.iev = valu
+0005e3e0: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+0005e3f0: 5368 6f77 496d 6167 6528 290d 0a20 2020  ShowImage()..   
+0005e400: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+0005e410: 2020 2020 2020 2073 656c 662e 7265 666d         self.refm
+0005e420: 6172 6b65 722e 7365 7456 616c 7565 2873  arker.setValue(s
+0005e430: 656c 662e 7374 6163 6b2e 6576 5b73 656c  elf.stack.ev[sel
+0005e440: 662e 6965 765d 290d 0a20 2020 2020 2020  f.iev])..       
+0005e450: 2065 7863 6570 743a 0d0a 2020 2020 2020   except:..      
+0005e460: 2020 2020 2020 7061 7373 0d0a 2020 2020        pass..    
+0005e470: 2020 2020 7365 6c66 2e65 765f 7769 6467      self.ev_widg
+0005e480: 6574 2e73 6574 4375 7272 656e 7452 6f77  et.setCurrentRow
+0005e490: 2873 656c 662e 6965 7629 0d0a 2020 2020  (self.iev)..    
+0005e4a0: 2020 2020 6966 2073 656c 662e 636f 6d2e      if self.com.
+0005e4b0: 7374 6163 6b5f 6c6f 6164 6564 203d 3d20  stack_loaded == 
+0005e4c0: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+0005e4d0: 7365 6c66 2e65 765f 7769 6467 6574 2e69  self.ev_widget.i
+0005e4e0: 7465 6d28 7661 6c75 6529 2e73 6574 466f  tem(value).setFo
+0005e4f0: 7265 6772 6f75 6e64 2851 7447 7569 2e51  reground(QtGui.Q
+0005e500: 436f 6c6f 7228 302c 2030 2c20 302c 2032  Color(0, 0, 0, 2
+0005e510: 3535 2929 0d0a 2020 2020 6465 6620 5368  55))..    def Sh
+0005e520: 6f77 496d 6167 6528 7365 6c66 293a 0d0a  owImage(self):..
+0005e530: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0005e540: 636f 6d2e 7374 6163 6b5f 3464 203d 3d20  com.stack_4d == 
+0005e550: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+0005e560: 7365 6c66 2e69 5f69 7465 6d2e 7365 7449  self.i_item.setI
+0005e570: 6d61 6765 2873 656c 662e 7374 6163 6b2e  mage(self.stack.
+0005e580: 7374 6163 6b34 445b 3a2c 203a 2c20 696e  stack4D[:, :, in
+0005e590: 7428 7365 6c66 2e69 6576 292c 696e 7428  t(self.iev),int(
+0005e5a0: 7365 6c66 2e69 7468 6574 6129 5d29 0d0a  self.itheta)])..
+0005e5b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0005e5c0: 2e67 726f 7570 426f 782e 7365 7454 6974  .groupBox.setTit
+0005e5d0: 6c65 2873 7472 2827 5374 6163 6b20 4272  le(str('Stack Br
+0005e5e0: 6f77 7365 7220 7c20 496d 6167 6520 6174  owser | Image at
+0005e5f0: 207b 303a 352e 3266 7d20 6556 2061 6e64   {0:5.2f} eV and
+0005e600: 207b 313a 352e 3166 7dc2 b027 292e 666f   {1:5.1f}..').fo
+0005e610: 726d 6174 2866 6c6f 6174 2873 656c 662e  rmat(float(self.
+0005e620: 7374 6163 6b2e 6576 5b73 656c 662e 6965  stack.ev[self.ie
+0005e630: 765d 292c 666c 6f61 7428 7365 6c66 2e73  v]),float(self.s
+0005e640: 7461 636b 2e74 6865 7461 5b73 656c 662e  tack.theta[self.
+0005e650: 6974 6865 7461 5d29 2c20 2929 0d0a 2020  itheta]), ))..  
+0005e660: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0005e670: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0005e680: 2e63 6f6d 2e69 305f 6c6f 6164 6564 3a0d  .com.i0_loaded:.
+0005e690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005e6a0: 2073 656c 662e 695f 6974 656d 2e73 6574   self.i_item.set
+0005e6b0: 496d 6167 6528 7365 6c66 2e73 7461 636b  Image(self.stack
+0005e6c0: 2e6f 6433 645b 3a2c 203a 2c20 696e 7428  .od3d[:, :, int(
+0005e6d0: 7365 6c66 2e69 6576 295d 290d 0a20 2020  self.iev)])..   
+0005e6e0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0005e6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e700: 7365 6c66 2e69 5f69 7465 6d2e 7365 7449  self.i_item.setI
+0005e710: 6d61 6765 2873 656c 662e 7374 6163 6b2e  mage(self.stack.
+0005e720: 6162 7364 6174 615b 3a2c 203a 2c20 696e  absdata[:, :, in
+0005e730: 7428 7365 6c66 2e69 6576 295d 290d 0a20  t(self.iev)]).. 
+0005e740: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0005e750: 6772 6f75 7042 6f78 2e73 6574 5469 746c  groupBox.setTitl
+0005e760: 6528 7374 7228 2753 7461 636b 2042 726f  e(str('Stack Bro
+0005e770: 7773 6572 207c 2049 6d61 6765 2061 7420  wser | Image at 
+0005e780: 7b30 3a35 2e32 667d 2065 5627 292e 666f  {0:5.2f} eV').fo
+0005e790: 726d 6174 2866 6c6f 6174 2873 656c 662e  rmat(float(self.
+0005e7a0: 7374 6163 6b2e 6576 5b73 656c 662e 6965  stack.ev[self.ie
+0005e7b0: 765d 2929 290d 0a0d 0a20 2020 2023 2320  v])))....    ## 
+0005e7c0: 5365 7475 7020 6120 524f 4920 666f 7220  Setup a ROI for 
+0005e7d0: 616e 2061 6c69 676e 6d65 6e74 2072 6563  an alignment rec
+0005e7e0: 7461 6e67 6c65 2e20 4279 2064 6566 6175  tangle. By defau
+0005e7f0: 6c74 2074 6865 2077 686f 6c65 2069 6d61  lt the whole ima
+0005e800: 6765 2061 7265 6120 6973 2075 7365 642e  ge area is used.
+0005e810: 0d0a 2020 2020 6465 6620 5365 7475 7052  ..    def SetupR
+0005e820: 4f49 2873 656c 6629 3a0d 0a20 2020 2020  OI(self):..     
+0005e830: 2020 2023 7365 6c66 2e73 7461 636b 2e61     #self.stack.a
+0005e840: 6273 6461 7461 203d 2073 656c 662e 7374  bsdata = self.st
+0005e850: 6163 6b2e 6162 7364 6174 612e 636f 7079  ack.absdata.copy
+0005e860: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+0005e870: 2e62 6f78 203d 2070 672e 5265 6374 524f  .box = pg.RectRO
+0005e880: 4928 7365 6c66 2e69 5f69 7465 6d2e 626f  I(self.i_item.bo
+0005e890: 756e 6469 6e67 5265 6374 2829 2e74 6f70  undingRect().top
+0005e8a0: 4c65 6674 2829 2c20 7365 6c66 2e69 5f69  Left(), self.i_i
+0005e8b0: 7465 6d2e 626f 756e 6469 6e67 5265 6374  tem.boundingRect
+0005e8c0: 2829 2e62 6f74 746f 6d52 6967 6874 2829  ().bottomRight()
+0005e8d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0005e8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e8f0: 2070 656e 3d28 352c 2038 292c 2068 616e   pen=(5, 8), han
+0005e900: 646c 6550 656e 3d51 7447 7569 2e51 5065  dlePen=QtGui.QPe
+0005e910: 6e28 5174 4775 692e 5143 6f6c 6f72 2832  n(QtGui.QColor(2
+0005e920: 3535 2c20 302c 2031 3238 2c20 3235 3529  55, 0, 128, 255)
+0005e930: 292c 2063 656e 7465 7265 643d 4661 6c73  ), centered=Fals
+0005e940: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0005e950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e960: 2020 7369 6465 5363 616c 6572 733d 4661    sideScalers=Fa
+0005e970: 6c73 652c 2072 656d 6f76 6162 6c65 3d46  lse, removable=F
+0005e980: 616c 7365 2c20 7363 616c 6553 6e61 703d  alse, scaleSnap=
+0005e990: 5472 7565 2c20 7472 616e 736c 6174 6553  True, translateS
+0005e9a0: 6e61 703d 5472 7565 2c0d 0a20 2020 2020  nap=True,..     
+0005e9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e9c0: 2020 2020 2020 2020 206d 6178 426f 756e           maxBoun
+0005e9d0: 6473 3d73 656c 662e 695f 6974 656d 2e62  ds=self.i_item.b
+0005e9e0: 6f75 6e64 696e 6752 6563 7428 2929 0d0a  oundingRect())..
+0005e9f0: 2020 2020 2020 2020 7365 6c66 2e76 622e          self.vb.
+0005ea00: 6164 6449 7465 6d28 7365 6c66 2e62 6f78  addItem(self.box
+0005ea10: 2c20 6967 6e6f 7265 426f 756e 6473 3d46  , ignoreBounds=F
+0005ea20: 616c 7365 290d 0a20 2020 2020 2020 2073  alse)..        s
+0005ea30: 656c 662e 626f 782e 7369 6752 6567 696f  elf.box.sigRegio
+0005ea40: 6e43 6861 6e67 6546 696e 6973 6865 642e  nChangeFinished.
+0005ea50: 636f 6e6e 6563 7428 7365 6c66 2e52 6564  connect(self.Red
+0005ea60: 7261 7750 6c6f 7473 290d 0a20 2020 2020  rawPlots)..     
+0005ea70: 2020 2073 656c 662e 626f 782e 7369 6752     self.box.sigR
+0005ea80: 6567 696f 6e43 6861 6e67 6553 7461 7274  egionChangeStart
+0005ea90: 6564 2e63 6f6e 6e65 6374 2873 656c 662e  ed.connect(self.
+0005eaa0: 4f6e 426f 7843 6861 6e67 696e 6729 0d0a  OnBoxChanging)..
+0005eab0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
+0005eac0: 746f 6e5f 7273 7472 6f69 2e63 6c69 636b  ton_rstroi.click
+0005ead0: 6564 2e63 6f6e 6e65 6374 2873 656c 662e  ed.connect(self.
+0005eae0: 4f6e 5265 7365 7452 4f49 290d 0a20 2020  OnResetROI)..   
+0005eaf0: 2023 2320 5468 6520 524f 4920 6973 206c   ## The ROI is l
+0005eb00: 696d 6974 6564 2074 6f20 7468 6520 7669  imited to the vi
+0005eb10: 7369 626c 6520 696d 6167 6520 6172 6561  sible image area
+0005eb20: 2e20 4f6e 4d6f 7573 654d 6f76 654f 7574  . OnMouseMoveOut
+0005eb30: 7369 6465 2068 616e 646c 6573 2074 6865  side handles the
+0005eb40: 2062 6568 6176 696f 7220 7768 656e 0d0a   behavior when..
+0005eb50: 2020 2020 6465 6620 4f6e 5265 7365 7452      def OnResetR
+0005eb60: 4f49 2873 656c 6629 3a0d 0a20 2020 2020  OI(self):..     
+0005eb70: 2020 2073 656c 662e 626f 782e 7365 7450     self.box.setP
+0005eb80: 6f73 2830 2c20 302c 2075 7064 6174 653d  os(0, 0, update=
+0005eb90: 4661 6c73 652c 2066 696e 6973 683d 4661  False, finish=Fa
+0005eba0: 6c73 6529 0d0a 2020 2020 2020 2020 7365  lse)..        se
+0005ebb0: 6c66 2e62 6f78 2e73 6574 5369 7a65 2873  lf.box.setSize(s
+0005ebc0: 656c 662e 695f 6974 656d 2e62 6f75 6e64  elf.i_item.bound
+0005ebd0: 696e 6752 6563 7428 292e 626f 7474 6f6d  ingRect().bottom
+0005ebe0: 5269 6768 7428 2920 2d20 7365 6c66 2e62  Right() - self.b
+0005ebf0: 6f78 2e70 6f73 2829 2c20 7570 6461 7465  ox.pos(), update
+0005ec00: 3d54 7275 652c 2073 6e61 703d 5472 7565  =True, snap=True
+0005ec10: 2c20 6669 6e69 7368 3d54 7275 6529 0d0a  , finish=True)..
+0005ec20: 2020 2020 2020 2020 7365 6c66 2e62 6f78          self.box
+0005ec30: 2e73 686f 7728 290d 0a20 2020 2064 6566  .show()..    def
+0005ec40: 204f 6e42 6f78 4368 616e 6769 6e67 2873   OnBoxChanging(s
+0005ec50: 656c 6629 3a0d 0a20 2020 2020 2020 2073  elf):..        s
+0005ec60: 656c 662e 626f 7873 697a 6520 3d20 7365  elf.boxsize = se
+0005ec70: 6c66 2e62 6f78 2e73 697a 6528 290d 0a20  lf.box.size().. 
+0005ec80: 2020 2020 2020 2073 656c 662e 7072 6f78         self.prox
+0005ec90: 7920 3d20 7067 2e53 6967 6e61 6c50 726f  y = pg.SignalPro
+0005eca0: 7879 2873 656c 662e 7662 2e73 6365 6e65  xy(self.vb.scene
+0005ecb0: 2829 2e73 6967 4d6f 7573 654d 6f76 6564  ().sigMouseMoved
+0005ecc0: 2c20 7261 7465 4c69 6d69 743d 3330 2c20  , rateLimit=30, 
+0005ecd0: 736c 6f74 3d73 656c 662e 4f6e 4d6f 7573  slot=self.OnMous
+0005ece0: 654d 6f76 654f 7574 7369 6465 290d 0a20  eMoveOutside).. 
+0005ecf0: 2020 2064 6566 2047 6574 5265 6769 6f6e     def GetRegion
+0005ed00: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+0005ed10: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+0005ed20: 2020 2073 656c 662e 7072 6f78 792e 6469     self.proxy.di
+0005ed30: 7363 6f6e 6e65 6374 2829 0d0a 2020 2020  sconnect()..    
+0005ed40: 2020 2020 6578 6365 7074 2041 7474 7269      except Attri
+0005ed50: 6275 7465 4572 726f 723a 0d0a 2020 2020  buteError:..    
+0005ed60: 2020 2020 2020 2020 7061 7373 0d0a 2020          pass..  
+0005ed70: 2020 2020 2020 6c65 6674 203d 2069 6e74        left = int
+0005ed80: 2873 656c 662e 626f 782e 706f 7328 292e  (self.box.pos().
+0005ed90: 7828 2929 0d0a 2020 2020 2020 2020 7269  x())..        ri
+0005eda0: 6768 7420 3d20 6c65 6674 202b 2069 6e74  ght = left + int
+0005edb0: 2873 656c 662e 626f 782e 7369 7a65 2829  (self.box.size()
+0005edc0: 2e78 2829 290d 0a20 2020 2020 2020 2062  .x())..        b
+0005edd0: 6f74 746f 6d20 3d20 696e 7428 7365 6c66  ottom = int(self
+0005ede0: 2e62 6f78 2e70 6f73 2829 2e79 2829 290d  .box.pos().y()).
+0005edf0: 0a20 2020 2020 2020 2074 6f70 203d 2062  .        top = b
+0005ee00: 6f74 746f 6d20 2b20 696e 7428 7365 6c66  ottom + int(self
+0005ee10: 2e62 6f78 2e73 697a 6528 292e 7928 2929  .box.size().y())
+0005ee20: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0005ee30: 2028 6c65 6674 2c72 6967 6874 2c74 6f70   (left,right,top
+0005ee40: 2c62 6f74 746f 6d29 0d0a 0d0a 2020 2020  ,bottom)....    
+0005ee50: 6465 6620 4765 6e65 7261 7465 5370 6563  def GenerateSpec
+0005ee60: 7472 756d 2873 656c 662c 2065 7673 656c  trum(self, evsel
+0005ee70: 6563 7469 6f6e 293a 0d0a 2020 2020 2020  ection):..      
+0005ee80: 2020 6c65 6674 2c72 6967 6874 2c74 6f70    left,right,top
+0005ee90: 2c62 6f74 746f 6d20 3d20 7365 6c66 2e47  ,bottom = self.G
+0005eea0: 6574 5265 6769 6f6e 2829 0d0a 2020 2020  etRegion()..    
+0005eeb0: 2020 2020 6966 2073 656c 662e 636f 6d2e      if self.com.
+0005eec0: 6930 5f6c 6f61 6465 6420 3d3d 2031 3a0d  i0_loaded == 1:.
+0005eed0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0005eee0: 7365 6c66 2e63 6f6d 2e73 7461 636b 5f34  self.com.stack_4
+0005eef0: 6420 3d3d 2031 3a0d 0a20 2020 2020 2020  d == 1:..       
+0005ef00: 2020 2020 2020 2020 2074 6f74 616c 203d           total =
+0005ef10: 2073 656c 662e 7374 6163 6b2e 6f64 3464   self.stack.od4d
+0005ef20: 5b6c 6566 743a 7269 6768 742c 2062 6f74  [left:right, bot
+0005ef30: 746f 6d3a 746f 702c 203a 2c20 696e 7428  tom:top, :, int(
+0005ef40: 7365 6c66 2e69 7468 6574 6129 5d2e 636f  self.itheta)].co
+0005ef50: 7079 2829 0d0a 2020 2020 2020 2020 2020  py()..          
+0005ef60: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0005ef70: 2020 2020 2020 2020 2074 6f74 616c 203d           total =
+0005ef80: 2073 656c 662e 7374 6163 6b2e 6f64 3364   self.stack.od3d
+0005ef90: 5b6c 6566 743a 7269 6768 742c 2062 6f74  [left:right, bot
+0005efa0: 746f 6d3a 746f 702c 203a 5d2e 636f 7079  tom:top, :].copy
+0005efb0: 2829 0d0a 0d0a 2020 2020 2020 2020 656c  ()....        el
+0005efc0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0005efd0: 2069 6620 7365 6c66 2e63 6f6d 2e73 7461   if self.com.sta
+0005efe0: 636b 5f34 6420 3d3d 2031 3a0d 0a20 2020  ck_4d == 1:..   
+0005eff0: 2020 2020 2020 2020 2020 2020 2074 203d               t =
+0005f000: 205b 7365 6c66 2e73 7461 636b 2e74 6865   [self.stack.the
+0005f010: 7461 5b69 5d20 666f 7220 6920 696e 2073  ta[i] for i in s
+0005f020: 656c 662e 7468 6574 6169 6478 5f73 656c  elf.thetaidx_sel
+0005f030: 6563 7465 645d 0d0a 2020 2020 2020 2020  ected]..        
+0005f040: 2020 2020 2020 2020 7365 6c66 2e6c 6162          self.lab
+0005f050: 656c 5f74 6865 7461 5f72 616e 6765 2e73  el_theta_range.s
+0005f060: 6574 5465 7874 280d 0a20 2020 2020 2020  etText(..       
+0005f070: 2020 2020 2020 2020 2020 2020 2022 5468               "Th
+0005f080: 6574 6120 7261 6e67 653a 205b 2022 202b  eta range: [ " +
+0005f090: 2073 7472 286d 696e 2874 2c20 6465 6661   str(min(t, defa
+0005f0a0: 756c 743d 3029 2920 2b20 22c2 b020 2e2e  ult=0)) + ".. ..
+0005f0b0: 2022 202b 2073 7472 280d 0a20 2020 2020   " + str(..     
+0005f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f0d0: 2020 206d 6178 2874 2c20 6465 6661 756c     max(t, defaul
+0005f0e0: 743d 3029 2920 2b20 22c2 b020 5d2c 2023  t=0)) + ".. ], #
+0005f0f0: 2076 616c 7565 733a 2022 202b 2073 7472   values: " + str
+0005f100: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0005f110: 2020 2020 2020 2020 2020 206c 656e 2874             len(t
+0005f120: 2929 290d 0a20 2020 2020 2020 2020 2020  )))..           
+0005f130: 2020 2020 2074 6f74 616c 203d 2073 656c       total = sel
+0005f140: 662e 7374 6163 6b2e 7374 6163 6b34 445b  f.stack.stack4D[
+0005f150: 6c65 6674 3a72 6967 6874 2c20 626f 7474  left:right, bott
+0005f160: 6f6d 3a74 6f70 2c20 3a2c 2069 6e74 2873  om:top, :, int(s
+0005f170: 656c 662e 6974 6865 7461 295d 2e63 6f70  elf.itheta)].cop
+0005f180: 7928 290d 0a20 2020 2020 2020 2020 2020  y()..           
+0005f190: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0005f1a0: 2020 2020 2020 2020 746f 7461 6c20 3d20          total = 
+0005f1b0: 7365 6c66 2e73 7461 636b 2e61 6273 6461  self.stack.absda
+0005f1c0: 7461 5b6c 6566 743a 7269 6768 742c 2062  ta[left:right, b
+0005f1d0: 6f74 746f 6d3a 746f 702c 203a 5d2e 636f  ottom:top, :].co
+0005f1e0: 7079 2829 0d0a 2020 2020 2020 2020 746f  py()..        to
+0005f1f0: 7461 6c20 3d20 746f 7461 6c2e 7375 6d28  tal = total.sum(
+0005f200: 6178 6973 3d28 302c 3129 2920 2f20 2869  axis=(0,1)) / (i
+0005f210: 6e74 2873 656c 662e 626f 782e 7369 7a65  nt(self.box.size
+0005f220: 2829 2e78 2829 2920 2a20 696e 7428 7365  ().x()) * int(se
+0005f230: 6c66 2e62 6f78 2e73 697a 6528 292e 7928  lf.box.size().y(
+0005f240: 2929 290d 0a20 2020 2020 2020 2078 203d  )))..        x =
+0005f250: 205b 7365 6c66 2e73 7461 636b 2e65 765b   [self.stack.ev[
+0005f260: 695d 2066 6f72 2069 2069 6e20 6576 7365  i] for i in evse
+0005f270: 6c65 6374 696f 6e5d 0d0a 2020 2020 2020  lection]..      
+0005f280: 2020 7920 3d20 5b74 6f74 616c 5b69 5d20    y = [total[i] 
+0005f290: 666f 7220 6920 696e 2065 7673 656c 6563  for i in evselec
+0005f2a0: 7469 6f6e 5d0d 0a20 2020 2020 2020 2073  tion]..        s
+0005f2b0: 656c 662e 6c61 6265 6c5f 7370 6174 6961  elf.label_spatia
+0005f2c0: 6c5f 7261 6e67 652e 7365 7454 6578 7428  l_range.setText(
+0005f2d0: 2253 7461 636b 2073 697a 653a 205b 2022  "Stack size: [ "
+0005f2e0: 2b73 7472 2869 6e74 2873 656c 662e 626f  +str(int(self.bo
+0005f2f0: 782e 7369 7a65 2829 2e78 2829 2929 2b22  x.size().x()))+"
+0005f300: 2078 2022 2b73 7472 2869 6e74 2873 656c   x "+str(int(sel
+0005f310: 662e 626f 782e 7369 7a65 2829 2e79 2829  f.box.size().y()
+0005f320: 2929 2b22 205d 2070 78c2 b222 290d 0a20  ))+" ] px..").. 
+0005f330: 2020 2020 2020 2073 656c 662e 6c61 6265         self.labe
+0005f340: 6c5f 6576 5f72 616e 6765 2e73 6574 5465  l_ev_range.setTe
+0005f350: 7874 280d 0a20 2020 2020 2020 2020 2020  xt(..           
+0005f360: 2022 456e 6572 6779 2072 616e 6765 3a20   "Energy range: 
+0005f370: 5b20 2220 2b20 7374 7228 6d69 6e28 782c  [ " + str(min(x,
+0005f380: 2064 6566 6175 6c74 3d30 2929 202b 2022   default=0)) + "
+0005f390: 202e 2e20 2220 2b20 7374 7228 6d61 7828   .. " + str(max(
+0005f3a0: 782c 2064 6566 6175 6c74 3d30 2929 202b  x, default=0)) +
+0005f3b0: 2022 205d 2065 562c 2023 2076 616c 7565   " ] eV, # value
+0005f3c0: 733a 2022 2b20 7374 7228 6c65 6e28 7829  s: "+ str(len(x)
+0005f3d0: 2929 0d0a 2020 2020 2020 2020 7265 7475  ))..        retu
+0005f3e0: 726e 2028 782c 2079 290d 0a0d 0a20 2020  rn (x, y)....   
+0005f3f0: 2064 6566 2052 6573 6574 416c 6c49 7465   def ResetAllIte
+0005f400: 6d73 2873 656c 662c 7769 6467 6574 293a  ms(self,widget):
+0005f410: 0d0a 2020 2020 2020 2020 666f 7220 6920  ..        for i 
+0005f420: 696e 2072 616e 6765 2877 6964 6765 742e  in range(widget.
+0005f430: 636f 756e 7428 2929 3a0d 0a20 2020 2020  count()):..     
+0005f440: 2020 2020 2020 2077 6964 6765 742e 6974         widget.it
+0005f450: 656d 2869 292e 7365 7446 6f72 6567 726f  em(i).setForegro
+0005f460: 756e 6428 5174 4775 692e 5143 6f6c 6f72  und(QtGui.QColor
+0005f470: 2830 2c20 302c 2030 2c20 3132 3829 290d  (0, 0, 0, 128)).
+0005f480: 0a0d 0a20 2020 2064 6566 204f 6e4d 6f75  ...    def OnMou
+0005f490: 7365 4d6f 7665 4f75 7473 6964 6528 7365  seMoveOutside(se
+0005f4a0: 6c66 2c20 6576 293a 0d0a 2020 2020 2020  lf, ev):..      
+0005f4b0: 2020 6d6f 7573 6570 6f73 203d 2073 656c    mousepos = sel
+0005f4c0: 662e 7662 2e6d 6170 5363 656e 6554 6f56  f.vb.mapSceneToV
+0005f4d0: 6965 7728 6576 5b30 5d29 0d0a 2020 2020  iew(ev[0])..    
+0005f4e0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+0005f4f0: 7662 2e69 7465 6d42 6f75 6e64 696e 6752  vb.itemBoundingR
+0005f500: 6563 7428 7365 6c66 2e69 5f69 7465 6d29  ect(self.i_item)
+0005f510: 2e63 6f6e 7461 696e 7328 6d6f 7573 6570  .contains(mousep
+0005f520: 6f73 293a 0d0a 2020 2020 2020 2020 2020  os):..          
+0005f530: 2020 6d61 7872 6563 7420 3d20 7365 6c66    maxrect = self
+0005f540: 2e69 5f69 7465 6d2e 626f 756e 6469 6e67  .i_item.bounding
+0005f550: 5265 6374 2829 2e62 6f74 746f 6d52 6967  Rect().bottomRig
+0005f560: 6874 2829 0d0a 2020 2020 2020 2020 2020  ht()..          
+0005f570: 2020 2320 6966 2062 6f75 6e64 7320 6578    # if bounds ex
+0005f580: 6365 6564 6564 0d0a 2020 2020 2020 2020  ceeded..        
+0005f590: 2020 2020 6f75 745f 7820 3d20 6d61 7828      out_x = max(
+0005f5a0: 286d 6f75 7365 706f 732d 6d61 7872 6563  (mousepos-maxrec
+0005f5b0: 7429 2e78 2829 2c30 290d 0a20 2020 2020  t).x(),0)..     
+0005f5c0: 2020 2020 2020 206f 7574 5f79 203d 206d         out_y = m
+0005f5d0: 6178 2828 6d6f 7573 6570 6f73 2d6d 6178  ax((mousepos-max
+0005f5e0: 7265 6374 292e 7928 292c 2030 290d 0a20  rect).y(), 0).. 
+0005f5f0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0005f600: 6c66 2e62 6f78 2e73 697a 6528 2920 213d  lf.box.size() !=
+0005f610: 2073 656c 662e 626f 7873 697a 653a 2023   self.boxsize: #
+0005f620: 2070 7265 7665 6e74 7320 7461 6b69 6e67   prevents taking
+0005f630: 2061 6374 696f 6e20 7768 656e 2074 6865   action when the
+0005f640: 2062 6f78 2069 7320 6a75 7374 2064 7261   box is just dra
+0005f650: 6767 6564 2061 6e64 206e 6f74 2072 6573  gged and not res
+0005f660: 697a 6564 0d0a 2020 2020 2020 2020 2020  ized..          
+0005f670: 2020 2020 2020 6966 206f 7574 5f78 2061        if out_x a
+0005f680: 6e64 206f 7574 5f79 3a0d 0a20 2020 2020  nd out_y:..     
+0005f690: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0005f6a0: 656c 662e 626f 782e 7365 7453 697a 6528  elf.box.setSize(
+0005f6b0: 7365 6c66 2e69 5f69 7465 6d2e 626f 756e  self.i_item.boun
+0005f6c0: 6469 6e67 5265 6374 2829 2e62 6f74 746f  dingRect().botto
+0005f6d0: 6d52 6967 6874 2829 2d73 656c 662e 626f  mRight()-self.bo
+0005f6e0: 782e 706f 7328 292c 2075 7064 6174 653d  x.pos(), update=
+0005f6f0: 5472 7565 2c20 736e 6170 3d54 7275 652c  True, snap=True,
+0005f700: 2066 696e 6973 683d 4661 6c73 6529 0d0a   finish=False)..
+0005f710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f720: 656c 6966 206f 7574 5f78 3a0d 0a20 2020  elif out_x:..   
+0005f730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f740: 2073 656c 662e 626f 782e 7365 7453 697a   self.box.setSiz
+0005f750: 6528 5b73 656c 662e 695f 6974 656d 2e62  e([self.i_item.b
+0005f760: 6f75 6e64 696e 6752 6563 7428 292e 7269  oundingRect().ri
+0005f770: 6768 7428 292d 7365 6c66 2e62 6f78 2e70  ght()-self.box.p
+0005f780: 6f73 2829 2e78 2829 2c6d 6f75 7365 706f  os().x(),mousepo
+0005f790: 732e 7928 292d 7365 6c66 2e62 6f78 2e70  s.y()-self.box.p
+0005f7a0: 6f73 2829 2e79 2829 5d2c 2075 7064 6174  os().y()], updat
+0005f7b0: 653d 5472 7565 2c20 736e 6170 3d54 7275  e=True, snap=Tru
+0005f7c0: 652c 2066 696e 6973 683d 4661 6c73 6529  e, finish=False)
+0005f7d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005f7e0: 2020 656c 6966 206f 7574 5f79 3a0d 0a20    elif out_y:.. 
+0005f7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f800: 2020 2073 656c 662e 626f 782e 7365 7453     self.box.setS
+0005f810: 697a 6528 5b6d 6f75 7365 706f 732e 7828  ize([mousepos.x(
+0005f820: 292d 7365 6c66 2e62 6f78 2e70 6f73 2829  )-self.box.pos()
+0005f830: 2e78 2829 2c73 656c 662e 695f 6974 656d  .x(),self.i_item
+0005f840: 2e62 6f75 6e64 696e 6752 6563 7428 292e  .boundingRect().
+0005f850: 626f 7474 6f6d 2829 2d73 656c 662e 626f  bottom()-self.bo
+0005f860: 782e 706f 7328 292e 7928 295d 2c20 7570  x.pos().y()], up
+0005f870: 6461 7465 3d54 7275 652c 2073 6e61 703d  date=True, snap=
+0005f880: 5472 7565 2c20 6669 6e69 7368 3d46 616c  True, finish=Fal
+0005f890: 7365 290d 0a20 2020 2023 202d 2d2d 2d2d  se)..    # -----
+0005f8a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005f8b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005f8c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 0005f8d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005f8e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005f8f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0005f900: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020  -----------..   
-0005f910: 2064 6566 204f 6e41 6363 6570 7428 7365   def OnAccept(se
-0005f920: 6c66 2c20 6576 7429 3a0d 0a20 2020 2020  lf, evt):..     
-0005f930: 2020 2069 6620 7365 6c66 2e63 625f 6372     if self.cb_cr
-0005f940: 6f70 746f 726f 692e 6973 4368 6563 6b65  optoroi.isChecke
-0005f950: 6428 293a 0d0a 2020 2020 2020 2020 2020  d():..          
-0005f960: 2020 6c65 6674 2c20 7269 6768 742c 2074    left, right, t
-0005f970: 6f70 2c20 626f 7474 6f6d 203d 2073 656c  op, bottom = sel
-0005f980: 662e 4765 7452 6567 696f 6e28 290d 0a20  f.GetRegion().. 
-0005f990: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0005f9a0: 2020 2020 2020 2020 2020 6c65 6674 2c20            left, 
-0005f9b0: 7269 6768 742c 2074 6f70 2c20 626f 7474  right, top, bott
-0005f9c0: 6f6d 203d 2028 4e6f 6e65 2c4e 6f6e 652c  om = (None,None,
-0005f9d0: 4e6f 6e65 2c4e 6f6e 6529 0d0a 0d0a 2020  None,None)....  
-0005f9e0: 2020 2020 2020 6966 2073 656c 662e 6362        if self.cb
-0005f9f0: 5f72 656d 6f76 655f 6576 732e 6973 4368  _remove_evs.isCh
-0005fa00: 6563 6b65 6428 293a 0d0a 2020 2020 2020  ecked():..      
-0005fa10: 2020 2020 2020 7365 6c65 6374 696f 6e20        selection 
-0005fa20: 3d20 7365 6c66 2e69 6478 5f73 656c 6563  = self.idx_selec
-0005fa30: 7465 640d 0a20 2020 2020 2020 2020 2020  ted..           
-0005fa40: 2069 6620 6c65 6e28 7365 6c65 6374 696f   if len(selectio
-0005fa50: 6e29 203d 3d20 303a 0d0a 2020 2020 2020  n) == 0:..      
-0005fa60: 2020 2020 2020 2020 2020 5174 5769 6467            QtWidg
-0005fa70: 6574 732e 514d 6573 7361 6765 426f 782e  ets.QMessageBox.
-0005fa80: 7761 726e 696e 6728 7365 6c66 2c20 2745  warning(self, 'E
-0005fa90: 7272 6f72 272c 2027 506c 6561 7365 2073  rror', 'Please s
-0005faa0: 656c 6563 7420 6174 206c 6561 7374 206f  elect at least o
-0005fab0: 6e65 2065 6e65 7267 7920 7661 6c75 6521  ne energy value!
-0005fac0: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
-0005fad0: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
-0005fae0: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
-0005faf0: 636b 2e6e 5f65 7620 3d20 6e70 2e61 7272  ck.n_ev = np.arr
-0005fb00: 6179 286c 656e 2873 656c 6563 7469 6f6e  ay(len(selection
-0005fb10: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0005fb20: 7365 6c66 2e73 7461 636b 2e65 7620 3d20  self.stack.ev = 
-0005fb30: 7365 6c66 2e73 7461 636b 2e65 765b 7365  self.stack.ev[se
-0005fb40: 6c65 6374 696f 6e5d 0d0a 2020 2020 2020  lection]..      
-0005fb50: 2020 2020 2020 7365 6c66 2e73 7461 636b        self.stack
-0005fb60: 2e64 6174 615f 6477 656c 6c20 3d20 7365  .data_dwell = se
-0005fb70: 6c66 2e73 7461 636b 2e64 6174 615f 6477  lf.stack.data_dw
-0005fb80: 656c 6c5b 7365 6c65 6374 696f 6e5d 0d0a  ell[selection]..
-0005fb90: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0005fba0: 2020 2020 2020 2020 2020 2073 656c 6563             selec
-0005fbb0: 7469 6f6e 203d 206c 6973 7428 7261 6e67  tion = list(rang
-0005fbc0: 6528 7365 6c66 2e73 7461 636b 2e6e 5f65  e(self.stack.n_e
-0005fbd0: 7629 290d 0a0d 0a0d 0a20 2020 2020 2020  v))......       
-0005fbe0: 2073 656c 662e 7374 6163 6b2e 6162 7364   self.stack.absd
-0005fbf0: 6174 6120 3d20 7365 6c66 2e73 7461 636b  ata = self.stack
-0005fc00: 2e61 6273 6461 7461 5b6c 6566 743a 7269  .absdata[left:ri
-0005fc10: 6768 742c 626f 7474 6f6d 3a74 6f70 2c73  ght,bottom:top,s
-0005fc20: 656c 6563 7469 6f6e 5d0d 0a20 2020 2020  election]..     
-0005fc30: 2020 2073 656c 662e 7374 6163 6b2e 6e5f     self.stack.n_
-0005fc40: 636f 6c73 203d 2073 656c 662e 7374 6163  cols = self.stac
-0005fc50: 6b2e 6162 7364 6174 612e 7368 6170 655b  k.absdata.shape[
-0005fc60: 305d 0d0a 2020 2020 2020 2020 7365 6c66  0]..        self
-0005fc70: 2e73 7461 636b 2e6e 5f72 6f77 7320 3d20  .stack.n_rows = 
-0005fc80: 7365 6c66 2e73 7461 636b 2e61 6273 6461  self.stack.absda
-0005fc90: 7461 2e73 6861 7065 5b31 5d0d 0a20 2020  ta.shape[1]..   
-0005fca0: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
-0005fcb0: 2e70 6167 6531 2e69 7820 3d20 696e 7428  .page1.ix = int(
-0005fcc0: 7365 6c66 2e73 7461 636b 2e6e 5f63 6f6c  self.stack.n_col
-0005fcd0: 732f 3229 0d0a 2020 2020 2020 2020 7365  s/2)..        se
-0005fce0: 6c66 2e70 6172 656e 742e 7061 6765 312e  lf.parent.page1.
-0005fcf0: 6979 203d 2069 6e74 2873 656c 662e 7374  iy = int(self.st
-0005fd00: 6163 6b2e 6e5f 726f 7773 2f32 290d 0a0d  ack.n_rows/2)...
-0005fd10: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0005fd20: 2e63 6f6d 2e73 7461 636b 5f34 643a 0d0a  .com.stack_4d:..
-0005fd30: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0005fd40: 656c 662e 6362 5f72 656d 6f76 655f 7468  elf.cb_remove_th
-0005fd50: 6574 612e 6973 4368 6563 6b65 6428 293a  eta.isChecked():
-0005fd60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005fd70: 2020 7468 6574 6173 203d 2073 656c 662e    thetas = self.
-0005fd80: 7468 6574 6169 6478 5f73 656c 6563 7465  thetaidx_selecte
-0005fd90: 640d 0a20 2020 2020 2020 2020 2020 2020  d..             
-0005fda0: 2020 2069 6620 6c65 6e28 7468 6574 6173     if len(thetas
-0005fdb0: 2920 3d3d 2030 3a0d 0a20 2020 2020 2020  ) == 0:..       
-0005fdc0: 2020 2020 2020 2020 2020 2020 2051 7457               QtW
-0005fdd0: 6964 6765 7473 2e51 4d65 7373 6167 6542  idgets.QMessageB
-0005fde0: 6f78 2e77 6172 6e69 6e67 2873 656c 662c  ox.warning(self,
-0005fdf0: 2027 4572 726f 7227 2c20 2750 6c65 6173   'Error', 'Pleas
-0005fe00: 6520 7365 6c65 6374 2061 7420 6c65 6173  e select at leas
-0005fe10: 7420 6f6e 6520 7468 6574 6120 7661 6c75  t one theta valu
-0005fe20: 6521 2729 0d0a 2020 2020 2020 2020 2020  e!')..          
-0005fe30: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0005fe40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005fe50: 2020 7365 6c66 2e73 7461 636b 2e6e 5f74    self.stack.n_t
-0005fe60: 6865 7461 203d 206c 656e 2874 6865 7461  heta = len(theta
-0005fe70: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-0005fe80: 2020 2020 7365 6c66 2e73 7461 636b 2e74      self.stack.t
-0005fe90: 6865 7461 203d 2073 656c 662e 7374 6163  heta = self.stac
-0005fea0: 6b2e 7468 6574 615b 7468 6574 6173 5d0d  k.theta[thetas].
-0005feb0: 0a0d 0a20 2020 2020 2020 2020 2020 2065  ...            e
-0005fec0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0005fed0: 2020 2020 2020 7468 6574 6173 203d 206c        thetas = l
-0005fee0: 6973 7428 7261 6e67 6528 7365 6c66 2e73  ist(range(self.s
-0005fef0: 7461 636b 2e6e 5f74 6865 7461 2929 0d0a  tack.n_theta))..
-0005ff00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005ff10: 2e73 7461 636b 2e73 7461 636b 3444 203d  .stack.stack4D =
-0005ff20: 2073 656c 662e 7374 6163 6b2e 7374 6163   self.stack.stac
-0005ff30: 6b34 445b 6c65 6674 3a72 6967 6874 2c20  k4D[left:right, 
-0005ff40: 626f 7474 6f6d 3a74 6f70 2c20 7365 6c65  bottom:top, sele
-0005ff50: 6374 696f 6e2c 203a 5d0d 0a20 2020 2020  ction, :]..     
-0005ff60: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
-0005ff70: 6b2e 7374 6163 6b34 4420 3d20 7365 6c66  k.stack4D = self
-0005ff80: 2e73 7461 636b 2e73 7461 636b 3444 5b3a  .stack.stack4D[:
-0005ff90: 2c3a 2c20 3a2c 2074 6865 7461 735d 0d0a  ,:, :, thetas]..
-0005ffa0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0005ffb0: 636f 6d2e 6930 5f6c 6f61 6465 643a 0d0a  com.i0_loaded:..
-0005ffc0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0005ffd0: 656c 662e 636f 6d2e 7374 6163 6b5f 3464  elf.com.stack_4d
-0005ffe0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0005fff0: 2020 2073 656c 662e 7374 6163 6b2e 6f64     self.stack.od
-00060000: 3444 203d 2073 656c 662e 7374 6163 6b2e  4D = self.stack.
-00060010: 6f64 3444 5b6c 6566 743a 7269 6768 742c  od4D[left:right,
-00060020: 626f 7474 6f6d 3a74 6f70 2c73 656c 6563  bottom:top,selec
-00060030: 7469 6f6e 2c20 7468 6574 6173 5d0d 0a20  tion, thetas].. 
-00060040: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00060050: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00060060: 2020 7365 6c66 2e73 7461 636b 2e6f 6433    self.stack.od3
-00060070: 6420 3d20 2073 656c 662e 7374 6163 6b2e  d =  self.stack.
-00060080: 6f64 3364 5b6c 6566 743a 7269 6768 742c  od3d[left:right,
-00060090: 626f 7474 6f6d 3a74 6f70 2c73 656c 6563  bottom:top,selec
-000600a0: 7469 6f6e 5d0d 0a20 2020 2020 2020 2020  tion]..         
-000600b0: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
-000600c0: 6b2e 6f64 203d 2073 656c 662e 7374 6163  k.od = self.stac
-000600d0: 6b2e 6f64 3364 2e63 6f70 7928 290d 0a20  k.od3d.copy().. 
-000600e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000600f0: 656c 662e 7374 6163 6b2e 6f64 203d 206e  elf.stack.od = n
-00060100: 702e 7265 7368 6170 6528 7365 6c66 2e73  p.reshape(self.s
-00060110: 7461 636b 2e6f 642c 2028 7365 6c66 2e73  tack.od, (self.s
-00060120: 7461 636b 2e6e 5f72 6f77 7320 2a20 7365  tack.n_rows * se
-00060130: 6c66 2e73 7461 636b 2e6e 5f63 6f6c 732c  lf.stack.n_cols,
-00060140: 2073 656c 662e 7374 6163 6b2e 6e5f 6576   self.stack.n_ev
-00060150: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-00060160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060170: 2020 2020 2020 2020 2020 206f 7264 6572             order
-00060180: 3d27 4627 290d 0a0d 0a20 2020 2020 2020  ='F')....       
-00060190: 2073 656c 662e 7374 6163 6b2e 6669 6c6c   self.stack.fill
-000601a0: 5f68 355f 7374 7275 6374 5f66 726f 6d5f  _h5_struct_from_
-000601b0: 7374 6b28 290d 0a20 2020 2020 2020 2069  stk()..        i
-000601c0: 6620 7365 6c66 2e63 6f6d 2e69 305f 6c6f  f self.com.i0_lo
-000601d0: 6164 6564 203d 3d20 313a 0d0a 2020 2020  aded == 1:..    
-000601e0: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
-000601f0: 636b 2e66 696c 6c5f 6835 5f73 7472 7563  ck.fill_h5_struc
-00060200: 745f 6e6f 726d 616c 697a 6174 696f 6e28  t_normalization(
-00060210: 290d 0a0d 0a20 2020 2020 2020 2023 2046  )....        # F
-00060220: 6978 2074 6865 2073 6c69 6465 7220 6f6e  ix the slider on
-00060230: 2050 6167 6520 3121 0d0a 2020 2020 2020   Page 1!..      
-00060240: 2020 6966 2073 656c 662e 636f 6d2e 7374    if self.com.st
-00060250: 6163 6b5f 3464 3a0d 0a20 2020 2020 2020  ack_4d:..       
-00060260: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
-00060270: 2e70 6167 6531 2e73 6c69 6465 725f 7468  .page1.slider_th
-00060280: 6574 612e 7365 7452 616e 6765 2830 2c20  eta.setRange(0, 
-00060290: 7365 6c66 2e73 7461 636b 2e6e 5f74 6865  self.stack.n_the
-000602a0: 7461 202d 2031 290d 0a20 2020 2020 2020  ta - 1)..       
-000602b0: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
-000602c0: 2e70 6167 6531 2e69 7468 6574 6120 3d20  .page1.itheta = 
-000602d0: 300d 0a20 2020 2020 2020 2020 2020 2073  0..            s
-000602e0: 656c 662e 7061 7265 6e74 2e70 6167 6531  elf.parent.page1
-000602f0: 2e73 6c69 6465 725f 7468 6574 612e 626c  .slider_theta.bl
-00060300: 6f63 6b53 6967 6e61 6c73 2854 7275 6529  ockSignals(True)
-00060310: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00060320: 6c66 2e70 6172 656e 742e 7061 6765 312e  lf.parent.page1.
-00060330: 736c 6964 6572 5f74 6865 7461 2e73 6574  slider_theta.set
-00060340: 5661 6c75 6528 696e 7428 7365 6c66 2e70  Value(int(self.p
-00060350: 6172 656e 742e 7061 6765 312e 6974 6865  arent.page1.ithe
-00060360: 7461 2929 0d0a 2020 2020 2020 2020 2020  ta))..          
-00060370: 2020 7365 6c66 2e70 6172 656e 742e 7061    self.parent.pa
-00060380: 6765 312e 736c 6964 6572 5f74 6865 7461  ge1.slider_theta
-00060390: 2e62 6c6f 636b 5369 676e 616c 7328 4661  .blockSignals(Fa
-000603a0: 6c73 6529 0d0a 0d0a 2020 2020 2020 2020  lse)....        
-000603b0: 2020 2020 7365 6c66 2e70 6172 656e 742e      self.parent.
-000603c0: 7061 6765 302e 736c 6964 6572 5f74 6865  page0.slider_the
-000603d0: 7461 2e73 6574 5261 6e67 6528 302c 2073  ta.setRange(0, s
-000603e0: 656c 662e 7374 6163 6b2e 6e5f 7468 6574  elf.stack.n_thet
-000603f0: 6120 2d20 3129 0d0a 2020 2020 2020 2020  a - 1)..        
-00060400: 2020 2020 7365 6c66 2e70 6172 656e 742e      self.parent.
-00060410: 7061 6765 302e 6974 6865 7461 203d 2030  page0.itheta = 0
-00060420: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00060430: 6c66 2e70 6172 656e 742e 7061 6765 302e  lf.parent.page0.
-00060440: 736c 6964 6572 5f74 6865 7461 2e62 6c6f  slider_theta.blo
-00060450: 636b 5369 676e 616c 7328 5472 7565 290d  ckSignals(True).
-00060460: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00060470: 662e 7061 7265 6e74 2e70 6167 6530 2e73  f.parent.page0.s
-00060480: 6c69 6465 725f 7468 6574 612e 7365 7456  lider_theta.setV
-00060490: 616c 7565 2869 6e74 2873 656c 662e 7061  alue(int(self.pa
-000604a0: 7265 6e74 2e70 6167 6531 2e69 7468 6574  rent.page1.ithet
-000604b0: 6129 290d 0a20 2020 2020 2020 2020 2020  a))..           
-000604c0: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
-000604d0: 6530 2e73 6c69 6465 725f 7468 6574 612e  e0.slider_theta.
-000604e0: 626c 6f63 6b53 6967 6e61 6c73 2846 616c  blockSignals(Fal
-000604f0: 7365 290d 0a0d 0a20 2020 2020 2020 2073  se)....        s
-00060500: 656c 662e 7061 7265 6e74 2e70 6167 6531  elf.parent.page1
-00060510: 2e73 6c69 6465 725f 656e 672e 7365 7452  .slider_eng.setR
-00060520: 616e 6765 2830 2c20 7365 6c66 2e73 7461  ange(0, self.sta
-00060530: 636b 2e6e 5f65 7620 2d20 3129 0d0a 2020  ck.n_ev - 1)..  
-00060540: 2020 2020 2020 7365 6c66 2e70 6172 656e        self.paren
-00060550: 742e 7061 6765 312e 6965 7620 3d20 300d  t.page1.iev = 0.
-00060560: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
-00060570: 7265 6e74 2e70 6167 6531 2e73 6c69 6465  rent.page1.slide
-00060580: 725f 656e 672e 7365 7456 616c 7565 2869  r_eng.setValue(i
-00060590: 6e74 2873 656c 662e 7061 7265 6e74 2e70  nt(self.parent.p
-000605a0: 6167 6531 2e69 6576 2929 0d0a 0d0a 2020  age1.iev))....  
-000605b0: 2020 2020 2020 7365 6c66 2e70 6172 656e        self.paren
-000605c0: 742e 7061 6765 302e 736c 6964 6572 5f65  t.page0.slider_e
-000605d0: 6e67 2e73 6574 5261 6e67 6528 302c 2073  ng.setRange(0, s
-000605e0: 656c 662e 7374 6163 6b2e 6e5f 6576 202d  elf.stack.n_ev -
-000605f0: 2031 290d 0a20 2020 2020 2020 2073 656c   1)..        sel
-00060600: 662e 7061 7265 6e74 2e70 6167 6530 2e69  f.parent.page0.i
-00060610: 6576 203d 2030 0d0a 2020 2020 2020 2020  ev = 0..        
-00060620: 7365 6c66 2e70 6172 656e 742e 7061 6765  self.parent.page
-00060630: 302e 736c 6964 6572 5f65 6e67 2e73 6574  0.slider_eng.set
-00060640: 5661 6c75 6528 696e 7428 7365 6c66 2e70  Value(int(self.p
-00060650: 6172 656e 742e 7061 6765 312e 6965 7629  arent.page1.iev)
-00060660: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-00060670: 662e 7061 7265 6e74 2e70 6167 6531 2e73  f.parent.page1.s
-00060680: 686f 7753 7065 6374 7275 6d28 7365 6c66  howSpectrum(self
-00060690: 2e70 6172 656e 742e 7061 6765 312e 6978  .parent.page1.ix
-000606a0: 2c20 7365 6c66 2e70 6172 656e 742e 7061  , self.parent.pa
-000606b0: 6765 312e 6979 290d 0a20 2020 2020 2020  ge1.iy)..       
-000606c0: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
-000606d0: 6531 2e6c 6f61 6449 6d61 6765 2829 0d0a  e1.loadImage()..
-000606e0: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
-000606f0: 656e 742e 7061 6765 302e 436c 6561 7228  ent.page0.Clear(
-00060700: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00060710: 7061 7265 6e74 2e70 6167 6530 2e4c 6f61  parent.page0.Loa
-00060720: 6445 6e74 7269 6573 2829 0d0a 0d0a 2020  dEntries()....  
-00060730: 2020 2020 2020 6966 2073 686f 776d 6170        if showmap
-00060740: 7461 623a 0d0a 2020 2020 2020 2020 2020  tab:..          
-00060750: 2020 7365 6c66 2e70 6172 656e 742e 7061    self.parent.pa
-00060760: 6765 392e 436c 6561 7228 290d 0a20 2020  ge9.Clear()..   
-00060770: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-00060780: 7265 6e74 2e70 6167 6539 2e4c 6f61 6445  rent.page9.LoadE
-00060790: 6e74 7269 6573 2829 0d0a 0d0a 2020 2020  ntries()....    
-000607a0: 2020 2020 7365 6c66 2e63 6c6f 7365 2829      self.close()
-000607b0: 0d0a 0d0a 636c 6173 7320 496d 6167 6552  ....class ImageR
-000607c0: 6567 6973 7472 6174 696f 6e44 6961 6c6f  egistrationDialo
-000607d0: 6728 5174 5769 6467 6574 732e 5144 6961  g(QtWidgets.QDia
-000607e0: 6c6f 6729 3a0d 0a0d 0a20 2020 2064 6566  log):....    def
-000607f0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-00060800: 7061 7265 6e74 2c20 636f 6d6d 6f6e 293a  parent, common):
-00060810: 0d0a 2020 2020 2020 2020 5174 5769 6467  ..        QtWidg
-00060820: 6574 732e 5157 6964 6765 742e 5f5f 696e  ets.QWidget.__in
-00060830: 6974 5f5f 2873 656c 662c 2070 6172 656e  it__(self, paren
-00060840: 7429 0d0a 2020 2020 2020 2020 7569 632e  t)..        uic.
-00060850: 6c6f 6164 5569 286f 732e 7061 7468 2e6a  loadUi(os.path.j
-00060860: 6f69 6e28 6f73 2e70 6174 682e 6469 726e  oin(os.path.dirn
-00060870: 616d 6528 6f73 2e70 6174 682e 6162 7370  ame(os.path.absp
-00060880: 6174 6828 5f5f 6669 6c65 5f5f 2929 2c20  ath(__file__)), 
-00060890: 2764 6961 6c6f 6761 6c69 676e 2e75 6927  'dialogalign.ui'
-000608a0: 292c 2073 656c 6629 0d0a 2020 2020 2020  ), self)..      
-000608b0: 2020 7365 6c66 2e70 6172 656e 7420 3d20    self.parent = 
-000608c0: 7061 7265 6e74 0d0a 2020 2020 2020 2020  parent..        
-000608d0: 7365 6c66 2e63 6f6d 203d 2063 6f6d 6d6f  self.com = commo
-000608e0: 6e0d 0a20 2020 2020 2020 2023 2043 7572  n..        # Cur
-000608f0: 7265 6e74 6c79 2064 6973 6162 6c65 6420  rently disabled 
-00060900: 666f 7220 546f 6d6f 2064 6174 610d 0a20  for Tomo data.. 
-00060910: 2020 2020 2020 2023 2069 6620 7365 6c66         # if self
-00060920: 2e63 6f6d 2e73 7461 636b 5f34 6420 3d3d  .com.stack_4d ==
-00060930: 2031 3a0d 0a20 2020 2020 2020 2023 2020   1:..        #  
-00060940: 2020 2073 656c 662e 6274 5f61 6c69 676e     self.bt_align
-00060950: 322e 7365 7445 6e61 626c 6564 2854 7275  2.setEnabled(Tru
-00060960: 6529 0d0a 2020 2020 2020 2020 2320 656c  e)..        # el
-00060970: 7365 3a0d 0a20 2020 2020 2020 2023 2020  se:..        #  
-00060980: 2020 2073 656c 662e 6274 5f61 6c69 676e     self.bt_align
-00060990: 322e 7365 7445 6e61 626c 6564 2854 7275  2.setEnabled(Tru
-000609a0: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-000609b0: 2e62 745f 616c 6967 6e2e 636c 6963 6b65  .bt_align.clicke
-000609c0: 642e 636f 6e6e 6563 7428 7365 6c66 2e70  d.connect(self.p
-000609d0: 6172 656e 742e 7061 6765 312e 4f6e 416c  arent.page1.OnAl
-000609e0: 6967 6e49 6d67 7329 0d0a 2020 2020 2020  ignImgs)..      
-000609f0: 2020 7365 6c66 2e62 745f 616c 6967 6e32    self.bt_align2
-00060a00: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
-00060a10: 2873 656c 662e 7061 7265 6e74 2e70 6167  (self.parent.pag
-00060a20: 6531 2e4f 6e41 6c69 676e 496d 6773 3229  e1.OnAlignImgs2)
-00060a30: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
-00060a40: 745f 616c 6967 6e2e 636c 6963 6b65 642e  t_align.clicked.
-00060a50: 636f 6e6e 6563 7428 7365 6c66 2e64 6f6e  connect(self.don
-00060a60: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-00060a70: 2e62 745f 616c 6967 6e32 2e63 6c69 636b  .bt_align2.click
-00060a80: 6564 2e63 6f6e 6e65 6374 2873 656c 662e  ed.connect(self.
-00060a90: 646f 6e65 290d 0a23 2d2d 2d2d 2d2d 2d2d  done)..#--------
-00060aa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00060ab0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00060ac0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00060ad0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a  --------------..
-00060ae0: 636c 6173 7320 496d 6167 6552 6567 6973  class ImageRegis
-00060af0: 7472 6174 696f 6e4d 616e 7561 6c28 5174  trationManual(Qt
-00060b00: 5769 6467 6574 732e 5144 6961 6c6f 6729  Widgets.QDialog)
-00060b10: 3a0d 0a0d 0a20 2020 2064 6566 205f 5f69  :....    def __i
-00060b20: 6e69 745f 5f28 7365 6c66 2c20 7061 7265  nit__(self, pare
-00060b30: 6e74 2c20 2063 6f6d 6d6f 6e2c 2073 7461  nt,  common, sta
-00060b40: 636b 293a 0d0a 2020 2020 2020 2020 5174  ck):..        Qt
-00060b50: 5769 6467 6574 732e 5157 6964 6765 742e  Widgets.QWidget.
-00060b60: 5f5f 696e 6974 5f5f 2873 656c 662c 2070  __init__(self, p
-00060b70: 6172 656e 7429 0d0a 0d0a 2020 2020 2020  arent)....      
-00060b80: 2020 7365 6c66 2e70 6172 656e 7420 3d20    self.parent = 
-00060b90: 7061 7265 6e74 0d0a 0d0a 2020 2020 2020  parent....      
-00060ba0: 2020 7365 6c66 2e72 6573 697a 6528 3130    self.resize(10
-00060bb0: 3530 2c20 3735 3029 0d0a 2020 2020 2020  50, 750)..      
-00060bc0: 2020 7365 6c66 2e73 6574 5769 6e64 6f77    self.setWindow
-00060bd0: 5469 746c 6528 2753 7461 636b 2041 6c69  Title('Stack Ali
-00060be0: 676e 6d65 6e74 2729 0d0a 0d0a 2020 2020  gnment')....    
-00060bf0: 2020 2020 7061 6c20 3d20 5174 4775 692e      pal = QtGui.
-00060c00: 5150 616c 6574 7465 2829 0d0a 2020 2020  QPalette()..    
-00060c10: 2020 2020 7365 6c66 2e73 6574 4175 746f      self.setAuto
-00060c20: 4669 6c6c 4261 636b 6772 6f75 6e64 2854  FillBackground(T
-00060c30: 7275 6529 0d0a 2020 2020 2020 2020 7061  rue)..        pa
-00060c40: 6c2e 7365 7443 6f6c 6f72 2851 7447 7569  l.setColor(QtGui
-00060c50: 2e51 5061 6c65 7474 652e 5769 6e64 6f77  .QPalette.Window
-00060c60: 2c51 7447 7569 2e51 436f 6c6f 7228 2777  ,QtGui.QColor('w
-00060c70: 6869 7465 2729 290d 0a20 2020 2020 2020  hite'))..       
-00060c80: 2073 656c 662e 7365 7450 616c 6574 7465   self.setPalette
-00060c90: 2870 616c 290d 0a0d 0a20 2020 2020 2020  (pal)....       
-00060ca0: 2073 656c 662e 7374 6163 6b20 3d20 7374   self.stack = st
-00060cb0: 6163 6b0d 0a20 2020 2020 2020 2073 656c  ack..        sel
-00060cc0: 662e 636f 6d20 3d20 636f 6d6d 6f6e 0d0a  f.com = common..
-00060cd0: 0d0a 2020 2020 2020 2020 7365 6c66 2e68  ..        self.h
-00060ce0: 6176 655f 7265 665f 696d 6167 6520 3d20  ave_ref_image = 
-00060cf0: 300d 0a20 2020 2020 2020 2073 656c 662e  0..        self.
-00060d00: 7265 6769 7374 5f63 616c 6375 6c61 7465  regist_calculate
-00060d10: 6420 3d20 300d 0a0d 0a20 2020 2020 2020  d = 0....       
-00060d20: 2073 656c 662e 6965 7620 3d20 300d 0a20   self.iev = 0.. 
-00060d30: 2020 2020 2020 2073 656c 662e 6974 6865         self.ithe
-00060d40: 7461 203d 2030 0d0a 2020 2020 2020 2020  ta = 0..        
-00060d50: 7365 6c66 2e72 6566 5f69 6d61 6765 5f69  self.ref_image_i
-00060d60: 6e64 6578 203d 2030 0d0a 2020 2020 2020  ndex = 0..      
-00060d70: 2020 7365 6c66 2e72 6566 5f69 6d61 6765    self.ref_image
-00060d80: 5f69 6e64 6578 5f74 6865 7461 203d 2030  _index_theta = 0
-00060d90: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
-00060da0: 6566 5f69 6d61 6765 203d 2030 0d0a 0d0a  ef_image = 0....
-00060db0: 2020 2020 2020 2020 7365 6c66 2e6d 616e          self.man
-00060dc0: 5f61 6c69 676e 203d 2030 0d0a 2020 2020  _align = 0..    
-00060dd0: 2020 2020 7365 6c66 2e6d 616e 5f78 7265      self.man_xre
-00060de0: 6620 3d20 300d 0a20 2020 2020 2020 2073  f = 0..        s
-00060df0: 656c 662e 6d61 6e5f 7972 6566 203d 2030  elf.man_yref = 0
-00060e00: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00060e10: 2e6d 6178 7368 6966 7420 3d20 300d 0a20  .maxshift = 0.. 
-00060e20: 2020 2020 2020 2073 656c 662e 6175 746f         self.auto
-00060e30: 203d 2054 7275 650d 0a0d 0a20 2020 2020   = True....     
-00060e40: 2020 2073 656c 662e 786c 6566 7420 3d20     self.xleft = 
-00060e50: 300d 0a20 2020 2020 2020 2073 656c 662e  0..        self.
-00060e60: 7872 6967 6874 203d 2073 656c 662e 7374  xright = self.st
-00060e70: 6163 6b2e 6e5f 636f 6c73 0d0a 2020 2020  ack.n_cols..    
-00060e80: 2020 2020 7365 6c66 2e79 626f 7474 6f6d      self.ybottom
-00060e90: 203d 2030 0d0a 2020 2020 2020 2020 7365   = 0..        se
-00060ea0: 6c66 2e79 746f 7020 3d20 7365 6c66 2e73  lf.ytop = self.s
-00060eb0: 7461 636b 2e6e 5f72 6f77 730d 0a0d 0a20  tack.n_rows.... 
-00060ec0: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
-00060ed0: 6f6d 2e73 7461 636b 5f34 6420 3d3d 2030  om.stack_4d == 0
-00060ee0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00060ef0: 656c 662e 616c 6967 6e65 645f 7374 6163  elf.aligned_stac
-00060f00: 6b20 3d20 7365 6c66 2e73 7461 636b 2e61  k = self.stack.a
-00060f10: 6273 6461 7461 2e63 6f70 7928 290d 0a20  bsdata.copy().. 
-00060f20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00060f30: 6d61 6e5f 7873 203d 206e 702e 7a65 726f  man_xs = np.zero
-00060f40: 7328 2873 656c 662e 7374 6163 6b2e 6e5f  s((self.stack.n_
-00060f50: 6576 2929 0d0a 2020 2020 2020 2020 2020  ev))..          
-00060f60: 2020 7365 6c66 2e6d 616e 5f79 7320 3d20    self.man_ys = 
-00060f70: 6e70 2e7a 6572 6f73 2828 7365 6c66 2e73  np.zeros((self.s
-00060f80: 7461 636b 2e6e 5f65 7629 290d 0a20 2020  tack.n_ev))..   
-00060f90: 2020 2020 2020 2020 2073 656c 662e 7873           self.xs
-00060fa0: 6869 6674 7320 3d20 6e70 2e7a 6572 6f73  hifts = np.zeros
-00060fb0: 2828 7365 6c66 2e73 7461 636b 2e6e 5f65  ((self.stack.n_e
-00060fc0: 7629 290d 0a20 2020 2020 2020 2020 2020  v))..           
-00060fd0: 2073 656c 662e 7973 6869 6674 7320 3d20   self.yshifts = 
-00060fe0: 6e70 2e7a 6572 6f73 2828 7365 6c66 2e73  np.zeros((self.s
-00060ff0: 7461 636b 2e6e 5f65 7629 290d 0a20 2020  tack.n_ev))..   
-00061000: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00061010: 2020 2020 2020 2020 7365 6c66 2e61 6c69          self.ali
-00061020: 676e 6564 5f73 7461 636b 203d 2073 656c  gned_stack = sel
-00061030: 662e 7374 6163 6b2e 7374 6163 6b34 442e  f.stack.stack4D.
-00061040: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
-00061050: 2020 2020 7365 6c66 2e6d 616e 5f78 7320      self.man_xs 
-00061060: 3d20 6e70 2e7a 6572 6f73 2828 7365 6c66  = np.zeros((self
-00061070: 2e73 7461 636b 2e6e 5f65 762c 7365 6c66  .stack.n_ev,self
-00061080: 2e73 7461 636b 2e6e 5f74 6865 7461 2929  .stack.n_theta))
-00061090: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000610a0: 6c66 2e6d 616e 5f79 7320 3d20 6e70 2e7a  lf.man_ys = np.z
-000610b0: 6572 6f73 2828 7365 6c66 2e73 7461 636b  eros((self.stack
-000610c0: 2e6e 5f65 762c 7365 6c66 2e73 7461 636b  .n_ev,self.stack
-000610d0: 2e6e 5f74 6865 7461 2929 0d0a 2020 2020  .n_theta))..    
-000610e0: 2020 2020 2020 2020 7365 6c66 2e78 7368          self.xsh
-000610f0: 6966 7473 203d 206e 702e 7a65 726f 7328  ifts = np.zeros(
-00061100: 2873 656c 662e 7374 6163 6b2e 6e5f 6576  (self.stack.n_ev
-00061110: 2c73 656c 662e 7374 6163 6b2e 6e5f 7468  ,self.stack.n_th
-00061120: 6574 6129 290d 0a20 2020 2020 2020 2020  eta))..         
-00061130: 2020 2073 656c 662e 7973 6869 6674 7320     self.yshifts 
-00061140: 3d20 6e70 2e7a 6572 6f73 2828 7365 6c66  = np.zeros((self
-00061150: 2e73 7461 636b 2e6e 5f65 762c 7365 6c66  .stack.n_ev,self
-00061160: 2e73 7461 636b 2e6e 5f74 6865 7461 2929  .stack.n_theta))
-00061170: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00061180: 2e6d 696e 7873 203d 2030 0d0a 2020 2020  .minxs = 0..    
-00061190: 2020 2020 7365 6c66 2e6d 6178 7873 203d      self.maxxs =
-000611a0: 2030 0d0a 0d0a 2020 2020 2020 2020 7365   0....        se
-000611b0: 6c66 2e6d 696e 7973 203d 2030 0d0a 2020  lf.minys = 0..  
-000611c0: 2020 2020 2020 7365 6c66 2e6d 6178 7973        self.maxys
-000611d0: 203d 2030 0d0a 0d0a 2020 2020 2020 2020   = 0....        
-000611e0: 7365 6c66 2e73 686f 7763 636f 7272 203d  self.showccorr =
-000611f0: 2030 0d0a 0d0a 2020 2020 2020 2020 7365   0....        se
-00061200: 6c66 2e65 6467 6565 203d 2030 0d0a 0d0a  lf.edgee = 0....
-00061210: 2020 2020 2020 2020 7365 6c66 2e73 7562          self.sub
-00061220: 7265 6769 6f6e 203d 2030 0d0a 2020 2020  region = 0..    
-00061230: 2020 2020 7365 6c66 2e73 725f 7831 203d      self.sr_x1 =
-00061240: 2030 0d0a 2020 2020 2020 2020 7365 6c66   0..        self
-00061250: 2e73 725f 7832 203d 2030 0d0a 2020 2020  .sr_x2 = 0..    
-00061260: 2020 2020 7365 6c66 2e73 725f 7931 203d      self.sr_y1 =
-00061270: 2030 0d0a 2020 2020 2020 2020 7365 6c66   0..        self
-00061280: 2e73 725f 7932 203d 2030 0d0a 2020 2020  .sr_y2 = 0..    
-00061290: 2020 2020 7365 6c66 2e70 6174 6368 203d      self.patch =
-000612a0: 204e 6f6e 650d 0a0d 0a20 2020 2020 2020   None....       
-000612b0: 2023 7061 6e65 6c20 310d 0a20 2020 2020   #panel 1..     
-000612c0: 2020 2076 626f 7831 203d 2051 7457 6964     vbox1 = QtWid
-000612d0: 6765 7473 2e51 5642 6f78 4c61 796f 7574  gets.QVBoxLayout
-000612e0: 2829 0d0a 0d0a 2020 2020 2020 2020 7365  ()....        se
-000612f0: 6c66 2e74 635f 696d 6167 6565 6e67 203d  lf.tc_imageeng =
-00061300: 2051 7457 6964 6765 7473 2e51 4c61 6265   QtWidgets.QLabe
-00061310: 6c28 7365 6c66 290d 0a20 2020 2020 2020  l(self)..       
-00061320: 2073 656c 662e 7463 5f69 6d61 6765 656e   self.tc_imageen
-00061330: 672e 7365 7454 6578 7428 2249 6d61 6765  g.setText("Image
-00061340: 2061 7420 656e 6572 6779 3a20 2229 0d0a   at energy: ")..
-00061350: 0d0a 2020 2020 2020 2020 6772 6964 7369  ..        gridsi
-00061360: 7a65 7274 6f70 203d 2051 7457 6964 6765  zertop = QtWidge
-00061370: 7473 2e51 4772 6964 4c61 796f 7574 2829  ts.QGridLayout()
-00061380: 0d0a 0d0a 2020 2020 2020 2020 6672 616d  ....        fram
-00061390: 6520 3d20 5174 5769 6467 6574 732e 5146  e = QtWidgets.QF
-000613a0: 7261 6d65 2829 0d0a 2020 2020 2020 2020  rame()..        
-000613b0: 6672 616d 652e 7365 7446 7261 6d65 5374  frame.setFrameSt
-000613c0: 796c 6528 5174 5769 6467 6574 732e 5146  yle(QtWidgets.QF
-000613d0: 7261 6d65 2e53 7479 6c65 6450 616e 656c  rame.StyledPanel
-000613e0: 7c51 7457 6964 6765 7473 2e51 4672 616d  |QtWidgets.QFram
-000613f0: 652e 5375 6e6b 656e 290d 0a20 2020 2020  e.Sunken)..     
-00061400: 2020 2066 626f 7820 3d20 5174 5769 6467     fbox = QtWidg
-00061410: 6574 732e 5148 426f 784c 6179 6f75 7428  ets.QHBoxLayout(
-00061420: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-00061430: 662e 6162 7369 6d67 6669 6720 3d20 4669  f.absimgfig = Fi
-00061440: 6775 7265 2828 342e 302c 2034 2e30 2929  gure((4.0, 4.0))
-00061450: 0d0a 2020 2020 2020 2020 7365 6c66 2e41  ..        self.A
-00061460: 6273 496d 6167 6550 616e 656c 203d 2046  bsImagePanel = F
-00061470: 6967 7572 6543 616e 7661 7328 7365 6c66  igureCanvas(self
-00061480: 2e61 6273 696d 6766 6967 290d 0a20 2020  .absimgfig)..   
-00061490: 2020 2020 2073 656c 662e 4162 7349 6d61       self.AbsIma
-000614a0: 6765 5061 6e65 6c2e 7365 7450 6172 656e  gePanel.setParen
-000614b0: 7428 7365 6c66 290d 0a20 2020 2020 2020  t(self)..       
-000614c0: 2073 656c 662e 4162 7349 6d61 6765 5061   self.AbsImagePa
-000614d0: 6e65 6c2e 6d70 6c5f 636f 6e6e 6563 7428  nel.mpl_connect(
-000614e0: 2762 7574 746f 6e5f 7072 6573 735f 6576  'button_press_ev
-000614f0: 656e 7427 2c20 7365 6c66 2e4f 6e50 6f69  ent', self.OnPoi
-00061500: 6e74 436f 7272 696d 6167 6529 0d0a 2020  ntCorrimage)..  
-00061510: 2020 2020 2020 7365 6c66 2e41 6273 496d        self.AbsIm
-00061520: 6167 6550 616e 656c 2e73 6574 4375 7273  agePanel.setCurs
-00061530: 6f72 2851 742e 4372 6f73 7343 7572 736f  or(Qt.CrossCurso
-00061540: 7229 0d0a 0d0a 0d0a 2020 2020 2020 2020  r)......        
-00061550: 6662 6f78 2e61 6464 5769 6467 6574 2873  fbox.addWidget(s
-00061560: 656c 662e 4162 7349 6d61 6765 5061 6e65  elf.AbsImagePane
-00061570: 6c29 0d0a 2020 2020 2020 2020 6672 616d  l)..        fram
-00061580: 652e 7365 744c 6179 6f75 7428 6662 6f78  e.setLayout(fbox
-00061590: 290d 0a20 2020 2020 2020 2067 7269 6473  )..        grids
-000615a0: 697a 6572 746f 702e 6164 6457 6964 6765  izertop.addWidge
-000615b0: 7428 6672 616d 652c 2030 2c20 302c 2051  t(frame, 0, 0, Q
-000615c0: 7443 6f72 6520 2e51 742e 2041 6c69 676e  tCore .Qt. Align
-000615d0: 4c65 6674 290d 0a0d 0a0d 0a20 2020 2020  Left)......     
-000615e0: 2020 2073 656c 662e 736c 6964 6572 5f65     self.slider_e
-000615f0: 6e67 203d 2051 7457 6964 6765 7473 2e51  ng = QtWidgets.Q
-00061600: 5363 726f 6c6c 4261 7228 5174 436f 7265  ScrollBar(QtCore
-00061610: 2e51 742e 5665 7274 6963 616c 290d 0a20  .Qt.Vertical).. 
-00061620: 2020 2020 2020 2073 656c 662e 736c 6964         self.slid
-00061630: 6572 5f65 6e67 2e73 6574 466f 6375 7350  er_eng.setFocusP
-00061640: 6f6c 6963 7928 5174 436f 7265 2e51 742e  olicy(QtCore.Qt.
-00061650: 5374 726f 6e67 466f 6375 7329 0d0a 2020  StrongFocus)..  
-00061660: 2020 2020 2020 7365 6c66 2e73 6c69 6465        self.slide
-00061670: 725f 656e 672e 7661 6c75 6543 6861 6e67  r_eng.valueChang
-00061680: 6564 5b69 6e74 5d2e 636f 6e6e 6563 7428  ed[int].connect(
-00061690: 7365 6c66 2e4f 6e53 6372 6f6c 6c45 6e67  self.OnScrollEng
-000616a0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000616b0: 736c 6964 6572 5f65 6e67 2e73 6574 5261  slider_eng.setRa
-000616c0: 6e67 6528 302c 2073 656c 662e 7374 6163  nge(0, self.stac
-000616d0: 6b2e 6e5f 6576 2d31 290d 0a20 2020 2020  k.n_ev-1)..     
-000616e0: 2020 2073 656c 662e 736c 6964 6572 5f65     self.slider_e
-000616f0: 6e67 2e73 6574 5661 6c75 6528 7365 6c66  ng.setValue(self
-00061700: 2e69 6576 290d 0a0d 0a20 2020 2020 2020  .iev)....       
-00061710: 2067 7269 6473 697a 6572 746f 702e 6164   gridsizertop.ad
-00061720: 6457 6964 6765 7428 7365 6c66 2e73 6c69  dWidget(self.sli
-00061730: 6465 725f 656e 672c 2030 2c20 312c 2051  der_eng, 0, 1, Q
-00061740: 7443 6f72 6520 2e51 742e 2041 6c69 676e  tCore .Qt. Align
-00061750: 4c65 6674 290d 0a0d 0a20 2020 2020 2020  Left)....       
-00061760: 2073 656c 662e 736c 6964 6572 5f74 6865   self.slider_the
-00061770: 7461 203d 2051 7457 6964 6765 7473 2e51  ta = QtWidgets.Q
-00061780: 5363 726f 6c6c 4261 7228 5174 436f 7265  ScrollBar(QtCore
-00061790: 2e51 742e 486f 7269 7a6f 6e74 616c 290d  .Qt.Horizontal).
-000617a0: 0a20 2020 2020 2020 2073 656c 662e 736c  .        self.sl
-000617b0: 6964 6572 5f74 6865 7461 2e73 6574 466f  ider_theta.setFo
-000617c0: 6375 7350 6f6c 6963 7928 5174 436f 7265  cusPolicy(QtCore
-000617d0: 2e51 742e 5374 726f 6e67 466f 6375 7329  .Qt.StrongFocus)
-000617e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-000617f0: 6c69 6465 725f 7468 6574 612e 7661 6c75  lider_theta.valu
-00061800: 6543 6861 6e67 6564 5b69 6e74 5d2e 636f  eChanged[int].co
-00061810: 6e6e 6563 7428 7365 6c66 2e4f 6e53 6372  nnect(self.OnScr
-00061820: 6f6c 6c54 6865 7461 290d 0a20 2020 2020  ollTheta)..     
-00061830: 2020 2073 656c 662e 736c 6964 6572 5f74     self.slider_t
-00061840: 6865 7461 2e73 6574 5261 6e67 6528 302c  heta.setRange(0,
-00061850: 2073 656c 662e 7374 6163 6b2e 6e5f 7468   self.stack.n_th
-00061860: 6574 612d 3129 0d0a 0d0a 2020 2020 2020  eta-1)....      
-00061870: 2020 7365 6c66 2e74 635f 696d 6167 6574    self.tc_imaget
-00061880: 6865 7461 203d 2051 7457 6964 6765 7473  heta = QtWidgets
-00061890: 2e51 4c61 6265 6c28 7365 6c66 290d 0a20  .QLabel(self).. 
-000618a0: 2020 2020 2020 2073 656c 662e 7463 5f69         self.tc_i
-000618b0: 6d61 6765 7468 6574 612e 7365 7454 6578  magetheta.setTex
-000618c0: 7428 2234 4420 4461 7461 2041 6e67 6c65  t("4D Data Angle
-000618d0: 3a20 2229 0d0a 2020 2020 2020 2020 6966  : ")..        if
-000618e0: 2073 656c 662e 636f 6d2e 7374 6163 6b5f   self.com.stack_
-000618f0: 3464 203d 3d20 3020 3a0d 0a20 2020 2020  4d == 0 :..     
-00061900: 2020 2020 2020 2073 656c 662e 7463 5f69         self.tc_i
-00061910: 6d61 6765 7468 6574 612e 7365 7456 6973  magetheta.setVis
-00061920: 6962 6c65 2846 616c 7365 290d 0a20 2020  ible(False)..   
-00061930: 2020 2020 2020 2020 2073 656c 662e 736c           self.sl
-00061940: 6964 6572 5f74 6865 7461 2e73 6574 5669  ider_theta.setVi
-00061950: 7369 626c 6528 4661 6c73 6529 0d0a 2020  sible(False)..  
-00061960: 2020 2020 2020 6862 6f78 3531 203d 2051        hbox51 = Q
-00061970: 7457 6964 6765 7473 2e51 4842 6f78 4c61  tWidgets.QHBoxLa
-00061980: 796f 7574 2829 0d0a 2020 2020 2020 2020  yout()..        
-00061990: 6862 6f78 3531 2e61 6464 5769 6467 6574  hbox51.addWidget
-000619a0: 2873 656c 662e 7463 5f69 6d61 6765 7468  (self.tc_imageth
-000619b0: 6574 6129 0d0a 2020 2020 2020 2020 6862  eta)..        hb
-000619c0: 6f78 3531 2e61 6464 5769 6467 6574 2873  ox51.addWidget(s
-000619d0: 656c 662e 736c 6964 6572 5f74 6865 7461  elf.slider_theta
-000619e0: 290d 0a20 2020 2020 2020 2067 7269 6473  )..        grids
-000619f0: 697a 6572 746f 702e 6164 644c 6179 6f75  izertop.addLayou
-00061a00: 7428 6862 6f78 3531 2c20 312c 2030 290d  t(hbox51, 1, 0).
-00061a10: 0a0d 0a20 2020 2020 2020 2076 626f 7831  ...        vbox1
-00061a20: 2e61 6464 5769 6467 6574 2873 656c 662e  .addWidget(self.
-00061a30: 7463 5f69 6d61 6765 656e 6729 0d0a 2020  tc_imageeng)..  
-00061a40: 2020 2020 2020 7662 6f78 312e 6164 644c        vbox1.addL
-00061a50: 6179 6f75 7428 6772 6964 7369 7a65 7274  ayout(gridsizert
-00061a60: 6f70 290d 0a0d 0a20 2020 2020 2020 2073  op)....        s
-00061a70: 656c 662e 7463 5f73 6869 6674 3120 3d20  elf.tc_shift1 = 
-00061a80: 5174 5769 6467 6574 732e 514c 6162 656c  QtWidgets.QLabel
-00061a90: 2873 656c 6629 0d0a 2020 2020 2020 2020  (self)..        
-00061aa0: 7365 6c66 2e74 635f 7368 6966 7432 203d  self.tc_shift2 =
-00061ab0: 2051 7457 6964 6765 7473 2e51 4c61 6265   QtWidgets.QLabe
-00061ac0: 6c28 7365 6c66 290d 0a20 2020 2020 2020  l(self)..       
-00061ad0: 2076 626f 7831 2e61 6464 5769 6467 6574   vbox1.addWidget
-00061ae0: 2873 656c 662e 7463 5f73 6869 6674 3129  (self.tc_shift1)
-00061af0: 0d0a 2020 2020 2020 2020 7662 6f78 312e  ..        vbox1.
-00061b00: 6164 6457 6964 6765 7428 7365 6c66 2e74  addWidget(self.t
-00061b10: 635f 7368 6966 7432 290d 0a20 2020 2020  c_shift2)..     
-00061b20: 2020 2076 626f 7831 2e61 6464 5374 7265     vbox1.addStre
-00061b30: 7463 6828 3129 0d0a 0d0a 2020 2020 2020  tch(1)....      
-00061b40: 2020 6966 2073 656c 662e 636f 6d2e 7374    if self.com.st
-00061b50: 6163 6b5f 3464 203d 3d20 303a 0d0a 2020  ack_4d == 0:..  
-00061b60: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-00061b70: 635f 7368 6966 7431 2e73 6574 5465 7874  c_shift1.setText
-00061b80: 2827 5820 7368 6966 743a 207b 303a 352e  ('X shift: {0:5.
-00061b90: 3266 7d20 7069 7865 6c73 272e 666f 726d  2f} pixels'.form
-00061ba0: 6174 2873 656c 662e 7873 6869 6674 735b  at(self.xshifts[
-00061bb0: 7365 6c66 2e69 6576 5d29 290d 0a20 2020  self.iev]))..   
-00061bc0: 2020 2020 2020 2020 2073 656c 662e 7463           self.tc
-00061bd0: 5f73 6869 6674 322e 7365 7454 6578 7428  _shift2.setText(
-00061be0: 2759 2073 6869 6674 3a20 7b30 3a35 2e32  'Y shift: {0:5.2
-00061bf0: 667d 2070 6978 656c 7327 2e66 6f72 6d61  f} pixels'.forma
-00061c00: 7428 7365 6c66 2e79 7368 6966 7473 5b73  t(self.yshifts[s
-00061c10: 656c 662e 6965 765d 2929 0d0a 2020 2020  elf.iev]))..    
-00061c20: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00061c30: 2020 2020 2020 2073 656c 662e 7463 5f73         self.tc_s
-00061c40: 6869 6674 312e 7365 7454 6578 7428 2758  hift1.setText('X
-00061c50: 2073 6869 6674 3a20 7b30 3a35 2e32 667d   shift: {0:5.2f}
-00061c60: 2070 6978 656c 7327 2e66 6f72 6d61 7428   pixels'.format(
-00061c70: 7365 6c66 2e78 7368 6966 7473 5b73 656c  self.xshifts[sel
-00061c80: 662e 6965 762c 7365 6c66 2e69 7468 6574  f.iev,self.ithet
-00061c90: 615d 2929 0d0a 2020 2020 2020 2020 2020  a]))..          
-00061ca0: 2020 7365 6c66 2e74 635f 7368 6966 7432    self.tc_shift2
-00061cb0: 2e73 6574 5465 7874 2827 5920 7368 6966  .setText('Y shif
-00061cc0: 743a 207b 303a 352e 3266 7d20 7069 7865  t: {0:5.2f} pixe
-00061cd0: 6c73 272e 666f 726d 6174 2873 656c 662e  ls'.format(self.
-00061ce0: 7973 6869 6674 735b 7365 6c66 2e69 6576  yshifts[self.iev
-00061cf0: 2c73 656c 662e 6974 6865 7461 5d29 290d  ,self.itheta])).
-00061d00: 0a0d 0a0d 0a20 2020 2020 2020 2023 7061  .....        #pa
-00061d10: 6e65 6c20 320d 0a20 2020 2020 2020 2076  nel 2..        v
-00061d20: 626f 7832 203d 2051 7457 6964 6765 7473  box2 = QtWidgets
-00061d30: 2e51 5642 6f78 4c61 796f 7574 2829 0d0a  .QVBoxLayout()..
-00061d40: 0d0a 2020 2020 2020 2020 7463 3220 3d20  ..        tc2 = 
-00061d50: 5174 5769 6467 6574 732e 514c 6162 656c  QtWidgets.QLabel
-00061d60: 2873 656c 6629 0d0a 2020 2020 2020 2020  (self)..        
-00061d70: 7463 322e 7365 7454 6578 7428 2743 726f  tc2.setText('Cro
-00061d80: 7373 2d63 6f72 7265 6c61 7469 6f6e 2729  ss-correlation')
-00061d90: 0d0a 0d0a 2020 2020 2020 2020 6672 616d  ....        fram
-00061da0: 6520 3d20 5174 5769 6467 6574 732e 5146  e = QtWidgets.QF
-00061db0: 7261 6d65 2829 0d0a 2020 2020 2020 2020  rame()..        
-00061dc0: 6672 616d 652e 7365 7446 7261 6d65 5374  frame.setFrameSt
-00061dd0: 796c 6528 5174 5769 6467 6574 732e 5146  yle(QtWidgets.QF
-00061de0: 7261 6d65 2e53 7479 6c65 6450 616e 656c  rame.StyledPanel
-00061df0: 7c51 7457 6964 6765 7473 2e51 4672 616d  |QtWidgets.QFram
-00061e00: 652e 5375 6e6b 656e 290d 0a20 2020 2020  e.Sunken)..     
-00061e10: 2020 2066 626f 7820 3d20 5174 5769 6467     fbox = QtWidg
-00061e20: 6574 732e 5148 426f 784c 6179 6f75 7428  ets.QHBoxLayout(
-00061e30: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-00061e40: 662e 6373 636f 7272 6669 6720 3d20 4669  f.cscorrfig = Fi
-00061e50: 6775 7265 2828 322e 342c 2032 2e34 2929  gure((2.4, 2.4))
-00061e60: 0d0a 2020 2020 2020 2020 7365 6c66 2e43  ..        self.C
-00061e70: 7363 6f72 7250 616e 656c 203d 2046 6967  scorrPanel = Fig
-00061e80: 7572 6543 616e 7661 7328 7365 6c66 2e63  ureCanvas(self.c
-00061e90: 7363 6f72 7266 6967 290d 0a20 2020 2020  scorrfig)..     
-00061ea0: 2020 2073 656c 662e 4373 636f 7272 5061     self.CscorrPa
-00061eb0: 6e65 6c2e 7365 7450 6172 656e 7428 7365  nel.setParent(se
-00061ec0: 6c66 290d 0a0d 0a20 2020 2020 2020 2066  lf)....        f
-00061ed0: 626f 782e 6164 6457 6964 6765 7428 7365  box.addWidget(se
-00061ee0: 6c66 2e43 7363 6f72 7250 616e 656c 290d  lf.CscorrPanel).
-00061ef0: 0a20 2020 2020 2020 2066 7261 6d65 2e73  .        frame.s
-00061f00: 6574 4c61 796f 7574 2866 626f 7829 0d0a  etLayout(fbox)..
-00061f10: 0d0a 2020 2020 2020 2020 7662 6f78 322e  ..        vbox2.
-00061f20: 6164 6457 6964 6765 7428 7463 3229 0d0a  addWidget(tc2)..
-00061f30: 2020 2020 2020 2020 7662 6f78 322e 6164          vbox2.ad
-00061f40: 6457 6964 6765 7428 6672 616d 6529 0d0a  dWidget(frame)..
-00061f50: 0d0a 0d0a 2020 2020 2020 2020 2370 616e  ....        #pan
-00061f60: 656c 2033 0d0a 2020 2020 2020 2020 7662  el 3..        vb
-00061f70: 6f78 3320 3d20 5174 5769 6467 6574 732e  ox3 = QtWidgets.
-00061f80: 5156 426f 784c 6179 6f75 7428 290d 0a0d  QVBoxLayout()...
-00061f90: 0a20 2020 2020 2020 2074 6333 3d20 5174  .        tc3= Qt
-00061fa0: 5769 6467 6574 732e 514c 6162 656c 2873  Widgets.QLabel(s
-00061fb0: 656c 6629 0d0a 2020 2020 2020 2020 7463  elf)..        tc
-00061fc0: 332e 7365 7454 6578 7428 2749 6d61 6765  3.setText('Image
-00061fd0: 2073 6869 6674 7327 290d 0a0d 0a20 2020   shifts')....   
-00061fe0: 2020 2020 2066 7261 6d65 203d 2051 7457       frame = QtW
-00061ff0: 6964 6765 7473 2e51 4672 616d 6528 290d  idgets.QFrame().
-00062000: 0a20 2020 2020 2020 2066 7261 6d65 2e73  .        frame.s
-00062010: 6574 4672 616d 6553 7479 6c65 2851 7457  etFrameStyle(QtW
-00062020: 6964 6765 7473 2e51 4672 616d 652e 5374  idgets.QFrame.St
-00062030: 796c 6564 5061 6e65 6c7c 5174 5769 6467  yledPanel|QtWidg
-00062040: 6574 732e 5146 7261 6d65 2e53 756e 6b65  ets.QFrame.Sunke
-00062050: 6e29 0d0a 2020 2020 2020 2020 6662 6f78  n)..        fbox
-00062060: 203d 2051 7457 6964 6765 7473 2e51 4842   = QtWidgets.QHB
-00062070: 6f78 4c61 796f 7574 2829 0d0a 0d0a 2020  oxLayout()....  
-00062080: 2020 2020 2020 7365 6c66 2e73 6869 6674        self.shift
-00062090: 7366 6967 203d 2046 6967 7572 6528 2834  sfig = Figure((4
-000620a0: 2e30 2c20 322e 3429 290d 0a20 2020 2020  .0, 2.4))..     
-000620b0: 2020 2073 656c 662e 5368 6966 7473 5061     self.ShiftsPa
-000620c0: 6e65 6c20 3d20 4669 6775 7265 4361 6e76  nel = FigureCanv
-000620d0: 6173 2873 656c 662e 7368 6966 7473 6669  as(self.shiftsfi
-000620e0: 6729 0d0a 2020 2020 2020 2020 7365 6c66  g)..        self
-000620f0: 2e53 6869 6674 7350 616e 656c 2e73 6574  .ShiftsPanel.set
-00062100: 5061 7265 6e74 2873 656c 6629 0d0a 2020  Parent(self)..  
-00062110: 2020 2020 2020 7365 6c66 2e53 6869 6674        self.Shift
-00062120: 7350 616e 656c 2e6d 706c 5f63 6f6e 6e65  sPanel.mpl_conne
-00062130: 6374 2827 6275 7474 6f6e 5f70 7265 7373  ct('button_press
-00062140: 5f65 7665 6e74 272c 2073 656c 662e 4f6e  _event', self.On
-00062150: 506c 6f74 5368 6966 7473 290d 0a0d 0a20  PlotShifts).... 
-00062160: 2020 2020 2020 2066 626f 782e 6164 6457         fbox.addW
-00062170: 6964 6765 7428 7365 6c66 2e53 6869 6674  idget(self.Shift
-00062180: 7350 616e 656c 290d 0a20 2020 2020 2020  sPanel)..       
-00062190: 2066 7261 6d65 2e73 6574 4c61 796f 7574   frame.setLayout
-000621a0: 2866 626f 7829 0d0a 0d0a 2020 2020 2020  (fbox)....      
-000621b0: 2020 7662 6f78 332e 6164 6457 6964 6765    vbox3.addWidge
-000621c0: 7428 7463 3329 0d0a 2020 2020 2020 2020  t(tc3)..        
-000621d0: 7662 6f78 332e 6164 6457 6964 6765 7428  vbox3.addWidget(
-000621e0: 6672 616d 6529 0d0a 0d0a 0d0a 2020 2020  frame)......    
-000621f0: 2020 2020 2370 616e 656c 2039 0d0a 2020      #panel 9..  
-00062200: 2020 2020 2020 7662 6f78 3920 3d20 5174        vbox9 = Qt
-00062210: 5769 6467 6574 732e 5156 426f 784c 6179  Widgets.QVBoxLay
-00062220: 6f75 7428 290d 0a20 2020 2020 2020 2076  out()..        v
-00062230: 626f 7839 2e73 6574 5370 6163 696e 6728  box9.setSpacing(
-00062240: 3029 0d0a 0d0a 2020 2020 2020 2020 6772  0)....        gr
-00062250: 6f75 7042 6f78 3920 3d20 5174 5769 6467  oupBox9 = QtWidg
-00062260: 6574 732e 5147 726f 7570 426f 7828 290d  ets.QGroupBox().
-00062270: 0a20 2020 2020 2020 2073 656c 662e 7262  .        self.rb
-00062280: 5f61 7574 6f20 3d20 5174 5769 6467 6574  _auto = QtWidget
-00062290: 732e 5152 6164 696f 4275 7474 6f6e 2820  s.QRadioButton( 
-000622a0: 2741 7574 6f6d 6174 6963 2041 6c69 676e  'Automatic Align
-000622b0: 6d65 6e74 2729 0d0a 2020 2020 2020 2020  ment')..        
-000622c0: 7365 6c66 2e72 625f 6d61 6e20 3d20 5174  self.rb_man = Qt
-000622d0: 5769 6467 6574 732e 5152 6164 696f 4275  Widgets.QRadioBu
-000622e0: 7474 6f6e 2827 4d61 6e75 616c 2041 6c69  tton('Manual Ali
-000622f0: 676e 6d65 6e74 2729 0d0a 2020 2020 2020  gnment')..      
-00062300: 2020 7365 6c66 2e72 625f 6175 746f 2e73    self.rb_auto.s
-00062310: 6574 4368 6563 6b65 6428 5472 7565 290d  etChecked(True).
-00062320: 0a20 2020 2020 2020 2073 656c 662e 7262  .        self.rb
-00062330: 5f61 7574 6f2e 746f 6767 6c65 642e 636f  _auto.toggled.co
-00062340: 6e6e 6563 7428 7365 6c66 2e4f 6e72 625f  nnect(self.Onrb_
-00062350: 6175 746f 6d61 6e75 616c 290d 0a0d 0a20  automanual).... 
-00062360: 2020 2020 2020 2076 626f 7839 2e61 6464         vbox9.add
-00062370: 5769 6467 6574 2873 656c 662e 7262 5f61  Widget(self.rb_a
-00062380: 7574 6f29 0d0a 2020 2020 2020 2020 7662  uto)..        vb
-00062390: 6f78 392e 6164 6457 6964 6765 7428 7365  ox9.addWidget(se
-000623a0: 6c66 2e72 625f 6d61 6e29 0d0a 2020 2020  lf.rb_man)..    
-000623b0: 2020 2020 6772 6f75 7042 6f78 392e 7365      groupBox9.se
-000623c0: 744c 6179 6f75 7428 7662 6f78 3929 0d0a  tLayout(vbox9)..
-000623d0: 0d0a 2020 2020 2020 2020 2370 616e 656c  ..        #panel
-000623e0: 2038 0d0a 2020 2020 2020 2020 7369 7a65   8..        size
-000623f0: 7238 203d 2051 7457 6964 6765 7473 2e51  r8 = QtWidgets.Q
-00062400: 4772 6f75 7042 6f78 2827 5468 6973 2049  GroupBox('This I
-00062410: 6d61 6765 2729 0d0a 2020 2020 2020 2020  mage')..        
-00062420: 7662 6f78 3820 3d20 5174 5769 6467 6574  vbox8 = QtWidget
-00062430: 732e 5156 426f 784c 6179 6f75 7428 290d  s.QVBoxLayout().
-00062440: 0a20 2020 2020 2020 2076 626f 7838 2e73  .        vbox8.s
-00062450: 6574 5370 6163 696e 6728 3029 0d0a 0d0a  etSpacing(0)....
-00062460: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-00062470: 746f 6e5f 7265 6669 6d67 203d 2051 7457  ton_refimg = QtW
-00062480: 6964 6765 7473 2e51 5075 7368 4275 7474  idgets.QPushButt
-00062490: 6f6e 2827 5365 7420 6173 2052 6566 6572  on('Set as Refer
-000624a0: 656e 6365 2049 6d61 6765 2729 0d0a 2020  ence Image')..  
-000624b0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
-000624c0: 6e5f 7265 6669 6d67 2e63 6c69 636b 6564  n_refimg.clicked
-000624d0: 2e63 6f6e 6e65 6374 2873 656c 662e 5365  .connect(self.Se
-000624e0: 7452 6566 496d 6167 6529 0d0a 2020 2020  tRefImage)..    
-000624f0: 2020 2020 7662 6f78 382e 6164 6457 6964      vbox8.addWid
-00062500: 6765 7428 7365 6c66 2e62 7574 746f 6e5f  get(self.button_
-00062510: 7265 6669 6d67 290d 0a0d 0a20 2020 2020  refimg)....     
-00062520: 2020 2073 656c 662e 6275 7474 6f6e 5f72     self.button_r
-00062530: 6566 696d 6773 6176 6520 3d20 5174 5769  efimgsave = QtWi
-00062540: 6467 6574 732e 5150 7573 6842 7574 746f  dgets.QPushButto
-00062550: 6e28 2753 6176 6520 5265 6665 7265 6e63  n('Save Referenc
-00062560: 6520 496d 6167 6527 290d 0a20 2020 2020  e Image')..     
-00062570: 2020 2073 656c 662e 6275 7474 6f6e 5f72     self.button_r
-00062580: 6566 696d 6773 6176 652e 636c 6963 6b65  efimgsave.clicke
-00062590: 642e 636f 6e6e 6563 7428 7365 6c66 2e53  d.connect(self.S
-000625a0: 6176 6552 6566 496d 6167 6529 0d0a 2020  aveRefImage)..  
-000625b0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
-000625c0: 6e5f 7265 6669 6d67 7361 7665 2e73 6574  n_refimgsave.set
-000625d0: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
-000625e0: 2020 2020 2020 2020 7662 6f78 382e 6164          vbox8.ad
-000625f0: 6457 6964 6765 7428 7365 6c66 2e62 7574  dWidget(self.but
-00062600: 746f 6e5f 7265 6669 6d67 7361 7665 290d  ton_refimgsave).
-00062610: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00062620: 6275 7474 6f6e 5f72 6566 696d 6773 6c6f  button_refimgslo
-00062630: 6164 203d 2051 7457 6964 6765 7473 2e51  ad = QtWidgets.Q
-00062640: 5075 7368 4275 7474 6f6e 2827 4c6f 6164  PushButton('Load
-00062650: 2052 6566 6572 656e 6365 2049 6d61 6765   Reference Image
-00062660: 2729 0d0a 2020 2020 2020 2020 7365 6c66  ')..        self
-00062670: 2e62 7574 746f 6e5f 7265 6669 6d67 736c  .button_refimgsl
-00062680: 6f61 642e 636c 6963 6b65 642e 636f 6e6e  oad.clicked.conn
-00062690: 6563 7428 7365 6c66 2e4c 6f61 6452 6566  ect(self.LoadRef
-000626a0: 496d 6167 6529 0d0a 2020 2020 2020 2020  Image)..        
-000626b0: 7662 6f78 382e 6164 6457 6964 6765 7428  vbox8.addWidget(
-000626c0: 7365 6c66 2e62 7574 746f 6e5f 7265 6669  self.button_refi
-000626d0: 6d67 736c 6f61 6429 0d0a 0d0a 2020 2020  mgsload)....    
-000626e0: 2020 2020 6c69 6e65 203d 2051 7457 6964      line = QtWid
-000626f0: 6765 7473 2e51 4672 616d 6528 290d 0a20  gets.QFrame().. 
-00062700: 2020 2020 2020 206c 696e 652e 7365 7446         line.setF
-00062710: 7261 6d65 5368 6170 6528 5174 5769 6467  rameShape(QtWidg
-00062720: 6574 732e 5146 7261 6d65 2e48 4c69 6e65  ets.QFrame.HLine
-00062730: 290d 0a20 2020 2020 2020 206c 696e 652e  )..        line.
-00062740: 7365 7446 7261 6d65 5368 6164 6f77 2851  setFrameShadow(Q
-00062750: 7457 6964 6765 7473 2e51 4672 616d 652e  tWidgets.QFrame.
-00062760: 5375 6e6b 656e 290d 0a0d 0a20 2020 2020  Sunken)....     
-00062770: 2020 2076 626f 7838 2e61 6464 5370 6163     vbox8.addSpac
-00062780: 696e 6728 3529 0d0a 2020 2020 2020 2020  ing(5)..        
-00062790: 7662 6f78 382e 6164 6457 6964 6765 7428  vbox8.addWidget(
-000627a0: 6c69 6e65 290d 0a20 2020 2020 2020 2076  line)..        v
-000627b0: 626f 7838 2e61 6464 5370 6163 696e 6728  box8.addSpacing(
-000627c0: 3529 0d0a 0d0a 2020 2020 2020 2020 7365  5)....        se
-000627d0: 6c66 2e62 7574 746f 6e5f 7265 6d6f 7665  lf.button_remove
-000627e0: 203d 2051 7457 6964 6765 7473 2e51 5075   = QtWidgets.QPu
-000627f0: 7368 4275 7474 6f6e 2827 5265 6d6f 7665  shButton('Remove
-00062800: 2065 6e65 7267 7920 6672 6f6d 2073 7461   energy from sta
-00062810: 636b 2729 0d0a 2020 2020 2020 2020 7365  ck')..        se
-00062820: 6c66 2e62 7574 746f 6e5f 7265 6d6f 7665  lf.button_remove
-00062830: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
-00062840: 2873 656c 662e 4f6e 5265 6d6f 7665 496d  (self.OnRemoveIm
-00062850: 6167 6529 0d0a 2020 2020 2020 2020 7662  age)..        vb
-00062860: 6f78 382e 6164 6457 6964 6765 7428 7365  ox8.addWidget(se
-00062870: 6c66 2e62 7574 746f 6e5f 7265 6d6f 7665  lf.button_remove
-00062880: 290d 0a0d 0a20 2020 2020 2020 2073 697a  )....        siz
-00062890: 6572 382e 7365 744c 6179 6f75 7428 7662  er8.setLayout(vb
-000628a0: 6f78 3829 0d0a 0d0a 0d0a 2020 2020 2020  ox8)......      
-000628b0: 2020 2370 616e 656c 2034 0d0a 2020 2020    #panel 4..    
-000628c0: 2020 2020 7369 7a65 7234 203d 2051 7457      sizer4 = QtW
-000628d0: 6964 6765 7473 2e51 4772 6f75 7042 6f78  idgets.QGroupBox
-000628e0: 2827 4175 746f 6d61 7469 6320 416c 6967  ('Automatic Alig
-000628f0: 6e6d 656e 7427 290d 0a20 2020 2020 2020  nment')..       
-00062900: 2076 626f 7834 203d 2051 7457 6964 6765   vbox4 = QtWidge
-00062910: 7473 2e51 5642 6f78 4c61 796f 7574 2829  ts.QVBoxLayout()
-00062920: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7365  ......        se
-00062930: 6c66 2e62 7574 746f 6e5f 7265 6769 7374  lf.button_regist
-00062940: 6572 203d 2051 7457 6964 6765 7473 2e51  er = QtWidgets.Q
-00062950: 5075 7368 4275 7474 6f6e 2827 4361 6c63  PushButton('Calc
-00062960: 756c 6174 6520 696d 6167 6520 7368 6966  ulate image shif
-00062970: 7473 2729 0d0a 2020 2020 2020 2020 7365  ts')..        se
-00062980: 6c66 2e62 7574 746f 6e5f 7265 6769 7374  lf.button_regist
-00062990: 6572 2e63 6c69 636b 6564 2e63 6f6e 6e65  er.clicked.conne
-000629a0: 6374 2873 656c 662e 4f6e 4361 6c63 5265  ct(self.OnCalcRe
-000629b0: 6769 7374 7261 7469 6f6e 290d 0a20 2020  gistration)..   
-000629c0: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-000629d0: 5f72 6567 6973 7465 722e 7365 7445 6e61  _register.setEna
-000629e0: 626c 6564 2846 616c 7365 290d 0a20 2020  bled(False)..   
-000629f0: 2020 2020 2076 626f 7834 2e61 6464 5769       vbox4.addWi
-00062a00: 6467 6574 2873 656c 662e 6275 7474 6f6e  dget(self.button
-00062a10: 5f72 6567 6973 7465 7229 0d0a 2020 2020  _register)..    
-00062a20: 2020 2020 2376 626f 7834 2e61 6464 5374      #vbox4.addSt
-00062a30: 7265 7463 6828 3129 0d0a 0d0a 2020 2020  retch(1)....    
-00062a40: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-00062a50: 7375 6272 6567 696f 6e20 3d20 5174 5769  subregion = QtWi
-00062a60: 6467 6574 732e 5150 7573 6842 7574 746f  dgets.QPushButto
-00062a70: 6e28 2753 656c 6563 7420 7375 6272 6567  n('Select subreg
-00062a80: 696f 6e20 6f6e 2072 6566 6572 656e 6365  ion on reference
-00062a90: 2729 0d0a 2020 2020 2020 2020 7365 6c66  ')..        self
+0005f8e0: 2d0d 0a20 2020 2064 6566 204f 6e43 616e  -..    def OnCan
+0005f8f0: 6365 6c28 7365 6c66 2c20 6576 7429 3a0d  cel(self, evt):.
+0005f900: 0a20 2020 2020 2020 2073 656c 662e 636c  .        self.cl
+0005f910: 6f73 6528 290d 0a20 2020 2023 202d 2d2d  ose()..    # ---
+0005f920: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005f930: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005f940: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005f950: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0005f960: 2d2d 2d0d 0a20 2020 2064 6566 204f 6e41  ---..    def OnA
+0005f970: 6363 6570 7428 7365 6c66 2c20 6576 7429  ccept(self, evt)
+0005f980: 3a0d 0a20 2020 2020 2020 2069 6620 7365  :..        if se
+0005f990: 6c66 2e63 625f 6372 6f70 746f 726f 692e  lf.cb_croptoroi.
+0005f9a0: 6973 4368 6563 6b65 6428 293a 0d0a 2020  isChecked():..  
+0005f9b0: 2020 2020 2020 2020 2020 6c65 6674 2c20            left, 
+0005f9c0: 7269 6768 742c 2074 6f70 2c20 626f 7474  right, top, bott
+0005f9d0: 6f6d 203d 2073 656c 662e 4765 7452 6567  om = self.GetReg
+0005f9e0: 696f 6e28 290d 0a20 2020 2020 2020 2065  ion()..        e
+0005f9f0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0005fa00: 2020 6c65 6674 2c20 7269 6768 742c 2074    left, right, t
+0005fa10: 6f70 2c20 626f 7474 6f6d 203d 2028 4e6f  op, bottom = (No
+0005fa20: 6e65 2c4e 6f6e 652c 4e6f 6e65 2c4e 6f6e  ne,None,None,Non
+0005fa30: 6529 0d0a 0d0a 2020 2020 2020 2020 6966  e)....        if
+0005fa40: 2073 656c 662e 6362 5f72 656d 6f76 655f   self.cb_remove_
+0005fa50: 6576 732e 6973 4368 6563 6b65 6428 293a  evs.isChecked():
+0005fa60: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0005fa70: 6c65 6374 696f 6e20 3d20 7365 6c66 2e69  lection = self.i
+0005fa80: 6478 5f73 656c 6563 7465 640d 0a20 2020  dx_selected..   
+0005fa90: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0005faa0: 7365 6c65 6374 696f 6e29 203d 3d20 303a  selection) == 0:
+0005fab0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005fac0: 2020 5174 5769 6467 6574 732e 514d 6573    QtWidgets.QMes
+0005fad0: 7361 6765 426f 782e 7761 726e 696e 6728  sageBox.warning(
+0005fae0: 7365 6c66 2c20 2745 7272 6f72 272c 2027  self, 'Error', '
+0005faf0: 506c 6561 7365 2073 656c 6563 7420 6174  Please select at
+0005fb00: 206c 6561 7374 206f 6e65 2065 6e65 7267   least one energ
+0005fb10: 7920 7661 6c75 6521 2729 0d0a 2020 2020  y value!')..    
+0005fb20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0005fb30: 726e 0d0a 2020 2020 2020 2020 2020 2020  rn..            
+0005fb40: 7365 6c66 2e73 7461 636b 2e6e 5f65 7620  self.stack.n_ev 
+0005fb50: 3d20 6e70 2e61 7272 6179 286c 656e 2873  = np.array(len(s
+0005fb60: 656c 6563 7469 6f6e 2929 0d0a 2020 2020  election))..    
+0005fb70: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
+0005fb80: 636b 2e65 7620 3d20 7365 6c66 2e73 7461  ck.ev = self.sta
+0005fb90: 636b 2e65 765b 7365 6c65 6374 696f 6e5d  ck.ev[selection]
+0005fba0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0005fbb0: 6c66 2e73 7461 636b 2e64 6174 615f 6477  lf.stack.data_dw
+0005fbc0: 656c 6c20 3d20 7365 6c66 2e73 7461 636b  ell = self.stack
+0005fbd0: 2e64 6174 615f 6477 656c 6c5b 7365 6c65  .data_dwell[sele
+0005fbe0: 6374 696f 6e5d 0d0a 2020 2020 2020 2020  ction]..        
+0005fbf0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0005fc00: 2020 2073 656c 6563 7469 6f6e 203d 206c     selection = l
+0005fc10: 6973 7428 7261 6e67 6528 7365 6c66 2e73  ist(range(self.s
+0005fc20: 7461 636b 2e6e 5f65 7629 290d 0a0d 0a0d  tack.n_ev)).....
+0005fc30: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
+0005fc40: 6163 6b2e 6162 7364 6174 6120 3d20 7365  ack.absdata = se
+0005fc50: 6c66 2e73 7461 636b 2e61 6273 6461 7461  lf.stack.absdata
+0005fc60: 5b6c 6566 743a 7269 6768 742c 626f 7474  [left:right,bott
+0005fc70: 6f6d 3a74 6f70 2c73 656c 6563 7469 6f6e  om:top,selection
+0005fc80: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
+0005fc90: 7374 6163 6b2e 6e5f 636f 6c73 203d 2073  stack.n_cols = s
+0005fca0: 656c 662e 7374 6163 6b2e 6162 7364 6174  elf.stack.absdat
+0005fcb0: 612e 7368 6170 655b 305d 0d0a 2020 2020  a.shape[0]..    
+0005fcc0: 2020 2020 7365 6c66 2e73 7461 636b 2e6e      self.stack.n
+0005fcd0: 5f72 6f77 7320 3d20 7365 6c66 2e73 7461  _rows = self.sta
+0005fce0: 636b 2e61 6273 6461 7461 2e73 6861 7065  ck.absdata.shape
+0005fcf0: 5b31 5d0d 0a20 2020 2020 2020 2073 656c  [1]..        sel
+0005fd00: 662e 7061 7265 6e74 2e70 6167 6531 2e69  f.parent.page1.i
+0005fd10: 7820 3d20 696e 7428 7365 6c66 2e73 7461  x = int(self.sta
+0005fd20: 636b 2e6e 5f63 6f6c 732f 3229 0d0a 2020  ck.n_cols/2)..  
+0005fd30: 2020 2020 2020 7365 6c66 2e70 6172 656e        self.paren
+0005fd40: 742e 7061 6765 312e 6979 203d 2069 6e74  t.page1.iy = int
+0005fd50: 2873 656c 662e 7374 6163 6b2e 6e5f 726f  (self.stack.n_ro
+0005fd60: 7773 2f32 290d 0a0d 0a20 2020 2020 2020  ws/2)....       
+0005fd70: 2069 6620 7365 6c66 2e63 6f6d 2e73 7461   if self.com.sta
+0005fd80: 636b 5f34 643a 0d0a 2020 2020 2020 2020  ck_4d:..        
+0005fd90: 2020 2020 6966 2073 656c 662e 6362 5f72      if self.cb_r
+0005fda0: 656d 6f76 655f 7468 6574 612e 6973 4368  emove_theta.isCh
+0005fdb0: 6563 6b65 6428 293a 0d0a 2020 2020 2020  ecked():..      
+0005fdc0: 2020 2020 2020 2020 2020 7468 6574 6173            thetas
+0005fdd0: 203d 2073 656c 662e 7468 6574 6169 6478   = self.thetaidx
+0005fde0: 5f73 656c 6563 7465 640d 0a20 2020 2020  _selected..     
+0005fdf0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+0005fe00: 6e28 7468 6574 6173 2920 3d3d 2030 3a0d  n(thetas) == 0:.
+0005fe10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005fe20: 2020 2020 2051 7457 6964 6765 7473 2e51       QtWidgets.Q
+0005fe30: 4d65 7373 6167 6542 6f78 2e77 6172 6e69  MessageBox.warni
+0005fe40: 6e67 2873 656c 662c 2027 4572 726f 7227  ng(self, 'Error'
+0005fe50: 2c20 2750 6c65 6173 6520 7365 6c65 6374  , 'Please select
+0005fe60: 2061 7420 6c65 6173 7420 6f6e 6520 7468   at least one th
+0005fe70: 6574 6120 7661 6c75 6521 2729 0d0a 2020  eta value!')..  
+0005fe80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005fe90: 2020 7265 7475 726e 0d0a 2020 2020 2020    return..      
+0005fea0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0005feb0: 7461 636b 2e6e 5f74 6865 7461 203d 206c  tack.n_theta = l
+0005fec0: 656e 2874 6865 7461 7329 0d0a 2020 2020  en(thetas)..    
+0005fed0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0005fee0: 2e73 7461 636b 2e74 6865 7461 203d 2073  .stack.theta = s
+0005fef0: 656c 662e 7374 6163 6b2e 7468 6574 615b  elf.stack.theta[
+0005ff00: 7468 6574 6173 5d0d 0a0d 0a20 2020 2020  thetas]....     
+0005ff10: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0005ff20: 2020 2020 2020 2020 2020 2020 2020 7468                th
+0005ff30: 6574 6173 203d 206c 6973 7428 7261 6e67  etas = list(rang
+0005ff40: 6528 7365 6c66 2e73 7461 636b 2e6e 5f74  e(self.stack.n_t
+0005ff50: 6865 7461 2929 0d0a 2020 2020 2020 2020  heta))..        
+0005ff60: 2020 2020 7365 6c66 2e73 7461 636b 2e73      self.stack.s
+0005ff70: 7461 636b 3444 203d 2073 656c 662e 7374  tack4D = self.st
+0005ff80: 6163 6b2e 7374 6163 6b34 445b 6c65 6674  ack.stack4D[left
+0005ff90: 3a72 6967 6874 2c20 626f 7474 6f6d 3a74  :right, bottom:t
+0005ffa0: 6f70 2c20 7365 6c65 6374 696f 6e2c 203a  op, selection, :
+0005ffb0: 5d0d 0a20 2020 2020 2020 2020 2020 2073  ]..            s
+0005ffc0: 656c 662e 7374 6163 6b2e 7374 6163 6b34  elf.stack.stack4
+0005ffd0: 4420 3d20 7365 6c66 2e73 7461 636b 2e73  D = self.stack.s
+0005ffe0: 7461 636b 3444 5b3a 2c3a 2c20 3a2c 2074  tack4D[:,:, :, t
+0005fff0: 6865 7461 735d 0d0a 2020 2020 2020 2020  hetas]..        
+00060000: 6966 2073 656c 662e 636f 6d2e 6930 5f6c  if self.com.i0_l
+00060010: 6f61 6465 643a 0d0a 2020 2020 2020 2020  oaded:..        
+00060020: 2020 2020 6966 2073 656c 662e 636f 6d2e      if self.com.
+00060030: 7374 6163 6b5f 3464 3a0d 0a20 2020 2020  stack_4d:..     
+00060040: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00060050: 7374 6163 6b2e 6f64 3444 203d 2073 656c  stack.od4D = sel
+00060060: 662e 7374 6163 6b2e 6f64 3444 5b6c 6566  f.stack.od4D[lef
+00060070: 743a 7269 6768 742c 626f 7474 6f6d 3a74  t:right,bottom:t
+00060080: 6f70 2c73 656c 6563 7469 6f6e 2c20 7468  op,selection, th
+00060090: 6574 6173 5d0d 0a20 2020 2020 2020 2020  etas]..         
+000600a0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000600b0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+000600c0: 7461 636b 2e6f 6433 6420 3d20 2073 656c  tack.od3d =  sel
+000600d0: 662e 7374 6163 6b2e 6f64 3364 5b6c 6566  f.stack.od3d[lef
+000600e0: 743a 7269 6768 742c 626f 7474 6f6d 3a74  t:right,bottom:t
+000600f0: 6f70 2c73 656c 6563 7469 6f6e 5d0d 0a20  op,selection].. 
+00060100: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00060110: 656c 662e 7374 6163 6b2e 6f64 203d 2073  elf.stack.od = s
+00060120: 656c 662e 7374 6163 6b2e 6f64 3364 2e63  elf.stack.od3d.c
+00060130: 6f70 7928 290d 0a20 2020 2020 2020 2020  opy()..         
+00060140: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
+00060150: 6b2e 6f64 203d 206e 702e 7265 7368 6170  k.od = np.reshap
+00060160: 6528 7365 6c66 2e73 7461 636b 2e6f 642c  e(self.stack.od,
+00060170: 2028 7365 6c66 2e73 7461 636b 2e6e 5f72   (self.stack.n_r
+00060180: 6f77 7320 2a20 7365 6c66 2e73 7461 636b  ows * self.stack
+00060190: 2e6e 5f63 6f6c 732c 2073 656c 662e 7374  .n_cols, self.st
+000601a0: 6163 6b2e 6e5f 6576 292c 0d0a 2020 2020  ack.n_ev),..    
+000601b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000601c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000601d0: 2020 206f 7264 6572 3d27 4627 290d 0a0d     order='F')...
+000601e0: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
+000601f0: 6163 6b2e 6669 6c6c 5f68 355f 7374 7275  ack.fill_h5_stru
+00060200: 6374 5f66 726f 6d5f 7374 6b28 290d 0a20  ct_from_stk().. 
+00060210: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
+00060220: 6f6d 2e69 305f 6c6f 6164 6564 203d 3d20  om.i0_loaded == 
+00060230: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+00060240: 7365 6c66 2e73 7461 636b 2e66 696c 6c5f  self.stack.fill_
+00060250: 6835 5f73 7472 7563 745f 6e6f 726d 616c  h5_struct_normal
+00060260: 697a 6174 696f 6e28 290d 0a0d 0a20 2020  ization()....   
+00060270: 2020 2020 2023 2046 6978 2074 6865 2073       # Fix the s
+00060280: 6c69 6465 7220 6f6e 2050 6167 6520 3121  lider on Page 1!
+00060290: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+000602a0: 662e 636f 6d2e 7374 6163 6b5f 3464 3a0d  f.com.stack_4d:.
+000602b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000602c0: 662e 7061 7265 6e74 2e70 6167 6531 2e73  f.parent.page1.s
+000602d0: 6c69 6465 725f 7468 6574 612e 7365 7452  lider_theta.setR
+000602e0: 616e 6765 2830 2c20 7365 6c66 2e73 7461  ange(0, self.sta
+000602f0: 636b 2e6e 5f74 6865 7461 202d 2031 290d  ck.n_theta - 1).
+00060300: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00060310: 662e 7061 7265 6e74 2e70 6167 6531 2e69  f.parent.page1.i
+00060320: 7468 6574 6120 3d20 300d 0a20 2020 2020  theta = 0..     
+00060330: 2020 2020 2020 2073 656c 662e 7061 7265         self.pare
+00060340: 6e74 2e70 6167 6531 2e73 6c69 6465 725f  nt.page1.slider_
+00060350: 7468 6574 612e 626c 6f63 6b53 6967 6e61  theta.blockSigna
+00060360: 6c73 2854 7275 6529 0d0a 2020 2020 2020  ls(True)..      
+00060370: 2020 2020 2020 7365 6c66 2e70 6172 656e        self.paren
+00060380: 742e 7061 6765 312e 736c 6964 6572 5f74  t.page1.slider_t
+00060390: 6865 7461 2e73 6574 5661 6c75 6528 696e  heta.setValue(in
+000603a0: 7428 7365 6c66 2e70 6172 656e 742e 7061  t(self.parent.pa
+000603b0: 6765 312e 6974 6865 7461 2929 0d0a 2020  ge1.itheta))..  
+000603c0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+000603d0: 6172 656e 742e 7061 6765 312e 736c 6964  arent.page1.slid
+000603e0: 6572 5f74 6865 7461 2e62 6c6f 636b 5369  er_theta.blockSi
+000603f0: 676e 616c 7328 4661 6c73 6529 0d0a 0d0a  gnals(False)....
+00060400: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00060410: 2e70 6172 656e 742e 7061 6765 302e 736c  .parent.page0.sl
+00060420: 6964 6572 5f74 6865 7461 2e73 6574 5261  ider_theta.setRa
+00060430: 6e67 6528 302c 2073 656c 662e 7374 6163  nge(0, self.stac
+00060440: 6b2e 6e5f 7468 6574 6120 2d20 3129 0d0a  k.n_theta - 1)..
+00060450: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00060460: 2e70 6172 656e 742e 7061 6765 302e 6974  .parent.page0.it
+00060470: 6865 7461 203d 2030 0d0a 2020 2020 2020  heta = 0..      
+00060480: 2020 2020 2020 7365 6c66 2e70 6172 656e        self.paren
+00060490: 742e 7061 6765 302e 736c 6964 6572 5f74  t.page0.slider_t
+000604a0: 6865 7461 2e62 6c6f 636b 5369 676e 616c  heta.blockSignal
+000604b0: 7328 5472 7565 290d 0a20 2020 2020 2020  s(True)..       
+000604c0: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
+000604d0: 2e70 6167 6530 2e73 6c69 6465 725f 7468  .page0.slider_th
+000604e0: 6574 612e 7365 7456 616c 7565 2869 6e74  eta.setValue(int
+000604f0: 2873 656c 662e 7061 7265 6e74 2e70 6167  (self.parent.pag
+00060500: 6531 2e69 7468 6574 6129 290d 0a20 2020  e1.itheta))..   
+00060510: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
+00060520: 7265 6e74 2e70 6167 6530 2e73 6c69 6465  rent.page0.slide
+00060530: 725f 7468 6574 612e 626c 6f63 6b53 6967  r_theta.blockSig
+00060540: 6e61 6c73 2846 616c 7365 290d 0a0d 0a20  nals(False).... 
+00060550: 2020 2020 2020 2073 656c 662e 7061 7265         self.pare
+00060560: 6e74 2e70 6167 6531 2e73 6c69 6465 725f  nt.page1.slider_
+00060570: 656e 672e 7365 7452 616e 6765 2830 2c20  eng.setRange(0, 
+00060580: 7365 6c66 2e73 7461 636b 2e6e 5f65 7620  self.stack.n_ev 
+00060590: 2d20 3129 0d0a 2020 2020 2020 2020 7365  - 1)..        se
+000605a0: 6c66 2e70 6172 656e 742e 7061 6765 312e  lf.parent.page1.
+000605b0: 6965 7620 3d20 300d 0a20 2020 2020 2020  iev = 0..       
+000605c0: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
+000605d0: 6531 2e73 6c69 6465 725f 656e 672e 7365  e1.slider_eng.se
+000605e0: 7456 616c 7565 2869 6e74 2873 656c 662e  tValue(int(self.
+000605f0: 7061 7265 6e74 2e70 6167 6531 2e69 6576  parent.page1.iev
+00060600: 2929 0d0a 0d0a 2020 2020 2020 2020 7365  ))....        se
+00060610: 6c66 2e70 6172 656e 742e 7061 6765 302e  lf.parent.page0.
+00060620: 736c 6964 6572 5f65 6e67 2e73 6574 5261  slider_eng.setRa
+00060630: 6e67 6528 302c 2073 656c 662e 7374 6163  nge(0, self.stac
+00060640: 6b2e 6e5f 6576 202d 2031 290d 0a20 2020  k.n_ev - 1)..   
+00060650: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
+00060660: 2e70 6167 6530 2e69 6576 203d 2030 0d0a  .page0.iev = 0..
+00060670: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
+00060680: 656e 742e 7061 6765 302e 736c 6964 6572  ent.page0.slider
+00060690: 5f65 6e67 2e73 6574 5661 6c75 6528 696e  _eng.setValue(in
+000606a0: 7428 7365 6c66 2e70 6172 656e 742e 7061  t(self.parent.pa
+000606b0: 6765 312e 6965 7629 290d 0a0d 0a20 2020  ge1.iev))....   
+000606c0: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
+000606d0: 2e70 6167 6531 2e73 686f 7753 7065 6374  .page1.showSpect
+000606e0: 7275 6d28 7365 6c66 2e70 6172 656e 742e  rum(self.parent.
+000606f0: 7061 6765 312e 6978 2c20 7365 6c66 2e70  page1.ix, self.p
+00060700: 6172 656e 742e 7061 6765 312e 6979 290d  arent.page1.iy).
+00060710: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+00060720: 7265 6e74 2e70 6167 6531 2e6c 6f61 6449  rent.page1.loadI
+00060730: 6d61 6765 2829 0d0a 2020 2020 2020 2020  mage()..        
+00060740: 7365 6c66 2e70 6172 656e 742e 7061 6765  self.parent.page
+00060750: 302e 436c 6561 7228 290d 0a20 2020 2020  0.Clear()..     
+00060760: 2020 2073 656c 662e 7061 7265 6e74 2e70     self.parent.p
+00060770: 6167 6530 2e4c 6f61 6445 6e74 7269 6573  age0.LoadEntries
+00060780: 2829 0d0a 0d0a 2020 2020 2020 2020 6966  ()....        if
+00060790: 2073 686f 776d 6170 7461 623a 0d0a 2020   showmaptab:..  
+000607a0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+000607b0: 6172 656e 742e 7061 6765 392e 436c 6561  arent.page9.Clea
+000607c0: 7228 290d 0a20 2020 2020 2020 2020 2020  r()..           
+000607d0: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
+000607e0: 6539 2e4c 6f61 6445 6e74 7269 6573 2829  e9.LoadEntries()
+000607f0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00060800: 2e63 6c6f 7365 2829 0d0a 0d0a 636c 6173  .close()....clas
+00060810: 7320 496d 6167 6552 6567 6973 7472 6174  s ImageRegistrat
+00060820: 696f 6e44 6961 6c6f 6728 5174 5769 6467  ionDialog(QtWidg
+00060830: 6574 732e 5144 6961 6c6f 6729 3a0d 0a0d  ets.QDialog):...
+00060840: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00060850: 5f28 7365 6c66 2c20 7061 7265 6e74 2c20  _(self, parent, 
+00060860: 636f 6d6d 6f6e 293a 0d0a 2020 2020 2020  common):..      
+00060870: 2020 5174 5769 6467 6574 732e 5157 6964    QtWidgets.QWid
+00060880: 6765 742e 5f5f 696e 6974 5f5f 2873 656c  get.__init__(sel
+00060890: 662c 2070 6172 656e 7429 0d0a 2020 2020  f, parent)..    
+000608a0: 2020 2020 7569 632e 6c6f 6164 5569 286f      uic.loadUi(o
+000608b0: 732e 7061 7468 2e6a 6f69 6e28 6f73 2e70  s.path.join(os.p
+000608c0: 6174 682e 6469 726e 616d 6528 6f73 2e70  ath.dirname(os.p
+000608d0: 6174 682e 6162 7370 6174 6828 5f5f 6669  ath.abspath(__fi
+000608e0: 6c65 5f5f 2929 2c20 2764 6961 6c6f 6761  le__)), 'dialoga
+000608f0: 6c69 676e 2e75 6927 292c 2073 656c 6629  lign.ui'), self)
+00060900: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00060910: 6172 656e 7420 3d20 7061 7265 6e74 0d0a  arent = parent..
+00060920: 2020 2020 2020 2020 7365 6c66 2e63 6f6d          self.com
+00060930: 203d 2063 6f6d 6d6f 6e0d 0a20 2020 2020   = common..     
+00060940: 2020 2023 2043 7572 7265 6e74 6c79 2064     # Currently d
+00060950: 6973 6162 6c65 6420 666f 7220 546f 6d6f  isabled for Tomo
+00060960: 2064 6174 610d 0a20 2020 2020 2020 2023   data..        #
+00060970: 2069 6620 7365 6c66 2e63 6f6d 2e73 7461   if self.com.sta
+00060980: 636b 5f34 6420 3d3d 2031 3a0d 0a20 2020  ck_4d == 1:..   
+00060990: 2020 2020 2023 2020 2020 2073 656c 662e       #     self.
+000609a0: 6274 5f61 6c69 676e 322e 7365 7445 6e61  bt_align2.setEna
+000609b0: 626c 6564 2854 7275 6529 0d0a 2020 2020  bled(True)..    
+000609c0: 2020 2020 2320 656c 7365 3a0d 0a20 2020      # else:..   
+000609d0: 2020 2020 2023 2020 2020 2073 656c 662e       #     self.
+000609e0: 6274 5f61 6c69 676e 322e 7365 7445 6e61  bt_align2.setEna
+000609f0: 626c 6564 2854 7275 6529 0d0a 2020 2020  bled(True)..    
+00060a00: 2020 2020 7365 6c66 2e62 745f 616c 6967      self.bt_alig
+00060a10: 6e2e 636c 6963 6b65 642e 636f 6e6e 6563  n.clicked.connec
+00060a20: 7428 7365 6c66 2e70 6172 656e 742e 7061  t(self.parent.pa
+00060a30: 6765 312e 4f6e 416c 6967 6e49 6d67 7329  ge1.OnAlignImgs)
+00060a40: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
+00060a50: 745f 616c 6967 6e32 2e63 6c69 636b 6564  t_align2.clicked
+00060a60: 2e63 6f6e 6e65 6374 2873 656c 662e 7061  .connect(self.pa
+00060a70: 7265 6e74 2e70 6167 6531 2e4f 6e41 6c69  rent.page1.OnAli
+00060a80: 676e 496d 6773 3229 0d0a 2020 2020 2020  gnImgs2)..      
+00060a90: 2020 7365 6c66 2e62 745f 616c 6967 6e2e    self.bt_align.
+00060aa0: 636c 6963 6b65 642e 636f 6e6e 6563 7428  clicked.connect(
+00060ab0: 7365 6c66 2e64 6f6e 6529 0d0a 2020 2020  self.done)..    
+00060ac0: 2020 2020 7365 6c66 2e62 745f 616c 6967      self.bt_alig
+00060ad0: 6e32 2e63 6c69 636b 6564 2e63 6f6e 6e65  n2.clicked.conne
+00060ae0: 6374 2873 656c 662e 646f 6e65 290d 0a23  ct(self.done)..#
+00060af0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00060b00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00060b10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00060b20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00060b30: 2d2d 2d2d 2d2d 0d0a 636c 6173 7320 496d  ------..class Im
+00060b40: 6167 6552 6567 6973 7472 6174 696f 6e4d  ageRegistrationM
+00060b50: 616e 7561 6c28 5174 5769 6467 6574 732e  anual(QtWidgets.
+00060b60: 5144 6961 6c6f 6729 3a0d 0a0d 0a20 2020  QDialog):....   
+00060b70: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00060b80: 6c66 2c20 7061 7265 6e74 2c20 2063 6f6d  lf, parent,  com
+00060b90: 6d6f 6e2c 2073 7461 636b 293a 0d0a 2020  mon, stack):..  
+00060ba0: 2020 2020 2020 5174 5769 6467 6574 732e        QtWidgets.
+00060bb0: 5157 6964 6765 742e 5f5f 696e 6974 5f5f  QWidget.__init__
+00060bc0: 2873 656c 662c 2070 6172 656e 7429 0d0a  (self, parent)..
+00060bd0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00060be0: 6172 656e 7420 3d20 7061 7265 6e74 0d0a  arent = parent..
+00060bf0: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+00060c00: 6573 697a 6528 3130 3530 2c20 3735 3029  esize(1050, 750)
+00060c10: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00060c20: 6574 5769 6e64 6f77 5469 746c 6528 2753  etWindowTitle('S
+00060c30: 7461 636b 2041 6c69 676e 6d65 6e74 2729  tack Alignment')
+00060c40: 0d0a 0d0a 2020 2020 2020 2020 7061 6c20  ....        pal 
+00060c50: 3d20 5174 4775 692e 5150 616c 6574 7465  = QtGui.QPalette
+00060c60: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+00060c70: 2e73 6574 4175 746f 4669 6c6c 4261 636b  .setAutoFillBack
+00060c80: 6772 6f75 6e64 2854 7275 6529 0d0a 2020  ground(True)..  
+00060c90: 2020 2020 2020 7061 6c2e 7365 7443 6f6c        pal.setCol
+00060ca0: 6f72 2851 7447 7569 2e51 5061 6c65 7474  or(QtGui.QPalett
+00060cb0: 652e 5769 6e64 6f77 2c51 7447 7569 2e51  e.Window,QtGui.Q
+00060cc0: 436f 6c6f 7228 2777 6869 7465 2729 290d  Color('white')).
+00060cd0: 0a20 2020 2020 2020 2073 656c 662e 7365  .        self.se
+00060ce0: 7450 616c 6574 7465 2870 616c 290d 0a0d  tPalette(pal)...
+00060cf0: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
+00060d00: 6163 6b20 3d20 7374 6163 6b0d 0a20 2020  ack = stack..   
+00060d10: 2020 2020 2073 656c 662e 636f 6d20 3d20       self.com = 
+00060d20: 636f 6d6d 6f6e 0d0a 0d0a 2020 2020 2020  common....      
+00060d30: 2020 7365 6c66 2e68 6176 655f 7265 665f    self.have_ref_
+00060d40: 696d 6167 6520 3d20 300d 0a20 2020 2020  image = 0..     
+00060d50: 2020 2073 656c 662e 7265 6769 7374 5f63     self.regist_c
+00060d60: 616c 6375 6c61 7465 6420 3d20 300d 0a0d  alculated = 0...
+00060d70: 0a20 2020 2020 2020 2073 656c 662e 6965  .        self.ie
+00060d80: 7620 3d20 300d 0a20 2020 2020 2020 2073  v = 0..        s
+00060d90: 656c 662e 6974 6865 7461 203d 2030 0d0a  elf.itheta = 0..
+00060da0: 2020 2020 2020 2020 7365 6c66 2e72 6566          self.ref
+00060db0: 5f69 6d61 6765 5f69 6e64 6578 203d 2030  _image_index = 0
+00060dc0: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+00060dd0: 6566 5f69 6d61 6765 5f69 6e64 6578 5f74  ef_image_index_t
+00060de0: 6865 7461 203d 2030 0d0a 2020 2020 2020  heta = 0..      
+00060df0: 2020 7365 6c66 2e72 6566 5f69 6d61 6765    self.ref_image
+00060e00: 203d 2030 0d0a 0d0a 2020 2020 2020 2020   = 0....        
+00060e10: 7365 6c66 2e6d 616e 5f61 6c69 676e 203d  self.man_align =
+00060e20: 2030 0d0a 2020 2020 2020 2020 7365 6c66   0..        self
+00060e30: 2e6d 616e 5f78 7265 6620 3d20 300d 0a20  .man_xref = 0.. 
+00060e40: 2020 2020 2020 2073 656c 662e 6d61 6e5f         self.man_
+00060e50: 7972 6566 203d 2030 0d0a 0d0a 2020 2020  yref = 0....    
+00060e60: 2020 2020 7365 6c66 2e6d 6178 7368 6966      self.maxshif
+00060e70: 7420 3d20 300d 0a20 2020 2020 2020 2073  t = 0..        s
+00060e80: 656c 662e 6175 746f 203d 2054 7275 650d  elf.auto = True.
+00060e90: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00060ea0: 786c 6566 7420 3d20 300d 0a20 2020 2020  xleft = 0..     
+00060eb0: 2020 2073 656c 662e 7872 6967 6874 203d     self.xright =
+00060ec0: 2073 656c 662e 7374 6163 6b2e 6e5f 636f   self.stack.n_co
+00060ed0: 6c73 0d0a 2020 2020 2020 2020 7365 6c66  ls..        self
+00060ee0: 2e79 626f 7474 6f6d 203d 2030 0d0a 2020  .ybottom = 0..  
+00060ef0: 2020 2020 2020 7365 6c66 2e79 746f 7020        self.ytop 
+00060f00: 3d20 7365 6c66 2e73 7461 636b 2e6e 5f72  = self.stack.n_r
+00060f10: 6f77 730d 0a0d 0a20 2020 2020 2020 2069  ows....        i
+00060f20: 6620 7365 6c66 2e63 6f6d 2e73 7461 636b  f self.com.stack
+00060f30: 5f34 6420 3d3d 2030 3a0d 0a20 2020 2020  _4d == 0:..     
+00060f40: 2020 2020 2020 2073 656c 662e 616c 6967         self.alig
+00060f50: 6e65 645f 7374 6163 6b20 3d20 7365 6c66  ned_stack = self
+00060f60: 2e73 7461 636b 2e61 6273 6461 7461 2e63  .stack.absdata.c
+00060f70: 6f70 7928 290d 0a20 2020 2020 2020 2020  opy()..         
+00060f80: 2020 2073 656c 662e 6d61 6e5f 7873 203d     self.man_xs =
+00060f90: 206e 702e 7a65 726f 7328 2873 656c 662e   np.zeros((self.
+00060fa0: 7374 6163 6b2e 6e5f 6576 2929 0d0a 2020  stack.n_ev))..  
+00060fb0: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+00060fc0: 616e 5f79 7320 3d20 6e70 2e7a 6572 6f73  an_ys = np.zeros
+00060fd0: 2828 7365 6c66 2e73 7461 636b 2e6e 5f65  ((self.stack.n_e
+00060fe0: 7629 290d 0a20 2020 2020 2020 2020 2020  v))..           
+00060ff0: 2073 656c 662e 7873 6869 6674 7320 3d20   self.xshifts = 
+00061000: 6e70 2e7a 6572 6f73 2828 7365 6c66 2e73  np.zeros((self.s
+00061010: 7461 636b 2e6e 5f65 7629 290d 0a20 2020  tack.n_ev))..   
+00061020: 2020 2020 2020 2020 2073 656c 662e 7973           self.ys
+00061030: 6869 6674 7320 3d20 6e70 2e7a 6572 6f73  hifts = np.zeros
+00061040: 2828 7365 6c66 2e73 7461 636b 2e6e 5f65  ((self.stack.n_e
+00061050: 7629 290d 0a20 2020 2020 2020 2065 6c73  v))..        els
+00061060: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00061070: 7365 6c66 2e61 6c69 676e 6564 5f73 7461  self.aligned_sta
+00061080: 636b 203d 2073 656c 662e 7374 6163 6b2e  ck = self.stack.
+00061090: 7374 6163 6b34 442e 636f 7079 2829 0d0a  stack4D.copy()..
+000610a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000610b0: 2e6d 616e 5f78 7320 3d20 6e70 2e7a 6572  .man_xs = np.zer
+000610c0: 6f73 2828 7365 6c66 2e73 7461 636b 2e6e  os((self.stack.n
+000610d0: 5f65 762c 7365 6c66 2e73 7461 636b 2e6e  _ev,self.stack.n
+000610e0: 5f74 6865 7461 2929 0d0a 2020 2020 2020  _theta))..      
+000610f0: 2020 2020 2020 7365 6c66 2e6d 616e 5f79        self.man_y
+00061100: 7320 3d20 6e70 2e7a 6572 6f73 2828 7365  s = np.zeros((se
+00061110: 6c66 2e73 7461 636b 2e6e 5f65 762c 7365  lf.stack.n_ev,se
+00061120: 6c66 2e73 7461 636b 2e6e 5f74 6865 7461  lf.stack.n_theta
+00061130: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00061140: 7365 6c66 2e78 7368 6966 7473 203d 206e  self.xshifts = n
+00061150: 702e 7a65 726f 7328 2873 656c 662e 7374  p.zeros((self.st
+00061160: 6163 6b2e 6e5f 6576 2c73 656c 662e 7374  ack.n_ev,self.st
+00061170: 6163 6b2e 6e5f 7468 6574 6129 290d 0a20  ack.n_theta)).. 
+00061180: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00061190: 7973 6869 6674 7320 3d20 6e70 2e7a 6572  yshifts = np.zer
+000611a0: 6f73 2828 7365 6c66 2e73 7461 636b 2e6e  os((self.stack.n
+000611b0: 5f65 762c 7365 6c66 2e73 7461 636b 2e6e  _ev,self.stack.n
+000611c0: 5f74 6865 7461 2929 0d0a 0d0a 2020 2020  _theta))....    
+000611d0: 2020 2020 7365 6c66 2e6d 696e 7873 203d      self.minxs =
+000611e0: 2030 0d0a 2020 2020 2020 2020 7365 6c66   0..        self
+000611f0: 2e6d 6178 7873 203d 2030 0d0a 0d0a 2020  .maxxs = 0....  
+00061200: 2020 2020 2020 7365 6c66 2e6d 696e 7973        self.minys
+00061210: 203d 2030 0d0a 2020 2020 2020 2020 7365   = 0..        se
+00061220: 6c66 2e6d 6178 7973 203d 2030 0d0a 0d0a  lf.maxys = 0....
+00061230: 2020 2020 2020 2020 7365 6c66 2e73 686f          self.sho
+00061240: 7763 636f 7272 203d 2030 0d0a 0d0a 2020  wccorr = 0....  
+00061250: 2020 2020 2020 7365 6c66 2e65 6467 6565        self.edgee
+00061260: 203d 2030 0d0a 0d0a 2020 2020 2020 2020   = 0....        
+00061270: 7365 6c66 2e73 7562 7265 6769 6f6e 203d  self.subregion =
+00061280: 2030 0d0a 2020 2020 2020 2020 7365 6c66   0..        self
+00061290: 2e73 725f 7831 203d 2030 0d0a 2020 2020  .sr_x1 = 0..    
+000612a0: 2020 2020 7365 6c66 2e73 725f 7832 203d      self.sr_x2 =
+000612b0: 2030 0d0a 2020 2020 2020 2020 7365 6c66   0..        self
+000612c0: 2e73 725f 7931 203d 2030 0d0a 2020 2020  .sr_y1 = 0..    
+000612d0: 2020 2020 7365 6c66 2e73 725f 7932 203d      self.sr_y2 =
+000612e0: 2030 0d0a 2020 2020 2020 2020 7365 6c66   0..        self
+000612f0: 2e70 6174 6368 203d 204e 6f6e 650d 0a0d  .patch = None...
+00061300: 0a20 2020 2020 2020 2023 7061 6e65 6c20  .        #panel 
+00061310: 310d 0a20 2020 2020 2020 2076 626f 7831  1..        vbox1
+00061320: 203d 2051 7457 6964 6765 7473 2e51 5642   = QtWidgets.QVB
+00061330: 6f78 4c61 796f 7574 2829 0d0a 0d0a 2020  oxLayout()....  
+00061340: 2020 2020 2020 7365 6c66 2e74 635f 696d        self.tc_im
+00061350: 6167 6565 6e67 203d 2051 7457 6964 6765  ageeng = QtWidge
+00061360: 7473 2e51 4c61 6265 6c28 7365 6c66 290d  ts.QLabel(self).
+00061370: 0a20 2020 2020 2020 2073 656c 662e 7463  .        self.tc
+00061380: 5f69 6d61 6765 656e 672e 7365 7454 6578  _imageeng.setTex
+00061390: 7428 2249 6d61 6765 2061 7420 656e 6572  t("Image at ener
+000613a0: 6779 3a20 2229 0d0a 0d0a 2020 2020 2020  gy: ")....      
+000613b0: 2020 6772 6964 7369 7a65 7274 6f70 203d    gridsizertop =
+000613c0: 2051 7457 6964 6765 7473 2e51 4772 6964   QtWidgets.QGrid
+000613d0: 4c61 796f 7574 2829 0d0a 0d0a 2020 2020  Layout()....    
+000613e0: 2020 2020 6672 616d 6520 3d20 5174 5769      frame = QtWi
+000613f0: 6467 6574 732e 5146 7261 6d65 2829 0d0a  dgets.QFrame()..
+00061400: 2020 2020 2020 2020 6672 616d 652e 7365          frame.se
+00061410: 7446 7261 6d65 5374 796c 6528 5174 5769  tFrameStyle(QtWi
+00061420: 6467 6574 732e 5146 7261 6d65 2e53 7479  dgets.QFrame.Sty
+00061430: 6c65 6450 616e 656c 7c51 7457 6964 6765  ledPanel|QtWidge
+00061440: 7473 2e51 4672 616d 652e 5375 6e6b 656e  ts.QFrame.Sunken
+00061450: 290d 0a20 2020 2020 2020 2066 626f 7820  )..        fbox 
+00061460: 3d20 5174 5769 6467 6574 732e 5148 426f  = QtWidgets.QHBo
+00061470: 784c 6179 6f75 7428 290d 0a0d 0a20 2020  xLayout()....   
+00061480: 2020 2020 2073 656c 662e 6162 7369 6d67       self.absimg
+00061490: 6669 6720 3d20 4669 6775 7265 2828 342e  fig = Figure((4.
+000614a0: 302c 2034 2e30 2929 0d0a 2020 2020 2020  0, 4.0))..      
+000614b0: 2020 7365 6c66 2e41 6273 496d 6167 6550    self.AbsImageP
+000614c0: 616e 656c 203d 2046 6967 7572 6543 616e  anel = FigureCan
+000614d0: 7661 7328 7365 6c66 2e61 6273 696d 6766  vas(self.absimgf
+000614e0: 6967 290d 0a20 2020 2020 2020 2073 656c  ig)..        sel
+000614f0: 662e 4162 7349 6d61 6765 5061 6e65 6c2e  f.AbsImagePanel.
+00061500: 7365 7450 6172 656e 7428 7365 6c66 290d  setParent(self).
+00061510: 0a20 2020 2020 2020 2073 656c 662e 4162  .        self.Ab
+00061520: 7349 6d61 6765 5061 6e65 6c2e 6d70 6c5f  sImagePanel.mpl_
+00061530: 636f 6e6e 6563 7428 2762 7574 746f 6e5f  connect('button_
+00061540: 7072 6573 735f 6576 656e 7427 2c20 7365  press_event', se
+00061550: 6c66 2e4f 6e50 6f69 6e74 436f 7272 696d  lf.OnPointCorrim
+00061560: 6167 6529 0d0a 2020 2020 2020 2020 7365  age)..        se
+00061570: 6c66 2e41 6273 496d 6167 6550 616e 656c  lf.AbsImagePanel
+00061580: 2e73 6574 4375 7273 6f72 2851 742e 4372  .setCursor(Qt.Cr
+00061590: 6f73 7343 7572 736f 7229 0d0a 0d0a 0d0a  ossCursor)......
+000615a0: 2020 2020 2020 2020 6662 6f78 2e61 6464          fbox.add
+000615b0: 5769 6467 6574 2873 656c 662e 4162 7349  Widget(self.AbsI
+000615c0: 6d61 6765 5061 6e65 6c29 0d0a 2020 2020  magePanel)..    
+000615d0: 2020 2020 6672 616d 652e 7365 744c 6179      frame.setLay
+000615e0: 6f75 7428 6662 6f78 290d 0a20 2020 2020  out(fbox)..     
+000615f0: 2020 2067 7269 6473 697a 6572 746f 702e     gridsizertop.
+00061600: 6164 6457 6964 6765 7428 6672 616d 652c  addWidget(frame,
+00061610: 2030 2c20 302c 2051 7443 6f72 6520 2e51   0, 0, QtCore .Q
+00061620: 742e 2041 6c69 676e 4c65 6674 290d 0a0d  t. AlignLeft)...
+00061630: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00061640: 736c 6964 6572 5f65 6e67 203d 2051 7457  slider_eng = QtW
+00061650: 6964 6765 7473 2e51 5363 726f 6c6c 4261  idgets.QScrollBa
+00061660: 7228 5174 436f 7265 2e51 742e 5665 7274  r(QtCore.Qt.Vert
+00061670: 6963 616c 290d 0a20 2020 2020 2020 2073  ical)..        s
+00061680: 656c 662e 736c 6964 6572 5f65 6e67 2e73  elf.slider_eng.s
+00061690: 6574 466f 6375 7350 6f6c 6963 7928 5174  etFocusPolicy(Qt
+000616a0: 436f 7265 2e51 742e 5374 726f 6e67 466f  Core.Qt.StrongFo
+000616b0: 6375 7329 0d0a 2020 2020 2020 2020 7365  cus)..        se
+000616c0: 6c66 2e73 6c69 6465 725f 656e 672e 7661  lf.slider_eng.va
+000616d0: 6c75 6543 6861 6e67 6564 5b69 6e74 5d2e  lueChanged[int].
+000616e0: 636f 6e6e 6563 7428 7365 6c66 2e4f 6e53  connect(self.OnS
+000616f0: 6372 6f6c 6c45 6e67 290d 0a20 2020 2020  crollEng)..     
+00061700: 2020 2073 656c 662e 736c 6964 6572 5f65     self.slider_e
+00061710: 6e67 2e73 6574 5261 6e67 6528 302c 2073  ng.setRange(0, s
+00061720: 656c 662e 7374 6163 6b2e 6e5f 6576 2d31  elf.stack.n_ev-1
+00061730: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00061740: 736c 6964 6572 5f65 6e67 2e73 6574 5661  slider_eng.setVa
+00061750: 6c75 6528 7365 6c66 2e69 6576 290d 0a0d  lue(self.iev)...
+00061760: 0a20 2020 2020 2020 2067 7269 6473 697a  .        gridsiz
+00061770: 6572 746f 702e 6164 6457 6964 6765 7428  ertop.addWidget(
+00061780: 7365 6c66 2e73 6c69 6465 725f 656e 672c  self.slider_eng,
+00061790: 2030 2c20 312c 2051 7443 6f72 6520 2e51   0, 1, QtCore .Q
+000617a0: 742e 2041 6c69 676e 4c65 6674 290d 0a0d  t. AlignLeft)...
+000617b0: 0a20 2020 2020 2020 2073 656c 662e 736c  .        self.sl
+000617c0: 6964 6572 5f74 6865 7461 203d 2051 7457  ider_theta = QtW
+000617d0: 6964 6765 7473 2e51 5363 726f 6c6c 4261  idgets.QScrollBa
+000617e0: 7228 5174 436f 7265 2e51 742e 486f 7269  r(QtCore.Qt.Hori
+000617f0: 7a6f 6e74 616c 290d 0a20 2020 2020 2020  zontal)..       
+00061800: 2073 656c 662e 736c 6964 6572 5f74 6865   self.slider_the
+00061810: 7461 2e73 6574 466f 6375 7350 6f6c 6963  ta.setFocusPolic
+00061820: 7928 5174 436f 7265 2e51 742e 5374 726f  y(QtCore.Qt.Stro
+00061830: 6e67 466f 6375 7329 0d0a 2020 2020 2020  ngFocus)..      
+00061840: 2020 7365 6c66 2e73 6c69 6465 725f 7468    self.slider_th
+00061850: 6574 612e 7661 6c75 6543 6861 6e67 6564  eta.valueChanged
+00061860: 5b69 6e74 5d2e 636f 6e6e 6563 7428 7365  [int].connect(se
+00061870: 6c66 2e4f 6e53 6372 6f6c 6c54 6865 7461  lf.OnScrollTheta
+00061880: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00061890: 736c 6964 6572 5f74 6865 7461 2e73 6574  slider_theta.set
+000618a0: 5261 6e67 6528 302c 2073 656c 662e 7374  Range(0, self.st
+000618b0: 6163 6b2e 6e5f 7468 6574 612d 3129 0d0a  ack.n_theta-1)..
+000618c0: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
+000618d0: 635f 696d 6167 6574 6865 7461 203d 2051  c_imagetheta = Q
+000618e0: 7457 6964 6765 7473 2e51 4c61 6265 6c28  tWidgets.QLabel(
+000618f0: 7365 6c66 290d 0a20 2020 2020 2020 2073  self)..        s
+00061900: 656c 662e 7463 5f69 6d61 6765 7468 6574  elf.tc_imagethet
+00061910: 612e 7365 7454 6578 7428 2234 4420 4461  a.setText("4D Da
+00061920: 7461 2041 6e67 6c65 3a20 2229 0d0a 2020  ta Angle: ")..  
+00061930: 2020 2020 2020 6966 2073 656c 662e 636f        if self.co
+00061940: 6d2e 7374 6163 6b5f 3464 203d 3d20 3020  m.stack_4d == 0 
+00061950: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00061960: 656c 662e 7463 5f69 6d61 6765 7468 6574  elf.tc_imagethet
+00061970: 612e 7365 7456 6973 6962 6c65 2846 616c  a.setVisible(Fal
+00061980: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
+00061990: 2073 656c 662e 736c 6964 6572 5f74 6865   self.slider_the
+000619a0: 7461 2e73 6574 5669 7369 626c 6528 4661  ta.setVisible(Fa
+000619b0: 6c73 6529 0d0a 2020 2020 2020 2020 6862  lse)..        hb
+000619c0: 6f78 3531 203d 2051 7457 6964 6765 7473  ox51 = QtWidgets
+000619d0: 2e51 4842 6f78 4c61 796f 7574 2829 0d0a  .QHBoxLayout()..
+000619e0: 2020 2020 2020 2020 6862 6f78 3531 2e61          hbox51.a
+000619f0: 6464 5769 6467 6574 2873 656c 662e 7463  ddWidget(self.tc
+00061a00: 5f69 6d61 6765 7468 6574 6129 0d0a 2020  _imagetheta)..  
+00061a10: 2020 2020 2020 6862 6f78 3531 2e61 6464        hbox51.add
+00061a20: 5769 6467 6574 2873 656c 662e 736c 6964  Widget(self.slid
+00061a30: 6572 5f74 6865 7461 290d 0a20 2020 2020  er_theta)..     
+00061a40: 2020 2067 7269 6473 697a 6572 746f 702e     gridsizertop.
+00061a50: 6164 644c 6179 6f75 7428 6862 6f78 3531  addLayout(hbox51
+00061a60: 2c20 312c 2030 290d 0a0d 0a20 2020 2020  , 1, 0)....     
+00061a70: 2020 2076 626f 7831 2e61 6464 5769 6467     vbox1.addWidg
+00061a80: 6574 2873 656c 662e 7463 5f69 6d61 6765  et(self.tc_image
+00061a90: 656e 6729 0d0a 2020 2020 2020 2020 7662  eng)..        vb
+00061aa0: 6f78 312e 6164 644c 6179 6f75 7428 6772  ox1.addLayout(gr
+00061ab0: 6964 7369 7a65 7274 6f70 290d 0a0d 0a20  idsizertop).... 
+00061ac0: 2020 2020 2020 2073 656c 662e 7463 5f73         self.tc_s
+00061ad0: 6869 6674 3120 3d20 5174 5769 6467 6574  hift1 = QtWidget
+00061ae0: 732e 514c 6162 656c 2873 656c 6629 0d0a  s.QLabel(self)..
+00061af0: 2020 2020 2020 2020 7365 6c66 2e74 635f          self.tc_
+00061b00: 7368 6966 7432 203d 2051 7457 6964 6765  shift2 = QtWidge
+00061b10: 7473 2e51 4c61 6265 6c28 7365 6c66 290d  ts.QLabel(self).
+00061b20: 0a20 2020 2020 2020 2076 626f 7831 2e61  .        vbox1.a
+00061b30: 6464 5769 6467 6574 2873 656c 662e 7463  ddWidget(self.tc
+00061b40: 5f73 6869 6674 3129 0d0a 2020 2020 2020  _shift1)..      
+00061b50: 2020 7662 6f78 312e 6164 6457 6964 6765    vbox1.addWidge
+00061b60: 7428 7365 6c66 2e74 635f 7368 6966 7432  t(self.tc_shift2
+00061b70: 290d 0a20 2020 2020 2020 2076 626f 7831  )..        vbox1
+00061b80: 2e61 6464 5374 7265 7463 6828 3129 0d0a  .addStretch(1)..
+00061b90: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00061ba0: 662e 636f 6d2e 7374 6163 6b5f 3464 203d  f.com.stack_4d =
+00061bb0: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
+00061bc0: 2020 7365 6c66 2e74 635f 7368 6966 7431    self.tc_shift1
+00061bd0: 2e73 6574 5465 7874 2827 5820 7368 6966  .setText('X shif
+00061be0: 743a 207b 303a 352e 3266 7d20 7069 7865  t: {0:5.2f} pixe
+00061bf0: 6c73 272e 666f 726d 6174 2873 656c 662e  ls'.format(self.
+00061c00: 7873 6869 6674 735b 7365 6c66 2e69 6576  xshifts[self.iev
+00061c10: 5d29 290d 0a20 2020 2020 2020 2020 2020  ]))..           
+00061c20: 2073 656c 662e 7463 5f73 6869 6674 322e   self.tc_shift2.
+00061c30: 7365 7454 6578 7428 2759 2073 6869 6674  setText('Y shift
+00061c40: 3a20 7b30 3a35 2e32 667d 2070 6978 656c  : {0:5.2f} pixel
+00061c50: 7327 2e66 6f72 6d61 7428 7365 6c66 2e79  s'.format(self.y
+00061c60: 7368 6966 7473 5b73 656c 662e 6965 765d  shifts[self.iev]
+00061c70: 2929 0d0a 2020 2020 2020 2020 656c 7365  ))..        else
+00061c80: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00061c90: 656c 662e 7463 5f73 6869 6674 312e 7365  elf.tc_shift1.se
+00061ca0: 7454 6578 7428 2758 2073 6869 6674 3a20  tText('X shift: 
+00061cb0: 7b30 3a35 2e32 667d 2070 6978 656c 7327  {0:5.2f} pixels'
+00061cc0: 2e66 6f72 6d61 7428 7365 6c66 2e78 7368  .format(self.xsh
+00061cd0: 6966 7473 5b73 656c 662e 6965 762c 7365  ifts[self.iev,se
+00061ce0: 6c66 2e69 7468 6574 615d 2929 0d0a 2020  lf.itheta]))..  
+00061cf0: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
+00061d00: 635f 7368 6966 7432 2e73 6574 5465 7874  c_shift2.setText
+00061d10: 2827 5920 7368 6966 743a 207b 303a 352e  ('Y shift: {0:5.
+00061d20: 3266 7d20 7069 7865 6c73 272e 666f 726d  2f} pixels'.form
+00061d30: 6174 2873 656c 662e 7973 6869 6674 735b  at(self.yshifts[
+00061d40: 7365 6c66 2e69 6576 2c73 656c 662e 6974  self.iev,self.it
+00061d50: 6865 7461 5d29 290d 0a0d 0a0d 0a20 2020  heta]))......   
+00061d60: 2020 2020 2023 7061 6e65 6c20 320d 0a20       #panel 2.. 
+00061d70: 2020 2020 2020 2076 626f 7832 203d 2051         vbox2 = Q
+00061d80: 7457 6964 6765 7473 2e51 5642 6f78 4c61  tWidgets.QVBoxLa
+00061d90: 796f 7574 2829 0d0a 0d0a 2020 2020 2020  yout()....      
+00061da0: 2020 7463 3220 3d20 5174 5769 6467 6574    tc2 = QtWidget
+00061db0: 732e 514c 6162 656c 2873 656c 6629 0d0a  s.QLabel(self)..
+00061dc0: 2020 2020 2020 2020 7463 322e 7365 7454          tc2.setT
+00061dd0: 6578 7428 2743 726f 7373 2d63 6f72 7265  ext('Cross-corre
+00061de0: 6c61 7469 6f6e 2729 0d0a 0d0a 2020 2020  lation')....    
+00061df0: 2020 2020 6672 616d 6520 3d20 5174 5769      frame = QtWi
+00061e00: 6467 6574 732e 5146 7261 6d65 2829 0d0a  dgets.QFrame()..
+00061e10: 2020 2020 2020 2020 6672 616d 652e 7365          frame.se
+00061e20: 7446 7261 6d65 5374 796c 6528 5174 5769  tFrameStyle(QtWi
+00061e30: 6467 6574 732e 5146 7261 6d65 2e53 7479  dgets.QFrame.Sty
+00061e40: 6c65 6450 616e 656c 7c51 7457 6964 6765  ledPanel|QtWidge
+00061e50: 7473 2e51 4672 616d 652e 5375 6e6b 656e  ts.QFrame.Sunken
+00061e60: 290d 0a20 2020 2020 2020 2066 626f 7820  )..        fbox 
+00061e70: 3d20 5174 5769 6467 6574 732e 5148 426f  = QtWidgets.QHBo
+00061e80: 784c 6179 6f75 7428 290d 0a0d 0a20 2020  xLayout()....   
+00061e90: 2020 2020 2073 656c 662e 6373 636f 7272       self.cscorr
+00061ea0: 6669 6720 3d20 4669 6775 7265 2828 322e  fig = Figure((2.
+00061eb0: 342c 2032 2e34 2929 0d0a 2020 2020 2020  4, 2.4))..      
+00061ec0: 2020 7365 6c66 2e43 7363 6f72 7250 616e    self.CscorrPan
+00061ed0: 656c 203d 2046 6967 7572 6543 616e 7661  el = FigureCanva
+00061ee0: 7328 7365 6c66 2e63 7363 6f72 7266 6967  s(self.cscorrfig
+00061ef0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00061f00: 4373 636f 7272 5061 6e65 6c2e 7365 7450  CscorrPanel.setP
+00061f10: 6172 656e 7428 7365 6c66 290d 0a0d 0a20  arent(self).... 
+00061f20: 2020 2020 2020 2066 626f 782e 6164 6457         fbox.addW
+00061f30: 6964 6765 7428 7365 6c66 2e43 7363 6f72  idget(self.Cscor
+00061f40: 7250 616e 656c 290d 0a20 2020 2020 2020  rPanel)..       
+00061f50: 2066 7261 6d65 2e73 6574 4c61 796f 7574   frame.setLayout
+00061f60: 2866 626f 7829 0d0a 0d0a 2020 2020 2020  (fbox)....      
+00061f70: 2020 7662 6f78 322e 6164 6457 6964 6765    vbox2.addWidge
+00061f80: 7428 7463 3229 0d0a 2020 2020 2020 2020  t(tc2)..        
+00061f90: 7662 6f78 322e 6164 6457 6964 6765 7428  vbox2.addWidget(
+00061fa0: 6672 616d 6529 0d0a 0d0a 0d0a 2020 2020  frame)......    
+00061fb0: 2020 2020 2370 616e 656c 2033 0d0a 2020      #panel 3..  
+00061fc0: 2020 2020 2020 7662 6f78 3320 3d20 5174        vbox3 = Qt
+00061fd0: 5769 6467 6574 732e 5156 426f 784c 6179  Widgets.QVBoxLay
+00061fe0: 6f75 7428 290d 0a0d 0a20 2020 2020 2020  out()....       
+00061ff0: 2074 6333 3d20 5174 5769 6467 6574 732e   tc3= QtWidgets.
+00062000: 514c 6162 656c 2873 656c 6629 0d0a 2020  QLabel(self)..  
+00062010: 2020 2020 2020 7463 332e 7365 7454 6578        tc3.setTex
+00062020: 7428 2749 6d61 6765 2073 6869 6674 7327  t('Image shifts'
+00062030: 290d 0a0d 0a20 2020 2020 2020 2066 7261  )....        fra
+00062040: 6d65 203d 2051 7457 6964 6765 7473 2e51  me = QtWidgets.Q
+00062050: 4672 616d 6528 290d 0a20 2020 2020 2020  Frame()..       
+00062060: 2066 7261 6d65 2e73 6574 4672 616d 6553   frame.setFrameS
+00062070: 7479 6c65 2851 7457 6964 6765 7473 2e51  tyle(QtWidgets.Q
+00062080: 4672 616d 652e 5374 796c 6564 5061 6e65  Frame.StyledPane
+00062090: 6c7c 5174 5769 6467 6574 732e 5146 7261  l|QtWidgets.QFra
+000620a0: 6d65 2e53 756e 6b65 6e29 0d0a 2020 2020  me.Sunken)..    
+000620b0: 2020 2020 6662 6f78 203d 2051 7457 6964      fbox = QtWid
+000620c0: 6765 7473 2e51 4842 6f78 4c61 796f 7574  gets.QHBoxLayout
+000620d0: 2829 0d0a 0d0a 2020 2020 2020 2020 7365  ()....        se
+000620e0: 6c66 2e73 6869 6674 7366 6967 203d 2046  lf.shiftsfig = F
+000620f0: 6967 7572 6528 2834 2e30 2c20 322e 3429  igure((4.0, 2.4)
+00062100: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00062110: 5368 6966 7473 5061 6e65 6c20 3d20 4669  ShiftsPanel = Fi
+00062120: 6775 7265 4361 6e76 6173 2873 656c 662e  gureCanvas(self.
+00062130: 7368 6966 7473 6669 6729 0d0a 2020 2020  shiftsfig)..    
+00062140: 2020 2020 7365 6c66 2e53 6869 6674 7350      self.ShiftsP
+00062150: 616e 656c 2e73 6574 5061 7265 6e74 2873  anel.setParent(s
+00062160: 656c 6629 0d0a 2020 2020 2020 2020 7365  elf)..        se
+00062170: 6c66 2e53 6869 6674 7350 616e 656c 2e6d  lf.ShiftsPanel.m
+00062180: 706c 5f63 6f6e 6e65 6374 2827 6275 7474  pl_connect('butt
+00062190: 6f6e 5f70 7265 7373 5f65 7665 6e74 272c  on_press_event',
+000621a0: 2073 656c 662e 4f6e 506c 6f74 5368 6966   self.OnPlotShif
+000621b0: 7473 290d 0a0d 0a20 2020 2020 2020 2066  ts)....        f
+000621c0: 626f 782e 6164 6457 6964 6765 7428 7365  box.addWidget(se
+000621d0: 6c66 2e53 6869 6674 7350 616e 656c 290d  lf.ShiftsPanel).
+000621e0: 0a20 2020 2020 2020 2066 7261 6d65 2e73  .        frame.s
+000621f0: 6574 4c61 796f 7574 2866 626f 7829 0d0a  etLayout(fbox)..
+00062200: 0d0a 2020 2020 2020 2020 7662 6f78 332e  ..        vbox3.
+00062210: 6164 6457 6964 6765 7428 7463 3329 0d0a  addWidget(tc3)..
+00062220: 2020 2020 2020 2020 7662 6f78 332e 6164          vbox3.ad
+00062230: 6457 6964 6765 7428 6672 616d 6529 0d0a  dWidget(frame)..
+00062240: 0d0a 0d0a 2020 2020 2020 2020 2370 616e  ....        #pan
+00062250: 656c 2039 0d0a 2020 2020 2020 2020 7662  el 9..        vb
+00062260: 6f78 3920 3d20 5174 5769 6467 6574 732e  ox9 = QtWidgets.
+00062270: 5156 426f 784c 6179 6f75 7428 290d 0a20  QVBoxLayout().. 
+00062280: 2020 2020 2020 2076 626f 7839 2e73 6574         vbox9.set
+00062290: 5370 6163 696e 6728 3029 0d0a 0d0a 2020  Spacing(0)....  
+000622a0: 2020 2020 2020 6772 6f75 7042 6f78 3920        groupBox9 
+000622b0: 3d20 5174 5769 6467 6574 732e 5147 726f  = QtWidgets.QGro
+000622c0: 7570 426f 7828 290d 0a20 2020 2020 2020  upBox()..       
+000622d0: 2073 656c 662e 7262 5f61 7574 6f20 3d20   self.rb_auto = 
+000622e0: 5174 5769 6467 6574 732e 5152 6164 696f  QtWidgets.QRadio
+000622f0: 4275 7474 6f6e 2820 2741 7574 6f6d 6174  Button( 'Automat
+00062300: 6963 2041 6c69 676e 6d65 6e74 2729 0d0a  ic Alignment')..
+00062310: 2020 2020 2020 2020 7365 6c66 2e72 625f          self.rb_
+00062320: 6d61 6e20 3d20 5174 5769 6467 6574 732e  man = QtWidgets.
+00062330: 5152 6164 696f 4275 7474 6f6e 2827 4d61  QRadioButton('Ma
+00062340: 6e75 616c 2041 6c69 676e 6d65 6e74 2729  nual Alignment')
+00062350: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+00062360: 625f 6175 746f 2e73 6574 4368 6563 6b65  b_auto.setChecke
+00062370: 6428 5472 7565 290d 0a20 2020 2020 2020  d(True)..       
+00062380: 2073 656c 662e 7262 5f61 7574 6f2e 746f   self.rb_auto.to
+00062390: 6767 6c65 642e 636f 6e6e 6563 7428 7365  ggled.connect(se
+000623a0: 6c66 2e4f 6e72 625f 6175 746f 6d61 6e75  lf.Onrb_automanu
+000623b0: 616c 290d 0a0d 0a20 2020 2020 2020 2076  al)....        v
+000623c0: 626f 7839 2e61 6464 5769 6467 6574 2873  box9.addWidget(s
+000623d0: 656c 662e 7262 5f61 7574 6f29 0d0a 2020  elf.rb_auto)..  
+000623e0: 2020 2020 2020 7662 6f78 392e 6164 6457        vbox9.addW
+000623f0: 6964 6765 7428 7365 6c66 2e72 625f 6d61  idget(self.rb_ma
+00062400: 6e29 0d0a 2020 2020 2020 2020 6772 6f75  n)..        grou
+00062410: 7042 6f78 392e 7365 744c 6179 6f75 7428  pBox9.setLayout(
+00062420: 7662 6f78 3929 0d0a 0d0a 2020 2020 2020  vbox9)....      
+00062430: 2020 2370 616e 656c 2038 0d0a 2020 2020    #panel 8..    
+00062440: 2020 2020 7369 7a65 7238 203d 2051 7457      sizer8 = QtW
+00062450: 6964 6765 7473 2e51 4772 6f75 7042 6f78  idgets.QGroupBox
+00062460: 2827 5468 6973 2049 6d61 6765 2729 0d0a  ('This Image')..
+00062470: 2020 2020 2020 2020 7662 6f78 3820 3d20          vbox8 = 
+00062480: 5174 5769 6467 6574 732e 5156 426f 784c  QtWidgets.QVBoxL
+00062490: 6179 6f75 7428 290d 0a20 2020 2020 2020  ayout()..       
+000624a0: 2076 626f 7838 2e73 6574 5370 6163 696e   vbox8.setSpacin
+000624b0: 6728 3029 0d0a 0d0a 2020 2020 2020 2020  g(0)....        
+000624c0: 7365 6c66 2e62 7574 746f 6e5f 7265 6669  self.button_refi
+000624d0: 6d67 203d 2051 7457 6964 6765 7473 2e51  mg = QtWidgets.Q
+000624e0: 5075 7368 4275 7474 6f6e 2827 5365 7420  PushButton('Set 
+000624f0: 6173 2052 6566 6572 656e 6365 2049 6d61  as Reference Ima
+00062500: 6765 2729 0d0a 2020 2020 2020 2020 7365  ge')..        se
+00062510: 6c66 2e62 7574 746f 6e5f 7265 6669 6d67  lf.button_refimg
+00062520: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
+00062530: 2873 656c 662e 5365 7452 6566 496d 6167  (self.SetRefImag
+00062540: 6529 0d0a 2020 2020 2020 2020 7662 6f78  e)..        vbox
+00062550: 382e 6164 6457 6964 6765 7428 7365 6c66  8.addWidget(self
+00062560: 2e62 7574 746f 6e5f 7265 6669 6d67 290d  .button_refimg).
+00062570: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00062580: 6275 7474 6f6e 5f72 6566 696d 6773 6176  button_refimgsav
+00062590: 6520 3d20 5174 5769 6467 6574 732e 5150  e = QtWidgets.QP
+000625a0: 7573 6842 7574 746f 6e28 2753 6176 6520  ushButton('Save 
+000625b0: 5265 6665 7265 6e63 6520 496d 6167 6527  Reference Image'
+000625c0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000625d0: 6275 7474 6f6e 5f72 6566 696d 6773 6176  button_refimgsav
+000625e0: 652e 636c 6963 6b65 642e 636f 6e6e 6563  e.clicked.connec
+000625f0: 7428 7365 6c66 2e53 6176 6552 6566 496d  t(self.SaveRefIm
+00062600: 6167 6529 0d0a 2020 2020 2020 2020 7365  age)..        se
+00062610: 6c66 2e62 7574 746f 6e5f 7265 6669 6d67  lf.button_refimg
+00062620: 7361 7665 2e73 6574 456e 6162 6c65 6428  save.setEnabled(
+00062630: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
+00062640: 7662 6f78 382e 6164 6457 6964 6765 7428  vbox8.addWidget(
+00062650: 7365 6c66 2e62 7574 746f 6e5f 7265 6669  self.button_refi
+00062660: 6d67 7361 7665 290d 0a0d 0a20 2020 2020  mgsave)....     
+00062670: 2020 2073 656c 662e 6275 7474 6f6e 5f72     self.button_r
+00062680: 6566 696d 6773 6c6f 6164 203d 2051 7457  efimgsload = QtW
+00062690: 6964 6765 7473 2e51 5075 7368 4275 7474  idgets.QPushButt
+000626a0: 6f6e 2827 4c6f 6164 2052 6566 6572 656e  on('Load Referen
+000626b0: 6365 2049 6d61 6765 2729 0d0a 2020 2020  ce Image')..    
+000626c0: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+000626d0: 7265 6669 6d67 736c 6f61 642e 636c 6963  refimgsload.clic
+000626e0: 6b65 642e 636f 6e6e 6563 7428 7365 6c66  ked.connect(self
+000626f0: 2e4c 6f61 6452 6566 496d 6167 6529 0d0a  .LoadRefImage)..
+00062700: 2020 2020 2020 2020 7662 6f78 382e 6164          vbox8.ad
+00062710: 6457 6964 6765 7428 7365 6c66 2e62 7574  dWidget(self.but
+00062720: 746f 6e5f 7265 6669 6d67 736c 6f61 6429  ton_refimgsload)
+00062730: 0d0a 0d0a 2020 2020 2020 2020 6c69 6e65  ....        line
+00062740: 203d 2051 7457 6964 6765 7473 2e51 4672   = QtWidgets.QFr
+00062750: 616d 6528 290d 0a20 2020 2020 2020 206c  ame()..        l
+00062760: 696e 652e 7365 7446 7261 6d65 5368 6170  ine.setFrameShap
+00062770: 6528 5174 5769 6467 6574 732e 5146 7261  e(QtWidgets.QFra
+00062780: 6d65 2e48 4c69 6e65 290d 0a20 2020 2020  me.HLine)..     
+00062790: 2020 206c 696e 652e 7365 7446 7261 6d65     line.setFrame
+000627a0: 5368 6164 6f77 2851 7457 6964 6765 7473  Shadow(QtWidgets
+000627b0: 2e51 4672 616d 652e 5375 6e6b 656e 290d  .QFrame.Sunken).
+000627c0: 0a0d 0a20 2020 2020 2020 2076 626f 7838  ...        vbox8
+000627d0: 2e61 6464 5370 6163 696e 6728 3529 0d0a  .addSpacing(5)..
+000627e0: 2020 2020 2020 2020 7662 6f78 382e 6164          vbox8.ad
+000627f0: 6457 6964 6765 7428 6c69 6e65 290d 0a20  dWidget(line).. 
+00062800: 2020 2020 2020 2076 626f 7838 2e61 6464         vbox8.add
+00062810: 5370 6163 696e 6728 3529 0d0a 0d0a 2020  Spacing(5)....  
+00062820: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+00062830: 6e5f 7265 6d6f 7665 203d 2051 7457 6964  n_remove = QtWid
+00062840: 6765 7473 2e51 5075 7368 4275 7474 6f6e  gets.QPushButton
+00062850: 2827 5265 6d6f 7665 2065 6e65 7267 7920  ('Remove energy 
+00062860: 6672 6f6d 2073 7461 636b 2729 0d0a 2020  from stack')..  
+00062870: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+00062880: 6e5f 7265 6d6f 7665 2e63 6c69 636b 6564  n_remove.clicked
+00062890: 2e63 6f6e 6e65 6374 2873 656c 662e 4f6e  .connect(self.On
+000628a0: 5265 6d6f 7665 496d 6167 6529 0d0a 2020  RemoveImage)..  
+000628b0: 2020 2020 2020 7662 6f78 382e 6164 6457        vbox8.addW
+000628c0: 6964 6765 7428 7365 6c66 2e62 7574 746f  idget(self.butto
+000628d0: 6e5f 7265 6d6f 7665 290d 0a0d 0a20 2020  n_remove)....   
+000628e0: 2020 2020 2073 697a 6572 382e 7365 744c       sizer8.setL
+000628f0: 6179 6f75 7428 7662 6f78 3829 0d0a 0d0a  ayout(vbox8)....
+00062900: 0d0a 2020 2020 2020 2020 2370 616e 656c  ..        #panel
+00062910: 2034 0d0a 2020 2020 2020 2020 7369 7a65   4..        size
+00062920: 7234 203d 2051 7457 6964 6765 7473 2e51  r4 = QtWidgets.Q
+00062930: 4772 6f75 7042 6f78 2827 4175 746f 6d61  GroupBox('Automa
+00062940: 7469 6320 416c 6967 6e6d 656e 7427 290d  tic Alignment').
+00062950: 0a20 2020 2020 2020 2076 626f 7834 203d  .        vbox4 =
+00062960: 2051 7457 6964 6765 7473 2e51 5642 6f78   QtWidgets.QVBox
+00062970: 4c61 796f 7574 2829 0d0a 0d0a 0d0a 2020  Layout()......  
+00062980: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+00062990: 6e5f 7265 6769 7374 6572 203d 2051 7457  n_register = QtW
+000629a0: 6964 6765 7473 2e51 5075 7368 4275 7474  idgets.QPushButt
+000629b0: 6f6e 2827 4361 6c63 756c 6174 6520 696d  on('Calculate im
+000629c0: 6167 6520 7368 6966 7473 2729 0d0a 2020  age shifts')..  
+000629d0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+000629e0: 6e5f 7265 6769 7374 6572 2e63 6c69 636b  n_register.click
+000629f0: 6564 2e63 6f6e 6e65 6374 2873 656c 662e  ed.connect(self.
+00062a00: 4f6e 4361 6c63 5265 6769 7374 7261 7469  OnCalcRegistrati
+00062a10: 6f6e 290d 0a20 2020 2020 2020 2073 656c  on)..        sel
+00062a20: 662e 6275 7474 6f6e 5f72 6567 6973 7465  f.button_registe
+00062a30: 722e 7365 7445 6e61 626c 6564 2846 616c  r.setEnabled(Fal
+00062a40: 7365 290d 0a20 2020 2020 2020 2076 626f  se)..        vbo
+00062a50: 7834 2e61 6464 5769 6467 6574 2873 656c  x4.addWidget(sel
+00062a60: 662e 6275 7474 6f6e 5f72 6567 6973 7465  f.button_registe
+00062a70: 7229 0d0a 2020 2020 2020 2020 2376 626f  r)..        #vbo
+00062a80: 7834 2e61 6464 5374 7265 7463 6828 3129  x4.addStretch(1)
+00062a90: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
 00062aa0: 2e62 7574 746f 6e5f 7375 6272 6567 696f  .button_subregio
-00062ab0: 6e2e 636c 6963 6b65 642e 636f 6e6e 6563  n.clicked.connec
-00062ac0: 7428 7365 6c66 2e4f 6e53 656c 6563 7453  t(self.OnSelectS
-00062ad0: 7562 7265 6769 6f6e 290d 0a20 2020 2020  ubregion)..     
-00062ae0: 2020 2073 656c 662e 6275 7474 6f6e 5f73     self.button_s
-00062af0: 7562 7265 6769 6f6e 2e73 6574 456e 6162  ubregion.setEnab
-00062b00: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
-00062b10: 2020 2020 7662 6f78 342e 6164 6457 6964      vbox4.addWid
-00062b20: 6765 7428 7365 6c66 2e62 7574 746f 6e5f  get(self.button_
-00062b30: 7375 6272 6567 696f 6e29 0d0a 0d0a 2020  subregion)....  
-00062b40: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
-00062b50: 6e5f 6465 6c73 7562 7265 6769 6f6e 203d  n_delsubregion =
-00062b60: 2051 7457 6964 6765 7473 2e51 5075 7368   QtWidgets.QPush
-00062b70: 4275 7474 6f6e 2827 5265 6d6f 7665 2073  Button('Remove s
-00062b80: 7562 7265 6769 6f6e 2073 656c 6563 7469  ubregion selecti
-00062b90: 6f6e 2729 0d0a 2020 2020 2020 2020 7365  on')..        se
+00062ab0: 6e20 3d20 5174 5769 6467 6574 732e 5150  n = QtWidgets.QP
+00062ac0: 7573 6842 7574 746f 6e28 2753 656c 6563  ushButton('Selec
+00062ad0: 7420 7375 6272 6567 696f 6e20 6f6e 2072  t subregion on r
+00062ae0: 6566 6572 656e 6365 2729 0d0a 2020 2020  eference')..    
+00062af0: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+00062b00: 7375 6272 6567 696f 6e2e 636c 6963 6b65  subregion.clicke
+00062b10: 642e 636f 6e6e 6563 7428 7365 6c66 2e4f  d.connect(self.O
+00062b20: 6e53 656c 6563 7453 7562 7265 6769 6f6e  nSelectSubregion
+00062b30: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00062b40: 6275 7474 6f6e 5f73 7562 7265 6769 6f6e  button_subregion
+00062b50: 2e73 6574 456e 6162 6c65 6428 4661 6c73  .setEnabled(Fals
+00062b60: 6529 0d0a 2020 2020 2020 2020 7662 6f78  e)..        vbox
+00062b70: 342e 6164 6457 6964 6765 7428 7365 6c66  4.addWidget(self
+00062b80: 2e62 7574 746f 6e5f 7375 6272 6567 696f  .button_subregio
+00062b90: 6e29 0d0a 0d0a 2020 2020 2020 2020 7365  n)....        se
 00062ba0: 6c66 2e62 7574 746f 6e5f 6465 6c73 7562  lf.button_delsub
-00062bb0: 7265 6769 6f6e 2e63 6c69 636b 6564 2e63  region.clicked.c
-00062bc0: 6f6e 6e65 6374 2873 656c 662e 4f6e 4465  onnect(self.OnDe
-00062bd0: 6c65 7465 5375 6272 6567 696f 6e29 0d0a  leteSubregion)..
-00062be0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-00062bf0: 746f 6e5f 6465 6c73 7562 7265 6769 6f6e  ton_delsubregion
-00062c00: 2e73 6574 456e 6162 6c65 6428 4661 6c73  .setEnabled(Fals
-00062c10: 6529 0d0a 2020 2020 2020 2020 7662 6f78  e)..        vbox
-00062c20: 342e 6164 6457 6964 6765 7428 7365 6c66  4.addWidget(self
-00062c30: 2e62 7574 746f 6e5f 6465 6c73 7562 7265  .button_delsubre
-00062c40: 6769 6f6e 290d 0a20 2020 2020 2020 2076  gion)..        v
-00062c50: 626f 7834 2e61 6464 5374 7265 7463 6828  box4.addStretch(
-00062c60: 3129 0d0a 0d0a 2020 2020 2020 2020 6772  1)....        gr
-00062c70: 6f75 7042 6f78 3420 3d20 5174 5769 6467  oupBox4 = QtWidg
-00062c80: 6574 732e 5147 726f 7570 426f 7828 290d  ets.QGroupBox().
-00062c90: 0a20 2020 2020 2020 2068 626f 7834 3320  .        hbox43 
-00062ca0: 3d20 5174 5769 6467 6574 732e 5148 426f  = QtWidgets.QHBo
-00062cb0: 784c 6179 6f75 7428 290d 0a20 2020 2020  xLayout()..     
-00062cc0: 2020 2073 656c 662e 6362 5f65 6467 6565     self.cb_edgee
-00062cd0: 6e68 203d 2051 7457 6964 6765 7473 2e51  nh = QtWidgets.Q
-00062ce0: 4368 6563 6b42 6f78 2827 4564 6765 2045  CheckBox('Edge E
-00062cf0: 6e68 616e 6365 6d65 6e74 272c 2073 656c  nhancement', sel
-00062d00: 6629 0d0a 2020 2020 2020 2020 7365 6c66  f)..        self
-00062d10: 2e63 625f 6564 6765 656e 682e 7374 6174  .cb_edgeenh.stat
-00062d20: 6543 6861 6e67 6564 2e63 6f6e 6e65 6374  eChanged.connect
-00062d30: 2873 656c 662e 4f6e 4564 6765 4529 0d0a  (self.OnEdgeE)..
-00062d40: 2020 2020 2020 2020 6862 6f78 3433 2e61          hbox43.a
-00062d50: 6464 5769 6467 6574 2873 656c 662e 6362  ddWidget(self.cb
-00062d60: 5f65 6467 6565 6e68 290d 0a0d 0a20 2020  _edgeenh)....   
-00062d70: 2020 2020 2073 656c 662e 7262 5f73 6f62       self.rb_sob
-00062d80: 656c 203d 2051 7457 6964 6765 7473 2e51  el = QtWidgets.Q
-00062d90: 5261 6469 6f42 7574 746f 6e28 2027 536f  RadioButton( 'So
-00062da0: 6265 6c27 290d 0a20 2020 2020 2020 2073  bel')..        s
-00062db0: 656c 662e 7262 5f70 7265 7769 7474 203d  elf.rb_prewitt =
-00062dc0: 2051 7457 6964 6765 7473 2e51 5261 6469   QtWidgets.QRadi
-00062dd0: 6f42 7574 746f 6e28 2750 7265 7769 7474  oButton('Prewitt
-00062de0: 2729 0d0a 2020 2020 2020 2020 7365 6c66  ')..        self
-00062df0: 2e72 625f 7072 6577 6974 742e 7365 7443  .rb_prewitt.setC
-00062e00: 6865 636b 6564 2854 7275 6529 0d0a 2020  hecked(True)..  
-00062e10: 2020 2020 2020 7365 6c66 2e72 625f 736f        self.rb_so
-00062e20: 6265 6c2e 7365 7445 6e61 626c 6564 2846  bel.setEnabled(F
-00062e30: 616c 7365 290d 0a20 2020 2020 2020 2073  alse)..        s
-00062e40: 656c 662e 7262 5f70 7265 7769 7474 2e73  elf.rb_prewitt.s
-00062e50: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
-00062e60: 0d0a 0d0a 2020 2020 2020 2020 6862 6f78  ....        hbox
-00062e70: 3433 2e61 6464 5769 6467 6574 2873 656c  43.addWidget(sel
-00062e80: 662e 7262 5f70 7265 7769 7474 290d 0a20  f.rb_prewitt).. 
-00062e90: 2020 2020 2020 2068 626f 7834 332e 6164         hbox43.ad
-00062ea0: 6457 6964 6765 7428 7365 6c66 2e72 625f  dWidget(self.rb_
-00062eb0: 736f 6265 6c29 0d0a 2020 2020 2020 2020  sobel)..        
-00062ec0: 6772 6f75 7042 6f78 342e 7365 744c 6179  groupBox4.setLay
-00062ed0: 6f75 7428 6862 6f78 3433 290d 0a0d 0a20  out(hbox43).... 
-00062ee0: 2020 2020 2020 2076 626f 7834 2e61 6464         vbox4.add
-00062ef0: 5769 6467 6574 2867 726f 7570 426f 7834  Widget(groupBox4
-00062f00: 290d 0a0d 0a0d 0a20 2020 2020 2020 2068  )......        h
-00062f10: 626f 7834 3220 3d20 5174 5769 6467 6574  box42 = QtWidget
-00062f20: 732e 5148 426f 784c 6179 6f75 7428 290d  s.QHBoxLayout().
-00062f30: 0a20 2020 2020 2020 2074 6578 7431 203d  .        text1 =
-00062f40: 2051 7457 6964 6765 7473 2e51 4c61 6265   QtWidgets.QLabe
-00062f50: 6c28 7365 6c66 290d 0a20 2020 2020 2020  l(self)..       
-00062f60: 2074 6578 7431 2e73 6574 5465 7874 2827   text1.setText('
-00062f70: 204d 6178 2073 6869 6674 205b 7069 7865   Max shift [pixe
-00062f80: 6c73 5d3a 2027 290d 0a0d 0a20 2020 2020  ls]: ')....     
-00062f90: 2020 2073 656c 662e 7463 5f6d 6178 7368     self.tc_maxsh
-00062fa0: 6966 7420 3d20 5174 5769 6467 6574 732e  ift = QtWidgets.
-00062fb0: 5153 7069 6e42 6f78 2829 0d0a 2020 2020  QSpinBox()..    
-00062fc0: 2020 2020 7365 6c66 2e74 635f 6d61 7873      self.tc_maxs
-00062fd0: 6869 6674 2e73 6574 4d69 6e69 6d75 6d28  hift.setMinimum(
-00062fe0: 3029 0d0a 2020 2020 2020 2020 7365 6c66  0)..        self
-00062ff0: 2e74 635f 6d61 7873 6869 6674 2e76 616c  .tc_maxshift.val
-00063000: 7565 4368 616e 6765 645b 696e 745d 2e63  ueChanged[int].c
-00063010: 6f6e 6e65 6374 2873 656c 662e 4f6e 5365  onnect(self.OnSe
-00063020: 744d 6178 5368 6966 7429 0d0a 0d0a 0d0a  tMaxShift)......
-00063030: 2020 2020 2020 2020 6862 6f78 3432 2e61          hbox42.a
-00063040: 6464 5769 6467 6574 2874 6578 7431 290d  ddWidget(text1).
-00063050: 0a20 2020 2020 2020 2068 626f 7834 322e  .        hbox42.
-00063060: 6164 6457 6964 6765 7428 7365 6c66 2e74  addWidget(self.t
-00063070: 635f 6d61 7873 6869 6674 290d 0a20 2020  c_maxshift)..   
-00063080: 2020 2020 2076 626f 7834 2e61 6464 4c61       vbox4.addLa
-00063090: 796f 7574 2868 626f 7834 3229 0d0a 2020  yout(hbox42)..  
-000630a0: 2020 2020 2020 7662 6f78 342e 6164 6453        vbox4.addS
-000630b0: 7472 6574 6368 2831 290d 0a0d 0a0d 0a20  tretch(1)...... 
-000630c0: 2020 2020 2020 2073 656c 662e 7368 6f77         self.show
-000630d0: 6373 636f 725f 6362 203d 2051 7457 6964  cscor_cb = QtWid
-000630e0: 6765 7473 2e51 4368 6563 6b42 6f78 2827  gets.QCheckBox('
-000630f0: 5368 6f77 2043 726f 7373 2d63 6f72 7265  Show Cross-corre
-00063100: 6c61 7469 6f6e 272c 2073 656c 6629 0d0a  lation', self)..
-00063110: 2020 2020 2020 2020 7365 6c66 2e73 686f          self.sho
-00063120: 7763 7363 6f72 5f63 622e 7374 6174 6543  wcscor_cb.stateC
-00063130: 6861 6e67 6564 2e63 6f6e 6e65 6374 2873  hanged.connect(s
-00063140: 656c 662e 4f6e 5368 6f77 4343 6f72 7229  elf.OnShowCCorr)
-00063150: 0d0a 2020 2020 2020 2020 7662 6f78 342e  ..        vbox4.
-00063160: 6164 6457 6964 6765 7428 7365 6c66 2e73  addWidget(self.s
-00063170: 686f 7763 7363 6f72 5f63 6229 0d0a 0d0a  howcscor_cb)....
-00063180: 2020 2020 2020 2020 7662 6f78 342e 6164          vbox4.ad
-00063190: 6453 7472 6574 6368 2829 0d0a 2020 2020  dStretch()..    
-000631a0: 2020 2020 7369 7a65 7234 2e73 6574 4c61      sizer4.setLa
-000631b0: 796f 7574 2876 626f 7834 290d 0a0d 0a0d  yout(vbox4).....
-000631c0: 0a20 2020 2020 2020 2023 7061 6e65 6c20  .        #panel 
-000631d0: 350d 0a20 2020 2020 2020 2076 626f 7835  5..        vbox5
-000631e0: 203d 2051 7457 6964 6765 7473 2e51 5642   = QtWidgets.QVB
-000631f0: 6f78 4c61 796f 7574 2829 0d0a 0d0a 2020  oxLayout()....  
-00063200: 2020 2020 2020 7365 6c66 2e74 635f 7265        self.tc_re
-00063210: 6669 6d67 203d 2051 7457 6964 6765 7473  fimg = QtWidgets
-00063220: 2e51 4c61 6265 6c28 7365 6c66 290d 0a20  .QLabel(self).. 
-00063230: 2020 2020 2020 2073 656c 662e 7463 5f72         self.tc_r
-00063240: 6566 696d 672e 7365 7454 6578 7428 2752  efimg.setText('R
-00063250: 6566 6572 656e 6365 2069 6d61 6765 2729  eference image')
-00063260: 0d0a 0d0a 2020 2020 2020 2020 6672 616d  ....        fram
-00063270: 6520 3d20 5174 5769 6467 6574 732e 5146  e = QtWidgets.QF
-00063280: 7261 6d65 2829 0d0a 2020 2020 2020 2020  rame()..        
-00063290: 6672 616d 652e 7365 7446 7261 6d65 5374  frame.setFrameSt
-000632a0: 796c 6528 5174 5769 6467 6574 732e 5146  yle(QtWidgets.QF
-000632b0: 7261 6d65 2e53 7479 6c65 6450 616e 656c  rame.StyledPanel
-000632c0: 7c51 7457 6964 6765 7473 2e51 4672 616d  |QtWidgets.QFram
-000632d0: 652e 5375 6e6b 656e 290d 0a20 2020 2020  e.Sunken)..     
-000632e0: 2020 2066 626f 7820 3d20 5174 5769 6467     fbox = QtWidg
-000632f0: 6574 732e 5148 426f 784c 6179 6f75 7428  ets.QHBoxLayout(
-00063300: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-00063310: 662e 7265 6669 6d67 6669 6720 3d20 4669  f.refimgfig = Fi
-00063320: 6775 7265 2828 342e 302c 2034 2e30 2929  gure((4.0, 4.0))
-00063330: 0d0a 2020 2020 2020 2020 7365 6c66 2e52  ..        self.R
-00063340: 6566 496d 6167 6550 616e 656c 203d 2046  efImagePanel = F
-00063350: 6967 7572 6543 616e 7661 7328 7365 6c66  igureCanvas(self
-00063360: 2e72 6566 696d 6766 6967 290d 0a20 2020  .refimgfig)..   
-00063370: 2020 2020 2073 656c 662e 5265 6649 6d61       self.RefIma
-00063380: 6765 5061 6e65 6c2e 7365 7450 6172 656e  gePanel.setParen
-00063390: 7428 7365 6c66 290d 0a20 2020 2020 2020  t(self)..       
-000633a0: 2073 656c 662e 5265 6649 6d61 6765 5061   self.RefImagePa
-000633b0: 6e65 6c2e 7365 7443 7572 736f 7228 5174  nel.setCursor(Qt
-000633c0: 2e43 726f 7373 4375 7273 6f72 290d 0a0d  .CrossCursor)...
-000633d0: 0a20 2020 2020 2020 2066 626f 782e 6164  .        fbox.ad
-000633e0: 6457 6964 6765 7428 7365 6c66 2e52 6566  dWidget(self.Ref
-000633f0: 496d 6167 6550 616e 656c 290d 0a20 2020  ImagePanel)..   
-00063400: 2020 2020 2066 7261 6d65 2e73 6574 4c61       frame.setLa
-00063410: 796f 7574 2866 626f 7829 0d0a 0d0a 2020  yout(fbox)....  
-00063420: 2020 2020 2020 7365 6c66 2e52 6566 496d        self.RefIm
-00063430: 6167 6550 616e 656c 2e6d 706c 5f63 6f6e  agePanel.mpl_con
-00063440: 6e65 6374 2827 6275 7474 6f6e 5f70 7265  nect('button_pre
-00063450: 7373 5f65 7665 6e74 272c 2073 656c 662e  ss_event', self.
-00063460: 4f6e 506f 696e 7452 6566 696d 6167 6529  OnPointRefimage)
-00063470: 0d0a 2020 2020 2020 2020 7365 6c66 2e52  ..        self.R
-00063480: 6566 496d 6167 6550 616e 656c 2e6d 706c  efImagePanel.mpl
-00063490: 5f63 6f6e 6e65 6374 2827 6275 7474 6f6e  _connect('button
-000634a0: 5f72 656c 6561 7365 5f65 7665 6e74 272c  _release_event',
-000634b0: 2073 656c 662e 4f6e 5365 6c65 6374 696f   self.OnSelectio
-000634c0: 6e29 0d0a 0d0a 2020 2020 2020 2020 7662  n)....        vb
-000634d0: 6f78 352e 6164 6457 6964 6765 7428 7365  ox5.addWidget(se
-000634e0: 6c66 2e74 635f 7265 6669 6d67 290d 0a20  lf.tc_refimg).. 
-000634f0: 2020 2020 2020 2076 626f 7835 2e61 6464         vbox5.add
-00063500: 5769 6467 6574 2866 7261 6d65 290d 0a20  Widget(frame).. 
-00063510: 2020 2020 2020 2076 626f 7835 2e61 6464         vbox5.add
-00063520: 5374 7265 7463 6828 3129 0d0a 0d0a 0d0a  Stretch(1)......
-00063530: 2020 2020 2020 2020 2370 616e 656c 2036          #panel 6
-00063540: 0d0a 2020 2020 2020 2020 7369 7a65 7236  ..        sizer6
-00063550: 203d 2051 7457 6964 6765 7473 2e51 4772   = QtWidgets.QGr
-00063560: 6f75 7042 6f78 2827 4d61 6e75 616c 2041  oupBox('Manual A
-00063570: 6c69 676e 6d65 6e74 2729 0d0a 2020 2020  lignment')..    
-00063580: 2020 2020 7662 6f78 3620 3d20 5174 5769      vbox6 = QtWi
-00063590: 6467 6574 732e 5156 426f 784c 6179 6f75  dgets.QVBoxLayou
-000635a0: 7428 290d 0a20 2020 2020 2020 2076 626f  t()..        vbo
-000635b0: 7836 2e73 6574 5370 6163 696e 6728 3029  x6.setSpacing(0)
-000635c0: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7365  ......        se
-000635d0: 6c66 2e62 7574 746f 6e5f 6d61 6e61 6c69  lf.button_manali
-000635e0: 676e 203d 2051 7457 6964 6765 7473 2e51  gn = QtWidgets.Q
-000635f0: 5075 7368 4275 7474 6f6e 2827 5069 636b  PushButton('Pick
-00063600: 2061 2070 6f69 6e74 206f 6e20 7265 6665   a point on refe
-00063610: 7265 6e63 6520 696d 6167 6527 290d 0a20  rence image').. 
-00063620: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
-00063630: 6f6e 5f6d 616e 616c 6967 6e2e 636c 6963  on_manalign.clic
-00063640: 6b65 642e 636f 6e6e 6563 7428 7365 6c66  ked.connect(self
-00063650: 2e4f 6e50 6963 6b52 6566 506f 696e 7429  .OnPickRefPoint)
-00063660: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
-00063670: 7574 746f 6e5f 6d61 6e61 6c69 676e 2e73  utton_manalign.s
-00063680: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
-00063690: 0d0a 2020 2020 2020 2020 7662 6f78 362e  ..        vbox6.
-000636a0: 6164 6457 6964 6765 7428 7365 6c66 2e62  addWidget(self.b
-000636b0: 7574 746f 6e5f 6d61 6e61 6c69 676e 290d  utton_manalign).
-000636c0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-000636d0: 6275 7474 6f6e 5f70 6963 6b32 6e64 706f  button_pick2ndpo
-000636e0: 696e 7420 3d20 5174 5769 6467 6574 732e  int = QtWidgets.
-000636f0: 5150 7573 6842 7574 746f 6e28 2754 6869  QPushButton('Thi
-00063700: 7320 696d 6167 653a 2063 6c69 636b 206f  s image: click o
-00063710: 6e20 7361 6d65 2070 6f69 6e74 2729 0d0a  n same point')..
-00063720: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-00063730: 746f 6e5f 7069 636b 326e 6470 6f69 6e74  ton_pick2ndpoint
-00063740: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
-00063750: 2873 656c 662e 4f6e 5069 636b 436f 7272  (self.OnPickCorr
-00063760: 506f 696e 7429 0d0a 2020 2020 2020 2020  Point)..        
-00063770: 7365 6c66 2e62 7574 746f 6e5f 7069 636b  self.button_pick
-00063780: 326e 6470 6f69 6e74 2e73 6574 456e 6162  2ndpoint.setEnab
-00063790: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
-000637a0: 2020 2020 7662 6f78 362e 6164 6457 6964      vbox6.addWid
-000637b0: 6765 7428 7365 6c66 2e62 7574 746f 6e5f  get(self.button_
-000637c0: 7069 636b 326e 6470 6f69 6e74 290d 0a0d  pick2ndpoint)...
-000637d0: 0a20 2020 2020 2020 2073 656c 662e 6275  .        self.bu
-000637e0: 7474 6f6e 5f61 7070 6c79 6d61 6e20 3d20  tton_applyman = 
-000637f0: 5174 5769 6467 6574 732e 5150 7573 6842  QtWidgets.QPushB
-00063800: 7574 746f 6e28 2741 7070 6c79 206d 616e  utton('Apply man
-00063810: 7561 6c20 7368 6966 7473 2729 0d0a 2020  ual shifts')..  
-00063820: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
-00063830: 6e5f 6170 706c 796d 616e 2e63 6c69 636b  n_applyman.click
-00063840: 6564 2e63 6f6e 6e65 6374 2873 656c 662e  ed.connect(self.
-00063850: 4f6e 4170 706c 794d 616e 5368 6966 7473  OnApplyManShifts
-00063860: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00063870: 6275 7474 6f6e 5f61 7070 6c79 6d61 6e2e  button_applyman.
-00063880: 7365 7445 6e61 626c 6564 2846 616c 7365  setEnabled(False
-00063890: 290d 0a20 2020 2020 2020 2076 626f 7836  )..        vbox6
-000638a0: 2e61 6464 5769 6467 6574 2873 656c 662e  .addWidget(self.
-000638b0: 6275 7474 6f6e 5f61 7070 6c79 6d61 6e29  button_applyman)
-000638c0: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7365  ......        se
-000638d0: 6c66 2e74 6578 7463 7472 6c5f 6d73 3120  lf.textctrl_ms1 
-000638e0: 3d20 5174 5769 6467 6574 732e 514c 6162  = QtWidgets.QLab
-000638f0: 656c 2873 656c 6629 0d0a 2020 2020 2020  el(self)..      
-00063900: 2020 7365 6c66 2e74 6578 7463 7472 6c5f    self.textctrl_
-00063910: 6d73 3220 3d20 5174 5769 6467 6574 732e  ms2 = QtWidgets.
-00063920: 514c 6162 656c 2873 656c 6629 0d0a 2020  QLabel(self)..  
-00063930: 2020 2020 2020 7662 6f78 362e 6164 6457        vbox6.addW
-00063940: 6964 6765 7428 7365 6c66 2e74 6578 7463  idget(self.textc
-00063950: 7472 6c5f 6d73 3129 0d0a 2020 2020 2020  trl_ms1)..      
-00063960: 2020 7662 6f78 362e 6164 6457 6964 6765    vbox6.addWidge
-00063970: 7428 7365 6c66 2e74 6578 7463 7472 6c5f  t(self.textctrl_
-00063980: 6d73 3229 0d0a 0d0a 0d0a 2020 2020 2020  ms2)......      
-00063990: 2020 7365 6c66 2e74 6578 7463 7472 6c5f    self.textctrl_
-000639a0: 6d73 312e 7365 7454 6578 7428 2758 206d  ms1.setText('X m
-000639b0: 616e 7561 6c20 7368 6966 743a 2027 290d  anual shift: ').
-000639c0: 0a20 2020 2020 2020 2073 656c 662e 7465  .        self.te
-000639d0: 7874 6374 726c 5f6d 7332 2e73 6574 5465  xtctrl_ms2.setTe
-000639e0: 7874 2827 5920 6d61 6e75 616c 2073 6869  xt('Y manual shi
-000639f0: 6674 3a20 2729 0d0a 0d0a 0d0a 2020 2020  ft: ')......    
-00063a00: 2020 2020 7369 7a65 7236 2e73 6574 4c61      sizer6.setLa
-00063a10: 796f 7574 2876 626f 7836 290d 0a0d 0a0d  yout(vbox6).....
-00063a20: 0a0d 0a20 2020 2020 2020 2023 7061 6e65  ...        #pane
-00063a30: 6c20 370d 0a20 2020 2020 2020 2076 626f  l 7..        vbo
-00063a40: 7837 203d 2051 7457 6964 6765 7473 2e51  x7 = QtWidgets.Q
-00063a50: 5642 6f78 4c61 796f 7574 2829 0d0a 2020  VBoxLayout()..  
-00063a60: 2020 2020 2020 7662 6f78 372e 7365 7453        vbox7.setS
-00063a70: 7061 6369 6e67 2830 290d 0a0d 0a20 2020  pacing(0)....   
-00063a80: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-00063a90: 5f73 6176 6569 6d67 203d 2051 7457 6964  _saveimg = QtWid
-00063aa0: 6765 7473 2e51 5075 7368 4275 7474 6f6e  gets.QPushButton
-00063ab0: 2827 5361 7665 2069 6d61 6765 2073 6869  ('Save image shi
-00063ac0: 6674 7320 706c 6f74 2729 0d0a 2020 2020  fts plot')..    
-00063ad0: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-00063ae0: 7361 7665 696d 672e 636c 6963 6b65 642e  saveimg.clicked.
-00063af0: 636f 6e6e 6563 7428 7365 6c66 2e4f 6e53  connect(self.OnS
-00063b00: 6176 6553 6869 6674 7350 6c6f 7429 0d0a  aveShiftsPlot)..
-00063b10: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-00063b20: 746f 6e5f 7361 7665 696d 672e 7365 7445  ton_saveimg.setE
-00063b30: 6e61 626c 6564 2846 616c 7365 290d 0a20  nabled(False).. 
-00063b40: 2020 2020 2020 2076 626f 7837 2e61 6464         vbox7.add
-00063b50: 5769 6467 6574 2873 656c 662e 6275 7474  Widget(self.butt
-00063b60: 6f6e 5f73 6176 6569 6d67 290d 0a0d 0a0d  on_saveimg).....
-00063b70: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00063b80: 6275 7474 6f6e 5f73 6176 6573 6869 6674  button_saveshift
-00063b90: 7320 3d20 5174 5769 6467 6574 732e 5150  s = QtWidgets.QP
-00063ba0: 7573 6842 7574 746f 6e28 2753 6176 6520  ushButton('Save 
-00063bb0: 696d 6167 6520 7368 6966 7473 2729 0d0a  image shifts')..
-00063bc0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-00063bd0: 746f 6e5f 7361 7665 7368 6966 7473 2e63  ton_saveshifts.c
-00063be0: 6c69 636b 6564 2e63 6f6e 6e65 6374 2873  licked.connect(s
-00063bf0: 656c 662e 4f6e 5361 7665 5368 6966 7473  elf.OnSaveShifts
-00063c00: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00063c10: 6275 7474 6f6e 5f73 6176 6573 6869 6674  button_saveshift
-00063c20: 732e 7365 7445 6e61 626c 6564 2846 616c  s.setEnabled(Fal
-00063c30: 7365 290d 0a20 2020 2020 2020 2076 626f  se)..        vbo
-00063c40: 7837 2e61 6464 5769 6467 6574 2873 656c  x7.addWidget(sel
-00063c50: 662e 6275 7474 6f6e 5f73 6176 6573 6869  f.button_saveshi
-00063c60: 6674 7329 0d0a 0d0a 2020 2020 2020 2020  fts)....        
-00063c70: 7365 6c66 2e62 7574 746f 6e5f 6c6f 6164  self.button_load
-00063c80: 7368 6966 7473 203d 2051 7457 6964 6765  shifts = QtWidge
-00063c90: 7473 2e51 5075 7368 4275 7474 6f6e 2827  ts.QPushButton('
-00063ca0: 4c6f 6164 2069 6d61 6765 2073 6869 6674  Load image shift
-00063cb0: 7327 290d 0a20 2020 2020 2020 2073 656c  s')..        sel
-00063cc0: 662e 6275 7474 6f6e 5f6c 6f61 6473 6869  f.button_loadshi
-00063cd0: 6674 732e 636c 6963 6b65 642e 636f 6e6e  fts.clicked.conn
-00063ce0: 6563 7428 7365 6c66 2e4f 6e4c 6f61 6453  ect(self.OnLoadS
-00063cf0: 6869 6674 7329 0d0a 2020 2020 2020 2020  hifts)..        
-00063d00: 7662 6f78 372e 6164 6457 6964 6765 7428  vbox7.addWidget(
-00063d10: 7365 6c66 2e62 7574 746f 6e5f 6c6f 6164  self.button_load
-00063d20: 7368 6966 7473 290d 0a0d 0a20 2020 2020  shifts)....     
-00063d30: 2020 2073 656c 662e 6275 7474 6f6e 5f63     self.button_c
-00063d40: 726f 7020 3d20 5174 5769 6467 6574 732e  rop = QtWidgets.
-00063d50: 5150 7573 6842 7574 746f 6e28 2743 726f  QPushButton('Cro
-00063d60: 7020 616c 6967 6e65 6420 696d 6167 6573  p aligned images
-00063d70: 2729 0d0a 2020 2020 2020 2020 7365 6c66  ')..        self
-00063d80: 2e62 7574 746f 6e5f 6372 6f70 2e63 6c69  .button_crop.cli
-00063d90: 636b 6564 2e63 6f6e 6e65 6374 2873 656c  cked.connect(sel
-00063da0: 662e 4f6e 4372 6f70 5368 6966 7473 290d  f.OnCropShifts).
-00063db0: 0a20 2020 2020 2020 2073 656c 662e 6275  .        self.bu
-00063dc0: 7474 6f6e 5f63 726f 702e 7365 7445 6e61  tton_crop.setEna
-00063dd0: 626c 6564 2846 616c 7365 290d 0a20 2020  bled(False)..   
-00063de0: 2020 2020 2076 626f 7837 2e61 6464 5769       vbox7.addWi
-00063df0: 6467 6574 2873 656c 662e 6275 7474 6f6e  dget(self.button
-00063e00: 5f63 726f 7029 0d0a 0d0a 2020 2020 2020  _crop)....      
-00063e10: 2020 7365 6c66 2e62 7574 746f 6e5f 6163    self.button_ac
-00063e20: 6365 7074 203d 2051 7457 6964 6765 7473  cept = QtWidgets
-00063e30: 2e51 5075 7368 4275 7474 6f6e 2827 4170  .QPushButton('Ap
-00063e40: 706c 7920 416c 6967 6e6d 656e 7427 290d  ply Alignment').
-00063e50: 0a20 2020 2020 2020 2073 656c 662e 6275  .        self.bu
-00063e60: 7474 6f6e 5f61 6363 6570 742e 636c 6963  tton_accept.clic
-00063e70: 6b65 642e 636f 6e6e 6563 7428 7365 6c66  ked.connect(self
-00063e80: 2e4f 6e41 6363 6570 7429 0d0a 2020 2020  .OnAccept)..    
-00063e90: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-00063ea0: 6163 6365 7074 2e73 6574 456e 6162 6c65  accept.setEnable
-00063eb0: 6428 4661 6c73 6529 0d0a 2020 2020 2020  d(False)..      
-00063ec0: 2020 7662 6f78 372e 6164 6457 6964 6765    vbox7.addWidge
-00063ed0: 7428 7365 6c66 2e62 7574 746f 6e5f 6163  t(self.button_ac
-00063ee0: 6365 7074 290d 0a0d 0a20 2020 2020 2020  cept)....       
-00063ef0: 2073 656c 662e 6275 7474 6f6e 5f63 6c6f   self.button_clo
-00063f00: 7365 203d 2051 7457 6964 6765 7473 2e51  se = QtWidgets.Q
-00063f10: 5075 7368 4275 7474 6f6e 2827 4469 736d  PushButton('Dism
-00063f20: 6973 7327 290d 0a20 2020 2020 2020 2073  iss')..        s
-00063f30: 656c 662e 6275 7474 6f6e 5f63 6c6f 7365  elf.button_close
-00063f40: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
-00063f50: 2873 656c 662e 636c 6f73 6529 0d0a 2020  (self.close)..  
-00063f60: 2020 2020 2020 7662 6f78 372e 6164 6457        vbox7.addW
-00063f70: 6964 6765 7428 7365 6c66 2e62 7574 746f  idget(self.butto
-00063f80: 6e5f 636c 6f73 6529 0d0a 0d0a 0d0a 0d0a  n_close)........
-00063f90: 0d0a 0d0a 2020 2020 2020 2020 6862 6f78  ....        hbox
-00063fa0: 746f 7020 3d20 5174 5769 6467 6574 732e  top = QtWidgets.
-00063fb0: 5148 426f 784c 6179 6f75 7428 290d 0a0d  QHBoxLayout()...
-00063fc0: 0a20 2020 2020 2020 2076 626f 784c 203d  .        vboxL =
-00063fd0: 2051 7457 6964 6765 7473 2e51 5642 6f78   QtWidgets.QVBox
-00063fe0: 4c61 796f 7574 2829 0d0a 2020 2020 2020  Layout()..      
-00063ff0: 2020 7662 6f78 5220 3d20 5174 5769 6467    vboxR = QtWidg
-00064000: 6574 732e 5156 426f 784c 6179 6f75 7428  ets.QVBoxLayout(
-00064010: 290d 0a0d 0a0d 0a20 2020 2020 2020 2076  )......        v
-00064020: 626f 784c 2e61 6464 5769 6467 6574 2873  boxL.addWidget(s
-00064030: 697a 6572 3829 0d0a 2020 2020 2020 2020  izer8)..        
-00064040: 7662 6f78 4c2e 6164 6453 7472 6574 6368  vboxL.addStretch
-00064050: 2831 290d 0a20 2020 2020 2020 2076 626f  (1)..        vbo
-00064060: 784c 2e61 6464 5769 6467 6574 2867 726f  xL.addWidget(gro
-00064070: 7570 426f 7839 290d 0a20 2020 2020 2020  upBox9)..       
-00064080: 2076 626f 784c 2e61 6464 5374 7265 7463   vboxL.addStretc
-00064090: 6828 3129 0d0a 2020 2020 2020 2020 7662  h(1)..        vb
-000640a0: 6f78 4c2e 6164 6457 6964 6765 7428 7369  oxL.addWidget(si
-000640b0: 7a65 7234 290d 0a20 2020 2020 2020 2076  zer4)..        v
-000640c0: 626f 784c 2e61 6464 5374 7265 7463 6828  boxL.addStretch(
-000640d0: 3129 0d0a 2020 2020 2020 2020 7662 6f78  1)..        vbox
-000640e0: 4c2e 6164 6457 6964 6765 7428 7369 7a65  L.addWidget(size
-000640f0: 7236 290d 0a20 2020 2020 2020 2076 626f  r6)..        vbo
-00064100: 784c 2e61 6464 5374 7265 7463 6828 3129  xL.addStretch(1)
-00064110: 0d0a 2020 2020 2020 2020 7662 6f78 4c2e  ..        vboxL.
-00064120: 6164 644c 6179 6f75 7428 7662 6f78 3729  addLayout(vbox7)
-00064130: 0d0a 0d0a 2020 2020 2020 2020 6862 6f78  ....        hbox
-00064140: 5254 203d 2051 7457 6964 6765 7473 2e51  RT = QtWidgets.Q
-00064150: 4842 6f78 4c61 796f 7574 2829 0d0a 2020  HBoxLayout()..  
-00064160: 2020 2020 2020 6862 6f78 5242 203d 2051        hboxRB = Q
-00064170: 7457 6964 6765 7473 2e51 4842 6f78 4c61  tWidgets.QHBoxLa
-00064180: 796f 7574 2829 0d0a 0d0a 2020 2020 2020  yout()....      
-00064190: 2020 6862 6f78 5254 2e61 6464 4c61 796f    hboxRT.addLayo
-000641a0: 7574 2876 626f 7831 290d 0a20 2020 2020  ut(vbox1)..     
-000641b0: 2020 2068 626f 7852 542e 6164 644c 6179     hboxRT.addLay
-000641c0: 6f75 7428 7662 6f78 3529 0d0a 0d0a 2020  out(vbox5)....  
-000641d0: 2020 2020 2020 6862 6f78 5242 2e61 6464        hboxRB.add
-000641e0: 4c61 796f 7574 2876 626f 7833 290d 0a20  Layout(vbox3).. 
-000641f0: 2020 2020 2020 2068 626f 7852 422e 6164         hboxRB.ad
-00064200: 644c 6179 6f75 7428 7662 6f78 3229 0d0a  dLayout(vbox2)..
-00064210: 2020 2020 2020 2020 6862 6f78 5242 2e61          hboxRB.a
-00064220: 6464 5374 7265 7463 6828 3129 0d0a 0d0a  ddStretch(1)....
-00064230: 2020 2020 2020 2020 7662 6f78 522e 6164          vboxR.ad
-00064240: 6453 7472 6574 6368 2830 2e32 290d 0a20  dStretch(0.2).. 
-00064250: 2020 2020 2020 2076 626f 7852 2e61 6464         vboxR.add
-00064260: 4c61 796f 7574 2868 626f 7852 5429 0d0a  Layout(hboxRT)..
-00064270: 2020 2020 2020 2020 7662 6f78 522e 6164          vboxR.ad
-00064280: 6453 7472 6574 6368 2831 290d 0a20 2020  dStretch(1)..   
-00064290: 2020 2020 2076 626f 7852 2e61 6464 4c61       vboxR.addLa
-000642a0: 796f 7574 2868 626f 7852 4229 0d0a 2020  yout(hboxRB)..  
-000642b0: 2020 2020 2020 7662 6f78 522e 6164 6453        vboxR.addS
-000642c0: 7472 6574 6368 2831 290d 0a0d 0a20 2020  tretch(1)....   
-000642d0: 2020 2020 2068 626f 7874 6f70 2e61 6464       hboxtop.add
-000642e0: 4c61 796f 7574 2876 626f 784c 290d 0a20  Layout(vboxL).. 
-000642f0: 2020 2020 2020 2068 626f 7874 6f70 2e61         hboxtop.a
-00064300: 6464 5374 7265 7463 6828 3129 0d0a 2020  ddStretch(1)..  
-00064310: 2020 2020 2020 6862 6f78 746f 702e 6164        hboxtop.ad
-00064320: 644c 6179 6f75 7428 7662 6f78 5229 0d0a  dLayout(vboxR)..
-00064330: 0d0a 0d0a 2020 2020 2020 2020 6862 6f78  ....        hbox
-00064340: 746f 702e 7365 7443 6f6e 7465 6e74 734d  top.setContentsM
-00064350: 6172 6769 6e73 2832 302c 3230 2c32 302c  argins(20,20,20,
-00064360: 3230 290d 0a20 2020 2020 2020 2073 656c  20)..        sel
-00064370: 662e 7365 744c 6179 6f75 7428 6862 6f78  f.setLayout(hbox
-00064380: 746f 7029 0d0a 0d0a 0d0a 2020 2020 2020  top)......      
-00064390: 2020 7365 6c66 2e53 686f 7749 6d61 6765    self.ShowImage
-000643a0: 2829 0d0a 0d0a 0d0a 0d0a 232d 2d2d 2d2d  ()........#-----
-000643b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000643c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000643d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000643e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000643f0: 2d0d 0a20 2020 2064 6566 2053 686f 7749  -..    def ShowI
-00064400: 6d61 6765 2873 656c 6629 3a0d 0a0d 0a20  mage(self):.... 
-00064410: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
-00064420: 6f6d 2e73 7461 636b 5f34 6420 3d3d 2030  om.stack_4d == 0
-00064430: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00064440: 6d61 6765 203d 2073 656c 662e 616c 6967  mage = self.alig
-00064450: 6e65 645f 7374 6163 6b5b 3a2c 3a2c 7365  ned_stack[:,:,se
-00064460: 6c66 2e69 6576 5d0d 0a20 2020 2020 2020  lf.iev]..       
-00064470: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00064480: 2020 2020 696d 6167 6520 3d20 7365 6c66      image = self
-00064490: 2e61 6c69 676e 6564 5f73 7461 636b 5b3a  .aligned_stack[:
-000644a0: 2c3a 2c73 656c 662e 6965 762c 7365 6c66  ,:,self.iev,self
-000644b0: 2e69 7468 6574 615d 0d0a 0d0a 0d0a 2020  .itheta]......  
-000644c0: 2020 2020 2020 6669 6720 3d20 7365 6c66        fig = self
-000644d0: 2e61 6273 696d 6766 6967 0d0a 2020 2020  .absimgfig..    
-000644e0: 2020 2020 6669 672e 636c 6628 290d 0a20      fig.clf().. 
-000644f0: 2020 2020 2020 2066 6967 2e61 6464 5f61         fig.add_a
-00064500: 7865 7328 2828 302e 302c 302e 302c 312e  xes(((0.0,0.0,1.
-00064510: 302c 312e 3029 2929 0d0a 2020 2020 2020  0,1.0)))..      
-00064520: 2020 6178 6573 203d 2066 6967 2e67 6361    axes = fig.gca
-00064530: 2829 0d0a 0d0a 0d0a 2020 2020 2020 2020  ()......        
-00064540: 5f69 6d20 3d20 6178 6573 2e69 6d73 686f  _im = axes.imsho
-00064550: 7728 6e70 2e72 6f74 3930 2869 6d61 6765  w(np.rot90(image
-00064560: 292c 2063 6d61 703d 6d61 7470 6c6f 746c  ), cmap=matplotl
-00064570: 6962 2e63 6d2e 6765 745f 636d 6170 2827  ib.cm.get_cmap('
-00064580: 6772 6179 2729 290d 0a20 2020 2020 2020  gray'))..       
-00064590: 2061 7865 732e 6175 746f 7363 616c 6528   axes.autoscale(
-000645a0: 4661 6c73 6529 0d0a 2320 2020 2020 2020  False)..#       
-000645b0: 2020 6966 2073 656c 662e 6d61 6e5f 616c    if self.man_al
-000645c0: 6967 6e20 3d3d 2032 3a0d 0a23 2020 2020  ign == 2:..#    
-000645d0: 2020 2020 2020 2020 206c 783d 6d61 7470           lx=matp
-000645e0: 6c6f 746c 6962 2e6c 696e 6573 2e4c 696e  lotlib.lines.Lin
-000645f0: 6532 4428 5b73 656c 662e 6d61 6e5f 7972  e2D([self.man_yr
-00064600: 6566 2d73 656c 662e 6d61 6e5f 7973 5b73  ef-self.man_ys[s
-00064610: 656c 662e 6965 765d 2c0d 0a23 2020 2020  elf.iev],..#    
-00064620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064640: 2073 656c 662e 6d61 6e5f 7972 6566 2d73   self.man_yref-s
-00064650: 656c 662e 6d61 6e5f 7973 5b73 656c 662e  elf.man_ys[self.
-00064660: 6965 765d 5d2c 0d0a 2320 2020 2020 2020  iev]],..#       
-00064670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064680: 2020 2020 2020 2020 2020 2020 2020 5b30                [0
-00064690: 2c73 656c 662e 7374 6163 6b2e 6e5f 636f  ,self.stack.n_co
-000646a0: 6c73 5d2c 636f 6c6f 723d 2772 6564 2729  ls],color='red')
-000646b0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-000646c0: 6c79 3d6d 6174 706c 6f74 6c69 622e 6c69  ly=matplotlib.li
-000646d0: 6e65 732e 4c69 6e65 3244 285b 302c 7365  nes.Line2D([0,se
-000646e0: 6c66 2e73 7461 636b 2e6e 5f72 6f77 735d  lf.stack.n_rows]
-000646f0: 2c0d 0a23 2020 2020 2020 2020 2020 2020  ,..#            
-00064700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064710: 2020 2020 2020 2020 5b73 656c 662e 6d61          [self.ma
-00064720: 6e5f 7872 6566 2d73 656c 662e 6d61 6e5f  n_xref-self.man_
-00064730: 7873 5b73 656c 662e 6965 765d 2c0d 0a23  xs[self.iev],..#
-00064740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062bb0: 7265 6769 6f6e 203d 2051 7457 6964 6765  region = QtWidge
+00062bc0: 7473 2e51 5075 7368 4275 7474 6f6e 2827  ts.QPushButton('
+00062bd0: 5265 6d6f 7665 2073 7562 7265 6769 6f6e  Remove subregion
+00062be0: 2073 656c 6563 7469 6f6e 2729 0d0a 2020   selection')..  
+00062bf0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+00062c00: 6e5f 6465 6c73 7562 7265 6769 6f6e 2e63  n_delsubregion.c
+00062c10: 6c69 636b 6564 2e63 6f6e 6e65 6374 2873  licked.connect(s
+00062c20: 656c 662e 4f6e 4465 6c65 7465 5375 6272  elf.OnDeleteSubr
+00062c30: 6567 696f 6e29 0d0a 2020 2020 2020 2020  egion)..        
+00062c40: 7365 6c66 2e62 7574 746f 6e5f 6465 6c73  self.button_dels
+00062c50: 7562 7265 6769 6f6e 2e73 6574 456e 6162  ubregion.setEnab
+00062c60: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
+00062c70: 2020 2020 7662 6f78 342e 6164 6457 6964      vbox4.addWid
+00062c80: 6765 7428 7365 6c66 2e62 7574 746f 6e5f  get(self.button_
+00062c90: 6465 6c73 7562 7265 6769 6f6e 290d 0a20  delsubregion).. 
+00062ca0: 2020 2020 2020 2076 626f 7834 2e61 6464         vbox4.add
+00062cb0: 5374 7265 7463 6828 3129 0d0a 0d0a 2020  Stretch(1)....  
+00062cc0: 2020 2020 2020 6772 6f75 7042 6f78 3420        groupBox4 
+00062cd0: 3d20 5174 5769 6467 6574 732e 5147 726f  = QtWidgets.QGro
+00062ce0: 7570 426f 7828 290d 0a20 2020 2020 2020  upBox()..       
+00062cf0: 2068 626f 7834 3320 3d20 5174 5769 6467   hbox43 = QtWidg
+00062d00: 6574 732e 5148 426f 784c 6179 6f75 7428  ets.QHBoxLayout(
+00062d10: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00062d20: 6362 5f65 6467 6565 6e68 203d 2051 7457  cb_edgeenh = QtW
+00062d30: 6964 6765 7473 2e51 4368 6563 6b42 6f78  idgets.QCheckBox
+00062d40: 2827 4564 6765 2045 6e68 616e 6365 6d65  ('Edge Enhanceme
+00062d50: 6e74 272c 2073 656c 6629 0d0a 2020 2020  nt', self)..    
+00062d60: 2020 2020 7365 6c66 2e63 625f 6564 6765      self.cb_edge
+00062d70: 656e 682e 7374 6174 6543 6861 6e67 6564  enh.stateChanged
+00062d80: 2e63 6f6e 6e65 6374 2873 656c 662e 4f6e  .connect(self.On
+00062d90: 4564 6765 4529 0d0a 2020 2020 2020 2020  EdgeE)..        
+00062da0: 6862 6f78 3433 2e61 6464 5769 6467 6574  hbox43.addWidget
+00062db0: 2873 656c 662e 6362 5f65 6467 6565 6e68  (self.cb_edgeenh
+00062dc0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+00062dd0: 662e 7262 5f73 6f62 656c 203d 2051 7457  f.rb_sobel = QtW
+00062de0: 6964 6765 7473 2e51 5261 6469 6f42 7574  idgets.QRadioBut
+00062df0: 746f 6e28 2027 536f 6265 6c27 290d 0a20  ton( 'Sobel').. 
+00062e00: 2020 2020 2020 2073 656c 662e 7262 5f70         self.rb_p
+00062e10: 7265 7769 7474 203d 2051 7457 6964 6765  rewitt = QtWidge
+00062e20: 7473 2e51 5261 6469 6f42 7574 746f 6e28  ts.QRadioButton(
+00062e30: 2750 7265 7769 7474 2729 0d0a 2020 2020  'Prewitt')..    
+00062e40: 2020 2020 7365 6c66 2e72 625f 7072 6577      self.rb_prew
+00062e50: 6974 742e 7365 7443 6865 636b 6564 2854  itt.setChecked(T
+00062e60: 7275 6529 0d0a 2020 2020 2020 2020 7365  rue)..        se
+00062e70: 6c66 2e72 625f 736f 6265 6c2e 7365 7445  lf.rb_sobel.setE
+00062e80: 6e61 626c 6564 2846 616c 7365 290d 0a20  nabled(False).. 
+00062e90: 2020 2020 2020 2073 656c 662e 7262 5f70         self.rb_p
+00062ea0: 7265 7769 7474 2e73 6574 456e 6162 6c65  rewitt.setEnable
+00062eb0: 6428 4661 6c73 6529 0d0a 0d0a 2020 2020  d(False)....    
+00062ec0: 2020 2020 6862 6f78 3433 2e61 6464 5769      hbox43.addWi
+00062ed0: 6467 6574 2873 656c 662e 7262 5f70 7265  dget(self.rb_pre
+00062ee0: 7769 7474 290d 0a20 2020 2020 2020 2068  witt)..        h
+00062ef0: 626f 7834 332e 6164 6457 6964 6765 7428  box43.addWidget(
+00062f00: 7365 6c66 2e72 625f 736f 6265 6c29 0d0a  self.rb_sobel)..
+00062f10: 2020 2020 2020 2020 6772 6f75 7042 6f78          groupBox
+00062f20: 342e 7365 744c 6179 6f75 7428 6862 6f78  4.setLayout(hbox
+00062f30: 3433 290d 0a0d 0a20 2020 2020 2020 2076  43)....        v
+00062f40: 626f 7834 2e61 6464 5769 6467 6574 2867  box4.addWidget(g
+00062f50: 726f 7570 426f 7834 290d 0a0d 0a0d 0a20  roupBox4)...... 
+00062f60: 2020 2020 2020 2068 626f 7834 3220 3d20         hbox42 = 
+00062f70: 5174 5769 6467 6574 732e 5148 426f 784c  QtWidgets.QHBoxL
+00062f80: 6179 6f75 7428 290d 0a20 2020 2020 2020  ayout()..       
+00062f90: 2074 6578 7431 203d 2051 7457 6964 6765   text1 = QtWidge
+00062fa0: 7473 2e51 4c61 6265 6c28 7365 6c66 290d  ts.QLabel(self).
+00062fb0: 0a20 2020 2020 2020 2074 6578 7431 2e73  .        text1.s
+00062fc0: 6574 5465 7874 2827 204d 6178 2073 6869  etText(' Max shi
+00062fd0: 6674 205b 7069 7865 6c73 5d3a 2027 290d  ft [pixels]: ').
+00062fe0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00062ff0: 7463 5f6d 6178 7368 6966 7420 3d20 5174  tc_maxshift = Qt
+00063000: 5769 6467 6574 732e 5153 7069 6e42 6f78  Widgets.QSpinBox
+00063010: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+00063020: 2e74 635f 6d61 7873 6869 6674 2e73 6574  .tc_maxshift.set
+00063030: 4d69 6e69 6d75 6d28 3029 0d0a 2020 2020  Minimum(0)..    
+00063040: 2020 2020 7365 6c66 2e74 635f 6d61 7873      self.tc_maxs
+00063050: 6869 6674 2e76 616c 7565 4368 616e 6765  hift.valueChange
+00063060: 645b 696e 745d 2e63 6f6e 6e65 6374 2873  d[int].connect(s
+00063070: 656c 662e 4f6e 5365 744d 6178 5368 6966  elf.OnSetMaxShif
+00063080: 7429 0d0a 0d0a 0d0a 2020 2020 2020 2020  t)......        
+00063090: 6862 6f78 3432 2e61 6464 5769 6467 6574  hbox42.addWidget
+000630a0: 2874 6578 7431 290d 0a20 2020 2020 2020  (text1)..       
+000630b0: 2068 626f 7834 322e 6164 6457 6964 6765   hbox42.addWidge
+000630c0: 7428 7365 6c66 2e74 635f 6d61 7873 6869  t(self.tc_maxshi
+000630d0: 6674 290d 0a20 2020 2020 2020 2076 626f  ft)..        vbo
+000630e0: 7834 2e61 6464 4c61 796f 7574 2868 626f  x4.addLayout(hbo
+000630f0: 7834 3229 0d0a 2020 2020 2020 2020 7662  x42)..        vb
+00063100: 6f78 342e 6164 6453 7472 6574 6368 2831  ox4.addStretch(1
+00063110: 290d 0a0d 0a0d 0a20 2020 2020 2020 2073  )......        s
+00063120: 656c 662e 7368 6f77 6373 636f 725f 6362  elf.showcscor_cb
+00063130: 203d 2051 7457 6964 6765 7473 2e51 4368   = QtWidgets.QCh
+00063140: 6563 6b42 6f78 2827 5368 6f77 2043 726f  eckBox('Show Cro
+00063150: 7373 2d63 6f72 7265 6c61 7469 6f6e 272c  ss-correlation',
+00063160: 2073 656c 6629 0d0a 2020 2020 2020 2020   self)..        
+00063170: 7365 6c66 2e73 686f 7763 7363 6f72 5f63  self.showcscor_c
+00063180: 622e 7374 6174 6543 6861 6e67 6564 2e63  b.stateChanged.c
+00063190: 6f6e 6e65 6374 2873 656c 662e 4f6e 5368  onnect(self.OnSh
+000631a0: 6f77 4343 6f72 7229 0d0a 2020 2020 2020  owCCorr)..      
+000631b0: 2020 7662 6f78 342e 6164 6457 6964 6765    vbox4.addWidge
+000631c0: 7428 7365 6c66 2e73 686f 7763 7363 6f72  t(self.showcscor
+000631d0: 5f63 6229 0d0a 0d0a 2020 2020 2020 2020  _cb)....        
+000631e0: 7662 6f78 342e 6164 6453 7472 6574 6368  vbox4.addStretch
+000631f0: 2829 0d0a 2020 2020 2020 2020 7369 7a65  ()..        size
+00063200: 7234 2e73 6574 4c61 796f 7574 2876 626f  r4.setLayout(vbo
+00063210: 7834 290d 0a0d 0a0d 0a20 2020 2020 2020  x4)......       
+00063220: 2023 7061 6e65 6c20 350d 0a20 2020 2020   #panel 5..     
+00063230: 2020 2076 626f 7835 203d 2051 7457 6964     vbox5 = QtWid
+00063240: 6765 7473 2e51 5642 6f78 4c61 796f 7574  gets.QVBoxLayout
+00063250: 2829 0d0a 0d0a 2020 2020 2020 2020 7365  ()....        se
+00063260: 6c66 2e74 635f 7265 6669 6d67 203d 2051  lf.tc_refimg = Q
+00063270: 7457 6964 6765 7473 2e51 4c61 6265 6c28  tWidgets.QLabel(
+00063280: 7365 6c66 290d 0a20 2020 2020 2020 2073  self)..        s
+00063290: 656c 662e 7463 5f72 6566 696d 672e 7365  elf.tc_refimg.se
+000632a0: 7454 6578 7428 2752 6566 6572 656e 6365  tText('Reference
+000632b0: 2069 6d61 6765 2729 0d0a 0d0a 2020 2020   image')....    
+000632c0: 2020 2020 6672 616d 6520 3d20 5174 5769      frame = QtWi
+000632d0: 6467 6574 732e 5146 7261 6d65 2829 0d0a  dgets.QFrame()..
+000632e0: 2020 2020 2020 2020 6672 616d 652e 7365          frame.se
+000632f0: 7446 7261 6d65 5374 796c 6528 5174 5769  tFrameStyle(QtWi
+00063300: 6467 6574 732e 5146 7261 6d65 2e53 7479  dgets.QFrame.Sty
+00063310: 6c65 6450 616e 656c 7c51 7457 6964 6765  ledPanel|QtWidge
+00063320: 7473 2e51 4672 616d 652e 5375 6e6b 656e  ts.QFrame.Sunken
+00063330: 290d 0a20 2020 2020 2020 2066 626f 7820  )..        fbox 
+00063340: 3d20 5174 5769 6467 6574 732e 5148 426f  = QtWidgets.QHBo
+00063350: 784c 6179 6f75 7428 290d 0a0d 0a20 2020  xLayout()....   
+00063360: 2020 2020 2073 656c 662e 7265 6669 6d67       self.refimg
+00063370: 6669 6720 3d20 4669 6775 7265 2828 342e  fig = Figure((4.
+00063380: 302c 2034 2e30 2929 0d0a 2020 2020 2020  0, 4.0))..      
+00063390: 2020 7365 6c66 2e52 6566 496d 6167 6550    self.RefImageP
+000633a0: 616e 656c 203d 2046 6967 7572 6543 616e  anel = FigureCan
+000633b0: 7661 7328 7365 6c66 2e72 6566 696d 6766  vas(self.refimgf
+000633c0: 6967 290d 0a20 2020 2020 2020 2073 656c  ig)..        sel
+000633d0: 662e 5265 6649 6d61 6765 5061 6e65 6c2e  f.RefImagePanel.
+000633e0: 7365 7450 6172 656e 7428 7365 6c66 290d  setParent(self).
+000633f0: 0a20 2020 2020 2020 2073 656c 662e 5265  .        self.Re
+00063400: 6649 6d61 6765 5061 6e65 6c2e 7365 7443  fImagePanel.setC
+00063410: 7572 736f 7228 5174 2e43 726f 7373 4375  ursor(Qt.CrossCu
+00063420: 7273 6f72 290d 0a0d 0a20 2020 2020 2020  rsor)....       
+00063430: 2066 626f 782e 6164 6457 6964 6765 7428   fbox.addWidget(
+00063440: 7365 6c66 2e52 6566 496d 6167 6550 616e  self.RefImagePan
+00063450: 656c 290d 0a20 2020 2020 2020 2066 7261  el)..        fra
+00063460: 6d65 2e73 6574 4c61 796f 7574 2866 626f  me.setLayout(fbo
+00063470: 7829 0d0a 0d0a 2020 2020 2020 2020 7365  x)....        se
+00063480: 6c66 2e52 6566 496d 6167 6550 616e 656c  lf.RefImagePanel
+00063490: 2e6d 706c 5f63 6f6e 6e65 6374 2827 6275  .mpl_connect('bu
+000634a0: 7474 6f6e 5f70 7265 7373 5f65 7665 6e74  tton_press_event
+000634b0: 272c 2073 656c 662e 4f6e 506f 696e 7452  ', self.OnPointR
+000634c0: 6566 696d 6167 6529 0d0a 2020 2020 2020  efimage)..      
+000634d0: 2020 7365 6c66 2e52 6566 496d 6167 6550    self.RefImageP
+000634e0: 616e 656c 2e6d 706c 5f63 6f6e 6e65 6374  anel.mpl_connect
+000634f0: 2827 6275 7474 6f6e 5f72 656c 6561 7365  ('button_release
+00063500: 5f65 7665 6e74 272c 2073 656c 662e 4f6e  _event', self.On
+00063510: 5365 6c65 6374 696f 6e29 0d0a 0d0a 2020  Selection)....  
+00063520: 2020 2020 2020 7662 6f78 352e 6164 6457        vbox5.addW
+00063530: 6964 6765 7428 7365 6c66 2e74 635f 7265  idget(self.tc_re
+00063540: 6669 6d67 290d 0a20 2020 2020 2020 2076  fimg)..        v
+00063550: 626f 7835 2e61 6464 5769 6467 6574 2866  box5.addWidget(f
+00063560: 7261 6d65 290d 0a20 2020 2020 2020 2076  rame)..        v
+00063570: 626f 7835 2e61 6464 5374 7265 7463 6828  box5.addStretch(
+00063580: 3129 0d0a 0d0a 0d0a 2020 2020 2020 2020  1)......        
+00063590: 2370 616e 656c 2036 0d0a 2020 2020 2020  #panel 6..      
+000635a0: 2020 7369 7a65 7236 203d 2051 7457 6964    sizer6 = QtWid
+000635b0: 6765 7473 2e51 4772 6f75 7042 6f78 2827  gets.QGroupBox('
+000635c0: 4d61 6e75 616c 2041 6c69 676e 6d65 6e74  Manual Alignment
+000635d0: 2729 0d0a 2020 2020 2020 2020 7662 6f78  ')..        vbox
+000635e0: 3620 3d20 5174 5769 6467 6574 732e 5156  6 = QtWidgets.QV
+000635f0: 426f 784c 6179 6f75 7428 290d 0a20 2020  BoxLayout()..   
+00063600: 2020 2020 2076 626f 7836 2e73 6574 5370       vbox6.setSp
+00063610: 6163 696e 6728 3029 0d0a 0d0a 0d0a 2020  acing(0)......  
+00063620: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+00063630: 6e5f 6d61 6e61 6c69 676e 203d 2051 7457  n_manalign = QtW
+00063640: 6964 6765 7473 2e51 5075 7368 4275 7474  idgets.QPushButt
+00063650: 6f6e 2827 5069 636b 2061 2070 6f69 6e74  on('Pick a point
+00063660: 206f 6e20 7265 6665 7265 6e63 6520 696d   on reference im
+00063670: 6167 6527 290d 0a20 2020 2020 2020 2073  age')..        s
+00063680: 656c 662e 6275 7474 6f6e 5f6d 616e 616c  elf.button_manal
+00063690: 6967 6e2e 636c 6963 6b65 642e 636f 6e6e  ign.clicked.conn
+000636a0: 6563 7428 7365 6c66 2e4f 6e50 6963 6b52  ect(self.OnPickR
+000636b0: 6566 506f 696e 7429 0d0a 2020 2020 2020  efPoint)..      
+000636c0: 2020 7365 6c66 2e62 7574 746f 6e5f 6d61    self.button_ma
+000636d0: 6e61 6c69 676e 2e73 6574 456e 6162 6c65  nalign.setEnable
+000636e0: 6428 4661 6c73 6529 0d0a 2020 2020 2020  d(False)..      
+000636f0: 2020 7662 6f78 362e 6164 6457 6964 6765    vbox6.addWidge
+00063700: 7428 7365 6c66 2e62 7574 746f 6e5f 6d61  t(self.button_ma
+00063710: 6e61 6c69 676e 290d 0a0d 0a20 2020 2020  nalign)....     
+00063720: 2020 2073 656c 662e 6275 7474 6f6e 5f70     self.button_p
+00063730: 6963 6b32 6e64 706f 696e 7420 3d20 5174  ick2ndpoint = Qt
+00063740: 5769 6467 6574 732e 5150 7573 6842 7574  Widgets.QPushBut
+00063750: 746f 6e28 2754 6869 7320 696d 6167 653a  ton('This image:
+00063760: 2063 6c69 636b 206f 6e20 7361 6d65 2070   click on same p
+00063770: 6f69 6e74 2729 0d0a 2020 2020 2020 2020  oint')..        
+00063780: 7365 6c66 2e62 7574 746f 6e5f 7069 636b  self.button_pick
+00063790: 326e 6470 6f69 6e74 2e63 6c69 636b 6564  2ndpoint.clicked
+000637a0: 2e63 6f6e 6e65 6374 2873 656c 662e 4f6e  .connect(self.On
+000637b0: 5069 636b 436f 7272 506f 696e 7429 0d0a  PickCorrPoint)..
+000637c0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
+000637d0: 746f 6e5f 7069 636b 326e 6470 6f69 6e74  ton_pick2ndpoint
+000637e0: 2e73 6574 456e 6162 6c65 6428 4661 6c73  .setEnabled(Fals
+000637f0: 6529 0d0a 2020 2020 2020 2020 7662 6f78  e)..        vbox
+00063800: 362e 6164 6457 6964 6765 7428 7365 6c66  6.addWidget(self
+00063810: 2e62 7574 746f 6e5f 7069 636b 326e 6470  .button_pick2ndp
+00063820: 6f69 6e74 290d 0a0d 0a20 2020 2020 2020  oint)....       
+00063830: 2073 656c 662e 6275 7474 6f6e 5f61 7070   self.button_app
+00063840: 6c79 6d61 6e20 3d20 5174 5769 6467 6574  lyman = QtWidget
+00063850: 732e 5150 7573 6842 7574 746f 6e28 2741  s.QPushButton('A
+00063860: 7070 6c79 206d 616e 7561 6c20 7368 6966  pply manual shif
+00063870: 7473 2729 0d0a 2020 2020 2020 2020 7365  ts')..        se
+00063880: 6c66 2e62 7574 746f 6e5f 6170 706c 796d  lf.button_applym
+00063890: 616e 2e63 6c69 636b 6564 2e63 6f6e 6e65  an.clicked.conne
+000638a0: 6374 2873 656c 662e 4f6e 4170 706c 794d  ct(self.OnApplyM
+000638b0: 616e 5368 6966 7473 290d 0a20 2020 2020  anShifts)..     
+000638c0: 2020 2073 656c 662e 6275 7474 6f6e 5f61     self.button_a
+000638d0: 7070 6c79 6d61 6e2e 7365 7445 6e61 626c  pplyman.setEnabl
+000638e0: 6564 2846 616c 7365 290d 0a20 2020 2020  ed(False)..     
+000638f0: 2020 2076 626f 7836 2e61 6464 5769 6467     vbox6.addWidg
+00063900: 6574 2873 656c 662e 6275 7474 6f6e 5f61  et(self.button_a
+00063910: 7070 6c79 6d61 6e29 0d0a 0d0a 0d0a 2020  pplyman)......  
+00063920: 2020 2020 2020 7365 6c66 2e74 6578 7463        self.textc
+00063930: 7472 6c5f 6d73 3120 3d20 5174 5769 6467  trl_ms1 = QtWidg
+00063940: 6574 732e 514c 6162 656c 2873 656c 6629  ets.QLabel(self)
+00063950: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
+00063960: 6578 7463 7472 6c5f 6d73 3220 3d20 5174  extctrl_ms2 = Qt
+00063970: 5769 6467 6574 732e 514c 6162 656c 2873  Widgets.QLabel(s
+00063980: 656c 6629 0d0a 2020 2020 2020 2020 7662  elf)..        vb
+00063990: 6f78 362e 6164 6457 6964 6765 7428 7365  ox6.addWidget(se
+000639a0: 6c66 2e74 6578 7463 7472 6c5f 6d73 3129  lf.textctrl_ms1)
+000639b0: 0d0a 2020 2020 2020 2020 7662 6f78 362e  ..        vbox6.
+000639c0: 6164 6457 6964 6765 7428 7365 6c66 2e74  addWidget(self.t
+000639d0: 6578 7463 7472 6c5f 6d73 3229 0d0a 0d0a  extctrl_ms2)....
+000639e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
+000639f0: 6578 7463 7472 6c5f 6d73 312e 7365 7454  extctrl_ms1.setT
+00063a00: 6578 7428 2758 206d 616e 7561 6c20 7368  ext('X manual sh
+00063a10: 6966 743a 2027 290d 0a20 2020 2020 2020  ift: ')..       
+00063a20: 2073 656c 662e 7465 7874 6374 726c 5f6d   self.textctrl_m
+00063a30: 7332 2e73 6574 5465 7874 2827 5920 6d61  s2.setText('Y ma
+00063a40: 6e75 616c 2073 6869 6674 3a20 2729 0d0a  nual shift: ')..
+00063a50: 0d0a 0d0a 2020 2020 2020 2020 7369 7a65  ....        size
+00063a60: 7236 2e73 6574 4c61 796f 7574 2876 626f  r6.setLayout(vbo
+00063a70: 7836 290d 0a0d 0a0d 0a0d 0a20 2020 2020  x6)........     
+00063a80: 2020 2023 7061 6e65 6c20 370d 0a20 2020     #panel 7..   
+00063a90: 2020 2020 2076 626f 7837 203d 2051 7457       vbox7 = QtW
+00063aa0: 6964 6765 7473 2e51 5642 6f78 4c61 796f  idgets.QVBoxLayo
+00063ab0: 7574 2829 0d0a 2020 2020 2020 2020 7662  ut()..        vb
+00063ac0: 6f78 372e 7365 7453 7061 6369 6e67 2830  ox7.setSpacing(0
+00063ad0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+00063ae0: 662e 6275 7474 6f6e 5f73 6176 6569 6d67  f.button_saveimg
+00063af0: 203d 2051 7457 6964 6765 7473 2e51 5075   = QtWidgets.QPu
+00063b00: 7368 4275 7474 6f6e 2827 5361 7665 2069  shButton('Save i
+00063b10: 6d61 6765 2073 6869 6674 7320 706c 6f74  mage shifts plot
+00063b20: 2729 0d0a 2020 2020 2020 2020 7365 6c66  ')..        self
+00063b30: 2e62 7574 746f 6e5f 7361 7665 696d 672e  .button_saveimg.
+00063b40: 636c 6963 6b65 642e 636f 6e6e 6563 7428  clicked.connect(
+00063b50: 7365 6c66 2e4f 6e53 6176 6553 6869 6674  self.OnSaveShift
+00063b60: 7350 6c6f 7429 0d0a 2020 2020 2020 2020  sPlot)..        
+00063b70: 7365 6c66 2e62 7574 746f 6e5f 7361 7665  self.button_save
+00063b80: 696d 672e 7365 7445 6e61 626c 6564 2846  img.setEnabled(F
+00063b90: 616c 7365 290d 0a20 2020 2020 2020 2076  alse)..        v
+00063ba0: 626f 7837 2e61 6464 5769 6467 6574 2873  box7.addWidget(s
+00063bb0: 656c 662e 6275 7474 6f6e 5f73 6176 6569  elf.button_savei
+00063bc0: 6d67 290d 0a0d 0a0d 0a0d 0a20 2020 2020  mg)........     
+00063bd0: 2020 2073 656c 662e 6275 7474 6f6e 5f73     self.button_s
+00063be0: 6176 6573 6869 6674 7320 3d20 5174 5769  aveshifts = QtWi
+00063bf0: 6467 6574 732e 5150 7573 6842 7574 746f  dgets.QPushButto
+00063c00: 6e28 2753 6176 6520 696d 6167 6520 7368  n('Save image sh
+00063c10: 6966 7473 2729 0d0a 2020 2020 2020 2020  ifts')..        
+00063c20: 7365 6c66 2e62 7574 746f 6e5f 7361 7665  self.button_save
+00063c30: 7368 6966 7473 2e63 6c69 636b 6564 2e63  shifts.clicked.c
+00063c40: 6f6e 6e65 6374 2873 656c 662e 4f6e 5361  onnect(self.OnSa
+00063c50: 7665 5368 6966 7473 290d 0a20 2020 2020  veShifts)..     
+00063c60: 2020 2073 656c 662e 6275 7474 6f6e 5f73     self.button_s
+00063c70: 6176 6573 6869 6674 732e 7365 7445 6e61  aveshifts.setEna
+00063c80: 626c 6564 2846 616c 7365 290d 0a20 2020  bled(False)..   
+00063c90: 2020 2020 2076 626f 7837 2e61 6464 5769       vbox7.addWi
+00063ca0: 6467 6574 2873 656c 662e 6275 7474 6f6e  dget(self.button
+00063cb0: 5f73 6176 6573 6869 6674 7329 0d0a 0d0a  _saveshifts)....
+00063cc0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
+00063cd0: 746f 6e5f 6c6f 6164 7368 6966 7473 203d  ton_loadshifts =
+00063ce0: 2051 7457 6964 6765 7473 2e51 5075 7368   QtWidgets.QPush
+00063cf0: 4275 7474 6f6e 2827 4c6f 6164 2069 6d61  Button('Load ima
+00063d00: 6765 2073 6869 6674 7327 290d 0a20 2020  ge shifts')..   
+00063d10: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
+00063d20: 5f6c 6f61 6473 6869 6674 732e 636c 6963  _loadshifts.clic
+00063d30: 6b65 642e 636f 6e6e 6563 7428 7365 6c66  ked.connect(self
+00063d40: 2e4f 6e4c 6f61 6453 6869 6674 7329 0d0a  .OnLoadShifts)..
+00063d50: 2020 2020 2020 2020 7662 6f78 372e 6164          vbox7.ad
+00063d60: 6457 6964 6765 7428 7365 6c66 2e62 7574  dWidget(self.but
+00063d70: 746f 6e5f 6c6f 6164 7368 6966 7473 290d  ton_loadshifts).
+00063d80: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00063d90: 6275 7474 6f6e 5f63 726f 7020 3d20 5174  button_crop = Qt
+00063da0: 5769 6467 6574 732e 5150 7573 6842 7574  Widgets.QPushBut
+00063db0: 746f 6e28 2743 726f 7020 616c 6967 6e65  ton('Crop aligne
+00063dc0: 6420 696d 6167 6573 2729 0d0a 2020 2020  d images')..    
+00063dd0: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+00063de0: 6372 6f70 2e63 6c69 636b 6564 2e63 6f6e  crop.clicked.con
+00063df0: 6e65 6374 2873 656c 662e 4f6e 4372 6f70  nect(self.OnCrop
+00063e00: 5368 6966 7473 290d 0a20 2020 2020 2020  Shifts)..       
+00063e10: 2073 656c 662e 6275 7474 6f6e 5f63 726f   self.button_cro
+00063e20: 702e 7365 7445 6e61 626c 6564 2846 616c  p.setEnabled(Fal
+00063e30: 7365 290d 0a20 2020 2020 2020 2076 626f  se)..        vbo
+00063e40: 7837 2e61 6464 5769 6467 6574 2873 656c  x7.addWidget(sel
+00063e50: 662e 6275 7474 6f6e 5f63 726f 7029 0d0a  f.button_crop)..
+00063e60: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
+00063e70: 7574 746f 6e5f 6163 6365 7074 203d 2051  utton_accept = Q
+00063e80: 7457 6964 6765 7473 2e51 5075 7368 4275  tWidgets.QPushBu
+00063e90: 7474 6f6e 2827 4170 706c 7920 416c 6967  tton('Apply Alig
+00063ea0: 6e6d 656e 7427 290d 0a20 2020 2020 2020  nment')..       
+00063eb0: 2073 656c 662e 6275 7474 6f6e 5f61 6363   self.button_acc
+00063ec0: 6570 742e 636c 6963 6b65 642e 636f 6e6e  ept.clicked.conn
+00063ed0: 6563 7428 7365 6c66 2e4f 6e41 6363 6570  ect(self.OnAccep
+00063ee0: 7429 0d0a 2020 2020 2020 2020 7365 6c66  t)..        self
+00063ef0: 2e62 7574 746f 6e5f 6163 6365 7074 2e73  .button_accept.s
+00063f00: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
+00063f10: 0d0a 2020 2020 2020 2020 7662 6f78 372e  ..        vbox7.
+00063f20: 6164 6457 6964 6765 7428 7365 6c66 2e62  addWidget(self.b
+00063f30: 7574 746f 6e5f 6163 6365 7074 290d 0a0d  utton_accept)...
+00063f40: 0a20 2020 2020 2020 2073 656c 662e 6275  .        self.bu
+00063f50: 7474 6f6e 5f63 6c6f 7365 203d 2051 7457  tton_close = QtW
+00063f60: 6964 6765 7473 2e51 5075 7368 4275 7474  idgets.QPushButt
+00063f70: 6f6e 2827 4469 736d 6973 7327 290d 0a20  on('Dismiss').. 
+00063f80: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
+00063f90: 6f6e 5f63 6c6f 7365 2e63 6c69 636b 6564  on_close.clicked
+00063fa0: 2e63 6f6e 6e65 6374 2873 656c 662e 636c  .connect(self.cl
+00063fb0: 6f73 6529 0d0a 2020 2020 2020 2020 7662  ose)..        vb
+00063fc0: 6f78 372e 6164 6457 6964 6765 7428 7365  ox7.addWidget(se
+00063fd0: 6c66 2e62 7574 746f 6e5f 636c 6f73 6529  lf.button_close)
+00063fe0: 0d0a 0d0a 0d0a 0d0a 0d0a 0d0a 2020 2020  ............    
+00063ff0: 2020 2020 6862 6f78 746f 7020 3d20 5174      hboxtop = Qt
+00064000: 5769 6467 6574 732e 5148 426f 784c 6179  Widgets.QHBoxLay
+00064010: 6f75 7428 290d 0a0d 0a20 2020 2020 2020  out()....       
+00064020: 2076 626f 784c 203d 2051 7457 6964 6765   vboxL = QtWidge
+00064030: 7473 2e51 5642 6f78 4c61 796f 7574 2829  ts.QVBoxLayout()
+00064040: 0d0a 2020 2020 2020 2020 7662 6f78 5220  ..        vboxR 
+00064050: 3d20 5174 5769 6467 6574 732e 5156 426f  = QtWidgets.QVBo
+00064060: 784c 6179 6f75 7428 290d 0a0d 0a0d 0a20  xLayout()...... 
+00064070: 2020 2020 2020 2076 626f 784c 2e61 6464         vboxL.add
+00064080: 5769 6467 6574 2873 697a 6572 3829 0d0a  Widget(sizer8)..
+00064090: 2020 2020 2020 2020 7662 6f78 4c2e 6164          vboxL.ad
+000640a0: 6453 7472 6574 6368 2831 290d 0a20 2020  dStretch(1)..   
+000640b0: 2020 2020 2076 626f 784c 2e61 6464 5769       vboxL.addWi
+000640c0: 6467 6574 2867 726f 7570 426f 7839 290d  dget(groupBox9).
+000640d0: 0a20 2020 2020 2020 2076 626f 784c 2e61  .        vboxL.a
+000640e0: 6464 5374 7265 7463 6828 3129 0d0a 2020  ddStretch(1)..  
+000640f0: 2020 2020 2020 7662 6f78 4c2e 6164 6457        vboxL.addW
+00064100: 6964 6765 7428 7369 7a65 7234 290d 0a20  idget(sizer4).. 
+00064110: 2020 2020 2020 2076 626f 784c 2e61 6464         vboxL.add
+00064120: 5374 7265 7463 6828 3129 0d0a 2020 2020  Stretch(1)..    
+00064130: 2020 2020 7662 6f78 4c2e 6164 6457 6964      vboxL.addWid
+00064140: 6765 7428 7369 7a65 7236 290d 0a20 2020  get(sizer6)..   
+00064150: 2020 2020 2076 626f 784c 2e61 6464 5374       vboxL.addSt
+00064160: 7265 7463 6828 3129 0d0a 2020 2020 2020  retch(1)..      
+00064170: 2020 7662 6f78 4c2e 6164 644c 6179 6f75    vboxL.addLayou
+00064180: 7428 7662 6f78 3729 0d0a 0d0a 2020 2020  t(vbox7)....    
+00064190: 2020 2020 6862 6f78 5254 203d 2051 7457      hboxRT = QtW
+000641a0: 6964 6765 7473 2e51 4842 6f78 4c61 796f  idgets.QHBoxLayo
+000641b0: 7574 2829 0d0a 2020 2020 2020 2020 6862  ut()..        hb
+000641c0: 6f78 5242 203d 2051 7457 6964 6765 7473  oxRB = QtWidgets
+000641d0: 2e51 4842 6f78 4c61 796f 7574 2829 0d0a  .QHBoxLayout()..
+000641e0: 0d0a 2020 2020 2020 2020 6862 6f78 5254  ..        hboxRT
+000641f0: 2e61 6464 4c61 796f 7574 2876 626f 7831  .addLayout(vbox1
+00064200: 290d 0a20 2020 2020 2020 2068 626f 7852  )..        hboxR
+00064210: 542e 6164 644c 6179 6f75 7428 7662 6f78  T.addLayout(vbox
+00064220: 3529 0d0a 0d0a 2020 2020 2020 2020 6862  5)....        hb
+00064230: 6f78 5242 2e61 6464 4c61 796f 7574 2876  oxRB.addLayout(v
+00064240: 626f 7833 290d 0a20 2020 2020 2020 2068  box3)..        h
+00064250: 626f 7852 422e 6164 644c 6179 6f75 7428  boxRB.addLayout(
+00064260: 7662 6f78 3229 0d0a 2020 2020 2020 2020  vbox2)..        
+00064270: 6862 6f78 5242 2e61 6464 5374 7265 7463  hboxRB.addStretc
+00064280: 6828 3129 0d0a 0d0a 2020 2020 2020 2020  h(1)....        
+00064290: 7662 6f78 522e 6164 6453 7472 6574 6368  vboxR.addStretch
+000642a0: 2830 2e32 290d 0a20 2020 2020 2020 2076  (0.2)..        v
+000642b0: 626f 7852 2e61 6464 4c61 796f 7574 2868  boxR.addLayout(h
+000642c0: 626f 7852 5429 0d0a 2020 2020 2020 2020  boxRT)..        
+000642d0: 7662 6f78 522e 6164 6453 7472 6574 6368  vboxR.addStretch
+000642e0: 2831 290d 0a20 2020 2020 2020 2076 626f  (1)..        vbo
+000642f0: 7852 2e61 6464 4c61 796f 7574 2868 626f  xR.addLayout(hbo
+00064300: 7852 4229 0d0a 2020 2020 2020 2020 7662  xRB)..        vb
+00064310: 6f78 522e 6164 6453 7472 6574 6368 2831  oxR.addStretch(1
+00064320: 290d 0a0d 0a20 2020 2020 2020 2068 626f  )....        hbo
+00064330: 7874 6f70 2e61 6464 4c61 796f 7574 2876  xtop.addLayout(v
+00064340: 626f 784c 290d 0a20 2020 2020 2020 2068  boxL)..        h
+00064350: 626f 7874 6f70 2e61 6464 5374 7265 7463  boxtop.addStretc
+00064360: 6828 3129 0d0a 2020 2020 2020 2020 6862  h(1)..        hb
+00064370: 6f78 746f 702e 6164 644c 6179 6f75 7428  oxtop.addLayout(
+00064380: 7662 6f78 5229 0d0a 0d0a 0d0a 2020 2020  vboxR)......    
+00064390: 2020 2020 6862 6f78 746f 702e 7365 7443      hboxtop.setC
+000643a0: 6f6e 7465 6e74 734d 6172 6769 6e73 2832  ontentsMargins(2
+000643b0: 302c 3230 2c32 302c 3230 290d 0a20 2020  0,20,20,20)..   
+000643c0: 2020 2020 2073 656c 662e 7365 744c 6179       self.setLay
+000643d0: 6f75 7428 6862 6f78 746f 7029 0d0a 0d0a  out(hboxtop)....
+000643e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e53  ..        self.S
+000643f0: 686f 7749 6d61 6765 2829 0d0a 0d0a 0d0a  howImage()......
+00064400: 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ..#-------------
+00064410: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00064420: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00064430: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00064440: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
+00064450: 6566 2053 686f 7749 6d61 6765 2873 656c  ef ShowImage(sel
+00064460: 6629 3a0d 0a0d 0a20 2020 2020 2020 2069  f):....        i
+00064470: 6620 7365 6c66 2e63 6f6d 2e73 7461 636b  f self.com.stack
+00064480: 5f34 6420 3d3d 2030 3a0d 0a20 2020 2020  _4d == 0:..     
+00064490: 2020 2020 2020 2069 6d61 6765 203d 2073         image = s
+000644a0: 656c 662e 616c 6967 6e65 645f 7374 6163  elf.aligned_stac
+000644b0: 6b5b 3a2c 3a2c 7365 6c66 2e69 6576 5d0d  k[:,:,self.iev].
+000644c0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+000644d0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+000644e0: 6520 3d20 7365 6c66 2e61 6c69 676e 6564  e = self.aligned
+000644f0: 5f73 7461 636b 5b3a 2c3a 2c73 656c 662e  _stack[:,:,self.
+00064500: 6965 762c 7365 6c66 2e69 7468 6574 615d  iev,self.itheta]
+00064510: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6669  ......        fi
+00064520: 6720 3d20 7365 6c66 2e61 6273 696d 6766  g = self.absimgf
+00064530: 6967 0d0a 2020 2020 2020 2020 6669 672e  ig..        fig.
+00064540: 636c 6628 290d 0a20 2020 2020 2020 2066  clf()..        f
+00064550: 6967 2e61 6464 5f61 7865 7328 2828 302e  ig.add_axes(((0.
+00064560: 302c 302e 302c 312e 302c 312e 3029 2929  0,0.0,1.0,1.0)))
+00064570: 0d0a 2020 2020 2020 2020 6178 6573 203d  ..        axes =
+00064580: 2066 6967 2e67 6361 2829 0d0a 0d0a 0d0a   fig.gca()......
+00064590: 2020 2020 2020 2020 5f69 6d20 3d20 6178          _im = ax
+000645a0: 6573 2e69 6d73 686f 7728 6e70 2e72 6f74  es.imshow(np.rot
+000645b0: 3930 2869 6d61 6765 292c 2063 6d61 703d  90(image), cmap=
+000645c0: 6d61 7470 6c6f 746c 6962 2e63 6d2e 6765  matplotlib.cm.ge
+000645d0: 745f 636d 6170 2827 6772 6179 2729 290d  t_cmap('gray')).
+000645e0: 0a20 2020 2020 2020 2061 7865 732e 6175  .        axes.au
+000645f0: 746f 7363 616c 6528 4661 6c73 6529 0d0a  toscale(False)..
+00064600: 2320 2020 2020 2020 2020 6966 2073 656c  #         if sel
+00064610: 662e 6d61 6e5f 616c 6967 6e20 3d3d 2032  f.man_align == 2
+00064620: 3a0d 0a23 2020 2020 2020 2020 2020 2020  :..#            
+00064630: 206c 783d 6d61 7470 6c6f 746c 6962 2e6c   lx=matplotlib.l
+00064640: 696e 6573 2e4c 696e 6532 4428 5b73 656c  ines.Line2D([sel
+00064650: 662e 6d61 6e5f 7972 6566 2d73 656c 662e  f.man_yref-self.
+00064660: 6d61 6e5f 7973 5b73 656c 662e 6965 765d  man_ys[self.iev]
+00064670: 2c0d 0a23 2020 2020 2020 2020 2020 2020  ,..#            
+00064680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064690: 2020 2020 2020 2020 2073 656c 662e 6d61           self.ma
+000646a0: 6e5f 7972 6566 2d73 656c 662e 6d61 6e5f  n_yref-self.man_
+000646b0: 7973 5b73 656c 662e 6965 765d 5d2c 0d0a  ys[self.iev]],..
+000646c0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+000646d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000646e0: 2020 2020 2020 5b30 2c73 656c 662e 7374        [0,self.st
+000646f0: 6163 6b2e 6e5f 636f 6c73 5d2c 636f 6c6f  ack.n_cols],colo
+00064700: 723d 2772 6564 2729 0d0a 2320 2020 2020  r='red')..#     
+00064710: 2020 2020 2020 2020 6c79 3d6d 6174 706c          ly=matpl
+00064720: 6f74 6c69 622e 6c69 6e65 732e 4c69 6e65  otlib.lines.Line
+00064730: 3244 285b 302c 7365 6c66 2e73 7461 636b  2D([0,self.stack
+00064740: 2e6e 5f72 6f77 735d 2c0d 0a23 2020 2020  .n_rows],..#    
 00064750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064760: 2020 2020 2073 656c 662e 6d61 6e5f 7872       self.man_xr
-00064770: 6566 2d73 656c 662e 6d61 6e5f 7873 5b73  ef-self.man_xs[s
-00064780: 656c 662e 6965 765d 5d20 2c63 6f6c 6f72  elf.iev]] ,color
-00064790: 3d27 7265 6427 290d 0a23 2020 2020 2020  ='red')..#      
-000647a0: 2020 2020 2020 2061 7865 732e 6164 645f         axes.add_
-000647b0: 6c69 6e65 286c 7829 0d0a 2320 2020 2020  line(lx)..#     
-000647c0: 2020 2020 2020 2020 6178 6573 2e61 6464          axes.add
-000647d0: 5f6c 696e 6528 6c79 290d 0a0d 0a0d 0a0d  _line(ly).......
-000647e0: 0a20 2020 2020 2020 2061 7865 732e 6178  .        axes.ax
-000647f0: 6973 2822 6f66 6622 290d 0a20 2020 2020  is("off")..     
-00064800: 2020 2073 656c 662e 4162 7349 6d61 6765     self.AbsImage
-00064810: 5061 6e65 6c2e 6472 6177 2829 0d0a 0d0a  Panel.draw()....
-00064820: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
-00064830: 635f 696d 6167 6565 6e67 2e73 6574 5465  c_imageeng.setTe
-00064840: 7874 2827 496d 6167 6520 6174 2065 6e65  xt('Image at ene
-00064850: 7267 793a 207b 303a 352e 3266 7d20 6556  rgy: {0:5.2f} eV
-00064860: 272e 666f 726d 6174 2866 6c6f 6174 2873  '.format(float(s
-00064870: 656c 662e 7374 6163 6b2e 6576 5b73 656c  elf.stack.ev[sel
-00064880: 662e 6965 765d 2929 290d 0a0d 0a20 2020  f.iev])))....   
-00064890: 2020 2020 2069 6620 7365 6c66 2e63 6f6d       if self.com
-000648a0: 2e73 7461 636b 5f34 6420 3d3d 2030 3a0d  .stack_4d == 0:.
-000648b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000648c0: 662e 7463 5f73 6869 6674 312e 7365 7454  f.tc_shift1.setT
-000648d0: 6578 7428 2758 2073 6869 6674 3a20 7b30  ext('X shift: {0
-000648e0: 3a35 2e32 667d 2070 6978 656c 7327 2e66  :5.2f} pixels'.f
-000648f0: 6f72 6d61 7428 7365 6c66 2e78 7368 6966  ormat(self.xshif
-00064900: 7473 5b73 656c 662e 6965 765d 2929 0d0a  ts[self.iev]))..
-00064910: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00064920: 2e74 635f 7368 6966 7432 2e73 6574 5465  .tc_shift2.setTe
-00064930: 7874 2827 5920 7368 6966 743a 207b 303a  xt('Y shift: {0:
-00064940: 352e 3266 7d20 7069 7865 6c73 272e 666f  5.2f} pixels'.fo
-00064950: 726d 6174 2873 656c 662e 7973 6869 6674  rmat(self.yshift
-00064960: 735b 7365 6c66 2e69 6576 5d29 290d 0a20  s[self.iev])).. 
-00064970: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00064980: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-00064990: 635f 7368 6966 7431 2e73 6574 5465 7874  c_shift1.setText
-000649a0: 2827 5820 7368 6966 743a 207b 303a 352e  ('X shift: {0:5.
-000649b0: 3266 7d20 7069 7865 6c73 272e 666f 726d  2f} pixels'.form
-000649c0: 6174 2873 656c 662e 7873 6869 6674 735b  at(self.xshifts[
-000649d0: 7365 6c66 2e69 6576 2c73 656c 662e 6974  self.iev,self.it
-000649e0: 6865 7461 5d29 290d 0a20 2020 2020 2020  heta]))..       
-000649f0: 2020 2020 2073 656c 662e 7463 5f73 6869       self.tc_shi
-00064a00: 6674 322e 7365 7454 6578 7428 2759 2073  ft2.setText('Y s
-00064a10: 6869 6674 3a20 7b30 3a35 2e32 667d 2070  hift: {0:5.2f} p
-00064a20: 6978 656c 7327 2e66 6f72 6d61 7428 7365  ixels'.format(se
-00064a30: 6c66 2e79 7368 6966 7473 5b73 656c 662e  lf.yshifts[self.
-00064a40: 6965 762c 7365 6c66 2e69 7468 6574 615d  iev,self.itheta]
-00064a50: 2929 0d0a 0d0a 0d0a 2020 2020 2020 2020  ))......        
-00064a60: 6966 2028 7365 6c66 2e6d 616e 5f61 6c69  if (self.man_ali
-00064a70: 676e 203d 3d20 3229 3a0d 0a20 2020 2020  gn == 2):..     
-00064a80: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
-00064a90: 6f6d 2e73 7461 636b 5f34 6420 3d3d 2030  om.stack_4d == 0
-00064aa0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00064ab0: 2020 2073 656c 662e 7465 7874 6374 726c     self.textctrl
-00064ac0: 5f6d 7331 2e73 6574 5465 7874 2827 5820  _ms1.setText('X 
-00064ad0: 6d61 6e75 616c 2073 6869 6674 3a20 207b  manual shift:  {
-00064ae0: 303a 352e 3266 7d20 2070 6978 656c 7327  0:5.2f}  pixels'
-00064af0: 2e66 6f72 6d61 7428 7365 6c66 2e6d 616e  .format(self.man
-00064b00: 5f78 735b 7365 6c66 2e69 6576 5d29 290d  _xs[self.iev])).
-00064b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00064b20: 2073 656c 662e 7465 7874 6374 726c 5f6d   self.textctrl_m
-00064b30: 7332 2e73 6574 5465 7874 2827 5920 6d61  s2.setText('Y ma
-00064b40: 6e75 616c 2073 6869 6674 3a20 207b 303a  nual shift:  {0:
-00064b50: 352e 3266 7d20 2070 6978 656c 7327 2e66  5.2f}  pixels'.f
-00064b60: 6f72 6d61 7428 7365 6c66 2e6d 616e 5f79  ormat(self.man_y
-00064b70: 735b 7365 6c66 2e69 6576 5d29 290d 0a20  s[self.iev])).. 
-00064b80: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00064b90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00064ba0: 2020 7365 6c66 2e74 6578 7463 7472 6c5f    self.textctrl_
-00064bb0: 6d73 312e 7365 7454 6578 7428 2758 206d  ms1.setText('X m
-00064bc0: 616e 7561 6c20 7368 6966 743a 2020 7b30  anual shift:  {0
-00064bd0: 3a35 2e32 667d 2020 7069 7865 6c73 272e  :5.2f}  pixels'.
-00064be0: 666f 726d 6174 2873 656c 662e 6d61 6e5f  format(self.man_
-00064bf0: 7873 5b73 656c 662e 6965 762c 7365 6c66  xs[self.iev,self
-00064c00: 2e69 7468 6574 615d 2929 0d0a 2020 2020  .itheta]))..    
-00064c10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00064c20: 2e74 6578 7463 7472 6c5f 6d73 322e 7365  .textctrl_ms2.se
-00064c30: 7454 6578 7428 2759 206d 616e 7561 6c20  tText('Y manual 
-00064c40: 7368 6966 743a 2020 7b30 3a35 2e32 667d  shift:  {0:5.2f}
-00064c50: 2020 7069 7865 6c73 272e 666f 726d 6174    pixels'.format
-00064c60: 2873 656c 662e 6d61 6e5f 7973 5b73 656c  (self.man_ys[sel
-00064c70: 662e 6965 762c 7365 6c66 2e69 7468 6574  f.iev,self.ithet
-00064c80: 615d 2929 0d0a 0d0a 0d0a 0d0a 232d 2d2d  a]))........#---
-00064c90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00064ca0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00064cb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00064cc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00064cd0: 2d2d 2d0d 0a20 2020 2064 6566 204f 6e53  ---..    def OnS
-00064ce0: 6372 6f6c 6c45 6e67 2873 656c 662c 2076  crollEng(self, v
-00064cf0: 616c 7565 293a 0d0a 2020 2020 2020 2020  alue):..        
-00064d00: 7365 6c66 2e69 6576 203d 2076 616c 7565  self.iev = value
-00064d10: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00064d20: 2e53 686f 7749 6d61 6765 2829 0d0a 0d0a  .ShowImage()....
-00064d30: 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  #---------------
-00064d40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00064d50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00064d60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00064d70: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6566  -------..    def
-00064d80: 204f 6e53 6372 6f6c 6c54 6865 7461 2873   OnScrollTheta(s
-00064d90: 656c 662c 2076 616c 7565 293a 0d0a 2020  elf, value):..  
-00064da0: 2020 2020 2020 7365 6c66 2e69 7468 6574        self.ithet
-00064db0: 6120 3d20 7661 6c75 650d 0a0d 0a20 2020  a = value....   
-00064dc0: 2020 2020 2073 656c 662e 7463 5f69 6d61       self.tc_ima
-00064dd0: 6765 7468 6574 612e 7365 7454 6578 7428  getheta.setText(
-00064de0: 2234 4420 4461 7461 2041 6e67 6c65 3a20  "4D Data Angle: 
-00064df0: 222b 7374 7228 7365 6c66 2e73 7461 636b  "+str(self.stack
-00064e00: 2e74 6865 7461 5b73 656c 662e 6974 6865  .theta[self.ithe
-00064e10: 7461 5d29 290d 0a0d 0a20 2020 2020 2020  ta]))....       
-00064e20: 2073 656c 662e 5368 6f77 496d 6167 6528   self.ShowImage(
-00064e30: 290d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d  )....#----------
-00064e40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00064e50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00064e60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00064e70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020  ------------..  
-00064e80: 2020 6465 6620 5365 7452 6566 496d 6167    def SetRefImag
-00064e90: 6528 7365 6c66 293a 0d0a 0d0a 2020 2020  e(self):....    
-00064ea0: 2020 2020 7365 6c66 2e72 6566 5f69 6d61      self.ref_ima
-00064eb0: 6765 5f69 6e64 6578 203d 2073 656c 662e  ge_index = self.
-00064ec0: 6965 760d 0a20 2020 2020 2020 2073 656c  iev..        sel
-00064ed0: 662e 7265 665f 696d 6167 655f 696e 6465  f.ref_image_inde
-00064ee0: 785f 7468 6574 6120 3d20 7365 6c66 2e69  x_theta = self.i
-00064ef0: 7468 6574 610d 0a0d 0a20 2020 2020 2020  theta....       
-00064f00: 2069 6620 7365 6c66 2e63 6f6d 2e73 7461   if self.com.sta
-00064f10: 636b 5f34 6420 3d3d 2030 3a0d 0a20 2020  ck_4d == 0:..   
-00064f20: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
-00064f30: 665f 696d 6167 6520 3d20 7365 6c66 2e61  f_image = self.a
-00064f40: 6c69 676e 6564 5f73 7461 636b 5b3a 2c3a  ligned_stack[:,:
-00064f50: 2c73 656c 662e 6965 765d 2e63 6f70 7928  ,self.iev].copy(
-00064f60: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-00064f70: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00064f80: 6c66 2e72 6566 5f69 6d61 6765 203d 2073  lf.ref_image = s
-00064f90: 656c 662e 616c 6967 6e65 645f 7374 6163  elf.aligned_stac
-00064fa0: 6b5b 3a2c 3a2c 7365 6c66 2e69 6576 2c73  k[:,:,self.iev,s
-00064fb0: 656c 662e 6974 6865 7461 5d2e 636f 7079  elf.itheta].copy
-00064fc0: 2829 0d0a 0d0a 0d0a 2020 2020 2020 2020  ()......        
-00064fd0: 7365 6c66 2e53 686f 7752 6566 496d 6167  self.ShowRefImag
-00064fe0: 6528 290d 0a20 2020 2020 2020 2073 656c  e()..        sel
-00064ff0: 662e 6861 7665 5f72 6566 5f69 6d61 6765  f.have_ref_image
-00065000: 203d 2031 0d0a 0d0a 2020 2020 2020 2020   = 1....        
-00065010: 7365 6c66 2e55 7064 6174 6557 6964 6765  self.UpdateWidge
-00065020: 7473 2829 0d0a 0d0a 0d0a 232d 2d2d 2d2d  ts()......#-----
-00065030: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00065040: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00065050: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00065060: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00065070: 2d0d 0a20 2020 2064 6566 2053 6176 6552  -..    def SaveR
-00065080: 6566 496d 6167 6528 7365 6c66 293a 0d0a  efImage(self):..
-00065090: 0d0a 2020 2020 2020 2020 7769 6c64 6361  ..        wildca
-000650a0: 7264 203d 2022 5449 4646 2046 696c 6520  rd = "TIFF File 
-000650b0: 282a 2e74 6966 293b 3b22 0d0a 0d0a 2020  (*.tif);;"....  
-000650c0: 2020 2020 2020 6669 6c65 4e61 6d65 2c20        fileName, 
-000650d0: 5f66 696c 7465 7220 3d20 5174 5769 6467  _filter = QtWidg
-000650e0: 6574 732e 5146 696c 6544 6961 6c6f 672e  ets.QFileDialog.
-000650f0: 6765 7453 6176 6546 696c 654e 616d 6528  getSaveFileName(
-00065100: 7365 6c66 2c20 2753 6176 6520 5265 6665  self, 'Save Refe
-00065110: 7265 6e63 6520 496d 6167 6527 2c20 2727  rence Image', ''
-00065120: 2c20 7769 6c64 6361 7264 290d 0a0d 0a20  , wildcard).... 
-00065130: 2020 2020 2020 2066 696c 654e 616d 6520         fileName 
-00065140: 3d20 7374 7228 6669 6c65 4e61 6d65 290d  = str(fileName).
-00065150: 0a20 2020 2020 2020 2069 6620 6669 6c65  .        if file
-00065160: 4e61 6d65 203d 3d20 2727 3a0d 0a20 2020  Name == '':..   
-00065170: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
-00065180: 0a0d 0a0d 0a20 2020 2020 2020 2069 6d67  .....        img
-00065190: 3120 3d20 496d 6167 652e 6672 6f6d 6172  1 = Image.fromar
-000651a0: 7261 7928 7365 6c66 2e72 6566 5f69 6d61  ray(self.ref_ima
-000651b0: 6765 290d 0a20 2020 2020 2020 2069 6d67  ge)..        img
-000651c0: 312e 7361 7665 2866 696c 654e 616d 6529  1.save(fileName)
-000651d0: 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d  ......#---------
-000651e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000651f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00065200: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00065210: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20  -------------.. 
-00065220: 2020 2064 6566 204c 6f61 6452 6566 496d     def LoadRefIm
-00065230: 6167 6528 7365 6c66 293a 0d0a 0d0a 2020  age(self):....  
-00065240: 2020 2020 2020 7769 6c64 6361 7264 203d        wildcard =
-00065250: 2022 5449 4646 2046 696c 6520 282a 2e74   "TIFF File (*.t
-00065260: 6966 293b 3b22 0d0a 0d0a 2020 2020 2020  if);;"....      
-00065270: 2020 6669 6c65 4e61 6d65 2c20 5f66 696c    fileName, _fil
-00065280: 7465 7220 3d20 5174 5769 6467 6574 732e  ter = QtWidgets.
-00065290: 5146 696c 6544 6961 6c6f 672e 6765 744f  QFileDialog.getO
-000652a0: 7065 6e46 696c 654e 616d 6528 7365 6c66  penFileName(self
-000652b0: 2c20 2753 6176 6520 5265 6665 7265 6e63  , 'Save Referenc
-000652c0: 6520 496d 6167 6527 2c20 2727 2c20 7769  e Image', '', wi
-000652d0: 6c64 6361 7264 290d 0a0d 0a20 2020 2020  ldcard)....     
-000652e0: 2020 2066 696c 654e 616d 6520 3d20 7374     fileName = st
-000652f0: 7228 6669 6c65 4e61 6d65 290d 0a20 2020  r(fileName)..   
-00065300: 2020 2020 2069 6620 6669 6c65 4e61 6d65       if fileName
-00065310: 203d 3d20 2727 3a0d 0a20 2020 2020 2020   == '':..       
-00065320: 2020 2020 2072 6574 7572 6e0d 0a0d 0a20       return.... 
-00065330: 2020 2020 2020 2066 726f 6d20 5049 4c20         from PIL 
-00065340: 696d 706f 7274 2049 6d61 6765 0d0a 2020  import Image..  
-00065350: 2020 2020 2020 696d 6720 3d20 496d 6167        img = Imag
-00065360: 652e 6f70 656e 2866 696c 654e 616d 6529  e.open(fileName)
-00065370: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00065380: 2e72 6566 5f69 6d61 6765 203d 206e 702e  .ref_image = np.
-00065390: 6172 7261 7928 2869 6d67 2929 0d0a 0d0a  array((img))....
-000653a0: 2020 2020 2020 2020 7365 6c66 2e53 686f          self.Sho
-000653b0: 7752 6566 496d 6167 6528 290d 0a20 2020  wRefImage()..   
-000653c0: 2020 2020 2073 656c 662e 6861 7665 5f72       self.have_r
-000653d0: 6566 5f69 6d61 6765 203d 2031 0d0a 0d0a  ef_image = 1....
-000653e0: 2020 2020 2020 2020 7365 6c66 2e55 7064          self.Upd
-000653f0: 6174 6557 6964 6765 7473 2829 0d0a 0d0a  ateWidgets()....
-00065400: 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  #---------------
-00065410: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00065420: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00065430: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00065440: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6566  -------..    def
-00065450: 2053 686f 7752 6566 496d 6167 6528 7365   ShowRefImage(se
-00065460: 6c66 293a 0d0a 0d0a 2020 2020 2020 2020  lf):....        
-00065470: 6669 6720 3d20 7365 6c66 2e72 6566 696d  fig = self.refim
-00065480: 6766 6967 0d0a 2020 2020 2020 2020 6669  gfig..        fi
-00065490: 672e 636c 6628 290d 0a20 2020 2020 2020  g.clf()..       
-000654a0: 2066 6967 2e61 6464 5f61 7865 7328 2828   fig.add_axes(((
-000654b0: 302e 302c 302e 302c 312e 302c 312e 3029  0.0,0.0,1.0,1.0)
-000654c0: 2929 0d0a 2020 2020 2020 2020 6178 6573  ))..        axes
-000654d0: 203d 2066 6967 2e67 6361 2829 0d0a 0d0a   = fig.gca()....
-000654e0: 0d0a 2020 2020 2020 2020 5f69 6d20 3d20  ..        _im = 
-000654f0: 6178 6573 2e69 6d73 686f 7728 6e70 2e72  axes.imshow(np.r
-00065500: 6f74 3930 2873 656c 662e 7265 665f 696d  ot90(self.ref_im
-00065510: 6167 6529 2c20 636d 6170 3d6d 6174 706c  age), cmap=matpl
-00065520: 6f74 6c69 622e 636d 2e67 6574 5f63 6d61  otlib.cm.get_cma
-00065530: 7028 2767 7261 7927 2929 0d0a 0d0a 2020  p('gray'))....  
-00065540: 2020 2020 2020 6966 2028 7365 6c66 2e73        if (self.s
-00065550: 7562 7265 6769 6f6e 203d 3d20 3129 3a0d  ubregion == 1):.
-00065560: 0a0d 0a20 2020 2020 2020 2020 2020 2066  ...            f
-00065570: 726f 6d20 6d61 7470 6c6f 746c 6962 2e70  rom matplotlib.p
-00065580: 6174 6820 696d 706f 7274 2050 6174 680d  ath import Path.
-00065590: 0a20 2020 2020 2020 2020 2020 2069 6d70  .            imp
-000655a0: 6f72 7420 6d61 7470 6c6f 746c 6962 2e70  ort matplotlib.p
-000655b0: 6174 6368 6573 2061 7320 7061 7463 6865  atches as patche
-000655c0: 730d 0a0d 0a20 2020 2020 2020 2020 2020  s....           
-000655d0: 2076 6572 7473 203d 205b 0d0a 2020 2020   verts = [..    
-000655e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000655f0: 2028 7365 6c66 2e73 725f 7831 2c20 7365   (self.sr_x1, se
-00065600: 6c66 2e73 725f 7931 292c 2023 206c 6566  lf.sr_y1), # lef
-00065610: 742c 2062 6f74 746f 6d0d 0a20 2020 2020  t, bottom..     
-00065620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00065630: 2873 656c 662e 7372 5f78 312c 2073 656c  (self.sr_x1, sel
-00065640: 662e 7372 5f79 3229 2c20 2320 6c65 6674  f.sr_y2), # left
-00065650: 2c20 746f 700d 0a20 2020 2020 2020 2020  , top..         
-00065660: 2020 2020 2020 2020 2020 2020 2873 656c              (sel
-00065670: 662e 7372 5f78 322c 2073 656c 662e 7372  f.sr_x2, self.sr
-00065680: 5f79 3229 2c20 2320 7269 6768 742c 2074  _y2), # right, t
-00065690: 6f70 0d0a 2020 2020 2020 2020 2020 2020  op..            
-000656a0: 2020 2020 2020 2020 2028 7365 6c66 2e73           (self.s
-000656b0: 725f 7832 2c20 7365 6c66 2e73 725f 7931  r_x2, self.sr_y1
-000656c0: 292c 2023 2072 6967 6874 2c20 626f 7474  ), # right, bott
-000656d0: 6f6d 0d0a 2020 2020 2020 2020 2020 2020  om..            
-000656e0: 2020 2020 2020 2020 2028 7365 6c66 2e73           (self.s
-000656f0: 725f 7831 2c20 7365 6c66 2e73 725f 7931  r_x1, self.sr_y1
-00065700: 292c 2023 2069 676e 6f72 6564 0d0a 2020  ), # ignored..  
-00065710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00065720: 2020 205d 0d0a 0d0a 2020 2020 2020 2020     ]....        
-00065730: 2020 2020 636f 6465 7320 3d20 5b50 6174      codes = [Pat
-00065740: 682e 4d4f 5645 544f 2c0d 0a20 2020 2020  h.MOVETO,..     
-00065750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00065760: 5061 7468 2e4c 494e 4554 4f2c 0d0a 2020  Path.LINETO,..  
-00065770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00065780: 2020 2050 6174 682e 4c49 4e45 544f 2c0d     Path.LINETO,.
-00065790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000657a0: 2020 2020 2020 5061 7468 2e4c 494e 4554        Path.LINET
-000657b0: 4f2c 0d0a 2020 2020 2020 2020 2020 2020  O,..            
-000657c0: 2020 2020 2020 2020 2050 6174 682e 434c           Path.CL
-000657d0: 4f53 4550 4f4c 592c 0d0a 2020 2020 2020  OSEPOLY,..      
-000657e0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
-000657f0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00065800: 7061 7468 203d 2050 6174 6828 7665 7274  path = Path(vert
-00065810: 732c 2063 6f64 6573 290d 0a0d 0a20 2020  s, codes)....   
-00065820: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-00065830: 7463 6820 3d20 7061 7463 6865 732e 5061  tch = patches.Pa
-00065840: 7468 5061 7463 6828 7061 7468 2c20 6661  thPatch(path, fa
-00065850: 6365 636f 6c6f 723d 2772 6564 2729 0d0a  cecolor='red')..
-00065860: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00065870: 2e70 6174 6368 2e73 6574 5f61 6c70 6861  .patch.set_alpha
-00065880: 2830 2e33 290d 0a20 2020 2020 2020 2020  (0.3)..         
-00065890: 2020 2061 7865 732e 6164 645f 7061 7463     axes.add_patc
-000658a0: 6828 7365 6c66 2e70 6174 6368 290d 0a0d  h(self.patch)...
-000658b0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000658c0: 2e6d 616e 5f61 6c69 676e 203e 2030 3a0d  .man_align > 0:.
-000658d0: 0a20 2020 2020 2020 2020 2020 206c 783d  .            lx=
-000658e0: 6d61 7470 6c6f 746c 6962 2e6c 696e 6573  matplotlib.lines
-000658f0: 2e4c 696e 6532 4428 5b73 656c 662e 6d61  .Line2D([self.ma
-00065900: 6e5f 7872 6566 2c73 656c 662e 6d61 6e5f  n_xref,self.man_
-00065910: 7872 6566 5d2c 205b 302c 7365 6c66 2e73  xref], [0,self.s
-00065920: 7461 636b 2e6e 5f72 6f77 735d 2c63 6f6c  tack.n_rows],col
-00065930: 6f72 3d27 6772 6565 6e27 290d 0a20 2020  or='green')..   
-00065940: 2020 2020 2020 2020 206c 793d 6d61 7470           ly=matp
-00065950: 6c6f 746c 6962 2e6c 696e 6573 2e4c 696e  lotlib.lines.Lin
-00065960: 6532 4428 5b30 2c73 656c 662e 7374 6163  e2D([0,self.stac
-00065970: 6b2e 6e5f 636f 6c73 5d2c 205b 7365 6c66  k.n_cols], [self
-00065980: 2e6d 616e 5f79 7265 662c 7365 6c66 2e6d  .man_yref,self.m
-00065990: 616e 5f79 7265 665d 202c 636f 6c6f 723d  an_yref] ,color=
-000659a0: 2767 7265 656e 2729 0d0a 2020 2020 2020  'green')..      
-000659b0: 2020 2020 2020 6178 6573 2e61 6464 5f6c        axes.add_l
-000659c0: 696e 6528 6c78 290d 0a20 2020 2020 2020  ine(lx)..       
-000659d0: 2020 2020 2061 7865 732e 6164 645f 6c69       axes.add_li
-000659e0: 6e65 286c 7929 0d0a 0d0a 2020 2020 2020  ne(ly)....      
-000659f0: 2020 6178 6573 2e61 7869 7328 226f 6666    axes.axis("off
-00065a00: 2229 0d0a 0d0a 2020 2020 2020 2020 7365  ")....        se
-00065a10: 6c66 2e52 6566 496d 6167 6550 616e 656c  lf.RefImagePanel
-00065a20: 2e64 7261 7728 290d 0a0d 0a0d 0a23 2d2d  .draw()......#--
-00065a30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00065a40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00065a50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00065a60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00065a70: 2d2d 2d2d 0d0a 2020 2020 6465 6620 4f6e  ----..    def On
-00065a80: 7262 5f61 7574 6f6d 616e 7561 6c28 7365  rb_automanual(se
-00065a90: 6c66 2c20 656e 6162 6c65 6429 3a0d 0a0d  lf, enabled):...
-00065aa0: 0a20 2020 2020 2020 2073 7461 7465 203d  .        state =
-00065ab0: 2065 6e61 626c 6564 0d0a 0d0a 0d0a 2020   enabled......  
-00065ac0: 2020 2020 2020 6966 2073 7461 7465 3a0d        if state:.
-00065ad0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00065ae0: 662e 6175 746f 203d 2054 7275 650d 0a20  f.auto = True.. 
-00065af0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00065b00: 6d61 6e5f 616c 6967 6e20 3d20 300d 0a20  man_align = 0.. 
-00065b10: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00065b20: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00065b30: 7574 6f20 3d20 4661 6c73 650d 0a0d 0a0d  uto = False.....
-00065b40: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
-00065b50: 6c66 2e63 6f6d 2e73 7461 636b 5f34 6420  lf.com.stack_4d 
-00065b60: 3d3d 2030 3a0d 0a20 2020 2020 2020 2020  == 0:..         
-00065b70: 2020 2073 656c 662e 616c 6967 6e65 645f     self.aligned_
-00065b80: 7374 6163 6b20 3d20 7365 6c66 2e73 7461  stack = self.sta
-00065b90: 636b 2e61 6273 6461 7461 2e63 6f70 7928  ck.absdata.copy(
-00065ba0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00065bb0: 656c 662e 6d61 6e5f 7873 203d 206e 702e  elf.man_xs = np.
-00065bc0: 7a65 726f 7328 2873 656c 662e 7374 6163  zeros((self.stac
-00065bd0: 6b2e 6e5f 6576 2929 0d0a 2020 2020 2020  k.n_ev))..      
-00065be0: 2020 2020 2020 7365 6c66 2e6d 616e 5f79        self.man_y
-00065bf0: 7320 3d20 6e70 2e7a 6572 6f73 2828 7365  s = np.zeros((se
-00065c00: 6c66 2e73 7461 636b 2e6e 5f65 7629 290d  lf.stack.n_ev)).
-00065c10: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00065c20: 662e 7873 6869 6674 7320 3d20 6e70 2e7a  f.xshifts = np.z
-00065c30: 6572 6f73 2828 7365 6c66 2e73 7461 636b  eros((self.stack
-00065c40: 2e6e 5f65 7629 290d 0a20 2020 2020 2020  .n_ev))..       
-00065c50: 2020 2020 2073 656c 662e 7973 6869 6674       self.yshift
-00065c60: 7320 3d20 6e70 2e7a 6572 6f73 2828 7365  s = np.zeros((se
-00065c70: 6c66 2e73 7461 636b 2e6e 5f65 7629 290d  lf.stack.n_ev)).
-00065c80: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00065c90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00065ca0: 2e61 6c69 676e 6564 5f73 7461 636b 203d  .aligned_stack =
-00065cb0: 2073 656c 662e 7374 6163 6b2e 7374 6163   self.stack.stac
-00065cc0: 6b34 442e 636f 7079 2829 0d0a 2020 2020  k4D.copy()..    
-00065cd0: 2020 2020 2020 2020 7365 6c66 2e6d 616e          self.man
-00065ce0: 5f78 7320 3d20 6e70 2e7a 6572 6f73 2828  _xs = np.zeros((
-00065cf0: 7365 6c66 2e73 7461 636b 2e6e 5f65 762c  self.stack.n_ev,
-00065d00: 7365 6c66 2e73 7461 636b 2e6e 5f74 6865  self.stack.n_the
-00065d10: 7461 2929 0d0a 2020 2020 2020 2020 2020  ta))..          
-00065d20: 2020 7365 6c66 2e6d 616e 5f79 7320 3d20    self.man_ys = 
-00065d30: 6e70 2e7a 6572 6f73 2828 7365 6c66 2e73  np.zeros((self.s
-00065d40: 7461 636b 2e6e 5f65 762c 7365 6c66 2e73  tack.n_ev,self.s
-00065d50: 7461 636b 2e6e 5f74 6865 7461 2929 0d0a  tack.n_theta))..
-00065d60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00065d70: 2e78 7368 6966 7473 203d 206e 702e 7a65  .xshifts = np.ze
-00065d80: 726f 7328 2873 656c 662e 7374 6163 6b2e  ros((self.stack.
-00065d90: 6e5f 6576 2c73 656c 662e 7374 6163 6b2e  n_ev,self.stack.
-00065da0: 6e5f 7468 6574 6129 290d 0a20 2020 2020  n_theta))..     
-00065db0: 2020 2020 2020 2073 656c 662e 7973 6869         self.yshi
-00065dc0: 6674 7320 3d20 6e70 2e7a 6572 6f73 2828  fts = np.zeros((
-00065dd0: 7365 6c66 2e73 7461 636b 2e6e 5f65 762c  self.stack.n_ev,
-00065de0: 7365 6c66 2e73 7461 636b 2e6e 5f74 6865  self.stack.n_the
-00065df0: 7461 2929 0d0a 0d0a 0d0a 0d0a 2020 2020  ta))........    
-00065e00: 2020 2020 6966 2073 656c 662e 6861 7665      if self.have
-00065e10: 5f72 6566 5f69 6d61 6765 203d 3d20 313a  _ref_image == 1:
-00065e20: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
-00065e30: 6720 3d20 7365 6c66 2e73 6869 6674 7366  g = self.shiftsf
-00065e40: 6967 0d0a 2020 2020 2020 2020 2020 2020  ig..            
-00065e50: 6669 672e 636c 6628 290d 0a20 2020 2020  fig.clf()..     
-00065e60: 2020 2020 2020 2073 656c 662e 5368 6966         self.Shif
-00065e70: 7473 5061 6e65 6c2e 6472 6177 2829 0d0a  tsPanel.draw()..
-00065e80: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
-00065e90: 6720 3d20 7365 6c66 2e63 7363 6f72 7266  g = self.cscorrf
-00065ea0: 6967 0d0a 2020 2020 2020 2020 2020 2020  ig..            
-00065eb0: 6669 672e 636c 6628 290d 0a20 2020 2020  fig.clf()..     
-00065ec0: 2020 2020 2020 2073 656c 662e 4373 636f         self.Csco
-00065ed0: 7272 5061 6e65 6c2e 6472 6177 2829 0d0a  rrPanel.draw()..
-00065ee0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00065ef0: 6c66 2e53 686f 7749 6d61 6765 2829 0d0a  lf.ShowImage()..
-00065f00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00065f10: 2e53 686f 7752 6566 496d 6167 6528 290d  .ShowRefImage().
-00065f20: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00065f30: 5570 6461 7465 5769 6467 6574 7328 290d  UpdateWidgets().
-00065f40: 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ...#------------
-00065f50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00065f60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00065f70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00065f80: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
-00065f90: 6465 6620 5368 6f77 4372 6f73 7343 6f72  def ShowCrossCor
-00065fa0: 7265 6c61 7469 6f6e 2873 656c 662c 2063  relation(self, c
-00065fb0: 636f 7272 2c20 7873 6869 6674 2c20 7973  corr, xshift, ys
-00065fc0: 6869 6674 293a 0d0a 0d0a 2020 2020 2020  hift):....      
-00065fd0: 2020 6669 6720 3d20 7365 6c66 2e63 7363    fig = self.csc
-00065fe0: 6f72 7266 6967 0d0a 0d0a 2020 2020 2020  orrfig....      
-00065ff0: 2020 6669 672e 636c 6628 290d 0a20 2020    fig.clf()..   
-00066000: 2020 2020 2066 6967 2e61 6464 5f61 7865       fig.add_axe
-00066010: 7328 2828 302e 302c 302e 302c 312e 302c  s(((0.0,0.0,1.0,
-00066020: 312e 3029 2929 0d0a 2020 2020 2020 2020  1.0)))..        
-00066030: 6178 6573 203d 2066 6967 2e67 6361 2829  axes = fig.gca()
-00066040: 0d0a 0d0a 2020 2020 2020 2020 696d 203d  ....        im =
-00066050: 2061 7865 732e 696d 7368 6f77 286e 702e   axes.imshow(np.
-00066060: 726f 7439 3028 6363 6f72 7229 2c20 636d  rot90(ccorr), cm
-00066070: 6170 3d6d 6174 706c 6f74 6c69 622e 636d  ap=matplotlib.cm
-00066080: 2e67 6574 5f63 6d61 7028 2767 7261 7927  .get_cmap('gray'
-00066090: 2929 0d0a 0d0a 2020 2020 2020 2020 6e78  ))....        nx
-000660a0: 203d 2063 636f 7272 2e73 6861 7065 5b30   = ccorr.shape[0
-000660b0: 5d0d 0a20 2020 2020 2020 206e 7920 3d20  ]..        ny = 
-000660c0: 6363 6f72 722e 7368 6170 655b 315d 0d0a  ccorr.shape[1]..
-000660d0: 2020 2020 2020 2020 7863 656e 7465 7220          xcenter 
-000660e0: 3d20 7873 6869 6674 202b 206e 702e 666c  = xshift + np.fl
-000660f0: 6f61 7428 6e78 292f 322e 300d 0a20 2020  oat(nx)/2.0..   
-00066100: 2020 2020 2079 6365 6e74 6572 203d 2079       ycenter = y
-00066110: 7368 6966 7420 2b20 6e70 2e66 6c6f 6174  shift + np.float
-00066120: 286e 7929 2f32 2e30 0d0a 0d0a 2020 2020  (ny)/2.0....    
-00066130: 2020 2020 786c 203d 2078 6365 6e74 6572      xl = xcenter
-00066140: 2d31 300d 0a20 2020 2020 2020 2069 6620  -10..        if 
-00066150: 786c 3c30 3a0d 0a20 2020 2020 2020 2020  xl<0:..         
-00066160: 2020 2078 6c3d 300d 0a20 2020 2020 2020     xl=0..       
-00066170: 2078 7220 3d20 7863 656e 7465 722b 3130   xr = xcenter+10
-00066180: 0d0a 2020 2020 2020 2020 6966 2078 723e  ..        if xr>
-00066190: 6e78 2d31 3a0d 0a20 2020 2020 2020 2020  nx-1:..         
-000661a0: 2020 2078 723d 6e78 2d31 0d0a 2020 2020     xr=nx-1..    
-000661b0: 2020 2020 796c 203d 2079 6365 6e74 6572      yl = ycenter
-000661c0: 2d31 300d 0a20 2020 2020 2020 2069 6620  -10..        if 
-000661d0: 796c 3c30 3a0d 0a20 2020 2020 2020 2020  yl<0:..         
-000661e0: 2020 2079 6c3d 300d 0a20 2020 2020 2020     yl=0..       
-000661f0: 2079 7220 3d20 7963 656e 7465 722b 3130   yr = ycenter+10
-00066200: 0d0a 2020 2020 2020 2020 6966 2079 723e  ..        if yr>
-00066210: 6e79 2d31 3a0d 0a20 2020 2020 2020 2020  ny-1:..         
-00066220: 2020 2079 723d 6e79 2d31 0d0a 0d0a 2020     yr=ny-1....  
-00066230: 2020 2020 2020 6c78 3d6d 6174 706c 6f74        lx=matplot
-00066240: 6c69 622e 6c69 6e65 732e 4c69 6e65 3244  lib.lines.Line2D
-00066250: 285b 786c 2c78 725d 2c20 5b79 6365 6e74  ([xl,xr], [ycent
-00066260: 6572 2c79 6365 6e74 6572 5d2c 2063 6f6c  er,ycenter], col
-00066270: 6f72 3d27 6772 6565 6e27 290d 0a20 2020  or='green')..   
-00066280: 2020 2020 206c 793d 6d61 7470 6c6f 746c       ly=matplotl
-00066290: 6962 2e6c 696e 6573 2e4c 696e 6532 4428  ib.lines.Line2D(
-000662a0: 5b78 6365 6e74 6572 2c78 6365 6e74 6572  [xcenter,xcenter
-000662b0: 5d2c 205b 796c 2c79 725d 2c20 636f 6c6f  ], [yl,yr], colo
-000662c0: 723d 2767 7265 656e 2729 0d0a 2020 2020  r='green')..    
-000662d0: 2020 2020 6178 6573 2e61 6464 5f6c 696e      axes.add_lin
-000662e0: 6528 6c78 290d 0a20 2020 2020 2020 2061  e(lx)..        a
-000662f0: 7865 732e 6164 645f 6c69 6e65 286c 7929  xes.add_line(ly)
-00066300: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6178  ......        ax
-00066310: 6573 2e61 7869 7328 226f 6666 2229 0d0a  es.axis("off")..
-00066320: 0d0a 2020 2020 2020 2020 7365 6c66 2e43  ..        self.C
-00066330: 7363 6f72 7250 616e 656c 2e64 7261 7728  scorrPanel.draw(
-00066340: 290d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d  )....#----------
-00066350: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00066360: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00066370: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00066380: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020  ------------..  
-00066390: 2020 6465 6620 4f6e 5368 6f77 4343 6f72    def OnShowCCor
-000663a0: 7228 7365 6c66 2c20 7374 6174 6529 3a0d  r(self, state):.
-000663b0: 0a0d 0a20 2020 2020 2020 2069 6620 7374  ...        if st
-000663c0: 6174 6520 3d3d 2051 7443 6f72 652e 5174  ate == QtCore.Qt
-000663d0: 2e43 6865 636b 6564 3a0d 0a20 2020 2020  .Checked:..     
-000663e0: 2020 2020 2020 2073 656c 662e 7368 6f77         self.show
-000663f0: 6363 6f72 7220 3d20 310d 0a20 2020 2020  ccorr = 1..     
-00066400: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00066410: 2020 2020 2020 7365 6c66 2e73 686f 7763        self.showc
-00066420: 636f 7272 203d 2030 0d0a 0d0a 0d0a 232d  corr = 0......#-
-00066430: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00066440: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00066450: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00066460: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00066470: 2d2d 2d2d 2d0d 0a20 2020 2064 6566 204f  -----..    def O
-00066480: 6e45 6467 6545 2873 656c 662c 2073 7461  nEdgeE(self, sta
-00066490: 7465 293a 0d0a 0d0a 2020 2020 2020 2020  te):....        
-000664a0: 6966 2073 7461 7465 203d 3d20 5174 436f  if state == QtCo
-000664b0: 7265 2e51 742e 4368 6563 6b65 643a 0d0a  re.Qt.Checked:..
-000664c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000664d0: 2e65 6467 6565 203d 2031 0d0a 2020 2020  .edgee = 1..    
-000664e0: 2020 2020 2020 2020 7365 6c66 2e72 625f          self.rb_
-000664f0: 736f 6265 6c2e 7365 7445 6e61 626c 6564  sobel.setEnabled
-00066500: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
-00066510: 2020 2020 7365 6c66 2e72 625f 7072 6577      self.rb_prew
-00066520: 6974 742e 7365 7445 6e61 626c 6564 2854  itt.setEnabled(T
-00066530: 7275 6529 0d0a 2020 2020 2020 2020 656c  rue)..        el
-00066540: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00066550: 2073 656c 662e 6564 6765 6520 3d20 300d   self.edgee = 0.
-00066560: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00066570: 662e 7262 5f73 6f62 656c 2e73 6574 456e  f.rb_sobel.setEn
-00066580: 6162 6c65 6428 4661 6c73 6529 0d0a 2020  abled(False)..  
-00066590: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
-000665a0: 625f 7072 6577 6974 742e 7365 7445 6e61  b_prewitt.setEna
-000665b0: 626c 6564 2846 616c 7365 290d 0a0d 0a23  bled(False)....#
-000665c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000665d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000665e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000665f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00066600: 2d2d 2d2d 2d2d 0d0a 2020 2020 6465 6620  ------..    def 
-00066610: 4f6e 5365 744d 6178 5368 6966 7428 7365  OnSetMaxShift(se
-00066620: 6c66 2c20 7661 6c75 6529 3a0d 0a0d 0a20  lf, value):.... 
-00066630: 2020 2020 2020 2073 656c 662e 6d61 7873         self.maxs
-00066640: 6869 6674 203d 2076 616c 7565 0d0a 0d0a  hift = value....
-00066650: 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  #---------------
-00066660: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00066670: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00066680: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00066690: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6566  -------..    def
-000666a0: 204f 6e52 656d 6f76 6549 6d61 6765 2873   OnRemoveImage(s
-000666b0: 656c 662c 2065 7665 6e74 293a 0d0a 0d0a  elf, event):....
-000666c0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-000666d0: 7461 636b 2e61 6273 6461 7461 203d 206e  tack.absdata = n
-000666e0: 702e 6465 6c65 7465 2873 656c 662e 7374  p.delete(self.st
-000666f0: 6163 6b2e 6162 7364 6174 612c 2073 656c  ack.absdata, sel
-00066700: 662e 6965 762c 2061 7869 733d 3229 0d0a  f.iev, axis=2)..
-00066710: 0d0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-00066720: 6c69 676e 6564 5f73 7461 636b 203d 206e  ligned_stack = n
-00066730: 702e 6465 6c65 7465 2873 656c 662e 616c  p.delete(self.al
-00066740: 6967 6e65 645f 7374 6163 6b2c 2073 656c  igned_stack, sel
-00066750: 662e 6965 762c 2061 7869 733d 3229 0d0a  f.iev, axis=2)..
-00066760: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00066770: 662e 636f 6d2e 7374 6163 6b5f 3464 203d  f.com.stack_4d =
-00066780: 3d20 313a 0d0a 2020 2020 2020 2020 2020  = 1:..          
-00066790: 2020 7365 6c66 2e73 7461 636b 2e73 7461    self.stack.sta
-000667a0: 636b 3444 203d 206e 702e 6465 6c65 7465  ck4D = np.delete
-000667b0: 2873 656c 662e 7374 6163 6b2e 7374 6163  (self.stack.stac
-000667c0: 6b34 442c 2073 656c 662e 6965 762c 2061  k4D, self.iev, a
-000667d0: 7869 733d 3229 0d0a 0d0a 0d0a 2020 2020  xis=2)......    
-000667e0: 2020 2020 7365 6c66 2e73 7461 636b 2e6e      self.stack.n
-000667f0: 5f65 7620 3d20 7365 6c66 2e73 7461 636b  _ev = self.stack
-00066800: 2e6e 5f65 7620 2d20 310d 0a20 2020 2020  .n_ev - 1..     
-00066810: 2020 2073 656c 662e 7374 6163 6b2e 6576     self.stack.ev
-00066820: 203d 206e 702e 6465 6c65 7465 2873 656c   = np.delete(sel
-00066830: 662e 7374 6163 6b2e 6576 2c20 7365 6c66  f.stack.ev, self
-00066840: 2e69 6576 290d 0a0d 0a0d 0a0d 0a0d 0a20  .iev).......... 
-00066850: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
-00066860: 6f6d 2e73 7461 636b 5f34 6420 3d3d 2030  om.stack_4d == 0
-00066870: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00066880: 656c 662e 7374 6163 6b2e 6461 7461 5f73  elf.stack.data_s
-00066890: 7472 7563 742e 6578 6368 616e 6765 2e64  truct.exchange.d
-000668a0: 6174 6120 3d20 7365 6c66 2e73 7461 636b  ata = self.stack
-000668b0: 2e61 6273 6461 7461 0d0a 2020 2020 2020  .absdata..      
-000668c0: 2020 2020 2020 7365 6c66 2e78 7368 6966        self.xshif
-000668d0: 7473 203d 206e 702e 6465 6c65 7465 2873  ts = np.delete(s
-000668e0: 656c 662e 7873 6869 6674 732c 2073 656c  elf.xshifts, sel
-000668f0: 662e 6965 7629 0d0a 2020 2020 2020 2020  f.iev)..        
-00066900: 2020 2020 7365 6c66 2e79 7368 6966 7473      self.yshifts
-00066910: 203d 206e 702e 6465 6c65 7465 2873 656c   = np.delete(sel
-00066920: 662e 7973 6869 6674 732c 2073 656c 662e  f.yshifts, self.
-00066930: 6965 7629 0d0a 2020 2020 2020 2020 656c  iev)..        el
-00066940: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00066950: 2073 656c 662e 7374 6163 6b2e 6461 7461   self.stack.data
-00066960: 5f73 7472 7563 742e 6578 6368 616e 6765  _struct.exchange
-00066970: 2e64 6174 6120 3d20 7365 6c66 2e73 7461  .data = self.sta
-00066980: 636b 2e73 7461 636b 3444 0d0a 2020 2020  ck.stack4D..    
-00066990: 2020 2020 2020 2020 7365 6c66 2e78 7368          self.xsh
-000669a0: 6966 7473 203d 206e 702e 6465 6c65 7465  ifts = np.delete
-000669b0: 2873 656c 662e 7873 6869 6674 732c 2073  (self.xshifts, s
-000669c0: 656c 662e 6965 762c 2061 7869 733d 3029  elf.iev, axis=0)
-000669d0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000669e0: 6c66 2e79 7368 6966 7473 203d 206e 702e  lf.yshifts = np.
-000669f0: 6465 6c65 7465 2873 656c 662e 7973 6869  delete(self.yshi
-00066a00: 6674 732c 2073 656c 662e 6965 762c 2061  fts, self.iev, a
-00066a10: 7869 733d 3029 0d0a 0d0a 2020 2020 2020  xis=0)....      
-00066a20: 2020 7365 6c66 2e73 7461 636b 2e64 6174    self.stack.dat
-00066a30: 615f 7374 7275 6374 2e65 7863 6861 6e67  a_struct.exchang
-00066a40: 652e 656e 6572 6779 203d 2073 656c 662e  e.energy = self.
-00066a50: 7374 6163 6b2e 6576 0d0a 0d0a 2020 2020  stack.ev....    
-00066a60: 2020 2020 6966 2073 656c 662e 636f 6d2e      if self.com.
-00066a70: 6930 5f6c 6f61 6465 6420 3d3d 2031 3a0d  i0_loaded == 1:.
-00066a80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00066a90: 662e 7374 6163 6b2e 6361 6c63 756c 6174  f.stack.calculat
-00066aa0: 655f 6f70 7469 6361 6c5f 6465 6e73 6974  e_optical_densit
-00066ab0: 7928 290d 0a0d 0a20 2020 2020 2020 2073  y()....        s
-00066ac0: 656c 662e 6965 7620 3d20 7365 6c66 2e69  elf.iev = self.i
-00066ad0: 6576 2d31 0d0a 2020 2020 2020 2020 6966  ev-1..        if
-00066ae0: 2073 656c 662e 6965 7620 3c20 303a 0d0a   self.iev < 0:..
-00066af0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00066b00: 2e69 6576 203d 2030 0d0a 0d0a 0d0a 2020  .iev = 0......  
-00066b10: 2020 2020 2020 7365 6c66 2e73 6c69 6465        self.slide
-00066b20: 725f 656e 672e 7365 7452 616e 6765 2830  r_eng.setRange(0
-00066b30: 2c20 7365 6c66 2e73 7461 636b 2e6e 5f65  , self.stack.n_e
-00066b40: 762d 3129 0d0a 0d0a 2020 2020 2020 2020  v-1)....        
-00066b50: 7365 6c66 2e70 6172 656e 742e 7061 6765  self.parent.page
-00066b60: 312e 736c 6964 6572 5f65 6e67 2e73 6574  1.slider_eng.set
-00066b70: 5261 6e67 6528 302c 2073 656c 662e 7374  Range(0, self.st
-00066b80: 6163 6b2e 6e5f 6576 2d31 290d 0a20 2020  ack.n_ev-1)..   
-00066b90: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
-00066ba0: 2e70 6167 6531 2e69 6576 203d 2073 656c  .page1.iev = sel
-00066bb0: 662e 7374 6163 6b2e 6e5f 6576 2f32 0d0a  f.stack.n_ev/2..
-00066bc0: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
-00066bd0: 656e 742e 7061 6765 312e 736c 6964 6572  ent.page1.slider
-00066be0: 5f65 6e67 2e73 6574 5661 6c75 6528 7365  _eng.setValue(se
-00066bf0: 6c66 2e70 6172 656e 742e 7061 6765 312e  lf.parent.page1.
-00066c00: 6965 7629 0d0a 0d0a 2020 2020 2020 2020  iev)....        
-00066c10: 7365 6c66 2e70 6172 656e 742e 7061 6765  self.parent.page
-00066c20: 312e 7368 6f77 5370 6563 7472 756d 2873  1.showSpectrum(s
-00066c30: 656c 662e 7061 7265 6e74 2e70 6167 6531  elf.parent.page1
-00066c40: 2e69 782c 2073 656c 662e 7061 7265 6e74  .ix, self.parent
-00066c50: 2e70 6167 6531 2e69 7929 0d0a 2020 2020  .page1.iy)..    
-00066c60: 2020 2020 7365 6c66 2e70 6172 656e 742e      self.parent.
-00066c70: 7061 6765 312e 6c6f 6164 496d 6167 6528  page1.loadImage(
-00066c80: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-00066c90: 662e 5368 6f77 496d 6167 6528 290d 0a0d  f.ShowImage()...
-00066ca0: 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  .#--------------
-00066cb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00066cc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00066cd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00066ce0: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 6465  --------..    de
-00066cf0: 6620 4f6e 4361 6c63 5265 6769 7374 7261  f OnCalcRegistra
-00066d00: 7469 6f6e 2873 656c 662c 2065 7665 6e74  tion(self, event
-00066d10: 293a 0d0a 0d0a 2020 2020 2020 2020 6966  ):....        if
-00066d20: 2073 656c 662e 636f 6d2e 7374 6163 6b5f   self.com.stack_
-00066d30: 3464 203d 3d20 313a 0d0a 2020 2020 2020  4d == 1:..      
-00066d40: 2020 2020 2020 7365 6c66 2e43 616c 6352        self.CalcR
-00066d50: 6567 6973 7472 6174 696f 6e34 4428 290d  egistration4D().
-00066d60: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00066d70: 7572 6e0d 0a0d 0a20 2020 2020 2020 2051  urn....        Q
-00066d80: 7457 6964 6765 7473 2e51 4170 706c 6963  tWidgets.QApplic
-00066d90: 6174 696f 6e2e 7365 744f 7665 7272 6964  ation.setOverrid
-00066da0: 6543 7572 736f 7228 5174 4775 692e 5143  eCursor(QtGui.QC
-00066db0: 7572 736f 7228 5174 2e57 6169 7443 7572  ursor(Qt.WaitCur
-00066dc0: 736f 7229 290d 0a0d 0a20 2020 2020 2020  sor))....       
-00066dd0: 2023 4765 7420 4564 6765 2065 6e68 616e   #Get Edge enhan
-00066de0: 6365 6d65 6e74 2069 6e66 6f0d 0a20 2020  cement info..   
-00066df0: 2020 2020 2065 6467 6520 3d20 300d 0a20       edge = 0.. 
-00066e00: 2020 2020 2020 2069 6620 7365 6c66 2e65         if self.e
-00066e10: 6467 6565 203e 2030 3a0d 0a20 2020 2020  dgee > 0:..     
-00066e20: 2020 2020 2020 2069 6620 7365 6c66 2e72         if self.r
-00066e30: 625f 736f 6265 6c2e 6973 4368 6563 6b65  b_sobel.isChecke
-00066e40: 6428 293a 0d0a 2020 2020 2020 2020 2020  d():..          
-00066e50: 2020 2020 2020 6564 6765 203d 2031 0d0a        edge = 1..
-00066e60: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00066e70: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00066e80: 2020 2065 6467 6520 3d20 320d 0a0d 0a20     edge = 2.... 
-00066e90: 2020 2020 2020 2023 5375 6272 6567 696f         #Subregio
-00066ea0: 6e20 7365 6c65 6374 696f 6e20 6f6e 2061  n selection on a
-00066eb0: 2072 6566 6572 656e 6365 2069 6d61 6765   reference image
-00066ec0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00066ed0: 662e 7375 6272 6567 696f 6e20 3d3d 2030  f.subregion == 0
-00066ee0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00066ef0: 656c 662e 7372 5f78 3120 3d20 300d 0a20  elf.sr_x1 = 0.. 
-00066f00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00066f10: 7372 5f78 3220 3d20 300d 0a20 2020 2020  sr_x2 = 0..     
-00066f20: 2020 2020 2020 2073 656c 662e 7372 5f79         self.sr_y
-00066f30: 3120 3d20 300d 0a20 2020 2020 2020 2020  1 = 0..         
-00066f40: 2020 2073 656c 662e 7372 5f79 3220 3d20     self.sr_y2 = 
-00066f50: 300d 0a20 2020 2020 2020 2020 2020 2072  0..            r
-00066f60: 6566 6572 656e 6365 696d 6167 6520 3d20  eferenceimage = 
-00066f70: 7365 6c66 2e72 6566 5f69 6d61 6765 0d0a  self.ref_image..
-00066f80: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00066f90: 2020 2020 2020 2020 2020 2072 6566 6572             refer
-00066fa0: 656e 6365 696d 6167 6520 3d20 7365 6c66  enceimage = self
-00066fb0: 2e72 6566 5f69 6d61 6765 5b73 656c 662e  .ref_image[self.
-00066fc0: 7372 5f78 313a 7365 6c66 2e73 725f 7832  sr_x1:self.sr_x2
-00066fd0: 2c20 7365 6c66 2e73 725f 7932 3a73 656c  , self.sr_y2:sel
-00066fe0: 662e 7372 5f79 315d 0d0a 0d0a 2020 2020  f.sr_y1]....    
-00066ff0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-00067000: 6765 2873 656c 662e 7374 6163 6b2e 6e5f  ge(self.stack.n_
-00067010: 6576 293a 0d0a 0d0a 2020 2020 2020 2020  ev):....        
-00067020: 2020 2020 6966 2073 656c 662e 7375 6272      if self.subr
-00067030: 6567 696f 6e20 3d3d 2030 3a0d 0a20 2020  egion == 0:..   
-00067040: 2020 2020 2020 2020 2020 2020 2069 6d67               img
-00067050: 3220 3d20 7365 6c66 2e61 6c69 676e 6564  2 = self.aligned
-00067060: 5f73 7461 636b 5b3a 2c3a 2c69 5d0d 0a20  _stack[:,:,i].. 
-00067070: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00067080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00067090: 2020 696d 6732 203d 2073 656c 662e 616c    img2 = self.al
-000670a0: 6967 6e65 645f 7374 6163 6b5b 7365 6c66  igned_stack[self
-000670b0: 2e73 725f 7831 3a73 656c 662e 7372 5f78  .sr_x1:self.sr_x
-000670c0: 322c 2073 656c 662e 7372 5f79 323a 7365  2, self.sr_y2:se
-000670d0: 6c66 2e73 725f 7931 2c20 695d 0d0a 0d0a  lf.sr_y1, i]....
-000670e0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-000670f0: 3d3d 303a 0d0a 2020 2020 2020 2020 2020  ==0:..          
-00067100: 2020 2020 2020 7873 6869 6674 2c20 7973        xshift, ys
-00067110: 6869 6674 2c20 6363 6f72 7220 3d20 7365  hift, ccorr = se
-00067120: 6c66 2e73 7461 636b 2e72 6567 6973 7465  lf.stack.registe
-00067130: 725f 696d 6167 6573 2872 6566 6572 656e  r_images(referen
-00067140: 6365 696d 6167 652c 2069 6d67 322c 0d0a  ceimage, img2,..
-00067150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067180: 2020 2020 2020 2020 2020 6861 7665 5f72            have_r
-00067190: 6566 5f69 6d67 5f66 6674 203d 2046 616c  ef_img_fft = Fal
-000671a0: 7365 2c0d 0a20 2020 2020 2020 2020 2020  se,..           
+00064760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064770: 5b73 656c 662e 6d61 6e5f 7872 6566 2d73  [self.man_xref-s
+00064780: 656c 662e 6d61 6e5f 7873 5b73 656c 662e  elf.man_xs[self.
+00064790: 6965 765d 2c0d 0a23 2020 2020 2020 2020  iev],..#        
+000647a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000647b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000647c0: 662e 6d61 6e5f 7872 6566 2d73 656c 662e  f.man_xref-self.
+000647d0: 6d61 6e5f 7873 5b73 656c 662e 6965 765d  man_xs[self.iev]
+000647e0: 5d20 2c63 6f6c 6f72 3d27 7265 6427 290d  ] ,color='red').
+000647f0: 0a23 2020 2020 2020 2020 2020 2020 2061  .#             a
+00064800: 7865 732e 6164 645f 6c69 6e65 286c 7829  xes.add_line(lx)
+00064810: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+00064820: 6178 6573 2e61 6464 5f6c 696e 6528 6c79  axes.add_line(ly
+00064830: 290d 0a0d 0a0d 0a0d 0a20 2020 2020 2020  )........       
+00064840: 2061 7865 732e 6178 6973 2822 6f66 6622   axes.axis("off"
+00064850: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00064860: 4162 7349 6d61 6765 5061 6e65 6c2e 6472  AbsImagePanel.dr
+00064870: 6177 2829 0d0a 0d0a 0d0a 2020 2020 2020  aw()......      
+00064880: 2020 7365 6c66 2e74 635f 696d 6167 6565    self.tc_imagee
+00064890: 6e67 2e73 6574 5465 7874 2827 496d 6167  ng.setText('Imag
+000648a0: 6520 6174 2065 6e65 7267 793a 207b 303a  e at energy: {0:
+000648b0: 352e 3266 7d20 6556 272e 666f 726d 6174  5.2f} eV'.format
+000648c0: 2866 6c6f 6174 2873 656c 662e 7374 6163  (float(self.stac
+000648d0: 6b2e 6576 5b73 656c 662e 6965 765d 2929  k.ev[self.iev]))
+000648e0: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
+000648f0: 7365 6c66 2e63 6f6d 2e73 7461 636b 5f34  self.com.stack_4
+00064900: 6420 3d3d 2030 3a0d 0a20 2020 2020 2020  d == 0:..       
+00064910: 2020 2020 2073 656c 662e 7463 5f73 6869       self.tc_shi
+00064920: 6674 312e 7365 7454 6578 7428 2758 2073  ft1.setText('X s
+00064930: 6869 6674 3a20 7b30 3a35 2e32 667d 2070  hift: {0:5.2f} p
+00064940: 6978 656c 7327 2e66 6f72 6d61 7428 7365  ixels'.format(se
+00064950: 6c66 2e78 7368 6966 7473 5b73 656c 662e  lf.xshifts[self.
+00064960: 6965 765d 2929 0d0a 2020 2020 2020 2020  iev]))..        
+00064970: 2020 2020 7365 6c66 2e74 635f 7368 6966      self.tc_shif
+00064980: 7432 2e73 6574 5465 7874 2827 5920 7368  t2.setText('Y sh
+00064990: 6966 743a 207b 303a 352e 3266 7d20 7069  ift: {0:5.2f} pi
+000649a0: 7865 6c73 272e 666f 726d 6174 2873 656c  xels'.format(sel
+000649b0: 662e 7973 6869 6674 735b 7365 6c66 2e69  f.yshifts[self.i
+000649c0: 6576 5d29 290d 0a20 2020 2020 2020 2065  ev]))..        e
+000649d0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+000649e0: 2020 7365 6c66 2e74 635f 7368 6966 7431    self.tc_shift1
+000649f0: 2e73 6574 5465 7874 2827 5820 7368 6966  .setText('X shif
+00064a00: 743a 207b 303a 352e 3266 7d20 7069 7865  t: {0:5.2f} pixe
+00064a10: 6c73 272e 666f 726d 6174 2873 656c 662e  ls'.format(self.
+00064a20: 7873 6869 6674 735b 7365 6c66 2e69 6576  xshifts[self.iev
+00064a30: 2c73 656c 662e 6974 6865 7461 5d29 290d  ,self.itheta])).
+00064a40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00064a50: 662e 7463 5f73 6869 6674 322e 7365 7454  f.tc_shift2.setT
+00064a60: 6578 7428 2759 2073 6869 6674 3a20 7b30  ext('Y shift: {0
+00064a70: 3a35 2e32 667d 2070 6978 656c 7327 2e66  :5.2f} pixels'.f
+00064a80: 6f72 6d61 7428 7365 6c66 2e79 7368 6966  ormat(self.yshif
+00064a90: 7473 5b73 656c 662e 6965 762c 7365 6c66  ts[self.iev,self
+00064aa0: 2e69 7468 6574 615d 2929 0d0a 0d0a 0d0a  .itheta]))......
+00064ab0: 2020 2020 2020 2020 6966 2028 7365 6c66          if (self
+00064ac0: 2e6d 616e 5f61 6c69 676e 203d 3d20 3229  .man_align == 2)
+00064ad0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00064ae0: 6620 7365 6c66 2e63 6f6d 2e73 7461 636b  f self.com.stack
+00064af0: 5f34 6420 3d3d 2030 3a0d 0a20 2020 2020  _4d == 0:..     
+00064b00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00064b10: 7465 7874 6374 726c 5f6d 7331 2e73 6574  textctrl_ms1.set
+00064b20: 5465 7874 2827 5820 6d61 6e75 616c 2073  Text('X manual s
+00064b30: 6869 6674 3a20 207b 303a 352e 3266 7d20  hift:  {0:5.2f} 
+00064b40: 2070 6978 656c 7327 2e66 6f72 6d61 7428   pixels'.format(
+00064b50: 7365 6c66 2e6d 616e 5f78 735b 7365 6c66  self.man_xs[self
+00064b60: 2e69 6576 5d29 290d 0a20 2020 2020 2020  .iev]))..       
+00064b70: 2020 2020 2020 2020 2073 656c 662e 7465           self.te
+00064b80: 7874 6374 726c 5f6d 7332 2e73 6574 5465  xtctrl_ms2.setTe
+00064b90: 7874 2827 5920 6d61 6e75 616c 2073 6869  xt('Y manual shi
+00064ba0: 6674 3a20 207b 303a 352e 3266 7d20 2070  ft:  {0:5.2f}  p
+00064bb0: 6978 656c 7327 2e66 6f72 6d61 7428 7365  ixels'.format(se
+00064bc0: 6c66 2e6d 616e 5f79 735b 7365 6c66 2e69  lf.man_ys[self.i
+00064bd0: 6576 5d29 290d 0a20 2020 2020 2020 2020  ev]))..         
+00064be0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00064bf0: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
+00064c00: 6578 7463 7472 6c5f 6d73 312e 7365 7454  extctrl_ms1.setT
+00064c10: 6578 7428 2758 206d 616e 7561 6c20 7368  ext('X manual sh
+00064c20: 6966 743a 2020 7b30 3a35 2e32 667d 2020  ift:  {0:5.2f}  
+00064c30: 7069 7865 6c73 272e 666f 726d 6174 2873  pixels'.format(s
+00064c40: 656c 662e 6d61 6e5f 7873 5b73 656c 662e  elf.man_xs[self.
+00064c50: 6965 762c 7365 6c66 2e69 7468 6574 615d  iev,self.itheta]
+00064c60: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00064c70: 2020 2020 7365 6c66 2e74 6578 7463 7472      self.textctr
+00064c80: 6c5f 6d73 322e 7365 7454 6578 7428 2759  l_ms2.setText('Y
+00064c90: 206d 616e 7561 6c20 7368 6966 743a 2020   manual shift:  
+00064ca0: 7b30 3a35 2e32 667d 2020 7069 7865 6c73  {0:5.2f}  pixels
+00064cb0: 272e 666f 726d 6174 2873 656c 662e 6d61  '.format(self.ma
+00064cc0: 6e5f 7973 5b73 656c 662e 6965 762c 7365  n_ys[self.iev,se
+00064cd0: 6c66 2e69 7468 6574 615d 2929 0d0a 0d0a  lf.itheta]))....
+00064ce0: 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d  ....#-----------
+00064cf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00064d00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00064d10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00064d20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020  -----------..   
+00064d30: 2064 6566 204f 6e53 6372 6f6c 6c45 6e67   def OnScrollEng
+00064d40: 2873 656c 662c 2076 616c 7565 293a 0d0a  (self, value):..
+00064d50: 2020 2020 2020 2020 7365 6c66 2e69 6576          self.iev
+00064d60: 203d 2076 616c 7565 0d0a 0d0a 2020 2020   = value....    
+00064d70: 2020 2020 7365 6c66 2e53 686f 7749 6d61      self.ShowIma
+00064d80: 6765 2829 0d0a 0d0a 232d 2d2d 2d2d 2d2d  ge()....#-------
+00064d90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00064da0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00064db0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00064dc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
+00064dd0: 0a20 2020 2064 6566 204f 6e53 6372 6f6c  .    def OnScrol
+00064de0: 6c54 6865 7461 2873 656c 662c 2076 616c  lTheta(self, val
+00064df0: 7565 293a 0d0a 2020 2020 2020 2020 7365  ue):..        se
+00064e00: 6c66 2e69 7468 6574 6120 3d20 7661 6c75  lf.itheta = valu
+00064e10: 650d 0a0d 0a20 2020 2020 2020 2073 656c  e....        sel
+00064e20: 662e 7463 5f69 6d61 6765 7468 6574 612e  f.tc_imagetheta.
+00064e30: 7365 7454 6578 7428 2234 4420 4461 7461  setText("4D Data
+00064e40: 2041 6e67 6c65 3a20 222b 7374 7228 7365   Angle: "+str(se
+00064e50: 6c66 2e73 7461 636b 2e74 6865 7461 5b73  lf.stack.theta[s
+00064e60: 656c 662e 6974 6865 7461 5d29 290d 0a0d  elf.itheta]))...
+00064e70: 0a20 2020 2020 2020 2073 656c 662e 5368  .        self.Sh
+00064e80: 6f77 496d 6167 6528 290d 0a0d 0a23 2d2d  owImage()....#--
+00064e90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00064ea0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00064eb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00064ec0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00064ed0: 2d2d 2d2d 0d0a 2020 2020 6465 6620 5365  ----..    def Se
+00064ee0: 7452 6566 496d 6167 6528 7365 6c66 293a  tRefImage(self):
+00064ef0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00064f00: 2e72 6566 5f69 6d61 6765 5f69 6e64 6578  .ref_image_index
+00064f10: 203d 2073 656c 662e 6965 760d 0a20 2020   = self.iev..   
+00064f20: 2020 2020 2073 656c 662e 7265 665f 696d       self.ref_im
+00064f30: 6167 655f 696e 6465 785f 7468 6574 6120  age_index_theta 
+00064f40: 3d20 7365 6c66 2e69 7468 6574 610d 0a0d  = self.itheta...
+00064f50: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00064f60: 2e63 6f6d 2e73 7461 636b 5f34 6420 3d3d  .com.stack_4d ==
+00064f70: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+00064f80: 2073 656c 662e 7265 665f 696d 6167 6520   self.ref_image 
+00064f90: 3d20 7365 6c66 2e61 6c69 676e 6564 5f73  = self.aligned_s
+00064fa0: 7461 636b 5b3a 2c3a 2c73 656c 662e 6965  tack[:,:,self.ie
+00064fb0: 765d 2e63 6f70 7928 290d 0a20 2020 2020  v].copy()..     
+00064fc0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00064fd0: 2020 2020 2020 7365 6c66 2e72 6566 5f69        self.ref_i
+00064fe0: 6d61 6765 203d 2073 656c 662e 616c 6967  mage = self.alig
+00064ff0: 6e65 645f 7374 6163 6b5b 3a2c 3a2c 7365  ned_stack[:,:,se
+00065000: 6c66 2e69 6576 2c73 656c 662e 6974 6865  lf.iev,self.ithe
+00065010: 7461 5d2e 636f 7079 2829 0d0a 0d0a 0d0a  ta].copy()......
+00065020: 2020 2020 2020 2020 7365 6c66 2e53 686f          self.Sho
+00065030: 7752 6566 496d 6167 6528 290d 0a20 2020  wRefImage()..   
+00065040: 2020 2020 2073 656c 662e 6861 7665 5f72       self.have_r
+00065050: 6566 5f69 6d61 6765 203d 2031 0d0a 0d0a  ef_image = 1....
+00065060: 2020 2020 2020 2020 7365 6c66 2e55 7064          self.Upd
+00065070: 6174 6557 6964 6765 7473 2829 0d0a 0d0a  ateWidgets()....
+00065080: 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ..#-------------
+00065090: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000650a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000650b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000650c0: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
+000650d0: 6566 2053 6176 6552 6566 496d 6167 6528  ef SaveRefImage(
+000650e0: 7365 6c66 293a 0d0a 0d0a 2020 2020 2020  self):....      
+000650f0: 2020 7769 6c64 6361 7264 203d 2022 5449    wildcard = "TI
+00065100: 4646 2046 696c 6520 282a 2e74 6966 293b  FF File (*.tif);
+00065110: 3b22 0d0a 0d0a 2020 2020 2020 2020 6669  ;"....        fi
+00065120: 6c65 4e61 6d65 2c20 5f66 696c 7465 7220  leName, _filter 
+00065130: 3d20 5174 5769 6467 6574 732e 5146 696c  = QtWidgets.QFil
+00065140: 6544 6961 6c6f 672e 6765 7453 6176 6546  eDialog.getSaveF
+00065150: 696c 654e 616d 6528 7365 6c66 2c20 2753  ileName(self, 'S
+00065160: 6176 6520 5265 6665 7265 6e63 6520 496d  ave Reference Im
+00065170: 6167 6527 2c20 2727 2c20 7769 6c64 6361  age', '', wildca
+00065180: 7264 290d 0a0d 0a20 2020 2020 2020 2066  rd)....        f
+00065190: 696c 654e 616d 6520 3d20 7374 7228 6669  ileName = str(fi
+000651a0: 6c65 4e61 6d65 290d 0a20 2020 2020 2020  leName)..       
+000651b0: 2069 6620 6669 6c65 4e61 6d65 203d 3d20   if fileName == 
+000651c0: 2727 3a0d 0a20 2020 2020 2020 2020 2020  '':..           
+000651d0: 2072 6574 7572 6e0d 0a0d 0a0d 0a20 2020   return......   
+000651e0: 2020 2020 2069 6d67 3120 3d20 496d 6167       img1 = Imag
+000651f0: 652e 6672 6f6d 6172 7261 7928 7365 6c66  e.fromarray(self
+00065200: 2e72 6566 5f69 6d61 6765 290d 0a20 2020  .ref_image)..   
+00065210: 2020 2020 2069 6d67 312e 7361 7665 2866       img1.save(f
+00065220: 696c 654e 616d 6529 0d0a 0d0a 0d0a 232d  ileName)......#-
+00065230: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00065240: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00065250: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00065260: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00065270: 2d2d 2d2d 2d0d 0a20 2020 2064 6566 204c  -----..    def L
+00065280: 6f61 6452 6566 496d 6167 6528 7365 6c66  oadRefImage(self
+00065290: 293a 0d0a 0d0a 2020 2020 2020 2020 7769  ):....        wi
+000652a0: 6c64 6361 7264 203d 2022 5449 4646 2046  ldcard = "TIFF F
+000652b0: 696c 6520 282a 2e74 6966 293b 3b22 0d0a  ile (*.tif);;"..
+000652c0: 0d0a 2020 2020 2020 2020 6669 6c65 4e61  ..        fileNa
+000652d0: 6d65 2c20 5f66 696c 7465 7220 3d20 5174  me, _filter = Qt
+000652e0: 5769 6467 6574 732e 5146 696c 6544 6961  Widgets.QFileDia
+000652f0: 6c6f 672e 6765 744f 7065 6e46 696c 654e  log.getOpenFileN
+00065300: 616d 6528 7365 6c66 2c20 2753 6176 6520  ame(self, 'Save 
+00065310: 5265 6665 7265 6e63 6520 496d 6167 6527  Reference Image'
+00065320: 2c20 2727 2c20 7769 6c64 6361 7264 290d  , '', wildcard).
+00065330: 0a0d 0a20 2020 2020 2020 2066 696c 654e  ...        fileN
+00065340: 616d 6520 3d20 7374 7228 6669 6c65 4e61  ame = str(fileNa
+00065350: 6d65 290d 0a20 2020 2020 2020 2069 6620  me)..        if 
+00065360: 6669 6c65 4e61 6d65 203d 3d20 2727 3a0d  fileName == '':.
+00065370: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00065380: 7572 6e0d 0a0d 0a20 2020 2020 2020 2066  urn....        f
+00065390: 726f 6d20 5049 4c20 696d 706f 7274 2049  rom PIL import I
+000653a0: 6d61 6765 0d0a 2020 2020 2020 2020 696d  mage..        im
+000653b0: 6720 3d20 496d 6167 652e 6f70 656e 2866  g = Image.open(f
+000653c0: 696c 654e 616d 6529 0d0a 0d0a 2020 2020  ileName)....    
+000653d0: 2020 2020 7365 6c66 2e72 6566 5f69 6d61      self.ref_ima
+000653e0: 6765 203d 206e 702e 6172 7261 7928 2869  ge = np.array((i
+000653f0: 6d67 2929 0d0a 0d0a 2020 2020 2020 2020  mg))....        
+00065400: 7365 6c66 2e53 686f 7752 6566 496d 6167  self.ShowRefImag
+00065410: 6528 290d 0a20 2020 2020 2020 2073 656c  e()..        sel
+00065420: 662e 6861 7665 5f72 6566 5f69 6d61 6765  f.have_ref_image
+00065430: 203d 2031 0d0a 0d0a 2020 2020 2020 2020   = 1....        
+00065440: 7365 6c66 2e55 7064 6174 6557 6964 6765  self.UpdateWidge
+00065450: 7473 2829 0d0a 0d0a 232d 2d2d 2d2d 2d2d  ts()....#-------
+00065460: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00065470: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00065480: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00065490: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
+000654a0: 0a20 2020 2064 6566 2053 686f 7752 6566  .    def ShowRef
+000654b0: 496d 6167 6528 7365 6c66 293a 0d0a 0d0a  Image(self):....
+000654c0: 2020 2020 2020 2020 6669 6720 3d20 7365          fig = se
+000654d0: 6c66 2e72 6566 696d 6766 6967 0d0a 2020  lf.refimgfig..  
+000654e0: 2020 2020 2020 6669 672e 636c 6628 290d        fig.clf().
+000654f0: 0a20 2020 2020 2020 2066 6967 2e61 6464  .        fig.add
+00065500: 5f61 7865 7328 2828 302e 302c 302e 302c  _axes(((0.0,0.0,
+00065510: 312e 302c 312e 3029 2929 0d0a 2020 2020  1.0,1.0)))..    
+00065520: 2020 2020 6178 6573 203d 2066 6967 2e67      axes = fig.g
+00065530: 6361 2829 0d0a 0d0a 0d0a 2020 2020 2020  ca()......      
+00065540: 2020 5f69 6d20 3d20 6178 6573 2e69 6d73    _im = axes.ims
+00065550: 686f 7728 6e70 2e72 6f74 3930 2873 656c  how(np.rot90(sel
+00065560: 662e 7265 665f 696d 6167 6529 2c20 636d  f.ref_image), cm
+00065570: 6170 3d6d 6174 706c 6f74 6c69 622e 636d  ap=matplotlib.cm
+00065580: 2e67 6574 5f63 6d61 7028 2767 7261 7927  .get_cmap('gray'
+00065590: 2929 0d0a 0d0a 2020 2020 2020 2020 6966  ))....        if
+000655a0: 2028 7365 6c66 2e73 7562 7265 6769 6f6e   (self.subregion
+000655b0: 203d 3d20 3129 3a0d 0a0d 0a20 2020 2020   == 1):....     
+000655c0: 2020 2020 2020 2066 726f 6d20 6d61 7470         from matp
+000655d0: 6c6f 746c 6962 2e70 6174 6820 696d 706f  lotlib.path impo
+000655e0: 7274 2050 6174 680d 0a20 2020 2020 2020  rt Path..       
+000655f0: 2020 2020 2069 6d70 6f72 7420 6d61 7470       import matp
+00065600: 6c6f 746c 6962 2e70 6174 6368 6573 2061  lotlib.patches a
+00065610: 7320 7061 7463 6865 730d 0a0d 0a20 2020  s patches....   
+00065620: 2020 2020 2020 2020 2076 6572 7473 203d           verts =
+00065630: 205b 0d0a 2020 2020 2020 2020 2020 2020   [..            
+00065640: 2020 2020 2020 2020 2028 7365 6c66 2e73           (self.s
+00065650: 725f 7831 2c20 7365 6c66 2e73 725f 7931  r_x1, self.sr_y1
+00065660: 292c 2023 206c 6566 742c 2062 6f74 746f  ), # left, botto
+00065670: 6d0d 0a20 2020 2020 2020 2020 2020 2020  m..             
+00065680: 2020 2020 2020 2020 2873 656c 662e 7372          (self.sr
+00065690: 5f78 312c 2073 656c 662e 7372 5f79 3229  _x1, self.sr_y2)
+000656a0: 2c20 2320 6c65 6674 2c20 746f 700d 0a20  , # left, top.. 
+000656b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000656c0: 2020 2020 2873 656c 662e 7372 5f78 322c      (self.sr_x2,
+000656d0: 2073 656c 662e 7372 5f79 3229 2c20 2320   self.sr_y2), # 
+000656e0: 7269 6768 742c 2074 6f70 0d0a 2020 2020  right, top..    
+000656f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065700: 2028 7365 6c66 2e73 725f 7832 2c20 7365   (self.sr_x2, se
+00065710: 6c66 2e73 725f 7931 292c 2023 2072 6967  lf.sr_y1), # rig
+00065720: 6874 2c20 626f 7474 6f6d 0d0a 2020 2020  ht, bottom..    
+00065730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065740: 2028 7365 6c66 2e73 725f 7831 2c20 7365   (self.sr_x1, se
+00065750: 6c66 2e73 725f 7931 292c 2023 2069 676e  lf.sr_y1), # ign
+00065760: 6f72 6564 0d0a 2020 2020 2020 2020 2020  ored..          
+00065770: 2020 2020 2020 2020 2020 205d 0d0a 0d0a             ]....
+00065780: 2020 2020 2020 2020 2020 2020 636f 6465              code
+00065790: 7320 3d20 5b50 6174 682e 4d4f 5645 544f  s = [Path.MOVETO
+000657a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000657b0: 2020 2020 2020 2020 5061 7468 2e4c 494e          Path.LIN
+000657c0: 4554 4f2c 0d0a 2020 2020 2020 2020 2020  ETO,..          
+000657d0: 2020 2020 2020 2020 2020 2050 6174 682e             Path.
+000657e0: 4c49 4e45 544f 2c0d 0a20 2020 2020 2020  LINETO,..       
+000657f0: 2020 2020 2020 2020 2020 2020 2020 5061                Pa
+00065800: 7468 2e4c 494e 4554 4f2c 0d0a 2020 2020  th.LINETO,..    
+00065810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065820: 2050 6174 682e 434c 4f53 4550 4f4c 592c   Path.CLOSEPOLY,
+00065830: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00065840: 2020 2020 2020 205d 0d0a 0d0a 2020 2020         ]....    
+00065850: 2020 2020 2020 2020 7061 7468 203d 2050          path = P
+00065860: 6174 6828 7665 7274 732c 2063 6f64 6573  ath(verts, codes
+00065870: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00065880: 2073 656c 662e 7061 7463 6820 3d20 7061   self.patch = pa
+00065890: 7463 6865 732e 5061 7468 5061 7463 6828  tches.PathPatch(
+000658a0: 7061 7468 2c20 6661 6365 636f 6c6f 723d  path, facecolor=
+000658b0: 2772 6564 2729 0d0a 2020 2020 2020 2020  'red')..        
+000658c0: 2020 2020 7365 6c66 2e70 6174 6368 2e73      self.patch.s
+000658d0: 6574 5f61 6c70 6861 2830 2e33 290d 0a20  et_alpha(0.3).. 
+000658e0: 2020 2020 2020 2020 2020 2061 7865 732e             axes.
+000658f0: 6164 645f 7061 7463 6828 7365 6c66 2e70  add_patch(self.p
+00065900: 6174 6368 290d 0a0d 0a20 2020 2020 2020  atch)....       
+00065910: 2069 6620 7365 6c66 2e6d 616e 5f61 6c69   if self.man_ali
+00065920: 676e 203e 2030 3a0d 0a20 2020 2020 2020  gn > 0:..       
+00065930: 2020 2020 206c 783d 6d61 7470 6c6f 746c       lx=matplotl
+00065940: 6962 2e6c 696e 6573 2e4c 696e 6532 4428  ib.lines.Line2D(
+00065950: 5b73 656c 662e 6d61 6e5f 7872 6566 2c73  [self.man_xref,s
+00065960: 656c 662e 6d61 6e5f 7872 6566 5d2c 205b  elf.man_xref], [
+00065970: 302c 7365 6c66 2e73 7461 636b 2e6e 5f72  0,self.stack.n_r
+00065980: 6f77 735d 2c63 6f6c 6f72 3d27 6772 6565  ows],color='gree
+00065990: 6e27 290d 0a20 2020 2020 2020 2020 2020  n')..           
+000659a0: 206c 793d 6d61 7470 6c6f 746c 6962 2e6c   ly=matplotlib.l
+000659b0: 696e 6573 2e4c 696e 6532 4428 5b30 2c73  ines.Line2D([0,s
+000659c0: 656c 662e 7374 6163 6b2e 6e5f 636f 6c73  elf.stack.n_cols
+000659d0: 5d2c 205b 7365 6c66 2e6d 616e 5f79 7265  ], [self.man_yre
+000659e0: 662c 7365 6c66 2e6d 616e 5f79 7265 665d  f,self.man_yref]
+000659f0: 202c 636f 6c6f 723d 2767 7265 656e 2729   ,color='green')
+00065a00: 0d0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
+00065a10: 6573 2e61 6464 5f6c 696e 6528 6c78 290d  es.add_line(lx).
+00065a20: 0a20 2020 2020 2020 2020 2020 2061 7865  .            axe
+00065a30: 732e 6164 645f 6c69 6e65 286c 7929 0d0a  s.add_line(ly)..
+00065a40: 0d0a 2020 2020 2020 2020 6178 6573 2e61  ..        axes.a
+00065a50: 7869 7328 226f 6666 2229 0d0a 0d0a 2020  xis("off")....  
+00065a60: 2020 2020 2020 7365 6c66 2e52 6566 496d        self.RefIm
+00065a70: 6167 6550 616e 656c 2e64 7261 7728 290d  agePanel.draw().
+00065a80: 0a0d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d  .....#----------
+00065a90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00065aa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00065ab0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00065ac0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020  ------------..  
+00065ad0: 2020 6465 6620 4f6e 7262 5f61 7574 6f6d    def Onrb_autom
+00065ae0: 616e 7561 6c28 7365 6c66 2c20 656e 6162  anual(self, enab
+00065af0: 6c65 6429 3a0d 0a0d 0a20 2020 2020 2020  led):....       
+00065b00: 2073 7461 7465 203d 2065 6e61 626c 6564   state = enabled
+00065b10: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6966  ......        if
+00065b20: 2073 7461 7465 3a0d 0a20 2020 2020 2020   state:..       
+00065b30: 2020 2020 2073 656c 662e 6175 746f 203d       self.auto =
+00065b40: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
+00065b50: 2020 2073 656c 662e 6d61 6e5f 616c 6967     self.man_alig
+00065b60: 6e20 3d20 300d 0a20 2020 2020 2020 2065  n = 0..        e
+00065b70: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00065b80: 2020 7365 6c66 2e61 7574 6f20 3d20 4661    self.auto = Fa
+00065b90: 6c73 650d 0a0d 0a0d 0a0d 0a20 2020 2020  lse........     
+00065ba0: 2020 2069 6620 7365 6c66 2e63 6f6d 2e73     if self.com.s
+00065bb0: 7461 636b 5f34 6420 3d3d 2030 3a0d 0a20  tack_4d == 0:.. 
+00065bc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00065bd0: 616c 6967 6e65 645f 7374 6163 6b20 3d20  aligned_stack = 
+00065be0: 7365 6c66 2e73 7461 636b 2e61 6273 6461  self.stack.absda
+00065bf0: 7461 2e63 6f70 7928 290d 0a20 2020 2020  ta.copy()..     
+00065c00: 2020 2020 2020 2073 656c 662e 6d61 6e5f         self.man_
+00065c10: 7873 203d 206e 702e 7a65 726f 7328 2873  xs = np.zeros((s
+00065c20: 656c 662e 7374 6163 6b2e 6e5f 6576 2929  elf.stack.n_ev))
+00065c30: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00065c40: 6c66 2e6d 616e 5f79 7320 3d20 6e70 2e7a  lf.man_ys = np.z
+00065c50: 6572 6f73 2828 7365 6c66 2e73 7461 636b  eros((self.stack
+00065c60: 2e6e 5f65 7629 290d 0a20 2020 2020 2020  .n_ev))..       
+00065c70: 2020 2020 2073 656c 662e 7873 6869 6674       self.xshift
+00065c80: 7320 3d20 6e70 2e7a 6572 6f73 2828 7365  s = np.zeros((se
+00065c90: 6c66 2e73 7461 636b 2e6e 5f65 7629 290d  lf.stack.n_ev)).
+00065ca0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00065cb0: 662e 7973 6869 6674 7320 3d20 6e70 2e7a  f.yshifts = np.z
+00065cc0: 6572 6f73 2828 7365 6c66 2e73 7461 636b  eros((self.stack
+00065cd0: 2e6e 5f65 7629 290d 0a20 2020 2020 2020  .n_ev))..       
+00065ce0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00065cf0: 2020 2020 7365 6c66 2e61 6c69 676e 6564      self.aligned
+00065d00: 5f73 7461 636b 203d 2073 656c 662e 7374  _stack = self.st
+00065d10: 6163 6b2e 7374 6163 6b34 442e 636f 7079  ack.stack4D.copy
+00065d20: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00065d30: 7365 6c66 2e6d 616e 5f78 7320 3d20 6e70  self.man_xs = np
+00065d40: 2e7a 6572 6f73 2828 7365 6c66 2e73 7461  .zeros((self.sta
+00065d50: 636b 2e6e 5f65 762c 7365 6c66 2e73 7461  ck.n_ev,self.sta
+00065d60: 636b 2e6e 5f74 6865 7461 2929 0d0a 2020  ck.n_theta))..  
+00065d70: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+00065d80: 616e 5f79 7320 3d20 6e70 2e7a 6572 6f73  an_ys = np.zeros
+00065d90: 2828 7365 6c66 2e73 7461 636b 2e6e 5f65  ((self.stack.n_e
+00065da0: 762c 7365 6c66 2e73 7461 636b 2e6e 5f74  v,self.stack.n_t
+00065db0: 6865 7461 2929 0d0a 2020 2020 2020 2020  heta))..        
+00065dc0: 2020 2020 7365 6c66 2e78 7368 6966 7473      self.xshifts
+00065dd0: 203d 206e 702e 7a65 726f 7328 2873 656c   = np.zeros((sel
+00065de0: 662e 7374 6163 6b2e 6e5f 6576 2c73 656c  f.stack.n_ev,sel
+00065df0: 662e 7374 6163 6b2e 6e5f 7468 6574 6129  f.stack.n_theta)
+00065e00: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00065e10: 656c 662e 7973 6869 6674 7320 3d20 6e70  elf.yshifts = np
+00065e20: 2e7a 6572 6f73 2828 7365 6c66 2e73 7461  .zeros((self.sta
+00065e30: 636b 2e6e 5f65 762c 7365 6c66 2e73 7461  ck.n_ev,self.sta
+00065e40: 636b 2e6e 5f74 6865 7461 2929 0d0a 0d0a  ck.n_theta))....
+00065e50: 0d0a 0d0a 2020 2020 2020 2020 6966 2073  ....        if s
+00065e60: 656c 662e 6861 7665 5f72 6566 5f69 6d61  elf.have_ref_ima
+00065e70: 6765 203d 3d20 313a 0d0a 2020 2020 2020  ge == 1:..      
+00065e80: 2020 2020 2020 6669 6720 3d20 7365 6c66        fig = self
+00065e90: 2e73 6869 6674 7366 6967 0d0a 2020 2020  .shiftsfig..    
+00065ea0: 2020 2020 2020 2020 6669 672e 636c 6628          fig.clf(
+00065eb0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00065ec0: 656c 662e 5368 6966 7473 5061 6e65 6c2e  elf.ShiftsPanel.
+00065ed0: 6472 6177 2829 0d0a 0d0a 2020 2020 2020  draw()....      
+00065ee0: 2020 2020 2020 6669 6720 3d20 7365 6c66        fig = self
+00065ef0: 2e63 7363 6f72 7266 6967 0d0a 2020 2020  .cscorrfig..    
+00065f00: 2020 2020 2020 2020 6669 672e 636c 6628          fig.clf(
+00065f10: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00065f20: 656c 662e 4373 636f 7272 5061 6e65 6c2e  elf.CscorrPanel.
+00065f30: 6472 6177 2829 0d0a 0d0a 2020 2020 2020  draw()....      
+00065f40: 2020 2020 2020 7365 6c66 2e53 686f 7749        self.ShowI
+00065f50: 6d61 6765 2829 0d0a 2020 2020 2020 2020  mage()..        
+00065f60: 2020 2020 7365 6c66 2e53 686f 7752 6566      self.ShowRef
+00065f70: 496d 6167 6528 290d 0a0d 0a20 2020 2020  Image()....     
+00065f80: 2020 2073 656c 662e 5570 6461 7465 5769     self.UpdateWi
+00065f90: 6467 6574 7328 290d 0a0d 0a23 2d2d 2d2d  dgets()....#----
+00065fa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00065fb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00065fc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00065fd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00065fe0: 2d2d 0d0a 2020 2020 6465 6620 5368 6f77  --..    def Show
+00065ff0: 4372 6f73 7343 6f72 7265 6c61 7469 6f6e  CrossCorrelation
+00066000: 2873 656c 662c 2063 636f 7272 2c20 7873  (self, ccorr, xs
+00066010: 6869 6674 2c20 7973 6869 6674 293a 0d0a  hift, yshift):..
+00066020: 0d0a 2020 2020 2020 2020 6669 6720 3d20  ..        fig = 
+00066030: 7365 6c66 2e63 7363 6f72 7266 6967 0d0a  self.cscorrfig..
+00066040: 0d0a 2020 2020 2020 2020 6669 672e 636c  ..        fig.cl
+00066050: 6628 290d 0a20 2020 2020 2020 2066 6967  f()..        fig
+00066060: 2e61 6464 5f61 7865 7328 2828 302e 302c  .add_axes(((0.0,
+00066070: 302e 302c 312e 302c 312e 3029 2929 0d0a  0.0,1.0,1.0)))..
+00066080: 2020 2020 2020 2020 6178 6573 203d 2066          axes = f
+00066090: 6967 2e67 6361 2829 0d0a 0d0a 2020 2020  ig.gca()....    
+000660a0: 2020 2020 696d 203d 2061 7865 732e 696d      im = axes.im
+000660b0: 7368 6f77 286e 702e 726f 7439 3028 6363  show(np.rot90(cc
+000660c0: 6f72 7229 2c20 636d 6170 3d6d 6174 706c  orr), cmap=matpl
+000660d0: 6f74 6c69 622e 636d 2e67 6574 5f63 6d61  otlib.cm.get_cma
+000660e0: 7028 2767 7261 7927 2929 0d0a 0d0a 2020  p('gray'))....  
+000660f0: 2020 2020 2020 6e78 203d 2063 636f 7272        nx = ccorr
+00066100: 2e73 6861 7065 5b30 5d0d 0a20 2020 2020  .shape[0]..     
+00066110: 2020 206e 7920 3d20 6363 6f72 722e 7368     ny = ccorr.sh
+00066120: 6170 655b 315d 0d0a 2020 2020 2020 2020  ape[1]..        
+00066130: 7863 656e 7465 7220 3d20 7873 6869 6674  xcenter = xshift
+00066140: 202b 2066 6c6f 6174 286e 7829 2f32 2e30   + float(nx)/2.0
+00066150: 0d0a 2020 2020 2020 2020 7963 656e 7465  ..        ycente
+00066160: 7220 3d20 7973 6869 6674 202b 2066 6c6f  r = yshift + flo
+00066170: 6174 286e 7929 2f32 2e30 0d0a 0d0a 2020  at(ny)/2.0....  
+00066180: 2020 2020 2020 786c 203d 2078 6365 6e74        xl = xcent
+00066190: 6572 2d31 300d 0a20 2020 2020 2020 2069  er-10..        i
+000661a0: 6620 786c 3c30 3a0d 0a20 2020 2020 2020  f xl<0:..       
+000661b0: 2020 2020 2078 6c3d 300d 0a20 2020 2020       xl=0..     
+000661c0: 2020 2078 7220 3d20 7863 656e 7465 722b     xr = xcenter+
+000661d0: 3130 0d0a 2020 2020 2020 2020 6966 2078  10..        if x
+000661e0: 723e 6e78 2d31 3a0d 0a20 2020 2020 2020  r>nx-1:..       
+000661f0: 2020 2020 2078 723d 6e78 2d31 0d0a 2020       xr=nx-1..  
+00066200: 2020 2020 2020 796c 203d 2079 6365 6e74        yl = ycent
+00066210: 6572 2d31 300d 0a20 2020 2020 2020 2069  er-10..        i
+00066220: 6620 796c 3c30 3a0d 0a20 2020 2020 2020  f yl<0:..       
+00066230: 2020 2020 2079 6c3d 300d 0a20 2020 2020       yl=0..     
+00066240: 2020 2079 7220 3d20 7963 656e 7465 722b     yr = ycenter+
+00066250: 3130 0d0a 2020 2020 2020 2020 6966 2079  10..        if y
+00066260: 723e 6e79 2d31 3a0d 0a20 2020 2020 2020  r>ny-1:..       
+00066270: 2020 2020 2079 723d 6e79 2d31 0d0a 0d0a       yr=ny-1....
+00066280: 2020 2020 2020 2020 6c78 3d6d 6174 706c          lx=matpl
+00066290: 6f74 6c69 622e 6c69 6e65 732e 4c69 6e65  otlib.lines.Line
+000662a0: 3244 285b 786c 2c78 725d 2c20 5b79 6365  2D([xl,xr], [yce
+000662b0: 6e74 6572 2c79 6365 6e74 6572 5d2c 2063  nter,ycenter], c
+000662c0: 6f6c 6f72 3d27 6772 6565 6e27 290d 0a20  olor='green').. 
+000662d0: 2020 2020 2020 206c 793d 6d61 7470 6c6f         ly=matplo
+000662e0: 746c 6962 2e6c 696e 6573 2e4c 696e 6532  tlib.lines.Line2
+000662f0: 4428 5b78 6365 6e74 6572 2c78 6365 6e74  D([xcenter,xcent
+00066300: 6572 5d2c 205b 796c 2c79 725d 2c20 636f  er], [yl,yr], co
+00066310: 6c6f 723d 2767 7265 656e 2729 0d0a 2020  lor='green')..  
+00066320: 2020 2020 2020 6178 6573 2e61 6464 5f6c        axes.add_l
+00066330: 696e 6528 6c78 290d 0a20 2020 2020 2020  ine(lx)..       
+00066340: 2061 7865 732e 6164 645f 6c69 6e65 286c   axes.add_line(l
+00066350: 7929 0d0a 0d0a 0d0a 2020 2020 2020 2020  y)......        
+00066360: 6178 6573 2e61 7869 7328 226f 6666 2229  axes.axis("off")
+00066370: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00066380: 2e43 7363 6f72 7250 616e 656c 2e64 7261  .CscorrPanel.dra
+00066390: 7728 290d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d  w()....#--------
+000663a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000663b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000663c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000663d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a  --------------..
+000663e0: 2020 2020 6465 6620 4f6e 5368 6f77 4343      def OnShowCC
+000663f0: 6f72 7228 7365 6c66 2c20 7374 6174 6529  orr(self, state)
+00066400: 3a0d 0a0d 0a20 2020 2020 2020 2069 6620  :....        if 
+00066410: 7374 6174 6520 3d3d 2051 7443 6f72 652e  state == QtCore.
+00066420: 5174 2e43 6865 636b 6564 3a0d 0a20 2020  Qt.Checked:..   
+00066430: 2020 2020 2020 2020 2073 656c 662e 7368           self.sh
+00066440: 6f77 6363 6f72 7220 3d20 310d 0a20 2020  owccorr = 1..   
+00066450: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00066460: 2020 2020 2020 2020 7365 6c66 2e73 686f          self.sho
+00066470: 7763 636f 7272 203d 2030 0d0a 0d0a 0d0a  wccorr = 0......
+00066480: 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  #---------------
+00066490: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000664a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000664b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000664c0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6566  -------..    def
+000664d0: 204f 6e45 6467 6545 2873 656c 662c 2073   OnEdgeE(self, s
+000664e0: 7461 7465 293a 0d0a 0d0a 2020 2020 2020  tate):....      
+000664f0: 2020 6966 2073 7461 7465 203d 3d20 5174    if state == Qt
+00066500: 436f 7265 2e51 742e 4368 6563 6b65 643a  Core.Qt.Checked:
+00066510: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00066520: 6c66 2e65 6467 6565 203d 2031 0d0a 2020  lf.edgee = 1..  
+00066530: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
+00066540: 625f 736f 6265 6c2e 7365 7445 6e61 626c  b_sobel.setEnabl
+00066550: 6564 2854 7275 6529 0d0a 2020 2020 2020  ed(True)..      
+00066560: 2020 2020 2020 7365 6c66 2e72 625f 7072        self.rb_pr
+00066570: 6577 6974 742e 7365 7445 6e61 626c 6564  ewitt.setEnabled
+00066580: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
+00066590: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+000665a0: 2020 2073 656c 662e 6564 6765 6520 3d20     self.edgee = 
+000665b0: 300d 0a20 2020 2020 2020 2020 2020 2073  0..            s
+000665c0: 656c 662e 7262 5f73 6f62 656c 2e73 6574  elf.rb_sobel.set
+000665d0: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
+000665e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000665f0: 2e72 625f 7072 6577 6974 742e 7365 7445  .rb_prewitt.setE
+00066600: 6e61 626c 6564 2846 616c 7365 290d 0a0d  nabled(False)...
+00066610: 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  .#--------------
+00066620: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00066630: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00066640: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00066650: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 6465  --------..    de
+00066660: 6620 4f6e 5365 744d 6178 5368 6966 7428  f OnSetMaxShift(
+00066670: 7365 6c66 2c20 7661 6c75 6529 3a0d 0a0d  self, value):...
+00066680: 0a20 2020 2020 2020 2073 656c 662e 6d61  .        self.ma
+00066690: 7873 6869 6674 203d 2076 616c 7565 0d0a  xshift = value..
+000666a0: 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ..#-------------
+000666b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000666c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000666d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000666e0: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
+000666f0: 6566 204f 6e52 656d 6f76 6549 6d61 6765  ef OnRemoveImage
+00066700: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
+00066710: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00066720: 2e73 7461 636b 2e61 6273 6461 7461 203d  .stack.absdata =
+00066730: 206e 702e 6465 6c65 7465 2873 656c 662e   np.delete(self.
+00066740: 7374 6163 6b2e 6162 7364 6174 612c 2073  stack.absdata, s
+00066750: 656c 662e 6965 762c 2061 7869 733d 3229  elf.iev, axis=2)
+00066760: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00066770: 2e61 6c69 676e 6564 5f73 7461 636b 203d  .aligned_stack =
+00066780: 206e 702e 6465 6c65 7465 2873 656c 662e   np.delete(self.
+00066790: 616c 6967 6e65 645f 7374 6163 6b2c 2073  aligned_stack, s
+000667a0: 656c 662e 6965 762c 2061 7869 733d 3229  elf.iev, axis=2)
+000667b0: 0d0a 0d0a 2020 2020 2020 2020 6966 2073  ....        if s
+000667c0: 656c 662e 636f 6d2e 7374 6163 6b5f 3464  elf.com.stack_4d
+000667d0: 203d 3d20 313a 0d0a 2020 2020 2020 2020   == 1:..        
+000667e0: 2020 2020 7365 6c66 2e73 7461 636b 2e73      self.stack.s
+000667f0: 7461 636b 3444 203d 206e 702e 6465 6c65  tack4D = np.dele
+00066800: 7465 2873 656c 662e 7374 6163 6b2e 7374  te(self.stack.st
+00066810: 6163 6b34 442c 2073 656c 662e 6965 762c  ack4D, self.iev,
+00066820: 2061 7869 733d 3229 0d0a 0d0a 0d0a 2020   axis=2)......  
+00066830: 2020 2020 2020 7365 6c66 2e73 7461 636b        self.stack
+00066840: 2e6e 5f65 7620 3d20 7365 6c66 2e73 7461  .n_ev = self.sta
+00066850: 636b 2e6e 5f65 7620 2d20 310d 0a20 2020  ck.n_ev - 1..   
+00066860: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
+00066870: 6576 203d 206e 702e 6465 6c65 7465 2873  ev = np.delete(s
+00066880: 656c 662e 7374 6163 6b2e 6576 2c20 7365  elf.stack.ev, se
+00066890: 6c66 2e69 6576 290d 0a0d 0a0d 0a0d 0a0d  lf.iev).........
+000668a0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000668b0: 2e63 6f6d 2e73 7461 636b 5f34 6420 3d3d  .com.stack_4d ==
+000668c0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+000668d0: 2073 656c 662e 7374 6163 6b2e 6461 7461   self.stack.data
+000668e0: 5f73 7472 7563 742e 6578 6368 616e 6765  _struct.exchange
+000668f0: 2e64 6174 6120 3d20 7365 6c66 2e73 7461  .data = self.sta
+00066900: 636b 2e61 6273 6461 7461 0d0a 2020 2020  ck.absdata..    
+00066910: 2020 2020 2020 2020 7365 6c66 2e78 7368          self.xsh
+00066920: 6966 7473 203d 206e 702e 6465 6c65 7465  ifts = np.delete
+00066930: 2873 656c 662e 7873 6869 6674 732c 2073  (self.xshifts, s
+00066940: 656c 662e 6965 7629 0d0a 2020 2020 2020  elf.iev)..      
+00066950: 2020 2020 2020 7365 6c66 2e79 7368 6966        self.yshif
+00066960: 7473 203d 206e 702e 6465 6c65 7465 2873  ts = np.delete(s
+00066970: 656c 662e 7973 6869 6674 732c 2073 656c  elf.yshifts, sel
+00066980: 662e 6965 7629 0d0a 2020 2020 2020 2020  f.iev)..        
+00066990: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+000669a0: 2020 2073 656c 662e 7374 6163 6b2e 6461     self.stack.da
+000669b0: 7461 5f73 7472 7563 742e 6578 6368 616e  ta_struct.exchan
+000669c0: 6765 2e64 6174 6120 3d20 7365 6c66 2e73  ge.data = self.s
+000669d0: 7461 636b 2e73 7461 636b 3444 0d0a 2020  tack.stack4D..  
+000669e0: 2020 2020 2020 2020 2020 7365 6c66 2e78            self.x
+000669f0: 7368 6966 7473 203d 206e 702e 6465 6c65  shifts = np.dele
+00066a00: 7465 2873 656c 662e 7873 6869 6674 732c  te(self.xshifts,
+00066a10: 2073 656c 662e 6965 762c 2061 7869 733d   self.iev, axis=
+00066a20: 3029 0d0a 2020 2020 2020 2020 2020 2020  0)..            
+00066a30: 7365 6c66 2e79 7368 6966 7473 203d 206e  self.yshifts = n
+00066a40: 702e 6465 6c65 7465 2873 656c 662e 7973  p.delete(self.ys
+00066a50: 6869 6674 732c 2073 656c 662e 6965 762c  hifts, self.iev,
+00066a60: 2061 7869 733d 3029 0d0a 0d0a 2020 2020   axis=0)....    
+00066a70: 2020 2020 7365 6c66 2e73 7461 636b 2e64      self.stack.d
+00066a80: 6174 615f 7374 7275 6374 2e65 7863 6861  ata_struct.excha
+00066a90: 6e67 652e 656e 6572 6779 203d 2073 656c  nge.energy = sel
+00066aa0: 662e 7374 6163 6b2e 6576 0d0a 0d0a 2020  f.stack.ev....  
+00066ab0: 2020 2020 2020 6966 2073 656c 662e 636f        if self.co
+00066ac0: 6d2e 6930 5f6c 6f61 6465 6420 3d3d 2031  m.i0_loaded == 1
+00066ad0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00066ae0: 656c 662e 7374 6163 6b2e 6361 6c63 756c  elf.stack.calcul
+00066af0: 6174 655f 6f70 7469 6361 6c5f 6465 6e73  ate_optical_dens
+00066b00: 6974 7928 290d 0a0d 0a20 2020 2020 2020  ity()....       
+00066b10: 2073 656c 662e 6965 7620 3d20 7365 6c66   self.iev = self
+00066b20: 2e69 6576 2d31 0d0a 2020 2020 2020 2020  .iev-1..        
+00066b30: 6966 2073 656c 662e 6965 7620 3c20 303a  if self.iev < 0:
+00066b40: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00066b50: 6c66 2e69 6576 203d 2030 0d0a 0d0a 0d0a  lf.iev = 0......
+00066b60: 2020 2020 2020 2020 7365 6c66 2e73 6c69          self.sli
+00066b70: 6465 725f 656e 672e 7365 7452 616e 6765  der_eng.setRange
+00066b80: 2830 2c20 7365 6c66 2e73 7461 636b 2e6e  (0, self.stack.n
+00066b90: 5f65 762d 3129 0d0a 0d0a 2020 2020 2020  _ev-1)....      
+00066ba0: 2020 7365 6c66 2e70 6172 656e 742e 7061    self.parent.pa
+00066bb0: 6765 312e 736c 6964 6572 5f65 6e67 2e73  ge1.slider_eng.s
+00066bc0: 6574 5261 6e67 6528 302c 2073 656c 662e  etRange(0, self.
+00066bd0: 7374 6163 6b2e 6e5f 6576 2d31 290d 0a20  stack.n_ev-1).. 
+00066be0: 2020 2020 2020 2073 656c 662e 7061 7265         self.pare
+00066bf0: 6e74 2e70 6167 6531 2e69 6576 203d 2073  nt.page1.iev = s
+00066c00: 656c 662e 7374 6163 6b2e 6e5f 6576 2f32  elf.stack.n_ev/2
+00066c10: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00066c20: 6172 656e 742e 7061 6765 312e 736c 6964  arent.page1.slid
+00066c30: 6572 5f65 6e67 2e73 6574 5661 6c75 6528  er_eng.setValue(
+00066c40: 7365 6c66 2e70 6172 656e 742e 7061 6765  self.parent.page
+00066c50: 312e 6965 7629 0d0a 0d0a 2020 2020 2020  1.iev)....      
+00066c60: 2020 7365 6c66 2e70 6172 656e 742e 7061    self.parent.pa
+00066c70: 6765 312e 7368 6f77 5370 6563 7472 756d  ge1.showSpectrum
+00066c80: 2873 656c 662e 7061 7265 6e74 2e70 6167  (self.parent.pag
+00066c90: 6531 2e69 782c 2073 656c 662e 7061 7265  e1.ix, self.pare
+00066ca0: 6e74 2e70 6167 6531 2e69 7929 0d0a 2020  nt.page1.iy)..  
+00066cb0: 2020 2020 2020 7365 6c66 2e70 6172 656e        self.paren
+00066cc0: 742e 7061 6765 312e 6c6f 6164 496d 6167  t.page1.loadImag
+00066cd0: 6528 290d 0a0d 0a20 2020 2020 2020 2073  e()....        s
+00066ce0: 656c 662e 5368 6f77 496d 6167 6528 290d  elf.ShowImage().
+00066cf0: 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ...#------------
+00066d00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00066d10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00066d20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00066d30: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
+00066d40: 6465 6620 4f6e 4361 6c63 5265 6769 7374  def OnCalcRegist
+00066d50: 7261 7469 6f6e 2873 656c 662c 2065 7665  ration(self, eve
+00066d60: 6e74 293a 0d0a 0d0a 2020 2020 2020 2020  nt):....        
+00066d70: 6966 2073 656c 662e 636f 6d2e 7374 6163  if self.com.stac
+00066d80: 6b5f 3464 203d 3d20 313a 0d0a 2020 2020  k_4d == 1:..    
+00066d90: 2020 2020 2020 2020 7365 6c66 2e43 616c          self.Cal
+00066da0: 6352 6567 6973 7472 6174 696f 6e34 4428  cRegistration4D(
+00066db0: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
+00066dc0: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
+00066dd0: 2051 7457 6964 6765 7473 2e51 4170 706c   QtWidgets.QAppl
+00066de0: 6963 6174 696f 6e2e 7365 744f 7665 7272  ication.setOverr
+00066df0: 6964 6543 7572 736f 7228 5174 4775 692e  ideCursor(QtGui.
+00066e00: 5143 7572 736f 7228 5174 2e57 6169 7443  QCursor(Qt.WaitC
+00066e10: 7572 736f 7229 290d 0a0d 0a20 2020 2020  ursor))....     
+00066e20: 2020 2023 4765 7420 4564 6765 2065 6e68     #Get Edge enh
+00066e30: 616e 6365 6d65 6e74 2069 6e66 6f0d 0a20  ancement info.. 
+00066e40: 2020 2020 2020 2065 6467 6520 3d20 300d         edge = 0.
+00066e50: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00066e60: 2e65 6467 6565 203e 2030 3a0d 0a20 2020  .edgee > 0:..   
+00066e70: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00066e80: 2e72 625f 736f 6265 6c2e 6973 4368 6563  .rb_sobel.isChec
+00066e90: 6b65 6428 293a 0d0a 2020 2020 2020 2020  ked():..        
+00066ea0: 2020 2020 2020 2020 6564 6765 203d 2031          edge = 1
+00066eb0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00066ec0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00066ed0: 2020 2020 2065 6467 6520 3d20 320d 0a0d       edge = 2...
+00066ee0: 0a20 2020 2020 2020 2023 5375 6272 6567  .        #Subreg
+00066ef0: 696f 6e20 7365 6c65 6374 696f 6e20 6f6e  ion selection on
+00066f00: 2061 2072 6566 6572 656e 6365 2069 6d61   a reference ima
+00066f10: 6765 0d0a 2020 2020 2020 2020 6966 2073  ge..        if s
+00066f20: 656c 662e 7375 6272 6567 696f 6e20 3d3d  elf.subregion ==
+00066f30: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+00066f40: 2073 656c 662e 7372 5f78 3120 3d20 300d   self.sr_x1 = 0.
+00066f50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00066f60: 662e 7372 5f78 3220 3d20 300d 0a20 2020  f.sr_x2 = 0..   
+00066f70: 2020 2020 2020 2020 2073 656c 662e 7372           self.sr
+00066f80: 5f79 3120 3d20 300d 0a20 2020 2020 2020  _y1 = 0..       
+00066f90: 2020 2020 2073 656c 662e 7372 5f79 3220       self.sr_y2 
+00066fa0: 3d20 300d 0a20 2020 2020 2020 2020 2020  = 0..           
+00066fb0: 2072 6566 6572 656e 6365 696d 6167 6520   referenceimage 
+00066fc0: 3d20 7365 6c66 2e72 6566 5f69 6d61 6765  = self.ref_image
+00066fd0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00066fe0: 0a20 2020 2020 2020 2020 2020 2072 6566  .            ref
+00066ff0: 6572 656e 6365 696d 6167 6520 3d20 7365  erenceimage = se
+00067000: 6c66 2e72 6566 5f69 6d61 6765 5b73 656c  lf.ref_image[sel
+00067010: 662e 7372 5f78 313a 7365 6c66 2e73 725f  f.sr_x1:self.sr_
+00067020: 7832 2c20 7365 6c66 2e73 725f 7932 3a73  x2, self.sr_y2:s
+00067030: 656c 662e 7372 5f79 315d 0d0a 0d0a 2020  elf.sr_y1]....  
+00067040: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00067050: 616e 6765 2873 656c 662e 7374 6163 6b2e  ange(self.stack.
+00067060: 6e5f 6576 293a 0d0a 0d0a 2020 2020 2020  n_ev):....      
+00067070: 2020 2020 2020 6966 2073 656c 662e 7375        if self.su
+00067080: 6272 6567 696f 6e20 3d3d 2030 3a0d 0a20  bregion == 0:.. 
+00067090: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000670a0: 6d67 3220 3d20 7365 6c66 2e61 6c69 676e  mg2 = self.align
+000670b0: 6564 5f73 7461 636b 5b3a 2c3a 2c69 5d0d  ed_stack[:,:,i].
+000670c0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+000670d0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000670e0: 2020 2020 696d 6732 203d 2073 656c 662e      img2 = self.
+000670f0: 616c 6967 6e65 645f 7374 6163 6b5b 7365  aligned_stack[se
+00067100: 6c66 2e73 725f 7831 3a73 656c 662e 7372  lf.sr_x1:self.sr
+00067110: 5f78 322c 2073 656c 662e 7372 5f79 323a  _x2, self.sr_y2:
+00067120: 7365 6c66 2e73 725f 7931 2c20 695d 0d0a  self.sr_y1, i]..
+00067130: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00067140: 2069 3d3d 303a 0d0a 2020 2020 2020 2020   i==0:..        
+00067150: 2020 2020 2020 2020 7873 6869 6674 2c20          xshift, 
+00067160: 7973 6869 6674 2c20 6363 6f72 7220 3d20  yshift, ccorr = 
+00067170: 7365 6c66 2e73 7461 636b 2e72 6567 6973  self.stack.regis
+00067180: 7465 725f 696d 6167 6573 2872 6566 6572  ter_images(refer
+00067190: 656e 6365 696d 6167 652c 2069 6d67 322c  enceimage, img2,
+000671a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 000671b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000671c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000671d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000671e0: 6467 655f 656e 6861 6e63 656d 656e 7420  dge_enhancement 
-000671f0: 3d20 6564 6765 290d 0a20 2020 2020 2020  = edge)..       
-00067200: 2020 2020 2065 6c69 6620 693d 3d73 656c       elif i==sel
-00067210: 662e 7265 665f 696d 6167 655f 696e 6465  f.ref_image_inde
-00067220: 783a 0d0a 2020 2020 2020 2020 2020 2020  x:..            
-00067230: 2020 2020 7873 6869 6674 203d 2030 0d0a      xshift = 0..
-00067240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067250: 7973 6869 6674 203d 2030 0d0a 2020 2020  yshift = 0..    
-00067260: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00067270: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-00067280: 7368 6966 742c 2079 7368 6966 742c 2063  shift, yshift, c
-00067290: 636f 7272 203d 2073 656c 662e 7374 6163  corr = self.stac
-000672a0: 6b2e 7265 6769 7374 6572 5f69 6d61 6765  k.register_image
-000672b0: 7328 7265 6665 7265 6e63 6569 6d61 6765  s(referenceimage
-000672c0: 2c20 696d 6732 2c0d 0a20 2020 2020 2020  , img2,..       
-000672d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000672e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000672f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067300: 2020 2068 6176 655f 7265 665f 696d 675f     have_ref_img_
-00067310: 6666 7420 3d20 5472 7565 2c0d 0a20 2020  fft = True,..   
+000671d0: 2020 2020 2020 2020 2020 2020 6861 7665              have
+000671e0: 5f72 6566 5f69 6d67 5f66 6674 203d 2046  _ref_img_fft = F
+000671f0: 616c 7365 2c0d 0a20 2020 2020 2020 2020  alse,..         
+00067200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067230: 2065 6467 655f 656e 6861 6e63 656d 656e   edge_enhancemen
+00067240: 7420 3d20 6564 6765 290d 0a20 2020 2020  t = edge)..     
+00067250: 2020 2020 2020 2065 6c69 6620 693d 3d73         elif i==s
+00067260: 656c 662e 7265 665f 696d 6167 655f 696e  elf.ref_image_in
+00067270: 6465 783a 0d0a 2020 2020 2020 2020 2020  dex:..          
+00067280: 2020 2020 2020 7873 6869 6674 203d 2030        xshift = 0
+00067290: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000672a0: 2020 7973 6869 6674 203d 2030 0d0a 2020    yshift = 0..  
+000672b0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+000672c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000672d0: 2078 7368 6966 742c 2079 7368 6966 742c   xshift, yshift,
+000672e0: 2063 636f 7272 203d 2073 656c 662e 7374   ccorr = self.st
+000672f0: 6163 6b2e 7265 6769 7374 6572 5f69 6d61  ack.register_ima
+00067300: 6765 7328 7265 6665 7265 6e63 6569 6d61  ges(referenceima
+00067310: 6765 2c20 696d 6732 2c0d 0a20 2020 2020  ge, img2,..     
 00067320: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00067330: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00067340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067350: 2020 2020 2020 2065 6467 655f 656e 6861         edge_enha
-00067360: 6e63 656d 656e 7420 3d20 2065 6467 6529  ncement =  edge)
-00067370: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00067380: 234c 696d 6974 2074 6865 2073 6869 6674  #Limit the shift
-00067390: 7320 746f 204d 4158 5348 4946 5420 6368  s to MAXSHIFT ch
-000673a0: 6f73 656e 2062 7920 7468 6520 7573 6572  osen by the user
-000673b0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000673c0: 2028 7365 6c66 2e6d 6178 7368 6966 7420   (self.maxshift 
-000673d0: 3e20 3029 3a0d 0a20 2020 2020 2020 2020  > 0):..         
-000673e0: 2020 2020 2020 2069 6620 2861 6273 2878         if (abs(x
-000673f0: 7368 6966 7429 203e 2073 656c 662e 6d61  shift) > self.ma
-00067400: 7873 6869 6674 293a 0d0a 2020 2020 2020  xshift):..      
-00067410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067420: 2020 7873 6869 6674 203d 206e 702e 7369    xshift = np.si
-00067430: 676e 2878 7368 6966 7429 2a73 656c 662e  gn(xshift)*self.
-00067440: 6d61 7873 6869 6674 0d0a 2020 2020 2020  maxshift..      
-00067450: 2020 2020 2020 2020 2020 6966 2028 6162            if (ab
-00067460: 7328 7973 6869 6674 2920 3e20 7365 6c66  s(yshift) > self
-00067470: 2e6d 6178 7368 6966 7429 3a0d 0a20 2020  .maxshift):..   
-00067480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067490: 2020 2020 2079 7368 6966 7420 3d20 6e70       yshift = np
-000674a0: 2e73 6967 6e28 7973 6869 6674 292a 7365  .sign(yshift)*se
-000674b0: 6c66 2e6d 6178 7368 6966 740d 0a0d 0a20  lf.maxshift.... 
-000674c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000674d0: 7873 6869 6674 735b 695d 203d 2078 7368  xshifts[i] = xsh
-000674e0: 6966 740d 0a20 2020 2020 2020 2020 2020  ift..           
-000674f0: 2073 656c 662e 7973 6869 6674 735b 695d   self.yshifts[i]
-00067500: 203d 2079 7368 6966 740d 0a20 2020 2020   = yshift..     
-00067510: 2020 2020 2020 2073 656c 662e 506c 6f74         self.Plot
-00067520: 5368 6966 7473 2829 0d0a 0d0a 2020 2020  Shifts()....    
-00067530: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00067540: 7368 6f77 6363 6f72 7220 3d3d 2031 3a0d  showccorr == 1:.
-00067550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00067560: 2073 656c 662e 5368 6f77 4372 6f73 7343   self.ShowCrossC
-00067570: 6f72 7265 6c61 7469 6f6e 2863 636f 7272  orrelation(ccorr
-00067580: 2c20 7873 6869 6674 2c20 7973 6869 6674  , xshift, yshift
-00067590: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-000675a0: 2051 436f 7265 4170 706c 6963 6174 696f   QCoreApplicatio
-000675b0: 6e2e 7072 6f63 6573 7345 7665 6e74 7328  n.processEvents(
-000675c0: 290d 0a0d 0a0d 0a20 2020 2020 2020 2023  )......        #
-000675d0: 4170 706c 7920 7368 6966 7473 0d0a 2020  Apply shifts..  
-000675e0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-000675f0: 616e 6765 2873 656c 662e 7374 6163 6b2e  ange(self.stack.
-00067600: 6e5f 6576 293a 0d0a 2020 2020 2020 2020  n_ev):..        
-00067610: 2020 2020 696d 6720 3d20 7365 6c66 2e61      img = self.a
-00067620: 6c69 676e 6564 5f73 7461 636b 5b3a 2c3a  ligned_stack[:,:
-00067630: 2c69 5d0d 0a20 2020 2020 2020 2020 2020  ,i]..           
-00067640: 2069 6620 2861 6273 2873 656c 662e 7873   if (abs(self.xs
-00067650: 6869 6674 735b 695d 293e 302e 3032 2920  hifts[i])>0.02) 
-00067660: 6f72 2028 6162 7328 7365 6c66 2e79 7368  or (abs(self.ysh
-00067670: 6966 7473 5b69 5d29 3e30 2e30 3229 3a0d  ifts[i])>0.02):.
-00067680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00067690: 2073 6869 6674 6564 5f69 6d67 203d 2073   shifted_img = s
-000676a0: 656c 662e 7374 6163 6b2e 6170 706c 795f  elf.stack.apply_
-000676b0: 696d 6167 655f 7265 6769 7374 7261 7469  image_registrati
-000676c0: 6f6e 2869 6d67 2c0d 0a20 2020 2020 2020  on(img,..       
-000676d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000676e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000676f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067700: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00067710: 7873 6869 6674 735b 695d 2c0d 0a20 2020  xshifts[i],..   
+00067350: 2020 2020 2068 6176 655f 7265 665f 696d       have_ref_im
+00067360: 675f 6666 7420 3d20 5472 7565 2c0d 0a20  g_fft = True,.. 
+00067370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000673a0: 2020 2020 2020 2020 2065 6467 655f 656e           edge_en
+000673b0: 6861 6e63 656d 656e 7420 3d20 2065 6467  hancement =  edg
+000673c0: 6529 0d0a 0d0a 2020 2020 2020 2020 2020  e)....          
+000673d0: 2020 234c 696d 6974 2074 6865 2073 6869    #Limit the shi
+000673e0: 6674 7320 746f 204d 4158 5348 4946 5420  fts to MAXSHIFT 
+000673f0: 6368 6f73 656e 2062 7920 7468 6520 7573  chosen by the us
+00067400: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
+00067410: 6966 2028 7365 6c66 2e6d 6178 7368 6966  if (self.maxshif
+00067420: 7420 3e20 3029 3a0d 0a20 2020 2020 2020  t > 0):..       
+00067430: 2020 2020 2020 2020 2069 6620 2861 6273           if (abs
+00067440: 2878 7368 6966 7429 203e 2073 656c 662e  (xshift) > self.
+00067450: 6d61 7873 6869 6674 293a 0d0a 2020 2020  maxshift):..    
+00067460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067470: 2020 2020 7873 6869 6674 203d 206e 702e      xshift = np.
+00067480: 7369 676e 2878 7368 6966 7429 2a73 656c  sign(xshift)*sel
+00067490: 662e 6d61 7873 6869 6674 0d0a 2020 2020  f.maxshift..    
+000674a0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+000674b0: 6162 7328 7973 6869 6674 2920 3e20 7365  abs(yshift) > se
+000674c0: 6c66 2e6d 6178 7368 6966 7429 3a0d 0a20  lf.maxshift):.. 
+000674d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000674e0: 2020 2020 2020 2079 7368 6966 7420 3d20         yshift = 
+000674f0: 6e70 2e73 6967 6e28 7973 6869 6674 292a  np.sign(yshift)*
+00067500: 7365 6c66 2e6d 6178 7368 6966 740d 0a0d  self.maxshift...
+00067510: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00067520: 662e 7873 6869 6674 735b 695d 203d 2078  f.xshifts[i] = x
+00067530: 7368 6966 740d 0a20 2020 2020 2020 2020  shift..         
+00067540: 2020 2073 656c 662e 7973 6869 6674 735b     self.yshifts[
+00067550: 695d 203d 2079 7368 6966 740d 0a20 2020  i] = yshift..   
+00067560: 2020 2020 2020 2020 2073 656c 662e 506c           self.Pl
+00067570: 6f74 5368 6966 7473 2829 0d0a 0d0a 2020  otShifts()....  
+00067580: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00067590: 662e 7368 6f77 6363 6f72 7220 3d3d 2031  f.showccorr == 1
+000675a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000675b0: 2020 2073 656c 662e 5368 6f77 4372 6f73     self.ShowCros
+000675c0: 7343 6f72 7265 6c61 7469 6f6e 2863 636f  sCorrelation(cco
+000675d0: 7272 2c20 7873 6869 6674 2c20 7973 6869  rr, xshift, yshi
+000675e0: 6674 290d 0a0d 0a20 2020 2020 2020 2020  ft)....         
+000675f0: 2020 2051 436f 7265 4170 706c 6963 6174     QCoreApplicat
+00067600: 696f 6e2e 7072 6f63 6573 7345 7665 6e74  ion.processEvent
+00067610: 7328 290d 0a0d 0a0d 0a20 2020 2020 2020  s()......       
+00067620: 2023 4170 706c 7920 7368 6966 7473 0d0a   #Apply shifts..
+00067630: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+00067640: 2072 616e 6765 2873 656c 662e 7374 6163   range(self.stac
+00067650: 6b2e 6e5f 6576 293a 0d0a 2020 2020 2020  k.n_ev):..      
+00067660: 2020 2020 2020 696d 6720 3d20 7365 6c66        img = self
+00067670: 2e61 6c69 676e 6564 5f73 7461 636b 5b3a  .aligned_stack[:
+00067680: 2c3a 2c69 5d0d 0a20 2020 2020 2020 2020  ,:,i]..         
+00067690: 2020 2069 6620 2861 6273 2873 656c 662e     if (abs(self.
+000676a0: 7873 6869 6674 735b 695d 293e 302e 3032  xshifts[i])>0.02
+000676b0: 2920 6f72 2028 6162 7328 7365 6c66 2e79  ) or (abs(self.y
+000676c0: 7368 6966 7473 5b69 5d29 3e30 2e30 3229  shifts[i])>0.02)
+000676d0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000676e0: 2020 2073 6869 6674 6564 5f69 6d67 203d     shifted_img =
+000676f0: 2073 656c 662e 7374 6163 6b2e 6170 706c   self.stack.appl
+00067700: 795f 696d 6167 655f 7265 6769 7374 7261  y_image_registra
+00067710: 7469 6f6e 2869 6d67 2c0d 0a20 2020 2020  tion(img,..     
 00067720: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00067730: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00067740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067750: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00067760: 656c 662e 7973 6869 6674 735b 695d 290d  elf.yshifts[i]).
-00067770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00067780: 2073 656c 662e 616c 6967 6e65 645f 7374   self.aligned_st
-00067790: 6163 6b5b 3a2c 3a2c 695d 203d 2073 6869  ack[:,:,i] = shi
-000677a0: 6674 6564 5f69 6d67 0d0a 0d0a 0d0a 2020  fted_img......  
-000677b0: 2020 2020 2020 7365 6c66 2e72 6567 6973        self.regis
-000677c0: 745f 6361 6c63 756c 6174 6564 203d 2031  t_calculated = 1
-000677d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
-000677e0: 6576 203d 2030 0d0a 2020 2020 2020 2020  ev = 0..        
-000677f0: 7365 6c66 2e53 686f 7749 6d61 6765 2829  self.ShowImage()
-00067800: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-00067810: 6c69 6465 725f 656e 672e 7365 7456 616c  lider_eng.setVal
-00067820: 7565 2873 656c 662e 6965 7629 0d0a 0d0a  ue(self.iev)....
-00067830: 2020 2020 2020 2020 7365 6c66 2e55 7064          self.Upd
-00067840: 6174 6557 6964 6765 7473 2829 0d0a 0d0a  ateWidgets()....
-00067850: 0d0a 2020 2020 2020 2020 6d69 6e5f 7873  ..        min_xs
-00067860: 6869 6674 203d 206e 702e 6d69 6e28 7365  hift = np.min(se
-00067870: 6c66 2e78 7368 6966 7473 290d 0a20 2020  lf.xshifts)..   
-00067880: 2020 2020 206d 6178 5f78 7368 6966 7420       max_xshift 
-00067890: 3d20 6e70 2e6d 6178 2873 656c 662e 7873  = np.max(self.xs
-000678a0: 6869 6674 7329 0d0a 0d0a 2020 2020 2020  hifts)....      
-000678b0: 2020 6d69 6e5f 7973 6869 6674 203d 206e    min_yshift = n
-000678c0: 702e 6d69 6e28 7365 6c66 2e79 7368 6966  p.min(self.yshif
-000678d0: 7473 290d 0a20 2020 2020 2020 206d 6178  ts)..        max
-000678e0: 5f79 7368 6966 7420 3d20 6e70 2e6d 6178  _yshift = np.max
-000678f0: 2873 656c 662e 7973 6869 6674 7329 0d0a  (self.yshifts)..
-00067900: 0d0a 2020 2020 2020 2020 6966 206d 696e  ..        if min
-00067910: 5f78 7368 6966 7420 3c20 7365 6c66 2e6d  _xshift < self.m
-00067920: 696e 7873 203a 2073 656c 662e 6d69 6e78  inxs : self.minx
-00067930: 7320 3d20 6d69 6e5f 7873 6869 6674 0d0a  s = min_xshift..
-00067940: 2020 2020 2020 2020 6966 206d 6178 5f78          if max_x
-00067950: 7368 6966 7420 3e20 7365 6c66 2e6d 6178  shift > self.max
-00067960: 7873 203a 2073 656c 662e 6d61 7878 7320  xs : self.maxxs 
-00067970: 3d20 6d61 785f 7873 6869 6674 0d0a 0d0a  = max_xshift....
-00067980: 2020 2020 2020 2020 6966 206d 696e 5f79          if min_y
-00067990: 7368 6966 7420 3c20 7365 6c66 2e6d 696e  shift < self.min
-000679a0: 7973 203a 2073 656c 662e 6d69 6e79 7320  ys : self.minys 
-000679b0: 3d20 6d69 6e5f 7973 6869 6674 0d0a 2020  = min_yshift..  
-000679c0: 2020 2020 2020 6966 206d 6178 5f79 7368        if max_ysh
-000679d0: 6966 7420 3e20 7365 6c66 2e6d 6178 7973  ift > self.maxys
-000679e0: 203a 2073 656c 662e 6d61 7879 7320 3d20   : self.maxys = 
-000679f0: 6d61 785f 7973 6869 6674 0d0a 0d0a 0d0a  max_yshift......
-00067a00: 2020 2020 2020 2020 5174 5769 6467 6574          QtWidget
-00067a10: 732e 5141 7070 6c69 6361 7469 6f6e 2e72  s.QApplication.r
-00067a20: 6573 746f 7265 4f76 6572 7269 6465 4375  estoreOverrideCu
-00067a30: 7273 6f72 2829 0d0a 0d0a 232d 2d2d 2d2d  rsor()....#-----
-00067a40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00067a50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00067a60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00067a70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00067a80: 2d0d 0a20 2020 2064 6566 2043 616c 6352  -..    def CalcR
-00067a90: 6567 6973 7472 6174 696f 6e34 4428 7365  egistration4D(se
-00067aa0: 6c66 293a 0d0a 0d0a 2020 2020 2020 2020  lf):....        
-00067ab0: 5174 5769 6467 6574 732e 5141 7070 6c69  QtWidgets.QAppli
-00067ac0: 6361 7469 6f6e 2e73 6574 4f76 6572 7269  cation.setOverri
-00067ad0: 6465 4375 7273 6f72 2851 7447 7569 2e51  deCursor(QtGui.Q
-00067ae0: 4375 7273 6f72 2851 742e 5761 6974 4375  Cursor(Qt.WaitCu
-00067af0: 7273 6f72 2929 0d0a 0d0a 2020 2020 2020  rsor))....      
-00067b00: 2020 2347 6574 2045 6467 6520 656e 6861    #Get Edge enha
-00067b10: 6e63 656d 656e 7420 696e 666f 0d0a 2020  ncement info..  
-00067b20: 2020 2020 2020 6564 6765 203d 2030 0d0a        edge = 0..
-00067b30: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00067b40: 6564 6765 6520 3e20 303a 0d0a 2020 2020  edgee > 0:..    
-00067b50: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00067b60: 7262 5f73 6f62 656c 2e69 7343 6865 636b  rb_sobel.isCheck
-00067b70: 6564 2829 3a0d 0a20 2020 2020 2020 2020  ed():..         
-00067b80: 2020 2020 2020 2065 6467 6520 3d20 310d         edge = 1.
-00067b90: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00067ba0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00067bb0: 2020 2020 6564 6765 203d 2032 0d0a 0d0a      edge = 2....
-00067bc0: 2020 2020 2020 2020 2353 7562 7265 6769          #Subregi
-00067bd0: 6f6e 2073 656c 6563 7469 6f6e 206f 6e20  on selection on 
-00067be0: 6120 7265 6665 7265 6e63 6520 696d 6167  a reference imag
-00067bf0: 650d 0a20 2020 2020 2020 2069 6620 7365  e..        if se
-00067c00: 6c66 2e73 7562 7265 6769 6f6e 203d 3d20  lf.subregion == 
-00067c10: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-00067c20: 7365 6c66 2e73 725f 7831 203d 2030 0d0a  self.sr_x1 = 0..
-00067c30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00067c40: 2e73 725f 7832 203d 2030 0d0a 2020 2020  .sr_x2 = 0..    
-00067c50: 2020 2020 2020 2020 7365 6c66 2e73 725f          self.sr_
-00067c60: 7931 203d 2030 0d0a 2020 2020 2020 2020  y1 = 0..        
-00067c70: 2020 2020 7365 6c66 2e73 725f 7932 203d      self.sr_y2 =
-00067c80: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
-00067c90: 7265 6665 7265 6e63 6569 6d61 6765 203d  referenceimage =
-00067ca0: 2073 656c 662e 7265 665f 696d 6167 650d   self.ref_image.
-00067cb0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00067cc0: 2020 2020 2020 2020 2020 2020 7265 6665              refe
-00067cd0: 7265 6e63 6569 6d61 6765 203d 2073 656c  renceimage = sel
-00067ce0: 662e 7265 665f 696d 6167 655b 7365 6c66  f.ref_image[self
-00067cf0: 2e73 725f 7831 3a73 656c 662e 7372 5f78  .sr_x1:self.sr_x
-00067d00: 322c 2073 656c 662e 7372 5f79 323a 7365  2, self.sr_y2:se
-00067d10: 6c66 2e73 725f 7931 5d0d 0a0d 0a20 2020  lf.sr_y1]....   
-00067d20: 2020 2020 2074 656d 7074 6865 7461 203d       temptheta =
-00067d30: 2073 656c 662e 6974 6865 7461 0d0a 2020   self.itheta..  
-00067d40: 2020 2020 2020 666f 7220 6a20 696e 2072        for j in r
-00067d50: 616e 6765 2873 656c 662e 7374 6163 6b2e  ange(self.stack.
-00067d60: 6e5f 7468 6574 6129 3a0d 0a20 2020 2020  n_theta):..     
-00067d70: 2020 2020 2020 2073 656c 662e 6974 6865         self.ithe
-00067d80: 7461 203d 206a 0d0a 2020 2020 2020 2020  ta = j..        
-00067d90: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-00067da0: 6765 2873 656c 662e 7374 6163 6b2e 6e5f  ge(self.stack.n_
-00067db0: 6576 293a 0d0a 0d0a 0d0a 2020 2020 2020  ev):......      
-00067dc0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00067dd0: 662e 7375 6272 6567 696f 6e20 3d3d 2030  f.subregion == 0
-00067de0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00067df0: 2020 2020 2020 2069 6d67 3220 3d20 7365         img2 = se
-00067e00: 6c66 2e61 6c69 676e 6564 5f73 7461 636b  lf.aligned_stack
-00067e10: 5b3a 2c3a 2c69 2c6a 5d0d 0a20 2020 2020  [:,:,i,j]..     
-00067e20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00067e30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00067e40: 2020 2020 2020 696d 6732 203d 2073 656c        img2 = sel
-00067e50: 662e 616c 6967 6e65 645f 7374 6163 6b5b  f.aligned_stack[
-00067e60: 7365 6c66 2e73 725f 7831 3a73 656c 662e  self.sr_x1:self.
-00067e70: 7372 5f78 322c 2073 656c 662e 7372 5f79  sr_x2, self.sr_y
-00067e80: 323a 7365 6c66 2e73 725f 7931 2c20 692c  2:self.sr_y1, i,
-00067e90: 206a 5d0d 0a0d 0a20 2020 2020 2020 2020   j]....         
-00067ea0: 2020 2020 2020 2069 6620 693d 3d30 2061         if i==0 a
-00067eb0: 6e64 206a 3d3d 303a 0d0a 2020 2020 2020  nd j==0:..      
-00067ec0: 2020 2020 2020 2020 2020 2020 2020 7873                xs
-00067ed0: 6869 6674 2c20 7973 6869 6674 2c20 6363  hift, yshift, cc
-00067ee0: 6f72 7220 3d20 7365 6c66 2e73 7461 636b  orr = self.stack
-00067ef0: 2e72 6567 6973 7465 725f 696d 6167 6573  .register_images
-00067f00: 2872 6566 6572 656e 6365 696d 6167 652c  (referenceimage,
-00067f10: 2069 6d67 322c 0d0a 2020 2020 2020 2020   img2,..        
-00067f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067f50: 2020 2020 2020 6861 7665 5f72 6566 5f69        have_ref_i
-00067f60: 6d67 5f66 6674 203d 2046 616c 7365 2c0d  mg_fft = False,.
-00067f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00067750: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00067760: 662e 7873 6869 6674 735b 695d 2c0d 0a20  f.xshifts[i],.. 
+00067770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000677a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000677b0: 2073 656c 662e 7973 6869 6674 735b 695d   self.yshifts[i]
+000677c0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000677d0: 2020 2073 656c 662e 616c 6967 6e65 645f     self.aligned_
+000677e0: 7374 6163 6b5b 3a2c 3a2c 695d 203d 2073  stack[:,:,i] = s
+000677f0: 6869 6674 6564 5f69 6d67 0d0a 0d0a 0d0a  hifted_img......
+00067800: 2020 2020 2020 2020 7365 6c66 2e72 6567          self.reg
+00067810: 6973 745f 6361 6c63 756c 6174 6564 203d  ist_calculated =
+00067820: 2031 0d0a 2020 2020 2020 2020 7365 6c66   1..        self
+00067830: 2e69 6576 203d 2030 0d0a 2020 2020 2020  .iev = 0..      
+00067840: 2020 7365 6c66 2e53 686f 7749 6d61 6765    self.ShowImage
+00067850: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+00067860: 2e73 6c69 6465 725f 656e 672e 7365 7456  .slider_eng.setV
+00067870: 616c 7565 2873 656c 662e 6965 7629 0d0a  alue(self.iev)..
+00067880: 0d0a 2020 2020 2020 2020 7365 6c66 2e55  ..        self.U
+00067890: 7064 6174 6557 6964 6765 7473 2829 0d0a  pdateWidgets()..
+000678a0: 0d0a 0d0a 2020 2020 2020 2020 6d69 6e5f  ....        min_
+000678b0: 7873 6869 6674 203d 206e 702e 6d69 6e28  xshift = np.min(
+000678c0: 7365 6c66 2e78 7368 6966 7473 290d 0a20  self.xshifts).. 
+000678d0: 2020 2020 2020 206d 6178 5f78 7368 6966         max_xshif
+000678e0: 7420 3d20 6e70 2e6d 6178 2873 656c 662e  t = np.max(self.
+000678f0: 7873 6869 6674 7329 0d0a 0d0a 2020 2020  xshifts)....    
+00067900: 2020 2020 6d69 6e5f 7973 6869 6674 203d      min_yshift =
+00067910: 206e 702e 6d69 6e28 7365 6c66 2e79 7368   np.min(self.ysh
+00067920: 6966 7473 290d 0a20 2020 2020 2020 206d  ifts)..        m
+00067930: 6178 5f79 7368 6966 7420 3d20 6e70 2e6d  ax_yshift = np.m
+00067940: 6178 2873 656c 662e 7973 6869 6674 7329  ax(self.yshifts)
+00067950: 0d0a 0d0a 2020 2020 2020 2020 6966 206d  ....        if m
+00067960: 696e 5f78 7368 6966 7420 3c20 7365 6c66  in_xshift < self
+00067970: 2e6d 696e 7873 203a 2073 656c 662e 6d69  .minxs : self.mi
+00067980: 6e78 7320 3d20 6d69 6e5f 7873 6869 6674  nxs = min_xshift
+00067990: 0d0a 2020 2020 2020 2020 6966 206d 6178  ..        if max
+000679a0: 5f78 7368 6966 7420 3e20 7365 6c66 2e6d  _xshift > self.m
+000679b0: 6178 7873 203a 2073 656c 662e 6d61 7878  axxs : self.maxx
+000679c0: 7320 3d20 6d61 785f 7873 6869 6674 0d0a  s = max_xshift..
+000679d0: 0d0a 2020 2020 2020 2020 6966 206d 696e  ..        if min
+000679e0: 5f79 7368 6966 7420 3c20 7365 6c66 2e6d  _yshift < self.m
+000679f0: 696e 7973 203a 2073 656c 662e 6d69 6e79  inys : self.miny
+00067a00: 7320 3d20 6d69 6e5f 7973 6869 6674 0d0a  s = min_yshift..
+00067a10: 2020 2020 2020 2020 6966 206d 6178 5f79          if max_y
+00067a20: 7368 6966 7420 3e20 7365 6c66 2e6d 6178  shift > self.max
+00067a30: 7973 203a 2073 656c 662e 6d61 7879 7320  ys : self.maxys 
+00067a40: 3d20 6d61 785f 7973 6869 6674 0d0a 0d0a  = max_yshift....
+00067a50: 0d0a 2020 2020 2020 2020 5174 5769 6467  ..        QtWidg
+00067a60: 6574 732e 5141 7070 6c69 6361 7469 6f6e  ets.QApplication
+00067a70: 2e72 6573 746f 7265 4f76 6572 7269 6465  .restoreOverride
+00067a80: 4375 7273 6f72 2829 0d0a 0d0a 232d 2d2d  Cursor()....#---
+00067a90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00067aa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00067ab0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00067ac0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00067ad0: 2d2d 2d0d 0a20 2020 2064 6566 2043 616c  ---..    def Cal
+00067ae0: 6352 6567 6973 7472 6174 696f 6e34 4428  cRegistration4D(
+00067af0: 7365 6c66 293a 0d0a 0d0a 2020 2020 2020  self):....      
+00067b00: 2020 5174 5769 6467 6574 732e 5141 7070    QtWidgets.QApp
+00067b10: 6c69 6361 7469 6f6e 2e73 6574 4f76 6572  lication.setOver
+00067b20: 7269 6465 4375 7273 6f72 2851 7447 7569  rideCursor(QtGui
+00067b30: 2e51 4375 7273 6f72 2851 742e 5761 6974  .QCursor(Qt.Wait
+00067b40: 4375 7273 6f72 2929 0d0a 0d0a 2020 2020  Cursor))....    
+00067b50: 2020 2020 2347 6574 2045 6467 6520 656e      #Get Edge en
+00067b60: 6861 6e63 656d 656e 7420 696e 666f 0d0a  hancement info..
+00067b70: 2020 2020 2020 2020 6564 6765 203d 2030          edge = 0
+00067b80: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00067b90: 662e 6564 6765 6520 3e20 303a 0d0a 2020  f.edgee > 0:..  
+00067ba0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00067bb0: 662e 7262 5f73 6f62 656c 2e69 7343 6865  f.rb_sobel.isChe
+00067bc0: 636b 6564 2829 3a0d 0a20 2020 2020 2020  cked():..       
+00067bd0: 2020 2020 2020 2020 2065 6467 6520 3d20           edge = 
+00067be0: 310d 0a20 2020 2020 2020 2020 2020 2065  1..            e
+00067bf0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00067c00: 2020 2020 2020 6564 6765 203d 2032 0d0a        edge = 2..
+00067c10: 0d0a 2020 2020 2020 2020 2353 7562 7265  ..        #Subre
+00067c20: 6769 6f6e 2073 656c 6563 7469 6f6e 206f  gion selection o
+00067c30: 6e20 6120 7265 6665 7265 6e63 6520 696d  n a reference im
+00067c40: 6167 650d 0a20 2020 2020 2020 2069 6620  age..        if 
+00067c50: 7365 6c66 2e73 7562 7265 6769 6f6e 203d  self.subregion =
+00067c60: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
+00067c70: 2020 7365 6c66 2e73 725f 7831 203d 2030    self.sr_x1 = 0
+00067c80: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00067c90: 6c66 2e73 725f 7832 203d 2030 0d0a 2020  lf.sr_x2 = 0..  
+00067ca0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00067cb0: 725f 7931 203d 2030 0d0a 2020 2020 2020  r_y1 = 0..      
+00067cc0: 2020 2020 2020 7365 6c66 2e73 725f 7932        self.sr_y2
+00067cd0: 203d 2030 0d0a 2020 2020 2020 2020 2020   = 0..          
+00067ce0: 2020 7265 6665 7265 6e63 6569 6d61 6765    referenceimage
+00067cf0: 203d 2073 656c 662e 7265 665f 696d 6167   = self.ref_imag
+00067d00: 650d 0a20 2020 2020 2020 2065 6c73 653a  e..        else:
+00067d10: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00067d20: 6665 7265 6e63 6569 6d61 6765 203d 2073  ferenceimage = s
+00067d30: 656c 662e 7265 665f 696d 6167 655b 7365  elf.ref_image[se
+00067d40: 6c66 2e73 725f 7831 3a73 656c 662e 7372  lf.sr_x1:self.sr
+00067d50: 5f78 322c 2073 656c 662e 7372 5f79 323a  _x2, self.sr_y2:
+00067d60: 7365 6c66 2e73 725f 7931 5d0d 0a0d 0a20  self.sr_y1].... 
+00067d70: 2020 2020 2020 2074 656d 7074 6865 7461         temptheta
+00067d80: 203d 2073 656c 662e 6974 6865 7461 0d0a   = self.itheta..
+00067d90: 2020 2020 2020 2020 666f 7220 6a20 696e          for j in
+00067da0: 2072 616e 6765 2873 656c 662e 7374 6163   range(self.stac
+00067db0: 6b2e 6e5f 7468 6574 6129 3a0d 0a20 2020  k.n_theta):..   
+00067dc0: 2020 2020 2020 2020 2073 656c 662e 6974           self.it
+00067dd0: 6865 7461 203d 206a 0d0a 2020 2020 2020  heta = j..      
+00067de0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00067df0: 616e 6765 2873 656c 662e 7374 6163 6b2e  ange(self.stack.
+00067e00: 6e5f 6576 293a 0d0a 0d0a 0d0a 2020 2020  n_ev):......    
+00067e10: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00067e20: 656c 662e 7375 6272 6567 696f 6e20 3d3d  elf.subregion ==
+00067e30: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+00067e40: 2020 2020 2020 2020 2069 6d67 3220 3d20           img2 = 
+00067e50: 7365 6c66 2e61 6c69 676e 6564 5f73 7461  self.aligned_sta
+00067e60: 636b 5b3a 2c3a 2c69 2c6a 5d0d 0a20 2020  ck[:,:,i,j]..   
+00067e70: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00067e80: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00067e90: 2020 2020 2020 2020 696d 6732 203d 2073          img2 = s
+00067ea0: 656c 662e 616c 6967 6e65 645f 7374 6163  elf.aligned_stac
+00067eb0: 6b5b 7365 6c66 2e73 725f 7831 3a73 656c  k[self.sr_x1:sel
+00067ec0: 662e 7372 5f78 322c 2073 656c 662e 7372  f.sr_x2, self.sr
+00067ed0: 5f79 323a 7365 6c66 2e73 725f 7931 2c20  _y2:self.sr_y1, 
+00067ee0: 692c 206a 5d0d 0a0d 0a20 2020 2020 2020  i, j]....       
+00067ef0: 2020 2020 2020 2020 2069 6620 693d 3d30           if i==0
+00067f00: 2061 6e64 206a 3d3d 303a 0d0a 2020 2020   and j==0:..    
+00067f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067f20: 7873 6869 6674 2c20 7973 6869 6674 2c20  xshift, yshift, 
+00067f30: 6363 6f72 7220 3d20 7365 6c66 2e73 7461  ccorr = self.sta
+00067f40: 636b 2e72 6567 6973 7465 725f 696d 6167  ck.register_imag
+00067f50: 6573 2872 6566 6572 656e 6365 696d 6167  es(referenceimag
+00067f60: 652c 2069 6d67 322c 0d0a 2020 2020 2020  e, img2,..      
+00067f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00067f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00067f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067fa0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00067fb0: 6467 655f 656e 6861 6e63 656d 656e 7420  dge_enhancement 
-00067fc0: 3d20 6564 6765 290d 0a20 2020 2020 2020  = edge)..       
-00067fd0: 2020 2020 2020 2020 2065 6c69 6620 693d           elif i=
-00067fe0: 3d73 656c 662e 7265 665f 696d 6167 655f  =self.ref_image_
-00067ff0: 696e 6465 7820 616e 6420 6a3d 3d73 656c  index and j==sel
-00068000: 662e 7265 665f 696d 6167 655f 696e 6465  f.ref_image_inde
-00068010: 785f 7468 6574 613a 0d0a 2020 2020 2020  x_theta:..      
-00068020: 2020 2020 2020 2020 2020 2020 2020 7873                xs
-00068030: 6869 6674 203d 2030 0d0a 2020 2020 2020  hift = 0..      
-00068040: 2020 2020 2020 2020 2020 2020 2020 7973                ys
-00068050: 6869 6674 203d 2030 0d0a 2020 2020 2020  hift = 0..      
-00068060: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-00068070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00068080: 2020 2020 2078 7368 6966 742c 2079 7368       xshift, ysh
-00068090: 6966 742c 2063 636f 7272 203d 2073 656c  ift, ccorr = sel
-000680a0: 662e 7374 6163 6b2e 7265 6769 7374 6572  f.stack.register
-000680b0: 5f69 6d61 6765 7328 7265 6665 7265 6e63  _images(referenc
-000680c0: 6569 6d61 6765 2c20 696d 6732 2c0d 0a20  eimage, img2,.. 
-000680d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000680e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000680f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068100: 2020 2020 2020 2020 2020 2020 2068 6176               hav
-00068110: 655f 7265 665f 696d 675f 6666 7420 3d20  e_ref_img_fft = 
-00068120: 5472 7565 2c0d 0a20 2020 2020 2020 2020  True,..         
+00067fa0: 2020 2020 2020 2020 6861 7665 5f72 6566          have_ref
+00067fb0: 5f69 6d67 5f66 6674 203d 2046 616c 7365  _img_fft = False
+00067fc0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00067fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068000: 2065 6467 655f 656e 6861 6e63 656d 656e   edge_enhancemen
+00068010: 7420 3d20 6564 6765 290d 0a20 2020 2020  t = edge)..     
+00068020: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00068030: 693d 3d73 656c 662e 7265 665f 696d 6167  i==self.ref_imag
+00068040: 655f 696e 6465 7820 616e 6420 6a3d 3d73  e_index and j==s
+00068050: 656c 662e 7265 665f 696d 6167 655f 696e  elf.ref_image_in
+00068060: 6465 785f 7468 6574 613a 0d0a 2020 2020  dex_theta:..    
+00068070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068080: 7873 6869 6674 203d 2030 0d0a 2020 2020  xshift = 0..    
+00068090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000680a0: 7973 6869 6674 203d 2030 0d0a 2020 2020  yshift = 0..    
+000680b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000680c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000680d0: 2020 2020 2020 2078 7368 6966 742c 2079         xshift, y
+000680e0: 7368 6966 742c 2063 636f 7272 203d 2073  shift, ccorr = s
+000680f0: 656c 662e 7374 6163 6b2e 7265 6769 7374  elf.stack.regist
+00068100: 6572 5f69 6d61 6765 7328 7265 6665 7265  er_images(refere
+00068110: 6e63 6569 6d61 6765 2c20 696d 6732 2c0d  nceimage, img2,.
+00068120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00068130: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00068140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068160: 2020 2020 2065 6467 655f 656e 6861 6e63       edge_enhanc
-00068170: 656d 656e 7420 3d20 2065 6467 6529 0d0a  ement =  edge)..
-00068180: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00068190: 2020 234c 696d 6974 2074 6865 2073 6869    #Limit the shi
-000681a0: 6674 7320 746f 204d 4158 5348 4946 5420  fts to MAXSHIFT 
-000681b0: 6368 6f73 656e 2062 7920 7468 6520 7573  chosen by the us
-000681c0: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
-000681d0: 2020 2020 6966 2028 7365 6c66 2e6d 6178      if (self.max
-000681e0: 7368 6966 7420 3e20 3029 3a0d 0a20 2020  shift > 0):..   
-000681f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068200: 2069 6620 2861 6273 2878 7368 6966 7429   if (abs(xshift)
-00068210: 203e 2073 656c 662e 6d61 7873 6869 6674   > self.maxshift
-00068220: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00068230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068240: 7873 6869 6674 203d 206e 702e 7369 676e  xshift = np.sign
-00068250: 2878 7368 6966 7429 2a73 656c 662e 6d61  (xshift)*self.ma
-00068260: 7873 6869 6674 0d0a 2020 2020 2020 2020  xshift..        
-00068270: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00068280: 6162 7328 7973 6869 6674 2920 3e20 7365  abs(yshift) > se
-00068290: 6c66 2e6d 6178 7368 6966 7429 3a0d 0a20  lf.maxshift):.. 
-000682a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000682b0: 2020 2020 2020 2020 2020 2079 7368 6966             yshif
-000682c0: 7420 3d20 6e70 2e73 6967 6e28 7973 6869  t = np.sign(yshi
-000682d0: 6674 292a 7365 6c66 2e6d 6178 7368 6966  ft)*self.maxshif
-000682e0: 740d 0a0d 0a20 2020 2020 2020 2020 2020  t....           
-000682f0: 2020 2020 2073 656c 662e 7873 6869 6674       self.xshift
-00068300: 735b 692c 6a5d 203d 2078 7368 6966 740d  s[i,j] = xshift.
-00068310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00068320: 2073 656c 662e 7973 6869 6674 735b 692c   self.yshifts[i,
-00068330: 6a5d 203d 2079 7368 6966 740d 0a20 2020  j] = yshift..   
-00068340: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00068350: 662e 506c 6f74 5368 6966 7473 2829 0d0a  f.PlotShifts()..
-00068360: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00068370: 2020 6966 2073 656c 662e 7368 6f77 6363    if self.showcc
-00068380: 6f72 7220 3d3d 2031 3a0d 0a20 2020 2020  orr == 1:..     
+00068150: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00068160: 6176 655f 7265 665f 696d 675f 6666 7420  ave_ref_img_fft 
+00068170: 3d20 5472 7565 2c0d 0a20 2020 2020 2020  = True,..       
+00068180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000681a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000681b0: 2020 2020 2020 2065 6467 655f 656e 6861         edge_enha
+000681c0: 6e63 656d 656e 7420 3d20 2065 6467 6529  ncement =  edge)
+000681d0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+000681e0: 2020 2020 234c 696d 6974 2074 6865 2073      #Limit the s
+000681f0: 6869 6674 7320 746f 204d 4158 5348 4946  hifts to MAXSHIF
+00068200: 5420 6368 6f73 656e 2062 7920 7468 6520  T chosen by the 
+00068210: 7573 6572 0d0a 2020 2020 2020 2020 2020  user..          
+00068220: 2020 2020 2020 6966 2028 7365 6c66 2e6d        if (self.m
+00068230: 6178 7368 6966 7420 3e20 3029 3a0d 0a20  axshift > 0):.. 
+00068240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068250: 2020 2069 6620 2861 6273 2878 7368 6966     if (abs(xshif
+00068260: 7429 203e 2073 656c 662e 6d61 7873 6869  t) > self.maxshi
+00068270: 6674 293a 0d0a 2020 2020 2020 2020 2020  ft):..          
+00068280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068290: 2020 7873 6869 6674 203d 206e 702e 7369    xshift = np.si
+000682a0: 676e 2878 7368 6966 7429 2a73 656c 662e  gn(xshift)*self.
+000682b0: 6d61 7873 6869 6674 0d0a 2020 2020 2020  maxshift..      
+000682c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000682d0: 2028 6162 7328 7973 6869 6674 2920 3e20   (abs(yshift) > 
+000682e0: 7365 6c66 2e6d 6178 7368 6966 7429 3a0d  self.maxshift):.
+000682f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00068300: 2020 2020 2020 2020 2020 2020 2079 7368               ysh
+00068310: 6966 7420 3d20 6e70 2e73 6967 6e28 7973  ift = np.sign(ys
+00068320: 6869 6674 292a 7365 6c66 2e6d 6178 7368  hift)*self.maxsh
+00068330: 6966 740d 0a0d 0a20 2020 2020 2020 2020  ift....         
+00068340: 2020 2020 2020 2073 656c 662e 7873 6869         self.xshi
+00068350: 6674 735b 692c 6a5d 203d 2078 7368 6966  fts[i,j] = xshif
+00068360: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
+00068370: 2020 2073 656c 662e 7973 6869 6674 735b     self.yshifts[
+00068380: 692c 6a5d 203d 2079 7368 6966 740d 0a20  i,j] = yshift.. 
 00068390: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000683a0: 656c 662e 5368 6f77 4372 6f73 7343 6f72  elf.ShowCrossCor
-000683b0: 7265 6c61 7469 6f6e 2863 636f 7272 2c20  relation(ccorr, 
-000683c0: 7873 6869 6674 2c20 7973 6869 6674 290d  xshift, yshift).
-000683d0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-000683e0: 2020 2051 436f 7265 4170 706c 6963 6174     QCoreApplicat
-000683f0: 696f 6e2e 7072 6f63 6573 7345 7665 6e74  ion.processEvent
-00068400: 7328 290d 0a0d 0a0d 0a20 2020 2020 2020  s()......       
-00068410: 2023 4170 706c 7920 7368 6966 7473 0d0a   #Apply shifts..
-00068420: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-00068430: 2072 616e 6765 2873 656c 662e 7374 6163   range(self.stac
-00068440: 6b2e 6e5f 6576 293a 0d0a 2020 2020 2020  k.n_ev):..      
-00068450: 2020 2020 2020 666f 7220 6a20 696e 2072        for j in r
-00068460: 616e 6765 2873 656c 662e 7374 6163 6b2e  ange(self.stack.
-00068470: 6e5f 7468 6574 6129 3a0d 0a20 2020 2020  n_theta):..     
-00068480: 2020 2020 2020 2020 2020 2069 6d67 203d             img =
-00068490: 2073 656c 662e 616c 6967 6e65 645f 7374   self.aligned_st
-000684a0: 6163 6b5b 3a2c 3a2c 692c 6a5d 0d0a 2020  ack[:,:,i,j]..  
-000684b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000684c0: 2028 6162 7328 7365 6c66 2e78 7368 6966   (abs(self.xshif
-000684d0: 7473 5b69 2c6a 5d29 3e30 2e30 3229 206f  ts[i,j])>0.02) o
-000684e0: 7220 2861 6273 2873 656c 662e 7973 6869  r (abs(self.yshi
-000684f0: 6674 735b 692c 6a5d 293e 302e 3032 293a  fts[i,j])>0.02):
-00068500: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00068510: 2020 2020 2020 7368 6966 7465 645f 696d        shifted_im
-00068520: 6720 3d20 7365 6c66 2e73 7461 636b 2e61  g = self.stack.a
-00068530: 7070 6c79 5f69 6d61 6765 5f72 6567 6973  pply_image_regis
-00068540: 7472 6174 696f 6e28 696d 672c 0d0a 2020  tration(img,..  
-00068550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068590: 2020 2020 7365 6c66 2e78 7368 6966 7473      self.xshifts
-000685a0: 5b69 2c6a 5d2c 0d0a 2020 2020 2020 2020  [i,j],..        
+000683a0: 656c 662e 506c 6f74 5368 6966 7473 2829  elf.PlotShifts()
+000683b0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+000683c0: 2020 2020 6966 2073 656c 662e 7368 6f77      if self.show
+000683d0: 6363 6f72 7220 3d3d 2031 3a0d 0a20 2020  ccorr == 1:..   
+000683e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000683f0: 2073 656c 662e 5368 6f77 4372 6f73 7343   self.ShowCrossC
+00068400: 6f72 7265 6c61 7469 6f6e 2863 636f 7272  orrelation(ccorr
+00068410: 2c20 7873 6869 6674 2c20 7973 6869 6674  , xshift, yshift
+00068420: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00068430: 2020 2020 2051 436f 7265 4170 706c 6963       QCoreApplic
+00068440: 6174 696f 6e2e 7072 6f63 6573 7345 7665  ation.processEve
+00068450: 6e74 7328 290d 0a0d 0a0d 0a20 2020 2020  nts()......     
+00068460: 2020 2023 4170 706c 7920 7368 6966 7473     #Apply shifts
+00068470: 0d0a 2020 2020 2020 2020 666f 7220 6920  ..        for i 
+00068480: 696e 2072 616e 6765 2873 656c 662e 7374  in range(self.st
+00068490: 6163 6b2e 6e5f 6576 293a 0d0a 2020 2020  ack.n_ev):..    
+000684a0: 2020 2020 2020 2020 666f 7220 6a20 696e          for j in
+000684b0: 2072 616e 6765 2873 656c 662e 7374 6163   range(self.stac
+000684c0: 6b2e 6e5f 7468 6574 6129 3a0d 0a20 2020  k.n_theta):..   
+000684d0: 2020 2020 2020 2020 2020 2020 2069 6d67               img
+000684e0: 203d 2073 656c 662e 616c 6967 6e65 645f   = self.aligned_
+000684f0: 7374 6163 6b5b 3a2c 3a2c 692c 6a5d 0d0a  stack[:,:,i,j]..
+00068500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068510: 6966 2028 6162 7328 7365 6c66 2e78 7368  if (abs(self.xsh
+00068520: 6966 7473 5b69 2c6a 5d29 3e30 2e30 3229  ifts[i,j])>0.02)
+00068530: 206f 7220 2861 6273 2873 656c 662e 7973   or (abs(self.ys
+00068540: 6869 6674 735b 692c 6a5d 293e 302e 3032  hifts[i,j])>0.02
+00068550: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00068560: 2020 2020 2020 2020 7368 6966 7465 645f          shifted_
+00068570: 696d 6720 3d20 7365 6c66 2e73 7461 636b  img = self.stack
+00068580: 2e61 7070 6c79 5f69 6d61 6765 5f72 6567  .apply_image_reg
+00068590: 6973 7472 6174 696f 6e28 696d 672c 0d0a  istration(img,..
+000685a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000685b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000685c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000685d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000685e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000685f0: 6c66 2e79 7368 6966 7473 5b69 2c6a 5d29  lf.yshifts[i,j])
-00068600: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00068610: 2020 2020 2020 7365 6c66 2e61 6c69 676e        self.align
-00068620: 6564 5f73 7461 636b 5b3a 2c3a 2c69 2c6a  ed_stack[:,:,i,j
-00068630: 5d20 3d20 7368 6966 7465 645f 696d 670d  ] = shifted_img.
-00068640: 0a0d 0a0d 0a20 2020 2020 2020 2073 656c  .....        sel
-00068650: 662e 6974 6865 7461 203d 2074 656d 7074  f.itheta = tempt
-00068660: 6865 7461 0d0a 2020 2020 2020 2020 7365  heta..        se
-00068670: 6c66 2e72 6567 6973 745f 6361 6c63 756c  lf.regist_calcul
-00068680: 6174 6564 203d 2031 0d0a 2020 2020 2020  ated = 1..      
-00068690: 2020 7365 6c66 2e69 6576 203d 2030 0d0a    self.iev = 0..
-000686a0: 2020 2020 2020 2020 7365 6c66 2e53 686f          self.Sho
-000686b0: 7749 6d61 6765 2829 0d0a 2020 2020 2020  wImage()..      
-000686c0: 2020 7365 6c66 2e73 6c69 6465 725f 656e    self.slider_en
-000686d0: 672e 7365 7456 616c 7565 2873 656c 662e  g.setValue(self.
-000686e0: 6965 7629 0d0a 0d0a 2020 2020 2020 2020  iev)....        
-000686f0: 7365 6c66 2e55 7064 6174 6557 6964 6765  self.UpdateWidge
-00068700: 7473 2829 0d0a 0d0a 0d0a 2020 2020 2020  ts()......      
-00068710: 2020 6d69 6e5f 7873 6869 6674 203d 206e    min_xshift = n
-00068720: 702e 6d69 6e28 7365 6c66 2e78 7368 6966  p.min(self.xshif
-00068730: 7473 290d 0a20 2020 2020 2020 206d 6178  ts)..        max
-00068740: 5f78 7368 6966 7420 3d20 6e70 2e6d 6178  _xshift = np.max
-00068750: 2873 656c 662e 7873 6869 6674 7329 0d0a  (self.xshifts)..
-00068760: 0d0a 2020 2020 2020 2020 6d69 6e5f 7973  ..        min_ys
-00068770: 6869 6674 203d 206e 702e 6d69 6e28 7365  hift = np.min(se
-00068780: 6c66 2e79 7368 6966 7473 290d 0a20 2020  lf.yshifts)..   
-00068790: 2020 2020 206d 6178 5f79 7368 6966 7420       max_yshift 
-000687a0: 3d20 6e70 2e6d 6178 2873 656c 662e 7973  = np.max(self.ys
-000687b0: 6869 6674 7329 0d0a 0d0a 2020 2020 2020  hifts)....      
-000687c0: 2020 6966 206d 696e 5f78 7368 6966 7420    if min_xshift 
-000687d0: 3c20 7365 6c66 2e6d 696e 7873 203a 2073  < self.minxs : s
-000687e0: 656c 662e 6d69 6e78 7320 3d20 6d69 6e5f  elf.minxs = min_
-000687f0: 7873 6869 6674 0d0a 2020 2020 2020 2020  xshift..        
-00068800: 6966 206d 6178 5f78 7368 6966 7420 3e20  if max_xshift > 
-00068810: 7365 6c66 2e6d 6178 7873 203a 2073 656c  self.maxxs : sel
-00068820: 662e 6d61 7878 7320 3d20 6d61 785f 7873  f.maxxs = max_xs
-00068830: 6869 6674 0d0a 0d0a 2020 2020 2020 2020  hift....        
-00068840: 6966 206d 696e 5f79 7368 6966 7420 3c20  if min_yshift < 
-00068850: 7365 6c66 2e6d 696e 7973 203a 2073 656c  self.minys : sel
-00068860: 662e 6d69 6e79 7320 3d20 6d69 6e5f 7973  f.minys = min_ys
-00068870: 6869 6674 0d0a 2020 2020 2020 2020 6966  hift..        if
-00068880: 206d 6178 5f79 7368 6966 7420 3e20 7365   max_yshift > se
-00068890: 6c66 2e6d 6178 7973 203a 2073 656c 662e  lf.maxys : self.
-000688a0: 6d61 7879 7320 3d20 6d61 785f 7973 6869  maxys = max_yshi
-000688b0: 6674 0d0a 0d0a 0d0a 2020 2020 2020 2020  ft......        
-000688c0: 5174 5769 6467 6574 732e 5141 7070 6c69  QtWidgets.QAppli
-000688d0: 6361 7469 6f6e 2e72 6573 746f 7265 4f76  cation.restoreOv
-000688e0: 6572 7269 6465 4375 7273 6f72 2829 0d0a  errideCursor()..
-000688f0: 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ..#-------------
-00068900: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00068910: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00068920: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00068930: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
-00068940: 6566 204f 6e43 726f 7053 6869 6674 7328  ef OnCropShifts(
-00068950: 7365 6c66 2c20 6576 656e 7429 3a0d 0a0d  self, event):...
-00068960: 0a20 2020 2020 2020 2051 7457 6964 6765  .        QtWidge
-00068970: 7473 2e51 4170 706c 6963 6174 696f 6e2e  ts.QApplication.
-00068980: 7365 744f 7665 7272 6964 6543 7572 736f  setOverrideCurso
-00068990: 7228 5174 4775 692e 5143 7572 736f 7228  r(QtGui.QCursor(
-000689a0: 5174 2e57 6169 7443 7572 736f 7229 290d  Qt.WaitCursor)).
-000689b0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-000689c0: 616c 6967 6e65 645f 7374 6163 6b2c 2073  aligned_stack, s
-000689d0: 656c 662e 786c 6566 742c 2073 656c 662e  elf.xleft, self.
-000689e0: 7872 6967 6874 2c20 7365 6c66 2e79 626f  xright, self.ybo
-000689f0: 7474 6f6d 2c20 7365 6c66 2e79 746f 702c  ttom, self.ytop,
-00068a00: 203d 2073 656c 662e 7374 6163 6b2e 6372   = self.stack.cr
-00068a10: 6f70 5f72 6567 6973 7465 645f 696d 6167  op_registed_imag
-00068a20: 6573 2873 656c 662e 616c 6967 6e65 645f  es(self.aligned_
-00068a30: 7374 6163 6b2c 0d0a 2020 2020 2020 2020  stack,..        
-00068a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068a70: 2020 2020 2073 656c 662e 6d69 6e78 732c       self.minxs,
-00068a80: 2073 656c 662e 6d61 7878 732c 2073 656c   self.maxxs, sel
-00068a90: 662e 6d69 6e79 732c 2073 656c 662e 6d61  f.minys, self.ma
-00068aa0: 7879 7329 0d0a 0d0a 0d0a 2020 2020 2020  xys)......      
-00068ab0: 2020 7365 6c66 2e69 6576 203d 2030 0d0a    self.iev = 0..
-00068ac0: 2020 2020 2020 2020 7365 6c66 2e53 686f          self.Sho
-00068ad0: 7749 6d61 6765 2829 0d0a 2020 2020 2020  wImage()..      
-00068ae0: 2020 7365 6c66 2e73 6c69 6465 725f 656e    self.slider_en
-00068af0: 672e 7365 7456 616c 7565 2873 656c 662e  g.setValue(self.
-00068b00: 6965 7629 0d0a 0d0a 2020 2020 2020 2020  iev)....        
-00068b10: 5174 5769 6467 6574 732e 5141 7070 6c69  QtWidgets.QAppli
-00068b20: 6361 7469 6f6e 2e72 6573 746f 7265 4f76  cation.restoreOv
-00068b30: 6572 7269 6465 4375 7273 6f72 2829 0d0a  errideCursor()..
-00068b40: 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d  ....#-----------
-00068b50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00068b60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00068b70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00068b80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020  -----------..   
-00068b90: 2064 6566 204f 6e50 6963 6b52 6566 506f   def OnPickRefPo
-00068ba0: 696e 7428 7365 6c66 2c20 6576 656e 7429  int(self, event)
-00068bb0: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-00068bc0: 6d61 6e5f 616c 6967 6e20 3d20 310d 0a0d  man_align = 1...
-00068bd0: 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ...#------------
-00068be0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00068bf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00068c00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00068c10: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
-00068c20: 6465 6620 4f6e 506f 696e 7452 6566 696d  def OnPointRefim
-00068c30: 6167 6528 7365 6c66 2c20 6576 7429 3a0d  age(self, evt):.
-00068c40: 0a0d 0a0d 0a20 2020 2020 2020 2078 203d  .....        x =
-00068c50: 2065 7674 2e78 6461 7461 0d0a 2020 2020   evt.xdata..    
-00068c60: 2020 2020 7920 3d20 6576 742e 7964 6174      y = evt.ydat
-00068c70: 610d 0a0d 0a20 2020 2020 2020 2069 6620  a....        if 
-00068c80: 2878 203d 3d20 4e6f 6e65 2920 6f72 2028  (x == None) or (
-00068c90: 7920 3d3d 204e 6f6e 6529 3a0d 0a20 2020  y == None):..   
-00068ca0: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
-00068cb0: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
-00068cc0: 6c66 2e73 7562 7265 6769 6f6e 203d 3d20  lf.subregion == 
-00068cd0: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
-00068ce0: 7365 6c66 2e73 725f 7831 203d 2078 0d0a  self.sr_x1 = x..
-00068cf0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00068d00: 2e73 725f 7931 203d 2079 0d0a 2020 2020  .sr_y1 = y..    
-00068d10: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-00068d20: 746f 6e5f 7072 6573 7365 6420 3d20 5472  ton_pressed = Tr
-00068d30: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-00068d40: 7365 6c66 2e6d 6f75 7365 6d6f 7665 636f  self.mousemoveco
-00068d50: 6e6e 203d 2073 656c 662e 5265 6649 6d61  nn = self.RefIma
-00068d60: 6765 5061 6e65 6c2e 6d70 6c5f 636f 6e6e  gePanel.mpl_conn
-00068d70: 6563 7428 276d 6f74 696f 6e5f 6e6f 7469  ect('motion_noti
-00068d80: 6679 5f65 7665 6e74 272c 2073 656c 662e  fy_event', self.
-00068d90: 4f6e 5365 6c65 6374 696f 6e4d 6f74 696f  OnSelectionMotio
-00068da0: 6e29 0d0a 2020 2020 2020 2020 2020 2020  n)..            
-00068db0: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
-00068dc0: 2020 6966 2073 656c 662e 6d61 6e5f 616c    if self.man_al
-00068dd0: 6967 6e20 3d3d 2030 3a0d 0a20 2020 2020  ign == 0:..     
-00068de0: 2020 2020 2020 2070 6173 730d 0a0d 0a20         pass.... 
-00068df0: 2020 2020 2020 2069 6620 2873 656c 662e         if (self.
-00068e00: 6d61 6e5f 616c 6967 6e20 3d3d 2031 293a  man_align == 1):
-00068e10: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00068e20: 6c66 2e6d 616e 5f78 7265 6620 3d20 696e  lf.man_xref = in
-00068e30: 7428 6e70 2e66 6c6f 6f72 2878 2929 0d0a  t(np.floor(x))..
-00068e40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00068e50: 2e6d 616e 5f79 7265 6620 3d20 696e 7428  .man_yref = int(
-00068e60: 6e70 2e66 6c6f 6f72 2879 2929 0d0a 0d0a  np.floor(y))....
-00068e70: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00068e80: 656c 662e 6d61 6e5f 7872 6566 3c30 203a  elf.man_xref<0 :
-00068e90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00068ea0: 2020 7365 6c66 2e6d 616e 5f78 7265 663d    self.man_xref=
-00068eb0: 300d 0a20 2020 2020 2020 2020 2020 2069  0..            i
-00068ec0: 6620 7365 6c66 2e6d 616e 5f78 7265 663e  f self.man_xref>
-00068ed0: 7365 6c66 2e73 7461 636b 2e6e 5f63 6f6c  self.stack.n_col
-00068ee0: 7320 3a0d 0a20 2020 2020 2020 2020 2020  s :..           
-00068ef0: 2020 2020 2073 656c 662e 6d61 6e5f 7872       self.man_xr
-00068f00: 6566 3d73 656c 662e 7374 6163 6b2e 6e5f  ef=self.stack.n_
-00068f10: 636f 6c73 0d0a 2020 2020 2020 2020 2020  cols..          
-00068f20: 2020 6966 2073 656c 662e 6d61 6e5f 7972    if self.man_yr
-00068f30: 6566 3c30 203a 0d0a 2020 2020 2020 2020  ef<0 :..        
-00068f40: 2020 2020 2020 2020 7365 6c66 2e6d 616e          self.man
-00068f50: 5f79 7265 663d 300d 0a20 2020 2020 2020  _yref=0..       
-00068f60: 2020 2020 2069 6620 7365 6c66 2e6d 616e       if self.man
-00068f70: 5f79 7265 663e 7365 6c66 2e73 7461 636b  _yref>self.stack
-00068f80: 2e6e 5f72 6f77 7320 3a0d 0a20 2020 2020  .n_rows :..     
-00068f90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00068fa0: 6d61 6e5f 7972 6566 3d73 656c 662e 7374  man_yref=self.st
-00068fb0: 6163 6b2e 6e5f 726f 7773 0d0a 0d0a 0d0a  ack.n_rows......
-00068fc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00068fd0: 2e55 7064 6174 6557 6964 6765 7473 2829  .UpdateWidgets()
-00068fe0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00068ff0: 7365 6c66 2e53 686f 7752 6566 496d 6167  self.ShowRefImag
-00069000: 6528 290d 0a0d 0a0d 0a23 2d2d 2d2d 2d2d  e()......#------
-00069010: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00069020: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00069030: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00069040: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00069050: 0d0a 2020 2020 6465 6620 4f6e 5069 636b  ..    def OnPick
-00069060: 436f 7272 506f 696e 7428 7365 6c66 293a  CorrPoint(self):
-00069070: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00069080: 2e6d 616e 5f61 6c69 676e 203d 2032 0d0a  .man_align = 2..
-00069090: 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ..#-------------
-000690a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000690b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000690c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000690d0: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
-000690e0: 6566 204f 6e50 6f69 6e74 436f 7272 696d  ef OnPointCorrim
-000690f0: 6167 6528 7365 6c66 2c20 6576 7429 3a0d  age(self, evt):.
-00069100: 0a0d 0a20 2020 2020 2020 2078 203d 2065  ...        x = e
-00069110: 7674 2e78 6461 7461 0d0a 2020 2020 2020  vt.xdata..      
-00069120: 2020 7920 3d20 6576 742e 7964 6174 610d    y = evt.ydata.
-00069130: 0a0d 0a20 2020 2020 2020 2069 6620 2873  ...        if (s
-00069140: 656c 662e 6d61 6e5f 616c 6967 6e20 3d3d  elf.man_align ==
-00069150: 2032 293a 0d0a 2020 2020 2020 2020 2020   2):..          
-00069160: 2020 7863 6f72 7220 3d20 666c 6f61 7428    xcorr = float(
-00069170: 7829 0d0a 2020 2020 2020 2020 2020 2020  x)..            
-00069180: 7963 6f72 7220 3d20 666c 6f61 7428 7929  ycorr = float(y)
-00069190: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000691a0: 6966 2078 636f 7272 3c30 203a 0d0a 2020  if xcorr<0 :..  
-000691b0: 2020 2020 2020 2020 2020 2020 2020 7863                xc
-000691c0: 6f72 723d 300d 0a20 2020 2020 2020 2020  orr=0..         
-000691d0: 2020 2069 6620 7863 6f72 723e 7365 6c66     if xcorr>self
-000691e0: 2e73 7461 636b 2e6e 5f63 6f6c 7320 3a0d  .stack.n_cols :.
-000691f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00069200: 2078 636f 7272 3d73 656c 662e 7374 6163   xcorr=self.stac
-00069210: 6b2e 6e5f 636f 6c73 0d0a 2020 2020 2020  k.n_cols..      
-00069220: 2020 2020 2020 6966 2079 636f 7272 3c30        if ycorr<0
-00069230: 203a 0d0a 2020 2020 2020 2020 2020 2020   :..            
-00069240: 2020 2020 7963 6f72 723d 300d 0a20 2020      ycorr=0..   
-00069250: 2020 2020 2020 2020 2069 6620 7963 6f72           if ycor
-00069260: 723e 7365 6c66 2e73 7461 636b 2e6e 5f72  r>self.stack.n_r
-00069270: 6f77 7320 3a0d 0a20 2020 2020 2020 2020  ows :..         
-00069280: 2020 2020 2020 2079 636f 7272 3d73 656c         ycorr=sel
-00069290: 662e 7374 6163 6b2e 6e5f 726f 7773 0d0a  f.stack.n_rows..
-000692a0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000692b0: 6966 2073 656c 662e 636f 6d2e 7374 6163  if self.com.stac
-000692c0: 6b5f 3464 203d 3d20 303a 0d0a 2020 2020  k_4d == 0:..    
-000692d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000692e0: 2e6d 616e 5f78 735b 7365 6c66 2e69 6576  .man_xs[self.iev
-000692f0: 5d20 3d20 7365 6c66 2e6d 616e 5f78 7265  ] = self.man_xre
-00069300: 6620 2d20 7863 6f72 720d 0a20 2020 2020  f - xcorr..     
-00069310: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00069320: 6d61 6e5f 7973 5b73 656c 662e 6965 765d  man_ys[self.iev]
-00069330: 203d 202d 312e 302a 2873 656c 662e 6d61   = -1.0*(self.ma
-00069340: 6e5f 7972 6566 202d 2079 636f 7272 290d  n_yref - ycorr).
-00069350: 0a0d 0a0d 0a20 2020 2020 2020 2020 2020  .....           
-00069360: 2020 2020 2073 656c 662e 7465 7874 6374       self.textct
-00069370: 726c 5f6d 7331 2e73 6574 5465 7874 2827  rl_ms1.setText('
-00069380: 5820 6d61 6e75 616c 2073 6869 6674 3a20  X manual shift: 
-00069390: 207b 303a 352e 3266 7d20 2070 6978 656c   {0:5.2f}  pixel
-000693a0: 735c 6e27 2e66 6f72 6d61 7428 7365 6c66  s\n'.format(self
-000693b0: 2e6d 616e 5f78 735b 7365 6c66 2e69 6576  .man_xs[self.iev
-000693c0: 5d29 290d 0a20 2020 2020 2020 2020 2020  ]))..           
-000693d0: 2020 2020 2073 656c 662e 7465 7874 6374       self.textct
-000693e0: 726c 5f6d 7332 2e73 6574 5465 7874 2827  rl_ms2.setText('
-000693f0: 5920 6d61 6e75 616c 2073 6869 6674 3a20  Y manual shift: 
-00069400: 207b 303a 352e 3266 7d20 2070 6978 656c   {0:5.2f}  pixel
-00069410: 7327 2e66 6f72 6d61 7428 7365 6c66 2e6d  s'.format(self.m
-00069420: 616e 5f79 735b 7365 6c66 2e69 6576 5d29  an_ys[self.iev])
-00069430: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00069440: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00069450: 2020 2020 2020 7365 6c66 2e6d 616e 5f78        self.man_x
-00069460: 735b 7365 6c66 2e69 6576 2c20 7365 6c66  s[self.iev, self
-00069470: 2e69 7468 6574 615d 203d 2073 656c 662e  .itheta] = self.
-00069480: 6d61 6e5f 7872 6566 202d 2078 636f 7272  man_xref - xcorr
-00069490: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000694a0: 2020 7365 6c66 2e6d 616e 5f79 735b 7365    self.man_ys[se
-000694b0: 6c66 2e69 6576 2c20 7365 6c66 2e69 7468  lf.iev, self.ith
-000694c0: 6574 615d 203d 202d 312e 302a 2873 656c  eta] = -1.0*(sel
-000694d0: 662e 6d61 6e5f 7972 6566 202d 2079 636f  f.man_yref - yco
-000694e0: 7272 290d 0a0d 0a0d 0a20 2020 2020 2020  rr)......       
-000694f0: 2020 2020 2020 2020 2073 656c 662e 7465           self.te
-00069500: 7874 6374 726c 5f6d 7331 2e73 6574 5465  xtctrl_ms1.setTe
-00069510: 7874 2827 5820 6d61 6e75 616c 2073 6869  xt('X manual shi
-00069520: 6674 3a20 207b 303a 352e 3266 7d20 2070  ft:  {0:5.2f}  p
-00069530: 6978 656c 735c 6e27 2e66 6f72 6d61 7428  ixels\n'.format(
-00069540: 7365 6c66 2e6d 616e 5f78 735b 7365 6c66  self.man_xs[self
-00069550: 2e69 6576 2c20 7365 6c66 2e69 7468 6574  .iev, self.ithet
-00069560: 615d 2929 0d0a 2020 2020 2020 2020 2020  a]))..          
-00069570: 2020 2020 2020 7365 6c66 2e74 6578 7463        self.textc
-00069580: 7472 6c5f 6d73 322e 7365 7454 6578 7428  trl_ms2.setText(
-00069590: 2759 206d 616e 7561 6c20 7368 6966 743a  'Y manual shift:
-000695a0: 2020 7b30 3a35 2e32 667d 2020 7069 7865    {0:5.2f}  pixe
-000695b0: 6c73 272e 666f 726d 6174 2873 656c 662e  ls'.format(self.
-000695c0: 6d61 6e5f 7973 5b73 656c 662e 6965 762c  man_ys[self.iev,
-000695d0: 2073 656c 662e 6974 6865 7461 5d29 290d   self.itheta])).
-000695e0: 0a0d 0a20 2020 2020 2020 2020 2020 2073  ...            s
-000695f0: 656c 662e 6965 7620 3d20 7365 6c66 2e69  elf.iev = self.i
-00069600: 6576 202b 2031 0d0a 2020 2020 2020 2020  ev + 1..        
-00069610: 2020 2020 6966 2073 656c 662e 6965 7620      if self.iev 
-00069620: 3e20 2873 656c 662e 7374 6163 6b2e 6e5f  > (self.stack.n_
-00069630: 6576 2d31 293a 0d0a 2020 2020 2020 2020  ev-1):..        
-00069640: 2020 2020 2020 2020 7365 6c66 2e69 6576          self.iev
-00069650: 203d 2030 0d0a 0d0a 2020 2020 2020 2020   = 0....        
-00069660: 2020 2020 7365 6c66 2e73 6c69 6465 725f      self.slider_
-00069670: 656e 672e 7365 7456 616c 7565 2873 656c  eng.setValue(sel
-00069680: 662e 6965 7629 0d0a 0d0a 0d0a 2020 2020  f.iev)......    
-00069690: 2020 2020 2020 2020 7365 6c66 2e53 686f          self.Sho
-000696a0: 7749 6d61 6765 2829 0d0a 2020 2020 2020  wImage()..      
-000696b0: 2020 2020 2020 7365 6c66 2e55 7064 6174        self.Updat
-000696c0: 6557 6964 6765 7473 2829 0d0a 0d0a 232d  eWidgets()....#-
-000696d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000696e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000696f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00069700: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00069710: 2d2d 2d2d 2d0d 0a20 2020 2064 6566 204f  -----..    def O
-00069720: 6e41 7070 6c79 4d61 6e53 6869 6674 7328  nApplyManShifts(
-00069730: 7365 6c66 293a 0d0a 0d0a 0d0a 2020 2020  self):......    
-00069740: 2020 2020 6966 2073 656c 662e 636f 6d2e      if self.com.
-00069750: 7374 6163 6b5f 3464 203d 3d20 303a 0d0a  stack_4d == 0:..
-00069760: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00069770: 6920 696e 2072 616e 6765 2873 656c 662e  i in range(self.
-00069780: 7374 6163 6b2e 6e5f 6576 293a 0d0a 0d0a  stack.n_ev):....
-00069790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000697a0: 696d 6720 3d20 7365 6c66 2e61 6c69 676e  img = self.align
-000697b0: 6564 5f73 7461 636b 5b3a 2c3a 2c69 5d0d  ed_stack[:,:,i].
-000697c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000697d0: 2069 6620 2861 6273 2873 656c 662e 6d61   if (abs(self.ma
-000697e0: 6e5f 7873 5b69 5d29 3e30 2e30 3229 206f  n_xs[i])>0.02) o
-000697f0: 7220 2861 6273 2873 656c 662e 6d61 6e5f  r (abs(self.man_
-00069800: 7973 5b69 5d29 3e30 2e30 3229 3a0d 0a20  ys[i])>0.02):.. 
-00069810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069820: 2020 2073 6869 6674 6564 5f69 6d67 203d     shifted_img =
-00069830: 2073 656c 662e 7374 6163 6b2e 6170 706c   self.stack.appl
-00069840: 795f 696d 6167 655f 7265 6769 7374 7261  y_image_registra
-00069850: 7469 6f6e 2869 6d67 2c0d 0a20 2020 2020  tion(img,..     
-00069860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000698a0: 2073 656c 662e 6d61 6e5f 7873 5b69 5d2c   self.man_xs[i],
-000698b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000685e0: 2020 2020 2020 7365 6c66 2e78 7368 6966        self.xshif
+000685f0: 7473 5b69 2c6a 5d2c 0d0a 2020 2020 2020  ts[i,j],..      
+00068600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068640: 7365 6c66 2e79 7368 6966 7473 5b69 2c6a  self.yshifts[i,j
+00068650: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00068660: 2020 2020 2020 2020 7365 6c66 2e61 6c69          self.ali
+00068670: 676e 6564 5f73 7461 636b 5b3a 2c3a 2c69  gned_stack[:,:,i
+00068680: 2c6a 5d20 3d20 7368 6966 7465 645f 696d  ,j] = shifted_im
+00068690: 670d 0a0d 0a0d 0a20 2020 2020 2020 2073  g......        s
+000686a0: 656c 662e 6974 6865 7461 203d 2074 656d  elf.itheta = tem
+000686b0: 7074 6865 7461 0d0a 2020 2020 2020 2020  ptheta..        
+000686c0: 7365 6c66 2e72 6567 6973 745f 6361 6c63  self.regist_calc
+000686d0: 756c 6174 6564 203d 2031 0d0a 2020 2020  ulated = 1..    
+000686e0: 2020 2020 7365 6c66 2e69 6576 203d 2030      self.iev = 0
+000686f0: 0d0a 2020 2020 2020 2020 7365 6c66 2e53  ..        self.S
+00068700: 686f 7749 6d61 6765 2829 0d0a 2020 2020  howImage()..    
+00068710: 2020 2020 7365 6c66 2e73 6c69 6465 725f      self.slider_
+00068720: 656e 672e 7365 7456 616c 7565 2873 656c  eng.setValue(sel
+00068730: 662e 6965 7629 0d0a 0d0a 2020 2020 2020  f.iev)....      
+00068740: 2020 7365 6c66 2e55 7064 6174 6557 6964    self.UpdateWid
+00068750: 6765 7473 2829 0d0a 0d0a 0d0a 2020 2020  gets()......    
+00068760: 2020 2020 6d69 6e5f 7873 6869 6674 203d      min_xshift =
+00068770: 206e 702e 6d69 6e28 7365 6c66 2e78 7368   np.min(self.xsh
+00068780: 6966 7473 290d 0a20 2020 2020 2020 206d  ifts)..        m
+00068790: 6178 5f78 7368 6966 7420 3d20 6e70 2e6d  ax_xshift = np.m
+000687a0: 6178 2873 656c 662e 7873 6869 6674 7329  ax(self.xshifts)
+000687b0: 0d0a 0d0a 2020 2020 2020 2020 6d69 6e5f  ....        min_
+000687c0: 7973 6869 6674 203d 206e 702e 6d69 6e28  yshift = np.min(
+000687d0: 7365 6c66 2e79 7368 6966 7473 290d 0a20  self.yshifts).. 
+000687e0: 2020 2020 2020 206d 6178 5f79 7368 6966         max_yshif
+000687f0: 7420 3d20 6e70 2e6d 6178 2873 656c 662e  t = np.max(self.
+00068800: 7973 6869 6674 7329 0d0a 0d0a 2020 2020  yshifts)....    
+00068810: 2020 2020 6966 206d 696e 5f78 7368 6966      if min_xshif
+00068820: 7420 3c20 7365 6c66 2e6d 696e 7873 203a  t < self.minxs :
+00068830: 2073 656c 662e 6d69 6e78 7320 3d20 6d69   self.minxs = mi
+00068840: 6e5f 7873 6869 6674 0d0a 2020 2020 2020  n_xshift..      
+00068850: 2020 6966 206d 6178 5f78 7368 6966 7420    if max_xshift 
+00068860: 3e20 7365 6c66 2e6d 6178 7873 203a 2073  > self.maxxs : s
+00068870: 656c 662e 6d61 7878 7320 3d20 6d61 785f  elf.maxxs = max_
+00068880: 7873 6869 6674 0d0a 0d0a 2020 2020 2020  xshift....      
+00068890: 2020 6966 206d 696e 5f79 7368 6966 7420    if min_yshift 
+000688a0: 3c20 7365 6c66 2e6d 696e 7973 203a 2073  < self.minys : s
+000688b0: 656c 662e 6d69 6e79 7320 3d20 6d69 6e5f  elf.minys = min_
+000688c0: 7973 6869 6674 0d0a 2020 2020 2020 2020  yshift..        
+000688d0: 6966 206d 6178 5f79 7368 6966 7420 3e20  if max_yshift > 
+000688e0: 7365 6c66 2e6d 6178 7973 203a 2073 656c  self.maxys : sel
+000688f0: 662e 6d61 7879 7320 3d20 6d61 785f 7973  f.maxys = max_ys
+00068900: 6869 6674 0d0a 0d0a 0d0a 2020 2020 2020  hift......      
+00068910: 2020 5174 5769 6467 6574 732e 5141 7070    QtWidgets.QApp
+00068920: 6c69 6361 7469 6f6e 2e72 6573 746f 7265  lication.restore
+00068930: 4f76 6572 7269 6465 4375 7273 6f72 2829  OverrideCursor()
+00068940: 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d  ....#-----------
+00068950: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00068960: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00068970: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00068980: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020  -----------..   
+00068990: 2064 6566 204f 6e43 726f 7053 6869 6674   def OnCropShift
+000689a0: 7328 7365 6c66 2c20 6576 656e 7429 3a0d  s(self, event):.
+000689b0: 0a0d 0a20 2020 2020 2020 2051 7457 6964  ...        QtWid
+000689c0: 6765 7473 2e51 4170 706c 6963 6174 696f  gets.QApplicatio
+000689d0: 6e2e 7365 744f 7665 7272 6964 6543 7572  n.setOverrideCur
+000689e0: 736f 7228 5174 4775 692e 5143 7572 736f  sor(QtGui.QCurso
+000689f0: 7228 5174 2e57 6169 7443 7572 736f 7229  r(Qt.WaitCursor)
+00068a00: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+00068a10: 662e 616c 6967 6e65 645f 7374 6163 6b2c  f.aligned_stack,
+00068a20: 2073 656c 662e 786c 6566 742c 2073 656c   self.xleft, sel
+00068a30: 662e 7872 6967 6874 2c20 7365 6c66 2e79  f.xright, self.y
+00068a40: 626f 7474 6f6d 2c20 7365 6c66 2e79 746f  bottom, self.yto
+00068a50: 702c 203d 2073 656c 662e 7374 6163 6b2e  p, = self.stack.
+00068a60: 6372 6f70 5f72 6567 6973 7465 645f 696d  crop_registed_im
+00068a70: 6167 6573 2873 656c 662e 616c 6967 6e65  ages(self.aligne
+00068a80: 645f 7374 6163 6b2c 0d0a 2020 2020 2020  d_stack,..      
+00068a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068ac0: 2020 2020 2020 2073 656c 662e 6d69 6e78         self.minx
+00068ad0: 732c 2073 656c 662e 6d61 7878 732c 2073  s, self.maxxs, s
+00068ae0: 656c 662e 6d69 6e79 732c 2073 656c 662e  elf.minys, self.
+00068af0: 6d61 7879 7329 0d0a 0d0a 0d0a 2020 2020  maxys)......    
+00068b00: 2020 2020 7365 6c66 2e69 6576 203d 2030      self.iev = 0
+00068b10: 0d0a 2020 2020 2020 2020 7365 6c66 2e53  ..        self.S
+00068b20: 686f 7749 6d61 6765 2829 0d0a 2020 2020  howImage()..    
+00068b30: 2020 2020 7365 6c66 2e73 6c69 6465 725f      self.slider_
+00068b40: 656e 672e 7365 7456 616c 7565 2873 656c  eng.setValue(sel
+00068b50: 662e 6965 7629 0d0a 0d0a 2020 2020 2020  f.iev)....      
+00068b60: 2020 5174 5769 6467 6574 732e 5141 7070    QtWidgets.QApp
+00068b70: 6c69 6361 7469 6f6e 2e72 6573 746f 7265  lication.restore
+00068b80: 4f76 6572 7269 6465 4375 7273 6f72 2829  OverrideCursor()
+00068b90: 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d  ......#---------
+00068ba0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00068bb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00068bc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00068bd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20  -------------.. 
+00068be0: 2020 2064 6566 204f 6e50 6963 6b52 6566     def OnPickRef
+00068bf0: 506f 696e 7428 7365 6c66 2c20 6576 656e  Point(self, even
+00068c00: 7429 3a0d 0a20 2020 2020 2020 2073 656c  t):..        sel
+00068c10: 662e 6d61 6e5f 616c 6967 6e20 3d20 310d  f.man_align = 1.
+00068c20: 0a0d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d  .....#----------
+00068c30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00068c40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00068c50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00068c60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020  ------------..  
+00068c70: 2020 6465 6620 4f6e 506f 696e 7452 6566    def OnPointRef
+00068c80: 696d 6167 6528 7365 6c66 2c20 6576 7429  image(self, evt)
+00068c90: 3a0d 0a0d 0a0d 0a20 2020 2020 2020 2078  :......        x
+00068ca0: 203d 2065 7674 2e78 6461 7461 0d0a 2020   = evt.xdata..  
+00068cb0: 2020 2020 2020 7920 3d20 6576 742e 7964        y = evt.yd
+00068cc0: 6174 610d 0a0d 0a20 2020 2020 2020 2069  ata....        i
+00068cd0: 6620 2878 203d 3d20 4e6f 6e65 2920 6f72  f (x == None) or
+00068ce0: 2028 7920 3d3d 204e 6f6e 6529 3a0d 0a20   (y == None):.. 
+00068cf0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00068d00: 6e0d 0a0d 0a20 2020 2020 2020 2069 6620  n....        if 
+00068d10: 7365 6c66 2e73 7562 7265 6769 6f6e 203d  self.subregion =
+00068d20: 3d20 313a 0d0a 2020 2020 2020 2020 2020  = 1:..          
+00068d30: 2020 7365 6c66 2e73 725f 7831 203d 2078    self.sr_x1 = x
+00068d40: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00068d50: 6c66 2e73 725f 7931 203d 2079 0d0a 2020  lf.sr_y1 = y..  
+00068d60: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
+00068d70: 7574 746f 6e5f 7072 6573 7365 6420 3d20  utton_pressed = 
+00068d80: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+00068d90: 2020 7365 6c66 2e6d 6f75 7365 6d6f 7665    self.mousemove
+00068da0: 636f 6e6e 203d 2073 656c 662e 5265 6649  conn = self.RefI
+00068db0: 6d61 6765 5061 6e65 6c2e 6d70 6c5f 636f  magePanel.mpl_co
+00068dc0: 6e6e 6563 7428 276d 6f74 696f 6e5f 6e6f  nnect('motion_no
+00068dd0: 7469 6679 5f65 7665 6e74 272c 2073 656c  tify_event', sel
+00068de0: 662e 4f6e 5365 6c65 6374 696f 6e4d 6f74  f.OnSelectionMot
+00068df0: 696f 6e29 0d0a 2020 2020 2020 2020 2020  ion)..          
+00068e00: 2020 7265 7475 726e 0d0a 0d0a 2020 2020    return....    
+00068e10: 2020 2020 6966 2073 656c 662e 6d61 6e5f      if self.man_
+00068e20: 616c 6967 6e20 3d3d 2030 3a0d 0a20 2020  align == 0:..   
+00068e30: 2020 2020 2020 2020 2070 6173 730d 0a0d           pass...
+00068e40: 0a20 2020 2020 2020 2069 6620 2873 656c  .        if (sel
+00068e50: 662e 6d61 6e5f 616c 6967 6e20 3d3d 2031  f.man_align == 1
+00068e60: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00068e70: 7365 6c66 2e6d 616e 5f78 7265 6620 3d20  self.man_xref = 
+00068e80: 696e 7428 6e70 2e66 6c6f 6f72 2878 2929  int(np.floor(x))
+00068e90: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00068ea0: 6c66 2e6d 616e 5f79 7265 6620 3d20 696e  lf.man_yref = in
+00068eb0: 7428 6e70 2e66 6c6f 6f72 2879 2929 0d0a  t(np.floor(y))..
+00068ec0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00068ed0: 2073 656c 662e 6d61 6e5f 7872 6566 3c30   self.man_xref<0
+00068ee0: 203a 0d0a 2020 2020 2020 2020 2020 2020   :..            
+00068ef0: 2020 2020 7365 6c66 2e6d 616e 5f78 7265      self.man_xre
+00068f00: 663d 300d 0a20 2020 2020 2020 2020 2020  f=0..           
+00068f10: 2069 6620 7365 6c66 2e6d 616e 5f78 7265   if self.man_xre
+00068f20: 663e 7365 6c66 2e73 7461 636b 2e6e 5f63  f>self.stack.n_c
+00068f30: 6f6c 7320 3a0d 0a20 2020 2020 2020 2020  ols :..         
+00068f40: 2020 2020 2020 2073 656c 662e 6d61 6e5f         self.man_
+00068f50: 7872 6566 3d73 656c 662e 7374 6163 6b2e  xref=self.stack.
+00068f60: 6e5f 636f 6c73 0d0a 2020 2020 2020 2020  n_cols..        
+00068f70: 2020 2020 6966 2073 656c 662e 6d61 6e5f      if self.man_
+00068f80: 7972 6566 3c30 203a 0d0a 2020 2020 2020  yref<0 :..      
+00068f90: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+00068fa0: 616e 5f79 7265 663d 300d 0a20 2020 2020  an_yref=0..     
+00068fb0: 2020 2020 2020 2069 6620 7365 6c66 2e6d         if self.m
+00068fc0: 616e 5f79 7265 663e 7365 6c66 2e73 7461  an_yref>self.sta
+00068fd0: 636b 2e6e 5f72 6f77 7320 3a0d 0a20 2020  ck.n_rows :..   
+00068fe0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00068ff0: 662e 6d61 6e5f 7972 6566 3d73 656c 662e  f.man_yref=self.
+00069000: 7374 6163 6b2e 6e5f 726f 7773 0d0a 0d0a  stack.n_rows....
+00069010: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00069020: 6c66 2e55 7064 6174 6557 6964 6765 7473  lf.UpdateWidgets
+00069030: 2829 0d0a 0d0a 2020 2020 2020 2020 2020  ()....          
+00069040: 2020 7365 6c66 2e53 686f 7752 6566 496d    self.ShowRefIm
+00069050: 6167 6528 290d 0a0d 0a0d 0a23 2d2d 2d2d  age()......#----
+00069060: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00069070: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00069080: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00069090: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000690a0: 2d2d 0d0a 2020 2020 6465 6620 4f6e 5069  --..    def OnPi
+000690b0: 636b 436f 7272 506f 696e 7428 7365 6c66  ckCorrPoint(self
+000690c0: 293a 0d0a 0d0a 2020 2020 2020 2020 7365  ):....        se
+000690d0: 6c66 2e6d 616e 5f61 6c69 676e 203d 2032  lf.man_align = 2
+000690e0: 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d  ....#-----------
+000690f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00069100: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00069110: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00069120: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020  -----------..   
+00069130: 2064 6566 204f 6e50 6f69 6e74 436f 7272   def OnPointCorr
+00069140: 696d 6167 6528 7365 6c66 2c20 6576 7429  image(self, evt)
+00069150: 3a0d 0a0d 0a20 2020 2020 2020 2078 203d  :....        x =
+00069160: 2065 7674 2e78 6461 7461 0d0a 2020 2020   evt.xdata..    
+00069170: 2020 2020 7920 3d20 6576 742e 7964 6174      y = evt.ydat
+00069180: 610d 0a0d 0a20 2020 2020 2020 2069 6620  a....        if 
+00069190: 2873 656c 662e 6d61 6e5f 616c 6967 6e20  (self.man_align 
+000691a0: 3d3d 2032 293a 0d0a 2020 2020 2020 2020  == 2):..        
+000691b0: 2020 2020 7863 6f72 7220 3d20 666c 6f61      xcorr = floa
+000691c0: 7428 7829 0d0a 2020 2020 2020 2020 2020  t(x)..          
+000691d0: 2020 7963 6f72 7220 3d20 666c 6f61 7428    ycorr = float(
+000691e0: 7929 0d0a 0d0a 2020 2020 2020 2020 2020  y)....          
+000691f0: 2020 6966 2078 636f 7272 3c30 203a 0d0a    if xcorr<0 :..
+00069200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069210: 7863 6f72 723d 300d 0a20 2020 2020 2020  xcorr=0..       
+00069220: 2020 2020 2069 6620 7863 6f72 723e 7365       if xcorr>se
+00069230: 6c66 2e73 7461 636b 2e6e 5f63 6f6c 7320  lf.stack.n_cols 
+00069240: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00069250: 2020 2078 636f 7272 3d73 656c 662e 7374     xcorr=self.st
+00069260: 6163 6b2e 6e5f 636f 6c73 0d0a 2020 2020  ack.n_cols..    
+00069270: 2020 2020 2020 2020 6966 2079 636f 7272          if ycorr
+00069280: 3c30 203a 0d0a 2020 2020 2020 2020 2020  <0 :..          
+00069290: 2020 2020 2020 7963 6f72 723d 300d 0a20        ycorr=0.. 
+000692a0: 2020 2020 2020 2020 2020 2069 6620 7963             if yc
+000692b0: 6f72 723e 7365 6c66 2e73 7461 636b 2e6e  orr>self.stack.n
+000692c0: 5f72 6f77 7320 3a0d 0a20 2020 2020 2020  _rows :..       
+000692d0: 2020 2020 2020 2020 2079 636f 7272 3d73           ycorr=s
+000692e0: 656c 662e 7374 6163 6b2e 6e5f 726f 7773  elf.stack.n_rows
+000692f0: 0d0a 0d0a 0d0a 2020 2020 2020 2020 2020  ......          
+00069300: 2020 6966 2073 656c 662e 636f 6d2e 7374    if self.com.st
+00069310: 6163 6b5f 3464 203d 3d20 303a 0d0a 2020  ack_4d == 0:..  
+00069320: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00069330: 6c66 2e6d 616e 5f78 735b 7365 6c66 2e69  lf.man_xs[self.i
+00069340: 6576 5d20 3d20 7365 6c66 2e6d 616e 5f78  ev] = self.man_x
+00069350: 7265 6620 2d20 7863 6f72 720d 0a20 2020  ref - xcorr..   
+00069360: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00069370: 662e 6d61 6e5f 7973 5b73 656c 662e 6965  f.man_ys[self.ie
+00069380: 765d 203d 202d 312e 302a 2873 656c 662e  v] = -1.0*(self.
+00069390: 6d61 6e5f 7972 6566 202d 2079 636f 7272  man_yref - ycorr
+000693a0: 290d 0a0d 0a0d 0a20 2020 2020 2020 2020  )......         
+000693b0: 2020 2020 2020 2073 656c 662e 7465 7874         self.text
+000693c0: 6374 726c 5f6d 7331 2e73 6574 5465 7874  ctrl_ms1.setText
+000693d0: 2827 5820 6d61 6e75 616c 2073 6869 6674  ('X manual shift
+000693e0: 3a20 207b 303a 352e 3266 7d20 2070 6978  :  {0:5.2f}  pix
+000693f0: 656c 735c 6e27 2e66 6f72 6d61 7428 7365  els\n'.format(se
+00069400: 6c66 2e6d 616e 5f78 735b 7365 6c66 2e69  lf.man_xs[self.i
+00069410: 6576 5d29 290d 0a20 2020 2020 2020 2020  ev]))..         
+00069420: 2020 2020 2020 2073 656c 662e 7465 7874         self.text
+00069430: 6374 726c 5f6d 7332 2e73 6574 5465 7874  ctrl_ms2.setText
+00069440: 2827 5920 6d61 6e75 616c 2073 6869 6674  ('Y manual shift
+00069450: 3a20 207b 303a 352e 3266 7d20 2070 6978  :  {0:5.2f}  pix
+00069460: 656c 7327 2e66 6f72 6d61 7428 7365 6c66  els'.format(self
+00069470: 2e6d 616e 5f79 735b 7365 6c66 2e69 6576  .man_ys[self.iev
+00069480: 5d29 290d 0a20 2020 2020 2020 2020 2020  ]))..           
+00069490: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+000694a0: 2020 2020 2020 2020 7365 6c66 2e6d 616e          self.man
+000694b0: 5f78 735b 7365 6c66 2e69 6576 2c20 7365  _xs[self.iev, se
+000694c0: 6c66 2e69 7468 6574 615d 203d 2073 656c  lf.itheta] = sel
+000694d0: 662e 6d61 6e5f 7872 6566 202d 2078 636f  f.man_xref - xco
+000694e0: 7272 0d0a 2020 2020 2020 2020 2020 2020  rr..            
+000694f0: 2020 2020 7365 6c66 2e6d 616e 5f79 735b      self.man_ys[
+00069500: 7365 6c66 2e69 6576 2c20 7365 6c66 2e69  self.iev, self.i
+00069510: 7468 6574 615d 203d 202d 312e 302a 2873  theta] = -1.0*(s
+00069520: 656c 662e 6d61 6e5f 7972 6566 202d 2079  elf.man_yref - y
+00069530: 636f 7272 290d 0a0d 0a0d 0a20 2020 2020  corr)......     
+00069540: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00069550: 7465 7874 6374 726c 5f6d 7331 2e73 6574  textctrl_ms1.set
+00069560: 5465 7874 2827 5820 6d61 6e75 616c 2073  Text('X manual s
+00069570: 6869 6674 3a20 207b 303a 352e 3266 7d20  hift:  {0:5.2f} 
+00069580: 2070 6978 656c 735c 6e27 2e66 6f72 6d61   pixels\n'.forma
+00069590: 7428 7365 6c66 2e6d 616e 5f78 735b 7365  t(self.man_xs[se
+000695a0: 6c66 2e69 6576 2c20 7365 6c66 2e69 7468  lf.iev, self.ith
+000695b0: 6574 615d 2929 0d0a 2020 2020 2020 2020  eta]))..        
+000695c0: 2020 2020 2020 2020 7365 6c66 2e74 6578          self.tex
+000695d0: 7463 7472 6c5f 6d73 322e 7365 7454 6578  tctrl_ms2.setTex
+000695e0: 7428 2759 206d 616e 7561 6c20 7368 6966  t('Y manual shif
+000695f0: 743a 2020 7b30 3a35 2e32 667d 2020 7069  t:  {0:5.2f}  pi
+00069600: 7865 6c73 272e 666f 726d 6174 2873 656c  xels'.format(sel
+00069610: 662e 6d61 6e5f 7973 5b73 656c 662e 6965  f.man_ys[self.ie
+00069620: 762c 2073 656c 662e 6974 6865 7461 5d29  v, self.itheta])
+00069630: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00069640: 2073 656c 662e 6965 7620 3d20 7365 6c66   self.iev = self
+00069650: 2e69 6576 202b 2031 0d0a 2020 2020 2020  .iev + 1..      
+00069660: 2020 2020 2020 6966 2073 656c 662e 6965        if self.ie
+00069670: 7620 3e20 2873 656c 662e 7374 6163 6b2e  v > (self.stack.
+00069680: 6e5f 6576 2d31 293a 0d0a 2020 2020 2020  n_ev-1):..      
+00069690: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+000696a0: 6576 203d 2030 0d0a 0d0a 2020 2020 2020  ev = 0....      
+000696b0: 2020 2020 2020 7365 6c66 2e73 6c69 6465        self.slide
+000696c0: 725f 656e 672e 7365 7456 616c 7565 2873  r_eng.setValue(s
+000696d0: 656c 662e 6965 7629 0d0a 0d0a 0d0a 2020  elf.iev)......  
+000696e0: 2020 2020 2020 2020 2020 7365 6c66 2e53            self.S
+000696f0: 686f 7749 6d61 6765 2829 0d0a 2020 2020  howImage()..    
+00069700: 2020 2020 2020 2020 7365 6c66 2e55 7064          self.Upd
+00069710: 6174 6557 6964 6765 7473 2829 0d0a 0d0a  ateWidgets()....
+00069720: 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  #---------------
+00069730: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00069740: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00069750: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00069760: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6566  -------..    def
+00069770: 204f 6e41 7070 6c79 4d61 6e53 6869 6674   OnApplyManShift
+00069780: 7328 7365 6c66 293a 0d0a 0d0a 0d0a 2020  s(self):......  
+00069790: 2020 2020 2020 6966 2073 656c 662e 636f        if self.co
+000697a0: 6d2e 7374 6163 6b5f 3464 203d 3d20 303a  m.stack_4d == 0:
+000697b0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+000697c0: 7220 6920 696e 2072 616e 6765 2873 656c  r i in range(sel
+000697d0: 662e 7374 6163 6b2e 6e5f 6576 293a 0d0a  f.stack.n_ev):..
+000697e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000697f0: 2020 696d 6720 3d20 7365 6c66 2e61 6c69    img = self.ali
+00069800: 676e 6564 5f73 7461 636b 5b3a 2c3a 2c69  gned_stack[:,:,i
+00069810: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00069820: 2020 2069 6620 2861 6273 2873 656c 662e     if (abs(self.
+00069830: 6d61 6e5f 7873 5b69 5d29 3e30 2e30 3229  man_xs[i])>0.02)
+00069840: 206f 7220 2861 6273 2873 656c 662e 6d61   or (abs(self.ma
+00069850: 6e5f 7973 5b69 5d29 3e30 2e30 3229 3a0d  n_ys[i])>0.02):.
+00069860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00069870: 2020 2020 2073 6869 6674 6564 5f69 6d67       shifted_img
+00069880: 203d 2073 656c 662e 7374 6163 6b2e 6170   = self.stack.ap
+00069890: 706c 795f 696d 6167 655f 7265 6769 7374  ply_image_regist
+000698a0: 7261 7469 6f6e 2869 6d67 2c0d 0a20 2020  ration(img,..   
+000698b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000698c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000698d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000698e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000698f0: 2020 2020 2020 2020 7365 6c66 2e6d 616e          self.man
-00069900: 5f79 735b 695d 290d 0a20 2020 2020 2020  _ys[i])..       
-00069910: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00069920: 662e 616c 6967 6e65 645f 7374 6163 6b5b  f.aligned_stack[
-00069930: 3a2c 3a2c 695d 203d 2073 6869 6674 6564  :,:,i] = shifted
-00069940: 5f69 6d67 0d0a 0d0a 2020 2020 2020 2020  _img....        
-00069950: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00069960: 2e78 7368 6966 7473 5b69 5d20 3d20 7365  .xshifts[i] = se
-00069970: 6c66 2e78 7368 6966 7473 5b69 5d20 2b20  lf.xshifts[i] + 
-00069980: 7365 6c66 2e6d 616e 5f78 735b 695d 0d0a  self.man_xs[i]..
-00069990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000699a0: 2020 2020 7365 6c66 2e79 7368 6966 7473      self.yshifts
-000699b0: 5b69 5d20 3d20 7365 6c66 2e79 7368 6966  [i] = self.yshif
-000699c0: 7473 5b69 5d20 2b20 7365 6c66 2e6d 616e  ts[i] + self.man
-000699d0: 5f79 735b 695d 0d0a 0d0a 0d0a 0d0a 0d0a  _ys[i]..........
-000699e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000699f0: 7365 6c66 2e6d 616e 5f78 735b 695d 203d  self.man_xs[i] =
-00069a00: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
-00069a10: 2020 2020 7365 6c66 2e6d 616e 5f79 735b      self.man_ys[
-00069a20: 695d 203d 2030 0d0a 0d0a 2020 2020 2020  i] = 0....      
-00069a30: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00069a40: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-00069a50: 6e67 6528 7365 6c66 2e73 7461 636b 2e6e  nge(self.stack.n
-00069a60: 5f65 7629 3a0d 0a20 2020 2020 2020 2020  _ev):..         
-00069a70: 2020 2020 2020 2066 6f72 206a 2069 6e20         for j in 
-00069a80: 7261 6e67 6528 7365 6c66 2e73 7461 636b  range(self.stack
-00069a90: 2e6e 5f74 6865 7461 293a 0d0a 0d0a 2020  .n_theta):....  
-00069aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069ab0: 2020 696d 6720 3d20 7365 6c66 2e61 6c69    img = self.ali
-00069ac0: 676e 6564 5f73 7461 636b 5b3a 2c3a 2c69  gned_stack[:,:,i
-00069ad0: 2c6a 5d0d 0a20 2020 2020 2020 2020 2020  ,j]..           
-00069ae0: 2020 2020 2020 2020 2069 6620 2861 6273           if (abs
-00069af0: 2873 656c 662e 6d61 6e5f 7873 5b69 2c6a  (self.man_xs[i,j
-00069b00: 5d29 3e30 2e30 3229 206f 7220 2861 6273  ])>0.02) or (abs
-00069b10: 2873 656c 662e 6d61 6e5f 7973 5b69 2c6a  (self.man_ys[i,j
-00069b20: 5d29 3e30 2e30 3229 3a0d 0a20 2020 2020  ])>0.02):..     
-00069b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069b40: 2020 2073 6869 6674 6564 5f69 6d67 203d     shifted_img =
-00069b50: 2073 656c 662e 7374 6163 6b2e 6170 706c   self.stack.appl
-00069b60: 795f 696d 6167 655f 7265 6769 7374 7261  y_image_registra
-00069b70: 7469 6f6e 2869 6d67 2c0d 0a20 2020 2020  tion(img,..     
+000698f0: 2020 2073 656c 662e 6d61 6e5f 7873 5b69     self.man_xs[i
+00069900: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00069910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069940: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+00069950: 616e 5f79 735b 695d 290d 0a20 2020 2020  an_ys[i])..     
+00069960: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00069970: 656c 662e 616c 6967 6e65 645f 7374 6163  elf.aligned_stac
+00069980: 6b5b 3a2c 3a2c 695d 203d 2073 6869 6674  k[:,:,i] = shift
+00069990: 6564 5f69 6d67 0d0a 0d0a 2020 2020 2020  ed_img....      
+000699a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000699b0: 6c66 2e78 7368 6966 7473 5b69 5d20 3d20  lf.xshifts[i] = 
+000699c0: 7365 6c66 2e78 7368 6966 7473 5b69 5d20  self.xshifts[i] 
+000699d0: 2b20 7365 6c66 2e6d 616e 5f78 735b 695d  + self.man_xs[i]
+000699e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000699f0: 2020 2020 2020 7365 6c66 2e79 7368 6966        self.yshif
+00069a00: 7473 5b69 5d20 3d20 7365 6c66 2e79 7368  ts[i] = self.ysh
+00069a10: 6966 7473 5b69 5d20 2b20 7365 6c66 2e6d  ifts[i] + self.m
+00069a20: 616e 5f79 735b 695d 0d0a 0d0a 0d0a 0d0a  an_ys[i]........
+00069a30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00069a40: 2020 7365 6c66 2e6d 616e 5f78 735b 695d    self.man_xs[i]
+00069a50: 203d 2030 0d0a 2020 2020 2020 2020 2020   = 0..          
+00069a60: 2020 2020 2020 7365 6c66 2e6d 616e 5f79        self.man_y
+00069a70: 735b 695d 203d 2030 0d0a 0d0a 2020 2020  s[i] = 0....    
+00069a80: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00069a90: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+00069aa0: 7261 6e67 6528 7365 6c66 2e73 7461 636b  range(self.stack
+00069ab0: 2e6e 5f65 7629 3a0d 0a20 2020 2020 2020  .n_ev):..       
+00069ac0: 2020 2020 2020 2020 2066 6f72 206a 2069           for j i
+00069ad0: 6e20 7261 6e67 6528 7365 6c66 2e73 7461  n range(self.sta
+00069ae0: 636b 2e6e 5f74 6865 7461 293a 0d0a 0d0a  ck.n_theta):....
+00069af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069b00: 2020 2020 696d 6720 3d20 7365 6c66 2e61      img = self.a
+00069b10: 6c69 676e 6564 5f73 7461 636b 5b3a 2c3a  ligned_stack[:,:
+00069b20: 2c69 2c6a 5d0d 0a20 2020 2020 2020 2020  ,i,j]..         
+00069b30: 2020 2020 2020 2020 2020 2069 6620 2861             if (a
+00069b40: 6273 2873 656c 662e 6d61 6e5f 7873 5b69  bs(self.man_xs[i
+00069b50: 2c6a 5d29 3e30 2e30 3229 206f 7220 2861  ,j])>0.02) or (a
+00069b60: 6273 2873 656c 662e 6d61 6e5f 7973 5b69  bs(self.man_ys[i
+00069b70: 2c6a 5d29 3e30 2e30 3229 3a0d 0a20 2020  ,j])>0.02):..   
 00069b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069bc0: 2020 2020 2073 656c 662e 6d61 6e5f 7873       self.man_xs
-00069bd0: 5b69 2c6a 5d2c 0d0a 2020 2020 2020 2020  [i,j],..        
+00069b90: 2020 2020 2073 6869 6674 6564 5f69 6d67       shifted_img
+00069ba0: 203d 2073 656c 662e 7374 6163 6b2e 6170   = self.stack.ap
+00069bb0: 706c 795f 696d 6167 655f 7265 6769 7374  ply_image_regist
+00069bc0: 7261 7469 6f6e 2869 6d67 2c0d 0a20 2020  ration(img,..   
+00069bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00069be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00069bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00069c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069c20: 2020 7365 6c66 2e6d 616e 5f79 735b 692c    self.man_ys[i,
-00069c30: 6a5d 290d 0a20 2020 2020 2020 2020 2020  j])..           
-00069c40: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00069c50: 662e 616c 6967 6e65 645f 7374 6163 6b5b  f.aligned_stack[
-00069c60: 3a2c 3a2c 692c 6a5d 203d 2073 6869 6674  :,:,i,j] = shift
-00069c70: 6564 5f69 6d67 0d0a 0d0a 2020 2020 2020  ed_img....      
-00069c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069c90: 2020 7365 6c66 2e78 7368 6966 7473 5b69    self.xshifts[i
-00069ca0: 2c6a 5d20 3d20 7365 6c66 2e78 7368 6966  ,j] = self.xshif
-00069cb0: 7473 5b69 2c6a 5d20 2b20 7365 6c66 2e6d  ts[i,j] + self.m
-00069cc0: 616e 5f78 735b 692c 6a5d 0d0a 2020 2020  an_xs[i,j]..    
+00069c10: 2020 2020 2020 2073 656c 662e 6d61 6e5f         self.man_
+00069c20: 7873 5b69 2c6a 5d2c 0d0a 2020 2020 2020  xs[i,j],..      
+00069c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069c70: 2020 2020 7365 6c66 2e6d 616e 5f79 735b      self.man_ys[
+00069c80: 692c 6a5d 290d 0a20 2020 2020 2020 2020  i,j])..         
+00069c90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00069ca0: 656c 662e 616c 6967 6e65 645f 7374 6163  elf.aligned_stac
+00069cb0: 6b5b 3a2c 3a2c 692c 6a5d 203d 2073 6869  k[:,:,i,j] = shi
+00069cc0: 6674 6564 5f69 6d67 0d0a 0d0a 2020 2020  fted_img....    
 00069cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069ce0: 2020 2020 7365 6c66 2e79 7368 6966 7473      self.yshifts
-00069cf0: 5b69 2c6a 5d20 3d20 7365 6c66 2e79 7368  [i,j] = self.ysh
+00069ce0: 2020 2020 7365 6c66 2e78 7368 6966 7473      self.xshifts
+00069cf0: 5b69 2c6a 5d20 3d20 7365 6c66 2e78 7368  [i,j] = self.xsh
 00069d00: 6966 7473 5b69 2c6a 5d20 2b20 7365 6c66  ifts[i,j] + self
-00069d10: 2e6d 616e 5f79 735b 692c 6a5d 0d0a 0d0a  .man_ys[i,j]....
-00069d20: 0d0a 0d0a 0d0a 2020 2020 2020 2020 2020  ......          
-00069d30: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-00069d40: 616e 5f78 735b 692c 6a5d 203d 2030 0d0a  an_xs[i,j] = 0..
-00069d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069d60: 2020 2020 7365 6c66 2e6d 616e 5f79 735b      self.man_ys[
-00069d70: 692c 6a5d 203d 2030 0d0a 0d0a 0d0a 2020  i,j] = 0......  
-00069d80: 2020 2020 2020 7365 6c66 2e72 6567 6973        self.regis
-00069d90: 745f 6361 6c63 756c 6174 6564 203d 2031  t_calculated = 1
-00069da0: 0d0a 2020 2020 2020 2020 7365 6c66 2e6d  ..        self.m
-00069db0: 616e 5f61 6c69 676e 203d 2030 0d0a 0d0a  an_align = 0....
-00069dc0: 2020 2020 2020 2020 7365 6c66 2e53 686f          self.Sho
-00069dd0: 7752 6566 496d 6167 6528 290d 0a20 2020  wRefImage()..   
-00069de0: 2020 2020 2073 656c 662e 506c 6f74 5368       self.PlotSh
-00069df0: 6966 7473 2829 0d0a 0d0a 2020 2020 2020  ifts()....      
-00069e00: 2020 7365 6c66 2e74 6578 7463 7472 6c5f    self.textctrl_
-00069e10: 6d73 312e 7365 7454 6578 7428 2758 206d  ms1.setText('X m
-00069e20: 616e 7561 6c20 7368 6966 743a 205c 6e27  anual shift: \n'
-00069e30: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00069e40: 7465 7874 6374 726c 5f6d 7332 2e73 6574  textctrl_ms2.set
-00069e50: 5465 7874 2827 5920 6d61 6e75 616c 2073  Text('Y manual s
-00069e60: 6869 6674 3a20 2729 0d0a 0d0a 2020 2020  hift: ')....    
-00069e70: 2020 2020 7365 6c66 2e55 7064 6174 6557      self.UpdateW
-00069e80: 6964 6765 7473 2829 0d0a 0d0a 2020 2020  idgets()....    
-00069e90: 2020 2020 6d69 6e5f 7873 6869 6674 203d      min_xshift =
-00069ea0: 206e 702e 6d69 6e28 7365 6c66 2e78 7368   np.min(self.xsh
-00069eb0: 6966 7473 290d 0a20 2020 2020 2020 206d  ifts)..        m
-00069ec0: 6178 5f78 7368 6966 7420 3d20 6e70 2e6d  ax_xshift = np.m
-00069ed0: 6178 2873 656c 662e 7873 6869 6674 7329  ax(self.xshifts)
-00069ee0: 0d0a 0d0a 2020 2020 2020 2020 6d69 6e5f  ....        min_
-00069ef0: 7973 6869 6674 203d 206e 702e 6d69 6e28  yshift = np.min(
-00069f00: 7365 6c66 2e79 7368 6966 7473 290d 0a20  self.yshifts).. 
-00069f10: 2020 2020 2020 206d 6178 5f79 7368 6966         max_yshif
-00069f20: 7420 3d20 6e70 2e6d 6178 2873 656c 662e  t = np.max(self.
-00069f30: 7973 6869 6674 7329 0d0a 0d0a 2020 2020  yshifts)....    
-00069f40: 2020 2020 6966 206d 696e 5f78 7368 6966      if min_xshif
-00069f50: 7420 3c20 7365 6c66 2e6d 696e 7873 203a  t < self.minxs :
-00069f60: 2073 656c 662e 6d69 6e78 7320 3d20 6d69   self.minxs = mi
-00069f70: 6e5f 7873 6869 6674 0d0a 2020 2020 2020  n_xshift..      
-00069f80: 2020 6966 206d 6178 5f78 7368 6966 7420    if max_xshift 
-00069f90: 3e20 7365 6c66 2e6d 6178 7873 203a 2073  > self.maxxs : s
-00069fa0: 656c 662e 6d61 7878 7320 3d20 6d61 785f  elf.maxxs = max_
-00069fb0: 7873 6869 6674 0d0a 0d0a 2020 2020 2020  xshift....      
-00069fc0: 2020 6966 206d 696e 5f79 7368 6966 7420    if min_yshift 
-00069fd0: 3c20 7365 6c66 2e6d 696e 7973 203a 2073  < self.minys : s
-00069fe0: 656c 662e 6d69 6e79 7320 3d20 6d69 6e5f  elf.minys = min_
-00069ff0: 7973 6869 6674 0d0a 2020 2020 2020 2020  yshift..        
-0006a000: 6966 206d 6178 5f79 7368 6966 7420 3e20  if max_yshift > 
-0006a010: 7365 6c66 2e6d 6178 7973 203a 2073 656c  self.maxys : sel
-0006a020: 662e 6d61 7879 7320 3d20 6d61 785f 7973  f.maxys = max_ys
-0006a030: 6869 6674 0d0a 0d0a 0d0a 2020 2020 2020  hift......      
-0006a040: 2020 7365 6c66 2e53 686f 7749 6d61 6765    self.ShowImage
-0006a050: 2829 0d0a 0d0a 0d0a 0d0a 0d0a 232d 2d2d  ()..........#---
-0006a060: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006a070: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006a080: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006a090: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006a0a0: 2d2d 2d0d 0a20 2020 2064 6566 204f 6e41  ---..    def OnA
-0006a0b0: 6363 6570 7428 7365 6c66 293a 0d0a 0d0a  ccept(self):....
-0006a0c0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0006a0d0: 636f 6d2e 7374 6163 6b5f 3464 203d 3d20  com.stack_4d == 
-0006a0e0: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-0006a0f0: 7365 6c66 2e73 7461 636b 2e61 6273 6461  self.stack.absda
-0006a100: 7461 203d 2073 656c 662e 616c 6967 6e65  ta = self.aligne
-0006a110: 645f 7374 6163 6b0d 0a20 2020 2020 2020  d_stack..       
-0006a120: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
-0006a130: 6461 7461 5f73 7472 7563 742e 6578 6368  data_struct.exch
-0006a140: 616e 6765 2e64 6174 6120 3d20 7365 6c66  ange.data = self
-0006a150: 2e73 7461 636b 2e61 6273 6461 7461 0d0a  .stack.absdata..
-0006a160: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0006a170: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0006a180: 7374 6163 6b2e 7374 6163 6b34 4420 3d20  stack.stack4D = 
-0006a190: 7365 6c66 2e61 6c69 676e 6564 5f73 7461  self.aligned_sta
-0006a1a0: 636b 0d0a 2020 2020 2020 2020 2020 2020  ck..            
-0006a1b0: 7365 6c66 2e73 7461 636b 2e61 6273 6461  self.stack.absda
-0006a1c0: 7461 203d 2073 656c 662e 7374 6163 6b2e  ta = self.stack.
-0006a1d0: 7374 6163 6b34 445b 3a2c 3a2c 3a2c 7365  stack4D[:,:,:,se
-0006a1e0: 6c66 2e69 7468 6574 615d 0d0a 2020 2020  lf.itheta]..    
-0006a1f0: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
-0006a200: 636b 2e64 6174 615f 7374 7275 6374 2e65  ck.data_struct.e
-0006a210: 7863 6861 6e67 652e 6461 7461 203d 2073  xchange.data = s
-0006a220: 656c 662e 7374 6163 6b2e 7374 6163 6b34  elf.stack.stack4
-0006a230: 440d 0a0d 0a0d 0a20 2020 2020 2020 2064  D......        d
-0006a240: 6174 6164 696d 203d 206e 702e 696e 7433  atadim = np.int3
-0006a250: 3228 7365 6c66 2e73 7461 636b 2e61 6273  2(self.stack.abs
-0006a260: 6461 7461 2e73 6861 7065 290d 0a0d 0a20  data.shape).... 
-0006a270: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
-0006a280: 6b2e 6e5f 636f 6c73 203d 2064 6174 6164  k.n_cols = datad
-0006a290: 696d 5b30 5d2e 636f 7079 2829 0d0a 2020  im[0].copy()..  
-0006a2a0: 2020 2020 2020 7365 6c66 2e73 7461 636b        self.stack
-0006a2b0: 2e6e 5f72 6f77 7320 3d20 2064 6174 6164  .n_rows =  datad
-0006a2c0: 696d 5b31 5d2e 636f 7079 2829 0d0a 0d0a  im[1].copy()....
-0006a2d0: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
-0006a2e0: 636b 2e78 7368 6966 7473 203d 2073 656c  ck.xshifts = sel
-0006a2f0: 662e 7873 6869 6674 730d 0a20 2020 2020  f.xshifts..     
-0006a300: 2020 2073 656c 662e 7374 6163 6b2e 7973     self.stack.ys
-0006a310: 6869 6674 7320 3d20 7365 6c66 2e79 7368  hifts = self.ysh
-0006a320: 6966 7473 0d0a 0d0a 2020 2020 2020 2020  ifts....        
-0006a330: 6966 2073 656c 662e 636f 6d2e 6930 5f6c  if self.com.i0_l
-0006a340: 6f61 6465 6420 3d3d 2031 3a0d 0a20 2020  oaded == 1:..   
-0006a350: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0006a360: 2e63 6f6d 2e73 7461 636b 5f34 6420 3d3d  .com.stack_4d ==
-0006a370: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-0006a380: 2020 2020 2023 5265 7369 7a65 206f 7074       #Resize opt
-0006a390: 6963 616c 2064 656e 7369 7479 0d0a 2020  ical density..  
-0006a3a0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0006a3b0: 7220 6920 696e 2072 616e 6765 2873 656c  r i in range(sel
-0006a3c0: 662e 7374 6163 6b2e 6e5f 6576 293a 0d0a  f.stack.n_ev):..
-0006a3d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006a3e0: 2020 2020 2020 696d 6720 3d20 7365 6c66        img = self
-0006a3f0: 2e73 7461 636b 2e6f 6433 645b 3a2c 3a2c  .stack.od3d[:,:,
-0006a400: 695d 0d0a 2020 2020 2020 2020 2020 2020  i]..            
-0006a410: 2020 2020 2020 2020 7368 6966 7465 645f          shifted_
-0006a420: 696d 6720 3d20 7365 6c66 2e73 7461 636b  img = self.stack
-0006a430: 2e61 7070 6c79 5f69 6d61 6765 5f72 6567  .apply_image_reg
-0006a440: 6973 7472 6174 696f 6e28 696d 672c 2073  istration(img, s
-0006a450: 656c 662e 7873 6869 6674 735b 695d 2c20  elf.xshifts[i], 
-0006a460: 7365 6c66 2e79 7368 6966 7473 5b69 5d29  self.yshifts[i])
-0006a470: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006a480: 2020 2020 2020 7365 6c66 2e73 7461 636b        self.stack
-0006a490: 2e6f 6433 645b 3a2c 3a2c 695d 203d 2073  .od3d[:,:,i] = s
-0006a4a0: 6869 6674 6564 5f69 6d67 0d0a 0d0a 0d0a  hifted_img......
-0006a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a4c0: 7365 6c66 2e73 7461 636b 2e6f 6433 6420  self.stack.od3d 
-0006a4d0: 3d20 7365 6c66 2e73 7461 636b 2e6f 6433  = self.stack.od3
-0006a4e0: 645b 7365 6c66 2e78 6c65 6674 3a73 656c  d[self.xleft:sel
-0006a4f0: 662e 7872 6967 6874 2c20 7365 6c66 2e79  f.xright, self.y
-0006a500: 626f 7474 6f6d 3a73 656c 662e 7974 6f70  bottom:self.ytop
-0006a510: 2c20 3a5d 0d0a 0d0a 2020 2020 2020 2020  , :]....        
-0006a520: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
-0006a530: 636b 2e6f 6420 3d20 7365 6c66 2e73 7461  ck.od = self.sta
-0006a540: 636b 2e6f 6433 642e 636f 7079 2829 0d0a  ck.od3d.copy()..
-0006a550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a560: 7365 6c66 2e73 7461 636b 2e6f 6420 3d20  self.stack.od = 
-0006a570: 6e70 2e72 6573 6861 7065 2873 656c 662e  np.reshape(self.
-0006a580: 7374 6163 6b2e 6f64 2c20 2873 656c 662e  stack.od, (self.
-0006a590: 7374 6163 6b2e 6e5f 636f 6c73 2a73 656c  stack.n_cols*sel
-0006a5a0: 662e 7374 6163 6b2e 6e5f 726f 7773 2c20  f.stack.n_rows, 
-0006a5b0: 7365 6c66 2e73 7461 636b 2e6e 5f65 7629  self.stack.n_ev)
-0006a5c0: 2c20 6f72 6465 723d 2746 2729 0d0a 0d0a  , order='F')....
-0006a5d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0006a5e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0006a5f0: 2020 2023 5265 7369 7a65 206f 7074 6963     #Resize optic
-0006a600: 616c 2064 656e 7369 7479 2066 6f72 2034  al density for 4
-0006a610: 4420 7374 6163 6b0d 0a0d 0a20 2020 2020  D stack....     
-0006a620: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-0006a630: 2069 6e20 7261 6e67 6528 7365 6c66 2e73   in range(self.s
-0006a640: 7461 636b 2e6e 5f65 7629 3a0d 0a20 2020  tack.n_ev):..   
-0006a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a660: 2066 6f72 206a 2069 6e20 7261 6e67 6528   for j in range(
-0006a670: 7365 6c66 2e73 7461 636b 2e6e 5f74 6865  self.stack.n_the
-0006a680: 7461 293a 0d0a 2020 2020 2020 2020 2020  ta):..          
-0006a690: 2020 2020 2020 2020 2020 2020 2020 696d                im
-0006a6a0: 6720 3d20 7365 6c66 2e73 7461 636b 2e6f  g = self.stack.o
-0006a6b0: 6434 445b 3a2c 3a2c 692c 6a5d 0d0a 2020  d4D[:,:,i,j]..  
-0006a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a6d0: 2020 2020 2020 7368 6966 7465 645f 696d        shifted_im
-0006a6e0: 6720 3d20 7365 6c66 2e73 7461 636b 2e61  g = self.stack.a
-0006a6f0: 7070 6c79 5f69 6d61 6765 5f72 6567 6973  pply_image_regis
-0006a700: 7472 6174 696f 6e28 696d 672c 2073 656c  tration(img, sel
-0006a710: 662e 7873 6869 6674 735b 692c 6a5d 2c20  f.xshifts[i,j], 
-0006a720: 7365 6c66 2e79 7368 6966 7473 5b69 2c6a  self.yshifts[i,j
-0006a730: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-0006a740: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0006a750: 2e73 7461 636b 2e6f 6434 445b 3a2c 3a2c  .stack.od4D[:,:,
-0006a760: 692c 6a5d 203d 2073 6869 6674 6564 5f69  i,j] = shifted_i
-0006a770: 6d67 0d0a 0d0a 2020 2020 2020 2020 2020  mg....          
-0006a780: 2020 2020 2020 7365 6c66 2e73 7461 636b        self.stack
-0006a790: 2e6f 6434 4420 3d20 7365 6c66 2e73 7461  .od4D = self.sta
-0006a7a0: 636b 2e6f 6434 445b 7365 6c66 2e78 6c65  ck.od4D[self.xle
-0006a7b0: 6674 3a73 656c 662e 7872 6967 6874 2c20  ft:self.xright, 
-0006a7c0: 7365 6c66 2e79 626f 7474 6f6d 3a73 656c  self.ybottom:sel
-0006a7d0: 662e 7974 6f70 2c20 3a2c 203a 5d0d 0a0d  f.ytop, :, :]...
-0006a7e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006a7f0: 2073 656c 662e 7374 6163 6b2e 6f64 3364   self.stack.od3d
-0006a800: 203d 2073 656c 662e 7374 6163 6b2e 6f64   = self.stack.od
-0006a810: 3444 5b3a 2c3a 2c3a 2c73 656c 662e 6974  4D[:,:,:,self.it
-0006a820: 6865 7461 5d0d 0a20 2020 2020 2020 2020  heta]..         
-0006a830: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
-0006a840: 6b2e 6f64 203d 2073 656c 662e 7374 6163  k.od = self.stac
-0006a850: 6b2e 6f64 3364 2e63 6f70 7928 290d 0a20  k.od3d.copy().. 
-0006a860: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0006a870: 5f70 6978 656c 7320 3d20 7365 6c66 2e73  _pixels = self.s
-0006a880: 7461 636b 2e6e 5f63 6f6c 732a 7365 6c66  tack.n_cols*self
-0006a890: 2e73 7461 636b 2e6e 5f72 6f77 730d 0a20  .stack.n_rows.. 
-0006a8a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0006a8b0: 656c 662e 7374 6163 6b2e 6f64 203d 206e  elf.stack.od = n
-0006a8c0: 702e 7265 7368 6170 6528 7365 6c66 2e73  p.reshape(self.s
-0006a8d0: 7461 636b 2e6f 642c 2028 6e5f 7069 7865  tack.od, (n_pixe
-0006a8e0: 6c73 2c20 7365 6c66 2e73 7461 636b 2e6e  ls, self.stack.n
-0006a8f0: 5f65 7629 2c20 6f72 6465 723d 2746 2729  _ev), order='F')
-0006a900: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0006a910: 7365 6c66 2e73 7461 636b 2e64 6174 615f  self.stack.data_
-0006a920: 7374 7275 6374 2e73 7065 6374 726f 6d69  struct.spectromi
-0006a930: 6372 6f73 636f 7079 2e6f 7074 6963 616c  croscopy.optical
-0006a940: 5f64 656e 7369 7479 203d 2073 656c 662e  _density = self.
-0006a950: 7374 6163 6b2e 6f64 0d0a 0d0a 0d0a 2020  stack.od......  
-0006a960: 2020 2020 2020 7365 6c66 2e73 7461 636b        self.stack
-0006a970: 2e64 6174 615f 7374 7275 6374 2e65 7863  .data_struct.exc
-0006a980: 6861 6e67 652e 656e 6572 6779 203d 2073  hange.energy = s
-0006a990: 656c 662e 7374 6163 6b2e 6576 0d0a 0d0a  elf.stack.ev....
-0006a9a0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-0006a9b0: 2e73 7461 636b 2e64 6174 615f 7374 7275  .stack.data_stru
-0006a9c0: 6374 2e73 7065 6374 726f 6d69 6372 6f73  ct.spectromicros
-0006a9d0: 636f 7079 2e78 7368 6966 7473 203d 2073  copy.xshifts = s
-0006a9e0: 656c 662e 7873 6869 6674 730d 0a20 2020  elf.xshifts..   
-0006a9f0: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
-0006aa00: 6461 7461 5f73 7472 7563 742e 7370 6563  data_struct.spec
-0006aa10: 7472 6f6d 6963 726f 7363 6f70 792e 7973  tromicroscopy.ys
-0006aa20: 6869 6674 7320 3d20 7365 6c66 2e79 7368  hifts = self.ysh
-0006aa30: 6966 7473 0d0a 0d0a 0d0a 2020 2020 2020  ifts......      
-0006aa40: 2020 7365 6c66 2e70 6172 656e 742e 7061    self.parent.pa
-0006aa50: 6765 312e 736c 6964 6572 5f65 6e67 2e73  ge1.slider_eng.s
-0006aa60: 6574 5261 6e67 6528 302c 7365 6c66 2e73  etRange(0,self.s
-0006aa70: 7461 636b 2e6e 5f65 762d 3129 0d0a 2020  tack.n_ev-1)..  
-0006aa80: 2020 2020 2020 7365 6c66 2e70 6172 656e        self.paren
-0006aa90: 742e 7061 6765 312e 6965 7620 3d20 696e  t.page1.iev = in
-0006aaa0: 7428 7365 6c66 2e73 7461 636b 2e6e 5f65  t(self.stack.n_e
-0006aab0: 762f 3229 0d0a 2020 2020 2020 2020 7365  v/2)..        se
-0006aac0: 6c66 2e70 6172 656e 742e 7061 6765 312e  lf.parent.page1.
-0006aad0: 736c 6964 6572 5f65 6e67 2e73 6574 5661  slider_eng.setVa
-0006aae0: 6c75 6528 7365 6c66 2e70 6172 656e 742e  lue(self.parent.
-0006aaf0: 7061 6765 312e 6965 7629 0d0a 0d0a 2020  page1.iev)....  
-0006ab00: 2020 2020 2020 7365 6c66 2e70 6172 656e        self.paren
-0006ab10: 742e 7061 6765 312e 6978 203d 2069 6e74  t.page1.ix = int
-0006ab20: 2873 656c 662e 7374 6163 6b2e 6e5f 636f  (self.stack.n_co
-0006ab30: 6c73 2f32 290d 0a20 2020 2020 2020 2073  ls/2)..        s
-0006ab40: 656c 662e 7061 7265 6e74 2e70 6167 6531  elf.parent.page1
-0006ab50: 2e69 7920 3d20 696e 7428 7365 6c66 2e73  .iy = int(self.s
-0006ab60: 7461 636b 2e6e 5f72 6f77 732f 3229 0d0a  tack.n_rows/2)..
-0006ab70: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-0006ab80: 6172 656e 742e 7061 6765 312e 7368 6f77  arent.page1.show
-0006ab90: 5370 6563 7472 756d 2873 656c 662e 7061  Spectrum(self.pa
-0006aba0: 7265 6e74 2e70 6167 6531 2e69 782c 2073  rent.page1.ix, s
-0006abb0: 656c 662e 7061 7265 6e74 2e70 6167 6531  elf.parent.page1
-0006abc0: 2e69 7929 0d0a 2020 2020 2020 2020 7365  .iy)..        se
-0006abd0: 6c66 2e70 6172 656e 742e 7061 6765 312e  lf.parent.page1.
-0006abe0: 6c6f 6164 496d 6167 6528 290d 0a20 2020  loadImage()..   
-0006abf0: 2020 2020 2023 7365 6c66 2e70 6172 656e       #self.paren
-0006ac00: 742e 7061 6765 392e 6c6f 6164 496d 6167  t.page9.loadImag
-0006ac10: 6528 290d 0a0d 0a20 2020 2020 2020 2073  e()....        s
-0006ac20: 656c 662e 636c 6f73 6528 290d 0a0d 0a0d  elf.close().....
-0006ac30: 0a0d 0a0d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d  .......#--------
-0006ac40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006ac50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006ac60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006ac70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a  --------------..
-0006ac80: 2020 2020 6465 6620 506c 6f74 5368 6966      def PlotShif
-0006ac90: 7473 2873 656c 662c 2029 3a0d 0a0d 0a20  ts(self, ):.... 
-0006aca0: 2020 2020 2020 2066 6967 203d 2073 656c         fig = sel
-0006acb0: 662e 7368 6966 7473 6669 670d 0a20 2020  f.shiftsfig..   
-0006acc0: 2020 2020 2066 6967 2e63 6c66 2829 0d0a       fig.clf()..
-0006acd0: 0d0a 2020 2020 2020 2020 6669 672e 6164  ..        fig.ad
-0006ace0: 645f 6178 6573 2828 302e 3135 2c30 2e31  d_axes((0.15,0.1
-0006acf0: 352c 302e 3735 2c30 2e37 3529 290d 0a20  5,0.75,0.75)).. 
-0006ad00: 2020 2020 2020 2061 7865 7320 3d20 6669         axes = fi
-0006ad10: 672e 6763 6128 290d 0a0d 0a0d 0a0d 0a20  g.gca()........ 
-0006ad20: 2020 2020 2020 2023 4d61 7470 6c6f 746c         #Matplotl
-0006ad30: 6962 2068 6173 2069 6e76 6572 7465 6420  ib has inverted 
-0006ad40: 6178 6573 210d 0a20 2020 2020 2020 2061  axes!..        a
-0006ad50: 7865 732e 7365 745f 786c 6162 656c 2827  xes.set_xlabel('
-0006ad60: 5068 6f74 6f6e 2045 6e65 7267 7920 5b65  Photon Energy [e
-0006ad70: 565d 2729 0d0a 2020 2020 2020 2020 6178  V]')..        ax
-0006ad80: 6573 2e73 6574 5f79 6c61 6265 6c28 2753  es.set_ylabel('S
-0006ad90: 6869 6674 7320 2878 2d72 6564 2c20 792d  hifts (x-red, y-
-0006ada0: 6772 6565 6e29 205b 7069 7865 6c73 5d27  green) [pixels]'
-0006adb0: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
-0006adc0: 7365 6c66 2e63 6f6d 2e73 7461 636b 5f34  self.com.stack_4
-0006add0: 6420 3d3d 2030 3a0d 0a20 2020 2020 2020  d == 0:..       
-0006ade0: 2020 2020 2070 6c6f 7420 3d20 6178 6573       plot = axes
-0006adf0: 2e70 6c6f 7428 7365 6c66 2e73 7461 636b  .plot(self.stack
-0006ae00: 2e65 762c 7365 6c66 2e78 7368 6966 7473  .ev,self.xshifts
-0006ae10: 2c20 636f 6c6f 723d 2767 7265 656e 2729  , color='green')
-0006ae20: 0d0a 2020 2020 2020 2020 2020 2020 706c  ..            pl
-0006ae30: 6f74 203d 2061 7865 732e 706c 6f74 2873  ot = axes.plot(s
-0006ae40: 656c 662e 7374 6163 6b2e 6576 2c73 656c  elf.stack.ev,sel
-0006ae50: 662e 7973 6869 6674 732c 2063 6f6c 6f72  f.yshifts, color
-0006ae60: 3d27 7265 6427 290d 0a20 2020 2020 2020  ='red')..       
-0006ae70: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0006ae80: 2020 2020 706c 6f74 203d 2061 7865 732e      plot = axes.
-0006ae90: 706c 6f74 2873 656c 662e 7374 6163 6b2e  plot(self.stack.
-0006aea0: 6576 2c73 656c 662e 7873 6869 6674 735b  ev,self.xshifts[
-0006aeb0: 3a2c 7365 6c66 2e69 7468 6574 615d 2c20  :,self.itheta], 
-0006aec0: 636f 6c6f 723d 2767 7265 656e 2729 0d0a  color='green')..
-0006aed0: 2020 2020 2020 2020 2020 2020 706c 6f74              plot
-0006aee0: 203d 2061 7865 732e 706c 6f74 2873 656c   = axes.plot(sel
-0006aef0: 662e 7374 6163 6b2e 6576 2c73 656c 662e  f.stack.ev,self.
-0006af00: 7973 6869 6674 735b 3a2c 7365 6c66 2e69  yshifts[:,self.i
-0006af10: 7468 6574 615d 2c20 636f 6c6f 723d 2772  theta], color='r
-0006af20: 6564 2729 0d0a 0d0a 2020 2020 2020 2020  ed')....        
-0006af30: 7365 6c66 2e53 6869 6674 7350 616e 656c  self.ShiftsPanel
-0006af40: 2e64 7261 7728 290d 0a0d 0a23 2d2d 2d2d  .draw()....#----
-0006af50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006af60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006af70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006af80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006af90: 2d2d 0d0a 2020 2020 6465 6620 4f6e 506c  --..    def OnPl
-0006afa0: 6f74 5368 6966 7473 2873 656c 662c 2065  otShifts(self, e
-0006afb0: 7674 293a 0d0a 2020 2020 2020 2020 7820  vt):..        x 
-0006afc0: 3d20 6576 742e 7864 6174 610d 0a20 2020  = evt.xdata..   
-0006afd0: 2020 2020 2079 203d 2065 7674 2e79 6461       y = evt.yda
-0006afe0: 7461 0d0a 0d0a 2020 2020 2020 2020 6966  ta....        if
-0006aff0: 2073 656c 662e 7873 6869 6674 732e 616e   self.xshifts.an
-0006b000: 7928 293a 0d0a 2020 2020 2020 2020 2020  y():..          
-0006b010: 2020 6966 2078 203c 2073 656c 662e 7374    if x < self.st
-0006b020: 6163 6b2e 6576 5b30 5d3a 0d0a 2020 2020  ack.ev[0]:..    
-0006b030: 2020 2020 2020 2020 2020 2020 7365 6c5f              sel_
-0006b040: 6576 203d 2030 0d0a 2020 2020 2020 2020  ev = 0..        
-0006b050: 2020 2020 656c 6966 2078 203e 2073 656c      elif x > sel
-0006b060: 662e 7374 6163 6b2e 6576 5b73 656c 662e  f.stack.ev[self.
-0006b070: 7374 6163 6b2e 6e5f 6576 2d31 5d3a 0d0a  stack.n_ev-1]:..
-0006b080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b090: 7365 6c5f 6576 203d 2073 656c 662e 7374  sel_ev = self.st
-0006b0a0: 6163 6b2e 6e5f 6576 2d31 0d0a 2020 2020  ack.n_ev-1..    
-0006b0b0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0006b0c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0006b0d0: 6e64 7820 3d20 6e70 2e61 6273 2873 656c  ndx = np.abs(sel
-0006b0e0: 662e 7374 6163 6b2e 6576 202d 2078 292e  f.stack.ev - x).
-0006b0f0: 6172 676d 696e 2829 0d0a 2020 2020 2020  argmin()..      
-0006b100: 2020 2020 2020 2020 2020 7365 6c5f 6576            sel_ev
-0006b110: 203d 2069 6e64 780d 0a0d 0a20 2020 2020   = indx....     
-0006b120: 2020 2020 2020 2073 656c 662e 6965 7620         self.iev 
-0006b130: 3d20 7365 6c5f 6576 0d0a 0d0a 2020 2020  = sel_ev....    
-0006b140: 2020 2020 2020 2020 7365 6c66 2e53 686f          self.Sho
-0006b150: 7749 6d61 6765 2829 0d0a 0d0a 2020 2020  wImage()....    
-0006b160: 2020 2020 2020 2020 7365 6c66 2e73 6c69          self.sli
-0006b170: 6465 725f 656e 672e 7365 7456 616c 7565  der_eng.setValue
-0006b180: 2873 656c 662e 6965 7629 0d0a 0d0a 232d  (self.iev)....#-
-0006b190: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006b1a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006b1b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006b1c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006b1d0: 2d2d 2d2d 2d0d 0a20 2020 2064 6566 204f  -----..    def O
-0006b1e0: 6e53 6176 6553 6869 6674 7350 6c6f 7428  nSaveShiftsPlot(
-0006b1f0: 7365 6c66 2c20 6576 7429 3a0d 0a0d 0a0d  self, evt):.....
-0006b200: 0a20 2020 2020 2020 2077 696c 6463 6172  .        wildcar
-0006b210: 6420 3d20 2250 6f72 7461 626c 6520 4e65  d = "Portable Ne
-0006b220: 7477 6f72 6b20 4772 6170 6869 6373 2028  twork Graphics (
-0006b230: 2a2e 706e 6729 3b3b 4164 6f62 6520 5044  *.png);;Adobe PD
-0006b240: 4620 4669 6c65 7320 282a 2e70 6466 293b  F Files (*.pdf);
-0006b250: 3b22 0d0a 0d0a 2020 2020 2020 2020 7365  ;"....        se
-0006b260: 6c66 2e53 6176 6546 696c 654e 616d 652c  lf.SaveFileName,
-0006b270: 205f 6669 6c74 6572 203d 2051 7457 6964   _filter = QtWid
-0006b280: 6765 7473 2e51 4669 6c65 4469 616c 6f67  gets.QFileDialog
-0006b290: 2e67 6574 5361 7665 4669 6c65 4e61 6d65  .getSaveFileName
-0006b2a0: 2873 656c 662c 2027 5361 7665 2049 6d61  (self, 'Save Ima
-0006b2b0: 6765 2053 6869 6674 7320 506c 6f74 272c  ge Shifts Plot',
-0006b2c0: 2027 272c 2077 696c 6463 6172 6429 0d0a   '', wildcard)..
-0006b2d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e53  ..        self.S
-0006b2e0: 6176 6546 696c 654e 616d 6520 3d20 7374  aveFileName = st
-0006b2f0: 7228 7365 6c66 2e53 6176 6546 696c 654e  r(self.SaveFileN
-0006b300: 616d 6529 0d0a 2020 2020 2020 2020 6966  ame)..        if
-0006b310: 2073 656c 662e 5361 7665 4669 6c65 4e61   self.SaveFileNa
-0006b320: 6d65 203d 3d20 2727 3a0d 0a20 2020 2020  me == '':..     
-0006b330: 2020 2020 2020 2072 6574 7572 6e0d 0a0d         return...
-0006b340: 0a0d 0a20 2020 2020 2020 2070 6174 682c  ...        path,
-0006b350: 2065 7874 203d 206f 732e 7061 7468 2e73   ext = os.path.s
-0006b360: 706c 6974 6578 7428 7365 6c66 2e53 6176  plitext(self.Sav
-0006b370: 6546 696c 654e 616d 6529 0d0a 2020 2020  eFileName)..    
-0006b380: 2020 2020 6578 7420 3d20 6578 745b 313a      ext = ext[1:
-0006b390: 5d2e 6c6f 7765 7228 290d 0a0d 0a20 2020  ].lower()....   
-0006b3a0: 2020 2020 2074 7279 3a0d 0a0d 0a20 2020       try:....   
-0006b3b0: 2020 2020 2020 2020 206d 6174 706c 6f74           matplot
-0006b3c0: 6c69 622e 7263 5061 7261 6d73 5b27 7064  lib.rcParams['pd
-0006b3d0: 662e 666f 6e74 7479 7065 275d 203d 2034  f.fonttype'] = 4
-0006b3e0: 320d 0a20 2020 2020 2020 2020 2020 2069  2..            i
-0006b3f0: 6620 6578 7420 3d3d 2027 706e 6727 3a0d  f ext == 'png':.
-0006b400: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-0006b410: 2020 2066 6967 203d 2073 656c 662e 7368     fig = self.sh
-0006b420: 6966 7473 6669 670d 0a20 2020 2020 2020  iftsfig..       
-0006b430: 2020 2020 2020 2020 2066 6967 2e73 6176           fig.sav
-0006b440: 6566 6967 2873 656c 662e 5361 7665 4669  efig(self.SaveFi
-0006b450: 6c65 4e61 6d65 290d 0a0d 0a20 2020 2020  leName)....     
-0006b460: 2020 2020 2020 2069 6620 6578 7420 3d3d         if ext ==
-0006b470: 2770 6466 273a 0d0a 0d0a 0d0a 2020 2020  'pdf':......    
-0006b480: 2020 2020 2020 2020 2020 2020 6669 6720              fig 
-0006b490: 3d20 7365 6c66 2e73 6869 6674 7366 6967  = self.shiftsfig
-0006b4a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006b4b0: 2020 6669 672e 7361 7665 6669 6728 7365    fig.savefig(se
-0006b4c0: 6c66 2e53 6176 6546 696c 654e 616d 6529  lf.SaveFileName)
-0006b4d0: 0d0a 0d0a 2020 2020 2020 2020 6578 6365  ....        exce
-0006b4e0: 7074 3a0d 0a20 2020 2020 2020 2020 2020  pt:..           
-0006b4f0: 2070 6173 730d 0a0d 0a23 2d2d 2d2d 2d2d   pass....#------
-0006b500: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006b510: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006b520: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006b530: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006b540: 0d0a 2020 2020 6465 6620 4f6e 5365 6c65  ..    def OnSele
-0006b550: 6374 5375 6272 6567 696f 6e28 7365 6c66  ctSubregion(self
-0006b560: 2c20 6576 656e 7429 3a0d 0a0d 0a20 2020  , event):....   
-0006b570: 2020 2020 2073 656c 662e 7375 6272 6567       self.subreg
-0006b580: 696f 6e20 3d20 310d 0a20 2020 2020 2020  ion = 1..       
-0006b590: 2073 656c 662e 7372 5f78 3120 3d20 300d   self.sr_x1 = 0.
-0006b5a0: 0a20 2020 2020 2020 2073 656c 662e 7372  .        self.sr
-0006b5b0: 5f78 3220 3d20 300d 0a20 2020 2020 2020  _x2 = 0..       
-0006b5c0: 2073 656c 662e 7372 5f79 3120 3d20 300d   self.sr_y1 = 0.
-0006b5d0: 0a20 2020 2020 2020 2073 656c 662e 7372  .        self.sr
-0006b5e0: 5f79 3220 3d20 300d 0a0d 0a20 2020 2020  _y2 = 0....     
-0006b5f0: 2020 2073 656c 662e 6275 7474 6f6e 5f64     self.button_d
-0006b600: 656c 7375 6272 6567 696f 6e2e 7365 7445  elsubregion.setE
-0006b610: 6e61 626c 6564 2854 7275 6529 0d0a 0d0a  nabled(True)....
-0006b620: 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ..#-------------
-0006b630: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006b640: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006b650: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006b660: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
-0006b670: 6566 204f 6e44 656c 6574 6553 7562 7265  ef OnDeleteSubre
-0006b680: 6769 6f6e 2873 656c 662c 2065 7665 6e74  gion(self, event
-0006b690: 293a 0d0a 0d0a 2020 2020 2020 2020 7365  ):....        se
-0006b6a0: 6c66 2e73 7562 7265 6769 6f6e 203d 2030  lf.subregion = 0
-0006b6b0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-0006b6c0: 725f 7831 203d 2030 0d0a 2020 2020 2020  r_x1 = 0..      
-0006b6d0: 2020 7365 6c66 2e73 725f 7832 203d 2030    self.sr_x2 = 0
-0006b6e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-0006b6f0: 725f 7931 203d 2030 0d0a 2020 2020 2020  r_y1 = 0..      
-0006b700: 2020 7365 6c66 2e73 725f 7932 203d 2030    self.sr_y2 = 0
-0006b710: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-0006b720: 2e62 7574 746f 6e5f 7072 6573 7365 6420  .button_pressed 
-0006b730: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-0006b740: 2073 656c 662e 7061 7463 6820 3d20 4e6f   self.patch = No
-0006b750: 6e65 0d0a 2020 2020 2020 2020 7365 6c66  ne..        self
-0006b760: 2e52 6566 496d 6167 6550 616e 656c 2e6d  .RefImagePanel.m
-0006b770: 706c 5f64 6973 636f 6e6e 6563 7428 7365  pl_disconnect(se
-0006b780: 6c66 2e6d 6f75 7365 6d6f 7665 636f 6e6e  lf.mousemoveconn
-0006b790: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-0006b7a0: 662e 5368 6f77 5265 6649 6d61 6765 2829  f.ShowRefImage()
-0006b7b0: 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d  ......#---------
-0006b7c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006b7d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006b7e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006b7f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20  -------------.. 
-0006b800: 2020 2064 6566 204f 6e53 656c 6563 7469     def OnSelecti
-0006b810: 6f6e 2873 656c 662c 2065 7674 293a 0d0a  on(self, evt):..
-0006b820: 0d0a 2020 2020 2020 2020 6966 2028 7365  ..        if (se
-0006b830: 6c66 2e6d 616e 5f61 6c69 676e 203e 2030  lf.man_align > 0
-0006b840: 2920 616e 6420 2873 656c 662e 7375 6272  ) and (self.subr
-0006b850: 6567 696f 6e20 3d3d 2030 293a 0d0a 2020  egion == 0):..  
-0006b860: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0006b870: 0d0a 0d0a 2020 2020 2020 2020 7832 2c20  ....        x2, 
-0006b880: 7932 203d 2065 7674 2e78 6461 7461 2c20  y2 = evt.xdata, 
-0006b890: 6576 742e 7964 6174 610d 0a0d 0a20 2020  evt.ydata....   
-0006b8a0: 2020 2020 2069 6620 2878 3220 3d3d 204e       if (x2 == N
-0006b8b0: 6f6e 6529 206f 7220 2879 3220 3d3d 204e  one) or (y2 == N
-0006b8c0: 6f6e 6529 3a0d 0a20 2020 2020 2020 2020  one):..         
-0006b8d0: 2020 2072 6574 7572 6e0d 0a0d 0a20 2020     return....   
-0006b8e0: 2020 2020 2073 656c 662e 7372 5f78 3120       self.sr_x1 
-0006b8f0: 3d20 696e 7428 7365 6c66 2e73 725f 7831  = int(self.sr_x1
-0006b900: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0006b910: 7372 5f78 3220 3d20 696e 7428 7832 290d  sr_x2 = int(x2).
-0006b920: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0006b930: 7372 5f79 3220 3d20 696e 7428 7365 6c66  sr_y2 = int(self
-0006b940: 2e73 725f 7931 290d 0a20 2020 2020 2020  .sr_y1)..       
-0006b950: 2073 656c 662e 7372 5f79 3120 3d20 696e   self.sr_y1 = in
-0006b960: 7428 7932 290d 0a0d 0a20 2020 2020 2020  t(y2)....       
-0006b970: 2069 6620 7365 6c66 2e73 725f 7831 203e   if self.sr_x1 >
-0006b980: 2073 656c 662e 7372 5f78 323a 0d0a 2020   self.sr_x2:..  
-0006b990: 2020 2020 2020 2020 2020 7465 6d70 203d            temp =
-0006b9a0: 2073 656c 662e 7372 5f78 310d 0a20 2020   self.sr_x1..   
-0006b9b0: 2020 2020 2020 2020 2073 656c 662e 7372           self.sr
-0006b9c0: 5f78 3120 3d20 7365 6c66 2e73 725f 7832  _x1 = self.sr_x2
-0006b9d0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0006b9e0: 6c66 2e73 725f 7832 203d 2074 656d 700d  lf.sr_x2 = temp.
-0006b9f0: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
-0006ba00: 6c66 2e73 725f 7932 203e 2073 656c 662e  lf.sr_y2 > self.
-0006ba10: 7372 5f79 313a 0d0a 2020 2020 2020 2020  sr_y1:..        
-0006ba20: 2020 2020 7465 6d70 203d 2073 656c 662e      temp = self.
-0006ba30: 7372 5f79 310d 0a20 2020 2020 2020 2020  sr_y1..         
-0006ba40: 2020 2073 656c 662e 7372 5f79 3120 3d20     self.sr_y1 = 
-0006ba50: 7365 6c66 2e73 725f 7932 0d0a 2020 2020  self.sr_y2..    
-0006ba60: 2020 2020 2020 2020 7365 6c66 2e73 725f          self.sr_
-0006ba70: 7932 203d 2074 656d 700d 0a0d 0a0d 0a20  y2 = temp...... 
-0006ba80: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
-0006ba90: 6f6e 5f70 7265 7373 6564 203d 2046 616c  on_pressed = Fal
-0006baa0: 7365 0d0a 0d0a 2020 2020 2020 2020 7365  se....        se
-0006bab0: 6c66 2e52 6566 496d 6167 6550 616e 656c  lf.RefImagePanel
-0006bac0: 2e6d 706c 5f64 6973 636f 6e6e 6563 7428  .mpl_disconnect(
-0006bad0: 7365 6c66 2e4f 6e53 656c 6563 7469 6f6e  self.OnSelection
-0006bae0: 4d6f 7469 6f6e 290d 0a0d 0a20 2020 2020  Motion)....     
-0006baf0: 2020 2073 656c 662e 5368 6f77 5265 6649     self.ShowRefI
-0006bb00: 6d61 6765 2829 0d0a 0d0a 232d 2d2d 2d2d  mage()....#-----
-0006bb10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006bb20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006bb30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006bb40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006bb50: 2d0d 0a20 2020 2064 6566 204f 6e53 656c  -..    def OnSel
-0006bb60: 6563 7469 6f6e 4d6f 7469 6f6e 2873 656c  ectionMotion(sel
-0006bb70: 662c 2065 7665 6e74 293a 0d0a 0d0a 2020  f, event):....  
-0006bb80: 2020 2020 2020 7832 2c20 7932 203d 2065        x2, y2 = e
-0006bb90: 7665 6e74 2e78 6461 7461 2c20 6576 656e  vent.xdata, even
-0006bba0: 742e 7964 6174 610d 0a0d 0a20 2020 2020  t.ydata....     
-0006bbb0: 2020 2069 6620 2878 3220 3d3d 204e 6f6e     if (x2 == Non
-0006bbc0: 6529 206f 7220 2879 3220 3d3d 204e 6f6e  e) or (y2 == Non
-0006bbd0: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
-0006bbe0: 2072 6574 7572 6e0d 0a0d 0a20 2020 2020   return....     
-0006bbf0: 2020 2069 6620 7365 6c66 2e62 7574 746f     if self.butto
-0006bc00: 6e5f 7072 6573 7365 6420 3d3d 2046 616c  n_pressed == Fal
-0006bc10: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-0006bc20: 2072 6574 7572 6e0d 0a0d 0a20 2020 2020   return....     
-0006bc30: 2020 2073 656c 662e 7372 5f78 3220 3d20     self.sr_x2 = 
-0006bc40: 696e 7428 7832 290d 0a20 2020 2020 2020  int(x2)..       
-0006bc50: 2073 656c 662e 7372 5f79 3220 3d20 696e   self.sr_y2 = in
-0006bc60: 7428 7932 290d 0a0d 0a20 2020 2020 2020  t(y2)....       
-0006bc70: 2066 6967 203d 2073 656c 662e 7265 6669   fig = self.refi
-0006bc80: 6d67 6669 670d 0a0d 0a20 2020 2020 2020  mgfig....       
-0006bc90: 2061 7865 7320 3d20 6669 672e 6763 6128   axes = fig.gca(
-0006bca0: 290d 0a0d 0a0d 0a0d 0a20 2020 2020 2020  )........       
-0006bcb0: 2066 726f 6d20 6d61 7470 6c6f 746c 6962   from matplotlib
-0006bcc0: 2e70 6174 6820 696d 706f 7274 2050 6174  .path import Pat
-0006bcd0: 680d 0a20 2020 2020 2020 2069 6d70 6f72  h..        impor
-0006bce0: 7420 6d61 7470 6c6f 746c 6962 2e70 6174  t matplotlib.pat
-0006bcf0: 6368 6573 2061 7320 7061 7463 6865 730d  ches as patches.
-0006bd00: 0a0d 0a20 2020 2020 2020 2076 6572 7473  ...        verts
-0006bd10: 203d 205b 0d0a 2020 2020 2020 2020 2020   = [..          
-0006bd20: 2020 2020 2020 2028 7365 6c66 2e73 725f         (self.sr_
-0006bd30: 7831 2c20 7365 6c66 2e73 725f 7931 292c  x1, self.sr_y1),
-0006bd40: 2023 206c 6566 742c 2062 6f74 746f 6d0d   # left, bottom.
-0006bd50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006bd60: 2020 2873 656c 662e 7372 5f78 312c 2073    (self.sr_x1, s
-0006bd70: 656c 662e 7372 5f79 3229 2c20 2320 6c65  elf.sr_y2), # le
-0006bd80: 6674 2c20 746f 700d 0a20 2020 2020 2020  ft, top..       
-0006bd90: 2020 2020 2020 2020 2020 2873 656c 662e            (self.
-0006bda0: 7372 5f78 322c 2073 656c 662e 7372 5f79  sr_x2, self.sr_y
-0006bdb0: 3229 2c20 2320 7269 6768 742c 2074 6f70  2), # right, top
-0006bdc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006bdd0: 2020 2028 7365 6c66 2e73 725f 7832 2c20     (self.sr_x2, 
-0006bde0: 7365 6c66 2e73 725f 7931 292c 2023 2072  self.sr_y1), # r
-0006bdf0: 6967 6874 2c20 626f 7474 6f6d 0d0a 2020  ight, bottom..  
-0006be00: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0006be10: 7365 6c66 2e73 725f 7831 2c20 7365 6c66  self.sr_x1, self
-0006be20: 2e73 725f 7931 292c 2023 2069 676e 6f72  .sr_y1), # ignor
-0006be30: 6564 0d0a 2020 2020 2020 2020 2020 2020  ed..            
-0006be40: 2020 2020 205d 0d0a 0d0a 2020 2020 2020       ]....      
-0006be50: 2020 636f 6465 7320 3d20 5b50 6174 682e    codes = [Path.
-0006be60: 4d4f 5645 544f 2c0d 0a20 2020 2020 2020  MOVETO,..       
-0006be70: 2020 2020 2020 2020 2020 5061 7468 2e4c            Path.L
-0006be80: 494e 4554 4f2c 0d0a 2020 2020 2020 2020  INETO,..        
-0006be90: 2020 2020 2020 2020 2050 6174 682e 4c49           Path.LI
-0006bea0: 4e45 544f 2c0d 0a20 2020 2020 2020 2020  NETO,..         
-0006beb0: 2020 2020 2020 2020 5061 7468 2e4c 494e          Path.LIN
-0006bec0: 4554 4f2c 0d0a 2020 2020 2020 2020 2020  ETO,..          
-0006bed0: 2020 2020 2020 2050 6174 682e 434c 4f53         Path.CLOS
-0006bee0: 4550 4f4c 592c 0d0a 2020 2020 2020 2020  EPOLY,..        
-0006bef0: 2020 2020 2020 2020 205d 0d0a 0d0a 2020           ]....  
-0006bf00: 2020 2020 2020 7061 7468 203d 2050 6174        path = Pat
-0006bf10: 6828 7665 7274 732c 2063 6f64 6573 290d  h(verts, codes).
-0006bf20: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
-0006bf30: 6c66 2e70 6174 6368 2021 3d20 4e6f 6e65  lf.patch != None
-0006bf40: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0006bf50: 656c 662e 7061 7463 682e 7265 6d6f 7665  elf.patch.remove
-0006bf60: 2829 0d0a 0d0a 2020 2020 2020 2020 7365  ()....        se
-0006bf70: 6c66 2e70 6174 6368 203d 2070 6174 6368  lf.patch = patch
-0006bf80: 6573 2e50 6174 6850 6174 6368 2870 6174  es.PathPatch(pat
-0006bf90: 682c 2066 6163 6563 6f6c 6f72 3d27 7265  h, facecolor='re
-0006bfa0: 6427 290d 0a20 2020 2020 2020 2073 656c  d')..        sel
-0006bfb0: 662e 7061 7463 682e 7365 745f 616c 7068  f.patch.set_alph
-0006bfc0: 6128 302e 3329 0d0a 2020 2020 2020 2020  a(0.3)..        
-0006bfd0: 6178 6573 2e61 6464 5f70 6174 6368 2873  axes.add_patch(s
-0006bfe0: 656c 662e 7061 7463 6829 0d0a 0d0a 2020  elf.patch)....  
-0006bff0: 2020 2020 2020 6178 6573 2e61 7869 7328        axes.axis(
-0006c000: 226f 6666 2229 0d0a 0d0a 2020 2020 2020  "off")....      
-0006c010: 2020 7365 6c66 2e52 6566 496d 6167 6550    self.RefImageP
-0006c020: 616e 656c 2e64 7261 7728 290d 0a0d 0a23  anel.draw()....#
-0006c030: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006c040: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006c050: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006c060: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006c070: 2d2d 2d2d 2d2d 0d0a 2020 2020 6465 6620  ------..    def 
-0006c080: 4f6e 5361 7665 5368 6966 7473 2873 656c  OnSaveShifts(sel
-0006c090: 662c 2065 7674 293a 0d0a 0d0a 0d0a 2020  f, evt):......  
-0006c0a0: 2020 2020 2020 7769 6c64 6361 7264 203d        wildcard =
-0006c0b0: 2022 4353 5620 6669 6c65 7320 282a 2e63   "CSV files (*.c
-0006c0c0: 7376 2922 0d0a 0d0a 2020 2020 2020 2020  sv)"....        
-0006c0d0: 6669 6c65 7061 7468 2c20 5f66 696c 7465  filepath, _filte
-0006c0e0: 7220 3d20 5174 5769 6467 6574 732e 5146  r = QtWidgets.QF
-0006c0f0: 696c 6544 6961 6c6f 672e 6765 7453 6176  ileDialog.getSav
-0006c100: 6546 696c 654e 616d 6528 7365 6c66 2c20  eFileName(self, 
-0006c110: 2750 6c65 6173 6520 7365 6c65 6374 2061  'Please select a
-0006c120: 6e20 616c 6967 6e6d 656e 7420 6669 6c65  n alignment file
-0006c130: 2028 2e63 7376 2927 2c20 2727 2c20 7769   (.csv)', '', wi
-0006c140: 6c64 6361 7264 290d 0a0d 0a20 2020 2020  ldcard)....     
-0006c150: 2020 2066 696c 6570 6174 6820 3d20 7374     filepath = st
-0006c160: 7228 6669 6c65 7061 7468 290d 0a20 2020  r(filepath)..   
-0006c170: 2020 2020 2069 6620 6669 6c65 7061 7468       if filepath
-0006c180: 203d 3d20 2727 3a0d 0a20 2020 2020 2020   == '':..       
-0006c190: 2020 2020 2072 6574 7572 6e0d 0a0d 0a0d       return.....
-0006c1a0: 0a0d 0a0d 0a20 2020 2020 2020 2066 203d  .....        f =
-0006c1b0: 206f 7065 6e28 6669 6c65 7061 7468 2c20   open(filepath, 
-0006c1c0: 2777 2729 0d0a 0d0a 2020 2020 2020 2020  'w')....        
-0006c1d0: 6966 2073 656c 662e 636f 6d2e 7374 6163  if self.com.stac
-0006c1e0: 6b5f 3464 203d 3d20 303a 0d0a 2020 2020  k_4d == 0:..    
-0006c1f0: 2020 2020 2020 2020 7072 696e 7428 272a          print('*
-0006c200: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
-0006c210: 2a2a 2a2a 2020 416c 6967 6e6d 656e 7420  ****  Alignment 
-0006c220: 6669 6c65 2020 2a2a 2a2a 2a2a 2a2a 2a2a  file  **********
-0006c230: 2a2a 2a2a 2a2a 2a2a 2a2a 272c 2066 696c  **********', fil
-0006c240: 653d 6629 0d0a 2020 2020 2020 2020 2020  e=f)..          
-0006c250: 2020 7072 696e 7428 272a 2a2a 2020 666f    print('***  fo
-0006c260: 7220 272c 2073 656c 662e 636f 6d2e 6669  r ', self.com.fi
-0006c270: 6c65 6e61 6d65 2c20 6669 6c65 3d66 290d  lename, file=f).
-0006c280: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0006c290: 6e74 2827 2a2a 2a20 2065 762c 2078 7368  nt('***  ev, xsh
-0006c2a0: 6966 742c 2079 7368 6966 7427 2c20 6669  ift, yshift', fi
-0006c2b0: 6c65 3d66 290d 0a20 2020 2020 2020 2020  le=f)..         
-0006c2c0: 2020 2066 6f72 2069 6520 696e 2072 616e     for ie in ran
-0006c2d0: 6765 2873 656c 662e 7374 6163 6b2e 6e5f  ge(self.stack.n_
-0006c2e0: 6576 293a 0d0a 2020 2020 2020 2020 2020  ev):..          
-0006c2f0: 2020 2020 2020 7072 696e 7428 2725 2e36        print('%.6
-0006c300: 662c 2025 2e36 662c 2025 2e36 6627 2025  f, %.6f, %.6f' %
-0006c310: 2873 656c 662e 7374 6163 6b2e 6576 5b69  (self.stack.ev[i
-0006c320: 655d 2c20 7365 6c66 2e78 7368 6966 7473  e], self.xshifts
-0006c330: 5b69 655d 2c20 7365 6c66 2e79 7368 6966  [ie], self.yshif
-0006c340: 7473 5b69 655d 292c 2066 696c 653d 6629  ts[ie]), file=f)
-0006c350: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-0006c360: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0006c370: 6e74 2827 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  nt('************
-0006c380: 2a2a 2a2a 2a2a 2a2a 2a20 2041 6c69 676e  *********  Align
-0006c390: 6d65 6e74 2066 696c 6520 202a 2a2a 2a2a  ment file  *****
-0006c3a0: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a27  ***************'
-0006c3b0: 2c20 6669 6c65 3d66 290d 0a20 2020 2020  , file=f)..     
-0006c3c0: 2020 2020 2020 2070 7269 6e74 2827 2a2a         print('**
-0006c3d0: 2a20 2066 6f72 2027 2c20 7365 6c66 2e63  *  for ', self.c
-0006c3e0: 6f6d 2e66 696c 656e 616d 652c 2066 696c  om.filename, fil
-0006c3f0: 653d 6629 0d0a 2020 2020 2020 2020 2020  e=f)..          
-0006c400: 2020 7072 696e 7428 272a 2a2a 2020 6576    print('***  ev
-0006c410: 2c20 7468 6574 612c 2078 7368 6966 742c  , theta, xshift,
-0006c420: 2079 7368 6966 7427 2c20 6669 6c65 3d66   yshift', file=f
-0006c430: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
-0006c440: 6f72 2069 2069 6e20 7261 6e67 6528 7365  or i in range(se
-0006c450: 6c66 2e73 7461 636b 2e6e 5f65 7629 3a0d  lf.stack.n_ev):.
-0006c460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006c470: 2066 6f72 206a 2069 6e20 7261 6e67 6528   for j in range(
-0006c480: 7365 6c66 2e73 7461 636b 2e6e 5f74 6865  self.stack.n_the
-0006c490: 7461 293a 0d0a 2020 2020 2020 2020 2020  ta):..          
-0006c4a0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0006c4b0: 2725 2e36 662c 2025 2e36 662c 2025 2e36  '%.6f, %.6f, %.6
-0006c4c0: 662c 2025 2e36 6627 2025 2873 656c 662e  f, %.6f' %(self.
-0006c4d0: 7374 6163 6b2e 6576 5b69 5d2c 2073 656c  stack.ev[i], sel
-0006c4e0: 662e 7374 6163 6b2e 7468 6574 615b 6a5d  f.stack.theta[j]
-0006c4f0: 2c20 7365 6c66 2e78 7368 6966 7473 5b69  , self.xshifts[i
-0006c500: 2c6a 5d2c 2073 656c 662e 7973 6869 6674  ,j], self.yshift
-0006c510: 735b 692c 6a5d 292c 2066 696c 653d 6629  s[i,j]), file=f)
-0006c520: 0d0a 0d0a 0d0a 2020 2020 2020 2020 662e  ......        f.
-0006c530: 636c 6f73 6528 290d 0a0d 0a23 2d2d 2d2d  close()....#----
-0006c540: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006c550: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006c560: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006c570: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006c580: 2d2d 0d0a 2020 2020 6465 6620 4f6e 4c6f  --..    def OnLo
-0006c590: 6164 5368 6966 7473 2873 656c 662c 2065  adShifts(self, e
-0006c5a0: 7674 293a 0d0a 0d0a 0d0a 0d0a 2020 2020  vt):........    
-0006c5b0: 2020 2020 7769 6c64 6361 7264 203d 2022      wildcard = "
-0006c5c0: 4930 2043 5356 2066 696c 6573 2028 2a2e  I0 CSV files (*.
-0006c5d0: 6373 7629 220d 0a0d 0a20 2020 2020 2020  csv)"....       
-0006c5e0: 2066 696c 6570 6174 682c 205f 6669 6c74   filepath, _filt
-0006c5f0: 6572 203d 2051 7457 6964 6765 7473 2e51  er = QtWidgets.Q
-0006c600: 4669 6c65 4469 616c 6f67 2e67 6574 4f70  FileDialog.getOp
-0006c610: 656e 4669 6c65 4e61 6d65 2873 656c 662c  enFileName(self,
-0006c620: 2027 506c 6561 7365 2073 656c 6563 7420   'Please select 
-0006c630: 616e 2061 6c69 676e 6d65 6e74 2066 696c  an alignment fil
-0006c640: 6520 282e 6373 7629 272c 2027 272c 2077  e (.csv)', '', w
-0006c650: 696c 6463 6172 6429 0d0a 0d0a 0d0a 2020  ildcard)......  
-0006c660: 2020 2020 2020 6669 6c65 7061 7468 203d        filepath =
-0006c670: 2073 7472 2866 696c 6570 6174 6829 0d0a   str(filepath)..
-0006c680: 2020 2020 2020 2020 6966 2066 696c 6570          if filep
-0006c690: 6174 6820 3d3d 2027 273a 0d0a 2020 2020  ath == '':..    
-0006c6a0: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
-0006c6b0: 0d0a 0d0a 2020 2020 2020 2020 6620 3d20  ....        f = 
-0006c6c0: 6f70 656e 2873 7472 2866 696c 6570 6174  open(str(filepat
-0006c6d0: 6829 2c27 7227 290d 0a0d 0a20 2020 2020  h),'r')....     
-0006c6e0: 2020 2065 6c69 7374 203d 205b 5d0d 0a20     elist = [].. 
-0006c6f0: 2020 2020 2020 2078 7368 6966 746c 6973         xshiftlis
-0006c700: 7420 3d20 5b5d 0d0a 2020 2020 2020 2020  t = []..        
-0006c710: 7973 6869 6674 6c69 7374 203d 205b 5d0d  yshiftlist = [].
-0006c720: 0a0d 0a20 2020 2020 2020 2066 6f72 206c  ...        for l
-0006c730: 696e 6520 696e 2066 3a0d 0a20 2020 2020  ine in f:..     
-0006c740: 2020 2020 2020 2069 6620 6c69 6e65 2e73         if line.s
-0006c750: 7461 7274 7377 6974 6828 272a 2729 3a0d  tartswith('*'):.
-0006c760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006c770: 2063 6f6e 7469 6e75 650d 0a20 2020 2020   continue..     
-0006c780: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0006c790: 2020 2020 2020 2020 2020 2020 2020 652c                e,
-0006c7a0: 2078 732c 2079 7320 3d20 5b66 6c6f 6174   xs, ys = [float
-0006c7b0: 2028 7829 2066 6f72 2078 2069 6e20 6c69   (x) for x in li
-0006c7c0: 6e65 2e73 706c 6974 2827 2c27 295d 0d0a  ne.split(',')]..
-0006c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006c7e0: 656c 6973 742e 6170 7065 6e64 2865 290d  elist.append(e).
-0006c7f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006c800: 2078 7368 6966 746c 6973 742e 6170 7065   xshiftlist.appe
-0006c810: 6e64 2878 7329 0d0a 2020 2020 2020 2020  nd(xs)..        
-0006c820: 2020 2020 2020 2020 7973 6869 6674 6c69          yshiftli
-0006c830: 7374 2e61 7070 656e 6428 7973 290d 0a0d  st.append(ys)...
-0006c840: 0a20 2020 2020 2020 2066 2e63 6c6f 7365  .        f.close
-0006c850: 2829 0d0a 0d0a 0d0a 2020 2020 2020 2020  ()......        
-0006c860: 7365 6c66 2e78 7368 6966 7473 203d 206e  self.xshifts = n
-0006c870: 702e 7a65 726f 7328 2873 656c 662e 7374  p.zeros((self.st
-0006c880: 6163 6b2e 6e5f 6576 2929 0d0a 2020 2020  ack.n_ev))..    
-0006c890: 2020 2020 7365 6c66 2e79 7368 6966 7473      self.yshifts
-0006c8a0: 203d 206e 702e 7a65 726f 7328 2873 656c   = np.zeros((sel
-0006c8b0: 662e 7374 6163 6b2e 6e5f 6576 2929 0d0a  f.stack.n_ev))..
-0006c8c0: 0d0a 2020 2020 2020 2020 666f 7220 6965  ..        for ie
-0006c8d0: 2069 6e20 7261 6e67 6528 7365 6c66 2e73   in range(self.s
-0006c8e0: 7461 636b 2e6e 5f65 7629 3a0d 0a20 2020  tack.n_ev):..   
-0006c8f0: 2020 2020 2020 2020 2065 6e67 666c 203d           engfl =
-0006c900: 2027 252e 3666 2720 2520 2820 7365 6c66   '%.6f' % ( self
-0006c910: 2e73 7461 636b 2e65 765b 6965 5d29 0d0a  .stack.ev[ie])..
-0006c920: 2020 2020 2020 2020 2020 2020 656e 6720              eng 
-0006c930: 3d20 666c 6f61 7428 656e 6766 6c29 0d0a  = float(engfl)..
-0006c940: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-0006c950: 6e67 2069 6e20 656c 6973 743a 0d0a 2020  ng in elist:..  
-0006c960: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0006c970: 6420 3d20 656c 6973 742e 696e 6465 7828  d = elist.index(
-0006c980: 656e 6729 0d0a 2020 2020 2020 2020 2020  eng)..          
-0006c990: 2020 2020 2020 7365 6c66 2e78 7368 6966        self.xshif
-0006c9a0: 7473 5b69 655d 203d 2078 7368 6966 746c  ts[ie] = xshiftl
-0006c9b0: 6973 745b 696e 645d 0d0a 2020 2020 2020  ist[ind]..      
-0006c9c0: 2020 2020 2020 2020 2020 7365 6c66 2e79            self.y
-0006c9d0: 7368 6966 7473 5b69 655d 203d 2079 7368  shifts[ie] = ysh
-0006c9e0: 6966 746c 6973 745b 696e 645d 0d0a 0d0a  iftlist[ind]....
-0006c9f0: 0d0a 2020 2020 2020 2020 2341 7070 6c79  ..        #Apply
-0006ca00: 2073 6869 6674 730d 0a20 2020 2020 2020   shifts..       
-0006ca10: 2073 656c 662e 506c 6f74 5368 6966 7473   self.PlotShifts
-0006ca20: 2829 0d0a 2020 2020 2020 2020 666f 7220  ()..        for 
-0006ca30: 6920 696e 2072 616e 6765 2873 656c 662e  i in range(self.
-0006ca40: 7374 6163 6b2e 6e5f 6576 293a 0d0a 2020  stack.n_ev):..  
-0006ca50: 2020 2020 2020 2020 2020 696d 6720 3d20            img = 
-0006ca60: 7365 6c66 2e61 6c69 676e 6564 5f73 7461  self.aligned_sta
-0006ca70: 636b 5b3a 2c3a 2c69 5d0d 0a20 2020 2020  ck[:,:,i]..     
-0006ca80: 2020 2020 2020 2069 6620 2861 6273 2873         if (abs(s
-0006ca90: 656c 662e 7873 6869 6674 735b 695d 293e  elf.xshifts[i])>
-0006caa0: 302e 3032 2920 6f72 2028 6162 7328 7365  0.02) or (abs(se
-0006cab0: 6c66 2e79 7368 6966 7473 5b69 5d29 3e30  lf.yshifts[i])>0
-0006cac0: 2e30 3229 3a0d 0a20 2020 2020 2020 2020  .02):..         
-0006cad0: 2020 2020 2020 2073 6869 6674 6564 5f69         shifted_i
-0006cae0: 6d67 203d 2073 656c 662e 7374 6163 6b2e  mg = self.stack.
-0006caf0: 6170 706c 795f 696d 6167 655f 7265 6769  apply_image_regi
-0006cb00: 7374 7261 7469 6f6e 2869 6d67 2c0d 0a20  stration(img,.. 
-0006cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006cb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006cb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006cb50: 2073 656c 662e 7873 6869 6674 735b 695d   self.xshifts[i]
-0006cb60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00069d10: 2e6d 616e 5f78 735b 692c 6a5d 0d0a 2020  .man_xs[i,j]..  
+00069d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069d30: 2020 2020 2020 7365 6c66 2e79 7368 6966        self.yshif
+00069d40: 7473 5b69 2c6a 5d20 3d20 7365 6c66 2e79  ts[i,j] = self.y
+00069d50: 7368 6966 7473 5b69 2c6a 5d20 2b20 7365  shifts[i,j] + se
+00069d60: 6c66 2e6d 616e 5f79 735b 692c 6a5d 0d0a  lf.man_ys[i,j]..
+00069d70: 0d0a 0d0a 0d0a 0d0a 2020 2020 2020 2020  ........        
+00069d80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00069d90: 2e6d 616e 5f78 735b 692c 6a5d 203d 2030  .man_xs[i,j] = 0
+00069da0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00069db0: 2020 2020 2020 7365 6c66 2e6d 616e 5f79        self.man_y
+00069dc0: 735b 692c 6a5d 203d 2030 0d0a 0d0a 0d0a  s[i,j] = 0......
+00069dd0: 2020 2020 2020 2020 7365 6c66 2e72 6567          self.reg
+00069de0: 6973 745f 6361 6c63 756c 6174 6564 203d  ist_calculated =
+00069df0: 2031 0d0a 2020 2020 2020 2020 7365 6c66   1..        self
+00069e00: 2e6d 616e 5f61 6c69 676e 203d 2030 0d0a  .man_align = 0..
+00069e10: 0d0a 2020 2020 2020 2020 7365 6c66 2e53  ..        self.S
+00069e20: 686f 7752 6566 496d 6167 6528 290d 0a20  howRefImage().. 
+00069e30: 2020 2020 2020 2073 656c 662e 506c 6f74         self.Plot
+00069e40: 5368 6966 7473 2829 0d0a 0d0a 2020 2020  Shifts()....    
+00069e50: 2020 2020 7365 6c66 2e74 6578 7463 7472      self.textctr
+00069e60: 6c5f 6d73 312e 7365 7454 6578 7428 2758  l_ms1.setText('X
+00069e70: 206d 616e 7561 6c20 7368 6966 743a 205c   manual shift: \
+00069e80: 6e27 290d 0a20 2020 2020 2020 2073 656c  n')..        sel
+00069e90: 662e 7465 7874 6374 726c 5f6d 7332 2e73  f.textctrl_ms2.s
+00069ea0: 6574 5465 7874 2827 5920 6d61 6e75 616c  etText('Y manual
+00069eb0: 2073 6869 6674 3a20 2729 0d0a 0d0a 2020   shift: ')....  
+00069ec0: 2020 2020 2020 7365 6c66 2e55 7064 6174        self.Updat
+00069ed0: 6557 6964 6765 7473 2829 0d0a 0d0a 2020  eWidgets()....  
+00069ee0: 2020 2020 2020 6d69 6e5f 7873 6869 6674        min_xshift
+00069ef0: 203d 206e 702e 6d69 6e28 7365 6c66 2e78   = np.min(self.x
+00069f00: 7368 6966 7473 290d 0a20 2020 2020 2020  shifts)..       
+00069f10: 206d 6178 5f78 7368 6966 7420 3d20 6e70   max_xshift = np
+00069f20: 2e6d 6178 2873 656c 662e 7873 6869 6674  .max(self.xshift
+00069f30: 7329 0d0a 0d0a 2020 2020 2020 2020 6d69  s)....        mi
+00069f40: 6e5f 7973 6869 6674 203d 206e 702e 6d69  n_yshift = np.mi
+00069f50: 6e28 7365 6c66 2e79 7368 6966 7473 290d  n(self.yshifts).
+00069f60: 0a20 2020 2020 2020 206d 6178 5f79 7368  .        max_ysh
+00069f70: 6966 7420 3d20 6e70 2e6d 6178 2873 656c  ift = np.max(sel
+00069f80: 662e 7973 6869 6674 7329 0d0a 0d0a 2020  f.yshifts)....  
+00069f90: 2020 2020 2020 6966 206d 696e 5f78 7368        if min_xsh
+00069fa0: 6966 7420 3c20 7365 6c66 2e6d 696e 7873  ift < self.minxs
+00069fb0: 203a 2073 656c 662e 6d69 6e78 7320 3d20   : self.minxs = 
+00069fc0: 6d69 6e5f 7873 6869 6674 0d0a 2020 2020  min_xshift..    
+00069fd0: 2020 2020 6966 206d 6178 5f78 7368 6966      if max_xshif
+00069fe0: 7420 3e20 7365 6c66 2e6d 6178 7873 203a  t > self.maxxs :
+00069ff0: 2073 656c 662e 6d61 7878 7320 3d20 6d61   self.maxxs = ma
+0006a000: 785f 7873 6869 6674 0d0a 0d0a 2020 2020  x_xshift....    
+0006a010: 2020 2020 6966 206d 696e 5f79 7368 6966      if min_yshif
+0006a020: 7420 3c20 7365 6c66 2e6d 696e 7973 203a  t < self.minys :
+0006a030: 2073 656c 662e 6d69 6e79 7320 3d20 6d69   self.minys = mi
+0006a040: 6e5f 7973 6869 6674 0d0a 2020 2020 2020  n_yshift..      
+0006a050: 2020 6966 206d 6178 5f79 7368 6966 7420    if max_yshift 
+0006a060: 3e20 7365 6c66 2e6d 6178 7973 203a 2073  > self.maxys : s
+0006a070: 656c 662e 6d61 7879 7320 3d20 6d61 785f  elf.maxys = max_
+0006a080: 7973 6869 6674 0d0a 0d0a 0d0a 2020 2020  yshift......    
+0006a090: 2020 2020 7365 6c66 2e53 686f 7749 6d61      self.ShowIma
+0006a0a0: 6765 2829 0d0a 0d0a 0d0a 0d0a 0d0a 232d  ge()..........#-
+0006a0b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006a0c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006a0d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006a0e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006a0f0: 2d2d 2d2d 2d0d 0a20 2020 2064 6566 204f  -----..    def O
+0006a100: 6e41 6363 6570 7428 7365 6c66 293a 0d0a  nAccept(self):..
+0006a110: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0006a120: 662e 636f 6d2e 7374 6163 6b5f 3464 203d  f.com.stack_4d =
+0006a130: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
+0006a140: 2020 7365 6c66 2e73 7461 636b 2e61 6273    self.stack.abs
+0006a150: 6461 7461 203d 2073 656c 662e 616c 6967  data = self.alig
+0006a160: 6e65 645f 7374 6163 6b0d 0a20 2020 2020  ned_stack..     
+0006a170: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
+0006a180: 6b2e 6461 7461 5f73 7472 7563 742e 6578  k.data_struct.ex
+0006a190: 6368 616e 6765 2e64 6174 6120 3d20 7365  change.data = se
+0006a1a0: 6c66 2e73 7461 636b 2e61 6273 6461 7461  lf.stack.absdata
+0006a1b0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+0006a1c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0006a1d0: 662e 7374 6163 6b2e 7374 6163 6b34 4420  f.stack.stack4D 
+0006a1e0: 3d20 7365 6c66 2e61 6c69 676e 6564 5f73  = self.aligned_s
+0006a1f0: 7461 636b 0d0a 2020 2020 2020 2020 2020  tack..          
+0006a200: 2020 7365 6c66 2e73 7461 636b 2e61 6273    self.stack.abs
+0006a210: 6461 7461 203d 2073 656c 662e 7374 6163  data = self.stac
+0006a220: 6b2e 7374 6163 6b34 445b 3a2c 3a2c 3a2c  k.stack4D[:,:,:,
+0006a230: 7365 6c66 2e69 7468 6574 615d 0d0a 2020  self.itheta]..  
+0006a240: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0006a250: 7461 636b 2e64 6174 615f 7374 7275 6374  tack.data_struct
+0006a260: 2e65 7863 6861 6e67 652e 6461 7461 203d  .exchange.data =
+0006a270: 2073 656c 662e 7374 6163 6b2e 7374 6163   self.stack.stac
+0006a280: 6b34 440d 0a0d 0a0d 0a20 2020 2020 2020  k4D......       
+0006a290: 2064 6174 6164 696d 203d 206e 702e 696e   datadim = np.in
+0006a2a0: 7433 3228 7365 6c66 2e73 7461 636b 2e61  t32(self.stack.a
+0006a2b0: 6273 6461 7461 2e73 6861 7065 290d 0a0d  bsdata.shape)...
+0006a2c0: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
+0006a2d0: 6163 6b2e 6e5f 636f 6c73 203d 2064 6174  ack.n_cols = dat
+0006a2e0: 6164 696d 5b30 5d2e 636f 7079 2829 0d0a  adim[0].copy()..
+0006a2f0: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
+0006a300: 636b 2e6e 5f72 6f77 7320 3d20 2064 6174  ck.n_rows =  dat
+0006a310: 6164 696d 5b31 5d2e 636f 7079 2829 0d0a  adim[1].copy()..
+0006a320: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+0006a330: 7461 636b 2e78 7368 6966 7473 203d 2073  tack.xshifts = s
+0006a340: 656c 662e 7873 6869 6674 730d 0a20 2020  elf.xshifts..   
+0006a350: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
+0006a360: 7973 6869 6674 7320 3d20 7365 6c66 2e79  yshifts = self.y
+0006a370: 7368 6966 7473 0d0a 0d0a 2020 2020 2020  shifts....      
+0006a380: 2020 6966 2073 656c 662e 636f 6d2e 6930    if self.com.i0
+0006a390: 5f6c 6f61 6465 6420 3d3d 2031 3a0d 0a20  _loaded == 1:.. 
+0006a3a0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0006a3b0: 6c66 2e63 6f6d 2e73 7461 636b 5f34 6420  lf.com.stack_4d 
+0006a3c0: 3d3d 2030 3a0d 0a20 2020 2020 2020 2020  == 0:..         
+0006a3d0: 2020 2020 2020 2023 5265 7369 7a65 206f         #Resize o
+0006a3e0: 7074 6963 616c 2064 656e 7369 7479 0d0a  ptical density..
+0006a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006a400: 666f 7220 6920 696e 2072 616e 6765 2873  for i in range(s
+0006a410: 656c 662e 7374 6163 6b2e 6e5f 6576 293a  elf.stack.n_ev):
+0006a420: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0006a430: 2020 2020 2020 2020 696d 6720 3d20 7365          img = se
+0006a440: 6c66 2e73 7461 636b 2e6f 6433 645b 3a2c  lf.stack.od3d[:,
+0006a450: 3a2c 695d 0d0a 2020 2020 2020 2020 2020  :,i]..          
+0006a460: 2020 2020 2020 2020 2020 7368 6966 7465            shifte
+0006a470: 645f 696d 6720 3d20 7365 6c66 2e73 7461  d_img = self.sta
+0006a480: 636b 2e61 7070 6c79 5f69 6d61 6765 5f72  ck.apply_image_r
+0006a490: 6567 6973 7472 6174 696f 6e28 696d 672c  egistration(img,
+0006a4a0: 2073 656c 662e 7873 6869 6674 735b 695d   self.xshifts[i]
+0006a4b0: 2c20 7365 6c66 2e79 7368 6966 7473 5b69  , self.yshifts[i
+0006a4c0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+0006a4d0: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
+0006a4e0: 636b 2e6f 6433 645b 3a2c 3a2c 695d 203d  ck.od3d[:,:,i] =
+0006a4f0: 2073 6869 6674 6564 5f69 6d67 0d0a 0d0a   shifted_img....
+0006a500: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006a510: 2020 7365 6c66 2e73 7461 636b 2e6f 6433    self.stack.od3
+0006a520: 6420 3d20 7365 6c66 2e73 7461 636b 2e6f  d = self.stack.o
+0006a530: 6433 645b 7365 6c66 2e78 6c65 6674 3a73  d3d[self.xleft:s
+0006a540: 656c 662e 7872 6967 6874 2c20 7365 6c66  elf.xright, self
+0006a550: 2e79 626f 7474 6f6d 3a73 656c 662e 7974  .ybottom:self.yt
+0006a560: 6f70 2c20 3a5d 0d0a 0d0a 2020 2020 2020  op, :]....      
+0006a570: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0006a580: 7461 636b 2e6f 6420 3d20 7365 6c66 2e73  tack.od = self.s
+0006a590: 7461 636b 2e6f 6433 642e 636f 7079 2829  tack.od3d.copy()
+0006a5a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006a5b0: 2020 7365 6c66 2e73 7461 636b 2e6f 6420    self.stack.od 
+0006a5c0: 3d20 6e70 2e72 6573 6861 7065 2873 656c  = np.reshape(sel
+0006a5d0: 662e 7374 6163 6b2e 6f64 2c20 2873 656c  f.stack.od, (sel
+0006a5e0: 662e 7374 6163 6b2e 6e5f 636f 6c73 2a73  f.stack.n_cols*s
+0006a5f0: 656c 662e 7374 6163 6b2e 6e5f 726f 7773  elf.stack.n_rows
+0006a600: 2c20 7365 6c66 2e73 7461 636b 2e6e 5f65  , self.stack.n_e
+0006a610: 7629 2c20 6f72 6465 723d 2746 2729 0d0a  v), order='F')..
+0006a620: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+0006a630: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0006a640: 2020 2020 2023 5265 7369 7a65 206f 7074       #Resize opt
+0006a650: 6963 616c 2064 656e 7369 7479 2066 6f72  ical density for
+0006a660: 2034 4420 7374 6163 6b0d 0a0d 0a20 2020   4D stack....   
+0006a670: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0006a680: 2069 2069 6e20 7261 6e67 6528 7365 6c66   i in range(self
+0006a690: 2e73 7461 636b 2e6e 5f65 7629 3a0d 0a20  .stack.n_ev):.. 
+0006a6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006a6b0: 2020 2066 6f72 206a 2069 6e20 7261 6e67     for j in rang
+0006a6c0: 6528 7365 6c66 2e73 7461 636b 2e6e 5f74  e(self.stack.n_t
+0006a6d0: 6865 7461 293a 0d0a 2020 2020 2020 2020  heta):..        
+0006a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006a6f0: 696d 6720 3d20 7365 6c66 2e73 7461 636b  img = self.stack
+0006a700: 2e6f 6434 445b 3a2c 3a2c 692c 6a5d 0d0a  .od4D[:,:,i,j]..
+0006a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006a720: 2020 2020 2020 2020 7368 6966 7465 645f          shifted_
+0006a730: 696d 6720 3d20 7365 6c66 2e73 7461 636b  img = self.stack
+0006a740: 2e61 7070 6c79 5f69 6d61 6765 5f72 6567  .apply_image_reg
+0006a750: 6973 7472 6174 696f 6e28 696d 672c 2073  istration(img, s
+0006a760: 656c 662e 7873 6869 6674 735b 692c 6a5d  elf.xshifts[i,j]
+0006a770: 2c20 7365 6c66 2e79 7368 6966 7473 5b69  , self.yshifts[i
+0006a780: 2c6a 5d29 0d0a 2020 2020 2020 2020 2020  ,j])..          
+0006a790: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0006a7a0: 6c66 2e73 7461 636b 2e6f 6434 445b 3a2c  lf.stack.od4D[:,
+0006a7b0: 3a2c 692c 6a5d 203d 2073 6869 6674 6564  :,i,j] = shifted
+0006a7c0: 5f69 6d67 0d0a 0d0a 2020 2020 2020 2020  _img....        
+0006a7d0: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
+0006a7e0: 636b 2e6f 6434 4420 3d20 7365 6c66 2e73  ck.od4D = self.s
+0006a7f0: 7461 636b 2e6f 6434 445b 7365 6c66 2e78  tack.od4D[self.x
+0006a800: 6c65 6674 3a73 656c 662e 7872 6967 6874  left:self.xright
+0006a810: 2c20 7365 6c66 2e79 626f 7474 6f6d 3a73  , self.ybottom:s
+0006a820: 656c 662e 7974 6f70 2c20 3a2c 203a 5d0d  elf.ytop, :, :].
+0006a830: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+0006a840: 2020 2073 656c 662e 7374 6163 6b2e 6f64     self.stack.od
+0006a850: 3364 203d 2073 656c 662e 7374 6163 6b2e  3d = self.stack.
+0006a860: 6f64 3444 5b3a 2c3a 2c3a 2c73 656c 662e  od4D[:,:,:,self.
+0006a870: 6974 6865 7461 5d0d 0a20 2020 2020 2020  itheta]..       
+0006a880: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
+0006a890: 6163 6b2e 6f64 203d 2073 656c 662e 7374  ack.od = self.st
+0006a8a0: 6163 6b2e 6f64 3364 2e63 6f70 7928 290d  ack.od3d.copy().
+0006a8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006a8c0: 206e 5f70 6978 656c 7320 3d20 7365 6c66   n_pixels = self
+0006a8d0: 2e73 7461 636b 2e6e 5f63 6f6c 732a 7365  .stack.n_cols*se
+0006a8e0: 6c66 2e73 7461 636b 2e6e 5f72 6f77 730d  lf.stack.n_rows.
+0006a8f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006a900: 2073 656c 662e 7374 6163 6b2e 6f64 203d   self.stack.od =
+0006a910: 206e 702e 7265 7368 6170 6528 7365 6c66   np.reshape(self
+0006a920: 2e73 7461 636b 2e6f 642c 2028 6e5f 7069  .stack.od, (n_pi
+0006a930: 7865 6c73 2c20 7365 6c66 2e73 7461 636b  xels, self.stack
+0006a940: 2e6e 5f65 7629 2c20 6f72 6465 723d 2746  .n_ev), order='F
+0006a950: 2729 0d0a 0d0a 2020 2020 2020 2020 2020  ')....          
+0006a960: 2020 7365 6c66 2e73 7461 636b 2e64 6174    self.stack.dat
+0006a970: 615f 7374 7275 6374 2e73 7065 6374 726f  a_struct.spectro
+0006a980: 6d69 6372 6f73 636f 7079 2e6f 7074 6963  microscopy.optic
+0006a990: 616c 5f64 656e 7369 7479 203d 2073 656c  al_density = sel
+0006a9a0: 662e 7374 6163 6b2e 6f64 0d0a 0d0a 0d0a  f.stack.od......
+0006a9b0: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
+0006a9c0: 636b 2e64 6174 615f 7374 7275 6374 2e65  ck.data_struct.e
+0006a9d0: 7863 6861 6e67 652e 656e 6572 6779 203d  xchange.energy =
+0006a9e0: 2073 656c 662e 7374 6163 6b2e 6576 0d0a   self.stack.ev..
+0006a9f0: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7365  ......        se
+0006aa00: 6c66 2e73 7461 636b 2e64 6174 615f 7374  lf.stack.data_st
+0006aa10: 7275 6374 2e73 7065 6374 726f 6d69 6372  ruct.spectromicr
+0006aa20: 6f73 636f 7079 2e78 7368 6966 7473 203d  oscopy.xshifts =
+0006aa30: 2073 656c 662e 7873 6869 6674 730d 0a20   self.xshifts.. 
+0006aa40: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
+0006aa50: 6b2e 6461 7461 5f73 7472 7563 742e 7370  k.data_struct.sp
+0006aa60: 6563 7472 6f6d 6963 726f 7363 6f70 792e  ectromicroscopy.
+0006aa70: 7973 6869 6674 7320 3d20 7365 6c66 2e79  yshifts = self.y
+0006aa80: 7368 6966 7473 0d0a 0d0a 0d0a 2020 2020  shifts......    
+0006aa90: 2020 2020 7365 6c66 2e70 6172 656e 742e      self.parent.
+0006aaa0: 7061 6765 312e 736c 6964 6572 5f65 6e67  page1.slider_eng
+0006aab0: 2e73 6574 5261 6e67 6528 302c 7365 6c66  .setRange(0,self
+0006aac0: 2e73 7461 636b 2e6e 5f65 762d 3129 0d0a  .stack.n_ev-1)..
+0006aad0: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
+0006aae0: 656e 742e 7061 6765 312e 6965 7620 3d20  ent.page1.iev = 
+0006aaf0: 696e 7428 7365 6c66 2e73 7461 636b 2e6e  int(self.stack.n
+0006ab00: 5f65 762f 3229 0d0a 2020 2020 2020 2020  _ev/2)..        
+0006ab10: 7365 6c66 2e70 6172 656e 742e 7061 6765  self.parent.page
+0006ab20: 312e 736c 6964 6572 5f65 6e67 2e73 6574  1.slider_eng.set
+0006ab30: 5661 6c75 6528 7365 6c66 2e70 6172 656e  Value(self.paren
+0006ab40: 742e 7061 6765 312e 6965 7629 0d0a 0d0a  t.page1.iev)....
+0006ab50: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
+0006ab60: 656e 742e 7061 6765 312e 6978 203d 2069  ent.page1.ix = i
+0006ab70: 6e74 2873 656c 662e 7374 6163 6b2e 6e5f  nt(self.stack.n_
+0006ab80: 636f 6c73 2f32 290d 0a20 2020 2020 2020  cols/2)..       
+0006ab90: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
+0006aba0: 6531 2e69 7920 3d20 696e 7428 7365 6c66  e1.iy = int(self
+0006abb0: 2e73 7461 636b 2e6e 5f72 6f77 732f 3229  .stack.n_rows/2)
+0006abc0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+0006abd0: 2e70 6172 656e 742e 7061 6765 312e 7368  .parent.page1.sh
+0006abe0: 6f77 5370 6563 7472 756d 2873 656c 662e  owSpectrum(self.
+0006abf0: 7061 7265 6e74 2e70 6167 6531 2e69 782c  parent.page1.ix,
+0006ac00: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
+0006ac10: 6531 2e69 7929 0d0a 2020 2020 2020 2020  e1.iy)..        
+0006ac20: 7365 6c66 2e70 6172 656e 742e 7061 6765  self.parent.page
+0006ac30: 312e 6c6f 6164 496d 6167 6528 290d 0a20  1.loadImage().. 
+0006ac40: 2020 2020 2020 2023 7365 6c66 2e70 6172         #self.par
+0006ac50: 656e 742e 7061 6765 392e 6c6f 6164 496d  ent.page9.loadIm
+0006ac60: 6167 6528 290d 0a0d 0a20 2020 2020 2020  age()....       
+0006ac70: 2073 656c 662e 636c 6f73 6528 290d 0a0d   self.close()...
+0006ac80: 0a0d 0a0d 0a0d 0a0d 0a23 2d2d 2d2d 2d2d  .........#------
+0006ac90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006aca0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006acb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006acc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006acd0: 0d0a 2020 2020 6465 6620 506c 6f74 5368  ..    def PlotSh
+0006ace0: 6966 7473 2873 656c 662c 2029 3a0d 0a0d  ifts(self, ):...
+0006acf0: 0a20 2020 2020 2020 2066 6967 203d 2073  .        fig = s
+0006ad00: 656c 662e 7368 6966 7473 6669 670d 0a20  elf.shiftsfig.. 
+0006ad10: 2020 2020 2020 2066 6967 2e63 6c66 2829         fig.clf()
+0006ad20: 0d0a 0d0a 2020 2020 2020 2020 6669 672e  ....        fig.
+0006ad30: 6164 645f 6178 6573 2828 302e 3135 2c30  add_axes((0.15,0
+0006ad40: 2e31 352c 302e 3735 2c30 2e37 3529 290d  .15,0.75,0.75)).
+0006ad50: 0a20 2020 2020 2020 2061 7865 7320 3d20  .        axes = 
+0006ad60: 6669 672e 6763 6128 290d 0a0d 0a0d 0a0d  fig.gca().......
+0006ad70: 0a20 2020 2020 2020 2023 4d61 7470 6c6f  .        #Matplo
+0006ad80: 746c 6962 2068 6173 2069 6e76 6572 7465  tlib has inverte
+0006ad90: 6420 6178 6573 210d 0a20 2020 2020 2020  d axes!..       
+0006ada0: 2061 7865 732e 7365 745f 786c 6162 656c   axes.set_xlabel
+0006adb0: 2827 5068 6f74 6f6e 2045 6e65 7267 7920  ('Photon Energy 
+0006adc0: 5b65 565d 2729 0d0a 2020 2020 2020 2020  [eV]')..        
+0006add0: 6178 6573 2e73 6574 5f79 6c61 6265 6c28  axes.set_ylabel(
+0006ade0: 2753 6869 6674 7320 2878 2d72 6564 2c20  'Shifts (x-red, 
+0006adf0: 792d 6772 6565 6e29 205b 7069 7865 6c73  y-green) [pixels
+0006ae00: 5d27 290d 0a0d 0a20 2020 2020 2020 2069  ]')....        i
+0006ae10: 6620 7365 6c66 2e63 6f6d 2e73 7461 636b  f self.com.stack
+0006ae20: 5f34 6420 3d3d 2030 3a0d 0a20 2020 2020  _4d == 0:..     
+0006ae30: 2020 2020 2020 2070 6c6f 7420 3d20 6178         plot = ax
+0006ae40: 6573 2e70 6c6f 7428 7365 6c66 2e73 7461  es.plot(self.sta
+0006ae50: 636b 2e65 762c 7365 6c66 2e78 7368 6966  ck.ev,self.xshif
+0006ae60: 7473 2c20 636f 6c6f 723d 2767 7265 656e  ts, color='green
+0006ae70: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
+0006ae80: 706c 6f74 203d 2061 7865 732e 706c 6f74  plot = axes.plot
+0006ae90: 2873 656c 662e 7374 6163 6b2e 6576 2c73  (self.stack.ev,s
+0006aea0: 656c 662e 7973 6869 6674 732c 2063 6f6c  elf.yshifts, col
+0006aeb0: 6f72 3d27 7265 6427 290d 0a20 2020 2020  or='red')..     
+0006aec0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0006aed0: 2020 2020 2020 706c 6f74 203d 2061 7865        plot = axe
+0006aee0: 732e 706c 6f74 2873 656c 662e 7374 6163  s.plot(self.stac
+0006aef0: 6b2e 6576 2c73 656c 662e 7873 6869 6674  k.ev,self.xshift
+0006af00: 735b 3a2c 7365 6c66 2e69 7468 6574 615d  s[:,self.itheta]
+0006af10: 2c20 636f 6c6f 723d 2767 7265 656e 2729  , color='green')
+0006af20: 0d0a 2020 2020 2020 2020 2020 2020 706c  ..            pl
+0006af30: 6f74 203d 2061 7865 732e 706c 6f74 2873  ot = axes.plot(s
+0006af40: 656c 662e 7374 6163 6b2e 6576 2c73 656c  elf.stack.ev,sel
+0006af50: 662e 7973 6869 6674 735b 3a2c 7365 6c66  f.yshifts[:,self
+0006af60: 2e69 7468 6574 615d 2c20 636f 6c6f 723d  .itheta], color=
+0006af70: 2772 6564 2729 0d0a 0d0a 2020 2020 2020  'red')....      
+0006af80: 2020 7365 6c66 2e53 6869 6674 7350 616e    self.ShiftsPan
+0006af90: 656c 2e64 7261 7728 290d 0a0d 0a23 2d2d  el.draw()....#--
+0006afa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006afb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006afc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006afd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006afe0: 2d2d 2d2d 0d0a 2020 2020 6465 6620 4f6e  ----..    def On
+0006aff0: 506c 6f74 5368 6966 7473 2873 656c 662c  PlotShifts(self,
+0006b000: 2065 7674 293a 0d0a 2020 2020 2020 2020   evt):..        
+0006b010: 7820 3d20 6576 742e 7864 6174 610d 0a20  x = evt.xdata.. 
+0006b020: 2020 2020 2020 2079 203d 2065 7674 2e79         y = evt.y
+0006b030: 6461 7461 0d0a 0d0a 2020 2020 2020 2020  data....        
+0006b040: 6966 2073 656c 662e 7873 6869 6674 732e  if self.xshifts.
+0006b050: 616e 7928 293a 0d0a 2020 2020 2020 2020  any():..        
+0006b060: 2020 2020 6966 2078 203c 2073 656c 662e      if x < self.
+0006b070: 7374 6163 6b2e 6576 5b30 5d3a 0d0a 2020  stack.ev[0]:..  
+0006b080: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0006b090: 6c5f 6576 203d 2030 0d0a 2020 2020 2020  l_ev = 0..      
+0006b0a0: 2020 2020 2020 656c 6966 2078 203e 2073        elif x > s
+0006b0b0: 656c 662e 7374 6163 6b2e 6576 5b73 656c  elf.stack.ev[sel
+0006b0c0: 662e 7374 6163 6b2e 6e5f 6576 2d31 5d3a  f.stack.n_ev-1]:
+0006b0d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006b0e0: 2020 7365 6c5f 6576 203d 2073 656c 662e    sel_ev = self.
+0006b0f0: 7374 6163 6b2e 6e5f 6576 2d31 0d0a 2020  stack.n_ev-1..  
+0006b100: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+0006b110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006b120: 2069 6e64 7820 3d20 6e70 2e61 6273 2873   indx = np.abs(s
+0006b130: 656c 662e 7374 6163 6b2e 6576 202d 2078  elf.stack.ev - x
+0006b140: 292e 6172 676d 696e 2829 0d0a 2020 2020  ).argmin()..    
+0006b150: 2020 2020 2020 2020 2020 2020 7365 6c5f              sel_
+0006b160: 6576 203d 2069 6e64 780d 0a0d 0a20 2020  ev = indx....   
+0006b170: 2020 2020 2020 2020 2073 656c 662e 6965           self.ie
+0006b180: 7620 3d20 7365 6c5f 6576 0d0a 0d0a 2020  v = sel_ev....  
+0006b190: 2020 2020 2020 2020 2020 7365 6c66 2e53            self.S
+0006b1a0: 686f 7749 6d61 6765 2829 0d0a 0d0a 2020  howImage()....  
+0006b1b0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0006b1c0: 6c69 6465 725f 656e 672e 7365 7456 616c  lider_eng.setVal
+0006b1d0: 7565 2873 656c 662e 6965 7629 0d0a 0d0a  ue(self.iev)....
+0006b1e0: 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  #---------------
+0006b1f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006b200: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006b210: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006b220: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6566  -------..    def
+0006b230: 204f 6e53 6176 6553 6869 6674 7350 6c6f   OnSaveShiftsPlo
+0006b240: 7428 7365 6c66 2c20 6576 7429 3a0d 0a0d  t(self, evt):...
+0006b250: 0a0d 0a20 2020 2020 2020 2077 696c 6463  ...        wildc
+0006b260: 6172 6420 3d20 2250 6f72 7461 626c 6520  ard = "Portable 
+0006b270: 4e65 7477 6f72 6b20 4772 6170 6869 6373  Network Graphics
+0006b280: 2028 2a2e 706e 6729 3b3b 4164 6f62 6520   (*.png);;Adobe 
+0006b290: 5044 4620 4669 6c65 7320 282a 2e70 6466  PDF Files (*.pdf
+0006b2a0: 293b 3b22 0d0a 0d0a 2020 2020 2020 2020  );;"....        
+0006b2b0: 7365 6c66 2e53 6176 6546 696c 654e 616d  self.SaveFileNam
+0006b2c0: 652c 205f 6669 6c74 6572 203d 2051 7457  e, _filter = QtW
+0006b2d0: 6964 6765 7473 2e51 4669 6c65 4469 616c  idgets.QFileDial
+0006b2e0: 6f67 2e67 6574 5361 7665 4669 6c65 4e61  og.getSaveFileNa
+0006b2f0: 6d65 2873 656c 662c 2027 5361 7665 2049  me(self, 'Save I
+0006b300: 6d61 6765 2053 6869 6674 7320 506c 6f74  mage Shifts Plot
+0006b310: 272c 2027 272c 2077 696c 6463 6172 6429  ', '', wildcard)
+0006b320: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+0006b330: 2e53 6176 6546 696c 654e 616d 6520 3d20  .SaveFileName = 
+0006b340: 7374 7228 7365 6c66 2e53 6176 6546 696c  str(self.SaveFil
+0006b350: 654e 616d 6529 0d0a 2020 2020 2020 2020  eName)..        
+0006b360: 6966 2073 656c 662e 5361 7665 4669 6c65  if self.SaveFile
+0006b370: 4e61 6d65 203d 3d20 2727 3a0d 0a20 2020  Name == '':..   
+0006b380: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
+0006b390: 0a0d 0a0d 0a20 2020 2020 2020 2070 6174  .....        pat
+0006b3a0: 682c 2065 7874 203d 206f 732e 7061 7468  h, ext = os.path
+0006b3b0: 2e73 706c 6974 6578 7428 7365 6c66 2e53  .splitext(self.S
+0006b3c0: 6176 6546 696c 654e 616d 6529 0d0a 2020  aveFileName)..  
+0006b3d0: 2020 2020 2020 6578 7420 3d20 6578 745b        ext = ext[
+0006b3e0: 313a 5d2e 6c6f 7765 7228 290d 0a0d 0a20  1:].lower().... 
+0006b3f0: 2020 2020 2020 2074 7279 3a0d 0a0d 0a20         try:.... 
+0006b400: 2020 2020 2020 2020 2020 206d 6174 706c             matpl
+0006b410: 6f74 6c69 622e 7263 5061 7261 6d73 5b27  otlib.rcParams['
+0006b420: 7064 662e 666f 6e74 7479 7065 275d 203d  pdf.fonttype'] =
+0006b430: 2034 320d 0a20 2020 2020 2020 2020 2020   42..           
+0006b440: 2069 6620 6578 7420 3d3d 2027 706e 6727   if ext == 'png'
+0006b450: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
+0006b460: 2020 2020 2066 6967 203d 2073 656c 662e       fig = self.
+0006b470: 7368 6966 7473 6669 670d 0a20 2020 2020  shiftsfig..     
+0006b480: 2020 2020 2020 2020 2020 2066 6967 2e73             fig.s
+0006b490: 6176 6566 6967 2873 656c 662e 5361 7665  avefig(self.Save
+0006b4a0: 4669 6c65 4e61 6d65 290d 0a0d 0a20 2020  FileName)....   
+0006b4b0: 2020 2020 2020 2020 2069 6620 6578 7420           if ext 
+0006b4c0: 3d3d 2770 6466 273a 0d0a 0d0a 0d0a 2020  =='pdf':......  
+0006b4d0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0006b4e0: 6720 3d20 7365 6c66 2e73 6869 6674 7366  g = self.shiftsf
+0006b4f0: 6967 0d0a 2020 2020 2020 2020 2020 2020  ig..            
+0006b500: 2020 2020 6669 672e 7361 7665 6669 6728      fig.savefig(
+0006b510: 7365 6c66 2e53 6176 6546 696c 654e 616d  self.SaveFileNam
+0006b520: 6529 0d0a 0d0a 2020 2020 2020 2020 6578  e)....        ex
+0006b530: 6365 7074 3a0d 0a20 2020 2020 2020 2020  cept:..         
+0006b540: 2020 2070 6173 730d 0a0d 0a23 2d2d 2d2d     pass....#----
+0006b550: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006b560: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006b570: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006b580: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006b590: 2d2d 0d0a 2020 2020 6465 6620 4f6e 5365  --..    def OnSe
+0006b5a0: 6c65 6374 5375 6272 6567 696f 6e28 7365  lectSubregion(se
+0006b5b0: 6c66 2c20 6576 656e 7429 3a0d 0a0d 0a20  lf, event):.... 
+0006b5c0: 2020 2020 2020 2073 656c 662e 7375 6272         self.subr
+0006b5d0: 6567 696f 6e20 3d20 310d 0a20 2020 2020  egion = 1..     
+0006b5e0: 2020 2073 656c 662e 7372 5f78 3120 3d20     self.sr_x1 = 
+0006b5f0: 300d 0a20 2020 2020 2020 2073 656c 662e  0..        self.
+0006b600: 7372 5f78 3220 3d20 300d 0a20 2020 2020  sr_x2 = 0..     
+0006b610: 2020 2073 656c 662e 7372 5f79 3120 3d20     self.sr_y1 = 
+0006b620: 300d 0a20 2020 2020 2020 2073 656c 662e  0..        self.
+0006b630: 7372 5f79 3220 3d20 300d 0a0d 0a20 2020  sr_y2 = 0....   
+0006b640: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
+0006b650: 5f64 656c 7375 6272 6567 696f 6e2e 7365  _delsubregion.se
+0006b660: 7445 6e61 626c 6564 2854 7275 6529 0d0a  tEnabled(True)..
+0006b670: 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d  ....#-----------
+0006b680: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006b690: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006b6a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006b6b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020  -----------..   
+0006b6c0: 2064 6566 204f 6e44 656c 6574 6553 7562   def OnDeleteSub
+0006b6d0: 7265 6769 6f6e 2873 656c 662c 2065 7665  region(self, eve
+0006b6e0: 6e74 293a 0d0a 0d0a 2020 2020 2020 2020  nt):....        
+0006b6f0: 7365 6c66 2e73 7562 7265 6769 6f6e 203d  self.subregion =
+0006b700: 2030 0d0a 2020 2020 2020 2020 7365 6c66   0..        self
+0006b710: 2e73 725f 7831 203d 2030 0d0a 2020 2020  .sr_x1 = 0..    
+0006b720: 2020 2020 7365 6c66 2e73 725f 7832 203d      self.sr_x2 =
+0006b730: 2030 0d0a 2020 2020 2020 2020 7365 6c66   0..        self
+0006b740: 2e73 725f 7931 203d 2030 0d0a 2020 2020  .sr_y1 = 0..    
+0006b750: 2020 2020 7365 6c66 2e73 725f 7932 203d      self.sr_y2 =
+0006b760: 2030 0d0a 0d0a 2020 2020 2020 2020 7365   0....        se
+0006b770: 6c66 2e62 7574 746f 6e5f 7072 6573 7365  lf.button_presse
+0006b780: 6420 3d20 4661 6c73 650d 0a20 2020 2020  d = False..     
+0006b790: 2020 2073 656c 662e 7061 7463 6820 3d20     self.patch = 
+0006b7a0: 4e6f 6e65 0d0a 2020 2020 2020 2020 7365  None..        se
+0006b7b0: 6c66 2e52 6566 496d 6167 6550 616e 656c  lf.RefImagePanel
+0006b7c0: 2e6d 706c 5f64 6973 636f 6e6e 6563 7428  .mpl_disconnect(
+0006b7d0: 7365 6c66 2e6d 6f75 7365 6d6f 7665 636f  self.mousemoveco
+0006b7e0: 6e6e 290d 0a0d 0a20 2020 2020 2020 2073  nn)....        s
+0006b7f0: 656c 662e 5368 6f77 5265 6649 6d61 6765  elf.ShowRefImage
+0006b800: 2829 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d  ()......#-------
+0006b810: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006b820: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006b830: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006b840: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
+0006b850: 0a20 2020 2064 6566 204f 6e53 656c 6563  .    def OnSelec
+0006b860: 7469 6f6e 2873 656c 662c 2065 7674 293a  tion(self, evt):
+0006b870: 0d0a 0d0a 2020 2020 2020 2020 6966 2028  ....        if (
+0006b880: 7365 6c66 2e6d 616e 5f61 6c69 676e 203e  self.man_align >
+0006b890: 2030 2920 616e 6420 2873 656c 662e 7375   0) and (self.su
+0006b8a0: 6272 6567 696f 6e20 3d3d 2030 293a 0d0a  bregion == 0):..
+0006b8b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0006b8c0: 726e 0d0a 0d0a 2020 2020 2020 2020 7832  rn....        x2
+0006b8d0: 2c20 7932 203d 2065 7674 2e78 6461 7461  , y2 = evt.xdata
+0006b8e0: 2c20 6576 742e 7964 6174 610d 0a0d 0a20  , evt.ydata.... 
+0006b8f0: 2020 2020 2020 2069 6620 2878 3220 3d3d         if (x2 ==
+0006b900: 204e 6f6e 6529 206f 7220 2879 3220 3d3d   None) or (y2 ==
+0006b910: 204e 6f6e 6529 3a0d 0a20 2020 2020 2020   None):..       
+0006b920: 2020 2020 2072 6574 7572 6e0d 0a0d 0a20       return.... 
+0006b930: 2020 2020 2020 2073 656c 662e 7372 5f78         self.sr_x
+0006b940: 3120 3d20 696e 7428 7365 6c66 2e73 725f  1 = int(self.sr_
+0006b950: 7831 290d 0a20 2020 2020 2020 2073 656c  x1)..        sel
+0006b960: 662e 7372 5f78 3220 3d20 696e 7428 7832  f.sr_x2 = int(x2
+0006b970: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+0006b980: 662e 7372 5f79 3220 3d20 696e 7428 7365  f.sr_y2 = int(se
+0006b990: 6c66 2e73 725f 7931 290d 0a20 2020 2020  lf.sr_y1)..     
+0006b9a0: 2020 2073 656c 662e 7372 5f79 3120 3d20     self.sr_y1 = 
+0006b9b0: 696e 7428 7932 290d 0a0d 0a20 2020 2020  int(y2)....     
+0006b9c0: 2020 2069 6620 7365 6c66 2e73 725f 7831     if self.sr_x1
+0006b9d0: 203e 2073 656c 662e 7372 5f78 323a 0d0a   > self.sr_x2:..
+0006b9e0: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
+0006b9f0: 203d 2073 656c 662e 7372 5f78 310d 0a20   = self.sr_x1.. 
+0006ba00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0006ba10: 7372 5f78 3120 3d20 7365 6c66 2e73 725f  sr_x1 = self.sr_
+0006ba20: 7832 0d0a 2020 2020 2020 2020 2020 2020  x2..            
+0006ba30: 7365 6c66 2e73 725f 7832 203d 2074 656d  self.sr_x2 = tem
+0006ba40: 700d 0a0d 0a20 2020 2020 2020 2069 6620  p....        if 
+0006ba50: 7365 6c66 2e73 725f 7932 203e 2073 656c  self.sr_y2 > sel
+0006ba60: 662e 7372 5f79 313a 0d0a 2020 2020 2020  f.sr_y1:..      
+0006ba70: 2020 2020 2020 7465 6d70 203d 2073 656c        temp = sel
+0006ba80: 662e 7372 5f79 310d 0a20 2020 2020 2020  f.sr_y1..       
+0006ba90: 2020 2020 2073 656c 662e 7372 5f79 3120       self.sr_y1 
+0006baa0: 3d20 7365 6c66 2e73 725f 7932 0d0a 2020  = self.sr_y2..  
+0006bab0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0006bac0: 725f 7932 203d 2074 656d 700d 0a0d 0a0d  r_y2 = temp.....
+0006bad0: 0a20 2020 2020 2020 2073 656c 662e 6275  .        self.bu
+0006bae0: 7474 6f6e 5f70 7265 7373 6564 203d 2046  tton_pressed = F
+0006baf0: 616c 7365 0d0a 0d0a 2020 2020 2020 2020  alse....        
+0006bb00: 7365 6c66 2e52 6566 496d 6167 6550 616e  self.RefImagePan
+0006bb10: 656c 2e6d 706c 5f64 6973 636f 6e6e 6563  el.mpl_disconnec
+0006bb20: 7428 7365 6c66 2e4f 6e53 656c 6563 7469  t(self.OnSelecti
+0006bb30: 6f6e 4d6f 7469 6f6e 290d 0a0d 0a20 2020  onMotion)....   
+0006bb40: 2020 2020 2073 656c 662e 5368 6f77 5265       self.ShowRe
+0006bb50: 6649 6d61 6765 2829 0d0a 0d0a 232d 2d2d  fImage()....#---
+0006bb60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006bb70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006bb80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006bb90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006bba0: 2d2d 2d0d 0a20 2020 2064 6566 204f 6e53  ---..    def OnS
+0006bbb0: 656c 6563 7469 6f6e 4d6f 7469 6f6e 2873  electionMotion(s
+0006bbc0: 656c 662c 2065 7665 6e74 293a 0d0a 0d0a  elf, event):....
+0006bbd0: 2020 2020 2020 2020 7832 2c20 7932 203d          x2, y2 =
+0006bbe0: 2065 7665 6e74 2e78 6461 7461 2c20 6576   event.xdata, ev
+0006bbf0: 656e 742e 7964 6174 610d 0a0d 0a20 2020  ent.ydata....   
+0006bc00: 2020 2020 2069 6620 2878 3220 3d3d 204e       if (x2 == N
+0006bc10: 6f6e 6529 206f 7220 2879 3220 3d3d 204e  one) or (y2 == N
+0006bc20: 6f6e 6529 3a0d 0a20 2020 2020 2020 2020  one):..         
+0006bc30: 2020 2072 6574 7572 6e0d 0a0d 0a20 2020     return....   
+0006bc40: 2020 2020 2069 6620 7365 6c66 2e62 7574       if self.but
+0006bc50: 746f 6e5f 7072 6573 7365 6420 3d3d 2046  ton_pressed == F
+0006bc60: 616c 7365 3a0d 0a20 2020 2020 2020 2020  alse:..         
+0006bc70: 2020 2072 6574 7572 6e0d 0a0d 0a20 2020     return....   
+0006bc80: 2020 2020 2073 656c 662e 7372 5f78 3220       self.sr_x2 
+0006bc90: 3d20 696e 7428 7832 290d 0a20 2020 2020  = int(x2)..     
+0006bca0: 2020 2073 656c 662e 7372 5f79 3220 3d20     self.sr_y2 = 
+0006bcb0: 696e 7428 7932 290d 0a0d 0a20 2020 2020  int(y2)....     
+0006bcc0: 2020 2066 6967 203d 2073 656c 662e 7265     fig = self.re
+0006bcd0: 6669 6d67 6669 670d 0a0d 0a20 2020 2020  fimgfig....     
+0006bce0: 2020 2061 7865 7320 3d20 6669 672e 6763     axes = fig.gc
+0006bcf0: 6128 290d 0a0d 0a0d 0a0d 0a20 2020 2020  a()........     
+0006bd00: 2020 2066 726f 6d20 6d61 7470 6c6f 746c     from matplotl
+0006bd10: 6962 2e70 6174 6820 696d 706f 7274 2050  ib.path import P
+0006bd20: 6174 680d 0a20 2020 2020 2020 2069 6d70  ath..        imp
+0006bd30: 6f72 7420 6d61 7470 6c6f 746c 6962 2e70  ort matplotlib.p
+0006bd40: 6174 6368 6573 2061 7320 7061 7463 6865  atches as patche
+0006bd50: 730d 0a0d 0a20 2020 2020 2020 2076 6572  s....        ver
+0006bd60: 7473 203d 205b 0d0a 2020 2020 2020 2020  ts = [..        
+0006bd70: 2020 2020 2020 2020 2028 7365 6c66 2e73           (self.s
+0006bd80: 725f 7831 2c20 7365 6c66 2e73 725f 7931  r_x1, self.sr_y1
+0006bd90: 292c 2023 206c 6566 742c 2062 6f74 746f  ), # left, botto
+0006bda0: 6d0d 0a20 2020 2020 2020 2020 2020 2020  m..             
+0006bdb0: 2020 2020 2873 656c 662e 7372 5f78 312c      (self.sr_x1,
+0006bdc0: 2073 656c 662e 7372 5f79 3229 2c20 2320   self.sr_y2), # 
+0006bdd0: 6c65 6674 2c20 746f 700d 0a20 2020 2020  left, top..     
+0006bde0: 2020 2020 2020 2020 2020 2020 2873 656c              (sel
+0006bdf0: 662e 7372 5f78 322c 2073 656c 662e 7372  f.sr_x2, self.sr
+0006be00: 5f79 3229 2c20 2320 7269 6768 742c 2074  _y2), # right, t
+0006be10: 6f70 0d0a 2020 2020 2020 2020 2020 2020  op..            
+0006be20: 2020 2020 2028 7365 6c66 2e73 725f 7832       (self.sr_x2
+0006be30: 2c20 7365 6c66 2e73 725f 7931 292c 2023  , self.sr_y1), #
+0006be40: 2072 6967 6874 2c20 626f 7474 6f6d 0d0a   right, bottom..
+0006be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006be60: 2028 7365 6c66 2e73 725f 7831 2c20 7365   (self.sr_x1, se
+0006be70: 6c66 2e73 725f 7931 292c 2023 2069 676e  lf.sr_y1), # ign
+0006be80: 6f72 6564 0d0a 2020 2020 2020 2020 2020  ored..          
+0006be90: 2020 2020 2020 205d 0d0a 0d0a 2020 2020         ]....    
+0006bea0: 2020 2020 636f 6465 7320 3d20 5b50 6174      codes = [Pat
+0006beb0: 682e 4d4f 5645 544f 2c0d 0a20 2020 2020  h.MOVETO,..     
+0006bec0: 2020 2020 2020 2020 2020 2020 5061 7468              Path
+0006bed0: 2e4c 494e 4554 4f2c 0d0a 2020 2020 2020  .LINETO,..      
+0006bee0: 2020 2020 2020 2020 2020 2050 6174 682e             Path.
+0006bef0: 4c49 4e45 544f 2c0d 0a20 2020 2020 2020  LINETO,..       
+0006bf00: 2020 2020 2020 2020 2020 5061 7468 2e4c            Path.L
+0006bf10: 494e 4554 4f2c 0d0a 2020 2020 2020 2020  INETO,..        
+0006bf20: 2020 2020 2020 2020 2050 6174 682e 434c           Path.CL
+0006bf30: 4f53 4550 4f4c 592c 0d0a 2020 2020 2020  OSEPOLY,..      
+0006bf40: 2020 2020 2020 2020 2020 205d 0d0a 0d0a             ]....
+0006bf50: 2020 2020 2020 2020 7061 7468 203d 2050          path = P
+0006bf60: 6174 6828 7665 7274 732c 2063 6f64 6573  ath(verts, codes
+0006bf70: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
+0006bf80: 7365 6c66 2e70 6174 6368 2021 3d20 4e6f  self.patch != No
+0006bf90: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0006bfa0: 2073 656c 662e 7061 7463 682e 7265 6d6f   self.patch.remo
+0006bfb0: 7665 2829 0d0a 0d0a 2020 2020 2020 2020  ve()....        
+0006bfc0: 7365 6c66 2e70 6174 6368 203d 2070 6174  self.patch = pat
+0006bfd0: 6368 6573 2e50 6174 6850 6174 6368 2870  ches.PathPatch(p
+0006bfe0: 6174 682c 2066 6163 6563 6f6c 6f72 3d27  ath, facecolor='
+0006bff0: 7265 6427 290d 0a20 2020 2020 2020 2073  red')..        s
+0006c000: 656c 662e 7061 7463 682e 7365 745f 616c  elf.patch.set_al
+0006c010: 7068 6128 302e 3329 0d0a 2020 2020 2020  pha(0.3)..      
+0006c020: 2020 6178 6573 2e61 6464 5f70 6174 6368    axes.add_patch
+0006c030: 2873 656c 662e 7061 7463 6829 0d0a 0d0a  (self.patch)....
+0006c040: 2020 2020 2020 2020 6178 6573 2e61 7869          axes.axi
+0006c050: 7328 226f 6666 2229 0d0a 0d0a 2020 2020  s("off")....    
+0006c060: 2020 2020 7365 6c66 2e52 6566 496d 6167      self.RefImag
+0006c070: 6550 616e 656c 2e64 7261 7728 290d 0a0d  ePanel.draw()...
+0006c080: 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  .#--------------
+0006c090: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006c0a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006c0b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006c0c0: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 6465  --------..    de
+0006c0d0: 6620 4f6e 5361 7665 5368 6966 7473 2873  f OnSaveShifts(s
+0006c0e0: 656c 662c 2065 7674 293a 0d0a 0d0a 0d0a  elf, evt):......
+0006c0f0: 2020 2020 2020 2020 7769 6c64 6361 7264          wildcard
+0006c100: 203d 2022 4353 5620 6669 6c65 7320 282a   = "CSV files (*
+0006c110: 2e63 7376 2922 0d0a 0d0a 2020 2020 2020  .csv)"....      
+0006c120: 2020 6669 6c65 7061 7468 2c20 5f66 696c    filepath, _fil
+0006c130: 7465 7220 3d20 5174 5769 6467 6574 732e  ter = QtWidgets.
+0006c140: 5146 696c 6544 6961 6c6f 672e 6765 7453  QFileDialog.getS
+0006c150: 6176 6546 696c 654e 616d 6528 7365 6c66  aveFileName(self
+0006c160: 2c20 2750 6c65 6173 6520 7365 6c65 6374  , 'Please select
+0006c170: 2061 6e20 616c 6967 6e6d 656e 7420 6669   an alignment fi
+0006c180: 6c65 2028 2e63 7376 2927 2c20 2727 2c20  le (.csv)', '', 
+0006c190: 7769 6c64 6361 7264 290d 0a0d 0a20 2020  wildcard)....   
+0006c1a0: 2020 2020 2066 696c 6570 6174 6820 3d20       filepath = 
+0006c1b0: 7374 7228 6669 6c65 7061 7468 290d 0a20  str(filepath).. 
+0006c1c0: 2020 2020 2020 2069 6620 6669 6c65 7061         if filepa
+0006c1d0: 7468 203d 3d20 2727 3a0d 0a20 2020 2020  th == '':..     
+0006c1e0: 2020 2020 2020 2072 6574 7572 6e0d 0a0d         return...
+0006c1f0: 0a0d 0a0d 0a0d 0a20 2020 2020 2020 2066  .......        f
+0006c200: 203d 206f 7065 6e28 6669 6c65 7061 7468   = open(filepath
+0006c210: 2c20 2777 2729 0d0a 0d0a 2020 2020 2020  , 'w')....      
+0006c220: 2020 6966 2073 656c 662e 636f 6d2e 7374    if self.com.st
+0006c230: 6163 6b5f 3464 203d 3d20 303a 0d0a 2020  ack_4d == 0:..  
+0006c240: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0006c250: 272a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  '***************
+0006c260: 2a2a 2a2a 2a2a 2020 416c 6967 6e6d 656e  ******  Alignmen
+0006c270: 7420 6669 6c65 2020 2a2a 2a2a 2a2a 2a2a  t file  ********
+0006c280: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 272c 2066  ************', f
+0006c290: 696c 653d 6629 0d0a 2020 2020 2020 2020  ile=f)..        
+0006c2a0: 2020 2020 7072 696e 7428 272a 2a2a 2020      print('***  
+0006c2b0: 666f 7220 272c 2073 656c 662e 636f 6d2e  for ', self.com.
+0006c2c0: 6669 6c65 6e61 6d65 2c20 6669 6c65 3d66  filename, file=f
+0006c2d0: 290d 0a20 2020 2020 2020 2020 2020 2070  )..            p
+0006c2e0: 7269 6e74 2827 2a2a 2a20 2065 762c 2078  rint('***  ev, x
+0006c2f0: 7368 6966 742c 2079 7368 6966 7427 2c20  shift, yshift', 
+0006c300: 6669 6c65 3d66 290d 0a20 2020 2020 2020  file=f)..       
+0006c310: 2020 2020 2066 6f72 2069 6520 696e 2072       for ie in r
+0006c320: 616e 6765 2873 656c 662e 7374 6163 6b2e  ange(self.stack.
+0006c330: 6e5f 6576 293a 0d0a 2020 2020 2020 2020  n_ev):..        
+0006c340: 2020 2020 2020 2020 7072 696e 7428 2725          print('%
+0006c350: 2e36 662c 2025 2e36 662c 2025 2e36 6627  .6f, %.6f, %.6f'
+0006c360: 2025 2873 656c 662e 7374 6163 6b2e 6576   %(self.stack.ev
+0006c370: 5b69 655d 2c20 7365 6c66 2e78 7368 6966  [ie], self.xshif
+0006c380: 7473 5b69 655d 2c20 7365 6c66 2e79 7368  ts[ie], self.ysh
+0006c390: 6966 7473 5b69 655d 292c 2066 696c 653d  ifts[ie]), file=
+0006c3a0: 6629 0d0a 2020 2020 2020 2020 656c 7365  f)..        else
+0006c3b0: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
+0006c3c0: 7269 6e74 2827 2a2a 2a2a 2a2a 2a2a 2a2a  rint('**********
+0006c3d0: 2a2a 2a2a 2a2a 2a2a 2a2a 2a20 2041 6c69  ***********  Ali
+0006c3e0: 676e 6d65 6e74 2066 696c 6520 202a 2a2a  gnment file  ***
+0006c3f0: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
+0006c400: 2a27 2c20 6669 6c65 3d66 290d 0a20 2020  *', file=f)..   
+0006c410: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0006c420: 2a2a 2a20 2066 6f72 2027 2c20 7365 6c66  ***  for ', self
+0006c430: 2e63 6f6d 2e66 696c 656e 616d 652c 2066  .com.filename, f
+0006c440: 696c 653d 6629 0d0a 2020 2020 2020 2020  ile=f)..        
+0006c450: 2020 2020 7072 696e 7428 272a 2a2a 2020      print('***  
+0006c460: 6576 2c20 7468 6574 612c 2078 7368 6966  ev, theta, xshif
+0006c470: 742c 2079 7368 6966 7427 2c20 6669 6c65  t, yshift', file
+0006c480: 3d66 290d 0a20 2020 2020 2020 2020 2020  =f)..           
+0006c490: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+0006c4a0: 7365 6c66 2e73 7461 636b 2e6e 5f65 7629  self.stack.n_ev)
+0006c4b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0006c4c0: 2020 2066 6f72 206a 2069 6e20 7261 6e67     for j in rang
+0006c4d0: 6528 7365 6c66 2e73 7461 636b 2e6e 5f74  e(self.stack.n_t
+0006c4e0: 6865 7461 293a 0d0a 2020 2020 2020 2020  heta):..        
+0006c4f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0006c500: 7428 2725 2e36 662c 2025 2e36 662c 2025  t('%.6f, %.6f, %
+0006c510: 2e36 662c 2025 2e36 6627 2025 2873 656c  .6f, %.6f' %(sel
+0006c520: 662e 7374 6163 6b2e 6576 5b69 5d2c 2073  f.stack.ev[i], s
+0006c530: 656c 662e 7374 6163 6b2e 7468 6574 615b  elf.stack.theta[
+0006c540: 6a5d 2c20 7365 6c66 2e78 7368 6966 7473  j], self.xshifts
+0006c550: 5b69 2c6a 5d2c 2073 656c 662e 7973 6869  [i,j], self.yshi
+0006c560: 6674 735b 692c 6a5d 292c 2066 696c 653d  fts[i,j]), file=
+0006c570: 6629 0d0a 0d0a 0d0a 2020 2020 2020 2020  f)......        
+0006c580: 662e 636c 6f73 6528 290d 0a0d 0a23 2d2d  f.close()....#--
+0006c590: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006c5a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006c5b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006c5c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006c5d0: 2d2d 2d2d 0d0a 2020 2020 6465 6620 4f6e  ----..    def On
+0006c5e0: 4c6f 6164 5368 6966 7473 2873 656c 662c  LoadShifts(self,
+0006c5f0: 2065 7674 293a 0d0a 0d0a 0d0a 0d0a 2020   evt):........  
+0006c600: 2020 2020 2020 7769 6c64 6361 7264 203d        wildcard =
+0006c610: 2022 4930 2043 5356 2066 696c 6573 2028   "I0 CSV files (
+0006c620: 2a2e 6373 7629 220d 0a0d 0a20 2020 2020  *.csv)"....     
+0006c630: 2020 2066 696c 6570 6174 682c 205f 6669     filepath, _fi
+0006c640: 6c74 6572 203d 2051 7457 6964 6765 7473  lter = QtWidgets
+0006c650: 2e51 4669 6c65 4469 616c 6f67 2e67 6574  .QFileDialog.get
+0006c660: 4f70 656e 4669 6c65 4e61 6d65 2873 656c  OpenFileName(sel
+0006c670: 662c 2027 506c 6561 7365 2073 656c 6563  f, 'Please selec
+0006c680: 7420 616e 2061 6c69 676e 6d65 6e74 2066  t an alignment f
+0006c690: 696c 6520 282e 6373 7629 272c 2027 272c  ile (.csv)', '',
+0006c6a0: 2077 696c 6463 6172 6429 0d0a 0d0a 0d0a   wildcard)......
+0006c6b0: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
+0006c6c0: 203d 2073 7472 2866 696c 6570 6174 6829   = str(filepath)
+0006c6d0: 0d0a 2020 2020 2020 2020 6966 2066 696c  ..        if fil
+0006c6e0: 6570 6174 6820 3d3d 2027 273a 0d0a 2020  epath == '':..  
+0006c6f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0006c700: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6620  ......        f 
+0006c710: 3d20 6f70 656e 2873 7472 2866 696c 6570  = open(str(filep
+0006c720: 6174 6829 2c27 7227 290d 0a0d 0a20 2020  ath),'r')....   
+0006c730: 2020 2020 2065 6c69 7374 203d 205b 5d0d       elist = [].
+0006c740: 0a20 2020 2020 2020 2078 7368 6966 746c  .        xshiftl
+0006c750: 6973 7420 3d20 5b5d 0d0a 2020 2020 2020  ist = []..      
+0006c760: 2020 7973 6869 6674 6c69 7374 203d 205b    yshiftlist = [
+0006c770: 5d0d 0a0d 0a20 2020 2020 2020 2066 6f72  ]....        for
+0006c780: 206c 696e 6520 696e 2066 3a0d 0a20 2020   line in f:..   
+0006c790: 2020 2020 2020 2020 2069 6620 6c69 6e65           if line
+0006c7a0: 2e73 7461 7274 7377 6974 6828 272a 2729  .startswith('*')
+0006c7b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0006c7c0: 2020 2063 6f6e 7469 6e75 650d 0a20 2020     continue..   
+0006c7d0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0006c7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006c7f0: 652c 2078 732c 2079 7320 3d20 5b66 6c6f  e, xs, ys = [flo
+0006c800: 6174 2028 7829 2066 6f72 2078 2069 6e20  at (x) for x in 
+0006c810: 6c69 6e65 2e73 706c 6974 2827 2c27 295d  line.split(',')]
+0006c820: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006c830: 2020 656c 6973 742e 6170 7065 6e64 2865    elist.append(e
+0006c840: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0006c850: 2020 2078 7368 6966 746c 6973 742e 6170     xshiftlist.ap
+0006c860: 7065 6e64 2878 7329 0d0a 2020 2020 2020  pend(xs)..      
+0006c870: 2020 2020 2020 2020 2020 7973 6869 6674            yshift
+0006c880: 6c69 7374 2e61 7070 656e 6428 7973 290d  list.append(ys).
+0006c890: 0a0d 0a20 2020 2020 2020 2066 2e63 6c6f  ...        f.clo
+0006c8a0: 7365 2829 0d0a 0d0a 0d0a 2020 2020 2020  se()......      
+0006c8b0: 2020 7365 6c66 2e78 7368 6966 7473 203d    self.xshifts =
+0006c8c0: 206e 702e 7a65 726f 7328 2873 656c 662e   np.zeros((self.
+0006c8d0: 7374 6163 6b2e 6e5f 6576 2929 0d0a 2020  stack.n_ev))..  
+0006c8e0: 2020 2020 2020 7365 6c66 2e79 7368 6966        self.yshif
+0006c8f0: 7473 203d 206e 702e 7a65 726f 7328 2873  ts = np.zeros((s
+0006c900: 656c 662e 7374 6163 6b2e 6e5f 6576 2929  elf.stack.n_ev))
+0006c910: 0d0a 0d0a 2020 2020 2020 2020 666f 7220  ....        for 
+0006c920: 6965 2069 6e20 7261 6e67 6528 7365 6c66  ie in range(self
+0006c930: 2e73 7461 636b 2e6e 5f65 7629 3a0d 0a20  .stack.n_ev):.. 
+0006c940: 2020 2020 2020 2020 2020 2065 6e67 666c             engfl
+0006c950: 203d 2027 252e 3666 2720 2520 2820 7365   = '%.6f' % ( se
+0006c960: 6c66 2e73 7461 636b 2e65 765b 6965 5d29  lf.stack.ev[ie])
+0006c970: 0d0a 2020 2020 2020 2020 2020 2020 656e  ..            en
+0006c980: 6720 3d20 666c 6f61 7428 656e 6766 6c29  g = float(engfl)
+0006c990: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0006c9a0: 2065 6e67 2069 6e20 656c 6973 743a 0d0a   eng in elist:..
+0006c9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006c9c0: 696e 6420 3d20 656c 6973 742e 696e 6465  ind = elist.inde
+0006c9d0: 7828 656e 6729 0d0a 2020 2020 2020 2020  x(eng)..        
+0006c9e0: 2020 2020 2020 2020 7365 6c66 2e78 7368          self.xsh
+0006c9f0: 6966 7473 5b69 655d 203d 2078 7368 6966  ifts[ie] = xshif
+0006ca00: 746c 6973 745b 696e 645d 0d0a 2020 2020  tlist[ind]..    
+0006ca10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0006ca20: 2e79 7368 6966 7473 5b69 655d 203d 2079  .yshifts[ie] = y
+0006ca30: 7368 6966 746c 6973 745b 696e 645d 0d0a  shiftlist[ind]..
+0006ca40: 0d0a 0d0a 2020 2020 2020 2020 2341 7070  ....        #App
+0006ca50: 6c79 2073 6869 6674 730d 0a20 2020 2020  ly shifts..     
+0006ca60: 2020 2073 656c 662e 506c 6f74 5368 6966     self.PlotShif
+0006ca70: 7473 2829 0d0a 2020 2020 2020 2020 666f  ts()..        fo
+0006ca80: 7220 6920 696e 2072 616e 6765 2873 656c  r i in range(sel
+0006ca90: 662e 7374 6163 6b2e 6e5f 6576 293a 0d0a  f.stack.n_ev):..
+0006caa0: 2020 2020 2020 2020 2020 2020 696d 6720              img 
+0006cab0: 3d20 7365 6c66 2e61 6c69 676e 6564 5f73  = self.aligned_s
+0006cac0: 7461 636b 5b3a 2c3a 2c69 5d0d 0a20 2020  tack[:,:,i]..   
+0006cad0: 2020 2020 2020 2020 2069 6620 2861 6273           if (abs
+0006cae0: 2873 656c 662e 7873 6869 6674 735b 695d  (self.xshifts[i]
+0006caf0: 293e 302e 3032 2920 6f72 2028 6162 7328  )>0.02) or (abs(
+0006cb00: 7365 6c66 2e79 7368 6966 7473 5b69 5d29  self.yshifts[i])
+0006cb10: 3e30 2e30 3229 3a0d 0a20 2020 2020 2020  >0.02):..       
+0006cb20: 2020 2020 2020 2020 2073 6869 6674 6564           shifted
+0006cb30: 5f69 6d67 203d 2073 656c 662e 7374 6163  _img = self.stac
+0006cb40: 6b2e 6170 706c 795f 696d 6167 655f 7265  k.apply_image_re
+0006cb50: 6769 7374 7261 7469 6f6e 2869 6d67 2c0d  gistration(img,.
+0006cb60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0006cb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0006cb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0006cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006cba0: 2020 2020 2073 656c 662e 7973 6869 6674       self.yshift
-0006cbb0: 735b 695d 290d 0a20 2020 2020 2020 2020  s[i])..         
-0006cbc0: 2020 2020 2020 2073 656c 662e 616c 6967         self.alig
-0006cbd0: 6e65 645f 7374 6163 6b5b 3a2c 3a2c 695d  ned_stack[:,:,i]
-0006cbe0: 203d 2073 6869 6674 6564 5f69 6d67 0d0a   = shifted_img..
-0006cbf0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-0006cc00: 2e72 6567 6973 745f 6361 6c63 756c 6174  .regist_calculat
-0006cc10: 6564 203d 2031 0d0a 2020 2020 2020 2020  ed = 1..        
-0006cc20: 7365 6c66 2e69 6576 203d 2030 0d0a 2020  self.iev = 0..  
-0006cc30: 2020 2020 2020 7365 6c66 2e53 686f 7749        self.ShowI
-0006cc40: 6d61 6765 2829 0d0a 2020 2020 2020 2020  mage()..        
-0006cc50: 7365 6c66 2e73 6c69 6465 725f 656e 672e  self.slider_eng.
-0006cc60: 7365 7456 616c 7565 2873 656c 662e 6965  setValue(self.ie
-0006cc70: 7629 0d0a 0d0a 2020 2020 2020 2020 7365  v)....        se
-0006cc80: 6c66 2e72 6567 6973 745f 6361 6c63 756c  lf.regist_calcul
-0006cc90: 6174 6564 203d 2031 0d0a 2020 2020 2020  ated = 1..      
-0006cca0: 2020 7365 6c66 2e6d 616e 5f61 6c69 676e    self.man_align
-0006ccb0: 203d 2030 0d0a 0d0a 2020 2020 2020 2020   = 0....        
-0006ccc0: 7365 6c66 2e74 6578 7463 7472 6c5f 6d73  self.textctrl_ms
-0006ccd0: 312e 7365 7454 6578 7428 2758 206d 616e  1.setText('X man
-0006cce0: 7561 6c20 7368 6966 743a 205c 6e27 290d  ual shift: \n').
-0006ccf0: 0a20 2020 2020 2020 2073 656c 662e 7465  .        self.te
-0006cd00: 7874 6374 726c 5f6d 7332 2e73 6574 5465  xtctrl_ms2.setTe
-0006cd10: 7874 2827 5920 6d61 6e75 616c 2073 6869  xt('Y manual shi
-0006cd20: 6674 3a20 2729 0d0a 0d0a 2020 2020 2020  ft: ')....      
-0006cd30: 2020 7365 6c66 2e55 7064 6174 6557 6964    self.UpdateWid
-0006cd40: 6765 7473 2829 0d0a 0d0a 2020 2020 2020  gets()....      
-0006cd50: 2020 6d69 6e5f 7873 6869 6674 203d 206e    min_xshift = n
-0006cd60: 702e 6d69 6e28 7365 6c66 2e78 7368 6966  p.min(self.xshif
-0006cd70: 7473 290d 0a20 2020 2020 2020 206d 6178  ts)..        max
-0006cd80: 5f78 7368 6966 7420 3d20 6e70 2e6d 6178  _xshift = np.max
-0006cd90: 2873 656c 662e 7873 6869 6674 7329 0d0a  (self.xshifts)..
-0006cda0: 0d0a 2020 2020 2020 2020 6d69 6e5f 7973  ..        min_ys
-0006cdb0: 6869 6674 203d 206e 702e 6d69 6e28 7365  hift = np.min(se
-0006cdc0: 6c66 2e79 7368 6966 7473 290d 0a20 2020  lf.yshifts)..   
-0006cdd0: 2020 2020 206d 6178 5f79 7368 6966 7420       max_yshift 
-0006cde0: 3d20 6e70 2e6d 6178 2873 656c 662e 7973  = np.max(self.ys
-0006cdf0: 6869 6674 7329 0d0a 0d0a 2020 2020 2020  hifts)....      
-0006ce00: 2020 6966 206d 696e 5f78 7368 6966 7420    if min_xshift 
-0006ce10: 3c20 7365 6c66 2e6d 696e 7873 203a 2073  < self.minxs : s
-0006ce20: 656c 662e 6d69 6e78 7320 3d20 6d69 6e5f  elf.minxs = min_
-0006ce30: 7873 6869 6674 0d0a 2020 2020 2020 2020  xshift..        
-0006ce40: 6966 206d 6178 5f78 7368 6966 7420 3e20  if max_xshift > 
-0006ce50: 7365 6c66 2e6d 6178 7873 203a 2073 656c  self.maxxs : sel
-0006ce60: 662e 6d61 7878 7320 3d20 6d61 785f 7873  f.maxxs = max_xs
-0006ce70: 6869 6674 0d0a 0d0a 2020 2020 2020 2020  hift....        
-0006ce80: 6966 206d 696e 5f79 7368 6966 7420 3c20  if min_yshift < 
-0006ce90: 7365 6c66 2e6d 696e 7973 203a 2073 656c  self.minys : sel
-0006cea0: 662e 6d69 6e79 7320 3d20 6d69 6e5f 7973  f.minys = min_ys
-0006ceb0: 6869 6674 0d0a 2020 2020 2020 2020 6966  hift..        if
-0006cec0: 206d 6178 5f79 7368 6966 7420 3e20 7365   max_yshift > se
-0006ced0: 6c66 2e6d 6178 7973 203a 2073 656c 662e  lf.maxys : self.
-0006cee0: 6d61 7879 7320 3d20 6d61 785f 7973 6869  maxys = max_yshi
-0006cef0: 6674 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d  ft......#-------
-0006cf00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006cf10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006cf20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006cf30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
-0006cf40: 0a20 2020 2064 6566 2055 7064 6174 6557  .    def UpdateW
-0006cf50: 6964 6765 7473 2873 656c 6629 3a0d 0a0d  idgets(self):...
-0006cf60: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0006cf70: 2e61 7574 6f3a 0d0a 2020 2020 2020 2020  .auto:..        
-0006cf80: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-0006cf90: 6d61 6e61 6c69 676e 2e73 6574 456e 6162  manalign.setEnab
-0006cfa0: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
-0006cfb0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0006cfc0: 6861 7665 5f72 6566 5f69 6d61 6765 203d  have_ref_image =
-0006cfd0: 3d20 313a 0d0a 2020 2020 2020 2020 2020  = 1:..          
-0006cfe0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
-0006cff0: 6e5f 7265 6769 7374 6572 2e73 6574 456e  n_register.setEn
-0006d000: 6162 6c65 6428 5472 7565 290d 0a20 2020  abled(True)..   
-0006d010: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0006d020: 662e 6275 7474 6f6e 5f73 7562 7265 6769  f.button_subregi
-0006d030: 6f6e 2e73 6574 456e 6162 6c65 6428 5472  on.setEnabled(Tr
-0006d040: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-0006d050: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-0006d060: 5f72 6566 696d 6773 6176 652e 7365 7445  _refimgsave.setE
-0006d070: 6e61 626c 6564 2854 7275 6529 0d0a 2020  nabled(True)..  
-0006d080: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0006d090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006d0a0: 2073 656c 662e 6275 7474 6f6e 5f72 6567   self.button_reg
-0006d0b0: 6973 7465 722e 7365 7445 6e61 626c 6564  ister.setEnabled
-0006d0c0: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
-0006d0d0: 2020 2020 2020 2020 2073 656c 662e 6275           self.bu
-0006d0e0: 7474 6f6e 5f73 7562 7265 6769 6f6e 2e73  tton_subregion.s
-0006d0f0: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
-0006d100: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006d110: 2020 7365 6c66 2e62 7574 746f 6e5f 7265    self.button_re
-0006d120: 6669 6d67 7361 7665 2e73 6574 456e 6162  fimgsave.setEnab
-0006d130: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
-0006d140: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0006d150: 2e62 7574 746f 6e5f 6465 6c73 7562 7265  .button_delsubre
-0006d160: 6769 6f6e 2e73 6574 456e 6162 6c65 6428  gion.setEnabled(
-0006d170: 4661 6c73 6529 0d0a 0d0a 2020 2020 2020  False)....      
-0006d180: 2020 2020 2020 6966 2073 656c 662e 7265        if self.re
-0006d190: 6769 7374 5f63 616c 6375 6c61 7465 6420  gist_calculated 
-0006d1a0: 3d3d 2031 3a0d 0a20 2020 2020 2020 2020  == 1:..         
-0006d1b0: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
-0006d1c0: 6f6e 5f63 726f 702e 7365 7445 6e61 626c  on_crop.setEnabl
-0006d1d0: 6564 2854 7275 6529 0d0a 2020 2020 2020  ed(True)..      
-0006d1e0: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
-0006d1f0: 7574 746f 6e5f 6163 6365 7074 2e73 6574  utton_accept.set
-0006d200: 456e 6162 6c65 6428 5472 7565 290d 0a20  Enabled(True).. 
-0006d210: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0006d220: 656c 662e 6275 7474 6f6e 5f73 6176 6573  elf.button_saves
-0006d230: 6869 6674 732e 7365 7445 6e61 626c 6564  hifts.setEnabled
-0006d240: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
-0006d250: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-0006d260: 746f 6e5f 7361 7665 696d 672e 7365 7445  ton_saveimg.setE
-0006d270: 6e61 626c 6564 2854 7275 6529 0d0a 2020  nabled(True)..  
-0006d280: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0006d290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006d2a0: 2073 656c 662e 6275 7474 6f6e 5f63 726f   self.button_cro
-0006d2b0: 702e 7365 7445 6e61 626c 6564 2846 616c  p.setEnabled(Fal
-0006d2c0: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
-0006d2d0: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-0006d2e0: 5f61 6363 6570 742e 7365 7445 6e61 626c  _accept.setEnabl
-0006d2f0: 6564 2846 616c 7365 290d 0a20 2020 2020  ed(False)..     
-0006d300: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0006d310: 6275 7474 6f6e 5f73 6176 6573 6869 6674  button_saveshift
-0006d320: 732e 7365 7445 6e61 626c 6564 2846 616c  s.setEnabled(Fal
-0006d330: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
-0006d340: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-0006d350: 5f73 6176 6569 6d67 2e73 6574 456e 6162  _saveimg.setEnab
-0006d360: 6c65 6428 4661 6c73 6529 0d0a 0d0a 2020  led(False)....  
-0006d370: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0006d380: 2020 2020 2020 2020 2073 656c 662e 6275           self.bu
-0006d390: 7474 6f6e 5f72 6567 6973 7465 722e 7365  tton_register.se
-0006d3a0: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
-0006d3b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0006d3c0: 662e 6275 7474 6f6e 5f64 656c 7375 6272  f.button_delsubr
-0006d3d0: 6567 696f 6e2e 7365 7445 6e61 626c 6564  egion.setEnabled
-0006d3e0: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
-0006d3f0: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-0006d400: 5f73 7562 7265 6769 6f6e 2e73 6574 456e  _subregion.setEn
-0006d410: 6162 6c65 6428 4661 6c73 6529 0d0a 0d0a  abled(False)....
-0006d420: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0006d430: 656c 662e 6861 7665 5f72 6566 5f69 6d61  elf.have_ref_ima
-0006d440: 6765 203d 3d20 313a 0d0a 2020 2020 2020  ge == 1:..      
-0006d450: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
-0006d460: 7574 746f 6e5f 6d61 6e61 6c69 676e 2e73  utton_manalign.s
-0006d470: 6574 456e 6162 6c65 6428 5472 7565 290d  etEnabled(True).
-0006d480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006d490: 2073 656c 662e 6275 7474 6f6e 5f72 6566   self.button_ref
-0006d4a0: 696d 6773 6176 652e 7365 7445 6e61 626c  imgsave.setEnabl
-0006d4b0: 6564 2854 7275 6529 0d0a 2020 2020 2020  ed(True)..      
-0006d4c0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0006d4d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0006d4e0: 662e 6275 7474 6f6e 5f6d 616e 616c 6967  f.button_manalig
-0006d4f0: 6e2e 7365 7445 6e61 626c 6564 2846 616c  n.setEnabled(Fal
-0006d500: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
-0006d510: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-0006d520: 5f72 6566 696d 6773 6176 652e 7365 7445  _refimgsave.setE
-0006d530: 6e61 626c 6564 2846 616c 7365 290d 0a0d  nabled(False)...
-0006d540: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0006d550: 7365 6c66 2e72 6567 6973 745f 6361 6c63  self.regist_calc
-0006d560: 756c 6174 6564 203d 3d20 313a 0d0a 2020  ulated == 1:..  
-0006d570: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0006d580: 6c66 2e62 7574 746f 6e5f 6372 6f70 2e73  lf.button_crop.s
-0006d590: 6574 456e 6162 6c65 6428 5472 7565 290d  etEnabled(True).
-0006d5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006d5b0: 2073 656c 662e 6275 7474 6f6e 5f61 6363   self.button_acc
-0006d5c0: 6570 742e 7365 7445 6e61 626c 6564 2854  ept.setEnabled(T
-0006d5d0: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
-0006d5e0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
-0006d5f0: 6e5f 7361 7665 7368 6966 7473 2e73 6574  n_saveshifts.set
-0006d600: 456e 6162 6c65 6428 5472 7565 290d 0a20  Enabled(True).. 
-0006d610: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0006d620: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006d630: 2020 7365 6c66 2e62 7574 746f 6e5f 6372    self.button_cr
-0006d640: 6f70 2e73 6574 456e 6162 6c65 6428 4661  op.setEnabled(Fa
-0006d650: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
-0006d660: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
-0006d670: 6e5f 6163 6365 7074 2e73 6574 456e 6162  n_accept.setEnab
-0006d680: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
-0006d690: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0006d6a0: 2e62 7574 746f 6e5f 7361 7665 7368 6966  .button_saveshif
-0006d6b0: 7473 2e73 6574 456e 6162 6c65 6428 4661  ts.setEnabled(Fa
-0006d6c0: 6c73 6529 0d0a 0d0a 2020 2020 2020 2020  lse)....        
-0006d6d0: 2020 2020 6966 2073 656c 662e 6d61 6e5f      if self.man_
-0006d6e0: 616c 6967 6e20 3d3d 2030 3a0d 0a20 2020  align == 0:..   
-0006d6f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0006d700: 662e 6275 7474 6f6e 5f70 6963 6b32 6e64  f.button_pick2nd
-0006d710: 706f 696e 742e 7365 7445 6e61 626c 6564  point.setEnabled
-0006d720: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
-0006d730: 2020 2020 2020 2020 2073 656c 662e 6275           self.bu
-0006d740: 7474 6f6e 5f61 7070 6c79 6d61 6e2e 7365  tton_applyman.se
-0006d750: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
-0006d760: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0006d770: 6620 7365 6c66 2e6d 616e 5f61 6c69 676e  f self.man_align
-0006d780: 203d 3d20 313a 0d0a 2020 2020 2020 2020   == 1:..        
-0006d790: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-0006d7a0: 746f 6e5f 7069 636b 326e 6470 6f69 6e74  ton_pick2ndpoint
-0006d7b0: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
-0006d7c0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-0006d7d0: 6c69 6620 7365 6c66 2e6d 616e 5f61 6c69  lif self.man_ali
-0006d7e0: 676e 203d 3d20 323a 0d0a 2020 2020 2020  gn == 2:..      
-0006d7f0: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
-0006d800: 7574 746f 6e5f 6170 706c 796d 616e 2e73  utton_applyman.s
-0006d810: 6574 456e 6162 6c65 6428 5472 7565 290d  etEnabled(True).
-0006d820: 0a0d 0a63 6c61 7373 2047 656e 6572 616c  ...class General
-0006d830: 5075 7270 6f73 6553 6967 6e61 6c73 2851  PurposeSignals(Q
-0006d840: 7443 6f72 652e 514f 626a 6563 7429 3a0d  tCore.QObject):.
-0006d850: 0a20 2020 2066 696e 6973 6865 6420 3d20  .    finished = 
-0006d860: 7079 7174 5369 676e 616c 2829 0d0a 2020  pyqtSignal()..  
-0006d870: 2020 6974 6865 7461 7072 6f67 7265 7373    ithetaprogress
-0006d880: 203d 2070 7971 7453 6967 6e61 6c28 696e   = pyqtSignal(in
-0006d890: 7429 0d0a 2320 2d2d 2d2d 2d2d 2d2d 2d2d  t)..# ----------
-0006d8a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006d8b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006d8c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0006d8d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 636c  ------------..cl
-0006d8e0: 6173 7320 4765 6e65 7261 6c50 7572 706f  ass GeneralPurpo
-0006d8f0: 7365 5072 6f63 6573 736f 7228 5174 436f  seProcessor(QtCo
-0006d900: 7265 2e51 5275 6e6e 6162 6c65 293a 0d0a  re.QRunnable):..
-0006d910: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-0006d920: 2873 656c 662c 2070 6172 656e 742c 2071  (self, parent, q
-0006d930: 7565 7565 293a 0d0a 2020 2020 2020 2020  ueue):..        
-0006d940: 7375 7065 7228 4765 6e65 7261 6c50 7572  super(GeneralPur
-0006d950: 706f 7365 5072 6f63 6573 736f 722c 2073  poseProcessor, s
-0006d960: 656c 6629 2e5f 5f69 6e69 745f 5f28 290d  elf).__init__().
-0006d970: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
-0006d980: 676e 616c 7320 3d20 4765 6e65 7261 6c50  gnals = GeneralP
-0006d990: 7572 706f 7365 5369 676e 616c 7328 290d  urposeSignals().
-0006d9a0: 0a20 2020 2020 2020 2073 656c 662e 6675  .        self.fu
-0006d9b0: 6e63 6469 6374 203d 207b 2253 6869 6674  ncdict = {"Shift
-0006d9c0: 496d 6722 3a20 7365 6c66 2e53 6869 6674  Img": self.Shift
-0006d9d0: 496d 672c 2022 416c 6967 6e52 6566 6572  Img, "AlignRefer
-0006d9e0: 656e 6365 6422 3a20 7365 6c66 2e41 6c69  enced": self.Ali
-0006d9f0: 676e 5265 6665 7265 6e63 6564 7d0d 0a20  gnReferenced}.. 
-0006da00: 2020 2020 2020 2073 656c 662e 7061 7265         self.pare
-0006da10: 6e74 203d 2070 6172 656e 740d 0a20 2020  nt = parent..   
-0006da20: 2020 2020 2073 656c 662e 7175 6575 6520       self.queue 
-0006da30: 3d20 7175 6575 650d 0a20 2020 2020 2020  = queue..       
-0006da40: 2073 656c 662e 6375 7272 656e 745f 6974   self.current_it
-0006da50: 6865 7461 203d 2030 0d0a 0d0a 2020 2020  heta = 0....    
-0006da60: 4070 7971 7453 6c6f 7428 290d 0a20 2020  @pyqtSlot()..   
-0006da70: 2064 6566 2072 756e 2873 656c 6629 3a0d   def run(self):.
-0006da80: 0a20 2020 2020 2020 2023 7072 696e 7428  .        #print(
-0006da90: 2777 6f72 6b65 7227 2c20 7468 7265 6164  'worker', thread
-0006daa0: 696e 672e 6765 745f 6964 656e 7428 2929  ing.get_ident())
-0006dab0: 0d0a 2020 2020 2020 2020 7768 696c 6520  ..        while 
-0006dac0: 5472 7565 3a0d 0a20 2020 2020 2020 2020  True:..         
-0006dad0: 2020 2023 7072 696e 7428 7365 6c66 2e70     #print(self.p
-0006dae0: 6172 656e 742e 706f 6f6c 2e70 6f6f 6c2e  arent.pool.pool.
-0006daf0: 6163 7469 7665 5468 7265 6164 436f 756e  activeThreadCoun
-0006db00: 7428 2929 0d0a 2020 2020 2020 2020 2020  t())..          
-0006db10: 2020 2370 7269 6e74 2851 7443 6f72 652e    #print(QtCore.
-0006db20: 5154 6872 6561 6450 6f6f 6c2e 6163 7469  QThreadPool.acti
-0006db30: 7665 5468 7265 6164 436f 756e 7428 2929  veThreadCount())
-0006db40: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-0006db50: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-0006db60: 2020 2020 776f 726b 6572 6675 6e63 2c20      workerfunc, 
-0006db70: 2a61 7267 7320 3d20 7365 6c66 2e71 7565  *args = self.que
-0006db80: 7565 2e67 6574 2846 616c 7365 290d 0a20  ue.get(False).. 
-0006db90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0006dba0: 656c 662e 6675 6e63 6469 6374 5b77 6f72  elf.funcdict[wor
-0006dbb0: 6b65 7266 756e 635d 282a 6172 6773 5b30  kerfunc](*args[0
-0006dbc0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-0006dbd0: 2020 2020 2370 7269 6e74 2822 6275 7379      #print("busy
-0006dbe0: 2077 6974 6820 7461 736b 207b 7d22 2e66   with task {}".f
-0006dbf0: 6f72 6d61 7428 776f 726b 6572 6675 6e63  ormat(workerfunc
-0006dc00: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0006dc10: 6578 6365 7074 2045 6d70 7479 3a20 2320  except Empty: # 
-0006dc20: 6966 2071 7565 7565 2065 6d70 7479 0d0a  if queue empty..
-0006dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dc40: 6272 6561 6b0d 0a0d 0a20 2020 2064 6566  break....    def
-0006dc50: 2041 6c69 676e 5265 6665 7265 6e63 6564   AlignReferenced
-0006dc60: 2873 656c 662c 2064 6174 612c 2069 7468  (self, data, ith
-0006dc70: 6574 6129 3a0d 0a20 2020 2020 2020 2069  eta):..        i
-0006dc80: 6620 7365 6c66 2e63 7572 7265 6e74 5f69  f self.current_i
-0006dc90: 7468 6574 6120 213d 2069 7468 6574 613a  theta != itheta:
-0006dca0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0006dcb0: 6c66 2e63 7572 7265 6e74 5f69 7468 6574  lf.current_ithet
-0006dcc0: 6120 3d20 6974 6865 7461 0d0a 2020 2020  a = itheta..    
-0006dcd0: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
-0006dce0: 6e61 6c73 2e69 7468 6574 6170 726f 6772  nals.ithetaprogr
-0006dcf0: 6573 732e 656d 6974 2869 7468 6574 6129  ess.emit(itheta)
-0006dd00: 0d0a 2020 2020 2020 2020 6472 6966 745f  ..        drift_
-0006dd10: 7820 3d20 5b30 2c30 5d0d 0a20 2020 2020  x = [0,0]..     
-0006dd20: 2020 2064 7269 6674 5f79 203d 205b 302c     drift_y = [0,
-0006dd30: 305d 0d0a 2020 2020 2020 2020 6472 6966  0]..        drif
-0006dd40: 742c 2065 7272 6f72 2c20 5f20 3d20 7068  t, error, _ = ph
-0006dd50: 6173 655f 6372 6f73 735f 636f 7272 656c  ase_cross_correl
-0006dd60: 6174 696f 6e28 7365 6c66 2e47 6175 7373  ation(self.Gauss
-0006dd70: 2873 656c 662e 7061 7265 6e74 2e73 7461  (self.parent.sta
-0006dd80: 636b 2e61 6273 6461 7461 5f63 726f 7070  ck.absdata_cropp
-0006dd90: 6564 5b3a 2c20 3a2c 2064 6174 615b 305d  ed[:, :, data[0]
-0006dda0: 2c69 7468 6574 615d 292c 0d0a 2020 2020  ,itheta]),..    
-0006ddb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ddc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ddd0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0006dde0: 6c66 2e47 6175 7373 2873 656c 662e 7061  lf.Gauss(self.pa
-0006ddf0: 7265 6e74 2e73 7461 636b 2e61 6273 6461  rent.stack.absda
-0006de00: 7461 5f63 726f 7070 6564 5b3a 2c20 3a2c  ta_cropped[:, :,
-0006de10: 2064 6174 615b 315d 2c69 7468 6574 615d   data[1],itheta]
-0006de20: 292c 7570 7361 6d70 6c65 5f66 6163 746f  ),upsample_facto
-0006de30: 723d 3230 2920 2323 2032 3020 6d65 616e  r=20) ## 20 mean
-0006de40: 7320 302e 3035 2070 7820 7072 6563 6973  s 0.05 px precis
-0006de50: 696f 6e0d 0a20 2020 2020 2020 2073 656c  ion..        sel
-0006de60: 662e 7061 7265 6e74 2e73 7461 636b 2e73  f.parent.stack.s
-0006de70: 6869 6674 7364 6963 745b 6974 6865 7461  hiftsdict[itheta
-0006de80: 5d5b 2265 7272 6f72 7322 5d5b 6461 7461  ]["errors"][data
-0006de90: 5b30 5d5d 203d 2072 6f75 6e64 2865 7272  [0]] = round(err
-0006dea0: 6f72 2c34 290d 0a20 2020 2020 2020 2069  or,4)..        i
-0006deb0: 6620 6461 7461 5b30 5d20 2d20 6461 7461  f data[0] - data
-0006dec0: 5b31 5d20 3e20 303a 0d0a 2020 2020 2020  [1] > 0:..      
-0006ded0: 2020 2020 2020 6472 6966 745f 785b 315d        drift_x[1]
-0006dee0: 203d 2072 6f75 6e64 2864 7269 6674 5b30   = round(drift[0
-0006def0: 5d2c 3229 0d0a 2020 2020 2020 2020 2020  ],2)..          
-0006df00: 2020 6472 6966 745f 795b 315d 203d 2072    drift_y[1] = r
-0006df10: 6f75 6e64 2864 7269 6674 5b31 5d2c 3229  ound(drift[1],2)
-0006df20: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0006df30: 6c66 2e70 6172 656e 742e 7374 6163 6b2e  lf.parent.stack.
-0006df40: 7368 6966 7473 6469 6374 5b69 7468 6574  shiftsdict[ithet
-0006df50: 615d 5b22 7864 6f74 7322 5d5b 6461 7461  a]["xdots"][data
-0006df60: 5b30 5d5d 3d20 6472 6966 745f 785b 315d  [0]]= drift_x[1]
-0006df70: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0006df80: 6c66 2e70 6172 656e 742e 7374 6163 6b2e  lf.parent.stack.
-0006df90: 7368 6966 7473 6469 6374 5b69 7468 6574  shiftsdict[ithet
-0006dfa0: 615d 5b22 7964 6f74 7322 5d5b 6461 7461  a]["ydots"][data
-0006dfb0: 5b30 5d5d 3d20 6472 6966 745f 795b 315d  [0]]= drift_y[1]
-0006dfc0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-0006dfd0: 0a20 2020 2020 2020 2020 2020 2064 7269  .            dri
-0006dfe0: 6674 5f78 5b30 5d20 3d20 726f 756e 6428  ft_x[0] = round(
-0006dff0: 6472 6966 745b 305d 2c32 290d 0a20 2020  drift[0],2)..   
-0006e000: 2020 2020 2020 2020 2064 7269 6674 5f79           drift_y
-0006e010: 5b30 5d20 3d20 726f 756e 6428 6472 6966  [0] = round(drif
-0006e020: 745b 315d 2c32 290d 0a20 2020 2020 2020  t[1],2)..       
-0006e030: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
-0006e040: 2e73 7461 636b 2e73 6869 6674 7364 6963  .stack.shiftsdic
-0006e050: 745b 6974 6865 7461 5d5b 2278 646f 7473  t[itheta]["xdots
-0006e060: 225d 5b64 6174 615b 305d 5d3d 2064 7269  "][data[0]]= dri
-0006e070: 6674 5f78 5b30 5d0d 0a20 2020 2020 2020  ft_x[0]..       
-0006e080: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
-0006e090: 2e73 7461 636b 2e73 6869 6674 7364 6963  .stack.shiftsdic
-0006e0a0: 745b 6974 6865 7461 5d5b 2279 646f 7473  t[itheta]["ydots
-0006e0b0: 225d 5b64 6174 615b 305d 5d3d 2064 7269  "][data[0]]= dri
-0006e0c0: 6674 5f79 5b30 5d0d 0a0d 0a20 2020 2064  ft_y[0]....    d
-0006e0d0: 6566 2053 6869 6674 496d 6728 7365 6c66  ef ShiftImg(self
-0006e0e0: 2c20 726f 772c 782c 792c 6974 6865 7461  , row,x,y,itheta
-0006e0f0: 293a 0d0a 2020 2020 2020 2020 7368 6966  ):..        shif
-0006e100: 7465 6420 3d20 6e64 696d 6167 652e 666f  ted = ndimage.fo
-0006e110: 7572 6965 725f 7368 6966 7428 6e70 2e66  urier_shift(np.f
-0006e120: 6674 2e66 6674 3228 7365 6c66 2e70 6172  ft.fft2(self.par
-0006e130: 656e 742e 7374 6163 6b2e 6162 7364 6174  ent.stack.absdat
-0006e140: 6134 645b 3a2c 203a 2c20 726f 772c 6974  a4d[:, :, row,it
-0006e150: 6865 7461 5d29 2c20 5b66 6c6f 6174 282d  heta]), [float(-
-0006e160: 7829 2c66 6c6f 6174 282d 7929 5d29 0d0a  x),float(-y)])..
-0006e170: 2020 2020 2020 2020 7368 6966 7465 6420          shifted 
-0006e180: 3d20 6e70 2e66 6674 2e69 6666 7432 2873  = np.fft.ifft2(s
-0006e190: 6869 6674 6564 290d 0a20 2020 2020 2020  hifted)..       
-0006e1a0: 2073 656c 662e 7061 7265 6e74 2e73 7461   self.parent.sta
-0006e1b0: 636b 2e61 6273 6461 7461 3464 5f73 6869  ck.absdata4d_shi
-0006e1c0: 6674 6564 5b3a 2c20 3a2c 2072 6f77 2c20  fted[:, :, row, 
-0006e1d0: 6974 6865 7461 5d20 3d20 7368 6966 7465  itheta] = shifte
-0006e1e0: 642e 7265 616c 0d0a 2020 2020 2020 2020  d.real..        
-0006e1f0: 7265 7475 726e 0d0a 0d0a 2020 2020 6465  return....    de
-0006e200: 6620 4761 7573 7328 7365 6c66 2c20 696d  f Gauss(self, im
-0006e210: 293a 0d0a 2020 2020 2020 2020 6761 7573  ):..        gaus
-0006e220: 7365 6420 3d20 6e64 696d 6167 652e 6761  sed = ndimage.ga
-0006e230: 7573 7369 616e 5f66 696c 7465 7228 696d  ussian_filter(im
-0006e240: 2c20 7365 6c66 2e70 6172 656e 742e 7370  , self.parent.sp
-0006e250: 696e 426f 7847 6175 7373 2e76 616c 7565  inBoxGauss.value
-0006e260: 2829 290d 0a20 2020 2020 2020 2072 6574  ())..        ret
-0006e270: 7572 6e20 6761 7573 7365 640d 0a0d 0a63  urn gaussed....c
-0006e280: 6c61 7373 2054 6173 6b44 6973 7061 7463  lass TaskDispatc
-0006e290: 6865 7228 5174 436f 7265 2e51 4f62 6a65  her(QtCore.QObje
-0006e2a0: 6374 293a 0d0a 2020 2020 6465 6620 5f5f  ct):..    def __
-0006e2b0: 696e 6974 5f5f 2873 656c 662c 7061 7265  init__(self,pare
-0006e2c0: 6e74 293a 0d0a 2020 2020 2020 2020 7072  nt):..        pr
-0006e2d0: 696e 7428 2230 202d 2064 6973 7061 7463  int("0 - dispatc
-0006e2e0: 6865 7220 6361 6c6c 6564 2c20 706f 6f6c  her called, pool
-0006e2f0: 2069 6e69 7469 6174 6564 2229 0d0a 2020   initiated")..  
-0006e300: 2020 2020 2020 7375 7065 7228 5461 736b        super(Task
-0006e310: 4469 7370 6174 6368 6572 2c20 7365 6c66  Dispatcher, self
-0006e320: 292e 5f5f 696e 6974 5f5f 2829 0d0a 2020  ).__init__()..  
-0006e330: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-0006e340: 2020 2020 2020 2020 7365 6c66 2e77 6f72          self.wor
-0006e350: 6b65 722e 7369 676e 616c 732e 6974 6865  ker.signals.ithe
-0006e360: 7461 7072 6f67 7265 7373 2e64 6973 636f  taprogress.disco
-0006e370: 6e6e 6563 7428 290d 0a20 2020 2020 2020  nnect()..       
-0006e380: 2020 2020 2073 656c 662e 776f 726b 6572       self.worker
-0006e390: 2e73 6967 6e61 6c73 2e66 696e 6973 6865  .signals.finishe
-0006e3a0: 642e 6469 7363 6f6e 6e65 6374 2829 0d0a  d.disconnect()..
-0006e3b0: 2020 2020 2020 2020 6578 6365 7074 3a0d          except:.
-0006e3c0: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
-0006e3d0: 730d 0a20 2020 2020 2020 2073 656c 662e  s..        self.
-0006e3e0: 706f 6f6c 203d 2051 7443 6f72 652e 5154  pool = QtCore.QT
-0006e3f0: 6872 6561 6450 6f6f 6c2e 676c 6f62 616c  hreadPool.global
-0006e400: 496e 7374 616e 6365 2829 0d0a 2020 2020  Instance()..    
-0006e410: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-0006e420: 2020 2020 2020 6370 7573 203d 206c 656e        cpus = len
-0006e430: 286f 732e 7363 6865 645f 6765 7461 6666  (os.sched_getaff
-0006e440: 696e 6974 7928 3029 2920 2320 6e75 6d62  inity(0)) # numb
-0006e450: 6572 206f 6620 6370 7520 7468 7265 6164  er of cpu thread
-0006e460: 732e 206e 6f74 2073 7570 706f 7274 6564  s. not supported
-0006e470: 206f 6e20 736f 6d65 2070 6c61 7466 6f72   on some platfor
-0006e480: 6d73 2e0d 0a20 2020 2020 2020 2065 7863  ms...        exc
-0006e490: 6570 743a 0d0a 2020 2020 2020 2020 2020  ept:..          
-0006e4a0: 2020 6370 7573 203d 206f 732e 6370 755f    cpus = os.cpu_
-0006e4b0: 636f 756e 7428 290d 0a20 2020 2020 2020  count()..       
-0006e4c0: 2073 656c 662e 706f 6f6c 2e73 6574 4d61   self.pool.setMa
-0006e4d0: 7854 6872 6561 6443 6f75 6e74 2863 7075  xThreadCount(cpu
-0006e4e0: 7329 0d0a 2020 2020 2020 2020 7365 6c66  s)..        self
-0006e4f0: 2e71 7565 7565 203d 2053 696d 706c 6551  .queue = SimpleQ
-0006e500: 7565 7565 2829 0d0a 2020 2020 2020 2020  ueue()..        
-0006e510: 7365 6c66 2e70 6172 656e 7420 3d20 7061  self.parent = pa
-0006e520: 7265 6e74 0d0a 0d0a 2020 2020 4070 7971  rent....    @pyq
-0006e530: 7453 6c6f 7428 290d 0a20 2020 2064 6566  tSlot()..    def
-0006e540: 2072 756e 2873 656c 6629 3a0d 0a20 2020   run(self):..   
-0006e550: 2020 2020 2023 7072 696e 7428 7365 6c66       #print(self
-0006e560: 2e71 7565 7565 2e71 7369 7a65 2829 290d  .queue.qsize()).
-0006e570: 0a20 2020 2020 2020 2023 7072 696e 7428  .        #print(
-0006e580: 2770 6f6f 6c27 2c20 7468 7265 6164 696e  'pool', threadin
-0006e590: 672e 6765 745f 6964 656e 7428 2929 0d0a  g.get_ident())..
-0006e5a0: 2020 2020 2020 2020 2320 6966 2073 656c          # if sel
-0006e5b0: 662e 7061 7265 6e74 2e63 6f6d 2e73 7461  f.parent.com.sta
-0006e5c0: 636b 5f34 6420 3d3d 2030 3a0d 0a20 2020  ck_4d == 0:..   
-0006e5d0: 2020 2020 2071 7369 7a65 203d 2069 6e74       qsize = int
-0006e5e0: 2873 656c 662e 7175 6575 652e 7173 697a  (self.queue.qsiz
-0006e5f0: 6528 2929 0d0a 2020 2020 2020 2020 6d61  e())..        ma
-0006e600: 7874 6872 6561 6473 203d 2073 656c 662e  xthreads = self.
-0006e610: 706f 6f6c 2e6d 6178 5468 7265 6164 436f  pool.maxThreadCo
-0006e620: 756e 7428 290d 0a20 2020 2020 2020 2070  unt()..        p
-0006e630: 7265 6665 7272 6564 5f74 6872 6561 645f  referred_thread_
-0006e640: 6e75 6d62 6572 203d 206d 696e 286d 6178  number = min(max
-0006e650: 7468 7265 6164 732c 2071 7369 7a65 290d  threads, qsize).
-0006e660: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-0006e670: 3120 2d20 7374 6172 7469 6e67 2074 6872  1 - starting thr
-0006e680: 6561 6473 222c 7072 6566 6572 7265 645f  eads",preferred_
-0006e690: 7468 7265 6164 5f6e 756d 6265 722c 2022  thread_number, "
-0006e6a0: 7468 7265 6164 7320 6e65 6564 6564 2c20  threads needed, 
-0006e6b0: 6e75 6d62 6572 206f 6620 7461 736b 733a  number of tasks:
-0006e6c0: 222c 7173 697a 6529 0d0a 2020 2020 2020  ",qsize)..      
-0006e6d0: 2020 7768 696c 6520 696e 7428 7365 6c66    while int(self
-0006e6e0: 2e71 7565 7565 2e71 7369 7a65 2829 2920  .queue.qsize()) 
-0006e6f0: 616e 6420 7365 6c66 2e70 6f6f 6c2e 6163  and self.pool.ac
-0006e700: 7469 7665 5468 7265 6164 436f 756e 7428  tiveThreadCount(
-0006e710: 2920 3c20 7072 6566 6572 7265 645f 7468  ) < preferred_th
-0006e720: 7265 6164 5f6e 756d 6265 723a 2023 7374  read_number: #st
-0006e730: 6172 7420 6173 206d 616e 7920 7468 7265  art as many thre
-0006e740: 6164 7320 6173 206e 6565 6465 642e 0d0a  ads as needed...
-0006e750: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
-0006e760: 6e74 2822 6163 7469 7665 2074 6872 6561  nt("active threa
-0006e770: 6473 222b 7374 7228 7365 6c66 2e70 6f6f  ds"+str(self.poo
-0006e780: 6c2e 6163 7469 7665 5468 7265 6164 436f  l.activeThreadCo
-0006e790: 756e 7428 2929 2b22 2071 7369 7a65 2022  unt())+" qsize "
-0006e7a0: 2b73 7472 2869 6e74 2873 656c 662e 7175  +str(int(self.qu
-0006e7b0: 6575 652e 7173 697a 6528 2929 2929 0d0a  eue.qsize())))..
-0006e7c0: 2020 2020 2020 2020 2020 2020 776f 726b              work
-0006e7d0: 6572 203d 2047 656e 6572 616c 5075 7270  er = GeneralPurp
-0006e7e0: 6f73 6550 726f 6365 7373 6f72 2873 656c  oseProcessor(sel
-0006e7f0: 662e 7061 7265 6e74 2c73 656c 662e 7175  f.parent,self.qu
-0006e800: 6575 6529 0d0a 2020 2020 2020 2020 2020  eue)..          
-0006e810: 2020 776f 726b 6572 2e73 6967 6e61 6c73    worker.signals
-0006e820: 2e69 7468 6574 6170 726f 6772 6573 732e  .ithetaprogress.
-0006e830: 636f 6e6e 6563 7428 7365 6c66 2e70 6172  connect(self.par
-0006e840: 656e 742e 4954 6865 7461 5072 6f67 7265  ent.IThetaProgre
-0006e850: 7373 290d 0a20 2020 2020 2020 2020 2020  ss)..           
-0006e860: 2073 656c 662e 706f 6f6c 2e73 7461 7274   self.pool.start
-0006e870: 2877 6f72 6b65 7229 0d0a 2020 2020 2020  (worker)..      
-0006e880: 2020 2020 2020 7469 6d65 2e73 6c65 6570        time.sleep
-0006e890: 2830 2e30 3229 2023 2061 7274 6966 6963  (0.02) # artific
-0006e8a0: 616c 2064 656c 6179 2074 6f20 7374 6172  al delay to star
-0006e8b0: 7420 7468 7265 6164 7320 7769 7468 2061  t threads with a
-0006e8c0: 206c 6974 746c 6520 7469 6d65 2073 6570   little time sep
-0006e8d0: 6172 6174 696f 6e2e 204f 7468 6572 7769  aration. Otherwi
-0006e8e0: 7365 2053 6869 6674 496d 6773 2066 7265  se ShiftImgs fre
-0006e8f0: 657a 6573 2069 6e20 5769 6e31 3020 616e  ezes in Win10 an
-0006e900: 6420 4d61 634f 5320 666f 7220 736d 616c  d MacOS for smal
-0006e910: 6c20 7374 6163 6b73 210d 0a20 2020 2020  l stacks!..     
-0006e920: 2020 2073 656c 662e 706f 6f6c 2e77 6169     self.pool.wai
-0006e930: 7446 6f72 446f 6e65 2829 0d0a 2020 2020  tForDone()..    
-0006e940: 2020 2020 7072 696e 7428 2232 202d 2061      print("2 - a
-0006e950: 6c6c 2074 6872 6561 6473 2064 6561 6422  ll threads dead"
-0006e960: 290d 0a20 2020 2020 2020 2077 6f72 6b65  )..        worke
-0006e970: 722e 7369 676e 616c 732e 6669 6e69 7368  r.signals.finish
-0006e980: 6564 2e63 6f6e 6e65 6374 2873 656c 662e  ed.connect(self.
-0006e990: 7061 7265 6e74 2e54 6872 6561 6450 6f6f  parent.ThreadPoo
-0006e9a0: 6c43 6f6d 706c 6574 6529 0d0a 2020 2020  lComplete)..    
-0006e9b0: 2020 2020 776f 726b 6572 2e73 6967 6e61      worker.signa
-0006e9c0: 6c73 2e66 696e 6973 6865 642e 656d 6974  ls.finished.emit
-0006e9d0: 2829 0d0a 2020 2020 2361 6464 2061 2074  ()..    #add a t
-0006e9e0: 6173 6b20 746f 2074 6865 2071 7565 7565  ask to the queue
-0006e9f0: 0d0a 2020 2020 6465 6620 656e 7175 6575  ..    def enqueu
-0006ea00: 6574 6173 6b28 7365 6c66 2c20 6675 6e63  etask(self, func
-0006ea10: 2c20 2a61 7267 732c 202a 2a6b 6172 6773  , *args, **kargs
-0006ea20: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
-0006ea30: 2e71 7565 7565 2e70 7574 2828 6675 6e63  .queue.put((func
-0006ea40: 2c20 6172 6773 2c20 6b61 7267 7329 290d  , args, kargs)).
-0006ea50: 0a0d 0a63 6c61 7373 2049 6d61 6765 5265  ...class ImageRe
-0006ea60: 6769 7374 7261 7469 6f6e 4646 5428 5174  gistrationFFT(Qt
-0006ea70: 5769 6467 6574 732e 5144 6961 6c6f 672c  Widgets.QDialog,
-0006ea80: 2051 7457 6964 6765 7473 2e51 4772 6170   QtWidgets.QGrap
-0006ea90: 6869 6373 5363 656e 6529 3a0d 0a20 2020  hicsScene):..   
-0006eaa0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-0006eab0: 6c66 2c20 7061 7265 6e74 2c20 636f 6d6d  lf, parent, comm
-0006eac0: 6f6e 2c20 7374 6163 6b29 3a0d 0a20 2020  on, stack):..   
-0006ead0: 2020 2020 2051 7457 6964 6765 7473 2e51       QtWidgets.Q
-0006eae0: 5769 6467 6574 2e5f 5f69 6e69 745f 5f28  Widget.__init__(
-0006eaf0: 7365 6c66 2c20 7061 7265 6e74 290d 0a20  self, parent).. 
-0006eb00: 2020 2020 2020 2075 6963 2e6c 6f61 6455         uic.loadU
-0006eb10: 6928 6f73 2e70 6174 682e 6a6f 696e 286f  i(os.path.join(o
-0006eb20: 732e 7061 7468 2e64 6972 6e61 6d65 286f  s.path.dirname(o
-0006eb30: 732e 7061 7468 2e61 6273 7061 7468 285f  s.path.abspath(_
-0006eb40: 5f66 696c 655f 5f29 292c 2027 7368 6f77  _file__)), 'show
-0006eb50: 616c 6967 6e32 2e75 6927 292c 2073 656c  align2.ui'), sel
-0006eb60: 6629 0d0a 2020 2020 2020 2020 7365 6c66  f)..        self
-0006eb70: 2e70 6172 656e 7420 3d20 7061 7265 6e74  .parent = parent
-0006eb80: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-0006eb90: 7461 636b 203d 2073 7461 636b 0d0a 2020  tack = stack..  
-0006eba0: 2020 2020 2020 7365 6c66 2e63 6f6d 203d        self.com =
-0006ebb0: 2063 6f6d 6d6f 6e0d 0a20 2020 2020 2020   common..       
-0006ebc0: 2073 656c 662e 6965 7620 3d20 300d 0a20   self.iev = 0.. 
-0006ebd0: 2020 2020 2020 2073 656c 662e 6974 6865         self.ithe
-0006ebe0: 7461 203d 2030 0d0a 2020 2020 2020 2020  ta = 0..        
-0006ebf0: 6966 2073 656c 662e 636f 6d2e 7374 6163  if self.com.stac
-0006ec00: 6b5f 6c6f 6164 6564 203d 3d20 313a 0d0a  k_loaded == 1:..
-0006ec10: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0006ec20: 656c 662e 636f 6d2e 7374 6163 6b5f 3464  elf.com.stack_4d
-0006ec30: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0006ec40: 2020 2073 656c 662e 7374 6163 6b2e 6162     self.stack.ab
-0006ec50: 7364 6174 6134 6420 3d20 7365 6c66 2e73  sdata4d = self.s
-0006ec60: 7461 636b 2e73 7461 636b 3444 2e63 6f70  tack.stack4D.cop
-0006ec70: 7928 290d 0a20 2020 2020 2020 2020 2020  y()..           
-0006ec80: 2020 2020 2023 7365 6c66 2e62 7574 746f       #self.butto
-0006ec90: 6e5f 616c 6967 6e62 6174 6368 2e73 6574  n_alignbatch.set
-0006eca0: 5669 7369 626c 6528 5472 7565 290d 0a20  Visible(True).. 
-0006ecb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0006ecc0: 656c 662e 6275 7474 6f6e 5f61 6c69 676e  elf.button_align
-0006ecd0: 2e73 6574 5465 7874 2822 416c 6967 6e20  .setText("Align 
-0006ece0: 4261 7463 6822 290d 0a20 2020 2020 2020  Batch")..       
-0006ecf0: 2020 2020 2020 2020 2073 656c 662e 7468           self.th
-0006ed00: 6574 6174 6872 6561 6420 3d20 5174 436f  etathread = QtCo
-0006ed10: 7265 2e51 5468 7265 6164 2829 0d0a 2020  re.QThread()..  
-0006ed20: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0006ed30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006ed40: 2073 656c 662e 7374 6163 6b2e 6162 7364   self.stack.absd
-0006ed50: 6174 6134 6420 3d20 6e70 2e65 7870 616e  ata4d = np.expan
-0006ed60: 645f 6469 6d73 2873 656c 662e 7374 6163  d_dims(self.stac
-0006ed70: 6b2e 6162 7364 6174 612e 636f 7079 2829  k.absdata.copy()
-0006ed80: 2c20 6178 6973 3d33 290d 0a20 2020 2020  , axis=3)..     
-0006ed90: 2020 2020 2020 2020 2020 2023 7365 6c66             #self
-0006eda0: 2e62 7574 746f 6e5f 616c 6967 6e62 6174  .button_alignbat
-0006edb0: 6368 2e73 6574 5669 7369 626c 6528 4661  ch.setVisible(Fa
-0006edc0: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
-0006edd0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
-0006ede0: 6e5f 616c 6967 6e2e 7365 7454 6578 7428  n_align.setText(
-0006edf0: 2241 6c69 676e 2229 0d0a 2020 2020 2020  "Align")..      
-0006ee00: 2020 2020 2020 7365 6c66 2e73 7461 636b        self.stack
-0006ee10: 2e61 6273 6461 7461 5f63 726f 7070 6564  .absdata_cropped
-0006ee20: 203d 2073 656c 662e 7374 6163 6b2e 6162   = self.stack.ab
-0006ee30: 7364 6174 6134 642e 636f 7079 2829 2023  sdata4d.copy() #
-0006ee40: 2054 6869 7320 696d 6167 6520 7374 6163   This image stac
-0006ee50: 6b20 6973 2075 7365 6420 6279 2074 6865  k is used by the
-0006ee60: 2061 6c69 676e 6d65 6e74 2f73 6869 6674   alignment/shift
-0006ee70: 2072 6f75 7469 6e65 2061 6e64 2063 726f   routine and cro
-0006ee80: 7070 6564 2074 6f20 7468 6520 524f 4920  pped to the ROI 
-0006ee90: 7265 6374 616e 676c 650d 0a20 2020 2020  rectangle..     
-0006eea0: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
-0006eeb0: 6b2e 6162 7364 6174 6134 645f 7368 6966  k.absdata4d_shif
-0006eec0: 7465 6420 3d20 7365 6c66 2e73 7461 636b  ted = self.stack
-0006eed0: 2e61 6273 6461 7461 3464 2e63 6f70 7928  .absdata4d.copy(
-0006eee0: 2920 2320 5468 6973 2069 7320 7468 6520  ) # This is the 
-0006eef0: 6675 6c6c 2d73 697a 6564 206f 7574 7075  full-sized outpu
-0006ef00: 7420 6f66 2074 6865 2061 6c69 676e 6d65  t of the alignme
-0006ef10: 6e74 2f73 6869 6674 2072 6f75 7469 6e65  nt/shift routine
-0006ef20: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0006ef30: 6c66 2e73 7461 636b 2e61 6273 6461 7461  lf.stack.absdata
-0006ef40: 3464 5f73 6869 6674 6564 5f63 726f 7070  4d_shifted_cropp
-0006ef50: 6564 203d 2073 656c 662e 7374 6163 6b2e  ed = self.stack.
-0006ef60: 6162 7364 6174 6134 642e 636f 7079 2829  absdata4d.copy()
-0006ef70: 2023 2054 6869 7320 6973 2074 6865 206f   # This is the o
-0006ef80: 7574 7075 7420 6372 6f70 7065 6420 746f  utput cropped to
-0006ef90: 2074 6865 2063 6f6d 6d6f 6e20 7265 6769   the common regi
-0006efa0: 6f6e 0d0a 2020 2020 2020 2020 2373 656c  on..        #sel
-0006efb0: 662e 7374 6163 6b2e 6162 7364 6174 615f  f.stack.absdata_
-0006efc0: 756e 616c 6967 6e65 6420 3d20 7365 6c66  unaligned = self
-0006efd0: 2e73 7461 636b 2e61 6273 6461 7461 5f73  .stack.absdata_s
-0006efe0: 6869 6674 6564 5f63 726f 7070 6564 0d0a  hifted_cropped..
-0006eff0: 2020 2020 2020 2020 7365 6c66 2e70 6f6f          self.poo
-0006f000: 6c74 6872 6561 6420 3d20 5174 436f 7265  lthread = QtCore
-0006f010: 2e51 5468 7265 6164 2829 0d0a 2020 2020  .QThread()..    
-0006f020: 2020 2020 7365 6c66 2e61 6c69 676e 6564      self.aligned
-0006f030: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-0006f040: 2020 7365 6c66 2e53 6574 7570 5549 2829    self.SetupUI()
-0006f050: 0d0a 0d0a 2020 2020 6465 6620 5365 7475  ....    def Setu
-0006f060: 7055 4928 7365 6c66 293a 0d0a 2020 2020  pUI(self):..    
-0006f070: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-0006f080: 6f6b 2e73 6574 456e 6162 6c65 6428 4661  ok.setEnabled(Fa
-0006f090: 6c73 6529 0d0a 2020 2020 2020 2020 7365  lse)..        se
-0006f0a0: 6c66 2e73 6c69 6465 725f 7468 6574 612e  lf.slider_theta.
-0006f0b0: 7365 7456 6973 6962 6c65 2846 616c 7365  setVisible(False
-0006f0c0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0006f0d0: 7365 7457 696e 646f 7754 6974 6c65 2827  setWindowTitle('
-0006f0e0: 416c 6967 6e20 5374 6163 6b20 7632 2729  Align Stack v2')
-0006f0f0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-0006f100: 676c 6179 6f75 7420 3d20 7067 2e47 7261  glayout = pg.Gra
-0006f110: 7068 6963 734c 6179 6f75 7428 626f 7264  phicsLayout(bord
-0006f120: 6572 3d4e 6f6e 6529 0d0a 2020 2020 2020  er=None)..      
-0006f130: 2020 7365 6c66 2e63 616e 7661 732e 7365    self.canvas.se
-0006f140: 7442 6163 6b67 726f 756e 6428 2277 2229  tBackground("w")
-0006f150: 2023 2063 616e 7661 7320 6973 2061 2070   # canvas is a p
-0006f160: 672e 4772 6170 6869 6373 5669 6577 2077  g.GraphicsView w
-0006f170: 6964 6765 740d 0a20 2020 2020 2020 2073  idget..        s
-0006f180: 656c 662e 6361 6e76 6173 2e73 6574 4365  elf.canvas.setCe
-0006f190: 6e74 7261 6c57 6964 6765 7428 7365 6c66  ntralWidget(self
-0006f1a0: 2e70 676c 6179 6f75 7429 0d0a 2020 2020  .pglayout)..    
-0006f1b0: 2020 2020 7365 6c66 2e76 6220 3d20 7365      self.vb = se
-0006f1c0: 6c66 2e70 676c 6179 6f75 742e 6164 6456  lf.pglayout.addV
-0006f1d0: 6965 7742 6f78 2829 0d0a 2020 2020 2020  iewBox()..      
-0006f1e0: 2020 7365 6c66 2e76 622e 7365 7441 7370    self.vb.setAsp
-0006f1f0: 6563 744c 6f63 6b65 6428 290d 0a20 2020  ectLocked()..   
-0006f200: 2020 2020 2073 656c 662e 695f 6974 656d       self.i_item
-0006f210: 203d 2070 672e 496d 6167 6549 7465 6d28   = pg.ImageItem(
-0006f220: 626f 7264 6572 3d22 6b22 2c70 6172 656e  border="k",paren
-0006f230: 743d 2073 656c 6629 0d0a 0d0a 2020 2020  t= self)....    
-0006f240: 2020 2020 7365 6c66 2e76 622e 7365 744d      self.vb.setM
-0006f250: 6f75 7365 456e 6162 6c65 6428 783d 4661  ouseEnabled(x=Fa
-0006f260: 6c73 652c 2079 3d46 616c 7365 290d 0a20  lse, y=False).. 
-0006f270: 2020 2020 2020 2073 656c 662e 7662 2e61         self.vb.a
-0006f280: 6464 4974 656d 2873 656c 662e 695f 6974  ddItem(self.i_it
-0006f290: 656d 2c20 6967 6e6f 7265 426f 756e 6473  em, ignoreBounds
-0006f2a0: 3d46 616c 7365 290d 0a0d 0a20 2020 2020  =False)....     
-0006f2b0: 2020 2073 656c 662e 4472 6966 7473 5769     self.DriftsWi
-0006f2c0: 6467 6574 2e73 6574 4261 636b 6772 6f75  dget.setBackgrou
-0006f2d0: 6e64 2822 7722 290d 0a0d 0a20 2020 2020  nd("w")....     
-0006f2e0: 2020 2073 656c 662e 7079 203d 2073 656c     self.py = sel
-0006f2f0: 662e 4472 6966 7473 5769 6467 6574 2e61  f.DriftsWidget.a
-0006f300: 6464 506c 6f74 2872 6f77 3d30 2c20 636f  ddPlot(row=0, co
-0006f310: 6c3d 302c 2072 6f77 7370 616e 3d31 2c20  l=0, rowspan=1, 
-0006f320: 636f 6c73 7061 6e3d 3129 0d0a 2020 2020  colspan=1)..    
-0006f330: 2020 2020 7365 6c66 2e70 792e 7365 744d      self.py.setM
-0006f340: 6f75 7365 456e 6162 6c65 6428 783d 4661  ouseEnabled(x=Fa
-0006f350: 6c73 652c 2079 3d54 7275 6529 0d0a 2020  lse, y=True)..  
-0006f360: 2020 2020 2020 2373 656c 662e 695f 6974        #self.i_it
-0006f370: 656d 203d 2070 672e 496d 6167 6549 7465  em = pg.ImageIte
-0006f380: 6d28 626f 7264 6572 3d22 6b22 290d 0a20  m(border="k").. 
-0006f390: 2020 2020 2020 2023 7365 6c66 2e70 792e         #self.py.
-0006f3a0: 7365 7441 7370 6563 744c 6f63 6b65 6428  setAspectLocked(
-0006f3b0: 6c6f 636b 3d54 7275 652c 2072 6174 696f  lock=True, ratio
-0006f3c0: 3d31 290d 0a20 2020 2020 2020 2073 656c  =1)..        sel
-0006f3d0: 662e 7079 2e73 686f 7741 7869 7328 2274  f.py.showAxis("t
-0006f3e0: 6f70 222c 2073 686f 773d 5472 7565 290d  op", show=True).
-0006f3f0: 0a20 2020 2020 2020 2073 656c 662e 7079  .        self.py
-0006f400: 2e73 686f 7741 7869 7328 2262 6f74 746f  .showAxis("botto
-0006f410: 6d22 2c20 7368 6f77 3d54 7275 6529 0d0a  m", show=True)..
-0006f420: 2020 2020 2020 2020 7365 6c66 2e70 792e          self.py.
-0006f430: 7368 6f77 4178 6973 2822 6c65 6674 222c  showAxis("left",
-0006f440: 2073 686f 773d 5472 7565 290d 0a20 2020   show=True)..   
-0006f450: 2020 2020 2073 656c 662e 7079 2e73 686f       self.py.sho
-0006f460: 7741 7869 7328 2272 6967 6874 222c 2073  wAxis("right", s
-0006f470: 686f 773d 5472 7565 290d 0a20 2020 2020  how=True)..     
-0006f480: 2020 2061 7931 203d 2073 656c 662e 7079     ay1 = self.py
-0006f490: 2e67 6574 4178 6973 2822 6c65 6674 2229  .getAxis("left")
-0006f4a0: 0d0a 2020 2020 2020 2020 6279 3120 3d20  ..        by1 = 
-0006f4b0: 7365 6c66 2e70 792e 6765 7441 7869 7328  self.py.getAxis(
-0006f4c0: 2272 6967 6874 2229 0d0a 2020 2020 2020  "right")..      
-0006f4d0: 2020 6178 3120 3d20 7365 6c66 2e70 792e    ax1 = self.py.
-0006f4e0: 6765 7441 7869 7328 2262 6f74 746f 6d22  getAxis("bottom"
-0006f4f0: 290d 0a20 2020 2020 2020 2062 7831 203d  )..        bx1 =
-0006f500: 2073 656c 662e 7079 2e67 6574 4178 6973   self.py.getAxis
-0006f510: 2822 746f 7022 290d 0a20 2020 2020 2020  ("top")..       
-0006f520: 2061 7931 2e73 6574 4c61 6265 6c28 7465   ay1.setLabel(te
-0006f530: 7874 3d22 792d 6472 6966 7422 2c20 756e  xt="y-drift", un
-0006f540: 6974 733d 2270 7822 290d 0a20 2020 2020  its="px")..     
-0006f550: 2020 2061 7931 2e65 6e61 626c 6541 7574     ay1.enableAut
-0006f560: 6f53 4950 7265 6669 7828 656e 6162 6c65  oSIPrefix(enable
-0006f570: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-0006f580: 6179 312e 7365 7457 6964 7468 2877 3d36  ay1.setWidth(w=6
-0006f590: 3029 0d0a 2020 2020 2020 2020 6178 312e  0)..        ax1.
-0006f5a0: 7365 744c 6162 656c 2874 6578 743d 2250  setLabel(text="P
-0006f5b0: 686f 746f 6e20 456e 6572 6779 222c 756e  hoton Energy",un
-0006f5c0: 6974 733d 2265 5622 290d 0a20 2020 2020  its="eV")..     
-0006f5d0: 2020 2061 7831 2e65 6e61 626c 6541 7574     ax1.enableAut
-0006f5e0: 6f53 4950 7265 6669 7828 656e 6162 6c65  oSIPrefix(enable
-0006f5f0: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-0006f600: 6179 312e 7365 7453 7479 6c65 2874 6963  ay1.setStyle(tic
-0006f610: 6b4c 656e 6774 683d 3829 0d0a 2020 2020  kLength=8)..    
-0006f620: 2020 2020 6178 312e 7365 7453 7479 6c65      ax1.setStyle
-0006f630: 2874 6963 6b4c 656e 6774 683d 3029 0d0a  (tickLength=0)..
-0006f640: 2020 2020 2020 2020 2361 7831 2e73 6574          #ax1.set
-0006f650: 4865 6967 6874 2868 3d34 362e 3229 0d0a  Height(h=46.2)..
-0006f660: 2020 2020 2020 2020 6178 312e 7365 7453          ax1.setS
-0006f670: 7479 6c65 2874 6963 6b4c 656e 6774 683d  tyle(tickLength=
-0006f680: 3829 0d0a 2020 2020 2020 2020 6279 312e  8)..        by1.
-0006f690: 7365 7453 7479 6c65 2873 686f 7756 616c  setStyle(showVal
-0006f6a0: 7565 733d 4661 6c73 652c 2074 6963 6b4c  ues=False, tickL
-0006f6b0: 656e 6774 683d 3029 0d0a 2020 2020 2020  ength=0)..      
-0006f6c0: 2020 6278 312e 7365 7453 7479 6c65 2873    bx1.setStyle(s
-0006f6d0: 686f 7756 616c 7565 733d 4661 6c73 652c  howValues=False,
-0006f6e0: 2074 6963 6b4c 656e 6774 683d 3029 0d0a   tickLength=0)..
-0006f6f0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-0006f700: 7820 3d20 7365 6c66 2e44 7269 6674 7357  x = self.DriftsW
-0006f710: 6964 6765 742e 6164 6450 6c6f 7428 726f  idget.addPlot(ro
-0006f720: 773d 312c 2063 6f6c 3d30 2c20 726f 7773  w=1, col=0, rows
-0006f730: 7061 6e3d 312c 2063 6f6c 7370 616e 3d31  pan=1, colspan=1
-0006f740: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0006f750: 7078 2e73 6574 584c 696e 6b28 7365 6c66  px.setXLink(self
-0006f760: 2e70 7929 0d0a 2020 2020 2020 2020 7365  .py)..        se
-0006f770: 6c66 2e70 782e 7365 744d 6f75 7365 456e  lf.px.setMouseEn
-0006f780: 6162 6c65 6428 783d 4661 6c73 652c 2079  abled(x=False, y
-0006f790: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-0006f7a0: 2373 656c 662e 695f 6974 656d 203d 2070  #self.i_item = p
-0006f7b0: 672e 496d 6167 6549 7465 6d28 626f 7264  g.ImageItem(bord
-0006f7c0: 6572 3d22 6b22 290d 0a20 2020 2020 2020  er="k")..       
-0006f7d0: 2023 7365 6c66 2e70 782e 7365 7441 7370   #self.px.setAsp
-0006f7e0: 6563 744c 6f63 6b65 6428 6c6f 636b 3d54  ectLocked(lock=T
-0006f7f0: 7275 652c 2072 6174 696f 3d31 290d 0a20  rue, ratio=1).. 
-0006f800: 2020 2020 2020 2073 656c 662e 7078 2e73         self.px.s
-0006f810: 686f 7741 7869 7328 2274 6f70 222c 2073  howAxis("top", s
-0006f820: 686f 773d 5472 7565 290d 0a20 2020 2020  how=True)..     
-0006f830: 2020 2073 656c 662e 7078 2e73 686f 7741     self.px.showA
-0006f840: 7869 7328 2262 6f74 746f 6d22 2c20 7368  xis("bottom", sh
-0006f850: 6f77 3d54 7275 6529 0d0a 2020 2020 2020  ow=True)..      
-0006f860: 2020 7365 6c66 2e70 782e 7368 6f77 4178    self.px.showAx
-0006f870: 6973 2822 6c65 6674 222c 2073 686f 773d  is("left", show=
-0006f880: 5472 7565 290d 0a20 2020 2020 2020 2073  True)..        s
-0006f890: 656c 662e 7078 2e73 686f 7741 7869 7328  elf.px.showAxis(
-0006f8a0: 2272 6967 6874 222c 2073 686f 773d 5472  "right", show=Tr
-0006f8b0: 7565 290d 0a20 2020 2020 2020 2061 7932  ue)..        ay2
-0006f8c0: 203d 2073 656c 662e 7078 2e67 6574 4178   = self.px.getAx
-0006f8d0: 6973 2822 6c65 6674 2229 0d0a 2020 2020  is("left")..    
-0006f8e0: 2020 2020 6279 3220 3d20 7365 6c66 2e70      by2 = self.p
-0006f8f0: 782e 6765 7441 7869 7328 2272 6967 6874  x.getAxis("right
-0006f900: 2229 0d0a 2020 2020 2020 2020 6178 3220  ")..        ax2 
-0006f910: 3d20 7365 6c66 2e70 782e 6765 7441 7869  = self.px.getAxi
-0006f920: 7328 2262 6f74 746f 6d22 290d 0a20 2020  s("bottom")..   
-0006f930: 2020 2020 2062 7832 203d 2073 656c 662e       bx2 = self.
-0006f940: 7078 2e67 6574 4178 6973 2822 746f 7022  px.getAxis("top"
-0006f950: 290d 0a20 2020 2020 2020 2061 7932 2e73  )..        ay2.s
-0006f960: 6574 4c61 6265 6c28 7465 7874 3d22 782d  etLabel(text="x-
-0006f970: 6472 6966 7422 2c75 6e69 7473 3d22 7078  drift",units="px
-0006f980: 2229 0d0a 2020 2020 2020 2020 6179 322e  ")..        ay2.
-0006f990: 656e 6162 6c65 4175 746f 5349 5072 6566  enableAutoSIPref
-0006f9a0: 6978 2865 6e61 626c 653d 5472 7565 290d  ix(enable=True).
-0006f9b0: 0a20 2020 2020 2020 2061 7932 2e73 6574  .        ay2.set
-0006f9c0: 5769 6474 6828 773d 3630 290d 0a20 2020  Width(w=60)..   
-0006f9d0: 2020 2020 2061 7832 2e73 6574 4c61 6265       ax2.setLabe
-0006f9e0: 6c28 7465 7874 3d22 5068 6f74 6f6e 2045  l(text="Photon E
-0006f9f0: 6e65 7267 7922 2c75 6e69 7473 3d22 6556  nergy",units="eV
-0006fa00: 2229 0d0a 2020 2020 2020 2020 6178 322e  ")..        ax2.
-0006fa10: 656e 6162 6c65 4175 746f 5349 5072 6566  enableAutoSIPref
-0006fa20: 6978 2865 6e61 626c 653d 5472 7565 290d  ix(enable=True).
-0006fa30: 0a20 2020 2020 2020 2061 7932 2e73 6574  .        ay2.set
-0006fa40: 5374 796c 6528 7469 636b 4c65 6e67 7468  Style(tickLength
-0006fa50: 3d38 290d 0a20 2020 2020 2020 2061 7832  =8)..        ax2
-0006fa60: 2e73 6574 5374 796c 6528 7469 636b 4c65  .setStyle(tickLe
-0006fa70: 6e67 7468 3d38 290d 0a20 2020 2020 2020  ngth=8)..       
-0006fa80: 2062 7932 2e73 6574 5374 796c 6528 7368   by2.setStyle(sh
-0006fa90: 6f77 5661 6c75 6573 3d46 616c 7365 2c74  owValues=False,t
-0006faa0: 6963 6b4c 656e 6774 683d 3029 0d0a 2020  ickLength=0)..  
-0006fab0: 2020 2020 2020 6278 322e 7365 7453 7479        bx2.setSty
-0006fac0: 6c65 2873 686f 7756 616c 7565 733d 4661  le(showValues=Fa
-0006fad0: 6c73 652c 7469 636b 4c65 6e67 7468 3d30  lse,tickLength=0
-0006fae0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-0006faf0: 662e 6275 7474 6f6e 5f6f 6b2e 636c 6963  f.button_ok.clic
-0006fb00: 6b65 642e 636f 6e6e 6563 7428 7365 6c66  ked.connect(self
-0006fb10: 2e4f 6e41 6363 6570 7429 0d0a 2020 2020  .OnAccept)..    
-0006fb20: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-0006fb30: 6361 6e63 656c 2e63 6c69 636b 6564 2e63  cancel.clicked.c
-0006fb40: 6f6e 6e65 6374 2873 656c 662e 4f6e 4361  onnect(self.OnCa
-0006fb50: 6e63 656c 290d 0a0d 0a20 2020 2020 2020  ncel)....       
-0006fb60: 2069 6620 7365 6c66 2e63 6f6d 2e73 7461   if self.com.sta
-0006fb70: 636b 5f6c 6f61 6465 6420 3d3d 2031 3a0d  ck_loaded == 1:.
-0006fb80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0006fb90: 7365 6c66 2e63 6f6d 2e73 7461 636b 5f34  self.com.stack_4
-0006fba0: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-0006fbb0: 2020 2020 7365 6c66 2e73 6c69 6465 725f      self.slider_
-0006fbc0: 7468 6574 612e 7365 7456 6973 6962 6c65  theta.setVisible
-0006fbd0: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
-0006fbe0: 2020 2020 2020 2020 7365 6c66 2e73 6c69          self.sli
-0006fbf0: 6465 725f 7468 6574 612e 7365 7452 616e  der_theta.setRan
-0006fc00: 6765 2830 2c20 7365 6c66 2e73 7461 636b  ge(0, self.stack
-0006fc10: 2e6e 5f74 6865 7461 202d 2031 290d 0a20  .n_theta - 1).. 
-0006fc20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0006fc30: 656c 662e 736c 6964 6572 5f74 6865 7461  elf.slider_theta
-0006fc40: 2e76 616c 7565 4368 616e 6765 645b 696e  .valueChanged[in
-0006fc50: 745d 2e63 6f6e 6e65 6374 2873 656c 662e  t].connect(self.
-0006fc60: 4f6e 5363 726f 6c6c 5468 6574 6129 0d0a  OnScrollTheta)..
-0006fc70: 2020 2020 2020 2020 2020 2020 2373 656c              #sel
-0006fc80: 662e 6d61 736b 6564 7661 6c73 203d 205b  f.maskedvals = [
-0006fc90: 5472 7565 5d20 2a20 696e 7428 7365 6c66  True] * int(self
-0006fca0: 2e73 7461 636b 2e6e 5f65 7629 0d0a 2020  .stack.n_ev)..  
-0006fcb0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-0006fcc0: 7069 6e42 6f78 4572 726f 722e 7365 7445  pinBoxError.setE
-0006fcd0: 6e61 626c 6564 2846 616c 7365 290d 0a20  nabled(False).. 
-0006fce0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0006fcf0: 736c 6964 6572 5f65 6e67 2e73 6c69 6465  slider_eng.slide
-0006fd00: 7250 7265 7373 6564 2e63 6f6e 6e65 6374  rPressed.connect
-0006fd10: 2873 656c 662e 5368 6f77 496d 6167 6529  (self.ShowImage)
-0006fd20: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0006fd30: 6c66 2e73 6c69 6465 725f 656e 672e 736c  lf.slider_eng.sl
-0006fd40: 6964 6572 5265 6c65 6173 6564 2e63 6f6e  iderReleased.con
-0006fd50: 6e65 6374 2873 656c 662e 5368 6f77 496d  nect(self.ShowIm
-0006fd60: 6167 6529 0d0a 2020 2020 2020 2020 2020  age)..          
-0006fd70: 2020 7365 6c66 2e73 6c69 6465 725f 656e    self.slider_en
-0006fd80: 672e 7661 6c75 6543 6861 6e67 6564 5b69  g.valueChanged[i
-0006fd90: 6e74 5d2e 636f 6e6e 6563 7428 7365 6c66  nt].connect(self
-0006fda0: 2e4f 6e53 6372 6f6c 6c45 6e67 290d 0a20  .OnScrollEng).. 
-0006fdb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0006fdc0: 736c 6964 6572 5f65 6e67 2e73 6574 5261  slider_eng.setRa
-0006fdd0: 6e67 6528 302c 2073 656c 662e 7374 6163  nge(0, self.stac
-0006fde0: 6b2e 6e5f 6576 202d 2031 290d 0a20 2020  k.n_ev - 1)..   
-0006fdf0: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
-0006fe00: 666d 6172 6b65 7278 203d 2070 672e 496e  fmarkerx = pg.In
-0006fe10: 6669 6e69 7465 4c69 6e65 2861 6e67 6c65  finiteLine(angle
-0006fe20: 3d39 302c 206d 6f76 6162 6c65 3d46 616c  =90, movable=Fal
-0006fe30: 7365 2c20 7065 6e3d 7067 2e6d 6b50 656e  se, pen=pg.mkPen
-0006fe40: 2863 6f6c 6f72 3d22 6222 2c20 7769 6474  (color="b", widt
-0006fe50: 683d 322c 2073 7479 6c65 3d51 7443 6f72  h=2, style=QtCor
-0006fe60: 652e 5174 2e44 6173 684c 696e 6529 290d  e.Qt.DashLine)).
-0006fe70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0006fe80: 662e 7265 666d 6172 6b65 7279 203d 2070  f.refmarkery = p
-0006fe90: 672e 496e 6669 6e69 7465 4c69 6e65 2861  g.InfiniteLine(a
-0006fea0: 6e67 6c65 3d39 302c 206d 6f76 6162 6c65  ngle=90, movable
-0006feb0: 3d46 616c 7365 2c20 7065 6e3d 7067 2e6d  =False, pen=pg.m
-0006fec0: 6b50 656e 2863 6f6c 6f72 3d22 6222 2c20  kPen(color="b", 
-0006fed0: 7769 6474 683d 322c 2073 7479 6c65 3d51  width=2, style=Q
-0006fee0: 7443 6f72 652e 5174 2e44 6173 684c 696e  tCore.Qt.DashLin
-0006fef0: 6529 290d 0a20 2020 2020 2020 2020 2020  e))..           
-0006ff00: 2073 656c 662e 7078 2e61 6464 4974 656d   self.px.addItem
-0006ff10: 2873 656c 662e 7265 666d 6172 6b65 7278  (self.refmarkerx
-0006ff20: 2c20 6967 6e6f 7265 426f 756e 6473 3d54  , ignoreBounds=T
-0006ff30: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
-0006ff40: 2020 7365 6c66 2e70 792e 6164 6449 7465    self.py.addIte
-0006ff50: 6d28 7365 6c66 2e72 6566 6d61 726b 6572  m(self.refmarker
-0006ff60: 792c 2069 676e 6f72 6542 6f75 6e64 733d  y, ignoreBounds=
-0006ff70: 5472 7565 290d 0a0d 0a20 2020 2020 2020  True)....       
-0006ff80: 2020 2020 2073 656c 662e 6669 745f 7820       self.fit_x 
-0006ff90: 3d20 7067 2e50 6c6f 7443 7572 7665 4974  = pg.PlotCurveIt
-0006ffa0: 656d 2870 656e 3d70 672e 6d6b 5065 6e28  em(pen=pg.mkPen(
-0006ffb0: 636f 6c6f 723d 2263 222c 2077 6964 7468  color="c", width
-0006ffc0: 3d32 2929 0d0a 2020 2020 2020 2020 2020  =2))..          
-0006ffd0: 2020 7365 6c66 2e66 6974 5f79 203d 2070    self.fit_y = p
-0006ffe0: 672e 506c 6f74 4375 7276 6549 7465 6d28  g.PlotCurveItem(
-0006fff0: 7065 6e3d 7067 2e6d 6b50 656e 2863 6f6c  pen=pg.mkPen(col
-00070000: 6f72 3d22 6322 2c20 7769 6474 683d 3229  or="c", width=2)
-00070010: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00070020: 656c 662e 6669 745f 782e 7365 745a 5661  elf.fit_x.setZVa
-00070030: 6c75 6528 3230 3029 0d0a 2020 2020 2020  lue(200)..      
-00070040: 2020 2020 2020 7365 6c66 2e66 6974 5f79        self.fit_y
-00070050: 2e73 6574 5a56 616c 7565 2832 3030 290d  .setZValue(200).
-00070060: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00070070: 662e 7078 2e61 6464 4974 656d 2873 656c  f.px.addItem(sel
-00070080: 662e 6669 745f 782c 2069 676e 6f72 6542  f.fit_x, ignoreB
-00070090: 6f75 6e64 733d 5472 7565 290d 0a20 2020  ounds=True)..   
-000700a0: 2020 2020 2020 2020 2073 656c 662e 7079           self.py
-000700b0: 2e61 6464 4974 656d 2873 656c 662e 6669  .addItem(self.fi
-000700c0: 745f 792c 2069 676e 6f72 6542 6f75 6e64  t_y, ignoreBound
-000700d0: 733d 5472 7565 290d 0a0d 0a20 2020 2020  s=True)....     
-000700e0: 2020 2020 2020 2073 656c 662e 4f6e 5363         self.OnSc
-000700f0: 726f 6c6c 456e 6728 3029 0d0a 2020 2020  rollEng(0)..    
-00070100: 2020 2020 2020 2020 7365 6c66 2e53 6574          self.Set
-00070110: 7570 524f 4928 290d 0a20 2020 2020 2020  upROI()..       
-00070120: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-00070130: 5f61 6c69 676e 2e63 6c69 636b 6564 2e63  _align.clicked.c
-00070140: 6f6e 6e65 6374 2873 656c 662e 436f 6d70  onnect(self.Comp
-00070150: 6f73 6541 6c69 676e 5175 6575 6529 0d0a  oseAlignQueue)..
-00070160: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00070170: 2e78 7265 6769 6f6e 203d 2070 672e 4c69  .xregion = pg.Li
-00070180: 6e65 6172 5265 6769 6f6e 4974 656d 2862  nearRegionItem(b
-00070190: 7275 7368 3d5b 3235 352c 2030 2c20 302c  rush=[255, 0, 0,
-000701a0: 2034 355d 2c20 626f 756e 6473 3d5b 7365   45], bounds=[se
-000701b0: 6c66 2e73 7461 636b 2e65 765b 305d 2c20  lf.stack.ev[0], 
-000701c0: 7365 6c66 2e73 7461 636b 2e65 765b 2d31  self.stack.ev[-1
-000701d0: 5d5d 290d 0a20 2020 2020 2020 2020 2020  ]])..           
-000701e0: 2073 656c 662e 7972 6567 696f 6e20 3d20   self.yregion = 
-000701f0: 7067 2e4c 696e 6561 7252 6567 696f 6e49  pg.LinearRegionI
-00070200: 7465 6d28 6272 7573 683d 5b32 3535 2c20  tem(brush=[255, 
-00070210: 302c 2030 2c20 3435 5d2c 2062 6f75 6e64  0, 0, 45], bound
-00070220: 733d 5b73 656c 662e 7374 6163 6b2e 6576  s=[self.stack.ev
-00070230: 5b30 5d2c 2073 656c 662e 7374 6163 6b2e  [0], self.stack.
-00070240: 6576 5b2d 315d 5d29 0d0a 2020 2020 2020  ev[-1]])..      
-00070250: 2020 2020 2020 7365 6c66 2e78 7265 6769        self.xregi
-00070260: 6f6e 2e73 6574 5265 6769 6f6e 285b 7365  on.setRegion([se
-00070270: 6c66 2e73 7461 636b 2e65 765b 305d 2c20  lf.stack.ev[0], 
-00070280: 7365 6c66 2e73 7461 636b 2e65 765b 2d31  self.stack.ev[-1
-00070290: 5d5d 290d 0a20 2020 2020 2020 2020 2020  ]])..           
-000702a0: 2073 656c 662e 7972 6567 696f 6e2e 7365   self.yregion.se
-000702b0: 7452 6567 696f 6e28 5b73 656c 662e 7374  tRegion([self.st
-000702c0: 6163 6b2e 6576 5b30 5d2c 2073 656c 662e  ack.ev[0], self.
-000702d0: 7374 6163 6b2e 6576 5b2d 315d 5d29 0d0a  stack.ev[-1]])..
-000702e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000702f0: 2e79 7265 6769 6f6e 2e73 6574 5a56 616c  .yregion.setZVal
-00070300: 7565 2831 3030 290d 0a20 2020 2020 2020  ue(100)..       
-00070310: 2020 2020 2073 656c 662e 7872 6567 696f       self.xregio
-00070320: 6e2e 7365 745a 5661 6c75 6528 3130 3029  n.setZValue(100)
+0006cba0: 2020 2073 656c 662e 7873 6869 6674 735b     self.xshifts[
+0006cbb0: 695d 2c0d 0a20 2020 2020 2020 2020 2020  i],..           
+0006cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006cbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006cbf0: 2020 2020 2020 2073 656c 662e 7973 6869         self.yshi
+0006cc00: 6674 735b 695d 290d 0a20 2020 2020 2020  fts[i])..       
+0006cc10: 2020 2020 2020 2020 2073 656c 662e 616c           self.al
+0006cc20: 6967 6e65 645f 7374 6163 6b5b 3a2c 3a2c  igned_stack[:,:,
+0006cc30: 695d 203d 2073 6869 6674 6564 5f69 6d67  i] = shifted_img
+0006cc40: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7365  ......        se
+0006cc50: 6c66 2e72 6567 6973 745f 6361 6c63 756c  lf.regist_calcul
+0006cc60: 6174 6564 203d 2031 0d0a 2020 2020 2020  ated = 1..      
+0006cc70: 2020 7365 6c66 2e69 6576 203d 2030 0d0a    self.iev = 0..
+0006cc80: 2020 2020 2020 2020 7365 6c66 2e53 686f          self.Sho
+0006cc90: 7749 6d61 6765 2829 0d0a 2020 2020 2020  wImage()..      
+0006cca0: 2020 7365 6c66 2e73 6c69 6465 725f 656e    self.slider_en
+0006ccb0: 672e 7365 7456 616c 7565 2873 656c 662e  g.setValue(self.
+0006ccc0: 6965 7629 0d0a 0d0a 2020 2020 2020 2020  iev)....        
+0006ccd0: 7365 6c66 2e72 6567 6973 745f 6361 6c63  self.regist_calc
+0006cce0: 756c 6174 6564 203d 2031 0d0a 2020 2020  ulated = 1..    
+0006ccf0: 2020 2020 7365 6c66 2e6d 616e 5f61 6c69      self.man_ali
+0006cd00: 676e 203d 2030 0d0a 0d0a 2020 2020 2020  gn = 0....      
+0006cd10: 2020 7365 6c66 2e74 6578 7463 7472 6c5f    self.textctrl_
+0006cd20: 6d73 312e 7365 7454 6578 7428 2758 206d  ms1.setText('X m
+0006cd30: 616e 7561 6c20 7368 6966 743a 205c 6e27  anual shift: \n'
+0006cd40: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0006cd50: 7465 7874 6374 726c 5f6d 7332 2e73 6574  textctrl_ms2.set
+0006cd60: 5465 7874 2827 5920 6d61 6e75 616c 2073  Text('Y manual s
+0006cd70: 6869 6674 3a20 2729 0d0a 0d0a 2020 2020  hift: ')....    
+0006cd80: 2020 2020 7365 6c66 2e55 7064 6174 6557      self.UpdateW
+0006cd90: 6964 6765 7473 2829 0d0a 0d0a 2020 2020  idgets()....    
+0006cda0: 2020 2020 6d69 6e5f 7873 6869 6674 203d      min_xshift =
+0006cdb0: 206e 702e 6d69 6e28 7365 6c66 2e78 7368   np.min(self.xsh
+0006cdc0: 6966 7473 290d 0a20 2020 2020 2020 206d  ifts)..        m
+0006cdd0: 6178 5f78 7368 6966 7420 3d20 6e70 2e6d  ax_xshift = np.m
+0006cde0: 6178 2873 656c 662e 7873 6869 6674 7329  ax(self.xshifts)
+0006cdf0: 0d0a 0d0a 2020 2020 2020 2020 6d69 6e5f  ....        min_
+0006ce00: 7973 6869 6674 203d 206e 702e 6d69 6e28  yshift = np.min(
+0006ce10: 7365 6c66 2e79 7368 6966 7473 290d 0a20  self.yshifts).. 
+0006ce20: 2020 2020 2020 206d 6178 5f79 7368 6966         max_yshif
+0006ce30: 7420 3d20 6e70 2e6d 6178 2873 656c 662e  t = np.max(self.
+0006ce40: 7973 6869 6674 7329 0d0a 0d0a 2020 2020  yshifts)....    
+0006ce50: 2020 2020 6966 206d 696e 5f78 7368 6966      if min_xshif
+0006ce60: 7420 3c20 7365 6c66 2e6d 696e 7873 203a  t < self.minxs :
+0006ce70: 2073 656c 662e 6d69 6e78 7320 3d20 6d69   self.minxs = mi
+0006ce80: 6e5f 7873 6869 6674 0d0a 2020 2020 2020  n_xshift..      
+0006ce90: 2020 6966 206d 6178 5f78 7368 6966 7420    if max_xshift 
+0006cea0: 3e20 7365 6c66 2e6d 6178 7873 203a 2073  > self.maxxs : s
+0006ceb0: 656c 662e 6d61 7878 7320 3d20 6d61 785f  elf.maxxs = max_
+0006cec0: 7873 6869 6674 0d0a 0d0a 2020 2020 2020  xshift....      
+0006ced0: 2020 6966 206d 696e 5f79 7368 6966 7420    if min_yshift 
+0006cee0: 3c20 7365 6c66 2e6d 696e 7973 203a 2073  < self.minys : s
+0006cef0: 656c 662e 6d69 6e79 7320 3d20 6d69 6e5f  elf.minys = min_
+0006cf00: 7973 6869 6674 0d0a 2020 2020 2020 2020  yshift..        
+0006cf10: 6966 206d 6178 5f79 7368 6966 7420 3e20  if max_yshift > 
+0006cf20: 7365 6c66 2e6d 6178 7973 203a 2073 656c  self.maxys : sel
+0006cf30: 662e 6d61 7879 7320 3d20 6d61 785f 7973  f.maxys = max_ys
+0006cf40: 6869 6674 0d0a 0d0a 0d0a 232d 2d2d 2d2d  hift......#-----
+0006cf50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006cf60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006cf70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006cf80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006cf90: 2d0d 0a20 2020 2064 6566 2055 7064 6174  -..    def Updat
+0006cfa0: 6557 6964 6765 7473 2873 656c 6629 3a0d  eWidgets(self):.
+0006cfb0: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
+0006cfc0: 6c66 2e61 7574 6f3a 0d0a 2020 2020 2020  lf.auto:..      
+0006cfd0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+0006cfe0: 6e5f 6d61 6e61 6c69 676e 2e73 6574 456e  n_manalign.setEn
+0006cff0: 6162 6c65 6428 4661 6c73 6529 0d0a 2020  abled(False)..  
+0006d000: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+0006d010: 662e 6861 7665 5f72 6566 5f69 6d61 6765  f.have_ref_image
+0006d020: 203d 3d20 313a 0d0a 2020 2020 2020 2020   == 1:..        
+0006d030: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
+0006d040: 746f 6e5f 7265 6769 7374 6572 2e73 6574  ton_register.set
+0006d050: 456e 6162 6c65 6428 5472 7565 290d 0a20  Enabled(True).. 
+0006d060: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0006d070: 656c 662e 6275 7474 6f6e 5f73 7562 7265  elf.button_subre
+0006d080: 6769 6f6e 2e73 6574 456e 6162 6c65 6428  gion.setEnabled(
+0006d090: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
+0006d0a0: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
+0006d0b0: 6f6e 5f72 6566 696d 6773 6176 652e 7365  on_refimgsave.se
+0006d0c0: 7445 6e61 626c 6564 2854 7275 6529 0d0a  tEnabled(True)..
+0006d0d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0006d0e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0006d0f0: 2020 2073 656c 662e 6275 7474 6f6e 5f72     self.button_r
+0006d100: 6567 6973 7465 722e 7365 7445 6e61 626c  egister.setEnabl
+0006d110: 6564 2846 616c 7365 290d 0a20 2020 2020  ed(False)..     
+0006d120: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0006d130: 6275 7474 6f6e 5f73 7562 7265 6769 6f6e  button_subregion
+0006d140: 2e73 6574 456e 6162 6c65 6428 4661 6c73  .setEnabled(Fals
+0006d150: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0006d160: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+0006d170: 7265 6669 6d67 7361 7665 2e73 6574 456e  refimgsave.setEn
+0006d180: 6162 6c65 6428 4661 6c73 6529 0d0a 2020  abled(False)..  
+0006d190: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0006d1a0: 6c66 2e62 7574 746f 6e5f 6465 6c73 7562  lf.button_delsub
+0006d1b0: 7265 6769 6f6e 2e73 6574 456e 6162 6c65  region.setEnable
+0006d1c0: 6428 4661 6c73 6529 0d0a 0d0a 2020 2020  d(False)....    
+0006d1d0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0006d1e0: 7265 6769 7374 5f63 616c 6375 6c61 7465  regist_calculate
+0006d1f0: 6420 3d3d 2031 3a0d 0a20 2020 2020 2020  d == 1:..       
+0006d200: 2020 2020 2020 2020 2073 656c 662e 6275           self.bu
+0006d210: 7474 6f6e 5f63 726f 702e 7365 7445 6e61  tton_crop.setEna
+0006d220: 626c 6564 2854 7275 6529 0d0a 2020 2020  bled(True)..    
+0006d230: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0006d240: 2e62 7574 746f 6e5f 6163 6365 7074 2e73  .button_accept.s
+0006d250: 6574 456e 6162 6c65 6428 5472 7565 290d  etEnabled(True).
+0006d260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006d270: 2073 656c 662e 6275 7474 6f6e 5f73 6176   self.button_sav
+0006d280: 6573 6869 6674 732e 7365 7445 6e61 626c  eshifts.setEnabl
+0006d290: 6564 2854 7275 6529 0d0a 2020 2020 2020  ed(True)..      
+0006d2a0: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
+0006d2b0: 7574 746f 6e5f 7361 7665 696d 672e 7365  utton_saveimg.se
+0006d2c0: 7445 6e61 626c 6564 2854 7275 6529 0d0a  tEnabled(True)..
+0006d2d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0006d2e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0006d2f0: 2020 2073 656c 662e 6275 7474 6f6e 5f63     self.button_c
+0006d300: 726f 702e 7365 7445 6e61 626c 6564 2846  rop.setEnabled(F
+0006d310: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
+0006d320: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
+0006d330: 6f6e 5f61 6363 6570 742e 7365 7445 6e61  on_accept.setEna
+0006d340: 626c 6564 2846 616c 7365 290d 0a20 2020  bled(False)..   
+0006d350: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0006d360: 662e 6275 7474 6f6e 5f73 6176 6573 6869  f.button_saveshi
+0006d370: 6674 732e 7365 7445 6e61 626c 6564 2846  fts.setEnabled(F
+0006d380: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
+0006d390: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
+0006d3a0: 6f6e 5f73 6176 6569 6d67 2e73 6574 456e  on_saveimg.setEn
+0006d3b0: 6162 6c65 6428 4661 6c73 6529 0d0a 0d0a  abled(False)....
+0006d3c0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0006d3d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0006d3e0: 6275 7474 6f6e 5f72 6567 6973 7465 722e  button_register.
+0006d3f0: 7365 7445 6e61 626c 6564 2846 616c 7365  setEnabled(False
+0006d400: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0006d410: 656c 662e 6275 7474 6f6e 5f64 656c 7375  elf.button_delsu
+0006d420: 6272 6567 696f 6e2e 7365 7445 6e61 626c  bregion.setEnabl
+0006d430: 6564 2846 616c 7365 290d 0a20 2020 2020  ed(False)..     
+0006d440: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
+0006d450: 6f6e 5f73 7562 7265 6769 6f6e 2e73 6574  on_subregion.set
+0006d460: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
+0006d470: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0006d480: 2073 656c 662e 6861 7665 5f72 6566 5f69   self.have_ref_i
+0006d490: 6d61 6765 203d 3d20 313a 0d0a 2020 2020  mage == 1:..    
+0006d4a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0006d4b0: 2e62 7574 746f 6e5f 6d61 6e61 6c69 676e  .button_manalign
+0006d4c0: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
+0006d4d0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0006d4e0: 2020 2073 656c 662e 6275 7474 6f6e 5f72     self.button_r
+0006d4f0: 6566 696d 6773 6176 652e 7365 7445 6e61  efimgsave.setEna
+0006d500: 626c 6564 2854 7275 6529 0d0a 2020 2020  bled(True)..    
+0006d510: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0006d520: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0006d530: 656c 662e 6275 7474 6f6e 5f6d 616e 616c  elf.button_manal
+0006d540: 6967 6e2e 7365 7445 6e61 626c 6564 2846  ign.setEnabled(F
+0006d550: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
+0006d560: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
+0006d570: 6f6e 5f72 6566 696d 6773 6176 652e 7365  on_refimgsave.se
+0006d580: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
+0006d590: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+0006d5a0: 6620 7365 6c66 2e72 6567 6973 745f 6361  f self.regist_ca
+0006d5b0: 6c63 756c 6174 6564 203d 3d20 313a 0d0a  lculated == 1:..
+0006d5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d5d0: 7365 6c66 2e62 7574 746f 6e5f 6372 6f70  self.button_crop
+0006d5e0: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
+0006d5f0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0006d600: 2020 2073 656c 662e 6275 7474 6f6e 5f61     self.button_a
+0006d610: 6363 6570 742e 7365 7445 6e61 626c 6564  ccept.setEnabled
+0006d620: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
+0006d630: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
+0006d640: 746f 6e5f 7361 7665 7368 6966 7473 2e73  ton_saveshifts.s
+0006d650: 6574 456e 6162 6c65 6428 5472 7565 290d  etEnabled(True).
+0006d660: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0006d670: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0006d680: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+0006d690: 6372 6f70 2e73 6574 456e 6162 6c65 6428  crop.setEnabled(
+0006d6a0: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
+0006d6b0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
+0006d6c0: 746f 6e5f 6163 6365 7074 2e73 6574 456e  ton_accept.setEn
+0006d6d0: 6162 6c65 6428 4661 6c73 6529 0d0a 2020  abled(False)..  
+0006d6e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0006d6f0: 6c66 2e62 7574 746f 6e5f 7361 7665 7368  lf.button_savesh
+0006d700: 6966 7473 2e73 6574 456e 6162 6c65 6428  ifts.setEnabled(
+0006d710: 4661 6c73 6529 0d0a 0d0a 2020 2020 2020  False)....      
+0006d720: 2020 2020 2020 6966 2073 656c 662e 6d61        if self.ma
+0006d730: 6e5f 616c 6967 6e20 3d3d 2030 3a0d 0a20  n_align == 0:.. 
+0006d740: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0006d750: 656c 662e 6275 7474 6f6e 5f70 6963 6b32  elf.button_pick2
+0006d760: 6e64 706f 696e 742e 7365 7445 6e61 626c  ndpoint.setEnabl
+0006d770: 6564 2846 616c 7365 290d 0a20 2020 2020  ed(False)..     
+0006d780: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0006d790: 6275 7474 6f6e 5f61 7070 6c79 6d61 6e2e  button_applyman.
+0006d7a0: 7365 7445 6e61 626c 6564 2846 616c 7365  setEnabled(False
+0006d7b0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+0006d7c0: 6c69 6620 7365 6c66 2e6d 616e 5f61 6c69  lif self.man_ali
+0006d7d0: 676e 203d 3d20 313a 0d0a 2020 2020 2020  gn == 1:..      
+0006d7e0: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
+0006d7f0: 7574 746f 6e5f 7069 636b 326e 6470 6f69  utton_pick2ndpoi
+0006d800: 6e74 2e73 6574 456e 6162 6c65 6428 5472  nt.setEnabled(Tr
+0006d810: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
+0006d820: 2065 6c69 6620 7365 6c66 2e6d 616e 5f61   elif self.man_a
+0006d830: 6c69 676e 203d 3d20 323a 0d0a 2020 2020  lign == 2:..    
+0006d840: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0006d850: 2e62 7574 746f 6e5f 6170 706c 796d 616e  .button_applyman
+0006d860: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
+0006d870: 290d 0a0d 0a63 6c61 7373 2047 656e 6572  )....class Gener
+0006d880: 616c 5075 7270 6f73 6553 6967 6e61 6c73  alPurposeSignals
+0006d890: 2851 7443 6f72 652e 514f 626a 6563 7429  (QtCore.QObject)
+0006d8a0: 3a0d 0a20 2020 2066 696e 6973 6865 6420  :..    finished 
+0006d8b0: 3d20 7079 7174 5369 676e 616c 2829 0d0a  = pyqtSignal()..
+0006d8c0: 2020 2020 6974 6865 7461 7072 6f67 7265      ithetaprogre
+0006d8d0: 7373 203d 2070 7971 7453 6967 6e61 6c28  ss = pyqtSignal(
+0006d8e0: 696e 7429 0d0a 2320 2d2d 2d2d 2d2d 2d2d  int)..# --------
+0006d8f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006d900: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006d910: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0006d920: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a  --------------..
+0006d930: 636c 6173 7320 4765 6e65 7261 6c50 7572  class GeneralPur
+0006d940: 706f 7365 5072 6f63 6573 736f 7228 5174  poseProcessor(Qt
+0006d950: 436f 7265 2e51 5275 6e6e 6162 6c65 293a  Core.QRunnable):
+0006d960: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+0006d970: 5f5f 2873 656c 662c 2070 6172 656e 742c  __(self, parent,
+0006d980: 2071 7565 7565 293a 0d0a 2020 2020 2020   queue):..      
+0006d990: 2020 7375 7065 7228 4765 6e65 7261 6c50    super(GeneralP
+0006d9a0: 7572 706f 7365 5072 6f63 6573 736f 722c  urposeProcessor,
+0006d9b0: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
+0006d9c0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0006d9d0: 7369 676e 616c 7320 3d20 4765 6e65 7261  signals = Genera
+0006d9e0: 6c50 7572 706f 7365 5369 676e 616c 7328  lPurposeSignals(
+0006d9f0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0006da00: 6675 6e63 6469 6374 203d 207b 2253 6869  funcdict = {"Shi
+0006da10: 6674 496d 6722 3a20 7365 6c66 2e53 6869  ftImg": self.Shi
+0006da20: 6674 496d 672c 2022 416c 6967 6e52 6566  ftImg, "AlignRef
+0006da30: 6572 656e 6365 6422 3a20 7365 6c66 2e41  erenced": self.A
+0006da40: 6c69 676e 5265 6665 7265 6e63 6564 7d0d  lignReferenced}.
+0006da50: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+0006da60: 7265 6e74 203d 2070 6172 656e 740d 0a20  rent = parent.. 
+0006da70: 2020 2020 2020 2073 656c 662e 7175 6575         self.queu
+0006da80: 6520 3d20 7175 6575 650d 0a20 2020 2020  e = queue..     
+0006da90: 2020 2073 656c 662e 6375 7272 656e 745f     self.current_
+0006daa0: 6974 6865 7461 203d 2030 0d0a 0d0a 2020  itheta = 0....  
+0006dab0: 2020 4070 7971 7453 6c6f 7428 290d 0a20    @pyqtSlot().. 
+0006dac0: 2020 2064 6566 2072 756e 2873 656c 6629     def run(self)
+0006dad0: 3a0d 0a20 2020 2020 2020 2023 7072 696e  :..        #prin
+0006dae0: 7428 2777 6f72 6b65 7227 2c20 7468 7265  t('worker', thre
+0006daf0: 6164 696e 672e 6765 745f 6964 656e 7428  ading.get_ident(
+0006db00: 2929 0d0a 2020 2020 2020 2020 7768 696c  ))..        whil
+0006db10: 6520 5472 7565 3a0d 0a20 2020 2020 2020  e True:..       
+0006db20: 2020 2020 2023 7072 696e 7428 7365 6c66       #print(self
+0006db30: 2e70 6172 656e 742e 706f 6f6c 2e70 6f6f  .parent.pool.poo
+0006db40: 6c2e 6163 7469 7665 5468 7265 6164 436f  l.activeThreadCo
+0006db50: 756e 7428 2929 0d0a 2020 2020 2020 2020  unt())..        
+0006db60: 2020 2020 2370 7269 6e74 2851 7443 6f72      #print(QtCor
+0006db70: 652e 5154 6872 6561 6450 6f6f 6c2e 6163  e.QThreadPool.ac
+0006db80: 7469 7665 5468 7265 6164 436f 756e 7428  tiveThreadCount(
+0006db90: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+0006dba0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+0006dbb0: 2020 2020 2020 776f 726b 6572 6675 6e63        workerfunc
+0006dbc0: 2c20 2a61 7267 7320 3d20 7365 6c66 2e71  , *args = self.q
+0006dbd0: 7565 7565 2e67 6574 2846 616c 7365 290d  ueue.get(False).
+0006dbe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006dbf0: 2073 656c 662e 6675 6e63 6469 6374 5b77   self.funcdict[w
+0006dc00: 6f72 6b65 7266 756e 635d 282a 6172 6773  orkerfunc](*args
+0006dc10: 5b30 5d29 0d0a 2020 2020 2020 2020 2020  [0])..          
+0006dc20: 2020 2020 2020 2370 7269 6e74 2822 6275        #print("bu
+0006dc30: 7379 2077 6974 6820 7461 736b 207b 7d22  sy with task {}"
+0006dc40: 2e66 6f72 6d61 7428 776f 726b 6572 6675  .format(workerfu
+0006dc50: 6e63 2929 0d0a 2020 2020 2020 2020 2020  nc))..          
+0006dc60: 2020 6578 6365 7074 2045 6d70 7479 3a20    except Empty: 
+0006dc70: 2320 6966 2071 7565 7565 2065 6d70 7479  # if queue empty
+0006dc80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006dc90: 2020 6272 6561 6b0d 0a0d 0a20 2020 2064    break....    d
+0006dca0: 6566 2041 6c69 676e 5265 6665 7265 6e63  ef AlignReferenc
+0006dcb0: 6564 2873 656c 662c 2064 6174 612c 2069  ed(self, data, i
+0006dcc0: 7468 6574 6129 3a0d 0a20 2020 2020 2020  theta):..       
+0006dcd0: 2069 6620 7365 6c66 2e63 7572 7265 6e74   if self.current
+0006dce0: 5f69 7468 6574 6120 213d 2069 7468 6574  _itheta != ithet
+0006dcf0: 613a 0d0a 2020 2020 2020 2020 2020 2020  a:..            
+0006dd00: 7365 6c66 2e63 7572 7265 6e74 5f69 7468  self.current_ith
+0006dd10: 6574 6120 3d20 6974 6865 7461 0d0a 2020  eta = itheta..  
+0006dd20: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0006dd30: 6967 6e61 6c73 2e69 7468 6574 6170 726f  ignals.ithetapro
+0006dd40: 6772 6573 732e 656d 6974 2869 7468 6574  gress.emit(ithet
+0006dd50: 6129 0d0a 2020 2020 2020 2020 6472 6966  a)..        drif
+0006dd60: 745f 7820 3d20 5b30 2c30 5d0d 0a20 2020  t_x = [0,0]..   
+0006dd70: 2020 2020 2064 7269 6674 5f79 203d 205b       drift_y = [
+0006dd80: 302c 305d 0d0a 2020 2020 2020 2020 6472  0,0]..        dr
+0006dd90: 6966 742c 2065 7272 6f72 2c20 5f20 3d20  ift, error, _ = 
+0006dda0: 7068 6173 655f 6372 6f73 735f 636f 7272  phase_cross_corr
+0006ddb0: 656c 6174 696f 6e28 7365 6c66 2e47 6175  elation(self.Gau
+0006ddc0: 7373 2873 656c 662e 7061 7265 6e74 2e73  ss(self.parent.s
+0006ddd0: 7461 636b 2e61 6273 6461 7461 5f63 726f  tack.absdata_cro
+0006dde0: 7070 6564 5b3a 2c20 3a2c 2064 6174 615b  pped[:, :, data[
+0006ddf0: 305d 2c69 7468 6574 615d 292c 0d0a 2020  0],itheta]),..  
+0006de00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006de10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006de20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006de30: 7365 6c66 2e47 6175 7373 2873 656c 662e  self.Gauss(self.
+0006de40: 7061 7265 6e74 2e73 7461 636b 2e61 6273  parent.stack.abs
+0006de50: 6461 7461 5f63 726f 7070 6564 5b3a 2c20  data_cropped[:, 
+0006de60: 3a2c 2064 6174 615b 315d 2c69 7468 6574  :, data[1],ithet
+0006de70: 615d 292c 7570 7361 6d70 6c65 5f66 6163  a]),upsample_fac
+0006de80: 746f 723d 3230 2920 2323 2032 3020 6d65  tor=20) ## 20 me
+0006de90: 616e 7320 302e 3035 2070 7820 7072 6563  ans 0.05 px prec
+0006dea0: 6973 696f 6e0d 0a20 2020 2020 2020 2073  ision..        s
+0006deb0: 656c 662e 7061 7265 6e74 2e73 7461 636b  elf.parent.stack
+0006dec0: 2e73 6869 6674 7364 6963 745b 6974 6865  .shiftsdict[ithe
+0006ded0: 7461 5d5b 2265 7272 6f72 7322 5d5b 6461  ta]["errors"][da
+0006dee0: 7461 5b30 5d5d 203d 2072 6f75 6e64 2865  ta[0]] = round(e
+0006def0: 7272 6f72 2c34 290d 0a20 2020 2020 2020  rror,4)..       
+0006df00: 2069 6620 6461 7461 5b30 5d20 2d20 6461   if data[0] - da
+0006df10: 7461 5b31 5d20 3e20 303a 0d0a 2020 2020  ta[1] > 0:..    
+0006df20: 2020 2020 2020 2020 6472 6966 745f 785b          drift_x[
+0006df30: 315d 203d 2072 6f75 6e64 2864 7269 6674  1] = round(drift
+0006df40: 5b30 5d2c 3229 0d0a 2020 2020 2020 2020  [0],2)..        
+0006df50: 2020 2020 6472 6966 745f 795b 315d 203d      drift_y[1] =
+0006df60: 2072 6f75 6e64 2864 7269 6674 5b31 5d2c   round(drift[1],
+0006df70: 3229 0d0a 2020 2020 2020 2020 2020 2020  2)..            
+0006df80: 7365 6c66 2e70 6172 656e 742e 7374 6163  self.parent.stac
+0006df90: 6b2e 7368 6966 7473 6469 6374 5b69 7468  k.shiftsdict[ith
+0006dfa0: 6574 615d 5b22 7864 6f74 7322 5d5b 6461  eta]["xdots"][da
+0006dfb0: 7461 5b30 5d5d 3d20 6472 6966 745f 785b  ta[0]]= drift_x[
+0006dfc0: 315d 0d0a 2020 2020 2020 2020 2020 2020  1]..            
+0006dfd0: 7365 6c66 2e70 6172 656e 742e 7374 6163  self.parent.stac
+0006dfe0: 6b2e 7368 6966 7473 6469 6374 5b69 7468  k.shiftsdict[ith
+0006dff0: 6574 615d 5b22 7964 6f74 7322 5d5b 6461  eta]["ydots"][da
+0006e000: 7461 5b30 5d5d 3d20 6472 6966 745f 795b  ta[0]]= drift_y[
+0006e010: 315d 0d0a 2020 2020 2020 2020 656c 7365  1]..        else
+0006e020: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
+0006e030: 7269 6674 5f78 5b30 5d20 3d20 726f 756e  rift_x[0] = roun
+0006e040: 6428 6472 6966 745b 305d 2c32 290d 0a20  d(drift[0],2).. 
+0006e050: 2020 2020 2020 2020 2020 2064 7269 6674             drift
+0006e060: 5f79 5b30 5d20 3d20 726f 756e 6428 6472  _y[0] = round(dr
+0006e070: 6966 745b 315d 2c32 290d 0a20 2020 2020  ift[1],2)..     
+0006e080: 2020 2020 2020 2073 656c 662e 7061 7265         self.pare
+0006e090: 6e74 2e73 7461 636b 2e73 6869 6674 7364  nt.stack.shiftsd
+0006e0a0: 6963 745b 6974 6865 7461 5d5b 2278 646f  ict[itheta]["xdo
+0006e0b0: 7473 225d 5b64 6174 615b 305d 5d3d 2064  ts"][data[0]]= d
+0006e0c0: 7269 6674 5f78 5b30 5d0d 0a20 2020 2020  rift_x[0]..     
+0006e0d0: 2020 2020 2020 2073 656c 662e 7061 7265         self.pare
+0006e0e0: 6e74 2e73 7461 636b 2e73 6869 6674 7364  nt.stack.shiftsd
+0006e0f0: 6963 745b 6974 6865 7461 5d5b 2279 646f  ict[itheta]["ydo
+0006e100: 7473 225d 5b64 6174 615b 305d 5d3d 2064  ts"][data[0]]= d
+0006e110: 7269 6674 5f79 5b30 5d0d 0a0d 0a20 2020  rift_y[0]....   
+0006e120: 2064 6566 2053 6869 6674 496d 6728 7365   def ShiftImg(se
+0006e130: 6c66 2c20 726f 772c 782c 792c 6974 6865  lf, row,x,y,ithe
+0006e140: 7461 293a 0d0a 2020 2020 2020 2020 7368  ta):..        sh
+0006e150: 6966 7465 6420 3d20 6e64 696d 6167 652e  ifted = ndimage.
+0006e160: 666f 7572 6965 725f 7368 6966 7428 6e70  fourier_shift(np
+0006e170: 2e66 6674 2e66 6674 3228 7365 6c66 2e70  .fft.fft2(self.p
+0006e180: 6172 656e 742e 7374 6163 6b2e 6162 7364  arent.stack.absd
+0006e190: 6174 6134 645b 3a2c 203a 2c20 726f 772c  ata4d[:, :, row,
+0006e1a0: 6974 6865 7461 5d29 2c20 5b66 6c6f 6174  itheta]), [float
+0006e1b0: 282d 7829 2c66 6c6f 6174 282d 7929 5d29  (-x),float(-y)])
+0006e1c0: 0d0a 2020 2020 2020 2020 7368 6966 7465  ..        shifte
+0006e1d0: 6420 3d20 6e70 2e66 6674 2e69 6666 7432  d = np.fft.ifft2
+0006e1e0: 2873 6869 6674 6564 290d 0a20 2020 2020  (shifted)..     
+0006e1f0: 2020 2073 656c 662e 7061 7265 6e74 2e73     self.parent.s
+0006e200: 7461 636b 2e61 6273 6461 7461 3464 5f73  tack.absdata4d_s
+0006e210: 6869 6674 6564 5b3a 2c20 3a2c 2072 6f77  hifted[:, :, row
+0006e220: 2c20 6974 6865 7461 5d20 3d20 7368 6966  , itheta] = shif
+0006e230: 7465 642e 7265 616c 0d0a 2020 2020 2020  ted.real..      
+0006e240: 2020 7265 7475 726e 0d0a 0d0a 2020 2020    return....    
+0006e250: 6465 6620 4761 7573 7328 7365 6c66 2c20  def Gauss(self, 
+0006e260: 696d 293a 0d0a 2020 2020 2020 2020 6761  im):..        ga
+0006e270: 7573 7365 6420 3d20 6e64 696d 6167 652e  ussed = ndimage.
+0006e280: 6761 7573 7369 616e 5f66 696c 7465 7228  gaussian_filter(
+0006e290: 696d 2c20 7365 6c66 2e70 6172 656e 742e  im, self.parent.
+0006e2a0: 7370 696e 426f 7847 6175 7373 2e76 616c  spinBoxGauss.val
+0006e2b0: 7565 2829 290d 0a20 2020 2020 2020 2072  ue())..        r
+0006e2c0: 6574 7572 6e20 6761 7573 7365 640d 0a0d  eturn gaussed...
+0006e2d0: 0a63 6c61 7373 2054 6173 6b44 6973 7061  .class TaskDispa
+0006e2e0: 7463 6865 7228 5174 436f 7265 2e51 4f62  tcher(QtCore.QOb
+0006e2f0: 6a65 6374 293a 0d0a 2020 2020 6465 6620  ject):..    def 
+0006e300: 5f5f 696e 6974 5f5f 2873 656c 662c 7061  __init__(self,pa
+0006e310: 7265 6e74 293a 0d0a 2020 2020 2020 2020  rent):..        
+0006e320: 7072 696e 7428 2230 202d 2064 6973 7061  print("0 - dispa
+0006e330: 7463 6865 7220 6361 6c6c 6564 2c20 706f  tcher called, po
+0006e340: 6f6c 2069 6e69 7469 6174 6564 2229 0d0a  ol initiated")..
+0006e350: 2020 2020 2020 2020 7375 7065 7228 5461          super(Ta
+0006e360: 736b 4469 7370 6174 6368 6572 2c20 7365  skDispatcher, se
+0006e370: 6c66 292e 5f5f 696e 6974 5f5f 2829 0d0a  lf).__init__()..
+0006e380: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+0006e390: 2020 2020 2020 2020 2020 7365 6c66 2e77            self.w
+0006e3a0: 6f72 6b65 722e 7369 676e 616c 732e 6974  orker.signals.it
+0006e3b0: 6865 7461 7072 6f67 7265 7373 2e64 6973  hetaprogress.dis
+0006e3c0: 636f 6e6e 6563 7428 290d 0a20 2020 2020  connect()..     
+0006e3d0: 2020 2020 2020 2073 656c 662e 776f 726b         self.work
+0006e3e0: 6572 2e73 6967 6e61 6c73 2e66 696e 6973  er.signals.finis
+0006e3f0: 6865 642e 6469 7363 6f6e 6e65 6374 2829  hed.disconnect()
+0006e400: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
+0006e410: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
+0006e420: 6173 730d 0a20 2020 2020 2020 2073 656c  ass..        sel
+0006e430: 662e 706f 6f6c 203d 2051 7443 6f72 652e  f.pool = QtCore.
+0006e440: 5154 6872 6561 6450 6f6f 6c2e 676c 6f62  QThreadPool.glob
+0006e450: 616c 496e 7374 616e 6365 2829 0d0a 2020  alInstance()..  
+0006e460: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+0006e470: 2020 2020 2020 2020 6370 7573 203d 206c          cpus = l
+0006e480: 656e 286f 732e 7363 6865 645f 6765 7461  en(os.sched_geta
+0006e490: 6666 696e 6974 7928 3029 2920 2320 6e75  ffinity(0)) # nu
+0006e4a0: 6d62 6572 206f 6620 6370 7520 7468 7265  mber of cpu thre
+0006e4b0: 6164 732e 206e 6f74 2073 7570 706f 7274  ads. not support
+0006e4c0: 6564 206f 6e20 736f 6d65 2070 6c61 7466  ed on some platf
+0006e4d0: 6f72 6d73 2e0d 0a20 2020 2020 2020 2065  orms...        e
+0006e4e0: 7863 6570 743a 0d0a 2020 2020 2020 2020  xcept:..        
+0006e4f0: 2020 2020 6370 7573 203d 206f 732e 6370      cpus = os.cp
+0006e500: 755f 636f 756e 7428 290d 0a20 2020 2020  u_count()..     
+0006e510: 2020 2073 656c 662e 706f 6f6c 2e73 6574     self.pool.set
+0006e520: 4d61 7854 6872 6561 6443 6f75 6e74 2863  MaxThreadCount(c
+0006e530: 7075 7329 0d0a 2020 2020 2020 2020 7365  pus)..        se
+0006e540: 6c66 2e71 7565 7565 203d 2053 696d 706c  lf.queue = Simpl
+0006e550: 6551 7565 7565 2829 0d0a 2020 2020 2020  eQueue()..      
+0006e560: 2020 7365 6c66 2e70 6172 656e 7420 3d20    self.parent = 
+0006e570: 7061 7265 6e74 0d0a 0d0a 2020 2020 4070  parent....    @p
+0006e580: 7971 7453 6c6f 7428 290d 0a20 2020 2064  yqtSlot()..    d
+0006e590: 6566 2072 756e 2873 656c 6629 3a0d 0a20  ef run(self):.. 
+0006e5a0: 2020 2020 2020 2023 7072 696e 7428 7365         #print(se
+0006e5b0: 6c66 2e71 7565 7565 2e71 7369 7a65 2829  lf.queue.qsize()
+0006e5c0: 290d 0a20 2020 2020 2020 2023 7072 696e  )..        #prin
+0006e5d0: 7428 2770 6f6f 6c27 2c20 7468 7265 6164  t('pool', thread
+0006e5e0: 696e 672e 6765 745f 6964 656e 7428 2929  ing.get_ident())
+0006e5f0: 0d0a 2020 2020 2020 2020 2320 6966 2073  ..        # if s
+0006e600: 656c 662e 7061 7265 6e74 2e63 6f6d 2e73  elf.parent.com.s
+0006e610: 7461 636b 5f34 6420 3d3d 2030 3a0d 0a20  tack_4d == 0:.. 
+0006e620: 2020 2020 2020 2071 7369 7a65 203d 2069         qsize = i
+0006e630: 6e74 2873 656c 662e 7175 6575 652e 7173  nt(self.queue.qs
+0006e640: 697a 6528 2929 0d0a 2020 2020 2020 2020  ize())..        
+0006e650: 6d61 7874 6872 6561 6473 203d 2073 656c  maxthreads = sel
+0006e660: 662e 706f 6f6c 2e6d 6178 5468 7265 6164  f.pool.maxThread
+0006e670: 436f 756e 7428 290d 0a20 2020 2020 2020  Count()..       
+0006e680: 2070 7265 6665 7272 6564 5f74 6872 6561   preferred_threa
+0006e690: 645f 6e75 6d62 6572 203d 206d 696e 286d  d_number = min(m
+0006e6a0: 6178 7468 7265 6164 732c 2071 7369 7a65  axthreads, qsize
+0006e6b0: 290d 0a20 2020 2020 2020 2070 7269 6e74  )..        print
+0006e6c0: 2822 3120 2d20 7374 6172 7469 6e67 2074  ("1 - starting t
+0006e6d0: 6872 6561 6473 222c 7072 6566 6572 7265  hreads",preferre
+0006e6e0: 645f 7468 7265 6164 5f6e 756d 6265 722c  d_thread_number,
+0006e6f0: 2022 7468 7265 6164 7320 6e65 6564 6564   "threads needed
+0006e700: 2c20 6e75 6d62 6572 206f 6620 7461 736b  , number of task
+0006e710: 733a 222c 7173 697a 6529 0d0a 2020 2020  s:",qsize)..    
+0006e720: 2020 2020 7768 696c 6520 696e 7428 7365      while int(se
+0006e730: 6c66 2e71 7565 7565 2e71 7369 7a65 2829  lf.queue.qsize()
+0006e740: 2920 616e 6420 7365 6c66 2e70 6f6f 6c2e  ) and self.pool.
+0006e750: 6163 7469 7665 5468 7265 6164 436f 756e  activeThreadCoun
+0006e760: 7428 2920 3c20 7072 6566 6572 7265 645f  t() < preferred_
+0006e770: 7468 7265 6164 5f6e 756d 6265 723a 2023  thread_number: #
+0006e780: 7374 6172 7420 6173 206d 616e 7920 7468  start as many th
+0006e790: 7265 6164 7320 6173 206e 6565 6465 642e  reads as needed.
+0006e7a0: 0d0a 2020 2020 2020 2020 2020 2020 2370  ..            #p
+0006e7b0: 7269 6e74 2822 6163 7469 7665 2074 6872  rint("active thr
+0006e7c0: 6561 6473 222b 7374 7228 7365 6c66 2e70  eads"+str(self.p
+0006e7d0: 6f6f 6c2e 6163 7469 7665 5468 7265 6164  ool.activeThread
+0006e7e0: 436f 756e 7428 2929 2b22 2071 7369 7a65  Count())+" qsize
+0006e7f0: 2022 2b73 7472 2869 6e74 2873 656c 662e   "+str(int(self.
+0006e800: 7175 6575 652e 7173 697a 6528 2929 2929  queue.qsize())))
+0006e810: 0d0a 2020 2020 2020 2020 2020 2020 776f  ..            wo
+0006e820: 726b 6572 203d 2047 656e 6572 616c 5075  rker = GeneralPu
+0006e830: 7270 6f73 6550 726f 6365 7373 6f72 2873  rposeProcessor(s
+0006e840: 656c 662e 7061 7265 6e74 2c73 656c 662e  elf.parent,self.
+0006e850: 7175 6575 6529 0d0a 2020 2020 2020 2020  queue)..        
+0006e860: 2020 2020 776f 726b 6572 2e73 6967 6e61      worker.signa
+0006e870: 6c73 2e69 7468 6574 6170 726f 6772 6573  ls.ithetaprogres
+0006e880: 732e 636f 6e6e 6563 7428 7365 6c66 2e70  s.connect(self.p
+0006e890: 6172 656e 742e 4954 6865 7461 5072 6f67  arent.IThetaProg
+0006e8a0: 7265 7373 290d 0a20 2020 2020 2020 2020  ress)..         
+0006e8b0: 2020 2073 656c 662e 706f 6f6c 2e73 7461     self.pool.sta
+0006e8c0: 7274 2877 6f72 6b65 7229 0d0a 2020 2020  rt(worker)..    
+0006e8d0: 2020 2020 2020 2020 7469 6d65 2e73 6c65          time.sle
+0006e8e0: 6570 2830 2e30 3229 2023 2061 7274 6966  ep(0.02) # artif
+0006e8f0: 6963 616c 2064 656c 6179 2074 6f20 7374  ical delay to st
+0006e900: 6172 7420 7468 7265 6164 7320 7769 7468  art threads with
+0006e910: 2061 206c 6974 746c 6520 7469 6d65 2073   a little time s
+0006e920: 6570 6172 6174 696f 6e2e 204f 7468 6572  eparation. Other
+0006e930: 7769 7365 2053 6869 6674 496d 6773 2066  wise ShiftImgs f
+0006e940: 7265 657a 6573 2069 6e20 5769 6e31 3020  reezes in Win10 
+0006e950: 616e 6420 4d61 634f 5320 666f 7220 736d  and MacOS for sm
+0006e960: 616c 6c20 7374 6163 6b73 210d 0a20 2020  all stacks!..   
+0006e970: 2020 2020 2073 656c 662e 706f 6f6c 2e77       self.pool.w
+0006e980: 6169 7446 6f72 446f 6e65 2829 0d0a 2020  aitForDone()..  
+0006e990: 2020 2020 2020 7072 696e 7428 2232 202d        print("2 -
+0006e9a0: 2061 6c6c 2074 6872 6561 6473 2064 6561   all threads dea
+0006e9b0: 6422 290d 0a20 2020 2020 2020 2077 6f72  d")..        wor
+0006e9c0: 6b65 722e 7369 676e 616c 732e 6669 6e69  ker.signals.fini
+0006e9d0: 7368 6564 2e63 6f6e 6e65 6374 2873 656c  shed.connect(sel
+0006e9e0: 662e 7061 7265 6e74 2e54 6872 6561 6450  f.parent.ThreadP
+0006e9f0: 6f6f 6c43 6f6d 706c 6574 6529 0d0a 2020  oolComplete)..  
+0006ea00: 2020 2020 2020 776f 726b 6572 2e73 6967        worker.sig
+0006ea10: 6e61 6c73 2e66 696e 6973 6865 642e 656d  nals.finished.em
+0006ea20: 6974 2829 0d0a 2020 2020 2361 6464 2061  it()..    #add a
+0006ea30: 2074 6173 6b20 746f 2074 6865 2071 7565   task to the que
+0006ea40: 7565 0d0a 2020 2020 6465 6620 656e 7175  ue..    def enqu
+0006ea50: 6575 6574 6173 6b28 7365 6c66 2c20 6675  euetask(self, fu
+0006ea60: 6e63 2c20 2a61 7267 732c 202a 2a6b 6172  nc, *args, **kar
+0006ea70: 6773 293a 0d0a 2020 2020 2020 2020 7365  gs):..        se
+0006ea80: 6c66 2e71 7565 7565 2e70 7574 2828 6675  lf.queue.put((fu
+0006ea90: 6e63 2c20 6172 6773 2c20 6b61 7267 7329  nc, args, kargs)
+0006eaa0: 290d 0a0d 0a63 6c61 7373 2049 6d61 6765  )....class Image
+0006eab0: 5265 6769 7374 7261 7469 6f6e 4646 5428  RegistrationFFT(
+0006eac0: 5174 5769 6467 6574 732e 5144 6961 6c6f  QtWidgets.QDialo
+0006ead0: 672c 2051 7457 6964 6765 7473 2e51 4772  g, QtWidgets.QGr
+0006eae0: 6170 6869 6373 5363 656e 6529 3a0d 0a20  aphicsScene):.. 
+0006eaf0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+0006eb00: 7365 6c66 2c20 7061 7265 6e74 2c20 636f  self, parent, co
+0006eb10: 6d6d 6f6e 2c20 7374 6163 6b29 3a0d 0a20  mmon, stack):.. 
+0006eb20: 2020 2020 2020 2051 7457 6964 6765 7473         QtWidgets
+0006eb30: 2e51 5769 6467 6574 2e5f 5f69 6e69 745f  .QWidget.__init_
+0006eb40: 5f28 7365 6c66 2c20 7061 7265 6e74 290d  _(self, parent).
+0006eb50: 0a20 2020 2020 2020 2075 6963 2e6c 6f61  .        uic.loa
+0006eb60: 6455 6928 6f73 2e70 6174 682e 6a6f 696e  dUi(os.path.join
+0006eb70: 286f 732e 7061 7468 2e64 6972 6e61 6d65  (os.path.dirname
+0006eb80: 286f 732e 7061 7468 2e61 6273 7061 7468  (os.path.abspath
+0006eb90: 285f 5f66 696c 655f 5f29 292c 2027 7368  (__file__)), 'sh
+0006eba0: 6f77 616c 6967 6e32 2e75 6927 292c 2073  owalign2.ui'), s
+0006ebb0: 656c 6629 0d0a 2020 2020 2020 2020 7365  elf)..        se
+0006ebc0: 6c66 2e70 6172 656e 7420 3d20 7061 7265  lf.parent = pare
+0006ebd0: 6e74 0d0a 2020 2020 2020 2020 7365 6c66  nt..        self
+0006ebe0: 2e73 7461 636b 203d 2073 7461 636b 0d0a  .stack = stack..
+0006ebf0: 2020 2020 2020 2020 7365 6c66 2e63 6f6d          self.com
+0006ec00: 203d 2063 6f6d 6d6f 6e0d 0a20 2020 2020   = common..     
+0006ec10: 2020 2073 656c 662e 6965 7620 3d20 300d     self.iev = 0.
+0006ec20: 0a20 2020 2020 2020 2073 656c 662e 6974  .        self.it
+0006ec30: 6865 7461 203d 2030 0d0a 2020 2020 2020  heta = 0..      
+0006ec40: 2020 6966 2073 656c 662e 636f 6d2e 7374    if self.com.st
+0006ec50: 6163 6b5f 6c6f 6164 6564 203d 3d20 313a  ack_loaded == 1:
+0006ec60: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0006ec70: 2073 656c 662e 636f 6d2e 7374 6163 6b5f   self.com.stack_
+0006ec80: 3464 3a0d 0a20 2020 2020 2020 2020 2020  4d:..           
+0006ec90: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
+0006eca0: 6162 7364 6174 6134 6420 3d20 7365 6c66  absdata4d = self
+0006ecb0: 2e73 7461 636b 2e73 7461 636b 3444 2e63  .stack.stack4D.c
+0006ecc0: 6f70 7928 290d 0a20 2020 2020 2020 2020  opy()..         
+0006ecd0: 2020 2020 2020 2023 7365 6c66 2e62 7574         #self.but
+0006ece0: 746f 6e5f 616c 6967 6e62 6174 6368 2e73  ton_alignbatch.s
+0006ecf0: 6574 5669 7369 626c 6528 5472 7565 290d  etVisible(True).
+0006ed00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006ed10: 2073 656c 662e 6275 7474 6f6e 5f61 6c69   self.button_ali
+0006ed20: 676e 2e73 6574 5465 7874 2822 416c 6967  gn.setText("Alig
+0006ed30: 6e20 4261 7463 6822 290d 0a20 2020 2020  n Batch")..     
+0006ed40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0006ed50: 7468 6574 6174 6872 6561 6420 3d20 5174  thetathread = Qt
+0006ed60: 436f 7265 2e51 5468 7265 6164 2829 0d0a  Core.QThread()..
+0006ed70: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0006ed80: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0006ed90: 2020 2073 656c 662e 7374 6163 6b2e 6162     self.stack.ab
+0006eda0: 7364 6174 6134 6420 3d20 6e70 2e65 7870  sdata4d = np.exp
+0006edb0: 616e 645f 6469 6d73 2873 656c 662e 7374  and_dims(self.st
+0006edc0: 6163 6b2e 6162 7364 6174 612e 636f 7079  ack.absdata.copy
+0006edd0: 2829 2c20 6178 6973 3d33 290d 0a20 2020  (), axis=3)..   
+0006ede0: 2020 2020 2020 2020 2020 2020 2023 7365               #se
+0006edf0: 6c66 2e62 7574 746f 6e5f 616c 6967 6e62  lf.button_alignb
+0006ee00: 6174 6368 2e73 6574 5669 7369 626c 6528  atch.setVisible(
+0006ee10: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
+0006ee20: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
+0006ee30: 746f 6e5f 616c 6967 6e2e 7365 7454 6578  ton_align.setTex
+0006ee40: 7428 2241 6c69 676e 2229 0d0a 2020 2020  t("Align")..    
+0006ee50: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
+0006ee60: 636b 2e61 6273 6461 7461 5f63 726f 7070  ck.absdata_cropp
+0006ee70: 6564 203d 2073 656c 662e 7374 6163 6b2e  ed = self.stack.
+0006ee80: 6162 7364 6174 6134 642e 636f 7079 2829  absdata4d.copy()
+0006ee90: 2023 2054 6869 7320 696d 6167 6520 7374   # This image st
+0006eea0: 6163 6b20 6973 2075 7365 6420 6279 2074  ack is used by t
+0006eeb0: 6865 2061 6c69 676e 6d65 6e74 2f73 6869  he alignment/shi
+0006eec0: 6674 2072 6f75 7469 6e65 2061 6e64 2063  ft routine and c
+0006eed0: 726f 7070 6564 2074 6f20 7468 6520 524f  ropped to the RO
+0006eee0: 4920 7265 6374 616e 676c 650d 0a20 2020  I rectangle..   
+0006eef0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
+0006ef00: 6163 6b2e 6162 7364 6174 6134 645f 7368  ack.absdata4d_sh
+0006ef10: 6966 7465 6420 3d20 7365 6c66 2e73 7461  ifted = self.sta
+0006ef20: 636b 2e61 6273 6461 7461 3464 2e63 6f70  ck.absdata4d.cop
+0006ef30: 7928 2920 2320 5468 6973 2069 7320 7468  y() # This is th
+0006ef40: 6520 6675 6c6c 2d73 697a 6564 206f 7574  e full-sized out
+0006ef50: 7075 7420 6f66 2074 6865 2061 6c69 676e  put of the align
+0006ef60: 6d65 6e74 2f73 6869 6674 2072 6f75 7469  ment/shift routi
+0006ef70: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+0006ef80: 7365 6c66 2e73 7461 636b 2e61 6273 6461  self.stack.absda
+0006ef90: 7461 3464 5f73 6869 6674 6564 5f63 726f  ta4d_shifted_cro
+0006efa0: 7070 6564 203d 2073 656c 662e 7374 6163  pped = self.stac
+0006efb0: 6b2e 6162 7364 6174 6134 642e 636f 7079  k.absdata4d.copy
+0006efc0: 2829 2023 2054 6869 7320 6973 2074 6865  () # This is the
+0006efd0: 206f 7574 7075 7420 6372 6f70 7065 6420   output cropped 
+0006efe0: 746f 2074 6865 2063 6f6d 6d6f 6e20 7265  to the common re
+0006eff0: 6769 6f6e 0d0a 2020 2020 2020 2020 2373  gion..        #s
+0006f000: 656c 662e 7374 6163 6b2e 6162 7364 6174  elf.stack.absdat
+0006f010: 615f 756e 616c 6967 6e65 6420 3d20 7365  a_unaligned = se
+0006f020: 6c66 2e73 7461 636b 2e61 6273 6461 7461  lf.stack.absdata
+0006f030: 5f73 6869 6674 6564 5f63 726f 7070 6564  _shifted_cropped
+0006f040: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+0006f050: 6f6f 6c74 6872 6561 6420 3d20 5174 436f  oolthread = QtCo
+0006f060: 7265 2e51 5468 7265 6164 2829 0d0a 2020  re.QThread()..  
+0006f070: 2020 2020 2020 7365 6c66 2e61 6c69 676e        self.align
+0006f080: 6564 203d 2046 616c 7365 0d0a 2020 2020  ed = False..    
+0006f090: 2020 2020 7365 6c66 2e53 6574 7570 5549      self.SetupUI
+0006f0a0: 2829 0d0a 0d0a 2020 2020 6465 6620 5365  ()....    def Se
+0006f0b0: 7475 7055 4928 7365 6c66 293a 0d0a 2020  tupUI(self):..  
+0006f0c0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+0006f0d0: 6e5f 6f6b 2e73 6574 456e 6162 6c65 6428  n_ok.setEnabled(
+0006f0e0: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
+0006f0f0: 7365 6c66 2e73 6c69 6465 725f 7468 6574  self.slider_thet
+0006f100: 612e 7365 7456 6973 6962 6c65 2846 616c  a.setVisible(Fal
+0006f110: 7365 290d 0a20 2020 2020 2020 2073 656c  se)..        sel
+0006f120: 662e 7365 7457 696e 646f 7754 6974 6c65  f.setWindowTitle
+0006f130: 2827 416c 6967 6e20 5374 6163 6b20 7632  ('Align Stack v2
+0006f140: 2729 0d0a 2020 2020 2020 2020 7365 6c66  ')..        self
+0006f150: 2e70 676c 6179 6f75 7420 3d20 7067 2e47  .pglayout = pg.G
+0006f160: 7261 7068 6963 734c 6179 6f75 7428 626f  raphicsLayout(bo
+0006f170: 7264 6572 3d4e 6f6e 6529 0d0a 2020 2020  rder=None)..    
+0006f180: 2020 2020 7365 6c66 2e63 616e 7661 732e      self.canvas.
+0006f190: 7365 7442 6163 6b67 726f 756e 6428 2277  setBackground("w
+0006f1a0: 2229 2023 2063 616e 7661 7320 6973 2061  ") # canvas is a
+0006f1b0: 2070 672e 4772 6170 6869 6373 5669 6577   pg.GraphicsView
+0006f1c0: 2077 6964 6765 740d 0a20 2020 2020 2020   widget..       
+0006f1d0: 2073 656c 662e 6361 6e76 6173 2e73 6574   self.canvas.set
+0006f1e0: 4365 6e74 7261 6c57 6964 6765 7428 7365  CentralWidget(se
+0006f1f0: 6c66 2e70 676c 6179 6f75 7429 0d0a 2020  lf.pglayout)..  
+0006f200: 2020 2020 2020 7365 6c66 2e76 6220 3d20        self.vb = 
+0006f210: 7365 6c66 2e70 676c 6179 6f75 742e 6164  self.pglayout.ad
+0006f220: 6456 6965 7742 6f78 2829 0d0a 2020 2020  dViewBox()..    
+0006f230: 2020 2020 7365 6c66 2e76 622e 7365 7441      self.vb.setA
+0006f240: 7370 6563 744c 6f63 6b65 6428 290d 0a20  spectLocked().. 
+0006f250: 2020 2020 2020 2073 656c 662e 695f 6974         self.i_it
+0006f260: 656d 203d 2070 672e 496d 6167 6549 7465  em = pg.ImageIte
+0006f270: 6d28 626f 7264 6572 3d22 6b22 2c70 6172  m(border="k",par
+0006f280: 656e 743d 2073 656c 6629 0d0a 0d0a 2020  ent= self)....  
+0006f290: 2020 2020 2020 7365 6c66 2e76 622e 7365        self.vb.se
+0006f2a0: 744d 6f75 7365 456e 6162 6c65 6428 783d  tMouseEnabled(x=
+0006f2b0: 4661 6c73 652c 2079 3d46 616c 7365 290d  False, y=False).
+0006f2c0: 0a20 2020 2020 2020 2073 656c 662e 7662  .        self.vb
+0006f2d0: 2e61 6464 4974 656d 2873 656c 662e 695f  .addItem(self.i_
+0006f2e0: 6974 656d 2c20 6967 6e6f 7265 426f 756e  item, ignoreBoun
+0006f2f0: 6473 3d46 616c 7365 290d 0a0d 0a20 2020  ds=False)....   
+0006f300: 2020 2020 2073 656c 662e 4472 6966 7473       self.Drifts
+0006f310: 5769 6467 6574 2e73 6574 4261 636b 6772  Widget.setBackgr
+0006f320: 6f75 6e64 2822 7722 290d 0a0d 0a20 2020  ound("w")....   
+0006f330: 2020 2020 2073 656c 662e 7079 203d 2073       self.py = s
+0006f340: 656c 662e 4472 6966 7473 5769 6467 6574  elf.DriftsWidget
+0006f350: 2e61 6464 506c 6f74 2872 6f77 3d30 2c20  .addPlot(row=0, 
+0006f360: 636f 6c3d 302c 2072 6f77 7370 616e 3d31  col=0, rowspan=1
+0006f370: 2c20 636f 6c73 7061 6e3d 3129 0d0a 2020  , colspan=1)..  
+0006f380: 2020 2020 2020 7365 6c66 2e70 792e 7365        self.py.se
+0006f390: 744d 6f75 7365 456e 6162 6c65 6428 783d  tMouseEnabled(x=
+0006f3a0: 4661 6c73 652c 2079 3d54 7275 6529 0d0a  False, y=True)..
+0006f3b0: 2020 2020 2020 2020 2373 656c 662e 695f          #self.i_
+0006f3c0: 6974 656d 203d 2070 672e 496d 6167 6549  item = pg.ImageI
+0006f3d0: 7465 6d28 626f 7264 6572 3d22 6b22 290d  tem(border="k").
+0006f3e0: 0a20 2020 2020 2020 2023 7365 6c66 2e70  .        #self.p
+0006f3f0: 792e 7365 7441 7370 6563 744c 6f63 6b65  y.setAspectLocke
+0006f400: 6428 6c6f 636b 3d54 7275 652c 2072 6174  d(lock=True, rat
+0006f410: 696f 3d31 290d 0a20 2020 2020 2020 2073  io=1)..        s
+0006f420: 656c 662e 7079 2e73 686f 7741 7869 7328  elf.py.showAxis(
+0006f430: 2274 6f70 222c 2073 686f 773d 5472 7565  "top", show=True
+0006f440: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0006f450: 7079 2e73 686f 7741 7869 7328 2262 6f74  py.showAxis("bot
+0006f460: 746f 6d22 2c20 7368 6f77 3d54 7275 6529  tom", show=True)
+0006f470: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+0006f480: 792e 7368 6f77 4178 6973 2822 6c65 6674  y.showAxis("left
+0006f490: 222c 2073 686f 773d 5472 7565 290d 0a20  ", show=True).. 
+0006f4a0: 2020 2020 2020 2073 656c 662e 7079 2e73         self.py.s
+0006f4b0: 686f 7741 7869 7328 2272 6967 6874 222c  howAxis("right",
+0006f4c0: 2073 686f 773d 5472 7565 290d 0a20 2020   show=True)..   
+0006f4d0: 2020 2020 2061 7931 203d 2073 656c 662e       ay1 = self.
+0006f4e0: 7079 2e67 6574 4178 6973 2822 6c65 6674  py.getAxis("left
+0006f4f0: 2229 0d0a 2020 2020 2020 2020 6279 3120  ")..        by1 
+0006f500: 3d20 7365 6c66 2e70 792e 6765 7441 7869  = self.py.getAxi
+0006f510: 7328 2272 6967 6874 2229 0d0a 2020 2020  s("right")..    
+0006f520: 2020 2020 6178 3120 3d20 7365 6c66 2e70      ax1 = self.p
+0006f530: 792e 6765 7441 7869 7328 2262 6f74 746f  y.getAxis("botto
+0006f540: 6d22 290d 0a20 2020 2020 2020 2062 7831  m")..        bx1
+0006f550: 203d 2073 656c 662e 7079 2e67 6574 4178   = self.py.getAx
+0006f560: 6973 2822 746f 7022 290d 0a20 2020 2020  is("top")..     
+0006f570: 2020 2061 7931 2e73 6574 4c61 6265 6c28     ay1.setLabel(
+0006f580: 7465 7874 3d22 792d 6472 6966 7422 2c20  text="y-drift", 
+0006f590: 756e 6974 733d 2270 7822 290d 0a20 2020  units="px")..   
+0006f5a0: 2020 2020 2061 7931 2e65 6e61 626c 6541       ay1.enableA
+0006f5b0: 7574 6f53 4950 7265 6669 7828 656e 6162  utoSIPrefix(enab
+0006f5c0: 6c65 3d54 7275 6529 0d0a 2020 2020 2020  le=True)..      
+0006f5d0: 2020 6179 312e 7365 7457 6964 7468 2877    ay1.setWidth(w
+0006f5e0: 3d36 3029 0d0a 2020 2020 2020 2020 6178  =60)..        ax
+0006f5f0: 312e 7365 744c 6162 656c 2874 6578 743d  1.setLabel(text=
+0006f600: 2250 686f 746f 6e20 456e 6572 6779 222c  "Photon Energy",
+0006f610: 756e 6974 733d 2265 5622 290d 0a20 2020  units="eV")..   
+0006f620: 2020 2020 2061 7831 2e65 6e61 626c 6541       ax1.enableA
+0006f630: 7574 6f53 4950 7265 6669 7828 656e 6162  utoSIPrefix(enab
+0006f640: 6c65 3d54 7275 6529 0d0a 2020 2020 2020  le=True)..      
+0006f650: 2020 6179 312e 7365 7453 7479 6c65 2874    ay1.setStyle(t
+0006f660: 6963 6b4c 656e 6774 683d 3829 0d0a 2020  ickLength=8)..  
+0006f670: 2020 2020 2020 6178 312e 7365 7453 7479        ax1.setSty
+0006f680: 6c65 2874 6963 6b4c 656e 6774 683d 3029  le(tickLength=0)
+0006f690: 0d0a 2020 2020 2020 2020 2361 7831 2e73  ..        #ax1.s
+0006f6a0: 6574 4865 6967 6874 2868 3d34 362e 3229  etHeight(h=46.2)
+0006f6b0: 0d0a 2020 2020 2020 2020 6178 312e 7365  ..        ax1.se
+0006f6c0: 7453 7479 6c65 2874 6963 6b4c 656e 6774  tStyle(tickLengt
+0006f6d0: 683d 3829 0d0a 2020 2020 2020 2020 6279  h=8)..        by
+0006f6e0: 312e 7365 7453 7479 6c65 2873 686f 7756  1.setStyle(showV
+0006f6f0: 616c 7565 733d 4661 6c73 652c 2074 6963  alues=False, tic
+0006f700: 6b4c 656e 6774 683d 3029 0d0a 2020 2020  kLength=0)..    
+0006f710: 2020 2020 6278 312e 7365 7453 7479 6c65      bx1.setStyle
+0006f720: 2873 686f 7756 616c 7565 733d 4661 6c73  (showValues=Fals
+0006f730: 652c 2074 6963 6b4c 656e 6774 683d 3029  e, tickLength=0)
+0006f740: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+0006f750: 2e70 7820 3d20 7365 6c66 2e44 7269 6674  .px = self.Drift
+0006f760: 7357 6964 6765 742e 6164 6450 6c6f 7428  sWidget.addPlot(
+0006f770: 726f 773d 312c 2063 6f6c 3d30 2c20 726f  row=1, col=0, ro
+0006f780: 7773 7061 6e3d 312c 2063 6f6c 7370 616e  wspan=1, colspan
+0006f790: 3d31 290d 0a20 2020 2020 2020 2073 656c  =1)..        sel
+0006f7a0: 662e 7078 2e73 6574 584c 696e 6b28 7365  f.px.setXLink(se
+0006f7b0: 6c66 2e70 7929 0d0a 2020 2020 2020 2020  lf.py)..        
+0006f7c0: 7365 6c66 2e70 782e 7365 744d 6f75 7365  self.px.setMouse
+0006f7d0: 456e 6162 6c65 6428 783d 4661 6c73 652c  Enabled(x=False,
+0006f7e0: 2079 3d54 7275 6529 0d0a 2020 2020 2020   y=True)..      
+0006f7f0: 2020 2373 656c 662e 695f 6974 656d 203d    #self.i_item =
+0006f800: 2070 672e 496d 6167 6549 7465 6d28 626f   pg.ImageItem(bo
+0006f810: 7264 6572 3d22 6b22 290d 0a20 2020 2020  rder="k")..     
+0006f820: 2020 2023 7365 6c66 2e70 782e 7365 7441     #self.px.setA
+0006f830: 7370 6563 744c 6f63 6b65 6428 6c6f 636b  spectLocked(lock
+0006f840: 3d54 7275 652c 2072 6174 696f 3d31 290d  =True, ratio=1).
+0006f850: 0a20 2020 2020 2020 2073 656c 662e 7078  .        self.px
+0006f860: 2e73 686f 7741 7869 7328 2274 6f70 222c  .showAxis("top",
+0006f870: 2073 686f 773d 5472 7565 290d 0a20 2020   show=True)..   
+0006f880: 2020 2020 2073 656c 662e 7078 2e73 686f       self.px.sho
+0006f890: 7741 7869 7328 2262 6f74 746f 6d22 2c20  wAxis("bottom", 
+0006f8a0: 7368 6f77 3d54 7275 6529 0d0a 2020 2020  show=True)..    
+0006f8b0: 2020 2020 7365 6c66 2e70 782e 7368 6f77      self.px.show
+0006f8c0: 4178 6973 2822 6c65 6674 222c 2073 686f  Axis("left", sho
+0006f8d0: 773d 5472 7565 290d 0a20 2020 2020 2020  w=True)..       
+0006f8e0: 2073 656c 662e 7078 2e73 686f 7741 7869   self.px.showAxi
+0006f8f0: 7328 2272 6967 6874 222c 2073 686f 773d  s("right", show=
+0006f900: 5472 7565 290d 0a20 2020 2020 2020 2061  True)..        a
+0006f910: 7932 203d 2073 656c 662e 7078 2e67 6574  y2 = self.px.get
+0006f920: 4178 6973 2822 6c65 6674 2229 0d0a 2020  Axis("left")..  
+0006f930: 2020 2020 2020 6279 3220 3d20 7365 6c66        by2 = self
+0006f940: 2e70 782e 6765 7441 7869 7328 2272 6967  .px.getAxis("rig
+0006f950: 6874 2229 0d0a 2020 2020 2020 2020 6178  ht")..        ax
+0006f960: 3220 3d20 7365 6c66 2e70 782e 6765 7441  2 = self.px.getA
+0006f970: 7869 7328 2262 6f74 746f 6d22 290d 0a20  xis("bottom").. 
+0006f980: 2020 2020 2020 2062 7832 203d 2073 656c         bx2 = sel
+0006f990: 662e 7078 2e67 6574 4178 6973 2822 746f  f.px.getAxis("to
+0006f9a0: 7022 290d 0a20 2020 2020 2020 2061 7932  p")..        ay2
+0006f9b0: 2e73 6574 4c61 6265 6c28 7465 7874 3d22  .setLabel(text="
+0006f9c0: 782d 6472 6966 7422 2c75 6e69 7473 3d22  x-drift",units="
+0006f9d0: 7078 2229 0d0a 2020 2020 2020 2020 6179  px")..        ay
+0006f9e0: 322e 656e 6162 6c65 4175 746f 5349 5072  2.enableAutoSIPr
+0006f9f0: 6566 6978 2865 6e61 626c 653d 5472 7565  efix(enable=True
+0006fa00: 290d 0a20 2020 2020 2020 2061 7932 2e73  )..        ay2.s
+0006fa10: 6574 5769 6474 6828 773d 3630 290d 0a20  etWidth(w=60).. 
+0006fa20: 2020 2020 2020 2061 7832 2e73 6574 4c61         ax2.setLa
+0006fa30: 6265 6c28 7465 7874 3d22 5068 6f74 6f6e  bel(text="Photon
+0006fa40: 2045 6e65 7267 7922 2c75 6e69 7473 3d22   Energy",units="
+0006fa50: 6556 2229 0d0a 2020 2020 2020 2020 6178  eV")..        ax
+0006fa60: 322e 656e 6162 6c65 4175 746f 5349 5072  2.enableAutoSIPr
+0006fa70: 6566 6978 2865 6e61 626c 653d 5472 7565  efix(enable=True
+0006fa80: 290d 0a20 2020 2020 2020 2061 7932 2e73  )..        ay2.s
+0006fa90: 6574 5374 796c 6528 7469 636b 4c65 6e67  etStyle(tickLeng
+0006faa0: 7468 3d38 290d 0a20 2020 2020 2020 2061  th=8)..        a
+0006fab0: 7832 2e73 6574 5374 796c 6528 7469 636b  x2.setStyle(tick
+0006fac0: 4c65 6e67 7468 3d38 290d 0a20 2020 2020  Length=8)..     
+0006fad0: 2020 2062 7932 2e73 6574 5374 796c 6528     by2.setStyle(
+0006fae0: 7368 6f77 5661 6c75 6573 3d46 616c 7365  showValues=False
+0006faf0: 2c74 6963 6b4c 656e 6774 683d 3029 0d0a  ,tickLength=0)..
+0006fb00: 2020 2020 2020 2020 6278 322e 7365 7453          bx2.setS
+0006fb10: 7479 6c65 2873 686f 7756 616c 7565 733d  tyle(showValues=
+0006fb20: 4661 6c73 652c 7469 636b 4c65 6e67 7468  False,tickLength
+0006fb30: 3d30 290d 0a0d 0a20 2020 2020 2020 2073  =0)....        s
+0006fb40: 656c 662e 6275 7474 6f6e 5f6f 6b2e 636c  elf.button_ok.cl
+0006fb50: 6963 6b65 642e 636f 6e6e 6563 7428 7365  icked.connect(se
+0006fb60: 6c66 2e4f 6e41 6363 6570 7429 0d0a 2020  lf.OnAccept)..  
+0006fb70: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+0006fb80: 6e5f 6361 6e63 656c 2e63 6c69 636b 6564  n_cancel.clicked
+0006fb90: 2e63 6f6e 6e65 6374 2873 656c 662e 4f6e  .connect(self.On
+0006fba0: 4361 6e63 656c 290d 0a0d 0a20 2020 2020  Cancel)....     
+0006fbb0: 2020 2069 6620 7365 6c66 2e63 6f6d 2e73     if self.com.s
+0006fbc0: 7461 636b 5f6c 6f61 6465 6420 3d3d 2031  tack_loaded == 1
+0006fbd0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+0006fbe0: 6620 7365 6c66 2e63 6f6d 2e73 7461 636b  f self.com.stack
+0006fbf0: 5f34 643a 0d0a 2020 2020 2020 2020 2020  _4d:..          
+0006fc00: 2020 2020 2020 7365 6c66 2e73 6c69 6465        self.slide
+0006fc10: 725f 7468 6574 612e 7365 7456 6973 6962  r_theta.setVisib
+0006fc20: 6c65 2854 7275 6529 0d0a 2020 2020 2020  le(True)..      
+0006fc30: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0006fc40: 6c69 6465 725f 7468 6574 612e 7365 7452  lider_theta.setR
+0006fc50: 616e 6765 2830 2c20 7365 6c66 2e73 7461  ange(0, self.sta
+0006fc60: 636b 2e6e 5f74 6865 7461 202d 2031 290d  ck.n_theta - 1).
+0006fc70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006fc80: 2073 656c 662e 736c 6964 6572 5f74 6865   self.slider_the
+0006fc90: 7461 2e76 616c 7565 4368 616e 6765 645b  ta.valueChanged[
+0006fca0: 696e 745d 2e63 6f6e 6e65 6374 2873 656c  int].connect(sel
+0006fcb0: 662e 4f6e 5363 726f 6c6c 5468 6574 6129  f.OnScrollTheta)
+0006fcc0: 0d0a 2020 2020 2020 2020 2020 2020 2373  ..            #s
+0006fcd0: 656c 662e 6d61 736b 6564 7661 6c73 203d  elf.maskedvals =
+0006fce0: 205b 5472 7565 5d20 2a20 696e 7428 7365   [True] * int(se
+0006fcf0: 6c66 2e73 7461 636b 2e6e 5f65 7629 0d0a  lf.stack.n_ev)..
+0006fd00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0006fd10: 2e73 7069 6e42 6f78 4572 726f 722e 7365  .spinBoxError.se
+0006fd20: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
+0006fd30: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0006fd40: 662e 736c 6964 6572 5f65 6e67 2e73 6c69  f.slider_eng.sli
+0006fd50: 6465 7250 7265 7373 6564 2e63 6f6e 6e65  derPressed.conne
+0006fd60: 6374 2873 656c 662e 5368 6f77 496d 6167  ct(self.ShowImag
+0006fd70: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0006fd80: 7365 6c66 2e73 6c69 6465 725f 656e 672e  self.slider_eng.
+0006fd90: 736c 6964 6572 5265 6c65 6173 6564 2e63  sliderReleased.c
+0006fda0: 6f6e 6e65 6374 2873 656c 662e 5368 6f77  onnect(self.Show
+0006fdb0: 496d 6167 6529 0d0a 2020 2020 2020 2020  Image)..        
+0006fdc0: 2020 2020 7365 6c66 2e73 6c69 6465 725f      self.slider_
+0006fdd0: 656e 672e 7661 6c75 6543 6861 6e67 6564  eng.valueChanged
+0006fde0: 5b69 6e74 5d2e 636f 6e6e 6563 7428 7365  [int].connect(se
+0006fdf0: 6c66 2e4f 6e53 6372 6f6c 6c45 6e67 290d  lf.OnScrollEng).
+0006fe00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0006fe10: 662e 736c 6964 6572 5f65 6e67 2e73 6574  f.slider_eng.set
+0006fe20: 5261 6e67 6528 302c 2073 656c 662e 7374  Range(0, self.st
+0006fe30: 6163 6b2e 6e5f 6576 202d 2031 290d 0a20  ack.n_ev - 1).. 
+0006fe40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0006fe50: 7265 666d 6172 6b65 7278 203d 2070 672e  refmarkerx = pg.
+0006fe60: 496e 6669 6e69 7465 4c69 6e65 2861 6e67  InfiniteLine(ang
+0006fe70: 6c65 3d39 302c 206d 6f76 6162 6c65 3d46  le=90, movable=F
+0006fe80: 616c 7365 2c20 7065 6e3d 7067 2e6d 6b50  alse, pen=pg.mkP
+0006fe90: 656e 2863 6f6c 6f72 3d22 6222 2c20 7769  en(color="b", wi
+0006fea0: 6474 683d 322c 2073 7479 6c65 3d51 7443  dth=2, style=QtC
+0006feb0: 6f72 652e 5174 2e44 6173 684c 696e 6529  ore.Qt.DashLine)
+0006fec0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0006fed0: 656c 662e 7265 666d 6172 6b65 7279 203d  elf.refmarkery =
+0006fee0: 2070 672e 496e 6669 6e69 7465 4c69 6e65   pg.InfiniteLine
+0006fef0: 2861 6e67 6c65 3d39 302c 206d 6f76 6162  (angle=90, movab
+0006ff00: 6c65 3d46 616c 7365 2c20 7065 6e3d 7067  le=False, pen=pg
+0006ff10: 2e6d 6b50 656e 2863 6f6c 6f72 3d22 6222  .mkPen(color="b"
+0006ff20: 2c20 7769 6474 683d 322c 2073 7479 6c65  , width=2, style
+0006ff30: 3d51 7443 6f72 652e 5174 2e44 6173 684c  =QtCore.Qt.DashL
+0006ff40: 696e 6529 290d 0a20 2020 2020 2020 2020  ine))..         
+0006ff50: 2020 2073 656c 662e 7078 2e61 6464 4974     self.px.addIt
+0006ff60: 656d 2873 656c 662e 7265 666d 6172 6b65  em(self.refmarke
+0006ff70: 7278 2c20 6967 6e6f 7265 426f 756e 6473  rx, ignoreBounds
+0006ff80: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
+0006ff90: 2020 2020 7365 6c66 2e70 792e 6164 6449      self.py.addI
+0006ffa0: 7465 6d28 7365 6c66 2e72 6566 6d61 726b  tem(self.refmark
+0006ffb0: 6572 792c 2069 676e 6f72 6542 6f75 6e64  ery, ignoreBound
+0006ffc0: 733d 5472 7565 290d 0a0d 0a20 2020 2020  s=True)....     
+0006ffd0: 2020 2020 2020 2073 656c 662e 6669 745f         self.fit_
+0006ffe0: 7820 3d20 7067 2e50 6c6f 7443 7572 7665  x = pg.PlotCurve
+0006fff0: 4974 656d 2870 656e 3d70 672e 6d6b 5065  Item(pen=pg.mkPe
+00070000: 6e28 636f 6c6f 723d 2263 222c 2077 6964  n(color="c", wid
+00070010: 7468 3d32 2929 0d0a 2020 2020 2020 2020  th=2))..        
+00070020: 2020 2020 7365 6c66 2e66 6974 5f79 203d      self.fit_y =
+00070030: 2070 672e 506c 6f74 4375 7276 6549 7465   pg.PlotCurveIte
+00070040: 6d28 7065 6e3d 7067 2e6d 6b50 656e 2863  m(pen=pg.mkPen(c
+00070050: 6f6c 6f72 3d22 6322 2c20 7769 6474 683d  olor="c", width=
+00070060: 3229 290d 0a20 2020 2020 2020 2020 2020  2))..           
+00070070: 2073 656c 662e 6669 745f 782e 7365 745a   self.fit_x.setZ
+00070080: 5661 6c75 6528 3230 3029 0d0a 2020 2020  Value(200)..    
+00070090: 2020 2020 2020 2020 7365 6c66 2e66 6974          self.fit
+000700a0: 5f79 2e73 6574 5a56 616c 7565 2832 3030  _y.setZValue(200
+000700b0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+000700c0: 656c 662e 7078 2e61 6464 4974 656d 2873  elf.px.addItem(s
+000700d0: 656c 662e 6669 745f 782c 2069 676e 6f72  elf.fit_x, ignor
+000700e0: 6542 6f75 6e64 733d 5472 7565 290d 0a20  eBounds=True).. 
+000700f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00070100: 7079 2e61 6464 4974 656d 2873 656c 662e  py.addItem(self.
+00070110: 6669 745f 792c 2069 676e 6f72 6542 6f75  fit_y, ignoreBou
+00070120: 6e64 733d 5472 7565 290d 0a0d 0a20 2020  nds=True)....   
+00070130: 2020 2020 2020 2020 2073 656c 662e 4f6e           self.On
+00070140: 5363 726f 6c6c 456e 6728 3029 0d0a 2020  ScrollEng(0)..  
+00070150: 2020 2020 2020 2020 2020 7365 6c66 2e53            self.S
+00070160: 6574 7570 524f 4928 290d 0a20 2020 2020  etupROI()..     
+00070170: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
+00070180: 6f6e 5f61 6c69 676e 2e63 6c69 636b 6564  on_align.clicked
+00070190: 2e63 6f6e 6e65 6374 2873 656c 662e 436f  .connect(self.Co
+000701a0: 6d70 6f73 6541 6c69 676e 5175 6575 6529  mposeAlignQueue)
+000701b0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000701c0: 6c66 2e78 7265 6769 6f6e 203d 2070 672e  lf.xregion = pg.
+000701d0: 4c69 6e65 6172 5265 6769 6f6e 4974 656d  LinearRegionItem
+000701e0: 2862 7275 7368 3d5b 3235 352c 2030 2c20  (brush=[255, 0, 
+000701f0: 302c 2034 355d 2c20 626f 756e 6473 3d5b  0, 45], bounds=[
+00070200: 7365 6c66 2e73 7461 636b 2e65 765b 305d  self.stack.ev[0]
+00070210: 2c20 7365 6c66 2e73 7461 636b 2e65 765b  , self.stack.ev[
+00070220: 2d31 5d5d 290d 0a20 2020 2020 2020 2020  -1]])..         
+00070230: 2020 2073 656c 662e 7972 6567 696f 6e20     self.yregion 
+00070240: 3d20 7067 2e4c 696e 6561 7252 6567 696f  = pg.LinearRegio
+00070250: 6e49 7465 6d28 6272 7573 683d 5b32 3535  nItem(brush=[255
+00070260: 2c20 302c 2030 2c20 3435 5d2c 2062 6f75  , 0, 0, 45], bou
+00070270: 6e64 733d 5b73 656c 662e 7374 6163 6b2e  nds=[self.stack.
+00070280: 6576 5b30 5d2c 2073 656c 662e 7374 6163  ev[0], self.stac
+00070290: 6b2e 6576 5b2d 315d 5d29 0d0a 2020 2020  k.ev[-1]])..    
+000702a0: 2020 2020 2020 2020 7365 6c66 2e78 7265          self.xre
+000702b0: 6769 6f6e 2e73 6574 5265 6769 6f6e 285b  gion.setRegion([
+000702c0: 7365 6c66 2e73 7461 636b 2e65 765b 305d  self.stack.ev[0]
+000702d0: 2c20 7365 6c66 2e73 7461 636b 2e65 765b  , self.stack.ev[
+000702e0: 2d31 5d5d 290d 0a20 2020 2020 2020 2020  -1]])..         
+000702f0: 2020 2073 656c 662e 7972 6567 696f 6e2e     self.yregion.
+00070300: 7365 7452 6567 696f 6e28 5b73 656c 662e  setRegion([self.
+00070310: 7374 6163 6b2e 6576 5b30 5d2c 2073 656c  stack.ev[0], sel
+00070320: 662e 7374 6163 6b2e 6576 5b2d 315d 5d29  f.stack.ev[-1]])
 00070330: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00070340: 6c66 2e70 782e 6164 6449 7465 6d28 7365  lf.px.addItem(se
-00070350: 6c66 2e78 7265 6769 6f6e 2c20 6967 6e6f  lf.xregion, igno
-00070360: 7265 426f 756e 6473 3d46 616c 7365 290d  reBounds=False).
-00070370: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00070380: 662e 7079 2e61 6464 4974 656d 2873 656c  f.py.addItem(sel
-00070390: 662e 7972 6567 696f 6e2c 2069 676e 6f72  f.yregion, ignor
-000703a0: 6542 6f75 6e64 733d 4661 6c73 6529 0d0a  eBounds=False)..
-000703b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000703c0: 2e78 7265 6769 6f6e 2e73 6967 5265 6769  .xregion.sigRegi
-000703d0: 6f6e 4368 616e 6765 4669 6e69 7368 6564  onChangeFinished
-000703e0: 2e63 6f6e 6e65 6374 286c 616d 6264 6120  .connect(lambda 
-000703f0: 7265 6769 6f6e 3a20 7365 6c66 2e4f 6e4c  region: self.OnL
-00070400: 696e 5265 6769 6f6e 2872 6567 696f 6e29  inRegion(region)
-00070410: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00070420: 656c 662e 7972 6567 696f 6e2e 7369 6752  elf.yregion.sigR
-00070430: 6567 696f 6e43 6861 6e67 6546 696e 6973  egionChangeFinis
-00070440: 6865 642e 636f 6e6e 6563 7428 6c61 6d62  hed.connect(lamb
-00070450: 6461 2072 6567 696f 6e3a 2073 656c 662e  da region: self.
-00070460: 4f6e 4c69 6e52 6567 696f 6e28 7265 6769  OnLinRegion(regi
-00070470: 6f6e 2929 0d0a 0d0a 2020 2020 2020 2020  on))....        
-00070480: 2020 2020 7365 6c66 2e78 7363 6174 7465      self.xscatte
-00070490: 7220 3d20 7067 2e53 6361 7474 6572 506c  r = pg.ScatterPl
-000704a0: 6f74 4974 656d 2870 784d 6f64 653d 4661  otItem(pxMode=Fa
-000704b0: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
-000704c0: 2020 7365 6c66 2e79 7363 6174 7465 7220    self.yscatter 
-000704d0: 3d20 7067 2e53 6361 7474 6572 506c 6f74  = pg.ScatterPlot
-000704e0: 4974 656d 2870 784d 6f64 653d 4661 6c73  Item(pxMode=Fals
-000704f0: 6529 0d0a 0d0a 2020 2020 2020 2020 2020  e)....          
-00070500: 2020 7365 6c66 2e49 6e69 7453 6869 6674    self.InitShift
-00070510: 7344 6963 7428 290d 0a0d 0a20 2020 2020  sDict()....     
-00070520: 2020 2020 2020 2073 656c 662e 7078 2e61         self.px.a
-00070530: 6464 4974 656d 2873 656c 662e 7873 6361  ddItem(self.xsca
-00070540: 7474 6572 290d 0a20 2020 2020 2020 2020  tter)..         
-00070550: 2020 2073 656c 662e 7079 2e61 6464 4974     self.py.addIt
-00070560: 656d 2873 656c 662e 7973 6361 7474 6572  em(self.yscatter
-00070570: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00070580: 656c 662e 4d61 6b65 4e65 7753 6361 7474  elf.MakeNewScatt
-00070590: 6572 506c 6f74 7328 290d 0a20 2020 2020  erPlots()..     
-000705a0: 2020 2020 2020 2023 7365 6c66 2e73 6869         #self.shi
-000705b0: 6674 7320 3d20 7365 6c66 2e73 7461 636b  fts = self.stack
-000705c0: 2e73 6869 6674 732e 636f 7079 2829 0d0a  .shifts.copy()..
-000705d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000705e0: 2e78 7363 6174 7465 722e 7369 6743 6c69  .xscatter.sigCli
-000705f0: 636b 6564 2e63 6f6e 6e65 6374 2873 656c  cked.connect(sel
-00070600: 662e 4f6e 506f 696e 7443 6c69 636b 6564  f.OnPointClicked
-00070610: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00070620: 656c 662e 7973 6361 7474 6572 2e73 6967  elf.yscatter.sig
-00070630: 436c 6963 6b65 642e 636f 6e6e 6563 7428  Clicked.connect(
-00070640: 7365 6c66 2e4f 6e50 6f69 6e74 436c 6963  self.OnPointClic
-00070650: 6b65 6429 0d0a 2020 2020 2020 2020 2020  ked)..          
-00070660: 2020 7365 6c66 2e63 625f 6175 746f 6372    self.cb_autocr
-00070670: 6f70 2e74 6f67 676c 6564 2e63 6f6e 6e65  op.toggled.conne
-00070680: 6374 2873 656c 662e 4f6e 4175 746f 4372  ct(self.OnAutoCr
-00070690: 6f70 290d 0a20 2020 2064 6566 2049 6e69  op)..    def Ini
-000706a0: 7453 6869 6674 7344 6963 7428 7365 6c66  tShiftsDict(self
-000706b0: 293a 0d0a 2020 2020 2020 2020 6f75 7465  ):..        oute
-000706c0: 725f 6b65 7973 203d 2072 616e 6765 286d  r_keys = range(m
-000706d0: 6178 2873 656c 662e 7374 6163 6b2e 6e5f  ax(self.stack.n_
-000706e0: 7468 6574 612c 3129 290d 0a20 2020 2020  theta,1))..     
-000706f0: 2020 2069 6e6e 6572 5f6b 6579 7320 3d20     inner_keys = 
-00070700: 5b22 7864 6f74 7322 2c20 2279 646f 7473  ["xdots", "ydots
-00070710: 222c 2022 7873 6869 6674 7322 2c20 2279  ", "xshifts", "y
-00070720: 7368 6966 7473 222c 2022 6572 726f 7273  shifts", "errors
-00070730: 222c 2022 6572 726f 726d 6173 6b65 6478  ", "errormaskedx
-00070740: 222c 2265 7272 6f72 6d61 736b 6564 7922  ","errormaskedy"
-00070750: 2c22 6d61 6e75 616c 6d61 736b 6564 7822  ,"manualmaskedx"
-00070760: 2c22 6d61 6e75 616c 6d61 736b 6564 7922  ,"manualmaskedy"
-00070770: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
-00070780: 7374 6163 6b2e 7368 6966 7473 6469 6374  stack.shiftsdict
-00070790: 203d 207b 696e 746b 6579 203a 207b 6b65   = {intkey : {ke
-000707a0: 793a 205b 4661 6c73 655d 202a 2069 6e74  y: [False] * int
-000707b0: 2873 656c 662e 7374 6163 6b2e 6e5f 6576  (self.stack.n_ev
-000707c0: 2920 666f 7220 6b65 7920 696e 2069 6e6e  ) for key in inn
-000707d0: 6572 5f6b 6579 737d 2066 6f72 2069 6e74  er_keys} for int
-000707e0: 6b65 7920 696e 206f 7574 6572 5f6b 6579  key in outer_key
-000707f0: 737d 0d0a 2020 2020 2020 2020 7369 6e67  s}..        sing
-00070800: 6c65 5f6b 6579 7320 3d20 5b22 6669 6c74  le_keys = ["filt
-00070810: 6572 222c 2022 6d65 7468 6f64 222c 2022  er", "method", "
-00070820: 6175 746f 7175 616c 6974 7922 2c20 2265  autoquality", "e
-00070830: 7874 7261 706f 6c61 7469 6f6e 222c 2022  xtrapolation", "
-00070840: 7468 7265 7368 6f6c 6422 2c20 2272 6567  threshold", "reg
-00070850: 696f 6e6c 696d 6974 7822 2c20 2272 6567  ionlimitx", "reg
-00070860: 696f 6e6c 696d 6974 7922 5d0d 0a20 2020  ionlimity"]..   
-00070870: 2020 2020 2066 6f72 2069 6e74 6b65 7920       for intkey 
-00070880: 696e 206f 7574 6572 5f6b 6579 733a 0d0a  in outer_keys:..
-00070890: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000708a0: 2e73 7461 636b 2e73 6869 6674 7364 6963  .stack.shiftsdic
-000708b0: 745b 696e 746b 6579 5d2e 7570 6461 7465  t[intkey].update
-000708c0: 287b 6b65 793a 2046 616c 7365 2066 6f72  ({key: False for
-000708d0: 206b 6579 2069 6e20 7369 6e67 6c65 5f6b   key in single_k
-000708e0: 6579 737d 290d 0a20 2020 2064 6566 2043  eys})..    def C
-000708f0: 7265 6174 6553 6361 7474 6572 446f 7473  reateScatterDots
-00070900: 2873 656c 662c 7368 6966 7473 2c6d 6173  (self,shifts,mas
-00070910: 6b29 3a0d 0a20 2020 2020 2020 2073 6361  k):..        sca
-00070920: 7474 6572 646f 7473 203d 205b 7b27 706f  tterdots = [{'po
-00070930: 7327 3a20 7475 705b 303a 325d 2c20 2773  s': tup[0:2], 's
-00070940: 697a 6527 3a20 3130 2c0d 0a20 2020 2020  ize': 10,..     
-00070950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070960: 2020 2020 2020 2327 7065 6e27 3a20 7b27        #'pen': {'
-00070970: 636f 6c6f 7227 3a20 2777 272c 2027 7769  color': 'w', 'wi
-00070980: 6474 6827 3a20 327d 2c0d 0a20 2020 2020  dth': 2},..     
-00070990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000709a0: 2020 2020 2020 2762 7275 7368 273a 2051        'brush': Q
-000709b0: 7447 7569 2e51 436f 6c6f 7228 2772 6564  tGui.QColor('red
-000709c0: 2729 7d20 6966 2074 7570 5b32 5d20 656c  ')} if tup[2] el
-000709d0: 7365 207b 2770 6f73 273a 2074 7570 5b30  se {'pos': tup[0
-000709e0: 3a32 5d2c 2027 7369 7a65 273a 2031 302c  :2], 'size': 10,
-000709f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00070a00: 2020 2020 2020 2020 2020 2020 2023 2770               #'p
-00070a10: 656e 273a 207b 2763 6f6c 6f72 273a 2027  en': {'color': '
-00070a20: 7727 2c20 2777 6964 7468 273a 2032 7d2c  w', 'width': 2},
-00070a30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00070a40: 2020 2020 2020 2020 2020 2020 2027 6272               'br
-00070a50: 7573 6827 3a20 5174 4775 692e 5143 6f6c  ush': QtGui.QCol
-00070a60: 6f72 2827 626c 7565 2729 7d20 666f 7220  or('blue')} for 
-00070a70: 7475 7020 696e 206c 6973 7428 7a69 7028  tup in list(zip(
-00070a80: 7365 6c66 2e73 7461 636b 2e65 762c 2073  self.stack.ev, s
-00070a90: 6869 6674 732c 206d 6173 6b29 295d 0d0a  hifts, mask))]..
-00070aa0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00070ab0: 6361 7474 6572 646f 7473 0d0a 0d0a 2020  catterdots....  
-00070ac0: 2020 6465 6620 4f6e 506f 696e 7443 6c69    def OnPointCli
-00070ad0: 636b 6564 2873 656c 662c 206f 626a 2c20  cked(self, obj, 
-00070ae0: 706f 696e 7473 293a 2023 204d 616e 7561  points): # Manua
-00070af0: 6c6c 7920 6164 642f 7265 6d6f 7665 2070  lly add/remove p
-00070b00: 6f69 6e74 7320 746f 2f66 726f 6d20 6669  oints to/from fi
-00070b10: 7420 6966 2069 6e20 7365 6c65 6374 6564  t if in selected
-00070b20: 2072 6567 696f 6e0d 0a20 2020 2020 2020   region..       
-00070b30: 2073 656c 6563 7473 6361 7474 6572 203d   selectscatter =
-00070b40: 207b 7365 6c66 2e78 7363 6174 7465 723a   {self.xscatter:
-00070b50: 205b 2265 7272 6f72 6d61 736b 6564 7822   ["errormaskedx"
-00070b60: 2c22 6d61 6e75 616c 6d61 736b 6564 7822  ,"manualmaskedx"
-00070b70: 2c73 656c 662e 7872 6567 696f 6e5d 2c20  ,self.xregion], 
-00070b80: 7365 6c66 2e79 7363 6174 7465 723a 205b  self.yscatter: [
-00070b90: 2265 7272 6f72 6d61 736b 6564 7922 2c22  "errormaskedy","
-00070ba0: 6d61 6e75 616c 6d61 736b 6564 7922 2c73  manualmaskedy",s
-00070bb0: 656c 662e 7972 6567 696f 6e5d 7d0d 0a20  elf.yregion]}.. 
-00070bc0: 2020 2020 2020 2069 6478 203d 2070 6f69         idx = poi
-00070bd0: 6e74 735b 305d 2e69 6e64 6578 2829 0d0a  nts[0].index()..
-00070be0: 2020 2020 2020 2020 6d61 736b 3120 3d20          mask1 = 
-00070bf0: 7365 6c66 2e73 7461 636b 2e73 6869 6674  self.stack.shift
-00070c00: 7364 6963 745b 7365 6c66 2e69 7468 6574  sdict[self.ithet
-00070c10: 615d 5b73 656c 6563 7473 6361 7474 6572  a][selectscatter
-00070c20: 5b6f 626a 5d5b 315d 5d0d 0a20 2020 2020  [obj][1]]..     
-00070c30: 2020 206d 6173 6b32 203d 2073 656c 662e     mask2 = self.
-00070c40: 7374 6163 6b2e 7368 6966 7473 6469 6374  stack.shiftsdict
-00070c50: 5b73 656c 662e 6974 6865 7461 5d5b 7365  [self.itheta][se
-00070c60: 6c65 6374 7363 6174 7465 725b 6f62 6a5d  lectscatter[obj]
-00070c70: 5b30 5d5d 0d0a 2020 2020 2020 2020 6d69  [0]]..        mi
-00070c80: 6e5f 6964 782c 206d 6178 5f69 6478 2c20  n_idx, max_idx, 
-00070c90: 2a5f 203d 2073 656c 662e 6765 7444 6174  *_ = self.getDat
-00070ca0: 6143 6c6f 7365 7374 546f 5265 6769 6f6e  aClosestToRegion
-00070cb0: 2873 656c 6563 7473 6361 7474 6572 5b6f  (selectscatter[o
-00070cc0: 626a 5d5b 325d 2c20 6f62 6a29 0d0a 2020  bj][2], obj)..  
-00070cd0: 2020 2020 2020 6966 206d 696e 5f69 6478        if min_idx
-00070ce0: 203c 3d20 6964 7820 3c3d 206d 6178 5f69   <= idx <= max_i
-00070cf0: 6478 203a 0d0a 2020 2020 2020 2020 2020  dx :..          
-00070d00: 2020 6d61 736b 315b 6964 785d 203d 206e    mask1[idx] = n
-00070d10: 6f74 206e 702e 6c6f 6769 6361 6c5f 6f72  ot np.logical_or
-00070d20: 286d 6173 6b31 5b69 6478 5d2c 6d61 736b  (mask1[idx],mask
-00070d30: 325b 6964 785d 290d 0a20 2020 2020 2020  2[idx])..       
-00070d40: 2020 2020 206d 6173 6b32 5b69 6478 5d20       mask2[idx] 
-00070d50: 3d20 6d61 736b 315b 6964 785d 0d0a 2020  = mask1[idx]..  
-00070d60: 2020 2020 2020 2020 2020 7365 6c66 2e43            self.C
-00070d70: 6f6c 6f72 697a 6553 6361 7474 6572 446f  olorizeScatterDo
-00070d80: 7473 2829 0d0a 2020 2020 2020 2020 2020  ts()..          
-00070d90: 2020 7365 6c66 2e4f 6e53 6372 6f6c 6c45    self.OnScrollE
-00070da0: 6e67 2870 6f69 6e74 735b 305d 2e69 6e64  ng(points[0].ind
-00070db0: 6578 2829 290d 0a20 2020 2020 2020 2020  ex())..         
-00070dc0: 2020 2069 6620 7365 6c66 2e61 6c69 676e     if self.align
-00070dd0: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-00070de0: 2020 2020 2073 656c 662e 436f 6d70 6f73       self.Compos
-00070df0: 6553 6869 6674 5175 6575 6528 290d 0a20  eShiftQueue().. 
-00070e00: 2020 2064 6566 204f 6e41 6c69 676e 6564     def OnAligned
-00070e10: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00070e20: 2073 656c 662e 616c 6967 6e65 6420 3d20   self.aligned = 
-00070e30: 5472 7565 0d0a 2020 2020 2020 2020 7072  True..        pr
-00070e40: 696e 7428 2261 6c69 676e 6564 2229 0d0a  int("aligned")..
-00070e50: 2020 2020 2020 2020 7365 6c66 2e63 625f          self.cb_
-00070e60: 6175 746f 6572 726f 722e 7374 6174 6543  autoerror.stateC
-00070e70: 6861 6e67 6564 2e64 6973 636f 6e6e 6563  hanged.disconnec
-00070e80: 7428 290d 0a20 2020 2020 2020 2073 656c  t()..        sel
-00070e90: 662e 6362 5f65 7874 7261 706f 6c61 7465  f.cb_extrapolate
-00070ea0: 2e73 7461 7465 4368 616e 6765 642e 6469  .stateChanged.di
-00070eb0: 7363 6f6e 6e65 6374 2829 0d0a 2020 2020  sconnect()..    
-00070ec0: 2020 2020 7365 6c66 2e73 7069 6e42 6f78      self.spinBox
-00070ed0: 4669 6c74 6572 7369 7a65 2e76 616c 7565  Filtersize.value
-00070ee0: 4368 616e 6765 642e 6469 7363 6f6e 6e65  Changed.disconne
-00070ef0: 6374 2829 0d0a 2020 2020 2020 2020 7365  ct()..        se
-00070f00: 6c66 2e73 7069 6e42 6f78 4572 726f 722e  lf.spinBoxError.
-00070f10: 7661 6c75 6543 6861 6e67 6564 2e64 6973  valueChanged.dis
-00070f20: 636f 6e6e 6563 7428 290d 0a20 2020 2020  connect()..     
-00070f30: 2020 2073 656c 662e 636f 6d62 6f42 6f78     self.comboBox
-00070f40: 5f61 7070 726f 782e 6375 7272 656e 7449  _approx.currentI
-00070f50: 6e64 6578 4368 616e 6765 642e 6469 7363  ndexChanged.disc
-00070f60: 6f6e 6e65 6374 2829 0d0a 2020 2020 2020  onnect()..      
-00070f70: 2020 7365 6c66 2e4d 616b 654e 6577 5363    self.MakeNewSc
-00070f80: 6174 7465 7250 6c6f 7473 2829 0d0a 2020  atterPlots()..  
-00070f90: 2020 2020 2020 7365 6c66 2e4f 6e4c 696e        self.OnLin
-00070fa0: 5265 6769 6f6e 2873 656c 662e 7872 6567  Region(self.xreg
-00070fb0: 696f 6e2c 2075 7064 6174 653d 4661 6c73  ion, update=Fals
-00070fc0: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-00070fd0: 2e4f 6e4c 696e 5265 6769 6f6e 2873 656c  .OnLinRegion(sel
-00070fe0: 662e 7972 6567 696f 6e2c 2075 7064 6174  f.yregion, updat
-00070ff0: 653d 4661 6c73 6529 0d0a 2020 2020 2020  e=False)..      
-00071000: 2020 7365 6c66 2e43 6f6d 706f 7365 5368    self.ComposeSh
-00071010: 6966 7451 7565 7565 2869 6e69 743d 5472  iftQueue(init=Tr
-00071020: 7565 290d 0a0d 0a20 2020 2023 202d 2d2d  ue)....    # ---
-00071030: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00071040: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00071050: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00071060: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00071070: 2d2d 2d0d 0a20 2020 2064 6566 204d 6173  ---..    def Mas
-00071080: 6b65 6453 6361 7474 6572 446f 7473 4172  kedScatterDotsAr
-00071090: 7261 7928 7365 6c66 2c72 6567 696f 6e29  ray(self,region)
-000710a0: 3a0d 0a20 2020 2020 2020 2073 656c 6563  :..        selec
-000710b0: 7469 6f6e 203d 207b 7365 6c66 2e78 7265  tion = {self.xre
-000710c0: 6769 6f6e 203a 205b 2265 7272 6f72 6d61  gion : ["errorma
-000710d0: 736b 6564 7822 2c22 6d61 6e75 616c 6d61  skedx","manualma
-000710e0: 736b 6564 7822 5d2c 2073 656c 662e 7972  skedx"], self.yr
-000710f0: 6567 696f 6e20 3a20 5b22 6572 726f 726d  egion : ["errorm
-00071100: 6173 6b65 6479 222c 226d 616e 7561 6c6d  askedy","manualm
-00071110: 6173 6b65 6479 225d 7d0d 0a20 2020 2020  askedy"]}..     
-00071120: 2020 2061 7272 6179 203d 206e 702e 6c6f     array = np.lo
-00071130: 6769 6361 6c5f 6f72 2873 656c 662e 7374  gical_or(self.st
-00071140: 6163 6b2e 7368 6966 7473 6469 6374 5b73  ack.shiftsdict[s
-00071150: 656c 662e 6974 6865 7461 5d5b 7365 6c65  elf.itheta][sele
-00071160: 6374 696f 6e5b 7265 6769 6f6e 5d5b 305d  ction[region][0]
-00071170: 5d2c 2073 656c 662e 7374 6163 6b2e 7368  ], self.stack.sh
-00071180: 6966 7473 6469 6374 5b73 656c 662e 6974  iftsdict[self.it
-00071190: 6865 7461 5d5b 7365 6c65 6374 696f 6e5b  heta][selection[
-000711a0: 7265 6769 6f6e 5d5b 315d 5d29 0d0a 2020  region][1]])..  
-000711b0: 2020 2020 2020 7265 7475 726e 2061 7272        return arr
-000711c0: 6179 0d0a 2020 2020 6465 6620 4d61 6b65  ay..    def Make
-000711d0: 4e65 7753 6361 7474 6572 506c 6f74 7328  NewScatterPlots(
-000711e0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-000711f0: 7072 696e 7428 226d 616b 656e 6577 7363  print("makenewsc
-00071200: 6174 7465 2229 0d0a 2020 2020 2020 2020  atte")..        
-00071210: 6572 726f 7274 6872 6573 686f 6c64 203d  errorthreshold =
-00071220: 2073 656c 662e 7374 6163 6b2e 7368 6966   self.stack.shif
-00071230: 7473 6469 6374 5b73 656c 662e 6974 6865  tsdict[self.ithe
-00071240: 7461 5d5b 2274 6872 6573 686f 6c64 225d  ta]["threshold"]
-00071250: 0d0a 2020 2020 2020 2020 6572 726f 7273  ..        errors
-00071260: 203d 2073 656c 662e 7374 6163 6b2e 7368   = self.stack.sh
-00071270: 6966 7473 6469 6374 5b73 656c 662e 6974  iftsdict[self.it
-00071280: 6865 7461 5d5b 2265 7272 6f72 7322 5d0d  heta]["errors"].
-00071290: 0a20 2020 2020 2020 2073 656c 662e 4d61  .        self.Ma
-000712a0: 736b 5363 6174 7465 7244 6f74 7341 626f  skScatterDotsAbo
-000712b0: 7665 4572 726f 7254 6872 6573 686f 6c64  veErrorThreshold
-000712c0: 2828 6572 726f 7273 2c65 7272 6f72 7468  ((errors,errorth
-000712d0: 7265 7368 6f6c 642c 7365 6c66 2e69 7468  reshold,self.ith
-000712e0: 6574 6129 290d 0a20 2020 2020 2020 206d  eta))..        m
-000712f0: 6173 6b65 6478 203d 2073 656c 662e 4d61  askedx = self.Ma
-00071300: 736b 6564 5363 6174 7465 7244 6f74 7341  skedScatterDotsA
-00071310: 7272 6179 2873 656c 662e 7872 6567 696f  rray(self.xregio
-00071320: 6e29 0d0a 2020 2020 2020 2020 6d61 736b  n)..        mask
-00071330: 6564 7920 3d20 7365 6c66 2e4d 6173 6b65  edy = self.Maske
-00071340: 6453 6361 7474 6572 446f 7473 4172 7261  dScatterDotsArra
-00071350: 7928 7365 6c66 2e79 7265 6769 6f6e 290d  y(self.yregion).
-00071360: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00071370: 6362 5f61 7574 6f65 7272 6f72 2e73 7461  cb_autoerror.sta
-00071380: 7465 4368 616e 6765 642e 636f 6e6e 6563  teChanged.connec
-00071390: 7428 7365 6c66 2e4f 6e41 7574 6f45 7272  t(self.OnAutoErr
-000713a0: 6f72 290d 0a20 2020 2020 2020 2073 656c  or)..        sel
-000713b0: 662e 6362 5f65 7874 7261 706f 6c61 7465  f.cb_extrapolate
-000713c0: 2e73 7461 7465 4368 616e 6765 642e 636f  .stateChanged.co
-000713d0: 6e6e 6563 7428 7365 6c66 2e4f 6e45 7874  nnect(self.OnExt
-000713e0: 7261 706f 6c61 7465 290d 0a20 2020 2020  rapolate)..     
-000713f0: 2020 2073 656c 662e 7370 696e 426f 7846     self.spinBoxF
-00071400: 696c 7465 7273 697a 652e 7661 6c75 6543  iltersize.valueC
-00071410: 6861 6e67 6564 2e63 6f6e 6e65 6374 2873  hanged.connect(s
-00071420: 656c 662e 4f6e 4669 6c74 6572 290d 0a20  elf.OnFilter).. 
-00071430: 2020 2020 2020 2073 656c 662e 7370 696e         self.spin
-00071440: 426f 7845 7272 6f72 2e76 616c 7565 4368  BoxError.valueCh
-00071450: 616e 6765 642e 636f 6e6e 6563 7428 6c61  anged.connect(la
-00071460: 6d62 6461 2076 616c 7565 3a20 7365 6c66  mbda value: self
-00071470: 2e4f 6e53 7069 6e42 6f78 4572 726f 7228  .OnSpinBoxError(
-00071480: 7661 6c75 6529 290d 0a20 2020 2020 2020  value))..       
-00071490: 2073 656c 662e 636f 6d62 6f42 6f78 5f61   self.comboBox_a
-000714a0: 7070 726f 782e 6375 7272 656e 7449 6e64  pprox.currentInd
-000714b0: 6578 4368 616e 6765 642e 636f 6e6e 6563  exChanged.connec
-000714c0: 7428 6c61 6d62 6461 3a20 7365 6c66 2e43  t(lambda: self.C
-000714d0: 6f6d 706f 7365 5368 6966 7451 7565 7565  omposeShiftQueue
-000714e0: 2869 6e69 743d 4661 6c73 6529 290d 0a0d  (init=False))...
-000714f0: 0a20 2020 2020 2020 2073 656c 662e 7370  .        self.sp
-00071500: 696e 426f 7845 7272 6f72 2e62 6c6f 636b  inBoxError.block
-00071510: 5369 676e 616c 7328 5472 7565 290d 0a20  Signals(True).. 
-00071520: 2020 2020 2020 2073 656c 662e 7370 696e         self.spin
-00071530: 426f 7845 7272 6f72 2e73 6574 4465 6369  BoxError.setDeci
-00071540: 6d61 6c73 2834 290d 0a20 2020 2020 2020  mals(4)..       
-00071550: 2073 656c 662e 7370 696e 426f 7845 7272   self.spinBoxErr
-00071560: 6f72 2e73 6574 4d69 6e69 6d75 6d28 6e70  or.setMinimum(np
-00071570: 2e70 6172 7469 7469 6f6e 2865 7272 6f72  .partition(error
-00071580: 732c 2031 295b 315d 2920 2023 206d 616b  s, 1)[1])  # mak
-00071590: 6573 2073 7572 6520 7468 6174 2061 7420  es sure that at 
-000715a0: 6c65 6173 7420 7477 6f20 656c 656d 656e  least two elemen
-000715b0: 7473 2061 7265 2073 656c 6563 7465 640d  ts are selected.
-000715c0: 0a20 2020 2020 2020 2073 656c 662e 7370  .        self.sp
-000715d0: 696e 426f 7845 7272 6f72 2e73 6574 5374  inBoxError.setSt
-000715e0: 6570 5479 7065 2851 7457 6964 6765 7473  epType(QtWidgets
-000715f0: 2e51 4162 7374 7261 6374 5370 696e 426f  .QAbstractSpinBo
-00071600: 782e 4164 6170 7469 7665 4465 6369 6d61  x.AdaptiveDecima
-00071610: 6c53 7465 7054 7970 6529 0d0a 2020 2020  lStepType)..    
-00071620: 2020 2020 7365 6c66 2e4f 6e41 7574 6f45      self.OnAutoE
-00071630: 7272 6f72 2829 0d0a 2020 2020 2020 2020  rror()..        
-00071640: 7365 6c66 2e73 7069 6e42 6f78 4572 726f  self.spinBoxErro
-00071650: 722e 626c 6f63 6b53 6967 6e61 6c73 2846  r.blockSignals(F
-00071660: 616c 7365 290d 0a0d 0a0d 0a20 2020 2020  alse)......     
-00071670: 2020 2023 7365 6c66 2e73 7069 6e42 6f78     #self.spinBox
-00071680: 4572 726f 722e 7365 7456 616c 7565 2873  Error.setValue(s
-00071690: 656c 662e 6572 726f 726d 6561 6e29 0d0a  elf.errormean)..
-000716a0: 0d0a 2020 2020 2020 2020 2373 656c 662e  ..        #self.
-000716b0: 4f6e 4d61 736b 5363 6174 7465 7244 6f74  OnMaskScatterDot
-000716c0: 7341 626f 7665 4572 726f 7254 6872 6573  sAboveErrorThres
-000716d0: 686f 6c64 2865 7272 6f72 7661 6c73 3d28  hold(errorvals=(
-000716e0: 6572 726f 7273 2c20 726f 756e 6428 6e70  errors, round(np
-000716f0: 2e6d 6561 6e28 6572 726f 7273 292c 3429  .mean(errors),4)
-00071700: 2929 0d0a 2020 2020 2020 2020 2373 656c  ))..        #sel
-00071710: 662e 7873 6361 7474 6572 2e61 6464 506f  f.xscatter.addPo
-00071720: 696e 7473 2873 706f 7473 3d73 656c 662e  ints(spots=self.
-00071730: 4372 6561 7465 5363 6174 7465 7244 6f74  CreateScatterDot
-00071740: 7328 7864 6f74 7329 2c20 7078 4d6f 6465  s(xdots), pxMode
-00071750: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-00071760: 2373 656c 662e 7973 6361 7474 6572 2e61  #self.yscatter.a
-00071770: 6464 506f 696e 7473 2873 706f 7473 3d73  ddPoints(spots=s
-00071780: 656c 662e 4372 6561 7465 5363 6174 7465  elf.CreateScatte
-00071790: 7244 6f74 7328 7964 6f74 7329 2c20 7078  rDots(ydots), px
-000717a0: 4d6f 6465 3d54 7275 6529 0d0a 2020 2020  Mode=True)..    
-000717b0: 2020 2020 7864 6f74 7320 3d20 7365 6c66      xdots = self
-000717c0: 2e73 7461 636b 2e73 6869 6674 7364 6963  .stack.shiftsdic
-000717d0: 745b 7365 6c66 2e69 7468 6574 615d 5b22  t[self.itheta]["
-000717e0: 7864 6f74 7322 5d0d 0a20 2020 2020 2020  xdots"]..       
-000717f0: 2079 646f 7473 203d 2073 656c 662e 7374   ydots = self.st
-00071800: 6163 6b2e 7368 6966 7473 6469 6374 5b73  ack.shiftsdict[s
-00071810: 656c 662e 6974 6865 7461 5d5b 2279 646f  elf.itheta]["ydo
-00071820: 7473 225d 0d0a 2020 2020 2020 2020 7365  ts"]..        se
-00071830: 6c66 2e78 7363 6174 7465 722e 7365 7444  lf.xscatter.setD
-00071840: 6174 6128 7370 6f74 733d 7365 6c66 2e43  ata(spots=self.C
-00071850: 7265 6174 6553 6361 7474 6572 446f 7473  reateScatterDots
-00071860: 2878 646f 7473 2c6d 6173 6b65 6478 292c  (xdots,maskedx),
-00071870: 2070 784d 6f64 653d 5472 7565 290d 0a20   pxMode=True).. 
-00071880: 2020 2020 2020 2073 656c 662e 7973 6361         self.ysca
-00071890: 7474 6572 2e73 6574 4461 7461 2873 706f  tter.setData(spo
-000718a0: 7473 3d73 656c 662e 4372 6561 7465 5363  ts=self.CreateSc
-000718b0: 6174 7465 7244 6f74 7328 7964 6f74 732c  atterDots(ydots,
-000718c0: 6d61 736b 6564 7929 2c20 7078 4d6f 6465  maskedy), pxMode
-000718d0: 3d54 7275 6529 0d0a 0d0a 2020 2020 6465  =True)....    de
-000718e0: 6620 4f6e 4175 746f 4572 726f 7228 7365  f OnAutoError(se
-000718f0: 6c66 293a 0d0a 2020 2020 2020 2020 7072  lf):..        pr
-00071900: 696e 7428 226f 6e61 7574 6f65 7272 6f72  int("onautoerror
-00071910: 222c 7365 6c66 2e73 7461 636b 2e73 6869  ",self.stack.shi
-00071920: 6674 7364 6963 745b 7365 6c66 2e69 7468  ftsdict[self.ith
-00071930: 6574 615d 5b22 7468 7265 7368 6f6c 6422  eta]["threshold"
-00071940: 5d29 0d0a 2020 2020 2020 2020 7365 6c66  ])..        self
-00071950: 2e73 7461 636b 2e73 6869 6674 7364 6963  .stack.shiftsdic
-00071960: 745b 7365 6c66 2e69 7468 6574 615d 5b22  t[self.itheta]["
-00071970: 6175 746f 7175 616c 6974 7922 5d20 3d20  autoquality"] = 
-00071980: 7365 6c66 2e63 625f 6175 746f 6572 726f  self.cb_autoerro
-00071990: 722e 6973 4368 6563 6b65 6428 290d 0a20  r.isChecked().. 
-000719a0: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
-000719b0: 6b2e 7368 6966 7473 6469 6374 5b73 656c  k.shiftsdict[sel
-000719c0: 662e 6974 6865 7461 5d5b 2274 6872 6573  f.itheta]["thres
-000719d0: 686f 6c64 225d 203d 2072 6f75 6e64 286e  hold"] = round(n
-000719e0: 702e 6d65 616e 2873 656c 662e 7374 6163  p.mean(self.stac
-000719f0: 6b2e 7368 6966 7473 6469 6374 5b73 656c  k.shiftsdict[sel
-00071a00: 662e 6974 6865 7461 5d5b 2265 7272 6f72  f.itheta]["error
-00071a10: 7322 5d29 2c0d 0a20 2020 2020 2020 2020  s"]),..         
-00071a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071a50: 2020 2020 2020 2034 290d 0a20 2020 2020         4)..     
-00071a60: 2020 2069 6620 7365 6c66 2e63 625f 6175     if self.cb_au
-00071a70: 746f 6572 726f 722e 6973 4368 6563 6b65  toerror.isChecke
-00071a80: 6428 2920 616e 6420 7365 6c66 2e61 6c69  d() and self.ali
-00071a90: 676e 6564 3a0d 0a20 2020 2020 2020 2020  gned:..         
-00071aa0: 2020 2073 656c 662e 7370 696e 426f 7845     self.spinBoxE
-00071ab0: 7272 6f72 2e73 6574 456e 6162 6c65 6428  rror.setEnabled(
-00071ac0: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
-00071ad0: 2020 2073 656c 662e 7370 696e 426f 7845     self.spinBoxE
-00071ae0: 7272 6f72 2e73 6574 5661 6c75 6528 7365  rror.setValue(se
-00071af0: 6c66 2e73 7461 636b 2e73 6869 6674 7364  lf.stack.shiftsd
-00071b00: 6963 745b 7365 6c66 2e69 7468 6574 615d  ict[self.itheta]
-00071b10: 5b22 7468 7265 7368 6f6c 6422 5d29 0d0a  ["threshold"])..
-00071b20: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00071b30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00071b40: 7370 696e 426f 7845 7272 6f72 2e73 6574  spinBoxError.set
-00071b50: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
-00071b60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00071b70: 2e73 7069 6e42 6f78 4572 726f 722e 7365  .spinBoxError.se
-00071b80: 7456 616c 7565 2831 290d 0a20 2020 2064  tValue(1)..    d
-00071b90: 6566 204f 6e53 7069 6e42 6f78 4572 726f  ef OnSpinBoxErro
-00071ba0: 7228 7365 6c66 2c76 616c 7565 293a 0d0a  r(self,value):..
-00071bb0: 2020 2020 2020 2020 7072 696e 7428 226f          print("o
-00071bc0: 6e73 7069 6e62 6f78 6572 726f 7222 290d  nspinboxerror").
-00071bd0: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
-00071be0: 6163 6b2e 7368 6966 7473 6469 6374 5b73  ack.shiftsdict[s
-00071bf0: 656c 662e 6974 6865 7461 5d5b 2274 6872  elf.itheta]["thr
-00071c00: 6573 686f 6c64 225d 203d 2076 616c 7565  eshold"] = value
-00071c10: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
-00071c20: 7365 6c66 2e73 7461 636b 2e73 6869 6674  self.stack.shift
-00071c30: 7364 6963 745b 7365 6c66 2e69 7468 6574  sdict[self.ithet
-00071c40: 615d 5b22 7468 7265 7368 6f6c 6422 5d29  a]["threshold"])
-00071c50: 0d0a 2020 2020 2020 2020 7365 6c66 2e4d  ..        self.M
-00071c60: 6173 6b53 6361 7474 6572 446f 7473 4162  askScatterDotsAb
-00071c70: 6f76 6545 7272 6f72 5468 7265 7368 6f6c  oveErrorThreshol
-00071c80: 6428 2873 656c 662e 7374 6163 6b2e 7368  d((self.stack.sh
-00071c90: 6966 7473 6469 6374 5b73 656c 662e 6974  iftsdict[self.it
-00071ca0: 6865 7461 5d5b 2265 7272 6f72 7322 5d2c  heta]["errors"],
-00071cb0: 2076 616c 7565 2c20 7365 6c66 2e69 7468   value, self.ith
-00071cc0: 6574 6129 290d 0a20 2020 2020 2020 2073  eta))..        s
-00071cd0: 656c 662e 436f 6c6f 7269 7a65 5363 6174  elf.ColorizeScat
-00071ce0: 7465 7244 6f74 7328 290d 0a20 2020 2020  terDots()..     
-00071cf0: 2020 2073 656c 662e 436f 6d70 6f73 6553     self.ComposeS
-00071d00: 6869 6674 5175 6575 6528 696e 6974 3d46  hiftQueue(init=F
-00071d10: 616c 7365 290d 0a20 2020 2064 6566 204f  alse)..    def O
-00071d20: 6e45 7874 7261 706f 6c61 7465 2873 656c  nExtrapolate(sel
-00071d30: 6629 3a0d 0a20 2020 2020 2020 2073 656c  f):..        sel
-00071d40: 662e 436f 6d70 6f73 6553 6869 6674 5175  f.ComposeShiftQu
-00071d50: 6575 6528 696e 6974 3d46 616c 7365 290d  eue(init=False).
-00071d60: 0a20 2020 2064 6566 204f 6e46 696c 7465  .    def OnFilte
-00071d70: 7228 7365 6c66 293a 0d0a 2020 2020 2020  r(self):..      
-00071d80: 2020 7365 6c66 2e43 6f6d 706f 7365 5368    self.ComposeSh
-00071d90: 6966 7451 7565 7565 2869 6e69 743d 4661  iftQueue(init=Fa
-00071da0: 6c73 6529 0d0a 0d0a 2020 2020 6465 6620  lse)....    def 
-00071db0: 436f 6c6f 7269 7a65 5363 6174 7465 7244  ColorizeScatterD
-00071dc0: 6f74 7328 7365 6c66 293a 0d0a 2020 2020  ots(self):..    
-00071dd0: 2020 2020 6272 7573 6865 7378 203d 205b      brushesx = [
-00071de0: 5174 4775 692e 5143 6f6c 6f72 2827 7265  QtGui.QColor('re
-00071df0: 6427 2920 6966 2062 6f6f 6c20 656c 7365  d') if bool else
-00071e00: 2051 7447 7569 2e51 436f 6c6f 7228 2762   QtGui.QColor('b
-00071e10: 6c75 6527 2920 666f 7220 626f 6f6c 2069  lue') for bool i
-00071e20: 6e20 7365 6c66 2e4d 6173 6b65 6453 6361  n self.MaskedSca
-00071e30: 7474 6572 446f 7473 4172 7261 7928 7365  tterDotsArray(se
-00071e40: 6c66 2e78 7265 6769 6f6e 295d 0d0a 2020  lf.xregion)]..  
-00071e50: 2020 2020 2020 6272 7573 6865 7379 203d        brushesy =
-00071e60: 205b 5174 4775 692e 5143 6f6c 6f72 2827   [QtGui.QColor('
-00071e70: 7265 6427 2920 6966 2062 6f6f 6c20 656c  red') if bool el
-00071e80: 7365 2051 7447 7569 2e51 436f 6c6f 7228  se QtGui.QColor(
-00071e90: 2762 6c75 6527 2920 666f 7220 626f 6f6c  'blue') for bool
-00071ea0: 2069 6e20 7365 6c66 2e4d 6173 6b65 6453   in self.MaskedS
-00071eb0: 6361 7474 6572 446f 7473 4172 7261 7928  catterDotsArray(
-00071ec0: 7365 6c66 2e79 7265 6769 6f6e 295d 0d0a  self.yregion)]..
-00071ed0: 2020 2020 2020 2020 7365 6c66 2e78 7363          self.xsc
-00071ee0: 6174 7465 722e 7365 7442 7275 7368 2862  atter.setBrush(b
-00071ef0: 7275 7368 6573 782c 7570 6461 7465 3d54  rushesx,update=T
-00071f00: 7275 6529 0d0a 2020 2020 2020 2020 7365  rue)..        se
-00071f10: 6c66 2e79 7363 6174 7465 722e 7365 7442  lf.yscatter.setB
-00071f20: 7275 7368 2862 7275 7368 6573 792c 7570  rush(brushesy,up
-00071f30: 6461 7465 3d54 7275 6529 0d0a 0d0a 2020  date=True)....  
-00071f40: 2020 6465 6620 4d61 736b 5363 6174 7465    def MaskScatte
-00071f50: 7244 6f74 7341 626f 7665 4572 726f 7254  rDotsAboveErrorT
-00071f60: 6872 6573 686f 6c64 2873 656c 662c 2065  hreshold(self, e
-00071f70: 7272 6f72 7661 6c73 3d4e 6f6e 6529 3a0d  rrorvals=None):.
-00071f80: 0a20 2020 2020 2020 2065 7272 6f72 732c  .        errors,
-00071f90: 2065 7272 6f72 7468 7265 7368 6f6c 642c   errorthreshold,
-00071fa0: 2069 7468 6574 6120 3d20 6572 726f 7276   itheta = errorv
-00071fb0: 616c 730d 0a20 2020 2020 2020 2069 6620  als..        if 
-00071fc0: 7365 6c66 2e63 625f 6175 746f 6572 726f  self.cb_autoerro
-00071fd0: 722e 6973 4368 6563 6b65 6428 293a 0d0a  r.isChecked():..
-00071fe0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00071ff0: 2e73 7461 636b 2e73 6869 6674 7364 6963  .stack.shiftsdic
-00072000: 745b 6974 6865 7461 5d5b 2265 7272 6f72  t[itheta]["error
-00072010: 6d61 736b 6564 7822 5d20 3d20 2865 7272  maskedx"] = (err
-00072020: 6f72 7320 3e20 6e70 2e66 6c6f 6174 3634  ors > np.float64
-00072030: 2865 7272 6f72 7468 7265 7368 6f6c 6429  (errorthreshold)
-00072040: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00072050: 656c 662e 7374 6163 6b2e 7368 6966 7473  elf.stack.shifts
-00072060: 6469 6374 5b69 7468 6574 615d 5b22 6572  dict[itheta]["er
-00072070: 726f 726d 6173 6b65 6479 225d 203d 2028  rormaskedy"] = (
-00072080: 6572 726f 7273 203e 206e 702e 666c 6f61  errors > np.floa
-00072090: 7436 3428 6572 726f 7274 6872 6573 686f  t64(errorthresho
-000720a0: 6c64 2929 0d0a 2020 2020 2020 2020 656c  ld))..        el
-000720b0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-000720c0: 2073 656c 662e 7374 6163 6b2e 7368 6966   self.stack.shif
-000720d0: 7473 6469 6374 5b69 7468 6574 615d 5b22  tsdict[itheta]["
-000720e0: 6572 726f 726d 6173 6b65 6478 225d 203d  errormaskedx"] =
-000720f0: 205b 4661 6c73 655d 202a 206c 656e 2865   [False] * len(e
-00072100: 7272 6f72 7329 0d0a 2020 2020 2020 2020  rrors)..        
-00072110: 2020 2020 7365 6c66 2e73 7461 636b 2e73      self.stack.s
-00072120: 6869 6674 7364 6963 745b 6974 6865 7461  hiftsdict[itheta
-00072130: 5d5b 2265 7272 6f72 6d61 736b 6564 7922  ]["errormaskedy"
-00072140: 5d20 3d20 5b46 616c 7365 5d20 2a20 6c65  ] = [False] * le
-00072150: 6e28 6572 726f 7273 290d 0a0d 0a20 2020  n(errors)....   
-00072160: 2023 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   # -------------
-00072170: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00072180: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00072190: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000721a0: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
-000721b0: 6566 2069 6e69 7450 6172 616d 7328 7365  ef initParams(se
-000721c0: 6c66 2c20 6974 6865 7461 293a 0d0a 2020  lf, itheta):..  
-000721d0: 2020 2020 2020 7365 6c66 2e73 7461 636b        self.stack
-000721e0: 2e73 6869 6674 7364 6963 745b 6974 6865  .shiftsdict[ithe
-000721f0: 7461 5d5b 2272 6567 696f 6e6c 696d 6974  ta]["regionlimit
-00072200: 7822 5d20 3d20 7365 6c66 2e67 6574 4461  x"] = self.getDa
-00072210: 7461 436c 6f73 6573 7454 6f52 6567 696f  taClosestToRegio
-00072220: 6e28 7365 6c66 2e78 7265 6769 6f6e 2c73  n(self.xregion,s
-00072230: 656c 662e 7873 6361 7474 6572 2c46 616c  elf.xscatter,Fal
-00072240: 7365 295b 323a 5d0d 0a20 2020 2020 2020  se)[2:]..       
-00072250: 2073 656c 662e 7374 6163 6b2e 7368 6966   self.stack.shif
-00072260: 7473 6469 6374 5b69 7468 6574 615d 5b22  tsdict[itheta]["
-00072270: 7265 6769 6f6e 6c69 6d69 7479 225d 203d  regionlimity"] =
-00072280: 2073 656c 662e 6765 7444 6174 6143 6c6f   self.getDataClo
-00072290: 7365 7374 546f 5265 6769 6f6e 2873 656c  sestToRegion(sel
-000722a0: 662e 7972 6567 696f 6e2c 7365 6c66 2e79  f.yregion,self.y
-000722b0: 7363 6174 7465 722c 4661 6c73 6529 5b32  scatter,False)[2
-000722c0: 3a5d 0d0a 2020 2020 2020 2020 7365 6c66  :]..        self
-000722d0: 2e73 7461 636b 2e73 6869 6674 7364 6963  .stack.shiftsdic
-000722e0: 745b 6974 6865 7461 5d5b 2266 696c 7465  t[itheta]["filte
-000722f0: 7222 5d20 3d20 7365 6c66 2e73 7069 6e42  r"] = self.spinB
-00072300: 6f78 4669 6c74 6572 7369 7a65 2e76 616c  oxFiltersize.val
-00072310: 7565 2829 0d0a 2020 2020 2020 2020 7365  ue()..        se
+00070340: 6c66 2e79 7265 6769 6f6e 2e73 6574 5a56  lf.yregion.setZV
+00070350: 616c 7565 2831 3030 290d 0a20 2020 2020  alue(100)..     
+00070360: 2020 2020 2020 2073 656c 662e 7872 6567         self.xreg
+00070370: 696f 6e2e 7365 745a 5661 6c75 6528 3130  ion.setZValue(10
+00070380: 3029 0d0a 2020 2020 2020 2020 2020 2020  0)..            
+00070390: 7365 6c66 2e70 782e 6164 6449 7465 6d28  self.px.addItem(
+000703a0: 7365 6c66 2e78 7265 6769 6f6e 2c20 6967  self.xregion, ig
+000703b0: 6e6f 7265 426f 756e 6473 3d46 616c 7365  noreBounds=False
+000703c0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+000703d0: 656c 662e 7079 2e61 6464 4974 656d 2873  elf.py.addItem(s
+000703e0: 656c 662e 7972 6567 696f 6e2c 2069 676e  elf.yregion, ign
+000703f0: 6f72 6542 6f75 6e64 733d 4661 6c73 6529  oreBounds=False)
+00070400: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00070410: 6c66 2e78 7265 6769 6f6e 2e73 6967 5265  lf.xregion.sigRe
+00070420: 6769 6f6e 4368 616e 6765 4669 6e69 7368  gionChangeFinish
+00070430: 6564 2e63 6f6e 6e65 6374 286c 616d 6264  ed.connect(lambd
+00070440: 6120 7265 6769 6f6e 3a20 7365 6c66 2e4f  a region: self.O
+00070450: 6e4c 696e 5265 6769 6f6e 2872 6567 696f  nLinRegion(regio
+00070460: 6e29 290d 0a20 2020 2020 2020 2020 2020  n))..           
+00070470: 2073 656c 662e 7972 6567 696f 6e2e 7369   self.yregion.si
+00070480: 6752 6567 696f 6e43 6861 6e67 6546 696e  gRegionChangeFin
+00070490: 6973 6865 642e 636f 6e6e 6563 7428 6c61  ished.connect(la
+000704a0: 6d62 6461 2072 6567 696f 6e3a 2073 656c  mbda region: sel
+000704b0: 662e 4f6e 4c69 6e52 6567 696f 6e28 7265  f.OnLinRegion(re
+000704c0: 6769 6f6e 2929 0d0a 0d0a 2020 2020 2020  gion))....      
+000704d0: 2020 2020 2020 7365 6c66 2e78 7363 6174        self.xscat
+000704e0: 7465 7220 3d20 7067 2e53 6361 7474 6572  ter = pg.Scatter
+000704f0: 506c 6f74 4974 656d 2870 784d 6f64 653d  PlotItem(pxMode=
+00070500: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
+00070510: 2020 2020 7365 6c66 2e79 7363 6174 7465      self.yscatte
+00070520: 7220 3d20 7067 2e53 6361 7474 6572 506c  r = pg.ScatterPl
+00070530: 6f74 4974 656d 2870 784d 6f64 653d 4661  otItem(pxMode=Fa
+00070540: 6c73 6529 0d0a 0d0a 2020 2020 2020 2020  lse)....        
+00070550: 2020 2020 7365 6c66 2e49 6e69 7453 6869      self.InitShi
+00070560: 6674 7344 6963 7428 290d 0a0d 0a20 2020  ftsDict()....   
+00070570: 2020 2020 2020 2020 2073 656c 662e 7078           self.px
+00070580: 2e61 6464 4974 656d 2873 656c 662e 7873  .addItem(self.xs
+00070590: 6361 7474 6572 290d 0a20 2020 2020 2020  catter)..       
+000705a0: 2020 2020 2073 656c 662e 7079 2e61 6464       self.py.add
+000705b0: 4974 656d 2873 656c 662e 7973 6361 7474  Item(self.yscatt
+000705c0: 6572 290d 0a20 2020 2020 2020 2020 2020  er)..           
+000705d0: 2073 656c 662e 4d61 6b65 4e65 7753 6361   self.MakeNewSca
+000705e0: 7474 6572 506c 6f74 7328 290d 0a20 2020  tterPlots()..   
+000705f0: 2020 2020 2020 2020 2023 7365 6c66 2e73           #self.s
+00070600: 6869 6674 7320 3d20 7365 6c66 2e73 7461  hifts = self.sta
+00070610: 636b 2e73 6869 6674 732e 636f 7079 2829  ck.shifts.copy()
+00070620: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00070630: 6c66 2e78 7363 6174 7465 722e 7369 6743  lf.xscatter.sigC
+00070640: 6c69 636b 6564 2e63 6f6e 6e65 6374 2873  licked.connect(s
+00070650: 656c 662e 4f6e 506f 696e 7443 6c69 636b  elf.OnPointClick
+00070660: 6564 290d 0a20 2020 2020 2020 2020 2020  ed)..           
+00070670: 2073 656c 662e 7973 6361 7474 6572 2e73   self.yscatter.s
+00070680: 6967 436c 6963 6b65 642e 636f 6e6e 6563  igClicked.connec
+00070690: 7428 7365 6c66 2e4f 6e50 6f69 6e74 436c  t(self.OnPointCl
+000706a0: 6963 6b65 6429 0d0a 2020 2020 2020 2020  icked)..        
+000706b0: 2020 2020 7365 6c66 2e63 625f 6175 746f      self.cb_auto
+000706c0: 6372 6f70 2e74 6f67 676c 6564 2e63 6f6e  crop.toggled.con
+000706d0: 6e65 6374 2873 656c 662e 4f6e 4175 746f  nect(self.OnAuto
+000706e0: 4372 6f70 290d 0a20 2020 2064 6566 2049  Crop)..    def I
+000706f0: 6e69 7453 6869 6674 7344 6963 7428 7365  nitShiftsDict(se
+00070700: 6c66 293a 0d0a 2020 2020 2020 2020 6f75  lf):..        ou
+00070710: 7465 725f 6b65 7973 203d 2072 616e 6765  ter_keys = range
+00070720: 286d 6178 2873 656c 662e 7374 6163 6b2e  (max(self.stack.
+00070730: 6e5f 7468 6574 612c 3129 290d 0a20 2020  n_theta,1))..   
+00070740: 2020 2020 2069 6e6e 6572 5f6b 6579 7320       inner_keys 
+00070750: 3d20 5b22 7864 6f74 7322 2c20 2279 646f  = ["xdots", "ydo
+00070760: 7473 222c 2022 7873 6869 6674 7322 2c20  ts", "xshifts", 
+00070770: 2279 7368 6966 7473 222c 2022 6572 726f  "yshifts", "erro
+00070780: 7273 222c 2022 6572 726f 726d 6173 6b65  rs", "errormaske
+00070790: 6478 222c 2265 7272 6f72 6d61 736b 6564  dx","errormasked
+000707a0: 7922 2c22 6d61 6e75 616c 6d61 736b 6564  y","manualmasked
+000707b0: 7822 2c22 6d61 6e75 616c 6d61 736b 6564  x","manualmasked
+000707c0: 7922 5d0d 0a20 2020 2020 2020 2073 656c  y"]..        sel
+000707d0: 662e 7374 6163 6b2e 7368 6966 7473 6469  f.stack.shiftsdi
+000707e0: 6374 203d 207b 696e 746b 6579 203a 207b  ct = {intkey : {
+000707f0: 6b65 793a 205b 4661 6c73 655d 202a 2069  key: [False] * i
+00070800: 6e74 2873 656c 662e 7374 6163 6b2e 6e5f  nt(self.stack.n_
+00070810: 6576 2920 666f 7220 6b65 7920 696e 2069  ev) for key in i
+00070820: 6e6e 6572 5f6b 6579 737d 2066 6f72 2069  nner_keys} for i
+00070830: 6e74 6b65 7920 696e 206f 7574 6572 5f6b  ntkey in outer_k
+00070840: 6579 737d 0d0a 2020 2020 2020 2020 7369  eys}..        si
+00070850: 6e67 6c65 5f6b 6579 7320 3d20 5b22 6669  ngle_keys = ["fi
+00070860: 6c74 6572 222c 2022 6d65 7468 6f64 222c  lter", "method",
+00070870: 2022 6175 746f 7175 616c 6974 7922 2c20   "autoquality", 
+00070880: 2265 7874 7261 706f 6c61 7469 6f6e 222c  "extrapolation",
+00070890: 2022 7468 7265 7368 6f6c 6422 2c20 2272   "threshold", "r
+000708a0: 6567 696f 6e6c 696d 6974 7822 2c20 2272  egionlimitx", "r
+000708b0: 6567 696f 6e6c 696d 6974 7922 5d0d 0a20  egionlimity"].. 
+000708c0: 2020 2020 2020 2066 6f72 2069 6e74 6b65         for intke
+000708d0: 7920 696e 206f 7574 6572 5f6b 6579 733a  y in outer_keys:
+000708e0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000708f0: 6c66 2e73 7461 636b 2e73 6869 6674 7364  lf.stack.shiftsd
+00070900: 6963 745b 696e 746b 6579 5d2e 7570 6461  ict[intkey].upda
+00070910: 7465 287b 6b65 793a 2046 616c 7365 2066  te({key: False f
+00070920: 6f72 206b 6579 2069 6e20 7369 6e67 6c65  or key in single
+00070930: 5f6b 6579 737d 290d 0a20 2020 2064 6566  _keys})..    def
+00070940: 2043 7265 6174 6553 6361 7474 6572 446f   CreateScatterDo
+00070950: 7473 2873 656c 662c 7368 6966 7473 2c6d  ts(self,shifts,m
+00070960: 6173 6b29 3a0d 0a20 2020 2020 2020 2073  ask):..        s
+00070970: 6361 7474 6572 646f 7473 203d 205b 7b27  catterdots = [{'
+00070980: 706f 7327 3a20 7475 705b 303a 325d 2c20  pos': tup[0:2], 
+00070990: 2773 697a 6527 3a20 3130 2c0d 0a20 2020  'size': 10,..   
+000709a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000709b0: 2020 2020 2020 2020 2327 7065 6e27 3a20          #'pen': 
+000709c0: 7b27 636f 6c6f 7227 3a20 2777 272c 2027  {'color': 'w', '
+000709d0: 7769 6474 6827 3a20 327d 2c0d 0a20 2020  width': 2},..   
+000709e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000709f0: 2020 2020 2020 2020 2762 7275 7368 273a          'brush':
+00070a00: 2051 7447 7569 2e51 436f 6c6f 7228 2772   QtGui.QColor('r
+00070a10: 6564 2729 7d20 6966 2074 7570 5b32 5d20  ed')} if tup[2] 
+00070a20: 656c 7365 207b 2770 6f73 273a 2074 7570  else {'pos': tup
+00070a30: 5b30 3a32 5d2c 2027 7369 7a65 273a 2031  [0:2], 'size': 1
+00070a40: 302c 0d0a 2020 2020 2020 2020 2020 2020  0,..            
+00070a50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00070a60: 2770 656e 273a 207b 2763 6f6c 6f72 273a  'pen': {'color':
+00070a70: 2027 7727 2c20 2777 6964 7468 273a 2032   'w', 'width': 2
+00070a80: 7d2c 0d0a 2020 2020 2020 2020 2020 2020  },..            
+00070a90: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00070aa0: 6272 7573 6827 3a20 5174 4775 692e 5143  brush': QtGui.QC
+00070ab0: 6f6c 6f72 2827 626c 7565 2729 7d20 666f  olor('blue')} fo
+00070ac0: 7220 7475 7020 696e 206c 6973 7428 7a69  r tup in list(zi
+00070ad0: 7028 7365 6c66 2e73 7461 636b 2e65 762c  p(self.stack.ev,
+00070ae0: 2073 6869 6674 732c 206d 6173 6b29 295d   shifts, mask))]
+00070af0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00070b00: 2073 6361 7474 6572 646f 7473 0d0a 0d0a   scatterdots....
+00070b10: 2020 2020 6465 6620 4f6e 506f 696e 7443      def OnPointC
+00070b20: 6c69 636b 6564 2873 656c 662c 206f 626a  licked(self, obj
+00070b30: 2c20 706f 696e 7473 293a 2023 204d 616e  , points): # Man
+00070b40: 7561 6c6c 7920 6164 642f 7265 6d6f 7665  ually add/remove
+00070b50: 2070 6f69 6e74 7320 746f 2f66 726f 6d20   points to/from 
+00070b60: 6669 7420 6966 2069 6e20 7365 6c65 6374  fit if in select
+00070b70: 6564 2072 6567 696f 6e0d 0a20 2020 2020  ed region..     
+00070b80: 2020 2073 656c 6563 7473 6361 7474 6572     selectscatter
+00070b90: 203d 207b 7365 6c66 2e78 7363 6174 7465   = {self.xscatte
+00070ba0: 723a 205b 2265 7272 6f72 6d61 736b 6564  r: ["errormasked
+00070bb0: 7822 2c22 6d61 6e75 616c 6d61 736b 6564  x","manualmasked
+00070bc0: 7822 2c73 656c 662e 7872 6567 696f 6e5d  x",self.xregion]
+00070bd0: 2c20 7365 6c66 2e79 7363 6174 7465 723a  , self.yscatter:
+00070be0: 205b 2265 7272 6f72 6d61 736b 6564 7922   ["errormaskedy"
+00070bf0: 2c22 6d61 6e75 616c 6d61 736b 6564 7922  ,"manualmaskedy"
+00070c00: 2c73 656c 662e 7972 6567 696f 6e5d 7d0d  ,self.yregion]}.
+00070c10: 0a20 2020 2020 2020 2069 6478 203d 2070  .        idx = p
+00070c20: 6f69 6e74 735b 305d 2e69 6e64 6578 2829  oints[0].index()
+00070c30: 0d0a 2020 2020 2020 2020 6d61 736b 3120  ..        mask1 
+00070c40: 3d20 7365 6c66 2e73 7461 636b 2e73 6869  = self.stack.shi
+00070c50: 6674 7364 6963 745b 7365 6c66 2e69 7468  ftsdict[self.ith
+00070c60: 6574 615d 5b73 656c 6563 7473 6361 7474  eta][selectscatt
+00070c70: 6572 5b6f 626a 5d5b 315d 5d0d 0a20 2020  er[obj][1]]..   
+00070c80: 2020 2020 206d 6173 6b32 203d 2073 656c       mask2 = sel
+00070c90: 662e 7374 6163 6b2e 7368 6966 7473 6469  f.stack.shiftsdi
+00070ca0: 6374 5b73 656c 662e 6974 6865 7461 5d5b  ct[self.itheta][
+00070cb0: 7365 6c65 6374 7363 6174 7465 725b 6f62  selectscatter[ob
+00070cc0: 6a5d 5b30 5d5d 0d0a 2020 2020 2020 2020  j][0]]..        
+00070cd0: 6d69 6e5f 6964 782c 206d 6178 5f69 6478  min_idx, max_idx
+00070ce0: 2c20 2a5f 203d 2073 656c 662e 6765 7444  , *_ = self.getD
+00070cf0: 6174 6143 6c6f 7365 7374 546f 5265 6769  ataClosestToRegi
+00070d00: 6f6e 2873 656c 6563 7473 6361 7474 6572  on(selectscatter
+00070d10: 5b6f 626a 5d5b 325d 2c20 6f62 6a29 0d0a  [obj][2], obj)..
+00070d20: 2020 2020 2020 2020 6966 206d 696e 5f69          if min_i
+00070d30: 6478 203c 3d20 6964 7820 3c3d 206d 6178  dx <= idx <= max
+00070d40: 5f69 6478 203a 0d0a 2020 2020 2020 2020  _idx :..        
+00070d50: 2020 2020 6d61 736b 315b 6964 785d 203d      mask1[idx] =
+00070d60: 206e 6f74 206e 702e 6c6f 6769 6361 6c5f   not np.logical_
+00070d70: 6f72 286d 6173 6b31 5b69 6478 5d2c 6d61  or(mask1[idx],ma
+00070d80: 736b 325b 6964 785d 290d 0a20 2020 2020  sk2[idx])..     
+00070d90: 2020 2020 2020 206d 6173 6b32 5b69 6478         mask2[idx
+00070da0: 5d20 3d20 6d61 736b 315b 6964 785d 0d0a  ] = mask1[idx]..
+00070db0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00070dc0: 2e43 6f6c 6f72 697a 6553 6361 7474 6572  .ColorizeScatter
+00070dd0: 446f 7473 2829 0d0a 2020 2020 2020 2020  Dots()..        
+00070de0: 2020 2020 7365 6c66 2e4f 6e53 6372 6f6c      self.OnScrol
+00070df0: 6c45 6e67 2870 6f69 6e74 735b 305d 2e69  lEng(points[0].i
+00070e00: 6e64 6578 2829 290d 0a20 2020 2020 2020  ndex())..       
+00070e10: 2020 2020 2069 6620 7365 6c66 2e61 6c69       if self.ali
+00070e20: 676e 6564 3a0d 0a20 2020 2020 2020 2020  gned:..         
+00070e30: 2020 2020 2020 2073 656c 662e 436f 6d70         self.Comp
+00070e40: 6f73 6553 6869 6674 5175 6575 6528 290d  oseShiftQueue().
+00070e50: 0a20 2020 2064 6566 204f 6e41 6c69 676e  .    def OnAlign
+00070e60: 6564 2873 656c 6629 3a0d 0a20 2020 2020  ed(self):..     
+00070e70: 2020 2073 656c 662e 616c 6967 6e65 6420     self.aligned 
+00070e80: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+00070e90: 7072 696e 7428 2261 6c69 676e 6564 2229  print("aligned")
+00070ea0: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+00070eb0: 625f 6175 746f 6572 726f 722e 7374 6174  b_autoerror.stat
+00070ec0: 6543 6861 6e67 6564 2e64 6973 636f 6e6e  eChanged.disconn
+00070ed0: 6563 7428 290d 0a20 2020 2020 2020 2073  ect()..        s
+00070ee0: 656c 662e 6362 5f65 7874 7261 706f 6c61  elf.cb_extrapola
+00070ef0: 7465 2e73 7461 7465 4368 616e 6765 642e  te.stateChanged.
+00070f00: 6469 7363 6f6e 6e65 6374 2829 0d0a 2020  disconnect()..  
+00070f10: 2020 2020 2020 7365 6c66 2e73 7069 6e42        self.spinB
+00070f20: 6f78 4669 6c74 6572 7369 7a65 2e76 616c  oxFiltersize.val
+00070f30: 7565 4368 616e 6765 642e 6469 7363 6f6e  ueChanged.discon
+00070f40: 6e65 6374 2829 0d0a 2020 2020 2020 2020  nect()..        
+00070f50: 7365 6c66 2e73 7069 6e42 6f78 4572 726f  self.spinBoxErro
+00070f60: 722e 7661 6c75 6543 6861 6e67 6564 2e64  r.valueChanged.d
+00070f70: 6973 636f 6e6e 6563 7428 290d 0a20 2020  isconnect()..   
+00070f80: 2020 2020 2073 656c 662e 636f 6d62 6f42       self.comboB
+00070f90: 6f78 5f61 7070 726f 782e 6375 7272 656e  ox_approx.curren
+00070fa0: 7449 6e64 6578 4368 616e 6765 642e 6469  tIndexChanged.di
+00070fb0: 7363 6f6e 6e65 6374 2829 0d0a 2020 2020  sconnect()..    
+00070fc0: 2020 2020 7365 6c66 2e4d 616b 654e 6577      self.MakeNew
+00070fd0: 5363 6174 7465 7250 6c6f 7473 2829 0d0a  ScatterPlots()..
+00070fe0: 2020 2020 2020 2020 7365 6c66 2e4f 6e4c          self.OnL
+00070ff0: 696e 5265 6769 6f6e 2873 656c 662e 7872  inRegion(self.xr
+00071000: 6567 696f 6e2c 2075 7064 6174 653d 4661  egion, update=Fa
+00071010: 6c73 6529 0d0a 2020 2020 2020 2020 7365  lse)..        se
+00071020: 6c66 2e4f 6e4c 696e 5265 6769 6f6e 2873  lf.OnLinRegion(s
+00071030: 656c 662e 7972 6567 696f 6e2c 2075 7064  elf.yregion, upd
+00071040: 6174 653d 4661 6c73 6529 0d0a 2020 2020  ate=False)..    
+00071050: 2020 2020 7365 6c66 2e43 6f6d 706f 7365      self.Compose
+00071060: 5368 6966 7451 7565 7565 2869 6e69 743d  ShiftQueue(init=
+00071070: 5472 7565 290d 0a0d 0a20 2020 2023 202d  True)....    # -
+00071080: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00071090: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000710a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000710b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000710c0: 2d2d 2d2d 2d0d 0a20 2020 2064 6566 204d  -----..    def M
+000710d0: 6173 6b65 6453 6361 7474 6572 446f 7473  askedScatterDots
+000710e0: 4172 7261 7928 7365 6c66 2c72 6567 696f  Array(self,regio
+000710f0: 6e29 3a0d 0a20 2020 2020 2020 2073 656c  n):..        sel
+00071100: 6563 7469 6f6e 203d 207b 7365 6c66 2e78  ection = {self.x
+00071110: 7265 6769 6f6e 203a 205b 2265 7272 6f72  region : ["error
+00071120: 6d61 736b 6564 7822 2c22 6d61 6e75 616c  maskedx","manual
+00071130: 6d61 736b 6564 7822 5d2c 2073 656c 662e  maskedx"], self.
+00071140: 7972 6567 696f 6e20 3a20 5b22 6572 726f  yregion : ["erro
+00071150: 726d 6173 6b65 6479 222c 226d 616e 7561  rmaskedy","manua
+00071160: 6c6d 6173 6b65 6479 225d 7d0d 0a20 2020  lmaskedy"]}..   
+00071170: 2020 2020 2061 7272 6179 203d 206e 702e       array = np.
+00071180: 6c6f 6769 6361 6c5f 6f72 2873 656c 662e  logical_or(self.
+00071190: 7374 6163 6b2e 7368 6966 7473 6469 6374  stack.shiftsdict
+000711a0: 5b73 656c 662e 6974 6865 7461 5d5b 7365  [self.itheta][se
+000711b0: 6c65 6374 696f 6e5b 7265 6769 6f6e 5d5b  lection[region][
+000711c0: 305d 5d2c 2073 656c 662e 7374 6163 6b2e  0]], self.stack.
+000711d0: 7368 6966 7473 6469 6374 5b73 656c 662e  shiftsdict[self.
+000711e0: 6974 6865 7461 5d5b 7365 6c65 6374 696f  itheta][selectio
+000711f0: 6e5b 7265 6769 6f6e 5d5b 315d 5d29 0d0a  n[region][1]])..
+00071200: 2020 2020 2020 2020 7265 7475 726e 2061          return a
+00071210: 7272 6179 0d0a 2020 2020 6465 6620 4d61  rray..    def Ma
+00071220: 6b65 4e65 7753 6361 7474 6572 506c 6f74  keNewScatterPlot
+00071230: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
+00071240: 2020 7072 696e 7428 226d 616b 656e 6577    print("makenew
+00071250: 7363 6174 7465 2229 0d0a 2020 2020 2020  scatte")..      
+00071260: 2020 6572 726f 7274 6872 6573 686f 6c64    errorthreshold
+00071270: 203d 2073 656c 662e 7374 6163 6b2e 7368   = self.stack.sh
+00071280: 6966 7473 6469 6374 5b73 656c 662e 6974  iftsdict[self.it
+00071290: 6865 7461 5d5b 2274 6872 6573 686f 6c64  heta]["threshold
+000712a0: 225d 0d0a 2020 2020 2020 2020 6572 726f  "]..        erro
+000712b0: 7273 203d 2073 656c 662e 7374 6163 6b2e  rs = self.stack.
+000712c0: 7368 6966 7473 6469 6374 5b73 656c 662e  shiftsdict[self.
+000712d0: 6974 6865 7461 5d5b 2265 7272 6f72 7322  itheta]["errors"
+000712e0: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
+000712f0: 4d61 736b 5363 6174 7465 7244 6f74 7341  MaskScatterDotsA
+00071300: 626f 7665 4572 726f 7254 6872 6573 686f  boveErrorThresho
+00071310: 6c64 2828 6572 726f 7273 2c65 7272 6f72  ld((errors,error
+00071320: 7468 7265 7368 6f6c 642c 7365 6c66 2e69  threshold,self.i
+00071330: 7468 6574 6129 290d 0a20 2020 2020 2020  theta))..       
+00071340: 206d 6173 6b65 6478 203d 2073 656c 662e   maskedx = self.
+00071350: 4d61 736b 6564 5363 6174 7465 7244 6f74  MaskedScatterDot
+00071360: 7341 7272 6179 2873 656c 662e 7872 6567  sArray(self.xreg
+00071370: 696f 6e29 0d0a 2020 2020 2020 2020 6d61  ion)..        ma
+00071380: 736b 6564 7920 3d20 7365 6c66 2e4d 6173  skedy = self.Mas
+00071390: 6b65 6453 6361 7474 6572 446f 7473 4172  kedScatterDotsAr
+000713a0: 7261 7928 7365 6c66 2e79 7265 6769 6f6e  ray(self.yregion
+000713b0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+000713c0: 662e 6362 5f61 7574 6f65 7272 6f72 2e73  f.cb_autoerror.s
+000713d0: 7461 7465 4368 616e 6765 642e 636f 6e6e  tateChanged.conn
+000713e0: 6563 7428 7365 6c66 2e4f 6e41 7574 6f45  ect(self.OnAutoE
+000713f0: 7272 6f72 290d 0a20 2020 2020 2020 2073  rror)..        s
+00071400: 656c 662e 6362 5f65 7874 7261 706f 6c61  elf.cb_extrapola
+00071410: 7465 2e73 7461 7465 4368 616e 6765 642e  te.stateChanged.
+00071420: 636f 6e6e 6563 7428 7365 6c66 2e4f 6e45  connect(self.OnE
+00071430: 7874 7261 706f 6c61 7465 290d 0a20 2020  xtrapolate)..   
+00071440: 2020 2020 2073 656c 662e 7370 696e 426f       self.spinBo
+00071450: 7846 696c 7465 7273 697a 652e 7661 6c75  xFiltersize.valu
+00071460: 6543 6861 6e67 6564 2e63 6f6e 6e65 6374  eChanged.connect
+00071470: 2873 656c 662e 4f6e 4669 6c74 6572 290d  (self.OnFilter).
+00071480: 0a20 2020 2020 2020 2073 656c 662e 7370  .        self.sp
+00071490: 696e 426f 7845 7272 6f72 2e76 616c 7565  inBoxError.value
+000714a0: 4368 616e 6765 642e 636f 6e6e 6563 7428  Changed.connect(
+000714b0: 6c61 6d62 6461 2076 616c 7565 3a20 7365  lambda value: se
+000714c0: 6c66 2e4f 6e53 7069 6e42 6f78 4572 726f  lf.OnSpinBoxErro
+000714d0: 7228 7661 6c75 6529 290d 0a20 2020 2020  r(value))..     
+000714e0: 2020 2073 656c 662e 636f 6d62 6f42 6f78     self.comboBox
+000714f0: 5f61 7070 726f 782e 6375 7272 656e 7449  _approx.currentI
+00071500: 6e64 6578 4368 616e 6765 642e 636f 6e6e  ndexChanged.conn
+00071510: 6563 7428 6c61 6d62 6461 3a20 7365 6c66  ect(lambda: self
+00071520: 2e43 6f6d 706f 7365 5368 6966 7451 7565  .ComposeShiftQue
+00071530: 7565 2869 6e69 743d 4661 6c73 6529 290d  ue(init=False)).
+00071540: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00071550: 7370 696e 426f 7845 7272 6f72 2e62 6c6f  spinBoxError.blo
+00071560: 636b 5369 676e 616c 7328 5472 7565 290d  ckSignals(True).
+00071570: 0a20 2020 2020 2020 2073 656c 662e 7370  .        self.sp
+00071580: 696e 426f 7845 7272 6f72 2e73 6574 4465  inBoxError.setDe
+00071590: 6369 6d61 6c73 2834 290d 0a20 2020 2020  cimals(4)..     
+000715a0: 2020 2073 656c 662e 7370 696e 426f 7845     self.spinBoxE
+000715b0: 7272 6f72 2e73 6574 4d69 6e69 6d75 6d28  rror.setMinimum(
+000715c0: 6e70 2e70 6172 7469 7469 6f6e 2865 7272  np.partition(err
+000715d0: 6f72 732c 2031 295b 315d 2920 2023 206d  ors, 1)[1])  # m
+000715e0: 616b 6573 2073 7572 6520 7468 6174 2061  akes sure that a
+000715f0: 7420 6c65 6173 7420 7477 6f20 656c 656d  t least two elem
+00071600: 656e 7473 2061 7265 2073 656c 6563 7465  ents are selecte
+00071610: 640d 0a20 2020 2020 2020 2073 656c 662e  d..        self.
+00071620: 7370 696e 426f 7845 7272 6f72 2e73 6574  spinBoxError.set
+00071630: 5374 6570 5479 7065 2851 7457 6964 6765  StepType(QtWidge
+00071640: 7473 2e51 4162 7374 7261 6374 5370 696e  ts.QAbstractSpin
+00071650: 426f 782e 4164 6170 7469 7665 4465 6369  Box.AdaptiveDeci
+00071660: 6d61 6c53 7465 7054 7970 6529 0d0a 2020  malStepType)..  
+00071670: 2020 2020 2020 7365 6c66 2e4f 6e41 7574        self.OnAut
+00071680: 6f45 7272 6f72 2829 0d0a 2020 2020 2020  oError()..      
+00071690: 2020 7365 6c66 2e73 7069 6e42 6f78 4572    self.spinBoxEr
+000716a0: 726f 722e 626c 6f63 6b53 6967 6e61 6c73  ror.blockSignals
+000716b0: 2846 616c 7365 290d 0a0d 0a0d 0a20 2020  (False)......   
+000716c0: 2020 2020 2023 7365 6c66 2e73 7069 6e42       #self.spinB
+000716d0: 6f78 4572 726f 722e 7365 7456 616c 7565  oxError.setValue
+000716e0: 2873 656c 662e 6572 726f 726d 6561 6e29  (self.errormean)
+000716f0: 0d0a 0d0a 2020 2020 2020 2020 2373 656c  ....        #sel
+00071700: 662e 4f6e 4d61 736b 5363 6174 7465 7244  f.OnMaskScatterD
+00071710: 6f74 7341 626f 7665 4572 726f 7254 6872  otsAboveErrorThr
+00071720: 6573 686f 6c64 2865 7272 6f72 7661 6c73  eshold(errorvals
+00071730: 3d28 6572 726f 7273 2c20 726f 756e 6428  =(errors, round(
+00071740: 6e70 2e6d 6561 6e28 6572 726f 7273 292c  np.mean(errors),
+00071750: 3429 2929 0d0a 2020 2020 2020 2020 2373  4)))..        #s
+00071760: 656c 662e 7873 6361 7474 6572 2e61 6464  elf.xscatter.add
+00071770: 506f 696e 7473 2873 706f 7473 3d73 656c  Points(spots=sel
+00071780: 662e 4372 6561 7465 5363 6174 7465 7244  f.CreateScatterD
+00071790: 6f74 7328 7864 6f74 7329 2c20 7078 4d6f  ots(xdots), pxMo
+000717a0: 6465 3d54 7275 6529 0d0a 2020 2020 2020  de=True)..      
+000717b0: 2020 2373 656c 662e 7973 6361 7474 6572    #self.yscatter
+000717c0: 2e61 6464 506f 696e 7473 2873 706f 7473  .addPoints(spots
+000717d0: 3d73 656c 662e 4372 6561 7465 5363 6174  =self.CreateScat
+000717e0: 7465 7244 6f74 7328 7964 6f74 7329 2c20  terDots(ydots), 
+000717f0: 7078 4d6f 6465 3d54 7275 6529 0d0a 2020  pxMode=True)..  
+00071800: 2020 2020 2020 7864 6f74 7320 3d20 7365        xdots = se
+00071810: 6c66 2e73 7461 636b 2e73 6869 6674 7364  lf.stack.shiftsd
+00071820: 6963 745b 7365 6c66 2e69 7468 6574 615d  ict[self.itheta]
+00071830: 5b22 7864 6f74 7322 5d0d 0a20 2020 2020  ["xdots"]..     
+00071840: 2020 2079 646f 7473 203d 2073 656c 662e     ydots = self.
+00071850: 7374 6163 6b2e 7368 6966 7473 6469 6374  stack.shiftsdict
+00071860: 5b73 656c 662e 6974 6865 7461 5d5b 2279  [self.itheta]["y
+00071870: 646f 7473 225d 0d0a 2020 2020 2020 2020  dots"]..        
+00071880: 7365 6c66 2e78 7363 6174 7465 722e 7365  self.xscatter.se
+00071890: 7444 6174 6128 7370 6f74 733d 7365 6c66  tData(spots=self
+000718a0: 2e43 7265 6174 6553 6361 7474 6572 446f  .CreateScatterDo
+000718b0: 7473 2878 646f 7473 2c6d 6173 6b65 6478  ts(xdots,maskedx
+000718c0: 292c 2070 784d 6f64 653d 5472 7565 290d  ), pxMode=True).
+000718d0: 0a20 2020 2020 2020 2073 656c 662e 7973  .        self.ys
+000718e0: 6361 7474 6572 2e73 6574 4461 7461 2873  catter.setData(s
+000718f0: 706f 7473 3d73 656c 662e 4372 6561 7465  pots=self.Create
+00071900: 5363 6174 7465 7244 6f74 7328 7964 6f74  ScatterDots(ydot
+00071910: 732c 6d61 736b 6564 7929 2c20 7078 4d6f  s,maskedy), pxMo
+00071920: 6465 3d54 7275 6529 0d0a 0d0a 2020 2020  de=True)....    
+00071930: 6465 6620 4f6e 4175 746f 4572 726f 7228  def OnAutoError(
+00071940: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00071950: 7072 696e 7428 226f 6e61 7574 6f65 7272  print("onautoerr
+00071960: 6f72 222c 7365 6c66 2e73 7461 636b 2e73  or",self.stack.s
+00071970: 6869 6674 7364 6963 745b 7365 6c66 2e69  hiftsdict[self.i
+00071980: 7468 6574 615d 5b22 7468 7265 7368 6f6c  theta]["threshol
+00071990: 6422 5d29 0d0a 2020 2020 2020 2020 7365  d"])..        se
+000719a0: 6c66 2e73 7461 636b 2e73 6869 6674 7364  lf.stack.shiftsd
+000719b0: 6963 745b 7365 6c66 2e69 7468 6574 615d  ict[self.itheta]
+000719c0: 5b22 6175 746f 7175 616c 6974 7922 5d20  ["autoquality"] 
+000719d0: 3d20 7365 6c66 2e63 625f 6175 746f 6572  = self.cb_autoer
+000719e0: 726f 722e 6973 4368 6563 6b65 6428 290d  ror.isChecked().
+000719f0: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
+00071a00: 6163 6b2e 7368 6966 7473 6469 6374 5b73  ack.shiftsdict[s
+00071a10: 656c 662e 6974 6865 7461 5d5b 2274 6872  elf.itheta]["thr
+00071a20: 6573 686f 6c64 225d 203d 2072 6f75 6e64  eshold"] = round
+00071a30: 286e 702e 6d65 616e 2873 656c 662e 7374  (np.mean(self.st
+00071a40: 6163 6b2e 7368 6966 7473 6469 6374 5b73  ack.shiftsdict[s
+00071a50: 656c 662e 6974 6865 7461 5d5b 2265 7272  elf.itheta]["err
+00071a60: 6f72 7322 5d29 2c0d 0a20 2020 2020 2020  ors"]),..       
+00071a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071aa0: 2020 2020 2020 2020 2034 290d 0a20 2020           4)..   
+00071ab0: 2020 2020 2069 6620 7365 6c66 2e63 625f       if self.cb_
+00071ac0: 6175 746f 6572 726f 722e 6973 4368 6563  autoerror.isChec
+00071ad0: 6b65 6428 2920 616e 6420 7365 6c66 2e61  ked() and self.a
+00071ae0: 6c69 676e 6564 3a0d 0a20 2020 2020 2020  ligned:..       
+00071af0: 2020 2020 2073 656c 662e 7370 696e 426f       self.spinBo
+00071b00: 7845 7272 6f72 2e73 6574 456e 6162 6c65  xError.setEnable
+00071b10: 6428 5472 7565 290d 0a20 2020 2020 2020  d(True)..       
+00071b20: 2020 2020 2073 656c 662e 7370 696e 426f       self.spinBo
+00071b30: 7845 7272 6f72 2e73 6574 5661 6c75 6528  xError.setValue(
+00071b40: 7365 6c66 2e73 7461 636b 2e73 6869 6674  self.stack.shift
+00071b50: 7364 6963 745b 7365 6c66 2e69 7468 6574  sdict[self.ithet
+00071b60: 615d 5b22 7468 7265 7368 6f6c 6422 5d29  a]["threshold"])
+00071b70: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00071b80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00071b90: 662e 7370 696e 426f 7845 7272 6f72 2e73  f.spinBoxError.s
+00071ba0: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
+00071bb0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00071bc0: 6c66 2e73 7069 6e42 6f78 4572 726f 722e  lf.spinBoxError.
+00071bd0: 7365 7456 616c 7565 2831 290d 0a20 2020  setValue(1)..   
+00071be0: 2064 6566 204f 6e53 7069 6e42 6f78 4572   def OnSpinBoxEr
+00071bf0: 726f 7228 7365 6c66 2c76 616c 7565 293a  ror(self,value):
+00071c00: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+00071c10: 226f 6e73 7069 6e62 6f78 6572 726f 7222  "onspinboxerror"
+00071c20: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00071c30: 7374 6163 6b2e 7368 6966 7473 6469 6374  stack.shiftsdict
+00071c40: 5b73 656c 662e 6974 6865 7461 5d5b 2274  [self.itheta]["t
+00071c50: 6872 6573 686f 6c64 225d 203d 2076 616c  hreshold"] = val
+00071c60: 7565 0d0a 2020 2020 2020 2020 7072 696e  ue..        prin
+00071c70: 7428 7365 6c66 2e73 7461 636b 2e73 6869  t(self.stack.shi
+00071c80: 6674 7364 6963 745b 7365 6c66 2e69 7468  ftsdict[self.ith
+00071c90: 6574 615d 5b22 7468 7265 7368 6f6c 6422  eta]["threshold"
+00071ca0: 5d29 0d0a 2020 2020 2020 2020 7365 6c66  ])..        self
+00071cb0: 2e4d 6173 6b53 6361 7474 6572 446f 7473  .MaskScatterDots
+00071cc0: 4162 6f76 6545 7272 6f72 5468 7265 7368  AboveErrorThresh
+00071cd0: 6f6c 6428 2873 656c 662e 7374 6163 6b2e  old((self.stack.
+00071ce0: 7368 6966 7473 6469 6374 5b73 656c 662e  shiftsdict[self.
+00071cf0: 6974 6865 7461 5d5b 2265 7272 6f72 7322  itheta]["errors"
+00071d00: 5d2c 2076 616c 7565 2c20 7365 6c66 2e69  ], value, self.i
+00071d10: 7468 6574 6129 290d 0a20 2020 2020 2020  theta))..       
+00071d20: 2073 656c 662e 436f 6c6f 7269 7a65 5363   self.ColorizeSc
+00071d30: 6174 7465 7244 6f74 7328 290d 0a20 2020  atterDots()..   
+00071d40: 2020 2020 2073 656c 662e 436f 6d70 6f73       self.Compos
+00071d50: 6553 6869 6674 5175 6575 6528 696e 6974  eShiftQueue(init
+00071d60: 3d46 616c 7365 290d 0a20 2020 2064 6566  =False)..    def
+00071d70: 204f 6e45 7874 7261 706f 6c61 7465 2873   OnExtrapolate(s
+00071d80: 656c 6629 3a0d 0a20 2020 2020 2020 2073  elf):..        s
+00071d90: 656c 662e 436f 6d70 6f73 6553 6869 6674  elf.ComposeShift
+00071da0: 5175 6575 6528 696e 6974 3d46 616c 7365  Queue(init=False
+00071db0: 290d 0a20 2020 2064 6566 204f 6e46 696c  )..    def OnFil
+00071dc0: 7465 7228 7365 6c66 293a 0d0a 2020 2020  ter(self):..    
+00071dd0: 2020 2020 7365 6c66 2e43 6f6d 706f 7365      self.Compose
+00071de0: 5368 6966 7451 7565 7565 2869 6e69 743d  ShiftQueue(init=
+00071df0: 4661 6c73 6529 0d0a 0d0a 2020 2020 6465  False)....    de
+00071e00: 6620 436f 6c6f 7269 7a65 5363 6174 7465  f ColorizeScatte
+00071e10: 7244 6f74 7328 7365 6c66 293a 0d0a 2020  rDots(self):..  
+00071e20: 2020 2020 2020 6272 7573 6865 7378 203d        brushesx =
+00071e30: 205b 5174 4775 692e 5143 6f6c 6f72 2827   [QtGui.QColor('
+00071e40: 7265 6427 2920 6966 2062 6f6f 6c20 656c  red') if bool el
+00071e50: 7365 2051 7447 7569 2e51 436f 6c6f 7228  se QtGui.QColor(
+00071e60: 2762 6c75 6527 2920 666f 7220 626f 6f6c  'blue') for bool
+00071e70: 2069 6e20 7365 6c66 2e4d 6173 6b65 6453   in self.MaskedS
+00071e80: 6361 7474 6572 446f 7473 4172 7261 7928  catterDotsArray(
+00071e90: 7365 6c66 2e78 7265 6769 6f6e 295d 0d0a  self.xregion)]..
+00071ea0: 2020 2020 2020 2020 6272 7573 6865 7379          brushesy
+00071eb0: 203d 205b 5174 4775 692e 5143 6f6c 6f72   = [QtGui.QColor
+00071ec0: 2827 7265 6427 2920 6966 2062 6f6f 6c20  ('red') if bool 
+00071ed0: 656c 7365 2051 7447 7569 2e51 436f 6c6f  else QtGui.QColo
+00071ee0: 7228 2762 6c75 6527 2920 666f 7220 626f  r('blue') for bo
+00071ef0: 6f6c 2069 6e20 7365 6c66 2e4d 6173 6b65  ol in self.Maske
+00071f00: 6453 6361 7474 6572 446f 7473 4172 7261  dScatterDotsArra
+00071f10: 7928 7365 6c66 2e79 7265 6769 6f6e 295d  y(self.yregion)]
+00071f20: 0d0a 2020 2020 2020 2020 7365 6c66 2e78  ..        self.x
+00071f30: 7363 6174 7465 722e 7365 7442 7275 7368  scatter.setBrush
+00071f40: 2862 7275 7368 6573 782c 7570 6461 7465  (brushesx,update
+00071f50: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
+00071f60: 7365 6c66 2e79 7363 6174 7465 722e 7365  self.yscatter.se
+00071f70: 7442 7275 7368 2862 7275 7368 6573 792c  tBrush(brushesy,
+00071f80: 7570 6461 7465 3d54 7275 6529 0d0a 0d0a  update=True)....
+00071f90: 2020 2020 6465 6620 4d61 736b 5363 6174      def MaskScat
+00071fa0: 7465 7244 6f74 7341 626f 7665 4572 726f  terDotsAboveErro
+00071fb0: 7254 6872 6573 686f 6c64 2873 656c 662c  rThreshold(self,
+00071fc0: 2065 7272 6f72 7661 6c73 3d4e 6f6e 6529   errorvals=None)
+00071fd0: 3a0d 0a20 2020 2020 2020 2065 7272 6f72  :..        error
+00071fe0: 732c 2065 7272 6f72 7468 7265 7368 6f6c  s, errorthreshol
+00071ff0: 642c 2069 7468 6574 6120 3d20 6572 726f  d, itheta = erro
+00072000: 7276 616c 730d 0a20 2020 2020 2020 2069  rvals..        i
+00072010: 6620 7365 6c66 2e63 625f 6175 746f 6572  f self.cb_autoer
+00072020: 726f 722e 6973 4368 6563 6b65 6428 293a  ror.isChecked():
+00072030: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00072040: 6c66 2e73 7461 636b 2e73 6869 6674 7364  lf.stack.shiftsd
+00072050: 6963 745b 6974 6865 7461 5d5b 2265 7272  ict[itheta]["err
+00072060: 6f72 6d61 736b 6564 7822 5d20 3d20 2865  ormaskedx"] = (e
+00072070: 7272 6f72 7320 3e20 6e70 2e66 6c6f 6174  rrors > np.float
+00072080: 3634 2865 7272 6f72 7468 7265 7368 6f6c  64(errorthreshol
+00072090: 6429 290d 0a20 2020 2020 2020 2020 2020  d))..           
+000720a0: 2073 656c 662e 7374 6163 6b2e 7368 6966   self.stack.shif
+000720b0: 7473 6469 6374 5b69 7468 6574 615d 5b22  tsdict[itheta]["
+000720c0: 6572 726f 726d 6173 6b65 6479 225d 203d  errormaskedy"] =
+000720d0: 2028 6572 726f 7273 203e 206e 702e 666c   (errors > np.fl
+000720e0: 6f61 7436 3428 6572 726f 7274 6872 6573  oat64(errorthres
+000720f0: 686f 6c64 2929 0d0a 2020 2020 2020 2020  hold))..        
+00072100: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00072110: 2020 2073 656c 662e 7374 6163 6b2e 7368     self.stack.sh
+00072120: 6966 7473 6469 6374 5b69 7468 6574 615d  iftsdict[itheta]
+00072130: 5b22 6572 726f 726d 6173 6b65 6478 225d  ["errormaskedx"]
+00072140: 203d 205b 4661 6c73 655d 202a 206c 656e   = [False] * len
+00072150: 2865 7272 6f72 7329 0d0a 2020 2020 2020  (errors)..      
+00072160: 2020 2020 2020 7365 6c66 2e73 7461 636b        self.stack
+00072170: 2e73 6869 6674 7364 6963 745b 6974 6865  .shiftsdict[ithe
+00072180: 7461 5d5b 2265 7272 6f72 6d61 736b 6564  ta]["errormasked
+00072190: 7922 5d20 3d20 5b46 616c 7365 5d20 2a20  y"] = [False] * 
+000721a0: 6c65 6e28 6572 726f 7273 290d 0a0d 0a20  len(errors).... 
+000721b0: 2020 2023 202d 2d2d 2d2d 2d2d 2d2d 2d2d     # -----------
+000721c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000721d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000721e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000721f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020  -----------..   
+00072200: 2064 6566 2069 6e69 7450 6172 616d 7328   def initParams(
+00072210: 7365 6c66 2c20 6974 6865 7461 293a 0d0a  self, itheta):..
+00072220: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
+00072230: 636b 2e73 6869 6674 7364 6963 745b 6974  ck.shiftsdict[it
+00072240: 6865 7461 5d5b 2272 6567 696f 6e6c 696d  heta]["regionlim
+00072250: 6974 7822 5d20 3d20 7365 6c66 2e67 6574  itx"] = self.get
+00072260: 4461 7461 436c 6f73 6573 7454 6f52 6567  DataClosestToReg
+00072270: 696f 6e28 7365 6c66 2e78 7265 6769 6f6e  ion(self.xregion
+00072280: 2c73 656c 662e 7873 6361 7474 6572 2c46  ,self.xscatter,F
+00072290: 616c 7365 295b 323a 5d0d 0a20 2020 2020  alse)[2:]..     
+000722a0: 2020 2073 656c 662e 7374 6163 6b2e 7368     self.stack.sh
+000722b0: 6966 7473 6469 6374 5b69 7468 6574 615d  iftsdict[itheta]
+000722c0: 5b22 7265 6769 6f6e 6c69 6d69 7479 225d  ["regionlimity"]
+000722d0: 203d 2073 656c 662e 6765 7444 6174 6143   = self.getDataC
+000722e0: 6c6f 7365 7374 546f 5265 6769 6f6e 2873  losestToRegion(s
+000722f0: 656c 662e 7972 6567 696f 6e2c 7365 6c66  elf.yregion,self
+00072300: 2e79 7363 6174 7465 722c 4661 6c73 6529  .yscatter,False)
+00072310: 5b32 3a5d 0d0a 2020 2020 2020 2020 7365  [2:]..        se
 00072320: 6c66 2e73 7461 636b 2e73 6869 6674 7364  lf.stack.shiftsd
-00072330: 6963 745b 6974 6865 7461 5d5b 226d 6574  ict[itheta]["met
-00072340: 686f 6422 5d20 3d20 7365 6c66 2e63 6f6d  hod"] = self.com
-00072350: 626f 426f 785f 6170 7072 6f78 2e63 7572  boBox_approx.cur
-00072360: 7265 6e74 496e 6465 7828 290d 0a20 2020  rentIndex()..   
-00072370: 2020 2020 2023 7072 696e 7428 7365 6c66       #print(self
-00072380: 2e73 7461 636b 2e73 6869 6674 7364 6963  .stack.shiftsdic
-00072390: 745b 6974 6865 7461 5d5b 226d 6574 686f  t[itheta]["metho
-000723a0: 6422 5d29 0d0a 2020 2020 2020 2020 2373  d"])..        #s
-000723b0: 656c 662e 7374 6163 6b2e 7368 6966 7473  elf.stack.shifts
-000723c0: 6469 6374 5b69 7468 6574 615d 5b22 6175  dict[itheta]["au
-000723d0: 746f 7175 616c 6974 7922 5d20 3d20 7365  toquality"] = se
-000723e0: 6c66 2e63 625f 6175 746f 6572 726f 722e  lf.cb_autoerror.
-000723f0: 6973 4368 6563 6b65 6428 290d 0a20 2020  isChecked()..   
-00072400: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
-00072410: 7368 6966 7473 6469 6374 5b69 7468 6574  shiftsdict[ithet
-00072420: 615d 5b22 6578 7472 6170 6f6c 6174 696f  a]["extrapolatio
-00072430: 6e22 5d20 3d20 7365 6c66 2e63 625f 6578  n"] = self.cb_ex
-00072440: 7472 6170 6f6c 6174 652e 6973 4368 6563  trapolate.isChec
-00072450: 6b65 6428 290d 0a20 2020 2020 2020 2073  ked()..        s
-00072460: 656c 662e 7374 6163 6b2e 7368 6966 7473  elf.stack.shifts
-00072470: 6469 6374 5b69 7468 6574 615d 5b22 7468  dict[itheta]["th
-00072480: 7265 7368 6f6c 6422 5d20 3d20 726f 756e  reshold"] = roun
-00072490: 6428 6e70 2e6d 6561 6e28 7365 6c66 2e73  d(np.mean(self.s
-000724a0: 7461 636b 2e73 6869 6674 7364 6963 745b  tack.shiftsdict[
-000724b0: 6974 6865 7461 5d5b 2265 7272 6f72 7322  itheta]["errors"
-000724c0: 5d29 2c20 3429 0d0a 2020 2020 6465 6620  ]), 4)..    def 
-000724d0: 7265 7374 6f72 6550 6172 616d 7328 7365  restoreParams(se
-000724e0: 6c66 2c69 7468 6574 6129 3a0d 0a20 2020  lf,itheta):..   
-000724f0: 2020 2020 2073 656c 662e 7872 6567 696f       self.xregio
-00072500: 6e2e 626c 6f63 6b53 6967 6e61 6c73 2854  n.blockSignals(T
-00072510: 7275 6529 0d0a 2020 2020 2020 2020 7365  rue)..        se
-00072520: 6c66 2e79 7265 6769 6f6e 2e62 6c6f 636b  lf.yregion.block
-00072530: 5369 676e 616c 7328 5472 7565 290d 0a20  Signals(True).. 
-00072540: 2020 2020 2020 2073 656c 662e 6362 5f61         self.cb_a
-00072550: 7574 6f65 7272 6f72 2e62 6c6f 636b 5369  utoerror.blockSi
-00072560: 676e 616c 7328 5472 7565 290d 0a20 2020  gnals(True)..   
-00072570: 2020 2020 2073 656c 662e 6362 5f65 7874       self.cb_ext
-00072580: 7261 706f 6c61 7465 2e62 6c6f 636b 5369  rapolate.blockSi
-00072590: 676e 616c 7328 5472 7565 290d 0a20 2020  gnals(True)..   
-000725a0: 2020 2020 2073 656c 662e 636f 6d62 6f42       self.comboB
-000725b0: 6f78 5f61 7070 726f 782e 626c 6f63 6b53  ox_approx.blockS
-000725c0: 6967 6e61 6c73 2854 7275 6529 0d0a 2020  ignals(True)..  
-000725d0: 2020 2020 2020 7365 6c66 2e73 7069 6e42        self.spinB
-000725e0: 6f78 4669 6c74 6572 7369 7a65 2e62 6c6f  oxFiltersize.blo
-000725f0: 636b 5369 676e 616c 7328 5472 7565 290d  ckSignals(True).
-00072600: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00072610: 7872 6567 696f 6e2e 7365 7452 6567 696f  xregion.setRegio
-00072620: 6e28 7365 6c66 2e73 7461 636b 2e73 6869  n(self.stack.shi
-00072630: 6674 7364 6963 745b 6974 6865 7461 5d5b  ftsdict[itheta][
-00072640: 2272 6567 696f 6e6c 696d 6974 7822 5d29  "regionlimitx"])
-00072650: 0d0a 2020 2020 2020 2020 7365 6c66 2e79  ..        self.y
-00072660: 7265 6769 6f6e 2e73 6574 5265 6769 6f6e  region.setRegion
-00072670: 2873 656c 662e 7374 6163 6b2e 7368 6966  (self.stack.shif
-00072680: 7473 6469 6374 5b69 7468 6574 615d 5b22  tsdict[itheta]["
-00072690: 7265 6769 6f6e 6c69 6d69 7479 225d 290d  regionlimity"]).
-000726a0: 0a20 2020 2020 2020 2073 656c 662e 6362  .        self.cb
-000726b0: 5f61 7574 6f65 7272 6f72 2e73 6574 4368  _autoerror.setCh
-000726c0: 6563 6b65 6428 7365 6c66 2e73 7461 636b  ecked(self.stack
-000726d0: 2e73 6869 6674 7364 6963 745b 6974 6865  .shiftsdict[ithe
-000726e0: 7461 5d5b 2261 7574 6f71 7561 6c69 7479  ta]["autoquality
-000726f0: 225d 290d 0a20 2020 2020 2020 2073 656c  "])..        sel
-00072700: 662e 7370 696e 426f 7845 7272 6f72 2e62  f.spinBoxError.b
-00072710: 6c6f 636b 5369 676e 616c 7328 5472 7565  lockSignals(True
-00072720: 290d 0a20 2020 2020 2020 2023 7365 6c66  )..        #self
-00072730: 2e73 7069 6e42 6f78 4572 726f 722e 7365  .spinBoxError.se
-00072740: 7456 616c 7565 2873 656c 662e 7374 6163  tValue(self.stac
-00072750: 6b2e 7368 6966 7473 6469 6374 5b73 656c  k.shiftsdict[sel
-00072760: 662e 6974 6865 7461 5d5b 2274 6872 6573  f.itheta]["thres
-00072770: 686f 6c64 225d 290d 0a20 2020 2020 2020  hold"])..       
-00072780: 2069 6620 7365 6c66 2e63 625f 6175 746f   if self.cb_auto
-00072790: 6572 726f 722e 6973 4368 6563 6b65 6428  error.isChecked(
-000727a0: 2920 616e 6420 7365 6c66 2e61 6c69 676e  ) and self.align
-000727b0: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-000727c0: 2073 656c 662e 7370 696e 426f 7845 7272   self.spinBoxErr
-000727d0: 6f72 2e73 6574 456e 6162 6c65 6428 5472  or.setEnabled(Tr
-000727e0: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-000727f0: 2073 656c 662e 7370 696e 426f 7845 7272   self.spinBoxErr
-00072800: 6f72 2e73 6574 5661 6c75 6528 7365 6c66  or.setValue(self
-00072810: 2e73 7461 636b 2e73 6869 6674 7364 6963  .stack.shiftsdic
-00072820: 745b 7365 6c66 2e69 7468 6574 615d 5b22  t[self.itheta]["
-00072830: 7468 7265 7368 6f6c 6422 5d29 0d0a 2020  threshold"])..  
-00072840: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00072850: 2020 2020 2020 2020 2073 656c 662e 7370           self.sp
-00072860: 696e 426f 7845 7272 6f72 2e73 6574 456e  inBoxError.setEn
-00072870: 6162 6c65 6428 4661 6c73 6529 0d0a 2020  abled(False)..  
-00072880: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-00072890: 7069 6e42 6f78 4572 726f 722e 7365 7456  pinBoxError.setV
-000728a0: 616c 7565 2831 290d 0a20 2020 2020 2020  alue(1)..       
-000728b0: 2073 656c 662e 7370 696e 426f 7845 7272   self.spinBoxErr
-000728c0: 6f72 2e62 6c6f 636b 5369 676e 616c 7328  or.blockSignals(
-000728d0: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-000728e0: 7365 6c66 2e63 625f 6578 7472 6170 6f6c  self.cb_extrapol
-000728f0: 6174 652e 7365 7443 6865 636b 6564 2873  ate.setChecked(s
-00072900: 656c 662e 7374 6163 6b2e 7368 6966 7473  elf.stack.shifts
-00072910: 6469 6374 5b69 7468 6574 615d 5b22 6578  dict[itheta]["ex
-00072920: 7472 6170 6f6c 6174 696f 6e22 5d29 0d0a  trapolation"])..
-00072930: 2020 2020 2020 2020 7365 6c66 2e63 6f6d          self.com
-00072940: 626f 426f 785f 6170 7072 6f78 2e73 6574  boBox_approx.set
-00072950: 4375 7272 656e 7449 6e64 6578 2873 656c  CurrentIndex(sel
-00072960: 662e 7374 6163 6b2e 7368 6966 7473 6469  f.stack.shiftsdi
-00072970: 6374 5b69 7468 6574 615d 5b22 6d65 7468  ct[itheta]["meth
-00072980: 6f64 225d 290d 0a20 2020 2020 2020 2069  od"])..        i
-00072990: 6620 7365 6c66 2e63 6f6d 626f 426f 785f  f self.comboBox_
-000729a0: 6170 7072 6f78 2e63 7572 7265 6e74 496e  approx.currentIn
-000729b0: 6465 7828 2920 3d3d 2030 3a0d 0a20 2020  dex() == 0:..   
-000729c0: 2020 2020 2020 2020 2073 656c 662e 7370           self.sp
-000729d0: 696e 426f 7846 696c 7465 7273 697a 652e  inBoxFiltersize.
-000729e0: 7365 7445 6e61 626c 6564 2854 7275 6529  setEnabled(True)
-000729f0: 0d0a 2020 2020 2020 2020 656c 6966 2073  ..        elif s
-00072a00: 656c 662e 636f 6d62 6f42 6f78 5f61 7070  elf.comboBox_app
-00072a10: 726f 782e 6375 7272 656e 7449 6e64 6578  rox.currentIndex
-00072a20: 2829 203d 3d20 313a 2023 206c 696e 6561  () == 1: # linea
-00072a30: 7220 7265 6772 6573 7369 6f6e 0d0a 2020  r regression..  
-00072a40: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-00072a50: 7069 6e42 6f78 4669 6c74 6572 7369 7a65  pinBoxFiltersize
-00072a60: 2e73 6574 456e 6162 6c65 6428 4661 6c73  .setEnabled(Fals
-00072a70: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-00072a80: 2e73 7069 6e42 6f78 4669 6c74 6572 7369  .spinBoxFiltersi
-00072a90: 7a65 2e73 6574 5661 6c75 6528 7365 6c66  ze.setValue(self
-00072aa0: 2e73 7461 636b 2e73 6869 6674 7364 6963  .stack.shiftsdic
-00072ab0: 745b 6974 6865 7461 5d5b 2266 696c 7465  t[itheta]["filte
-00072ac0: 7222 5d29 0d0a 2020 2020 2020 2020 2320  r"])..        # 
-00072ad0: 6966 206c 696d 6974 733a 0d0a 2020 2020  if limits:..    
-00072ae0: 2020 2020 2320 2020 2020 7265 6769 6f6e      #     region
-00072af0: 2e73 6574 5265 6769 6f6e 286c 6973 7428  .setRegion(list(
-00072b00: 6c69 6d69 7473 2929 0d0a 2020 2020 2020  limits))..      
-00072b10: 2020 2320 656c 7365 3a0d 0a20 2020 2020    # else:..     
-00072b20: 2020 2023 2020 2020 2072 6567 696f 6e2e     #     region.
-00072b30: 7365 7452 6567 696f 6e28 5b73 656c 662e  setRegion([self.
-00072b40: 7374 6163 6b2e 6576 5b30 5d2c 7365 6c66  stack.ev[0],self
-00072b50: 2e73 7461 636b 2e65 765b 2d31 5d5d 290d  .stack.ev[-1]]).
-00072b60: 0a20 2020 2020 2020 2023 7365 6c66 2e73  .        #self.s
-00072b70: 7069 6e42 6f78 4572 726f 722e 626c 6f63  pinBoxError.bloc
-00072b80: 6b53 6967 6e61 6c73 2846 616c 7365 290d  kSignals(False).
-00072b90: 0a20 2020 2020 2020 2073 656c 662e 7872  .        self.xr
-00072ba0: 6567 696f 6e2e 626c 6f63 6b53 6967 6e61  egion.blockSigna
-00072bb0: 6c73 2846 616c 7365 290d 0a20 2020 2020  ls(False)..     
-00072bc0: 2020 2073 656c 662e 7972 6567 696f 6e2e     self.yregion.
-00072bd0: 626c 6f63 6b53 6967 6e61 6c73 2846 616c  blockSignals(Fal
-00072be0: 7365 290d 0a20 2020 2020 2020 2073 656c  se)..        sel
-00072bf0: 662e 6362 5f61 7574 6f65 7272 6f72 2e62  f.cb_autoerror.b
-00072c00: 6c6f 636b 5369 676e 616c 7328 4661 6c73  lockSignals(Fals
-00072c10: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-00072c20: 2e63 625f 6578 7472 6170 6f6c 6174 652e  .cb_extrapolate.
-00072c30: 626c 6f63 6b53 6967 6e61 6c73 2846 616c  blockSignals(Fal
-00072c40: 7365 290d 0a20 2020 2020 2020 2073 656c  se)..        sel
-00072c50: 662e 636f 6d62 6f42 6f78 5f61 7070 726f  f.comboBox_appro
-00072c60: 782e 626c 6f63 6b53 6967 6e61 6c73 2846  x.blockSignals(F
-00072c70: 616c 7365 290d 0a20 2020 2020 2020 2073  alse)..        s
-00072c80: 656c 662e 7370 696e 426f 7846 696c 7465  elf.spinBoxFilte
-00072c90: 7273 697a 652e 626c 6f63 6b53 6967 6e61  rsize.blockSigna
-00072ca0: 6c73 2846 616c 7365 290d 0a0d 0a20 2020  ls(False)....   
-00072cb0: 2064 6566 2067 6574 4461 7461 436c 6f73   def getDataClos
-00072cc0: 6573 7454 6f52 6567 696f 6e28 7365 6c66  estToRegion(self
-00072cd0: 2c72 6567 696f 6e2c 706c 6f74 6974 656d  ,region,plotitem
-00072ce0: 2c73 6e61 7072 6567 696f 6e3d 4661 6c73  ,snapregion=Fals
-00072cf0: 6529 3a0d 0a20 2020 2020 2020 2073 656c  e):..        sel
-00072d00: 6563 7472 6567 696f 6e20 3d20 7b73 656c  ectregion = {sel
-00072d10: 662e 7872 6567 696f 6e20 3a20 2272 6567  f.xregion : "reg
-00072d20: 696f 6e6c 696d 6974 7822 2c20 7365 6c66  ionlimitx", self
-00072d30: 2e79 7265 6769 6f6e 203a 2022 7265 6769  .yregion : "regi
-00072d40: 6f6e 6c69 6d69 7479 227d 0d0a 2020 2020  onlimity"}..    
-00072d50: 2020 2020 6c69 6d69 7473 203d 2073 656c      limits = sel
-00072d60: 6563 7472 6567 696f 6e5b 7265 6769 6f6e  ectregion[region
-00072d70: 5d0d 0a20 2020 2020 2020 206d 696e 6964  ]..        minid
-00072d80: 782c 206d 6178 6964 7820 3d20 7265 6769  x, maxidx = regi
-00072d90: 6f6e 2e67 6574 5265 6769 6f6e 2829 0d0a  on.getRegion()..
-00072da0: 2020 2020 2020 2020 6461 7461 203d 2070          data = p
-00072db0: 6c6f 7469 7465 6d2e 6765 7444 6174 6128  lotitem.getData(
-00072dc0: 295b 305d 0d0a 2020 2020 2020 2020 696e  )[0]..        in
-00072dd0: 6465 7820 3d20 6c61 6d62 6461 2078 3a20  dex = lambda x: 
-00072de0: 6e70 2e61 7267 6d69 6e28 6e70 2e61 6273  np.argmin(np.abs
-00072df0: 2864 6174 6120 2d20 7829 290d 0a20 2020  (data - x))..   
-00072e00: 2020 2020 206d 696e 6964 7820 3d20 696e       minidx = in
-00072e10: 6465 7828 6d69 6e69 6478 290d 0a20 2020  dex(minidx)..   
-00072e20: 2020 2020 206d 6178 6964 7820 3d20 696e       maxidx = in
-00072e30: 6465 7828 6d61 7869 6478 290d 0a20 2020  dex(maxidx)..   
-00072e40: 2020 2020 2069 6620 6d69 6e69 6478 203d       if minidx =
-00072e50: 3d20 6d61 7869 6478 3a0d 0a20 2020 2020  = maxidx:..     
-00072e60: 2020 2020 2020 206d 696e 6964 7820 3d20         minidx = 
-00072e70: 300d 0a20 2020 2020 2020 2020 2020 206d  0..            m
-00072e80: 6178 6964 7820 3d20 6e70 2e61 7267 6d61  axidx = np.argma
-00072e90: 7828 6461 7461 290d 0a20 2020 2020 2020  x(data)..       
-00072ea0: 206d 696e 6461 7461 203d 2064 6174 615b   mindata = data[
-00072eb0: 6d69 6e69 6478 5d0d 0a20 2020 2020 2020  minidx]..       
-00072ec0: 206d 6178 6461 7461 203d 2064 6174 615b   maxdata = data[
-00072ed0: 6d61 7869 6478 5d0d 0a20 2020 2020 2020  maxidx]..       
-00072ee0: 2069 6620 736e 6170 7265 6769 6f6e 3a0d   if snapregion:.
-00072ef0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00072f00: 662e 7374 6163 6b2e 7368 6966 7473 6469  f.stack.shiftsdi
-00072f10: 6374 5b73 656c 662e 6974 6865 7461 5d5b  ct[self.itheta][
-00072f20: 6c69 6d69 7473 5d20 3d20 286d 696e 6461  limits] = (minda
-00072f30: 7461 2c6d 6178 6461 7461 2920 2023 2073  ta,maxdata)  # s
-00072f40: 6e61 7020 7265 6769 6f6e 2074 6f20 6461  nap region to da
-00072f50: 7461 2070 6f69 6e74 730d 0a20 2020 2020  ta points..     
-00072f60: 2020 2020 2020 2072 6567 696f 6e2e 7365         region.se
-00072f70: 7452 6567 696f 6e28 286d 696e 6461 7461  tRegion((mindata
-00072f80: 2c6d 6178 6461 7461 2929 0d0a 2020 2020  ,maxdata))..    
-00072f90: 2020 2020 7265 7475 726e 206d 696e 6964      return minid
-00072fa0: 782c 206d 6178 6964 782c 206d 696e 6461  x, maxidx, minda
-00072fb0: 7461 2c20 6d61 7864 6174 610d 0a20 2020  ta, maxdata..   
-00072fc0: 200d 0a20 2020 2064 6566 2041 7070 6c79   ..    def Apply
-00072fd0: 4170 7072 6f78 696d 6174 696f 6e46 756e  ApproximationFun
-00072fe0: 6374 696f 6e28 7365 6c66 2c72 6567 696f  ction(self,regio
-00072ff0: 6e29 3a0d 0a20 2020 2020 2020 2062 6f6f  n):..        boo
-00073000: 6c61 7272 6179 203d 2073 656c 662e 4d61  larray = self.Ma
-00073010: 736b 6564 5363 6174 7465 7244 6f74 7341  skedScatterDotsA
-00073020: 7272 6179 2872 6567 696f 6e29 0d0a 2020  rray(region)..  
-00073030: 2020 2020 2020 7365 6c65 6374 7363 6174        selectscat
-00073040: 7465 7220 3d20 7b73 656c 662e 7872 6567  ter = {self.xreg
-00073050: 696f 6e3a 205b 7365 6c66 2e78 7363 6174  ion: [self.xscat
-00073060: 7465 722c 2022 7822 5d20 2c20 7365 6c66  ter, "x"] , self
-00073070: 2e79 7265 6769 6f6e 3a20 5b73 656c 662e  .yregion: [self.
-00073080: 7973 6361 7474 6572 2c20 2279 225d 7d0d  yscatter, "y"]}.
-00073090: 0a20 2020 2020 2020 2073 656c 6563 7466  .        selectf
-000730a0: 6974 3d20 7b73 656c 662e 7872 6567 696f  it= {self.xregio
-000730b0: 6e20 3a20 7365 6c66 2e66 6974 5f78 2c20  n : self.fit_x, 
-000730c0: 7365 6c66 2e79 7265 6769 6f6e 203a 2073  self.yregion : s
-000730d0: 656c 662e 6669 745f 797d 0d0a 2020 2020  elf.fit_y}..    
-000730e0: 2020 2020 7363 6174 7465 7220 3d20 7365      scatter = se
-000730f0: 6c65 6374 7363 6174 7465 725b 7265 6769  lectscatter[regi
-00073100: 6f6e 5d5b 305d 0d0a 2020 2020 2020 2020  on][0]..        
-00073110: 6669 7420 3d20 7365 6c65 6374 6669 745b  fit = selectfit[
-00073120: 7265 6769 6f6e 5d0d 0a20 2020 2020 2020  region]..       
-00073130: 2023 6d69 6e5f 6964 782c 206d 6178 5f69   #min_idx, max_i
-00073140: 6478 2c20 2a5f 203d 2073 656c 662e 6765  dx, *_ = self.ge
-00073150: 7444 6174 6143 6c6f 7365 7374 546f 5265  tDataClosestToRe
-00073160: 6769 6f6e 2872 6567 696f 6e2c 7363 6174  gion(region,scat
-00073170: 7465 7229 0d0a 2020 2020 2020 2020 7365  ter)..        se
-00073180: 6c65 6374 6564 203d 206e 702e 636f 756e  lected = np.coun
-00073190: 745f 6e6f 6e7a 6572 6f28 626f 6f6c 6172  t_nonzero(boolar
-000731a0: 7261 7920 3d3d 2046 616c 7365 290d 0a20  ray == False).. 
-000731b0: 2020 2020 2020 2078 6461 7461 2c20 7964         xdata, yd
-000731c0: 6174 6120 3d20 7363 6174 7465 722e 6765  ata = scatter.ge
-000731d0: 7444 6174 6128 290d 0a20 2020 2020 2020  tData()..       
-000731e0: 2023 7864 6174 6120 3d20 7864 6174 615b   #xdata = xdata[
-000731f0: 6d69 6e5f 6964 783a 6d61 785f 6964 785d  min_idx:max_idx]
-00073200: 0d0a 2020 2020 2020 2020 7864 6174 6120  ..        xdata 
-00073210: 3d20 7864 6174 615b 7e62 6f6f 6c61 7272  = xdata[~boolarr
-00073220: 6179 5d0d 0a20 2020 2020 2020 2023 7964  ay]..        #yd
-00073230: 6174 6120 3d20 7964 6174 615b 6d69 6e5f  ata = ydata[min_
-00073240: 6964 783a 6d61 785f 6964 785d 0d0a 2020  idx:max_idx]..  
-00073250: 2020 2020 2020 7964 6174 6120 3d20 7964        ydata = yd
-00073260: 6174 615b 7e62 6f6f 6c61 7272 6179 5d0d  ata[~boolarray].
-00073270: 0a20 2020 2020 2020 2023 7072 696e 7428  .        #print(
-00073280: 7365 6c65 6374 6564 290d 0a20 2020 2020  selected)..     
-00073290: 2020 2069 6620 7365 6c65 6374 6564 203c     if selected <
-000732a0: 2032 3a0d 0a20 2020 2020 2020 2020 2020   2:..           
-000732b0: 2051 7457 6964 6765 7473 2e51 4d65 7373   QtWidgets.QMess
-000732c0: 6167 6542 6f78 2e77 6172 6e69 6e67 2873  ageBox.warning(s
-000732d0: 656c 662c 2027 4572 726f 7227 2c20 2753  elf, 'Error', 'S
-000732e0: 656c 6563 7420 6174 206c 6561 7374 2074  elect at least t
-000732f0: 776f 2069 6d61 6765 7320 696e 207b 7d2d  wo images in {}-
-00073300: 6469 7265 6374 696f 6e21 272e 666f 726d  direction!'.form
-00073310: 6174 2873 656c 6563 7473 6361 7474 6572  at(selectscatter
-00073320: 5b72 6567 696f 6e5d 5b31 5d29 290d 0a20  [region][1])).. 
-00073330: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00073340: 6e20 5b5d 0d0a 2020 2020 2020 2020 6966  n []..        if
-00073350: 2073 656c 662e 636f 6d62 6f42 6f78 5f61   self.comboBox_a
-00073360: 7070 726f 782e 6375 7272 656e 7449 6e64  pprox.currentInd
-00073370: 6578 2829 203d 3d20 303a 2023 206d 6f76  ex() == 0: # mov
-00073380: 696e 6720 6176 6572 6167 650d 0a20 2020  ing average..   
-00073390: 2020 2020 2020 2020 2073 656c 662e 7370           self.sp
-000733a0: 696e 426f 7846 696c 7465 7273 697a 652e  inBoxFiltersize.
-000733b0: 7365 7445 6e61 626c 6564 2854 7275 6529  setEnabled(True)
-000733c0: 0d0a 2020 2020 2020 2020 2020 2020 6170  ..            ap
-000733d0: 7072 6f78 696d 6174 6564 3d20 6e64 696d  proximated= ndim
-000733e0: 6167 652e 6669 6c74 6572 732e 756e 6966  age.filters.unif
-000733f0: 6f72 6d5f 6669 6c74 6572 3164 2879 6461  orm_filter1d(yda
-00073400: 7461 2c73 656c 662e 7370 696e 426f 7846  ta,self.spinBoxF
-00073410: 696c 7465 7273 697a 652e 7661 6c75 6528  iltersize.value(
-00073420: 292c 6d6f 6465 203d 2022 6e65 6172 6573  ),mode = "neares
-00073430: 7422 290d 0a20 2020 2020 2020 2065 6c69  t")..        eli
-00073440: 6620 7365 6c66 2e63 6f6d 626f 426f 785f  f self.comboBox_
-00073450: 6170 7072 6f78 2e63 7572 7265 6e74 496e  approx.currentIn
-00073460: 6465 7828 2920 3d3d 2031 3a20 2320 6c69  dex() == 1: # li
-00073470: 6e65 6172 2072 6567 7265 7373 696f 6e0d  near regression.
-00073480: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00073490: 662e 7370 696e 426f 7846 696c 7465 7273  f.spinBoxFilters
-000734a0: 697a 652e 7365 7445 6e61 626c 6564 2846  ize.setEnabled(F
-000734b0: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
-000734c0: 2020 2072 6567 203d 206c 696e 7265 6772     reg = linregr
-000734d0: 6573 7328 5b78 6461 7461 2c79 6461 7461  ess([xdata,ydata
-000734e0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-000734f0: 6170 7072 6f78 696d 6174 6564 203d 205b  approximated = [
-00073500: 7265 672e 736c 6f70 6520 2a20 6920 2b20  reg.slope * i + 
-00073510: 7265 672e 696e 7465 7263 6570 7420 666f  reg.intercept fo
-00073520: 7220 6920 696e 2078 6461 7461 5d0d 0a0d  r i in xdata]...
-00073530: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00073540: 2e63 625f 6578 7472 6170 6f6c 6174 652e  .cb_extrapolate.
-00073550: 6973 4368 6563 6b65 6428 293a 0d0a 2020  isChecked():..  
-00073560: 2020 2020 2020 2020 2020 6669 6c6c 7661            fillva
-00073570: 6c3d 2022 6578 7472 6170 6f6c 6174 6522  l= "extrapolate"
-00073580: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-00073590: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-000735a0: 6c76 616c 3d28 6170 7072 6f78 696d 6174  lval=(approximat
-000735b0: 6564 5b30 5d2c 6170 7072 6f78 696d 6174  ed[0],approximat
-000735c0: 6564 5b2d 315d 290d 0a0d 0a20 2020 2020  ed[-1])....     
-000735d0: 2020 2069 6e74 6572 706f 6c61 7465 5f66     interpolate_f
-000735e0: 756e 6320 3d20 696e 7465 7270 3164 2878  unc = interp1d(x
-000735f0: 6461 7461 2c20 6170 7072 6f78 696d 6174  data, approximat
-00073600: 6564 2c6b 696e 643d 226c 696e 6561 7222  ed,kind="linear"
-00073610: 2c66 696c 6c5f 7661 6c75 653d 6669 6c6c  ,fill_value=fill
-00073620: 7661 6c2c 626f 756e 6473 5f65 7272 6f72  val,bounds_error
-00073630: 3d46 616c 7365 290d 0a20 2020 2020 2020  =False)..       
-00073640: 2066 6974 6461 7461 203d 205b 7365 6c66   fitdata = [self
-00073650: 2e73 7461 636b 2e65 762c 6e70 2e61 726f  .stack.ev,np.aro
-00073660: 756e 6428 696e 7465 7270 6f6c 6174 655f  und(interpolate_
-00073670: 6675 6e63 2873 656c 662e 7374 6163 6b2e  func(self.stack.
-00073680: 6576 292c 3129 5d20 2320 726f 756e 6420  ev),1)] # round 
-00073690: 6669 7420 746f 2061 2074 656e 7468 206f  fit to a tenth o
-000736a0: 6620 6120 7078 0d0a 2020 2020 2020 2020  f a px..        
-000736b0: 6669 742e 7365 7444 6174 6128 783d 6669  fit.setData(x=fi
-000736c0: 7464 6174 615b 305d 2c20 793d 6669 7464  tdata[0], y=fitd
-000736d0: 6174 615b 315d 290d 0a20 2020 2020 2020  ata[1])..       
-000736e0: 2066 6974 2e73 686f 7728 290d 0a20 2020   fit.show()..   
-000736f0: 2020 2020 2072 6574 7572 6e20 6669 7464       return fitd
-00073700: 6174 615b 315d 0d0a 0d0a 2020 2020 6465  ata[1]....    de
-00073710: 6620 7265 7365 7450 6f6f 6c54 6872 6561  f resetPoolThrea
-00073720: 6428 7365 6c66 293a 0d0a 2020 2020 2020  d(self):..      
-00073730: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-00073740: 2020 2020 7365 6c66 2e70 6f6f 6c74 6872      self.poolthr
-00073750: 6561 642e 7374 6172 7465 642e 6469 7363  ead.started.disc
-00073760: 6f6e 6e65 6374 2829 0d0a 2020 2020 2020  onnect()..      
-00073770: 2020 2020 2020 7365 6c66 2e70 6f6f 6c74        self.poolt
-00073780: 6872 6561 642e 7175 6974 2829 0d0a 2020  hread.quit()..  
-00073790: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-000737a0: 6f6f 6c74 6872 6561 642e 7761 6974 2829  oolthread.wait()
-000737b0: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
-000737c0: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
-000737d0: 6173 730d 0a20 2020 2020 2020 2073 656c  ass..        sel
-000737e0: 662e 706f 6f6c 203d 2054 6173 6b44 6973  f.pool = TaskDis
-000737f0: 7061 7463 6865 7228 7365 6c66 290d 0a20  patcher(self).. 
-00073800: 2020 2020 2020 2073 656c 662e 706f 6f6c         self.pool
-00073810: 2e6d 6f76 6554 6f54 6872 6561 6428 7365  .moveToThread(se
-00073820: 6c66 2e70 6f6f 6c74 6872 6561 6429 2023  lf.poolthread) #
-00073830: 2047 5549 2069 7320 6e6f 7420 626c 6f63   GUI is not bloc
-00073840: 6b69 6e67 2064 7572 696e 6720 6361 6c63  king during calc
-00073850: 756c 6174 696f 6e20 6475 6520 746f 2074  ulation due to t
-00073860: 6869 730d 0a20 2020 2020 2020 2073 656c  his..        sel
-00073870: 662e 706f 6f6c 7468 7265 6164 2e73 7461  f.poolthread.sta
-00073880: 7274 6564 2e63 6f6e 6e65 6374 2873 656c  rted.connect(sel
-00073890: 662e 706f 6f6c 2e72 756e 290d 0a0d 0a20  f.pool.run).... 
-000738a0: 2020 2064 6566 2049 5468 6574 6150 726f     def IThetaPro
-000738b0: 6772 6573 7328 7365 6c66 2c69 7468 6574  gress(self,ithet
-000738c0: 6129 3a0d 0a20 2020 2020 2020 2023 7072  a):..        #pr
-000738d0: 696e 7428 2269 7468 6574 6170 726f 6772  int("ithetaprogr
-000738e0: 6573 7322 290d 0a20 2020 2020 2020 2023  ess")..        #
-000738f0: 2045 6163 6820 7468 7265 6164 2063 616c   Each thread cal
-00073900: 6c73 2074 6869 7320 6675 6e63 7469 6f6e  ls this function
-00073910: 2e20 5468 6520 636f 6e64 6974 696f 6e20  . The condition 
-00073920: 7072 6576 656e 7473 206d 756c 7469 706c  prevents multipl
-00073930: 6520 6361 6c6c 732e 0d0a 2020 2020 2020  e calls...      
-00073940: 2020 6966 2073 656c 662e 736c 6964 6572    if self.slider
-00073950: 5f74 6865 7461 2e76 616c 7565 2829 2021  _theta.value() !
-00073960: 3d20 6974 6865 7461 3a0d 0a20 2020 2020  = itheta:..     
-00073970: 2020 2020 2020 2023 7365 6c66 2e73 6c69         #self.sli
-00073980: 6465 725f 7468 6574 612e 626c 6f63 6b53  der_theta.blockS
-00073990: 6967 6e61 6c73 2854 7275 6529 0d0a 2020  ignals(True)..  
-000739a0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-000739b0: 6c69 6465 725f 7468 6574 612e 7365 7456  lider_theta.setV
-000739c0: 616c 7565 2869 7468 6574 6129 0d0a 2020  alue(itheta)..  
-000739d0: 2020 2020 2020 2020 2020 2373 656c 662e            #self.
-000739e0: 736c 6964 6572 5f74 6865 7461 2e62 6c6f  slider_theta.blo
-000739f0: 636b 5369 676e 616c 7328 4661 6c73 6529  ckSignals(False)
-00073a00: 0d0a 2020 2020 2020 2020 2370 7269 6e74  ..        #print
-00073a10: 2873 656c 662e 706f 6f6c 2e70 6f6f 6c2e  (self.pool.pool.
-00073a20: 6163 7469 7665 5468 7265 6164 436f 756e  activeThreadCoun
-00073a30: 7428 2929 0d0a 0d0a 2020 2020 6465 6620  t())....    def 
-00073a40: 5468 7265 6164 506f 6f6c 436f 6d70 6c65  ThreadPoolComple
-00073a50: 7465 2873 656c 6629 3a0d 0a20 2020 2020  te(self):..     
-00073a60: 2020 2023 7072 696e 7428 7374 7228 7365     #print(str(se
-00073a70: 6c66 2e70 6f6f 6c2e 706f 6f6c 2e61 6374  lf.pool.pool.act
-00073a80: 6976 6554 6872 6561 6443 6f75 6e74 2829  iveThreadCount()
-00073a90: 292b 2220 5448 5245 4144 5320 5245 4d41  )+" THREADS REMA
-00073aa0: 494e 494e 4720 4652 4f4d 2050 4f4f 4c2e  INING FROM POOL.
-00073ab0: 2229 0d0a 2020 2020 2020 2020 2373 656c  ")..        #sel
-00073ac0: 662e 736c 6964 6572 5f74 6865 7461 2e73  f.slider_theta.s
-00073ad0: 6574 5661 6c75 6528 3029 0d0a 2020 2020  etValue(0)..    
-00073ae0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-00073af0: 616c 6967 6e65 6420 616e 6420 7365 6c66  aligned and self
-00073b00: 2e70 6f6f 6c2e 706f 6f6c 2e61 6374 6976  .pool.pool.activ
-00073b10: 6554 6872 6561 6443 6f75 6e74 2829 203d  eThreadCount() =
-00073b20: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
-00073b30: 2020 7365 6c66 2e4f 6e41 6c69 676e 6564    self.OnAligned
-00073b40: 2829 0d0a 0d0a 2020 2020 2020 2020 656c  ()....        el
-00073b50: 6966 2073 656c 662e 616c 6967 6e65 6420  if self.aligned 
-00073b60: 616e 6420 7365 6c66 2e70 6f6f 6c2e 706f  and self.pool.po
-00073b70: 6f6c 2e61 6374 6976 6554 6872 6561 6443  ol.activeThreadC
-00073b80: 6f75 6e74 2829 203d 3d20 303a 0d0a 2020  ount() == 0:..  
-00073b90: 2020 2020 2020 2020 2020 7365 6c66 2e4f            self.O
-00073ba0: 6e41 7574 6f43 726f 7028 290d 0a0d 0a20  nAutoCrop().... 
-00073bb0: 2020 2064 6566 2043 6f6d 706f 7365 416c     def ComposeAl
-00073bc0: 6967 6e51 7565 7565 2873 656c 6629 3a0d  ignQueue(self):.
-00073bd0: 0a20 2020 2020 2020 2073 656c 662e 6275  .        self.bu
-00073be0: 7474 6f6e 5f61 6c69 676e 2e73 6574 456e  tton_align.setEn
-00073bf0: 6162 6c65 6428 4661 6c73 6529 0d0a 2020  abled(False)..  
-00073c00: 2020 2020 2020 7265 665f 6964 7820 3d20        ref_idx = 
-00073c10: 7365 6c66 2e69 6576 0d0a 2020 2020 2020  self.iev..      
-00073c20: 2020 2320 5265 7365 7420 7265 6665 7265    # Reset refere
-00073c30: 6e63 6520 696d 673a 0d0a 2020 2020 2020  nce img:..      
-00073c40: 2020 7365 6c66 2e72 6573 6574 506f 6f6c    self.resetPool
-00073c50: 5468 7265 6164 2829 0d0a 0d0a 2020 2020  Thread()....    
-00073c60: 2020 2020 6974 6865 7461 203d 2030 0d0a      itheta = 0..
-00073c70: 2020 2020 2020 2020 6e74 6865 7461 203d          ntheta =
-00073c80: 206d 6178 2873 656c 662e 7374 6163 6b2e   max(self.stack.
-00073c90: 6e5f 7468 6574 612c 3129 2023 206e 6563  n_theta,1) # nec
-00073ca0: 6573 7361 7279 2077 6f72 6b20 6172 6f75  essary work arou
-00073cb0: 6e64 2066 6f72 2033 6420 7374 6163 6b73  nd for 3d stacks
-00073cc0: 2061 6e64 2069 6620 3464 2073 7461 636b   and if 4d stack
-00073cd0: 2069 7320 6c6f 6164 6564 2077 6974 6820   is loaded with 
-00073ce0: 4c6f 6164 5374 6163 6b28 290d 0a20 2020  LoadStack()..   
-00073cf0: 2020 2020 2077 6869 6c65 2069 7468 6574       while ithet
-00073d00: 6120 3c20 6e74 6865 7461 3a0d 0a20 2020  a < ntheta:..   
-00073d10: 2020 2020 2020 2020 2069 6478 203d 2063           idx = c
-00073d20: 6f70 792e 636f 7079 2873 656c 662e 7374  opy.copy(self.st
-00073d30: 6163 6b2e 6e5f 6576 290d 0a20 2020 2020  ack.n_ev)..     
-00073d40: 2020 2020 2020 2077 6869 6c65 2069 6478         while idx
-00073d50: 3a20 2320 4765 6e65 7261 7465 2070 6169  : # Generate pai
-00073d60: 7273 206f 6620 696e 6469 6365 7320 7374  rs of indices st
-00073d70: 6172 7469 6e67 2061 7420 7265 6665 7265  arting at refere
-00073d80: 6e63 6520 696d 6167 6520 696e 6465 782e  nce image index.
-00073d90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00073da0: 2020 7275 6e6e 696e 6720 3d20 320d 0a20    running = 2.. 
-00073db0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00073dc0: 6620 2872 6566 5f69 6478 202b 2028 7365  f (ref_idx + (se
-00073dd0: 6c66 2e73 7461 636b 2e6e 5f65 762d 6964  lf.stack.n_ev-id
-00073de0: 7829 2920 3c20 7365 6c66 2e73 7461 636b  x)) < self.stack
-00073df0: 2e6e 5f65 762d 313a 0d0a 2020 2020 2020  .n_ev-1:..      
-00073e00: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00073e10: 6c66 2e70 6f6f 6c2e 656e 7175 6575 6574  lf.pool.enqueuet
-00073e20: 6173 6b28 2241 6c69 676e 5265 6665 7265  ask("AlignRefere
-00073e30: 6e63 6564 222c 2028 7265 665f 6964 7820  nced", (ref_idx 
-00073e40: 2b20 2873 656c 662e 7374 6163 6b2e 6e5f  + (self.stack.n_
-00073e50: 6576 2d69 6478 2920 2b20 312c 2072 6566  ev-idx) + 1, ref
-00073e60: 5f69 6478 292c 2069 7468 6574 6129 0d0a  _idx), itheta)..
-00073e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00073e80: 2020 2020 2371 2e70 7574 2828 7265 665f      #q.put((ref_
-00073e90: 6964 7820 2b20 2873 656c 662e 7374 6163  idx + (self.stac
-00073ea0: 6b2e 6e5f 6576 2d69 6478 2920 2b20 312c  k.n_ev-idx) + 1,
-00073eb0: 2072 6566 5f69 6478 2929 0d0a 2020 2020   ref_idx))..    
-00073ec0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00073ed0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00073ee0: 2020 2020 2020 2072 756e 6e69 6e67 202d         running -
-00073ef0: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-00073f00: 2020 2020 2069 6620 7265 665f 6964 7820       if ref_idx 
-00073f10: 2d20 2873 656c 662e 7374 6163 6b2e 6e5f  - (self.stack.n_
-00073f20: 6576 2d69 6478 2920 3e20 303a 0d0a 2020  ev-idx) > 0:..  
-00073f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00073f40: 2020 7365 6c66 2e70 6f6f 6c2e 656e 7175    self.pool.enqu
-00073f50: 6575 6574 6173 6b28 2241 6c69 676e 5265  euetask("AlignRe
-00073f60: 6665 7265 6e63 6564 222c 2028 7265 665f  ferenced", (ref_
-00073f70: 6964 7820 2d20 2873 656c 662e 7374 6163  idx - (self.stac
-00073f80: 6b2e 6e5f 6576 2d69 6478 2920 2d20 312c  k.n_ev-idx) - 1,
-00073f90: 2072 6566 5f69 6478 292c 2069 7468 6574   ref_idx), ithet
-00073fa0: 6129 0d0a 2020 2020 2020 2020 2020 2020  a)..            
-00073fb0: 2020 2020 2020 2020 2371 2e70 7574 2828          #q.put((
-00073fc0: 2872 6566 5f69 6478 202d 2028 7365 6c66  (ref_idx - (self
-00073fd0: 2e73 7461 636b 2e6e 5f65 762d 6964 7829  .stack.n_ev-idx)
-00073fe0: 202d 2031 292c 7265 665f 6964 7829 290d   - 1),ref_idx)).
-00073ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00074000: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00074010: 2020 2020 2020 2020 2020 2020 7275 6e6e              runn
-00074020: 696e 6720 2d3d 2031 0d0a 2020 2020 2020  ing -= 1..      
-00074030: 2020 2020 2020 2020 2020 6966 2072 756e            if run
-00074040: 6e69 6e67 3a0d 0a20 2020 2020 2020 2020  ning:..         
-00074050: 2020 2020 2020 2020 2020 2069 6478 202d             idx -
-00074060: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-00074070: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00074080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00074090: 6272 6561 6b0d 0a20 2020 2020 2020 2020  break..         
-000740a0: 2020 2069 7468 6574 6120 3d20 6974 6865     itheta = ithe
-000740b0: 7461 202b 2031 0d0a 2020 2020 2020 2020  ta + 1..        
-000740c0: 6966 206e 6f74 2073 656c 662e 706f 6f6c  if not self.pool
-000740d0: 2e71 7565 7565 2e65 6d70 7479 2829 3a0d  .queue.empty():.
-000740e0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-000740f0: 6e74 2822 746f 7461 6c20 616c 6967 6e71  nt("total alignq
-00074100: 7565 7565 2063 6f6d 706f 7365 642e 2073  ueue composed. s
-00074110: 7461 7274 696e 6720 706f 6f6c 7468 7265  tarting poolthre
-00074120: 6164 2229 0d0a 2020 2020 2020 2020 2020  ad")..          
-00074130: 2020 7365 6c66 2e70 6f6f 6c74 6872 6561    self.poolthrea
-00074140: 642e 7374 6172 7428 290d 0a20 2020 2020  d.start()..     
-00074150: 2020 200d 0a20 2020 2064 6566 2043 6f6d     ..    def Com
-00074160: 706f 7365 5368 6966 7451 7565 7565 2873  poseShiftQueue(s
-00074170: 656c 662c 2069 6e69 743d 4661 6c73 6529  elf, init=False)
-00074180: 3a0d 0a20 2020 2020 2020 2070 7269 6e74  :..        print
-00074190: 2822 636f 6d70 6f73 6573 6869 6674 2069  ("composeshift i
-000741a0: 6e69 7469 616c 3f22 2c73 7472 2869 6e69  nitial?",str(ini
-000741b0: 7429 290d 0a20 2020 2020 2020 2073 656c  t))..        sel
-000741c0: 662e 7265 7365 7450 6f6f 6c54 6872 6561  f.resetPoolThrea
-000741d0: 6428 290d 0a20 2020 2020 2020 2023 6172  d()..        #ar
-000741e0: 7261 7920 3d20 6e70 2e6c 6f67 6963 616c  ray = np.logical
-000741f0: 5f6f 7228 7365 6c66 2e4d 6173 6b65 6453  _or(self.MaskedS
-00074200: 6361 7474 6572 446f 7473 4172 7261 7928  catterDotsArray(
-00074210: 7365 6c66 2e78 7265 6769 6f6e 292c 7365  self.xregion),se
-00074220: 6c66 2e4d 6173 6b65 6453 6361 7474 6572  lf.MaskedScatter
-00074230: 446f 7473 4172 7261 7928 7365 6c66 2e79  DotsArray(self.y
-00074240: 7265 6769 6f6e 2929 0d0a 2020 2020 2020  region))..      
-00074250: 2020 6966 206e 6f74 2069 6e69 743a 0d0a    if not init:..
-00074260: 2020 2020 2020 2020 2020 2020 6e74 6865              nthe
-00074270: 7461 203d 205b 7365 6c66 2e69 7468 6574  ta = [self.ithet
-00074280: 615d 0d0a 2020 2020 2020 2020 656c 7365  a]..        else
-00074290: 3a0d 0a20 2020 2020 2020 2020 2020 206e  :..            n
-000742a0: 7468 6574 6120 3d20 7261 6e67 6528 6d61  theta = range(ma
-000742b0: 7828 7365 6c66 2e73 7461 636b 2e6e 5f74  x(self.stack.n_t
-000742c0: 6865 7461 2c31 2929 2023 206e 6563 6573  heta,1)) # neces
-000742d0: 7361 7279 2077 6f72 6b20 6172 6f75 6e64  sary work around
-000742e0: 2066 6f72 2033 6420 7374 6163 6b73 2061   for 3d stacks a
-000742f0: 6e64 2069 6620 3464 2073 7461 636b 2069  nd if 4d stack i
-00074300: 7320 6c6f 6164 6564 2077 6974 6820 4c6f  s loaded with Lo
-00074310: 6164 5374 6163 6b28 290d 0a20 2020 2020  adStack()..     
-00074320: 2020 2020 2020 2066 6f72 2069 7468 6574         for ithet
-00074330: 6120 696e 206e 7468 6574 613a 0d0a 2020  a in ntheta:..  
-00074340: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00074350: 6c66 2e69 6e69 7450 6172 616d 7328 6974  lf.initParams(it
-00074360: 6865 7461 290d 0a20 2020 2020 2020 2066  heta)..        f
-00074370: 6f72 2069 7468 6574 6120 696e 206e 7468  or itheta in nth
-00074380: 6574 613a 0d0a 2020 2020 2020 2020 2020  eta:..          
-00074390: 2020 2370 7269 6e74 2869 7468 6574 6129    #print(itheta)
-000743a0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000743b0: 6c66 2e73 7461 636b 2e73 6869 6674 7364  lf.stack.shiftsd
-000743c0: 6963 745b 7365 6c66 2e69 7468 6574 615d  ict[self.itheta]
-000743d0: 5b22 6669 6c74 6572 225d 203d 2073 656c  ["filter"] = sel
-000743e0: 662e 7370 696e 426f 7846 696c 7465 7273  f.spinBoxFilters
-000743f0: 697a 652e 7661 6c75 6528 290d 0a20 2020  ize.value()..   
-00074400: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-00074410: 6163 6b2e 7368 6966 7473 6469 6374 5b73  ack.shiftsdict[s
-00074420: 656c 662e 6974 6865 7461 5d5b 226d 6574  elf.itheta]["met
-00074430: 686f 6422 5d20 3d20 7365 6c66 2e63 6f6d  hod"] = self.com
-00074440: 626f 426f 785f 6170 7072 6f78 2e63 7572  boBox_approx.cur
-00074450: 7265 6e74 496e 6465 7828 290d 0a20 2020  rentIndex()..   
-00074460: 2020 2020 2020 2020 2073 656c 662e 736c           self.sl
-00074470: 6964 6572 5f74 6865 7461 2e73 6574 5661  ider_theta.setVa
-00074480: 6c75 6528 6974 6865 7461 290d 0a20 2020  lue(itheta)..   
-00074490: 2020 2020 2020 2020 2023 7469 6d65 2e73           #time.s
-000744a0: 6c65 6570 2830 2e32 290d 0a20 2020 2020  leep(0.2)..     
-000744b0: 2020 2020 2020 2078 7368 6966 7473 203d         xshifts =
-000744c0: 2073 656c 662e 4170 706c 7941 7070 726f   self.ApplyAppro
-000744d0: 7869 6d61 7469 6f6e 4675 6e63 7469 6f6e  ximationFunction
-000744e0: 2873 656c 662e 7872 6567 696f 6e29 0d0a  (self.xregion)..
-000744f0: 2020 2020 2020 2020 2020 2020 7973 6869              yshi
-00074500: 6674 7320 3d20 7365 6c66 2e41 7070 6c79  fts = self.Apply
-00074510: 4170 7072 6f78 696d 6174 696f 6e46 756e  ApproximationFun
-00074520: 6374 696f 6e28 7365 6c66 2e79 7265 6769  ction(self.yregi
-00074530: 6f6e 290d 0a20 2020 2020 2020 2020 2020  on)..           
-00074540: 2023 2069 6620 656d 7074 7920 6172 7261   # if empty arra
-00074550: 7973 2c20 692e 652e 2c20 6966 206c 6573  ys, i.e., if les
-00074560: 7320 7468 616e 2032 2064 6f74 7320 7365  s than 2 dots se
-00074570: 6c65 6374 6564 2c20 646f 206e 6f74 6869  lected, do nothi
-00074580: 6e67 0d0a 2020 2020 2020 2020 2020 2020  ng..            
-00074590: 6966 205b 5d20 696e 2028 7873 6869 6674  if [] in (xshift
-000745a0: 732c 2079 7368 6966 7473 293a 0d0a 2020  s, yshifts):..  
-000745b0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000745c0: 7475 726e 0d0a 2020 2020 2020 2020 2020  turn..          
-000745d0: 2020 666f 7220 6576 2069 6e20 7261 6e67    for ev in rang
-000745e0: 6528 7365 6c66 2e73 7461 636b 2e6e 5f65  e(self.stack.n_e
-000745f0: 7629 3a0d 0a20 2020 2020 2020 2020 2020  v):..           
-00074600: 2020 2020 2023 204f 6e6c 7920 656e 7175       # Only enqu
-00074610: 6575 6520 6966 206e 6577 2073 6869 6674  eue if new shift
-00074620: 2076 616c 2069 7320 6469 6666 6572 656e   val is differen
-00074630: 7420 746f 2070 7265 7669 6f75 7320 7368  t to previous sh
-00074640: 6966 740d 0a20 2020 2020 2020 2020 2020  ift..           
-00074650: 2020 2020 2069 6620 2873 656c 662e 7374       if (self.st
-00074660: 6163 6b2e 7368 6966 7473 6469 6374 5b69  ack.shiftsdict[i
-00074670: 7468 6574 615d 5b22 7873 6869 6674 7322  theta]["xshifts"
-00074680: 5d5b 6576 5d2c 7365 6c66 2e73 7461 636b  ][ev],self.stack
-00074690: 2e73 6869 6674 7364 6963 745b 6974 6865  .shiftsdict[ithe
-000746a0: 7461 5d5b 2279 7368 6966 7473 225d 5b65  ta]["yshifts"][e
-000746b0: 765d 2920 213d 2028 7873 6869 6674 735b  v]) != (xshifts[
-000746c0: 6576 5d2c 7973 6869 6674 735b 6576 5d29  ev],yshifts[ev])
-000746d0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000746e0: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
-000746f0: 6b2e 7368 6966 7473 6469 6374 5b69 7468  k.shiftsdict[ith
-00074700: 6574 615d 5b22 7873 6869 6674 7322 5d5b  eta]["xshifts"][
-00074710: 6576 5d20 3d20 7873 6869 6674 735b 6576  ev] = xshifts[ev
-00074720: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00074730: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
-00074740: 6b2e 7368 6966 7473 6469 6374 5b69 7468  k.shiftsdict[ith
-00074750: 6574 615d 5b22 7973 6869 6674 7322 5d5b  eta]["yshifts"][
-00074760: 6576 5d20 3d20 7973 6869 6674 735b 6576  ev] = yshifts[ev
-00074770: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00074780: 2020 2020 2020 2073 656c 662e 706f 6f6c         self.pool
-00074790: 2e65 6e71 7565 7565 7461 736b 2822 5368  .enqueuetask("Sh
-000747a0: 6966 7449 6d67 222c 2065 762c 2078 7368  iftImg", ev, xsh
-000747b0: 6966 7473 5b65 765d 2c20 7973 6869 6674  ifts[ev], yshift
-000747c0: 735b 6576 5d2c 6974 6865 7461 290d 0a20  s[ev],itheta).. 
-000747d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000747e0: 2020 2023 7072 696e 7428 2253 6869 6674     #print("Shift
-000747f0: 496d 6722 2c20 6576 2c20 7873 6869 6674  Img", ev, xshift
-00074800: 735b 6576 5d2c 2079 7368 6966 7473 5b65  s[ev], yshifts[e
-00074810: 765d 2c69 7468 6574 6129 0d0a 2020 2020  v],itheta)..    
-00074820: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-00074830: 706f 6f6c 2e71 7565 7565 2e65 6d70 7479  pool.queue.empty
-00074840: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-00074850: 2070 7269 6e74 2822 746f 7461 6c20 7368   print("total sh
-00074860: 6966 7471 7565 7565 2063 6f6d 706f 7365  iftqueue compose
-00074870: 642e 2073 7461 7274 696e 6720 706f 6f6c  d. starting pool
-00074880: 7468 7265 6164 2077 6974 6820 7175 6575  thread with queu
-00074890: 6520 7369 7a65 222c 7365 6c66 2e70 6f6f  e size",self.poo
-000748a0: 6c2e 7175 6575 652e 7173 697a 6528 2929  l.queue.qsize())
-000748b0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000748c0: 6c66 2e70 6f6f 6c74 6872 6561 642e 7374  lf.poolthread.st
-000748d0: 6172 7428 290d 0a0d 0a20 2020 2023 202d  art()....    # -
-000748e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000748f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00074900: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00074910: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00074920: 2d2d 2d2d 2d0d 0a20 2020 2064 6566 2047  -----..    def G
-00074930: 6574 496e 6465 7850 6169 7273 2873 656c  etIndexPairs(sel
-00074940: 6629 3a0d 0a20 2020 2020 2020 2069 6478  f):..        idx
-00074950: 7475 706c 656c 7374 203d 205b 2869 2b31  tuplelst = [(i+1
-00074960: 2c69 2920 666f 7220 6920 696e 2072 616e  ,i) for i in ran
-00074970: 6765 2873 656c 662e 7374 6163 6b2e 6e5f  ge(self.stack.n_
-00074980: 6576 2d31 295d 0d0a 2020 2020 2020 2020  ev-1)]..        
-00074990: 7265 7475 726e 2069 6478 7475 706c 656c  return idxtuplel
-000749a0: 7374 0d0a 2020 2020 2320 2d2d 2d2d 2d2d  st..    # ------
-000749b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000749c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000749d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000749e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000749f0: 0d0a 2020 2020 6465 6620 4f6e 4175 746f  ..    def OnAuto
-00074a00: 4372 6f70 2873 656c 6629 3a0d 0a20 2020  Crop(self):..   
-00074a10: 2020 2020 2069 6620 7365 6c66 2e61 6c69       if self.ali
-00074a20: 676e 6564 3a0d 0a20 2020 2020 2020 2020  gned:..         
-00074a30: 2020 2073 656c 662e 6362 5f61 7574 6f63     self.cb_autoc
-00074a40: 726f 702e 626c 6f63 6b53 6967 6e61 6c73  rop.blockSignals
-00074a50: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
-00074a60: 2020 2020 7365 6c66 2e43 726f 7053 7461      self.CropSta
-00074a70: 636b 3444 2829 0d0a 2020 2020 2020 2020  ck4D()..        
-00074a80: 2020 2020 7365 6c66 2e63 625f 6175 746f      self.cb_auto
-00074a90: 6372 6f70 2e62 6c6f 636b 5369 676e 616c  crop.blockSignal
-00074aa0: 7328 4661 6c73 6529 0d0a 2020 2020 2020  s(False)..      
-00074ab0: 2020 2020 2020 7365 6c66 2e4f 6e53 6372        self.OnScr
-00074ac0: 6f6c 6c45 6e67 2873 656c 662e 6965 7629  ollEng(self.iev)
-00074ad0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00074ae0: 6c66 2e62 7574 746f 6e5f 616c 6967 6e2e  lf.button_align.
-00074af0: 7365 7445 6e61 626c 6564 2854 7275 6529  setEnabled(True)
-00074b00: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00074b10: 6c66 2e62 7574 746f 6e5f 6f6b 2e73 6574  lf.button_ok.set
-00074b20: 456e 6162 6c65 6428 5472 7565 290d 0a0d  Enabled(True)...
-00074b30: 0a20 2020 2064 6566 2043 726f 7053 7461  .    def CropSta
-00074b40: 636b 3444 2873 656c 6629 3a0d 0a20 2020  ck4D(self):..   
-00074b50: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
-00074b60: 6162 7364 6174 6134 645f 7368 6966 7465  absdata4d_shifte
-00074b70: 645f 6372 6f70 7065 6420 3d20 7365 6c66  d_cropped = self
-00074b80: 2e73 7461 636b 2e61 6273 6461 7461 3464  .stack.absdata4d
-00074b90: 5f73 6869 6674 6564 2e63 6f70 7928 290d  _shifted.copy().
-00074ba0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00074bb0: 2e63 625f 6175 746f 6372 6f70 2e69 7343  .cb_autocrop.isC
-00074bc0: 6865 636b 6564 2829 3a0d 0a20 2020 2020  hecked():..     
-00074bd0: 2020 2020 2020 206e 7468 6574 6120 3d20         ntheta = 
-00074be0: 7261 6e67 6528 6d61 7828 7365 6c66 2e73  range(max(self.s
-00074bf0: 7461 636b 2e6e 5f74 6865 7461 2c31 2929  tack.n_theta,1))
-00074c00: 2023 206e 6563 6573 7361 7279 2077 6f72   # necessary wor
-00074c10: 6b20 6172 6f75 6e64 2066 6f72 2033 6420  k around for 3d 
-00074c20: 7374 6163 6b73 2061 6e64 2069 6620 3464  stacks and if 4d
-00074c30: 2073 7461 636b 2069 7320 6c6f 6164 6564   stack is loaded
-00074c40: 2077 6974 6820 4c6f 6164 5374 6163 6b28   with LoadStack(
-00074c50: 290d 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00074c60: 7072 696e 7428 6e74 6865 7461 290d 0a20  print(ntheta).. 
-00074c70: 2020 2020 2020 2020 2020 2067 6c6f 6261             globa
-00074c80: 6c6d 696e 7820 3d20 6d69 6e28 5b6a 2066  lminx = min([j f
-00074c90: 6f72 2069 2069 6e20 5b73 656c 662e 7374  or i in [self.st
-00074ca0: 6163 6b2e 7368 6966 7473 6469 6374 5b74  ack.shiftsdict[t
-00074cb0: 6865 7461 5d5b 2278 7368 6966 7473 225d  heta]["xshifts"]
-00074cc0: 2066 6f72 2074 6865 7461 2069 6e20 6e74   for theta in nt
-00074cd0: 6865 7461 5d20 666f 7220 6a20 696e 2069  heta] for j in i
-00074ce0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00074cf0: 676c 6f62 616c 6d61 7878 203d 206d 6178  globalmaxx = max
-00074d00: 285b 6a20 666f 7220 6920 696e 205b 7365  ([j for i in [se
-00074d10: 6c66 2e73 7461 636b 2e73 6869 6674 7364  lf.stack.shiftsd
-00074d20: 6963 745b 7468 6574 615d 5b22 7873 6869  ict[theta]["xshi
-00074d30: 6674 7322 5d20 666f 7220 7468 6574 6120  fts"] for theta 
-00074d40: 696e 206e 7468 6574 615d 2066 6f72 206a  in ntheta] for j
-00074d50: 2069 6e20 695d 290d 0a20 2020 2020 2020   in i])..       
-00074d60: 2020 2020 2067 6c6f 6261 6c6d 696e 7920       globalminy 
-00074d70: 3d20 6d69 6e28 5b6a 2066 6f72 2069 2069  = min([j for i i
-00074d80: 6e20 5b73 656c 662e 7374 6163 6b2e 7368  n [self.stack.sh
-00074d90: 6966 7473 6469 6374 5b74 6865 7461 5d5b  iftsdict[theta][
-00074da0: 2279 7368 6966 7473 225d 2066 6f72 2074  "yshifts"] for t
-00074db0: 6865 7461 2069 6e20 6e74 6865 7461 5d20  heta in ntheta] 
-00074dc0: 666f 7220 6a20 696e 2069 5d29 0d0a 2020  for j in i])..  
-00074dd0: 2020 2020 2020 2020 2020 676c 6f62 616c            global
-00074de0: 6d61 7879 203d 206d 6178 285b 6a20 666f  maxy = max([j fo
-00074df0: 7220 6920 696e 205b 7365 6c66 2e73 7461  r i in [self.sta
-00074e00: 636b 2e73 6869 6674 7364 6963 745b 7468  ck.shiftsdict[th
-00074e10: 6574 615d 5b22 7973 6869 6674 7322 5d20  eta]["yshifts"] 
-00074e20: 666f 7220 7468 6574 6120 696e 206e 7468  for theta in nth
-00074e30: 6574 615d 2066 6f72 206a 2069 6e20 695d  eta] for j in i]
-00074e40: 290d 0a20 2020 2020 2020 2020 2020 2070  )..            p
-00074e50: 7269 6e74 2822 6372 6f70 7374 6163 6b34  rint("cropstack4
-00074e60: 643a 2022 2c67 6c6f 6261 6c6d 696e 782c  d: ",globalminx,
-00074e70: 676c 6f62 616c 6d61 7878 2c67 6c6f 6261  globalmaxx,globa
-00074e80: 6c6d 696e 792c 676c 6f62 616c 6d61 7879  lminy,globalmaxy
-00074e90: 290d 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00074ea0: 6966 206e 6f74 2073 656c 662e 636f 6d2e  if not self.com.
-00074eb0: 7374 6163 6b5f 3464 3a0d 0a20 2020 2020  stack_4d:..     
-00074ec0: 2020 2020 2020 2073 656c 662e 626f 782e         self.box.
-00074ed0: 6869 6465 2829 0d0a 2020 2020 2020 2020  hide()..        
-00074ee0: 2020 2020 6c20 3d20 2d69 6e74 286e 702e      l = -int(np.
-00074ef0: 666c 6f6f 7228 676c 6f62 616c 6d69 6e78  floor(globalminx
-00074f00: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00074f10: 7220 3d20 2d69 6e74 286e 702e 6365 696c  r = -int(np.ceil
-00074f20: 2867 6c6f 6261 6c6d 6178 7829 290d 0a20  (globalmaxx)).. 
-00074f30: 2020 2020 2020 2020 2020 2063 7220 3d20             cr = 
-00074f40: 7220 6966 2072 203c 2030 2065 6c73 6520  r if r < 0 else 
-00074f50: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-00074f60: 2020 6966 206c 203c 2030 3a0d 0a20 2020    if l < 0:..   
-00074f70: 2020 2020 2020 2020 2020 2020 206c 203d               l =
-00074f80: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
-00074f90: 2020 2020 6372 203d 2063 7220 2d20 6c0d      cr = cr - l.
-00074fa0: 0a20 2020 2020 2020 2020 2020 2062 203d  .            b =
-00074fb0: 202d 696e 7428 6e70 2e66 6c6f 6f72 2867   -int(np.floor(g
-00074fc0: 6c6f 6261 6c6d 696e 7929 290d 0a20 2020  lobalminy))..   
-00074fd0: 2020 2020 2020 2020 2074 203d 202d 696e           t = -in
-00074fe0: 7428 6e70 2e63 6569 6c28 676c 6f62 616c  t(np.ceil(global
-00074ff0: 6d61 7879 2929 0d0a 2020 2020 2020 2020  maxy))..        
-00075000: 2020 2020 6374 203d 2074 2069 6620 7420      ct = t if t 
-00075010: 3c20 3020 656c 7365 204e 6f6e 650d 0a20  < 0 else None.. 
-00075020: 2020 2020 2020 2020 2020 2069 6620 6220             if b 
-00075030: 3c20 303a 0d0a 2020 2020 2020 2020 2020  < 0:..          
-00075040: 2020 2020 2020 6220 3d20 300d 0a20 2020        b = 0..   
-00075050: 2020 2020 2020 2020 2020 2020 2063 7420               ct 
-00075060: 3d20 6374 202d 2062 0d0a 2020 2020 2020  = ct - b..      
-00075070: 2020 2020 2020 6966 2030 2069 6e20 7365        if 0 in se
-00075080: 6c66 2e73 7461 636b 2e61 6273 6461 7461  lf.stack.absdata
-00075090: 3464 5f73 6869 6674 6564 5f63 726f 7070  4d_shifted_cropp
-000750a0: 6564 5b6c 3a63 722c 623a 6374 2c3a 2c73  ed[l:cr,b:ct,:,s
-000750b0: 656c 662e 6974 6865 7461 5d2e 7368 6170  elf.itheta].shap
-000750c0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000750d0: 2020 2020 5174 5769 6467 6574 732e 514d      QtWidgets.QM
-000750e0: 6573 7361 6765 426f 782e 7761 726e 696e  essageBox.warnin
-000750f0: 6728 7365 6c66 2c20 2745 7272 6f72 272c  g(self, 'Error',
-00075100: 2027 5468 6520 616c 6967 6e6d 656e 7420   'The alignment 
-00075110: 6661 696c 6564 2e20 4372 6f70 7069 6e67  failed. Cropping
-00075120: 2077 6f75 6c64 2072 6573 756c 7420 696e   would result in
-00075130: 2061 207a 6572 6f2d 6469 6d65 6e73 696f   a zero-dimensio
-00075140: 6e61 6c20 696d 6167 652e 2050 6c65 6173  nal image. Pleas
-00075150: 6520 6368 6563 6b20 796f 7572 2073 6574  e check your set
-00075160: 7469 6e67 732e 2041 7574 6f2d 6372 6f70  tings. Auto-crop
-00075170: 2068 6173 2062 6565 6e20 6469 7361 626c   has been disabl
-00075180: 6564 2e20 596f 7520 6361 6e20 7265 2d65  ed. You can re-e
-00075190: 6e61 626c 6520 6974 206d 616e 7561 6c6c  nable it manuall
-000751a0: 792e 2729 0d0a 2020 2020 2020 2020 2020  y.')..          
-000751b0: 2020 2020 2020 7365 6c66 2e63 625f 6175        self.cb_au
-000751c0: 746f 6372 6f70 2e73 6574 4368 6563 6b65  tocrop.setChecke
-000751d0: 6428 4661 6c73 6529 0d0a 2020 2020 2020  d(False)..      
-000751e0: 2020 2020 2020 2020 2020 7365 6c66 2e4f            self.O
-000751f0: 6e52 6573 6574 524f 4928 290d 0a20 2020  nResetROI()..   
-00075200: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00075210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00075220: 7365 6c66 2e73 7461 636b 2e61 6273 6461  self.stack.absda
-00075230: 7461 3464 5f73 6869 6674 6564 5f63 726f  ta4d_shifted_cro
-00075240: 7070 6564 203d 2073 656c 662e 7374 6163  pped = self.stac
-00075250: 6b2e 6162 7364 6174 6134 645f 7368 6966  k.absdata4d_shif
-00075260: 7465 645f 6372 6f70 7065 645b 6c3a 6372  ted_cropped[l:cr
-00075270: 2c62 3a63 742c 3a2c 3a5d 0d0a 2020 2020  ,b:ct,:,:]..    
-00075280: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00075290: 2020 2020 2020 2073 656c 662e 626f 782e         self.box.
-000752a0: 7368 6f77 2829 0d0a 0d0a 2020 2020 6465  show()....    de
-000752b0: 6620 4f6e 5363 726f 6c6c 456e 6728 7365  f OnScrollEng(se
-000752c0: 6c66 2c20 7661 6c75 6529 3a0d 0a20 2020  lf, value):..   
-000752d0: 2020 2020 2073 656c 662e 736c 6964 6572       self.slider
-000752e0: 5f65 6e67 2e73 6574 5661 6c75 6528 7661  _eng.setValue(va
-000752f0: 6c75 6529 0d0a 2020 2020 2020 2020 7365  lue)..        se
-00075300: 6c66 2e69 6576 203d 2076 616c 7565 0d0a  lf.iev = value..
-00075310: 2020 2020 2020 2020 7365 6c66 2e53 686f          self.Sho
-00075320: 7749 6d61 6765 2829 0d0a 2020 2020 2020  wImage()..      
-00075330: 2020 7365 6c66 2e72 6566 6d61 726b 6572    self.refmarker
-00075340: 782e 7365 7456 616c 7565 2873 656c 662e  x.setValue(self.
-00075350: 7374 6163 6b2e 6576 5b73 656c 662e 6965  stack.ev[self.ie
-00075360: 765d 290d 0a20 2020 2020 2020 2073 656c  v])..        sel
-00075370: 662e 7265 666d 6172 6b65 7279 2e73 6574  f.refmarkery.set
-00075380: 5661 6c75 6528 7365 6c66 2e73 7461 636b  Value(self.stack
-00075390: 2e65 765b 7365 6c66 2e69 6576 5d29 0d0a  .ev[self.iev])..
-000753a0: 2020 2020 6465 6620 4f6e 5363 726f 6c6c      def OnScroll
-000753b0: 5468 6574 6128 7365 6c66 2c20 7661 6c75  Theta(self, valu
-000753c0: 6529 3a0d 0a20 2020 2020 2020 2023 6966  e):..        #if
-000753d0: 2076 616c 7565 2021 3d20 7365 6c66 2e69   value != self.i
-000753e0: 7468 6574 613a 0d0a 2020 2020 2020 2020  theta:..        
-000753f0: 2370 7269 6e74 2822 5468 6574 6120 736c  #print("Theta sl
-00075400: 6964 6572 2220 2b20 7374 7228 7661 6c75  ider" + str(valu
-00075410: 6529 290d 0a20 2020 2020 2020 2073 656c  e))..        sel
-00075420: 662e 736c 6964 6572 5f74 6865 7461 2e73  f.slider_theta.s
-00075430: 6574 5661 6c75 6528 7661 6c75 6529 0d0a  etValue(value)..
-00075440: 2020 2020 2020 2020 7365 6c66 2e69 7468          self.ith
-00075450: 6574 6120 3d20 7661 6c75 650d 0a20 2020  eta = value..   
-00075460: 2020 2020 2023 7365 6c66 2e43 6c65 6172       #self.Clear
-00075470: 5368 6966 7473 2829 0d0a 2020 2020 2020  Shifts()..      
-00075480: 2020 7365 6c66 2e53 686f 7749 6d61 6765    self.ShowImage
-00075490: 2829 0d0a 2020 2020 2020 2020 6966 2073  ()..        if s
-000754a0: 656c 662e 616c 6967 6e65 643a 0d0a 2020  elf.aligned:..  
-000754b0: 2020 2020 2020 2020 2020 2373 656c 662e            #self.
-000754c0: 4d61 6b65 4e65 7753 6361 7474 6572 506c  MakeNewScatterPl
-000754d0: 6f74 7328 290d 0a20 2020 2020 2020 2020  ots()..         
-000754e0: 2020 2065 7272 6f72 7468 7265 7368 6f6c     errorthreshol
-000754f0: 6420 3d20 7365 6c66 2e73 7461 636b 2e73  d = self.stack.s
-00075500: 6869 6674 7364 6963 745b 7365 6c66 2e69  hiftsdict[self.i
-00075510: 7468 6574 615d 5b22 7468 7265 7368 6f6c  theta]["threshol
-00075520: 6422 5d0d 0a20 2020 2020 2020 2020 2020  d"]..           
-00075530: 2065 7272 6f72 7320 3d20 7365 6c66 2e73   errors = self.s
-00075540: 7461 636b 2e73 6869 6674 7364 6963 745b  tack.shiftsdict[
-00075550: 7365 6c66 2e69 7468 6574 615d 5b22 6572  self.itheta]["er
-00075560: 726f 7273 225d 0d0a 2020 2020 2020 2020  rors"]..        
-00075570: 2020 2020 6966 206e 6f74 2065 7272 6f72      if not error
-00075580: 7468 7265 7368 6f6c 643a 0d0a 2020 2020  threshold:..    
-00075590: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-000755a0: 7274 6872 6573 686f 6c64 203d 2072 6f75  rthreshold = rou
-000755b0: 6e64 286e 702e 6d65 616e 2865 7272 6f72  nd(np.mean(error
-000755c0: 7329 2c20 3429 0d0a 2020 2020 2020 2020  s), 4)..        
-000755d0: 2020 2020 7365 6c66 2e72 6573 746f 7265      self.restore
-000755e0: 5061 7261 6d73 2873 656c 662e 6974 6865  Params(self.ithe
-000755f0: 7461 290d 0a20 2020 2020 2020 2020 2020  ta)..           
-00075600: 2073 656c 662e 4d61 736b 5363 6174 7465   self.MaskScatte
-00075610: 7244 6f74 7341 626f 7665 4572 726f 7254  rDotsAboveErrorT
-00075620: 6872 6573 686f 6c64 2828 6572 726f 7273  hreshold((errors
-00075630: 2c20 6572 726f 7274 6872 6573 686f 6c64  , errorthreshold
-00075640: 2c20 7365 6c66 2e69 7468 6574 6129 290d  , self.itheta)).
-00075650: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
-00075660: 6620 7365 6c66 2e63 625f 6175 746f 6572  f self.cb_autoer
-00075670: 726f 722e 6973 4368 6563 6b65 6428 293a  ror.isChecked():
-00075680: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00075690: 2020 2020 7365 6c66 2e73 7069 6e42 6f78      self.spinBox
-000756a0: 4572 726f 722e 626c 6f63 6b53 6967 6e61  Error.blockSigna
-000756b0: 6c73 2854 7275 6529 0d0a 2020 2020 2020  ls(True)..      
-000756c0: 2020 2020 2020 2320 2020 2020 7365 6c66        #     self
-000756d0: 2e73 7069 6e42 6f78 4572 726f 722e 7365  .spinBoxError.se
-000756e0: 7456 616c 7565 2865 7272 6f72 7468 7265  tValue(errorthre
-000756f0: 7368 6f6c 6429 0d0a 2020 2020 2020 2020  shold)..        
-00075700: 2020 2020 2320 2020 2020 7365 6c66 2e73      #     self.s
-00075710: 7069 6e42 6f78 4572 726f 722e 626c 6f63  pinBoxError.bloc
-00075720: 6b53 6967 6e61 6c73 2846 616c 7365 290d  kSignals(False).
-00075730: 0a20 2020 2020 2020 2020 2020 2078 646f  .            xdo
-00075740: 7473 203d 2073 656c 662e 7374 6163 6b2e  ts = self.stack.
-00075750: 7368 6966 7473 6469 6374 5b73 656c 662e  shiftsdict[self.
-00075760: 6974 6865 7461 5d5b 2278 646f 7473 225d  itheta]["xdots"]
-00075770: 0d0a 2020 2020 2020 2020 2020 2020 7964  ..            yd
-00075780: 6f74 7320 3d20 7365 6c66 2e73 7461 636b  ots = self.stack
-00075790: 2e73 6869 6674 7364 6963 745b 7365 6c66  .shiftsdict[self
-000757a0: 2e69 7468 6574 615d 5b22 7964 6f74 7322  .itheta]["ydots"
-000757b0: 5d0d 0a20 2020 2020 2020 2020 2020 206d  ]..            m
-000757c0: 6173 6b65 6478 203d 2073 656c 662e 4d61  askedx = self.Ma
-000757d0: 736b 6564 5363 6174 7465 7244 6f74 7341  skedScatterDotsA
-000757e0: 7272 6179 2873 656c 662e 7872 6567 696f  rray(self.xregio
-000757f0: 6e29 0d0a 2020 2020 2020 2020 2020 2020  n)..            
-00075800: 6d61 736b 6564 7920 3d20 7365 6c66 2e4d  maskedy = self.M
-00075810: 6173 6b65 6453 6361 7474 6572 446f 7473  askedScatterDots
-00075820: 4172 7261 7928 7365 6c66 2e79 7265 6769  Array(self.yregi
-00075830: 6f6e 290d 0a20 2020 2020 2020 2020 2020  on)..           
-00075840: 2073 656c 662e 7873 6361 7474 6572 2e73   self.xscatter.s
-00075850: 6574 4461 7461 2873 706f 7473 3d73 656c  etData(spots=sel
-00075860: 662e 4372 6561 7465 5363 6174 7465 7244  f.CreateScatterD
-00075870: 6f74 7328 7864 6f74 732c 206d 6173 6b65  ots(xdots, maske
-00075880: 6478 292c 2070 784d 6f64 653d 5472 7565  dx), pxMode=True
-00075890: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-000758a0: 656c 662e 7973 6361 7474 6572 2e73 6574  elf.yscatter.set
-000758b0: 4461 7461 2873 706f 7473 3d73 656c 662e  Data(spots=self.
-000758c0: 4372 6561 7465 5363 6174 7465 7244 6f74  CreateScatterDot
-000758d0: 7328 7964 6f74 732c 206d 6173 6b65 6479  s(ydots, maskedy
-000758e0: 292c 2070 784d 6f64 653d 5472 7565 290d  ), pxMode=True).
-000758f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00075900: 662e 6669 745f 782e 7365 7444 6174 6128  f.fit_x.setData(
-00075910: 783d 7365 6c66 2e73 7461 636b 2e65 762c  x=self.stack.ev,
-00075920: 2079 3d73 656c 662e 7374 6163 6b2e 7368   y=self.stack.sh
-00075930: 6966 7473 6469 6374 5b73 656c 662e 6974  iftsdict[self.it
-00075940: 6865 7461 5d5b 2278 7368 6966 7473 225d  heta]["xshifts"]
-00075950: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00075960: 656c 662e 6669 745f 792e 7365 7444 6174  elf.fit_y.setDat
-00075970: 6128 783d 7365 6c66 2e73 7461 636b 2e65  a(x=self.stack.e
-00075980: 762c 2079 3d73 656c 662e 7374 6163 6b2e  v, y=self.stack.
-00075990: 7368 6966 7473 6469 6374 5b73 656c 662e  shiftsdict[self.
-000759a0: 6974 6865 7461 5d5b 2279 7368 6966 7473  itheta]["yshifts
-000759b0: 225d 290d 0a0d 0a20 2020 2020 2020 2020  "])....         
-000759c0: 2020 2023 6d69 6e5f 6964 782c 206d 6178     #min_idx, max
-000759d0: 5f69 6478 2c20 6d69 6e5f 6576 2c20 6d61  _idx, min_ev, ma
-000759e0: 785f 6576 203d 2073 656c 662e 6765 7444  x_ev = self.getD
-000759f0: 6174 6143 6c6f 7365 7374 546f 5265 6769  ataClosestToRegi
-00075a00: 6f6e 2873 656c 662e 7872 6567 696f 6e2c  on(self.xregion,
-00075a10: 2073 656c 662e 7873 6361 7474 6572 2c20   self.xscatter, 
-00075a20: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
-00075a30: 2020 2023 6d69 6e5f 6964 782c 206d 6178     #min_idx, max
-00075a40: 5f69 6478 2c20 6d69 6e5f 6576 2c20 6d61  _idx, min_ev, ma
-00075a50: 785f 6576 203d 2073 656c 662e 6765 7444  x_ev = self.getD
-00075a60: 6174 6143 6c6f 7365 7374 546f 5265 6769  ataClosestToRegi
-00075a70: 6f6e 2873 656c 662e 7972 6567 696f 6e2c  on(self.yregion,
-00075a80: 2073 656c 662e 7973 6361 7474 6572 2c20   self.yscatter, 
-00075a90: 5472 7565 290d 0a0d 0a20 2020 2020 2020  True)....       
-00075aa0: 2020 2020 2023 7365 6c66 2e66 6974 5f78       #self.fit_x
-00075ab0: 2e73 686f 7728 290d 0a20 2020 2020 2020  .show()..       
-00075ac0: 2020 2020 2073 656c 662e 4f6e 4c69 6e52       self.OnLinR
-00075ad0: 6567 696f 6e28 7365 6c66 2e78 7265 6769  egion(self.xregi
-00075ae0: 6f6e 2c20 7570 6461 7465 3d46 616c 7365  on, update=False
-00075af0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00075b00: 656c 662e 4f6e 4c69 6e52 6567 696f 6e28  elf.OnLinRegion(
-00075b10: 7365 6c66 2e79 7265 6769 6f6e 2c20 7570  self.yregion, up
-00075b20: 6461 7465 3d46 616c 7365 290d 0a0d 0a20  date=False).... 
-00075b30: 2020 2064 6566 2053 686f 7749 6d61 6765     def ShowImage
-00075b40: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00075b50: 2073 656c 662e 7374 6163 6b2e 6162 7364   self.stack.absd
-00075b60: 6174 615f 7368 6966 7465 645f 6372 6f70  ata_shifted_crop
-00075b70: 7065 6420 3d20 7365 6c66 2e73 7461 636b  ped = self.stack
-00075b80: 2e61 6273 6461 7461 3464 5f73 6869 6674  .absdata4d_shift
-00075b90: 6564 5f63 726f 7070 6564 5b3a 2c20 3a2c  ed_cropped[:, :,
-00075ba0: 203a 2c20 696e 7428 7365 6c66 2e69 7468   :, int(self.ith
-00075bb0: 6574 6129 5d0d 0a20 2020 2020 2020 2073  eta)]..        s
-00075bc0: 656c 662e 695f 6974 656d 2e73 6574 496d  elf.i_item.setIm
-00075bd0: 6167 6528 7365 6c66 2e73 7461 636b 2e61  age(self.stack.a
-00075be0: 6273 6461 7461 5f73 6869 6674 6564 5f63  bsdata_shifted_c
-00075bf0: 726f 7070 6564 5b3a 2c20 3a2c 2069 6e74  ropped[:, :, int
-00075c00: 2873 656c 662e 6965 7629 5d29 0d0a 2020  (self.iev)])..  
-00075c10: 2020 2020 2020 6966 2073 656c 662e 636f        if self.co
-00075c20: 6d2e 7374 6163 6b5f 3464 203d 3d20 313a  m.stack_4d == 1:
-00075c30: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00075c40: 6c66 2e67 726f 7570 426f 782e 7365 7454  lf.groupBox.setT
-00075c50: 6974 6c65 2873 7472 2827 5374 6163 6b20  itle(str('Stack 
-00075c60: 4272 6f77 7365 7220 7c20 496d 6167 6520  Browser | Image 
-00075c70: 6174 207b 303a 352e 3266 7d20 6556 2061  at {0:5.2f} eV a
-00075c80: 6e64 207b 313a 352e 3166 7dc2 b027 292e  nd {1:5.1f}..').
-00075c90: 666f 726d 6174 2866 6c6f 6174 2873 656c  format(float(sel
-00075ca0: 662e 7374 6163 6b2e 6576 5b73 656c 662e  f.stack.ev[self.
-00075cb0: 6965 765d 292c 666c 6f61 7428 7365 6c66  iev]),float(self
-00075cc0: 2e73 7461 636b 2e74 6865 7461 5b73 656c  .stack.theta[sel
-00075cd0: 662e 6974 6865 7461 5d29 2c20 2929 0d0a  f.itheta]), ))..
-00075ce0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00075cf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00075d00: 6772 6f75 7042 6f78 2e73 6574 5469 746c  groupBox.setTitl
-00075d10: 6528 7374 7228 2753 7461 636b 2042 726f  e(str('Stack Bro
-00075d20: 7773 6572 207c 2049 6d61 6765 2061 7420  wser | Image at 
-00075d30: 7b30 3a35 2e32 667d 2065 5627 292e 666f  {0:5.2f} eV').fo
-00075d40: 726d 6174 2866 6c6f 6174 2873 656c 662e  rmat(float(self.
-00075d50: 7374 6163 6b2e 6576 5b73 656c 662e 6965  stack.ev[self.ie
-00075d60: 765d 2929 290d 0a0d 0a20 2020 2023 2320  v])))....    ## 
-00075d70: 5365 7475 7020 6120 524f 4920 666f 7220  Setup a ROI for 
-00075d80: 616e 2061 6c69 676e 6d65 6e74 2072 6563  an alignment rec
-00075d90: 7461 6e67 6c65 2e20 4279 2064 6566 6175  tangle. By defau
-00075da0: 6c74 2074 6865 2077 686f 6c65 2069 6d61  lt the whole ima
-00075db0: 6765 2061 7265 6120 6973 2075 7365 642e  ge area is used.
-00075dc0: 0d0a 2020 2020 6465 6620 5365 7475 7052  ..    def SetupR
-00075dd0: 4f49 2873 656c 6629 3a0d 0a20 2020 2020  OI(self):..     
-00075de0: 2020 2073 656c 662e 626f 7820 3d20 7067     self.box = pg
-00075df0: 2e52 6563 7452 4f49 2873 656c 662e 695f  .RectROI(self.i_
-00075e00: 6974 656d 2e62 6f75 6e64 696e 6752 6563  item.boundingRec
-00075e10: 7428 292e 746f 704c 6566 7428 292c 2073  t().topLeft(), s
-00075e20: 656c 662e 695f 6974 656d 2e62 6f75 6e64  elf.i_item.bound
-00075e30: 696e 6752 6563 7428 292e 626f 7474 6f6d  ingRect().bottom
-00075e40: 5269 6768 7428 292c 0d0a 2020 2020 2020  Right(),..      
-00075e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00075e60: 2020 2020 2020 2020 7065 6e3d 2835 2c20          pen=(5, 
-00075e70: 3829 2c20 6861 6e64 6c65 5065 6e3d 5174  8), handlePen=Qt
-00075e80: 4775 692e 5150 656e 2851 7447 7569 2e51  Gui.QPen(QtGui.Q
-00075e90: 436f 6c6f 7228 3235 352c 2030 2c20 3132  Color(255, 0, 12
-00075ea0: 382c 2032 3535 2929 2c20 6365 6e74 6572  8, 255)), center
-00075eb0: 6564 3d46 616c 7365 2c0d 0a20 2020 2020  ed=False,..     
-00075ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00075ed0: 2020 2020 2020 2020 2073 6964 6553 6361           sideSca
-00075ee0: 6c65 7273 3d46 616c 7365 2c20 7265 6d6f  lers=False, remo
-00075ef0: 7661 626c 653d 4661 6c73 652c 2073 6361  vable=False, sca
-00075f00: 6c65 536e 6170 3d54 7275 652c 2074 7261  leSnap=True, tra
-00075f10: 6e73 6c61 7465 536e 6170 3d54 7275 652c  nslateSnap=True,
-00075f20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00075f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00075f40: 6d61 7842 6f75 6e64 733d 7365 6c66 2e69  maxBounds=self.i
-00075f50: 5f69 7465 6d2e 626f 756e 6469 6e67 5265  _item.boundingRe
-00075f60: 6374 2829 290d 0a20 2020 2020 2020 2073  ct())..        s
-00075f70: 656c 662e 7662 2e61 6464 4974 656d 2873  elf.vb.addItem(s
-00075f80: 656c 662e 626f 782c 2069 676e 6f72 6542  elf.box, ignoreB
-00075f90: 6f75 6e64 733d 4661 6c73 6529 0d0a 2020  ounds=False)..  
-00075fa0: 2020 2020 2020 7365 6c66 2e62 6f78 2e73        self.box.s
-00075fb0: 6967 5265 6769 6f6e 4368 616e 6765 4669  igRegionChangeFi
-00075fc0: 6e69 7368 6564 2e63 6f6e 6e65 6374 2873  nished.connect(s
-00075fd0: 656c 662e 4f6e 426f 7843 6861 6e67 6564  elf.OnBoxChanged
-00075fe0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00075ff0: 626f 782e 7369 6752 6567 696f 6e43 6861  box.sigRegionCha
-00076000: 6e67 6553 7461 7274 6564 2e63 6f6e 6e65  ngeStarted.conne
-00076010: 6374 2873 656c 662e 4f6e 426f 7843 6861  ct(self.OnBoxCha
-00076020: 6e67 696e 6729 0d0a 2020 2020 2020 2020  nging)..        
-00076030: 7365 6c66 2e62 7574 746f 6e5f 7273 7472  self.button_rstr
-00076040: 6f69 2e63 6c69 636b 6564 2e63 6f6e 6e65  oi.clicked.conne
-00076050: 6374 2873 656c 662e 4f6e 5265 7365 7452  ct(self.OnResetR
-00076060: 4f49 290d 0a20 2020 2023 2320 5468 6520  OI)..    ## The 
-00076070: 524f 4920 6973 206c 696d 6974 6564 2074  ROI is limited t
-00076080: 6f20 7468 6520 7669 7369 626c 6520 696d  o the visible im
-00076090: 6167 6520 6172 6561 2e20 4f6e 4d6f 7573  age area. OnMous
-000760a0: 654d 6f76 654f 7574 7369 6465 2068 616e  eMoveOutside han
-000760b0: 646c 6573 2074 6865 2062 6568 6176 696f  dles the behavio
-000760c0: 7220 7768 656e 0d0a 2020 2020 6465 6620  r when..    def 
-000760d0: 436c 6561 7253 6869 6674 7328 7365 6c66  ClearShifts(self
-000760e0: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
-000760f0: 2e61 6c69 676e 6564 203d 2046 616c 7365  .aligned = False
-00076100: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00076110: 625f 6175 746f 6572 726f 722e 7374 6174  b_autoerror.stat
-00076120: 6543 6861 6e67 6564 2e64 6973 636f 6e6e  eChanged.disconn
-00076130: 6563 7428 290d 0a20 2020 2020 2020 2073  ect()..        s
-00076140: 656c 662e 6669 745f 782e 6869 6465 2829  elf.fit_x.hide()
-00076150: 0d0a 2020 2020 2020 2020 7365 6c66 2e66  ..        self.f
-00076160: 6974 5f79 2e68 6964 6528 290d 0a20 2020  it_y.hide()..   
-00076170: 2020 2020 2073 656c 662e 496e 6974 5368       self.InitSh
-00076180: 6966 7473 4469 6374 2829 0d0a 2020 2020  iftsDict()..    
-00076190: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-000761a0: 616c 6967 6e2e 7365 7445 6e61 626c 6564  align.setEnabled
-000761b0: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
-000761c0: 7365 6c66 2e4d 616b 654e 6577 5363 6174  self.MakeNewScat
-000761d0: 7465 7250 6c6f 7473 2829 0d0a 2020 2020  terPlots()..    
-000761e0: 6465 6620 4f6e 5265 7365 7452 4f49 2873  def OnResetROI(s
-000761f0: 656c 6629 3a0d 0a20 2020 2020 2020 2073  elf):..        s
-00076200: 656c 662e 436c 6561 7253 6869 6674 7328  elf.ClearShifts(
-00076210: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00076220: 7374 6163 6b2e 6162 7364 6174 6134 645f  stack.absdata4d_
-00076230: 7368 6966 7465 645f 6372 6f70 7065 6420  shifted_cropped 
-00076240: 3d20 7365 6c66 2e73 7461 636b 2e61 6273  = self.stack.abs
-00076250: 6461 7461 3464 2e63 6f70 7928 290d 0a20  data4d.copy().. 
-00076260: 2020 2020 2020 2073 656c 662e 4f6e 5363         self.OnSc
-00076270: 726f 6c6c 456e 6728 7365 6c66 2e69 6576  rollEng(self.iev
-00076280: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00076290: 626f 782e 7365 7450 6f73 2830 2c20 302c  box.setPos(0, 0,
-000762a0: 2075 7064 6174 653d 4661 6c73 652c 2066   update=False, f
-000762b0: 696e 6973 683d 4661 6c73 6529 0d0a 2020  inish=False)..  
-000762c0: 2020 2020 2020 7365 6c66 2e62 6f78 2e73        self.box.s
-000762d0: 6574 5369 7a65 2873 656c 662e 695f 6974  etSize(self.i_it
-000762e0: 656d 2e62 6f75 6e64 696e 6752 6563 7428  em.boundingRect(
-000762f0: 292e 626f 7474 6f6d 5269 6768 7428 2920  ).bottomRight() 
-00076300: 2d20 7365 6c66 2e62 6f78 2e70 6f73 2829  - self.box.pos()
-00076310: 2c20 7570 6461 7465 3d54 7275 652c 2073  , update=True, s
-00076320: 6e61 703d 5472 7565 2c20 6669 6e69 7368  nap=True, finish
-00076330: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-00076340: 7365 6c66 2e62 6f78 2e73 686f 7728 290d  self.box.show().
-00076350: 0a20 2020 2064 6566 204f 6e42 6f78 4368  .    def OnBoxCh
-00076360: 616e 6769 6e67 2873 656c 6629 3a0d 0a20  anging(self):.. 
-00076370: 2020 2020 2020 2073 656c 662e 626f 7873         self.boxs
-00076380: 697a 6520 3d20 7365 6c66 2e62 6f78 2e73  ize = self.box.s
-00076390: 697a 6528 290d 0a20 2020 2020 2020 2073  ize()..        s
-000763a0: 656c 662e 7072 6f78 7920 3d20 7067 2e53  elf.proxy = pg.S
-000763b0: 6967 6e61 6c50 726f 7879 2873 656c 662e  ignalProxy(self.
-000763c0: 7662 2e73 6365 6e65 2829 2e73 6967 4d6f  vb.scene().sigMo
-000763d0: 7573 654d 6f76 6564 2c20 7261 7465 4c69  useMoved, rateLi
-000763e0: 6d69 743d 3330 2c20 736c 6f74 3d73 656c  mit=30, slot=sel
-000763f0: 662e 4f6e 4d6f 7573 654d 6f76 654f 7574  f.OnMouseMoveOut
-00076400: 7369 6465 290d 0a20 2020 2064 6566 204f  side)..    def O
-00076410: 6e42 6f78 4368 616e 6765 6428 7365 6c66  nBoxChanged(self
-00076420: 293a 0d0a 2020 2020 2020 2020 7472 793a  ):..        try:
-00076430: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00076440: 6c66 2e70 726f 7879 2e64 6973 636f 6e6e  lf.proxy.disconn
-00076450: 6563 7428 290d 0a20 2020 2020 2020 2065  ect()..        e
-00076460: 7863 6570 7420 4174 7472 6962 7574 6545  xcept AttributeE
-00076470: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-00076480: 2020 2070 6173 730d 0a20 2020 2020 2020     pass..       
-00076490: 206c 6566 7420 3d20 696e 7428 7365 6c66   left = int(self
-000764a0: 2e62 6f78 2e70 6f73 2829 2e78 2829 290d  .box.pos().x()).
-000764b0: 0a20 2020 2020 2020 2072 6967 6874 203d  .        right =
-000764c0: 206c 6566 7420 2b20 696e 7428 7365 6c66   left + int(self
-000764d0: 2e62 6f78 2e73 697a 6528 292e 7828 2929  .box.size().x())
-000764e0: 0d0a 2020 2020 2020 2020 626f 7474 6f6d  ..        bottom
-000764f0: 203d 2069 6e74 2873 656c 662e 626f 782e   = int(self.box.
-00076500: 706f 7328 292e 7928 2929 0d0a 2020 2020  pos().y())..    
-00076510: 2020 2020 746f 7020 3d20 626f 7474 6f6d      top = bottom
-00076520: 202b 2069 6e74 2873 656c 662e 626f 782e   + int(self.box.
-00076530: 7369 7a65 2829 2e79 2829 290d 0a20 2020  size().y())..   
-00076540: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
-00076550: 6162 7364 6174 615f 6372 6f70 7065 6420  absdata_cropped 
-00076560: 3d20 7365 6c66 2e73 7461 636b 2e61 6273  = self.stack.abs
-00076570: 6461 7461 3464 5b6c 6566 743a 7269 6768  data4d[left:righ
-00076580: 742c 2062 6f74 746f 6d3a 746f 702c 203a  t, bottom:top, :
-00076590: 2c3a 5d2e 636f 7079 2829 0d0a 0d0a 2020  ,:].copy()....  
-000765a0: 2020 6465 6620 4f6e 4c69 6e52 6567 696f    def OnLinRegio
-000765b0: 6e28 7365 6c66 2c20 7265 6769 6f6e 2c20  n(self, region, 
-000765c0: 7570 6461 7465 3d54 7275 6529 3a0d 0a20  update=True):.. 
-000765d0: 2020 2020 2020 2023 7072 696e 7428 224f         #print("O
-000765e0: 6e4c 696e 5265 6769 6f6e 222c 2073 7472  nLinRegion", str
-000765f0: 2875 7064 6174 6529 290d 0a20 2020 2020  (update))..     
-00076600: 2020 2073 656c 6563 7472 6567 696f 6e3d     selectregion=
-00076610: 207b 7365 6c66 2e78 7265 6769 6f6e 203a   {self.xregion :
-00076620: 2022 6d61 6e75 616c 6d61 736b 6564 7822   "manualmaskedx"
-00076630: 2c20 7365 6c66 2e79 7265 6769 6f6e 203a  , self.yregion :
-00076640: 2022 6d61 6e75 616c 6d61 736b 6564 7922   "manualmaskedy"
-00076650: 7d0d 0a20 2020 2020 2020 2073 656c 6563  }..        selec
-00076660: 7473 6361 7474 6572 203d 207b 7365 6c66  tscatter = {self
-00076670: 2e78 7265 6769 6f6e 203a 2073 656c 662e  .xregion : self.
-00076680: 7873 6361 7474 6572 2c20 7365 6c66 2e79  xscatter, self.y
-00076690: 7265 6769 6f6e 203a 2073 656c 662e 7973  region : self.ys
-000766a0: 6361 7474 6572 7d0d 0a20 2020 2020 2020  catter}..       
-000766b0: 2073 656c 6563 7472 6567 696f 6e6c 696d   selectregionlim
-000766c0: 6974 3d20 7b73 656c 662e 7872 6567 696f  it= {self.xregio
-000766d0: 6e20 3a20 2272 6567 696f 6e6c 696d 6974  n : "regionlimit
-000766e0: 7822 2c20 7365 6c66 2e79 7265 6769 6f6e  x", self.yregion
-000766f0: 203a 2022 7265 6769 6f6e 6c69 6d69 7479   : "regionlimity
-00076700: 227d 0d0a 2020 2020 2020 2020 7365 6c65  "}..        sele
-00076710: 6374 706c 6f74 203d 207b 7365 6c66 2e78  ctplot = {self.x
-00076720: 7265 6769 6f6e 203a 2073 656c 662e 7078  region : self.px
-00076730: 2c20 7365 6c66 2e79 7265 6769 6f6e 203a  , self.yregion :
-00076740: 2073 656c 662e 7079 7d0d 0a20 2020 2020   self.py}..     
-00076750: 2020 2023 7072 696e 7428 226f 6e6c 696e     #print("onlin
-00076760: 7265 6769 6f6e 2022 2b20 7365 6c65 6374  region "+ select
-00076770: 7265 6769 6f6e 5b72 6567 696f 6e5d 290d  region[region]).
-00076780: 0a20 2020 2020 2020 2073 6361 7474 6572  .        scatter
-00076790: 203d 2073 656c 6563 7473 6361 7474 6572   = selectscatter
-000767a0: 5b72 6567 696f 6e5d 0d0a 2020 2020 2020  [region]..      
-000767b0: 2020 6d69 6e5f 6964 782c 206d 6178 5f69    min_idx, max_i
-000767c0: 6478 2c20 6d69 6e5f 6576 2c20 6d61 785f  dx, min_ev, max_
-000767d0: 6576 203d 2073 656c 662e 6765 7444 6174  ev = self.getDat
-000767e0: 6143 6c6f 7365 7374 546f 5265 6769 6f6e  aClosestToRegion
-000767f0: 2872 6567 696f 6e2c 7363 6174 7465 722c  (region,scatter,
-00076800: 7570 6461 7465 290d 0a20 2020 2020 2020  update)..       
-00076810: 2073 656c 6563 7469 6f6e 203d 205b 2a72   selection = [*r
-00076820: 616e 6765 286d 696e 5f69 6478 2c20 6d61  ange(min_idx, ma
-00076830: 785f 6964 782b 3129 5d0d 0a20 2020 2020  x_idx+1)]..     
-00076840: 2020 2066 6f72 2069 6478 2c76 616c 2069     for idx,val i
-00076850: 6e20 656e 756d 6572 6174 6528 7365 6c66  n enumerate(self
-00076860: 2e73 7461 636b 2e73 6869 6674 7364 6963  .stack.shiftsdic
-00076870: 745b 7365 6c66 2e69 7468 6574 615d 5b22  t[self.itheta]["
-00076880: 6d61 6e75 616c 6d61 736b 6564 7822 5d29  manualmaskedx"])
-00076890: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-000768a0: 6620 6964 7820 6e6f 7420 696e 2073 656c  f idx not in sel
-000768b0: 6563 7469 6f6e 3a0d 0a20 2020 2020 2020  ection:..       
-000768c0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-000768d0: 6163 6b2e 7368 6966 7473 6469 6374 5b73  ack.shiftsdict[s
-000768e0: 656c 662e 6974 6865 7461 5d5b 7365 6c65  elf.itheta][sele
-000768f0: 6374 7265 6769 6f6e 5b72 6567 696f 6e5d  ctregion[region]
-00076900: 5d5b 6964 785d 203d 2054 7275 650d 0a20  ][idx] = True.. 
-00076910: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00076920: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00076930: 2020 7365 6c66 2e73 7461 636b 2e73 6869    self.stack.shi
-00076940: 6674 7364 6963 745b 7365 6c66 2e69 7468  ftsdict[self.ith
-00076950: 6574 615d 5b73 656c 6563 7472 6567 696f  eta][selectregio
-00076960: 6e5b 7265 6769 6f6e 5d5d 5b69 6478 5d20  n[region]][idx] 
-00076970: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-00076980: 2079 5f76 616c 733d 2073 656c 6563 7473   y_vals= selects
-00076990: 6361 7474 6572 5b72 6567 696f 6e5d 2e64  catter[region].d
-000769a0: 6174 615b 2279 225d 5b6d 696e 5f69 6478  ata["y"][min_idx
-000769b0: 3a6d 6178 5f69 6478 202b 2031 5d0d 0a20  :max_idx + 1].. 
-000769c0: 2020 2020 2020 2073 656c 6563 7470 6c6f         selectplo
-000769d0: 745b 7265 6769 6f6e 5d2e 7365 7452 616e  t[region].setRan
-000769e0: 6765 2879 5261 6e67 653d 5b6e 702e 6d69  ge(yRange=[np.mi
-000769f0: 6e28 795f 7661 6c73 292c 206e 702e 6d61  n(y_vals), np.ma
-00076a00: 7828 795f 7661 6c73 295d 2c20 6469 7361  x(y_vals)], disa
-00076a10: 626c 6541 7574 6f52 616e 6765 3d54 7275  bleAutoRange=Tru
-00076a20: 652c 2070 6164 6469 6e67 3d30 2e31 290d  e, padding=0.1).
-00076a30: 0a20 2020 2020 2020 2073 656c 662e 436f  .        self.Co
-00076a40: 6c6f 7269 7a65 5363 6174 7465 7244 6f74  lorizeScatterDot
-00076a50: 7328 290d 0a20 2020 2020 2020 2023 6669  s()..        #fi
-00076a60: 6c74 6572 203d 205b 5472 7565 2069 6620  lter = [True if 
-00076a70: 6964 7820 696e 2073 656c 6563 7469 6f6e  idx in selection
-00076a80: 2065 6c73 6520 4661 6c73 6520 666f 7220   else False for 
-00076a90: 6964 782c 626f 6f6c 2069 6e20 656e 756d  idx,bool in enum
-00076aa0: 6572 6174 6528 7365 6c66 2e73 7461 636b  erate(self.stack
-00076ab0: 2e73 6869 6674 7364 6963 745b 7365 6c66  .shiftsdict[self
-00076ac0: 2e69 7468 6574 615d 5b22 6d61 6e75 616c  .itheta]["manual
-00076ad0: 6d61 736b 6564 7822 5d29 5d0d 0a20 2020  maskedx"])]..   
-00076ae0: 2020 2020 2023 7072 696e 7428 7365 6c65       #print(sele
-00076af0: 6374 696f 6e2c 6669 6c74 6572 290d 0a20  ction,filter).. 
-00076b00: 2020 2020 2020 2023 7365 6c66 2e55 7064         #self.Upd
-00076b10: 6174 6553 6361 7474 6572 506c 6f74 7328  ateScatterPlots(
-00076b20: 7265 6769 6f6e 2c20 6964 290d 0a20 2020  region, id)..   
-00076b30: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00076b40: 2e61 6c69 676e 6564 3a0d 0a20 2020 2020  .aligned:..     
-00076b50: 2020 2020 2020 2066 6f72 2074 6865 7461         for theta
-00076b60: 2069 6e20 7261 6e67 6528 7365 6c66 2e73   in range(self.s
-00076b70: 7461 636b 2e6e 5f74 6865 7461 293a 0d0a  tack.n_theta):..
-00076b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00076b90: 7365 6c66 2e73 7461 636b 2e73 6869 6674  self.stack.shift
-00076ba0: 7364 6963 745b 7468 6574 615d 5b73 656c  sdict[theta][sel
-00076bb0: 6563 7472 6567 696f 6e6c 696d 6974 5b72  ectregionlimit[r
-00076bc0: 6567 696f 6e5d 5d20 3d20 286d 696e 5f65  egion]] = (min_e
-00076bd0: 762c 206d 6178 5f65 7629 0d0a 2020 2020  v, max_ev)..    
-00076be0: 2020 2020 6966 2073 656c 662e 616c 6967      if self.alig
-00076bf0: 6e65 6420 616e 6420 7570 6461 7465 3a0d  ned and update:.
-00076c00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00076c10: 662e 7374 6163 6b2e 7368 6966 7473 6469  f.stack.shiftsdi
-00076c20: 6374 5b73 656c 662e 6974 6865 7461 5d5b  ct[self.itheta][
-00076c30: 7365 6c65 6374 7265 6769 6f6e 6c69 6d69  selectregionlimi
-00076c40: 745b 7265 6769 6f6e 5d5d 203d 2028 6d69  t[region]] = (mi
-00076c50: 6e5f 6576 2c20 6d61 785f 6576 290d 0a20  n_ev, max_ev).. 
-00076c60: 2020 2020 2020 2020 2020 2023 7072 696e             #prin
-00076c70: 7428 2243 6f6d 706f 7365 5368 6966 7451  t("ComposeShiftQ
-00076c80: 7565 7565 222b 7365 6c65 6374 7265 6769  ueue"+selectregi
-00076c90: 6f6e 5b72 6567 696f 6e5d 290d 0a20 2020  on[region])..   
-00076ca0: 2020 2020 2020 2020 2073 656c 662e 436f           self.Co
-00076cb0: 6d70 6f73 6553 6869 6674 5175 6575 6528  mposeShiftQueue(
-00076cc0: 290d 0a0d 0a20 2020 2064 6566 204f 6e4d  )....    def OnM
-00076cd0: 6f75 7365 4d6f 7665 4f75 7473 6964 6528  ouseMoveOutside(
-00076ce0: 7365 6c66 2c20 6576 293a 0d0a 2020 2020  self, ev):..    
-00076cf0: 2020 2020 6d6f 7573 6570 6f73 203d 2073      mousepos = s
-00076d00: 656c 662e 7662 2e6d 6170 5363 656e 6554  elf.vb.mapSceneT
-00076d10: 6f56 6965 7728 6576 5b30 5d29 0d0a 2020  oView(ev[0])..  
-00076d20: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00076d30: 662e 7662 2e69 7465 6d42 6f75 6e64 696e  f.vb.itemBoundin
-00076d40: 6752 6563 7428 7365 6c66 2e69 5f69 7465  gRect(self.i_ite
-00076d50: 6d29 2e63 6f6e 7461 696e 7328 6d6f 7573  m).contains(mous
-00076d60: 6570 6f73 293a 0d0a 2020 2020 2020 2020  epos):..        
-00076d70: 2020 2020 6d61 7872 6563 7420 3d20 7365      maxrect = se
-00076d80: 6c66 2e69 5f69 7465 6d2e 626f 756e 6469  lf.i_item.boundi
-00076d90: 6e67 5265 6374 2829 2e62 6f74 746f 6d52  ngRect().bottomR
-00076da0: 6967 6874 2829 0d0a 2020 2020 2020 2020  ight()..        
-00076db0: 2020 2020 2320 6966 2062 6f75 6e64 7320      # if bounds 
-00076dc0: 6578 6365 6564 6564 0d0a 2020 2020 2020  exceeded..      
-00076dd0: 2020 2020 2020 6f75 745f 7820 3d20 6d61        out_x = ma
-00076de0: 7828 286d 6f75 7365 706f 732d 6d61 7872  x((mousepos-maxr
-00076df0: 6563 7429 2e78 2829 2c30 290d 0a20 2020  ect).x(),0)..   
-00076e00: 2020 2020 2020 2020 206f 7574 5f79 203d           out_y =
-00076e10: 206d 6178 2828 6d6f 7573 6570 6f73 2d6d   max((mousepos-m
-00076e20: 6178 7265 6374 292e 7928 292c 2030 290d  axrect).y(), 0).
-00076e30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00076e40: 7365 6c66 2e62 6f78 2e73 697a 6528 2920  self.box.size() 
-00076e50: 213d 2073 656c 662e 626f 7873 697a 653a  != self.boxsize:
-00076e60: 2023 2070 7265 7665 6e74 7320 7461 6b69   # prevents taki
-00076e70: 6e67 2061 6374 696f 6e20 7768 656e 2074  ng action when t
-00076e80: 6865 2062 6f78 2069 7320 6a75 7374 2064  he box is just d
-00076e90: 7261 6767 6564 2061 6e64 206e 6f74 2072  ragged and not r
-00076ea0: 6573 697a 6564 0d0a 2020 2020 2020 2020  esized..        
-00076eb0: 2020 2020 2020 2020 6966 206f 7574 5f78          if out_x
-00076ec0: 2061 6e64 206f 7574 5f79 3a0d 0a20 2020   and out_y:..   
-00076ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00076ee0: 2073 656c 662e 626f 782e 7365 7453 697a   self.box.setSiz
-00076ef0: 6528 7365 6c66 2e69 5f69 7465 6d2e 626f  e(self.i_item.bo
-00076f00: 756e 6469 6e67 5265 6374 2829 2e62 6f74  undingRect().bot
-00076f10: 746f 6d52 6967 6874 2829 2d73 656c 662e  tomRight()-self.
-00076f20: 626f 782e 706f 7328 292c 2075 7064 6174  box.pos(), updat
-00076f30: 653d 5472 7565 2c20 736e 6170 3d54 7275  e=True, snap=Tru
-00076f40: 652c 2066 696e 6973 683d 4661 6c73 6529  e, finish=False)
-00076f50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00076f60: 2020 656c 6966 206f 7574 5f78 3a0d 0a20    elif out_x:.. 
-00076f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00076f80: 2020 2073 656c 662e 626f 782e 7365 7453     self.box.setS
-00076f90: 697a 6528 5b73 656c 662e 695f 6974 656d  ize([self.i_item
-00076fa0: 2e62 6f75 6e64 696e 6752 6563 7428 292e  .boundingRect().
-00076fb0: 7269 6768 7428 292d 7365 6c66 2e62 6f78  right()-self.box
-00076fc0: 2e70 6f73 2829 2e78 2829 2c6d 6f75 7365  .pos().x(),mouse
-00076fd0: 706f 732e 7928 292d 7365 6c66 2e62 6f78  pos.y()-self.box
-00076fe0: 2e70 6f73 2829 2e79 2829 5d2c 2075 7064  .pos().y()], upd
-00076ff0: 6174 653d 5472 7565 2c20 736e 6170 3d54  ate=True, snap=T
-00077000: 7275 652c 2066 696e 6973 683d 4661 6c73  rue, finish=Fals
-00077010: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00077020: 2020 2020 656c 6966 206f 7574 5f79 3a0d      elif out_y:.
-00077030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00077040: 2020 2020 2073 656c 662e 626f 782e 7365       self.box.se
-00077050: 7453 697a 6528 5b6d 6f75 7365 706f 732e  tSize([mousepos.
-00077060: 7828 292d 7365 6c66 2e62 6f78 2e70 6f73  x()-self.box.pos
-00077070: 2829 2e78 2829 2c73 656c 662e 695f 6974  ().x(),self.i_it
-00077080: 656d 2e62 6f75 6e64 696e 6752 6563 7428  em.boundingRect(
-00077090: 292e 626f 7474 6f6d 2829 2d73 656c 662e  ).bottom()-self.
-000770a0: 626f 782e 706f 7328 292e 7928 295d 2c20  box.pos().y()], 
-000770b0: 7570 6461 7465 3d54 7275 652c 2073 6e61  update=True, sna
-000770c0: 703d 5472 7565 2c20 6669 6e69 7368 3d46  p=True, finish=F
-000770d0: 616c 7365 290d 0a23 202d 2d2d 2d2d 2d2d  alse)..# -------
-000770e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000770f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00077100: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00077110: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
-00077120: 0a20 2020 2064 6566 204f 6e43 616e 6365  .    def OnCance
-00077130: 6c28 7365 6c66 2c20 6576 7429 3a0d 0a20  l(self, evt):.. 
-00077140: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
-00077150: 6b2e 6162 7364 6174 615f 7368 6966 7465  k.absdata_shifte
-00077160: 645f 6372 6f70 7065 6420 3d20 7365 6c66  d_cropped = self
-00077170: 2e73 7461 636b 2e61 6273 6461 7461 0d0a  .stack.absdata..
-00077180: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
-00077190: 656e 742e 7061 6765 312e 6c6f 6164 496d  ent.page1.loadIm
-000771a0: 6167 6528 290d 0a0d 0a20 2020 2020 2020  age()....       
-000771b0: 2069 6620 7368 6f77 6d61 7074 6162 3a0d   if showmaptab:.
-000771c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000771d0: 662e 7061 7265 6e74 2e70 6167 6539 2e43  f.parent.page9.C
-000771e0: 6c65 6172 2829 0d0a 2020 2020 2020 2020  lear()..        
-000771f0: 2020 2020 7365 6c66 2e70 6172 656e 742e      self.parent.
-00077200: 7061 6765 392e 4c6f 6164 456e 7472 6965  page9.LoadEntrie
-00077210: 7328 290d 0a0d 0a20 2020 2020 2020 2073  s()....        s
-00077220: 656c 662e 636c 6f73 6528 290d 0a20 2020  elf.close()..   
-00077230: 2023 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   # -------------
-00077240: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00077250: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00077260: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00077270: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
-00077280: 6566 204f 6e41 6363 6570 7428 7365 6c66  ef OnAccept(self
-00077290: 2c20 6576 7429 3a0d 0a20 2020 2020 2020  , evt):..       
-000772a0: 2069 6620 7365 6c66 2e63 6f6d 2e73 7461   if self.com.sta
-000772b0: 636b 5f34 6420 3d3d 2030 3a0d 0a20 2020  ck_4d == 0:..   
-000772c0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-000772d0: 6163 6b2e 6162 7364 6174 6120 3d20 7365  ack.absdata = se
-000772e0: 6c66 2e73 7461 636b 2e61 6273 6461 7461  lf.stack.absdata
-000772f0: 3464 5f73 6869 6674 6564 5f63 726f 7070  4d_shifted_cropp
-00077300: 6564 5b3a 2c3a 2c3a 2c30 5d0d 0a20 2020  ed[:,:,:,0]..   
-00077310: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-00077320: 6163 6b2e 6461 7461 5f73 7472 7563 742e  ack.data_struct.
-00077330: 6578 6368 616e 6765 2e64 6174 6120 3d20  exchange.data = 
-00077340: 7365 6c66 2e73 7461 636b 2e61 6273 6461  self.stack.absda
-00077350: 7461 0d0a 2020 2020 2020 2020 656c 7365  ta..        else
-00077360: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00077370: 656c 662e 7374 6163 6b2e 7374 6163 6b34  elf.stack.stack4
-00077380: 4420 3d20 7365 6c66 2e73 7461 636b 2e61  D = self.stack.a
-00077390: 6273 6461 7461 3464 5f73 6869 6674 6564  bsdata4d_shifted
-000773a0: 5f63 726f 7070 6564 0d0a 2020 2020 2020  _cropped..      
-000773b0: 2020 2020 2020 7365 6c66 2e73 7461 636b        self.stack
-000773c0: 2e61 6273 6461 7461 203d 2073 656c 662e  .absdata = self.
-000773d0: 7374 6163 6b2e 7374 6163 6b34 445b 3a2c  stack.stack4D[:,
-000773e0: 203a 2c20 3a2c 2073 656c 662e 6974 6865   :, :, self.ithe
-000773f0: 7461 5d0d 0a20 2020 2020 2020 2020 2020  ta]..           
-00077400: 2073 656c 662e 7374 6163 6b2e 6461 7461   self.stack.data
-00077410: 5f73 7472 7563 742e 6578 6368 616e 6765  _struct.exchange
-00077420: 2e64 6174 6120 3d20 7365 6c66 2e73 7461  .data = self.sta
-00077430: 636b 2e73 7461 636b 3444 0d0a 2020 2020  ck.stack4D..    
-00077440: 2020 2020 2020 2020 2351 7457 6964 6765          #QtWidge
-00077450: 7473 2e51 4d65 7373 6167 6542 6f78 2e77  ts.QMessageBox.w
-00077460: 6172 6e69 6e67 2873 656c 662c 2027 4572  arning(self, 'Er
-00077470: 726f 7227 2c20 2734 4420 7374 6163 6b20  ror', '4D stack 
-00077480: 6e6f 7420 7965 7420 7375 7070 6f72 7465  not yet supporte
-00077490: 642e 2729 0d0a 0d0a 2020 2020 2020 2020  d.')....        
-000774a0: 6461 7461 6469 6d20 3d20 6e70 2e69 6e74  datadim = np.int
-000774b0: 3332 2873 656c 662e 7374 6163 6b2e 6162  32(self.stack.ab
-000774c0: 7364 6174 612e 7368 6170 6529 0d0a 0d0a  sdata.shape)....
-000774d0: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
-000774e0: 636b 2e6e 5f63 6f6c 7320 3d20 6461 7461  ck.n_cols = data
-000774f0: 6469 6d5b 305d 2e63 6f70 7928 290d 0a20  dim[0].copy().. 
-00077500: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
-00077510: 6b2e 6e5f 726f 7773 203d 2020 6461 7461  k.n_rows =  data
-00077520: 6469 6d5b 315d 2e63 6f70 7928 290d 0a20  dim[1].copy().. 
-00077530: 2020 2020 2020 2023 546f 446f 3a20 4861         #ToDo: Ha
-00077540: 6e64 7368 616b 6520 6461 7461 0d0a 2020  ndshake data..  
-00077550: 2020 2020 2020 2373 656c 662e 7374 6163        #self.stac
-00077560: 6b2e 7873 6869 6674 7320 3d20 7365 6c66  k.xshifts = self
-00077570: 2e78 5f73 6869 6674 7374 656d 700d 0a20  .x_shiftstemp.. 
-00077580: 2020 2020 2020 2023 7365 6c66 2e73 7461         #self.sta
-00077590: 636b 2e79 7368 6966 7473 203d 2073 656c  ck.yshifts = sel
-000775a0: 662e 795f 7368 6966 7473 7465 6d70 0d0a  f.y_shiftstemp..
-000775b0: 0d0a 2020 2020 2020 2020 2354 6f44 6f3a  ..        #ToDo:
-000775c0: 2048 6f77 2074 6f20 6861 6e64 6c65 2061   How to handle a
-000775d0: 6c69 676e 6564 2069 3020 6461 7461 3f0d  ligned i0 data?.
-000775e0: 0a0d 0a20 2020 2020 2020 2023 2069 6620  ...        # if 
-000775f0: 7365 6c66 2e63 6f6d 2e69 305f 6c6f 6164  self.com.i0_load
-00077600: 6564 203d 3d20 313a 0d0a 2020 2020 2020  ed == 1:..      
-00077610: 2020 2320 2020 2020 6966 2073 656c 662e    #     if self.
-00077620: 636f 6d2e 7374 6163 6b5f 3464 203d 3d20  com.stack_4d == 
-00077630: 303a 0d0a 2020 2020 2020 2020 2320 2020  0:..        #   
-00077640: 2020 2020 2020 2352 6573 697a 6520 6f70        #Resize op
-00077650: 7469 6361 6c20 6465 6e73 6974 790d 0a20  tical density.. 
-00077660: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-00077670: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00077680: 7365 6c66 2e73 7461 636b 2e6e 5f65 7629  self.stack.n_ev)
-00077690: 3a0d 0a20 2020 2020 2020 2023 0d0a 2020  :..        #..  
-000776a0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-000776b0: 2020 2020 696d 6720 3d20 7365 6c66 2e73      img = self.s
-000776c0: 7461 636b 2e6f 6433 645b 3a2c 3a2c 695d  tack.od3d[:,:,i]
-000776d0: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
-000776e0: 2020 2020 2020 2020 7368 6966 7465 645f          shifted_
-000776f0: 696d 6720 3d20 7365 6c66 2e73 7461 636b  img = self.stack
-00077700: 2e61 7070 6c79 5f69 6d61 6765 5f72 6567  .apply_image_reg
-00077710: 6973 7472 6174 696f 6e28 696d 672c 2073  istration(img, s
-00077720: 656c 662e 7873 6869 6674 735b 695d 2c20  elf.xshifts[i], 
-00077730: 7365 6c66 2e79 7368 6966 7473 5b69 5d29  self.yshifts[i])
-00077740: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
-00077750: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
-00077760: 636b 2e6f 6433 645b 3a2c 3a2c 695d 203d  ck.od3d[:,:,i] =
-00077770: 2073 6869 6674 6564 5f69 6d67 0d0a 2020   shifted_img..  
-00077780: 2020 2020 2020 230d 0a20 2020 2020 2020        #..       
-00077790: 2023 0d0a 2020 2020 2020 2020 2320 2020   #..        #   
-000777a0: 2020 2020 2020 7365 6c66 2e73 7461 636b        self.stack
-000777b0: 2e6f 6433 6420 3d20 7365 6c66 2e73 7461  .od3d = self.sta
-000777c0: 636b 2e6f 6433 645b 7365 6c66 2e78 6c65  ck.od3d[self.xle
-000777d0: 6674 3a73 656c 662e 7872 6967 6874 2c20  ft:self.xright, 
-000777e0: 7365 6c66 2e79 626f 7474 6f6d 3a73 656c  self.ybottom:sel
-000777f0: 662e 7974 6f70 2c20 3a5d 0d0a 2020 2020  f.ytop, :]..    
-00077800: 2020 2020 230d 0a20 2020 2020 2020 2023      #..        #
-00077810: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-00077820: 6163 6b2e 6f64 203d 2073 656c 662e 7374  ack.od = self.st
-00077830: 6163 6b2e 6f64 3364 2e63 6f70 7928 290d  ack.od3d.copy().
-00077840: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
-00077850: 2020 2073 656c 662e 7374 6163 6b2e 6f64     self.stack.od
-00077860: 203d 206e 702e 7265 7368 6170 6528 7365   = np.reshape(se
-00077870: 6c66 2e73 7461 636b 2e6f 642c 2028 7365  lf.stack.od, (se
-00077880: 6c66 2e73 7461 636b 2e6e 5f63 6f6c 732a  lf.stack.n_cols*
-00077890: 7365 6c66 2e73 7461 636b 2e6e 5f72 6f77  self.stack.n_row
-000778a0: 732c 2073 656c 662e 7374 6163 6b2e 6e5f  s, self.stack.n_
-000778b0: 6576 292c 206f 7264 6572 3d27 4627 290d  ev), order='F').
-000778c0: 0a20 2020 2020 2020 2023 0d0a 2020 2020  .        #..    
-000778d0: 2020 2020 2320 2020 2020 656c 7365 3a0d      #     else:.
-000778e0: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
-000778f0: 2020 2023 5265 7369 7a65 206f 7074 6963     #Resize optic
-00077900: 616c 2064 656e 7369 7479 2066 6f72 2034  al density for 4
-00077910: 4420 7374 6163 6b0d 0a20 2020 2020 2020  D stack..       
-00077920: 2023 0d0a 2020 2020 2020 2020 2320 2020   #..        #   
-00077930: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-00077940: 616e 6765 2873 656c 662e 7374 6163 6b2e  ange(self.stack.
-00077950: 6e5f 6576 293a 0d0a 2020 2020 2020 2020  n_ev):..        
-00077960: 2320 2020 2020 2020 2020 2020 2020 666f  #             fo
-00077970: 7220 6a20 696e 2072 616e 6765 2873 656c  r j in range(sel
-00077980: 662e 7374 6163 6b2e 6e5f 7468 6574 6129  f.stack.n_theta)
-00077990: 3a0d 0a20 2020 2020 2020 2023 2020 2020  :..        #    
-000779a0: 2020 2020 2020 2020 2020 2020 2069 6d67               img
-000779b0: 203d 2073 656c 662e 7374 6163 6b2e 6f64   = self.stack.od
-000779c0: 3444 5b3a 2c3a 2c69 2c6a 5d0d 0a20 2020  4D[:,:,i,j]..   
-000779d0: 2020 2020 2023 2020 2020 2020 2020 2020       #          
-000779e0: 2020 2020 2020 2073 6869 6674 6564 5f69         shifted_i
-000779f0: 6d67 203d 2073 656c 662e 7374 6163 6b2e  mg = self.stack.
-00077a00: 6170 706c 795f 696d 6167 655f 7265 6769  apply_image_regi
-00077a10: 7374 7261 7469 6f6e 2869 6d67 2c20 7365  stration(img, se
-00077a20: 6c66 2e78 7368 6966 7473 5b69 2c6a 5d2c  lf.xshifts[i,j],
-00077a30: 2073 656c 662e 7973 6869 6674 735b 692c   self.yshifts[i,
-00077a40: 6a5d 290d 0a20 2020 2020 2020 2023 2020  j])..        #  
-00077a50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00077a60: 656c 662e 7374 6163 6b2e 6f64 3444 5b3a  elf.stack.od4D[:
-00077a70: 2c3a 2c69 2c6a 5d20 3d20 7368 6966 7465  ,:,i,j] = shifte
-00077a80: 645f 696d 670d 0a20 2020 2020 2020 2023  d_img..        #
-00077a90: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
-00077aa0: 2020 2020 7365 6c66 2e73 7461 636b 2e6f      self.stack.o
-00077ab0: 6434 4420 3d20 7365 6c66 2e73 7461 636b  d4D = self.stack
-00077ac0: 2e6f 6434 445b 7365 6c66 2e78 6c65 6674  .od4D[self.xleft
-00077ad0: 3a73 656c 662e 7872 6967 6874 2c20 7365  :self.xright, se
-00077ae0: 6c66 2e79 626f 7474 6f6d 3a73 656c 662e  lf.ybottom:self.
-00077af0: 7974 6f70 2c20 3a2c 203a 5d0d 0a20 2020  ytop, :, :]..   
-00077b00: 2020 2020 2023 0d0a 2020 2020 2020 2020       #..        
-00077b10: 2320 2020 2020 2020 2020 7365 6c66 2e73  #         self.s
-00077b20: 7461 636b 2e6f 6433 6420 3d20 7365 6c66  tack.od3d = self
-00077b30: 2e73 7461 636b 2e6f 6434 445b 3a2c 3a2c  .stack.od4D[:,:,
-00077b40: 3a2c 7365 6c66 2e69 7468 6574 615d 0d0a  :,self.itheta]..
-00077b50: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-00077b60: 2020 7365 6c66 2e73 7461 636b 2e6f 6420    self.stack.od 
-00077b70: 3d20 7365 6c66 2e73 7461 636b 2e6f 6433  = self.stack.od3
-00077b80: 642e 636f 7079 2829 0d0a 2020 2020 2020  d.copy()..      
-00077b90: 2020 2320 2020 2020 2020 2020 6e5f 7069    #         n_pi
-00077ba0: 7865 6c73 203d 2073 656c 662e 7374 6163  xels = self.stac
-00077bb0: 6b2e 6e5f 636f 6c73 2a73 656c 662e 7374  k.n_cols*self.st
-00077bc0: 6163 6b2e 6e5f 726f 7773 0d0a 2020 2020  ack.n_rows..    
-00077bd0: 2020 2020 2320 2020 2020 2020 2020 7365      #         se
-00077be0: 6c66 2e73 7461 636b 2e6f 6420 3d20 6e70  lf.stack.od = np
-00077bf0: 2e72 6573 6861 7065 2873 656c 662e 7374  .reshape(self.st
-00077c00: 6163 6b2e 6f64 2c20 286e 5f70 6978 656c  ack.od, (n_pixel
-00077c10: 732c 2073 656c 662e 7374 6163 6b2e 6e5f  s, self.stack.n_
-00077c20: 6576 292c 206f 7264 6572 3d27 4627 290d  ev), order='F').
-00077c30: 0a20 2020 2020 2020 2023 0d0a 2020 2020  .        #..    
-00077c40: 2020 2020 2320 2020 2020 7365 6c66 2e73      #     self.s
-00077c50: 7461 636b 2e64 6174 615f 7374 7275 6374  tack.data_struct
-00077c60: 2e73 7065 6374 726f 6d69 6372 6f73 636f  .spectromicrosco
-00077c70: 7079 2e6f 7074 6963 616c 5f64 656e 7369  py.optical_densi
-00077c80: 7479 203d 2073 656c 662e 7374 6163 6b2e  ty = self.stack.
-00077c90: 6f64 0d0a 0d0a 2020 2020 2020 2020 7365  od....        se
-00077ca0: 6c66 2e73 7461 636b 2e64 6174 615f 7374  lf.stack.data_st
-00077cb0: 7275 6374 2e65 7863 6861 6e67 652e 656e  ruct.exchange.en
-00077cc0: 6572 6779 203d 2073 656c 662e 7374 6163  ergy = self.stac
-00077cd0: 6b2e 6576 0d0a 2020 2020 2020 2020 2354  k.ev..        #T
-00077ce0: 6f44 6f3a 2048 616e 6473 6861 6b65 2073  oDo: Handshake s
-00077cf0: 6869 6674 2064 6174 610d 0a20 2020 2020  hift data..     
-00077d00: 2020 2023 7365 6c66 2e73 7461 636b 2e64     #self.stack.d
-00077d10: 6174 615f 7374 7275 6374 2e73 7065 6374  ata_struct.spect
-00077d20: 726f 6d69 6372 6f73 636f 7079 2e78 7368  romicroscopy.xsh
-00077d30: 6966 7473 203d 2073 656c 662e 785f 7368  ifts = self.x_sh
-00077d40: 6966 7473 7465 6d70 0d0a 2020 2020 2020  iftstemp..      
-00077d50: 2020 2373 656c 662e 7374 6163 6b2e 6461    #self.stack.da
-00077d60: 7461 5f73 7472 7563 742e 7370 6563 7472  ta_struct.spectr
-00077d70: 6f6d 6963 726f 7363 6f70 792e 7973 6869  omicroscopy.yshi
-00077d80: 6674 7320 3d20 7365 6c66 2e79 5f73 6869  fts = self.y_shi
-00077d90: 6674 7374 656d 700d 0a0d 0a20 2020 2020  ftstemp....     
-00077da0: 2020 2073 656c 662e 7061 7265 6e74 2e70     self.parent.p
-00077db0: 6167 6531 2e73 6c69 6465 725f 656e 672e  age1.slider_eng.
-00077dc0: 7365 7452 616e 6765 2830 2c73 656c 662e  setRange(0,self.
-00077dd0: 7374 6163 6b2e 6e5f 6576 2d31 290d 0a20  stack.n_ev-1).. 
-00077de0: 2020 2020 2020 2073 656c 662e 7061 7265         self.pare
-00077df0: 6e74 2e70 6167 6531 2e69 6576 203d 2069  nt.page1.iev = i
-00077e00: 6e74 2873 656c 662e 7374 6163 6b2e 6e5f  nt(self.stack.n_
-00077e10: 6576 2f32 290d 0a20 2020 2020 2020 2073  ev/2)..        s
-00077e20: 656c 662e 7061 7265 6e74 2e70 6167 6531  elf.parent.page1
-00077e30: 2e73 6c69 6465 725f 656e 672e 7365 7456  .slider_eng.setV
-00077e40: 616c 7565 2873 656c 662e 7061 7265 6e74  alue(self.parent
-00077e50: 2e70 6167 6531 2e69 6576 290d 0a0d 0a20  .page1.iev).... 
-00077e60: 2020 2020 2020 2073 656c 662e 7061 7265         self.pare
-00077e70: 6e74 2e70 6167 6531 2e69 7820 3d20 696e  nt.page1.ix = in
-00077e80: 7428 7365 6c66 2e73 7461 636b 2e6e 5f63  t(self.stack.n_c
-00077e90: 6f6c 732f 3229 0d0a 2020 2020 2020 2020  ols/2)..        
-00077ea0: 7365 6c66 2e70 6172 656e 742e 7061 6765  self.parent.page
-00077eb0: 312e 6979 203d 2069 6e74 2873 656c 662e  1.iy = int(self.
-00077ec0: 7374 6163 6b2e 6e5f 726f 7773 2f32 290d  stack.n_rows/2).
-00077ed0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00077ee0: 7061 7265 6e74 2e70 6167 6531 2e73 686f  parent.page1.sho
-00077ef0: 7753 7065 6374 7275 6d28 7365 6c66 2e70  wSpectrum(self.p
-00077f00: 6172 656e 742e 7061 6765 312e 6978 2c20  arent.page1.ix, 
-00077f10: 7365 6c66 2e70 6172 656e 742e 7061 6765  self.parent.page
-00077f20: 312e 6979 290d 0a20 2020 2020 2020 2073  1.iy)..        s
-00077f30: 656c 662e 7061 7265 6e74 2e70 6167 6531  elf.parent.page1
-00077f40: 2e6c 6f61 6449 6d61 6765 2829 0d0a 0d0a  .loadImage()....
-00077f50: 2020 2020 2020 2020 6966 2073 686f 776d          if showm
-00077f60: 6170 7461 623a 0d0a 2020 2020 2020 2020  aptab:..        
-00077f70: 2020 2020 7365 6c66 2e70 6172 656e 742e      self.parent.
-00077f80: 7061 6765 392e 436c 6561 7228 290d 0a20  page9.Clear().. 
-00077f90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00077fa0: 7061 7265 6e74 2e70 6167 6539 2e4c 6f61  parent.page9.Loa
-00077fb0: 6445 6e74 7269 6573 2829 0d0a 0d0a 2020  dEntries()....  
-00077fc0: 2020 2020 2020 7365 6c66 2e63 6c6f 7365        self.close
-00077fd0: 2829 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d  ()....#---------
-00077fe0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00077ff0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00078000: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00078010: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a63  -------------..c
-00078020: 6c61 7373 2053 7065 6374 7261 6c49 6d61  lass SpectralIma
-00078030: 6765 4d61 7028 5174 5769 6467 6574 732e  geMap(QtWidgets.
-00078040: 5144 6961 6c6f 672c 2051 7457 6964 6765  QDialog, QtWidge
-00078050: 7473 2e51 4772 6170 6869 6373 5363 656e  ts.QGraphicsScen
-00078060: 6529 3a0d 0a20 2020 2023 6576 6c69 7374  e):..    #evlist
-00078070: 6368 616e 6765 6420 3d20 7079 7174 5369  changed = pyqtSi
-00078080: 676e 616c 285b 6f62 6a65 6374 5d29 0d0a  gnal([object])..
-00078090: 2020 2020 2374 6865 7461 6c69 7374 6368      #thetalistch
-000780a0: 616e 6765 6420 3d20 7079 7174 5369 676e  anged = pyqtSign
-000780b0: 616c 285b 6f62 6a65 6374 5d29 0d0a 2020  al([object])..  
-000780c0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-000780d0: 656c 662c 2070 6172 656e 742c 2063 6f6d  elf, parent, com
-000780e0: 6d6f 6e2c 2073 7461 636b 293a 0d0a 2020  mon, stack):..  
-000780f0: 2020 2020 2020 5174 5769 6467 6574 732e        QtWidgets.
-00078100: 5157 6964 6765 742e 5f5f 696e 6974 5f5f  QWidget.__init__
-00078110: 2873 656c 662c 2070 6172 656e 7429 0d0a  (self, parent)..
-00078120: 2020 2020 2020 2020 7569 632e 6c6f 6164          uic.load
-00078130: 5569 286f 732e 7061 7468 2e6a 6f69 6e28  Ui(os.path.join(
-00078140: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
-00078150: 6f73 2e70 6174 682e 6162 7370 6174 6828  os.path.abspath(
-00078160: 5f5f 6669 6c65 5f5f 2929 2c20 2773 686f  __file__)), 'sho
-00078170: 7773 7065 6374 7261 6c72 6f69 2e75 6927  wspectralroi.ui'
-00078180: 292c 2073 656c 6629 0d0a 2020 2020 2020  ), self)..      
-00078190: 2020 7365 6c66 2e70 6172 656e 7420 3d20    self.parent = 
-000781a0: 7061 7265 6e74 0d0a 2020 2020 2020 2020  parent..        
-000781b0: 7365 6c66 2e73 7461 636b 203d 2073 7461  self.stack = sta
-000781c0: 636b 0d0a 2020 2020 2020 2020 7365 6c66  ck..        self
-000781d0: 2e63 6f6d 203d 2063 6f6d 6d6f 6e0d 0a20  .com = common.. 
-000781e0: 2020 2020 2020 2073 656c 662e 6965 7620         self.iev 
-000781f0: 3d20 300d 0a20 2020 2020 2020 2073 656c  = 0..        sel
-00078200: 662e 6974 6865 7461 203d 2030 0d0a 2020  f.itheta = 0..  
-00078210: 2020 2020 2020 2320 7365 6c66 2e73 7461        # self.sta
-00078220: 636b 2e61 6273 6461 7461 5f73 6869 6674  ck.absdata_shift
-00078230: 6564 5f63 726f 7070 6564 203d 2073 656c  ed_cropped = sel
-00078240: 662e 7374 6163 6b2e 6162 7364 6174 615f  f.stack.absdata_
-00078250: 7368 6966 7465 642e 636f 7079 2829 0d0a  shifted.copy()..
-00078260: 0d0a 2020 2020 2020 2020 2320 7365 6c66  ..        # self
-00078270: 2e70 6f6f 6c74 6872 6561 6420 3d20 5174  .poolthread = Qt
-00078280: 436f 7265 2e51 5468 7265 6164 2829 0d0a  Core.QThread()..
-00078290: 2020 2020 2020 2020 2320 7365 6c66 2e61          # self.a
-000782a0: 6c69 676e 6564 203d 2046 616c 7365 0d0a  ligned = False..
-000782b0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-000782c0: 746f 6e5f 6f6b 2e73 6574 456e 6162 6c65  ton_ok.setEnable
-000782d0: 6428 5472 7565 290d 0a0d 0a20 2020 2020  d(True)....     
-000782e0: 2020 2073 656c 662e 7365 7457 696e 646f     self.setWindo
-000782f0: 7754 6974 6c65 2827 5370 6563 7472 616c  wTitle('Spectral
-00078300: 2049 6d61 6765 204d 6170 2729 0d0a 2020   Image Map')..  
-00078310: 2020 2020 2020 2373 656c 662e 7067 6c61        #self.pgla
-00078320: 796f 7574 203d 2070 672e 4772 6170 6869  yout = pg.Graphi
-00078330: 6373 4c61 796f 7574 2862 6f72 6465 723d  csLayout(border=
-00078340: 4e6f 6e65 290d 0a20 2020 2020 2020 2023  None)..        #
-00078350: 7365 6c66 2e63 616e 7661 732e 7365 7442  self.canvas.setB
-00078360: 6163 6b67 726f 756e 6428 2277 2229 2020  ackground("w")  
-00078370: 2320 6361 6e76 6173 2069 7320 6120 7067  # canvas is a pg
-00078380: 2e47 7261 7068 6963 7356 6965 7720 7769  .GraphicsView wi
-00078390: 6467 6574 0d0a 2020 2020 2020 2020 2373  dget..        #s
-000783a0: 656c 662e 6361 6e76 6173 2e73 6574 4365  elf.canvas.setCe
-000783b0: 6e74 7261 6c57 6964 6765 7428 7365 6c66  ntralWidget(self
-000783c0: 2e70 676c 6179 6f75 7429 0d0a 2020 2020  .pglayout)..    
-000783d0: 2020 2020 2373 656c 662e 7662 203d 2073      #self.vb = s
-000783e0: 656c 662e 7067 6c61 796f 7574 2e61 6464  elf.pglayout.add
-000783f0: 5669 6577 426f 7828 290d 0a20 2020 2020  ViewBox()..     
-00078400: 2020 2023 7365 6c66 2e76 622e 7365 7441     #self.vb.setA
-00078410: 7370 6563 744c 6f63 6b65 6428 290d 0a20  spectLocked().. 
-00078420: 2020 2020 2020 2023 7365 6c66 2e69 5f69         #self.i_i
-00078430: 7465 6d20 3d20 7067 2e49 6d61 6765 4974  tem = pg.ImageIt
-00078440: 656d 2862 6f72 6465 723d 226b 222c 2070  em(border="k", p
-00078450: 6172 656e 743d 7365 6c66 290d 0a0d 0a20  arent=self).... 
-00078460: 2020 2020 2020 2023 7365 6c66 2e76 622e         #self.vb.
-00078470: 7365 744d 6f75 7365 456e 6162 6c65 6428  setMouseEnabled(
-00078480: 783d 4661 6c73 652c 2079 3d46 616c 7365  x=False, y=False
-00078490: 290d 0a20 2020 2020 2020 2023 7365 6c66  )..        #self
-000784a0: 2e76 622e 6164 6449 7465 6d28 7365 6c66  .vb.addItem(self
-000784b0: 2e69 5f69 7465 6d2c 2069 676e 6f72 6542  .i_item, ignoreB
-000784c0: 6f75 6e64 733d 4661 6c73 6529 0d0a 0d0a  ounds=False)....
-000784d0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-000784e0: 746f 6e5f 6f6b 2e63 6c69 636b 6564 2e63  ton_ok.clicked.c
-000784f0: 6f6e 6e65 6374 2873 656c 662e 4f6e 4163  onnect(self.OnAc
-00078500: 6365 7074 290d 0a20 2020 2020 2020 2073  cept)..        s
-00078510: 656c 662e 6275 7474 6f6e 5f63 616e 6365  elf.button_cance
-00078520: 6c2e 636c 6963 6b65 642e 636f 6e6e 6563  l.clicked.connec
-00078530: 7428 7365 6c66 2e4f 6e43 616e 6365 6c29  t(self.OnCancel)
-00078540: 0d0a 0d0a 2020 2020 2020 2020 6966 2073  ....        if s
-00078550: 656c 662e 636f 6d2e 7374 6163 6b5f 6c6f  elf.com.stack_lo
-00078560: 6164 6564 203d 3d20 313a 0d0a 2020 2020  aded == 1:..    
-00078570: 2020 2020 2320 2020 2020 7365 6c66 2e6c      #     self.l
-00078580: 6162 656c 5f74 6865 7461 5f72 616e 6765  abel_theta_range
-00078590: 2e73 6574 5669 7369 626c 6528 4661 6c73  .setVisible(Fals
-000785a0: 6529 0d0a 2020 2020 2020 2020 2320 2020  e)..        #   
-000785b0: 2020 7365 6c66 2e73 6c69 6465 725f 7468    self.slider_th
-000785c0: 6574 612e 7365 7456 6973 6962 6c65 2846  eta.setVisible(F
-000785d0: 616c 7365 290d 0a20 2020 2020 2020 2023  alse)..        #
-000785e0: 2020 2020 2073 656c 662e 6362 5f72 656d       self.cb_rem
-000785f0: 6f76 655f 7468 6574 612e 7365 7456 6973  ove_theta.setVis
-00078600: 6962 6c65 2846 616c 7365 290d 0a20 2020  ible(False)..   
-00078610: 2020 2020 2023 2020 2020 2073 656c 662e       #     self.
-00078620: 6772 6f75 7042 6f78 5f74 6865 7461 2e73  groupBox_theta.s
-00078630: 6574 5669 7369 626c 6528 4661 6c73 6529  etVisible(False)
-00078640: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
-00078650: 6966 2073 656c 662e 636f 6d2e 7374 6163  if self.com.stac
-00078660: 6b5f 3464 203d 3d20 313a 0d0a 2020 2020  k_4d == 1:..    
-00078670: 2020 2020 2320 2020 2020 2020 2020 7365      #         se
-00078680: 6c66 2e6c 6162 656c 5f74 6865 7461 5f72  lf.label_theta_r
-00078690: 616e 6765 2e73 6574 5669 7369 626c 6528  ange.setVisible(
-000786a0: 5472 7565 290d 0a20 2020 2020 2020 2023  True)..        #
-000786b0: 2020 2020 2020 2020 2073 656c 662e 736c           self.sl
-000786c0: 6964 6572 5f74 6865 7461 2e73 6574 5669  ider_theta.setVi
-000786d0: 7369 626c 6528 5472 7565 290d 0a20 2020  sible(True)..   
-000786e0: 2020 2020 2023 2020 2020 2020 2020 2073       #         s
-000786f0: 656c 662e 6362 5f72 656d 6f76 655f 7468  elf.cb_remove_th
-00078700: 6574 612e 7365 7456 6973 6962 6c65 2854  eta.setVisible(T
-00078710: 7275 6529 0d0a 2020 2020 2020 2020 2320  rue)..        # 
-00078720: 2020 2020 2020 2020 7365 6c66 2e67 726f          self.gro
-00078730: 7570 426f 785f 7468 6574 612e 7365 7456  upBox_theta.setV
-00078740: 6973 6962 6c65 2854 7275 6529 0d0a 2020  isible(True)..  
-00078750: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-00078760: 7365 6c66 2e73 6c69 6465 725f 7468 6574  self.slider_thet
-00078770: 612e 7365 7452 616e 6765 2830 2c20 7365  a.setRange(0, se
-00078780: 6c66 2e73 7461 636b 2e6e 5f74 6865 7461  lf.stack.n_theta
-00078790: 202d 2031 290d 0a20 2020 2020 2020 2023   - 1)..        #
-000787a0: 2020 2020 2020 2020 2073 656c 662e 736c           self.sl
-000787b0: 6964 6572 5f74 6865 7461 2e76 616c 7565  ider_theta.value
-000787c0: 4368 616e 6765 645b 696e 745d 2e63 6f6e  Changed[int].con
-000787d0: 6e65 6374 2873 656c 662e 4f6e 5363 726f  nect(self.OnScro
-000787e0: 6c6c 5468 6574 6129 0d0a 2020 2020 2020  llTheta)..      
-000787f0: 2020 2320 2020 2020 2020 2020 7365 6c66    #         self
-00078800: 2e53 6574 7570 4c69 7374 5468 6574 6128  .SetupListTheta(
-00078810: 290d 0a20 2020 2020 2020 2023 2020 2020  )..        #    
-00078820: 2023 2073 656c 662e 6d61 736b 6564 7661   # self.maskedva
-00078830: 6c73 203d 205b 5472 7565 5d20 2a20 696e  ls = [True] * in
-00078840: 7428 7365 6c66 2e73 7461 636b 2e6e 5f65  t(self.stack.n_e
-00078850: 7629 0d0a 2020 2020 2020 2020 2320 2020  v)..        #   
-00078860: 2020 2320 7365 6c66 2e73 7069 6e42 6f78    # self.spinBox
-00078870: 4572 726f 722e 7365 7445 6e61 626c 6564  Error.setEnabled
-00078880: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
-00078890: 2023 2020 2020 2073 656c 662e 736c 6964   #     self.slid
-000788a0: 6572 5f65 6e67 2e73 6c69 6465 7250 7265  er_eng.sliderPre
-000788b0: 7373 6564 2e63 6f6e 6e65 6374 2873 656c  ssed.connect(sel
-000788c0: 662e 5368 6f77 496d 6167 6529 0d0a 2020  f.ShowImage)..  
-000788d0: 2020 2020 2020 2320 2020 2020 7365 6c66        #     self
-000788e0: 2e73 6c69 6465 725f 656e 672e 736c 6964  .slider_eng.slid
-000788f0: 6572 5265 6c65 6173 6564 2e63 6f6e 6e65  erReleased.conne
-00078900: 6374 2873 656c 662e 5368 6f77 496d 6167  ct(self.ShowImag
-00078910: 6529 0d0a 2020 2020 2020 2020 2320 2020  e)..        #   
-00078920: 2020 7365 6c66 2e73 6c69 6465 725f 656e    self.slider_en
-00078930: 672e 7661 6c75 6543 6861 6e67 6564 5b69  g.valueChanged[i
-00078940: 6e74 5d2e 636f 6e6e 6563 7428 7365 6c66  nt].connect(self
-00078950: 2e4f 6e53 6372 6f6c 6c45 6e67 290d 0a20  .OnScrollEng).. 
-00078960: 2020 2020 2020 2023 2020 2020 2073 656c         #     sel
-00078970: 662e 736c 6964 6572 5f65 6e67 2e73 6574  f.slider_eng.set
-00078980: 5261 6e67 6528 302c 2073 656c 662e 7374  Range(0, self.st
-00078990: 6163 6b2e 6e5f 6576 202d 2031 290d 0a20  ack.n_ev - 1).. 
-000789a0: 2020 2020 2020 2023 2020 2020 2073 656c         #     sel
-000789b0: 662e 7062 5f73 656c 6563 7461 6c6c 2e63  f.pb_selectall.c
-000789c0: 6c69 636b 6564 2e63 6f6e 6e65 6374 2873  licked.connect(s
-000789d0: 656c 662e 4f6e 5365 6c65 6374 416c 6c29  elf.OnSelectAll)
-000789e0: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
-000789f0: 7365 6c66 2e70 625f 636c 6561 7261 6c6c  self.pb_clearall
-00078a00: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
-00078a10: 2873 656c 662e 4f6e 436c 6561 7241 6c6c  (self.OnClearAll
-00078a20: 290d 0a20 2020 2020 2020 2023 2020 2020  )..        #    
-00078a30: 2073 656c 662e 6576 6c69 7374 6368 616e   self.evlistchan
-00078a40: 6765 642e 636f 6e6e 6563 7428 6c61 6d62  ged.connect(lamb
-00078a50: 6461 2072 6f77 3a20 7365 6c66 2e71 4c69  da row: self.qLi
-00078a60: 7374 4368 616e 6765 4861 6e64 6c65 7228  stChangeHandler(
-00078a70: 726f 772c 2022 656e 6572 6779 2229 290d  row, "energy")).
-00078a80: 0a20 2020 2020 2020 2023 2020 2020 2073  .        #     s
-00078a90: 656c 662e 7468 6574 616c 6973 7463 6861  elf.thetalistcha
-00078aa0: 6e67 6564 2e63 6f6e 6e65 6374 286c 616d  nged.connect(lam
-00078ab0: 6264 6120 726f 773a 2073 656c 662e 714c  bda row: self.qL
-00078ac0: 6973 7443 6861 6e67 6548 616e 646c 6572  istChangeHandler
-00078ad0: 2872 6f77 2c20 2274 6865 7461 2229 290d  (row, "theta")).
-00078ae0: 0a20 2020 2020 2020 2023 2020 2020 2023  .        #     #
-00078af0: 2073 656c 662e 6576 5f77 6964 6765 742e   self.ev_widget.
-00078b00: 6974 656d 436c 6963 6b65 642e 636f 6e6e  itemClicked.conn
-00078b10: 6563 7428 6c61 6d62 6461 2069 7465 6d3a  ect(lambda item:
-00078b20: 2073 656c 662e 4f6e 4974 656d 436c 6963   self.OnItemClic
-00078b30: 6b65 6428 6974 656d 2929 0d0a 2020 2020  ked(item))..    
-00078b40: 2020 2020 2320 2020 2020 7365 6c66 2e65      #     self.e
-00078b50: 765f 7769 6467 6574 2e6d 6f75 7365 5072  v_widget.mousePr
-00078b60: 6573 7345 7665 6e74 203d 2073 656c 662e  essEvent = self.
-00078b70: 6d6f 7573 6545 7665 6e74 4f6e 4556 4c69  mouseEventOnEVLi
-00078b80: 7374 0d0a 2020 2020 2020 2020 2320 2020  st..        #   
-00078b90: 2020 7365 6c66 2e65 765f 7769 6467 6574    self.ev_widget
-00078ba0: 2e6d 6f75 7365 4d6f 7665 4576 656e 7420  .mouseMoveEvent 
-00078bb0: 3d20 7365 6c66 2e6d 6f75 7365 4576 656e  = self.mouseEven
-00078bc0: 744f 6e45 564c 6973 740d 0a20 2020 2020  tOnEVList..     
-00078bd0: 2020 2023 2020 2020 2073 656c 662e 7468     #     self.th
-00078be0: 6574 615f 7769 6467 6574 2e6d 6f75 7365  eta_widget.mouse
-00078bf0: 5072 6573 7345 7665 6e74 203d 2073 656c  PressEvent = sel
-00078c00: 662e 6d6f 7573 6545 7665 6e74 4f6e 5468  f.mouseEventOnTh
-00078c10: 6574 614c 6973 740d 0a20 2020 2020 2020  etaList..       
-00078c20: 2023 2020 2020 2073 656c 662e 7468 6574   #     self.thet
-00078c30: 615f 7769 6467 6574 2e6d 6f75 7365 4d6f  a_widget.mouseMo
-00078c40: 7665 4576 656e 7420 3d20 7365 6c66 2e6d  veEvent = self.m
-00078c50: 6f75 7365 4576 656e 744f 6e54 6865 7461  ouseEventOnTheta
-00078c60: 4c69 7374 0d0a 2020 2020 2020 2020 2020  List..          
-00078c70: 2020 2320 7365 6c66 2e65 765f 7769 6467    # self.ev_widg
-00078c80: 6574 2e69 7465 6d53 656c 6563 7469 6f6e  et.itemSelection
-00078c90: 4368 616e 6765 642e 636f 6e6e 6563 7428  Changed.connect(
-00078ca0: 6c61 6d62 6461 2069 7465 6d3a 2073 656c  lambda item: sel
-00078cb0: 662e 4f6e 4974 656d 436c 6963 6b65 6428  f.OnItemClicked(
-00078cc0: 6974 656d 2929 0d0a 2020 2020 2020 2020  item))..        
-00078cd0: 2020 2020 2373 656c 662e 5365 7475 704c      #self.SetupL
-00078ce0: 6973 7445 5628 290d 0a20 2020 2020 2020  istEV()..       
-00078cf0: 2020 2020 2023 7365 6c66 2e4f 6e53 6372       #self.OnScr
-00078d00: 6f6c 6c45 6e67 2830 290d 0a20 2020 2020  ollEng(0)..     
-00078d10: 2020 2020 2020 2023 7365 6c66 2e53 6574         #self.Set
-00078d20: 7570 524f 4928 290d 0a20 2020 2020 2020  upROI()..       
-00078d30: 2020 2020 2073 656c 662e 5365 7475 7050       self.SetupP
-00078d40: 6c6f 7428 290d 0a0d 0a20 2020 2064 6566  lot()....    def
-00078d50: 204f 6e53 656c 6563 7469 6f6e 4368 616e   OnSelectionChan
-00078d60: 6765 6428 7365 6c66 293a 0d0a 2020 2020  ged(self):..    
-00078d70: 2020 2020 2373 656c 662e 5265 6472 6177      #self.Redraw
-00078d80: 4e65 7750 6c6f 7428 290d 0a20 2020 2020  NewPlot()..     
-00078d90: 2020 2023 2073 656c 662e 5570 6461 7465     # self.Update
-00078da0: 496e 6469 6365 7328 290d 0a20 2020 2020  Indices()..     
-00078db0: 2020 2073 656c 662e 7265 6769 6f6e 5f69     self.region_i
-00078dc0: 302e 626c 6f63 6b53 6967 6e61 6c73 2854  0.blockSignals(T
-00078dd0: 7275 6529 0d0a 2020 2020 2020 2020 6966  rue)..        if
-00078de0: 2073 656c 662e 6964 785f 7365 6c65 6374   self.idx_select
-00078df0: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-00078e00: 2073 656c 662e 7265 6769 6f6e 5f69 302e   self.region_i0.
-00078e10: 7365 7452 6567 696f 6e28 5b73 656c 662e  setRegion([self.
-00078e20: 7374 6163 6b2e 6576 5b6d 696e 2873 656c  stack.ev[min(sel
-00078e30: 662e 6964 785f 7365 6c65 6374 6564 295d  f.idx_selected)]
-00078e40: 2c20 7365 6c66 2e73 7461 636b 2e65 765b  , self.stack.ev[
-00078e50: 6d61 7828 7365 6c66 2e69 6478 5f73 656c  max(self.idx_sel
-00078e60: 6563 7465 6429 5d5d 290d 0a20 2020 2020  ected)]])..     
-00078e70: 2020 2020 2020 2073 656c 662e 7265 6769         self.regi
-00078e80: 6f6e 5f69 302e 626c 6f63 6b53 6967 6e61  on_i0.blockSigna
-00078e90: 6c73 2846 616c 7365 290d 0a20 2020 2020  ls(False)..     
-00078ea0: 2020 2020 2020 2023 7365 6c66 2e73 7065         #self.spe
-00078eb0: 6374 7275 6d5f 706c 6f74 7769 6467 6574  ctrum_plotwidget
-00078ec0: 2e73 6574 5852 616e 6765 282a 7365 6c66  .setXRange(*self
-00078ed0: 2e72 6567 696f 6e5f 6930 2e67 6574 5265  .region_i0.getRe
-00078ee0: 6769 6f6e 2829 290d 0a20 2020 2020 2020  gion())..       
-00078ef0: 2020 2020 2023 7365 6c66 2e73 7065 6374       #self.spect
-00078f00: 7275 6d5f 706c 6f74 7769 6467 6574 2e73  rum_plotwidget.s
-00078f10: 6574 5952 616e 6765 286e 702e 6d69 6e28  etYRange(np.min(
-00078f20: 7365 6c66 2e70 6c6f 7469 7465 6d5f 6e65  self.plotitem_ne
-00078f30: 772e 7944 6174 6129 2c20 6e70 2e6d 6178  w.yData), np.max
-00078f40: 2873 656c 662e 706c 6f74 6974 656d 5f6e  (self.plotitem_n
-00078f50: 6577 2e79 4461 7461 2929 0d0a 2020 2020  ew.yData))..    
-00078f60: 2020 2020 7265 7475 726e 0d0a 0d0a 2020      return....  
-00078f70: 2020 6465 6620 4765 6e65 7261 7465 5370    def GenerateSp
-00078f80: 6563 7472 756d 2873 656c 662c 2065 7673  ectrum(self, evs
-00078f90: 656c 6563 7469 6f6e 293a 0d0a 2020 2020  election):..    
-00078fa0: 2020 2020 236c 6566 742c 7269 6768 742c      #left,right,
-00078fb0: 746f 702c 626f 7474 6f6d 203d 2073 656c  top,bottom = sel
-00078fc0: 662e 4765 7452 6567 696f 6e28 290d 0a20  f.GetRegion().. 
-00078fd0: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
-00078fe0: 6f6d 2e69 305f 6c6f 6164 6564 203d 3d20  om.i0_loaded == 
-00078ff0: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
-00079000: 6966 2073 656c 662e 636f 6d2e 7374 6163  if self.com.stac
-00079010: 6b5f 3464 203d 3d20 313a 0d0a 2020 2020  k_4d == 1:..    
-00079020: 2020 2020 2020 2020 2020 2020 746f 7461              tota
-00079030: 6c20 3d20 7365 6c66 2e73 7461 636b 2e6f  l = self.stack.o
-00079040: 6434 645b 3a2c 203a 2c20 3a2c 2069 6e74  d4d[:, :, :, int
-00079050: 2873 656c 662e 6974 6865 7461 295d 2e63  (self.itheta)].c
-00079060: 6f70 7928 290d 0a20 2020 2020 2020 2020  opy()..         
-00079070: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00079080: 2020 2020 2020 2020 2020 746f 7461 6c20            total 
-00079090: 3d20 7365 6c66 2e73 7461 636b 2e6f 6433  = self.stack.od3
-000790a0: 645b 3a2c 203a 2c20 3a5d 2e63 6f70 7928  d[:, :, :].copy(
-000790b0: 290d 0a0d 0a20 2020 2020 2020 2065 6c73  )....        els
-000790c0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000790d0: 6966 2073 656c 662e 636f 6d2e 7374 6163  if self.com.stac
-000790e0: 6b5f 3464 203d 3d20 313a 0d0a 2020 2020  k_4d == 1:..    
-000790f0: 2020 2020 2020 2020 2020 2020 2320 7420              # t 
-00079100: 3d20 5b73 656c 662e 7374 6163 6b2e 7468  = [self.stack.th
-00079110: 6574 615b 695d 2066 6f72 2069 2069 6e20  eta[i] for i in 
-00079120: 7365 6c66 2e74 6865 7461 6964 785f 7365  self.thetaidx_se
-00079130: 6c65 6374 6564 5d0d 0a20 2020 2020 2020  lected]..       
-00079140: 2020 2020 2020 2020 2023 2073 656c 662e           # self.
-00079150: 6c61 6265 6c5f 7468 6574 615f 7261 6e67  label_theta_rang
-00079160: 652e 7365 7454 6578 7428 0d0a 2020 2020  e.setText(..    
-00079170: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-00079180: 2020 2254 6865 7461 2072 616e 6765 3a20    "Theta range: 
-00079190: 5b20 2220 2b20 7374 7228 6d69 6e28 742c  [ " + str(min(t,
-000791a0: 2064 6566 6175 6c74 3d30 2929 202b 2022   default=0)) + "
-000791b0: c2b0 202e 2e20 2220 2b20 7374 7228 0d0a  .. .. " + str(..
-000791c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000791d0: 2320 2020 2020 2020 2020 6d61 7828 742c  #         max(t,
-000791e0: 2064 6566 6175 6c74 3d30 2929 202b 2022   default=0)) + "
-000791f0: c2b0 205d 2c20 2320 7661 6c75 6573 3a20  .. ], # values: 
-00079200: 2220 2b20 7374 7228 0d0a 2020 2020 2020  " + str(..      
-00079210: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-00079220: 2020 2020 6c65 6e28 7429 2929 0d0a 2020      len(t)))..  
-00079230: 2020 2020 2020 2020 2020 2020 2020 746f                to
-00079240: 7461 6c20 3d20 7365 6c66 2e73 7461 636b  tal = self.stack
-00079250: 2e73 7461 636b 3444 5b3a 2c20 3a2c 203a  .stack4D[:, :, :
-00079260: 2c20 696e 7428 7365 6c66 2e69 7468 6574  , int(self.ithet
-00079270: 6129 5d2e 636f 7079 2829 0d0a 2020 2020  a)].copy()..    
-00079280: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00079290: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000792a0: 6f74 616c 203d 2073 656c 662e 7374 6163  otal = self.stac
-000792b0: 6b2e 6162 7364 6174 615b 3a2c 203a 2c20  k.absdata[:, :, 
-000792c0: 3a5d 2e63 6f70 7928 290d 0a20 2020 2020  :].copy()..     
-000792d0: 2020 2074 6f74 616c 203d 2074 6f74 616c     total = total
-000792e0: 2e73 756d 2861 7869 733d 2830 2c31 2929  .sum(axis=(0,1))
-000792f0: 2023 2f20 2869 6e74 2873 656c 662e 626f   #/ (int(self.bo
-00079300: 782e 7369 7a65 2829 2e78 2829 2920 2a20  x.size().x()) * 
-00079310: 696e 7428 7365 6c66 2e62 6f78 2e73 697a  int(self.box.siz
-00079320: 6528 292e 7928 2929 290d 0a20 2020 2020  e().y()))..     
-00079330: 2020 2078 203d 2073 656c 662e 7374 6163     x = self.stac
-00079340: 6b2e 6576 0d0a 2020 2020 2020 2020 7920  k.ev..        y 
-00079350: 3d20 746f 7461 6c0d 0a20 2020 2020 2020  = total..       
-00079360: 2023 7365 6c66 2e6c 6162 656c 5f73 7061   #self.label_spa
-00079370: 7469 616c 5f72 616e 6765 2e73 6574 5465  tial_range.setTe
-00079380: 7874 2822 5374 6163 6b20 7369 7a65 3a20  xt("Stack size: 
-00079390: 5b20 222b 7374 7228 696e 7428 7365 6c66  [ "+str(int(self
-000793a0: 2e62 6f78 2e73 697a 6528 292e 7828 2929  .box.size().x())
-000793b0: 292b 2220 7820 222b 7374 7228 696e 7428  )+" x "+str(int(
-000793c0: 7365 6c66 2e62 6f78 2e73 697a 6528 292e  self.box.size().
-000793d0: 7928 2929 292b 2220 5d20 7078 c2b2 2229  y()))+" ] px..")
-000793e0: 0d0a 2020 2020 2020 2020 2373 656c 662e  ..        #self.
-000793f0: 6c61 6265 6c5f 6576 5f72 616e 6765 2e73  label_ev_range.s
-00079400: 6574 5465 7874 280d 0a20 2020 2020 2020  etText(..       
-00079410: 2023 2020 2020 2245 6e65 7267 7920 7261   #    "Energy ra
-00079420: 6e67 653a 205b 2022 202b 2073 7472 286d  nge: [ " + str(m
-00079430: 696e 2878 2c20 6465 6661 756c 743d 3029  in(x, default=0)
-00079440: 2920 2b20 2220 2e2e 2022 202b 2073 7472  ) + " .. " + str
-00079450: 286d 6178 2878 2c20 6465 6661 756c 743d  (max(x, default=
-00079460: 3029 2920 2b20 2220 5d20 6556 2c20 2320  0)) + " ] eV, # 
-00079470: 7661 6c75 6573 3a20 222b 2073 7472 286c  values: "+ str(l
-00079480: 656e 2878 2929 290d 0a20 2020 2020 2020  en(x)))..       
-00079490: 2072 6574 7572 6e20 2878 2c20 7929 0d0a   return (x, y)..
-000794a0: 2020 2020 2320 6465 6620 5570 6461 7465      # def Update
-000794b0: 496e 6469 6365 7328 7365 6c66 293a 0d0a  Indices(self):..
-000794c0: 2020 2020 2320 2020 2020 7365 6c66 2e69      #     self.i
-000794d0: 6478 5f73 656c 6563 7465 6420 3d20 736f  dx_selected = so
-000794e0: 7274 6564 285b 7365 6c66 2e65 765f 7769  rted([self.ev_wi
-000794f0: 6467 6574 2e72 6f77 2869 2920 666f 7220  dget.row(i) for 
-00079500: 6920 696e 2073 656c 662e 6576 5f73 656c  i in self.ev_sel
-00079510: 6563 7465 645d 290d 0a20 2020 2023 2020  ected])..    #  
-00079520: 2020 2069 6620 7365 6c66 2e63 6f6d 2e73     if self.com.s
-00079530: 7461 636b 5f34 643a 0d0a 2020 2020 2320  tack_4d:..    # 
-00079540: 2020 2020 2020 2020 7365 6c66 2e74 6865          self.the
-00079550: 7461 6964 785f 7365 6c65 6374 6564 203d  taidx_selected =
-00079560: 2073 6f72 7465 6428 5b73 656c 662e 7468   sorted([self.th
-00079570: 6574 615f 7769 6467 6574 2e72 6f77 2869  eta_widget.row(i
-00079580: 2920 666f 7220 6920 696e 2073 656c 662e  ) for i in self.
-00079590: 7468 6574 615f 7365 6c65 6374 6564 5d29  theta_selected])
-000795a0: 0d0a 2020 2020 230d 0a20 2020 2023 2064  ..    #..    # d
-000795b0: 6566 2052 6564 7261 7750 6c6f 7473 2873  ef RedrawPlots(s
-000795c0: 656c 6629 3a0d 0a20 2020 2023 2020 2020  elf):..    #    
-000795d0: 2078 2c20 7920 3d20 7365 6c66 2e47 656e   x, y = self.Gen
-000795e0: 6572 6174 6553 7065 6374 7275 6d28 6c69  erateSpectrum(li
-000795f0: 7374 2872 616e 6765 2873 656c 662e 7374  st(range(self.st
-00079600: 6163 6b2e 6e5f 6576 2929 290d 0a20 2020  ack.n_ev)))..   
-00079610: 2023 2020 2020 2073 656c 662e 706c 6f74   #     self.plot
-00079620: 6974 656d 2e73 6574 4461 7461 2878 2c20  item.setData(x, 
-00079630: 7929 0d0a 2020 2020 2320 2020 2020 7365  y)..    #     se
-00079640: 6c66 2e4f 6e53 656c 6563 7469 6f6e 4368  lf.OnSelectionCh
-00079650: 616e 6765 6428 290d 0a20 2020 2023 0d0a  anged()..    #..
-00079660: 2020 2020 2320 6465 6620 5265 6472 6177      # def Redraw
-00079670: 4e65 7750 6c6f 7428 7365 6c66 293a 0d0a  NewPlot(self):..
-00079680: 2020 2020 2320 2020 2020 2373 656c 662e      #     #self.
-00079690: 5570 6461 7465 496e 6469 6365 7328 290d  UpdateIndices().
-000796a0: 0a20 2020 2023 2020 2020 2078 2c20 7920  .    #     x, y 
-000796b0: 3d20 7365 6c66 2e47 656e 6572 6174 6553  = self.GenerateS
-000796c0: 7065 6374 7275 6d28 7365 6c66 2e69 6478  pectrum(self.idx
-000796d0: 5f73 656c 6563 7465 6429 0d0a 2020 2020  _selected)..    
-000796e0: 2320 2020 2020 7365 6c66 2e70 6c6f 7469  #     self.ploti
-000796f0: 7465 6d5f 6e65 772e 7365 7444 6174 6128  tem_new.setData(
-00079700: 782c 2079 290d 0a20 2020 2023 2020 2020  x, y)..    #    
-00079710: 2069 6620 7365 6c66 2e69 6478 5f73 656c   if self.idx_sel
-00079720: 6563 7465 643a 0d0a 2020 2020 2320 2020  ected:..    #   
-00079730: 2020 2020 2020 7365 6c66 2e72 6567 696f        self.regio
-00079740: 6e5f 6930 2e73 686f 7728 290d 0a20 2020  n_i0.show()..   
-00079750: 2023 0d0a 2020 2020 2320 6465 6620 714c   #..    # def qL
-00079760: 6973 7443 6861 6e67 6548 616e 646c 6572  istChangeHandler
-00079770: 2873 656c 662c 2072 6f77 2c20 6469 6d65  (self, row, dime
-00079780: 6e73 696f 6e29 3a0d 0a20 2020 2023 2020  nsion):..    #  
-00079790: 2020 2069 6620 6469 6d65 6e73 696f 6e20     if dimension 
-000797a0: 3d3d 2022 7468 6574 6122 3a0d 0a20 2020  == "theta":..   
-000797b0: 2023 2020 2020 2020 2020 2073 656c 6563   #         selec
-000797c0: 7469 6f6e 203d 2073 656c 662e 7468 6574  tion = self.thet
-000797d0: 615f 7365 6c65 6374 6564 0d0a 2020 2020  a_selected..    
-000797e0: 2320 2020 2020 2020 2020 7769 6467 6574  #         widget
-000797f0: 203d 2073 656c 662e 7468 6574 615f 7769   = self.theta_wi
-00079800: 6467 6574 0d0a 2020 2020 2320 2020 2020  dget..    #     
-00079810: 656c 6966 2064 696d 656e 7369 6f6e 203d  elif dimension =
-00079820: 3d20 2265 6e65 7267 7922 3a0d 0a20 2020  = "energy":..   
-00079830: 2023 2020 2020 2020 2020 2073 656c 6563   #         selec
-00079840: 7469 6f6e 203d 2073 656c 662e 6576 5f73  tion = self.ev_s
-00079850: 656c 6563 7465 640d 0a20 2020 2023 2020  elected..    #  
-00079860: 2020 2020 2020 2077 6964 6765 7420 3d20         widget = 
-00079870: 7365 6c66 2e65 765f 7769 6467 6574 0d0a  self.ev_widget..
-00079880: 2020 2020 230d 0a20 2020 2023 2020 2020      #..    #    
-00079890: 2069 6620 726f 7720 696e 2073 656c 6563   if row in selec
-000798a0: 7469 6f6e 3a0d 0a20 2020 2023 2020 2020  tion:..    #    
-000798b0: 2020 2020 2073 656c 6563 7469 6f6e 2e72       selection.r
-000798c0: 656d 6f76 6528 726f 7729 0d0a 2020 2020  emove(row)..    
-000798d0: 2320 2020 2020 2020 2020 726f 772e 7365  #         row.se
-000798e0: 7442 6163 6b67 726f 756e 6428 5174 4775  tBackground(QtGu
-000798f0: 692e 5143 6f6c 6f72 2830 2c20 302c 2030  i.QColor(0, 0, 0
-00079900: 2c20 3029 290d 0a20 2020 2023 2020 2020  , 0))..    #    
-00079910: 2065 6c73 653a 0d0a 2020 2020 2320 2020   else:..    #   
-00079920: 2020 2020 2020 7365 6c65 6374 696f 6e2e        selection.
-00079930: 6170 7065 6e64 2872 6f77 290d 0a20 2020  append(row)..   
-00079940: 2023 2020 2020 2020 2020 2072 6f77 2e73   #         row.s
-00079950: 6574 4261 636b 6772 6f75 6e64 2851 7447  etBackground(QtG
-00079960: 7569 2e51 436f 6c6f 7228 2723 6265 6165  ui.QColor('#beae
-00079970: 6434 2729 290d 0a20 2020 2023 2020 2020  d4'))..    #    
-00079980: 2069 6620 6469 6d65 6e73 696f 6e20 3d3d   if dimension ==
-00079990: 2022 7468 6574 6122 3a0d 0a20 2020 2023   "theta":..    #
-000799a0: 2020 2020 2020 2020 2073 656c 662e 4f6e           self.On
-000799b0: 5363 726f 6c6c 5468 6574 6128 7769 6467  ScrollTheta(widg
-000799c0: 6574 2e72 6f77 2872 6f77 2929 0d0a 2020  et.row(row))..  
-000799d0: 2020 2320 2020 2020 656c 6966 2064 696d    #     elif dim
-000799e0: 656e 7369 6f6e 203d 3d20 2265 6e65 7267  ension == "energ
-000799f0: 7922 3a0d 0a20 2020 2023 2020 2020 2020  y":..    #      
-00079a00: 2020 2073 656c 662e 4f6e 5363 726f 6c6c     self.OnScroll
-00079a10: 456e 6728 7769 6467 6574 2e72 6f77 2872  Eng(widget.row(r
-00079a20: 6f77 2929 0d0a 2020 2020 2320 2020 2020  ow))..    #     
-00079a30: 7365 6c66 2e4f 6e53 656c 6563 7469 6f6e  self.OnSelection
-00079a40: 4368 616e 6765 6428 290d 0a0d 0a20 2020  Changed()....   
-00079a50: 2064 6566 2053 6574 7570 506c 6f74 2873   def SetupPlot(s
-00079a60: 656c 6629 3a0d 0a20 2020 2020 2020 2078  elf):..        x
-00079a70: 2c20 7920 3d20 7365 6c66 2e47 656e 6572  , y = self.Gener
-00079a80: 6174 6553 7065 6374 7275 6d28 6c69 7374  ateSpectrum(list
-00079a90: 2872 616e 6765 2873 656c 662e 7374 6163  (range(self.stac
-00079aa0: 6b2e 6e5f 6576 2929 290d 0a20 2020 2020  k.n_ev)))..     
-00079ab0: 2020 2073 656c 662e 7370 6563 7472 756d     self.spectrum
-00079ac0: 5f70 6c6f 7477 6964 6765 742e 7365 7442  _plotwidget.setB
-00079ad0: 6163 6b67 726f 756e 6428 2277 2229 0d0a  ackground("w")..
-00079ae0: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
-00079af0: 6567 696f 6e5f 6930 203d 2070 672e 4c69  egion_i0 = pg.Li
-00079b00: 6e65 6172 5265 6769 6f6e 4974 656d 2862  nearRegionItem(b
-00079b10: 7275 7368 3d51 7447 7569 2e51 436f 6c6f  rush=QtGui.QColo
-00079b20: 7228 2723 3838 6265 6165 6434 2729 2c68  r('#88beaed4'),h
-00079b30: 6f76 6572 4272 7573 683d 5174 4775 692e  overBrush=QtGui.
-00079b40: 5143 6f6c 6f72 2827 2363 6362 6561 6564  QColor('#ccbeaed
-00079b50: 3427 292c 2062 6f75 6e64 733d 5b6e 702e  4'), bounds=[np.
-00079b60: 6d69 6e28 7829 2c20 6e70 2e6d 6178 2878  min(x), np.max(x
-00079b70: 295d 290d 0a20 2020 2020 2020 2073 656c  )])..        sel
-00079b80: 662e 7265 6769 6f6e 5f69 302e 7365 745a  f.region_i0.setZ
-00079b90: 5661 6c75 6528 3130 290d 0a20 2020 2020  Value(10)..     
-00079ba0: 2020 2073 656c 662e 7265 6769 6f6e 5f69     self.region_i
-00079bb0: 203d 2070 672e 4c69 6e65 6172 5265 6769   = pg.LinearRegi
-00079bc0: 6f6e 4974 656d 2862 7275 7368 3d51 7447  onItem(brush=QtG
-00079bd0: 7569 2e51 436f 6c6f 7228 2723 3838 3766  ui.QColor('#887f
-00079be0: 6339 3766 2729 2c68 6f76 6572 4272 7573  c97f'),hoverBrus
-00079bf0: 683d 5174 4775 692e 5143 6f6c 6f72 2827  h=QtGui.QColor('
-00079c00: 2363 6337 6663 3937 6627 292c 2062 6f75  #cc7fc97f'), bou
-00079c10: 6e64 733d 5b6e 702e 6d69 6e28 7829 2c20  nds=[np.min(x), 
-00079c20: 6e70 2e6d 6178 2878 295d 290d 0a20 2020  np.max(x)])..   
-00079c30: 2020 2020 2073 656c 662e 7265 6769 6f6e       self.region
-00079c40: 5f69 2e73 6574 5a56 616c 7565 2831 3029  _i.setZValue(10)
-00079c50: 0d0a 0d0a 2020 2020 2020 2020 706c 6f74  ....        plot
-00079c60: 203d 2073 656c 662e 7370 6563 7472 756d   = self.spectrum
-00079c70: 5f70 6c6f 7477 6964 6765 740d 0a20 2020  _plotwidget..   
-00079c80: 2020 2020 2070 6c6f 742e 7365 7442 6163       plot.setBac
-00079c90: 6b67 726f 756e 6428 2277 2229 0d0a 2020  kground("w")..  
-00079ca0: 2020 2020 2020 706c 6f74 2e61 6464 4974        plot.addIt
-00079cb0: 656d 2873 656c 662e 7265 6769 6f6e 5f69  em(self.region_i
-00079cc0: 302c 2069 676e 6f72 6542 6f75 6e64 733d  0, ignoreBounds=
-00079cd0: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-00079ce0: 706c 6f74 2e61 6464 4974 656d 2873 656c  plot.addItem(sel
-00079cf0: 662e 7265 6769 6f6e 5f69 2c20 6967 6e6f  f.region_i, igno
-00079d00: 7265 426f 756e 6473 3d46 616c 7365 290d  reBounds=False).
-00079d10: 0a20 2020 2020 2020 2070 6c6f 742e 7365  .        plot.se
-00079d20: 744d 6f75 7365 456e 6162 6c65 6428 783d  tMouseEnabled(x=
-00079d30: 4661 6c73 652c 2079 3d46 616c 7365 290d  False, y=False).
-00079d40: 0a20 2020 2020 2020 2070 6c6f 742e 7368  .        plot.sh
-00079d50: 6f77 4772 6964 2879 3d54 7275 6529 0d0a  owGrid(y=True)..
-00079d60: 0d0a 2020 2020 2020 2020 706c 6f74 2e73  ..        plot.s
-00079d70: 686f 7741 7869 7328 2274 6f70 222c 2073  howAxis("top", s
-00079d80: 686f 773d 5472 7565 290d 0a20 2020 2020  how=True)..     
-00079d90: 2020 2070 6c6f 742e 7368 6f77 4178 6973     plot.showAxis
-00079da0: 2822 7269 6768 7422 2c20 7368 6f77 3d54  ("right", show=T
-00079db0: 7275 6529 0d0a 2020 2020 2020 2020 6279  rue)..        by
-00079dc0: 203d 2070 6c6f 742e 6765 7441 7869 7328   = plot.getAxis(
-00079dd0: 2272 6967 6874 2229 0d0a 2020 2020 2020  "right")..      
-00079de0: 2020 6278 203d 2070 6c6f 742e 6765 7441    bx = plot.getA
-00079df0: 7869 7328 2274 6f70 2229 0d0a 2020 2020  xis("top")..    
-00079e00: 2020 2020 6279 2e73 6574 5374 796c 6528      by.setStyle(
-00079e10: 7368 6f77 5661 6c75 6573 3d46 616c 7365  showValues=False
-00079e20: 2c20 7469 636b 4c65 6e67 7468 3d30 290d  , tickLength=0).
-00079e30: 0a20 2020 2020 2020 2062 782e 7365 7453  .        bx.setS
-00079e40: 7479 6c65 2873 686f 7756 616c 7565 733d  tyle(showValues=
-00079e50: 4661 6c73 652c 2074 6963 6b4c 656e 6774  False, tickLengt
-00079e60: 683d 3029 0d0a 2020 2020 2020 2020 6179  h=0)..        ay
-00079e70: 203d 2070 6c6f 742e 6765 7441 7869 7328   = plot.getAxis(
-00079e80: 226c 6566 7422 290d 0a20 2020 2020 2020  "left")..       
-00079e90: 2061 7820 3d20 706c 6f74 2e67 6574 4178   ax = plot.getAx
-00079ea0: 6973 2822 626f 7474 6f6d 2229 0d0a 0d0a  is("bottom")....
-00079eb0: 2020 2020 2020 2020 6178 2e73 6574 4c61          ax.setLa
-00079ec0: 6265 6c28 7465 7874 3d22 5068 6f74 6f6e  bel(text="Photon
-00079ed0: 2065 6e65 7267 7920 5b65 565d 2229 0d0a   energy [eV]")..
-00079ee0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00079ef0: 636f 6d2e 6930 5f6c 6f61 6465 643a 0d0a  com.i0_loaded:..
-00079f00: 2020 2020 2020 2020 2020 2020 6179 2e73              ay.s
-00079f10: 6574 4c61 6265 6c28 7465 7874 3d22 4f70  etLabel(text="Op
-00079f20: 7469 6361 6c20 6465 6e73 6974 7922 290d  tical density").
-00079f30: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00079f40: 2020 2020 2020 2020 2020 2020 6179 2e73              ay.s
-00079f50: 6574 4c61 6265 6c28 7465 7874 3d22 5068  etLabel(text="Ph
-00079f60: 6f74 6f6e 2066 6c75 7820 5b63 7073 5d22  oton flux [cps]"
-00079f70: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-00079f80: 662e 706c 6f74 6974 656d 203d 2070 6c6f  f.plotitem = plo
-00079f90: 742e 706c 6f74 2878 2c20 792c 2070 656e  t.plot(x, y, pen
-00079fa0: 3d70 672e 6d6b 5065 6e28 636f 6c6f 723d  =pg.mkPen(color=
-00079fb0: 2262 222c 2077 6964 7468 3d32 2929 0d0a  "b", width=2))..
-00079fc0: 2020 2020 2020 2020 7365 6c66 2e70 6c6f          self.plo
-00079fd0: 7469 7465 6d2e 7365 745a 5661 6c75 6528  titem.setZValue(
-00079fe0: 3130 3029 0d0a 2020 2020 2020 2020 2320  100)..        # 
-00079ff0: 7365 6c66 2e70 6c6f 7469 7465 6d5f 6e65  self.plotitem_ne
-0007a000: 7720 3d20 706c 6f74 2e70 6c6f 7428 782c  w = plot.plot(x,
-0007a010: 2079 2c20 7065 6e3d 7067 2e6d 6b50 656e   y, pen=pg.mkPen
-0007a020: 2863 6f6c 6f72 3d22 6222 2c20 7769 6474  (color="b", widt
-0007a030: 683d 3229 290d 0a20 2020 2020 2020 2023  h=2))..        #
-0007a040: 2073 656c 662e 7265 666d 6172 6b65 7220   self.refmarker 
-0007a050: 3d20 7067 2e49 6e66 696e 6974 654c 696e  = pg.InfiniteLin
-0007a060: 6528 616e 676c 653d 3930 2c20 6d6f 7661  e(angle=90, mova
-0007a070: 626c 653d 4661 6c73 652c 0d0a 2020 2020  ble=False,..    
-0007a080: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0007a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007a0a0: 2020 2020 2020 2070 656e 3d70 672e 6d6b         pen=pg.mk
-0007a0b0: 5065 6e28 636f 6c6f 723d 2262 222c 2077  Pen(color="b", w
-0007a0c0: 6964 7468 3d32 2c20 7374 796c 653d 5174  idth=2, style=Qt
-0007a0d0: 436f 7265 2e51 742e 4461 7368 4c69 6e65  Core.Qt.DashLine
-0007a0e0: 2929 0d0a 2020 2020 2020 2020 2370 6c6f  ))..        #plo
-0007a0f0: 742e 6164 6449 7465 6d28 7365 6c66 2e72  t.addItem(self.r
-0007a100: 6566 6d61 726b 6572 2c20 6967 6e6f 7265  efmarker, ignore
-0007a110: 426f 756e 6473 3d54 7275 6529 0d0a 2020  Bounds=True)..  
-0007a120: 2020 2020 2020 7365 6c66 2e72 6567 696f        self.regio
-0007a130: 6e5f 6930 2e73 6574 5265 6769 6f6e 2828  n_i0.setRegion((
-0007a140: 6d69 6e28 7829 2c20 6d69 6e28 7829 2b30  min(x), min(x)+0
-0007a150: 2e32 352a 286d 6178 2878 292d 6d69 6e28  .25*(max(x)-min(
-0007a160: 7829 2929 290d 0a20 2020 2020 2020 2073  x))))..        s
-0007a170: 656c 662e 7265 6769 6f6e 5f69 2e73 6574  elf.region_i.set
-0007a180: 5265 6769 6f6e 2828 286d 6178 2878 292d  Region(((max(x)-
-0007a190: 302e 3235 2a28 6d61 7828 7829 2d6d 696e  0.25*(max(x)-min
-0007a1a0: 2878 2929 292c 206d 6178 2878 2929 290d  (x))), max(x))).
-0007a1b0: 0a20 2020 2020 2020 2023 7365 6c66 2e72  .        #self.r
-0007a1c0: 6567 696f 6e5f 6930 2e73 6967 5265 6769  egion_i0.sigRegi
-0007a1d0: 6f6e 4368 616e 6765 2e63 6f6e 6e65 6374  onChange.connect
-0007a1e0: 2873 656c 662e 5570 6461 7465 5365 6c65  (self.UpdateSele
-0007a1f0: 6374 696f 6e29 0d0a 2020 2020 2020 2020  ction)..        
-0007a200: 2373 656c 662e 7265 6769 6f6e 5f69 2e73  #self.region_i.s
-0007a210: 6967 5265 6769 6f6e 4368 616e 6765 2e63  igRegionChange.c
-0007a220: 6f6e 6e65 6374 2873 656c 662e 5570 6461  onnect(self.Upda
-0007a230: 7465 5365 6c65 6374 696f 6e29 0d0a 2020  teSelection)..  
-0007a240: 2020 2020 2020 7365 6c66 2e72 6567 696f        self.regio
-0007a250: 6e5f 6930 2e73 6967 5265 6769 6f6e 4368  n_i0.sigRegionCh
-0007a260: 616e 6765 4669 6e69 7368 6564 2e63 6f6e  angeFinished.con
-0007a270: 6e65 6374 2873 656c 662e 5570 6461 7465  nect(self.Update
-0007a280: 5365 6c65 6374 696f 6e29 0d0a 2020 2020  Selection)..    
-0007a290: 2020 2020 7365 6c66 2e72 6567 696f 6e5f      self.region_
-0007a2a0: 692e 7369 6752 6567 696f 6e43 6861 6e67  i.sigRegionChang
-0007a2b0: 6546 696e 6973 6865 642e 636f 6e6e 6563  eFinished.connec
-0007a2c0: 7428 7365 6c66 2e55 7064 6174 6553 656c  t(self.UpdateSel
-0007a2d0: 6563 7469 6f6e 290d 0a20 2020 2023 202d  ection)..    # -
-0007a2e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007a2f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007a300: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007a310: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007a320: 2d2d 2d2d 2d0d 0a20 2020 2064 6566 2067  -----..    def g
-0007a330: 6574 4461 7461 436c 6f73 6573 7454 6f52  etDataClosestToR
-0007a340: 6567 696f 6e28 7365 6c66 2c20 7265 6769  egion(self, regi
-0007a350: 6f6e 2c20 706c 6f74 6974 656d 2c20 736e  on, plotitem, sn
-0007a360: 6170 7265 6769 6f6e 3d54 7275 6529 3a0d  apregion=True):.
-0007a370: 0a20 2020 2020 2020 2023 6f74 6865 7272  .        #otherr
-0007a380: 6567 696f 6e20 3d20 7b73 656c 662e 7265  egion = {self.re
-0007a390: 6769 6f6e 5f69 203a 2073 656c 662e 7265  gion_i : self.re
-0007a3a0: 6769 6f6e 5f69 302c 2073 656c 662e 7265  gion_i0, self.re
-0007a3b0: 6769 6f6e 5f69 303a 2073 656c 662e 7265  gion_i0: self.re
-0007a3c0: 6769 6f6e 5f69 7d0d 0a20 2020 2020 2020  gion_i}..       
-0007a3d0: 206d 696e 6964 782c 206d 6178 6964 7820   minidx, maxidx 
-0007a3e0: 3d20 7265 6769 6f6e 2e67 6574 5265 6769  = region.getRegi
-0007a3f0: 6f6e 2829 0d0a 2020 2020 2020 2020 6461  on()..        da
-0007a400: 7461 203d 2070 6c6f 7469 7465 6d2e 6765  ta = plotitem.ge
-0007a410: 7444 6174 6128 295b 305d 0d0a 2020 2020  tData()[0]..    
-0007a420: 2020 2020 696e 6465 7820 3d20 6c61 6d62      index = lamb
-0007a430: 6461 2078 3a20 6e70 2e61 7267 6d69 6e28  da x: np.argmin(
-0007a440: 6e70 2e61 6273 2864 6174 6120 2d20 7829  np.abs(data - x)
-0007a450: 290d 0a20 2020 2020 2020 206d 696e 6964  )..        minid
-0007a460: 7820 3d20 696e 6465 7828 6d69 6e69 6478  x = index(minidx
-0007a470: 290d 0a20 2020 2020 2020 206d 6178 6964  )..        maxid
-0007a480: 7820 3d20 696e 6465 7828 6d61 7869 6478  x = index(maxidx
-0007a490: 290d 0a20 2020 2020 2020 2069 6620 6d69  )..        if mi
-0007a4a0: 6e69 6478 203d 3d20 6d61 7869 6478 3a0d  nidx == maxidx:.
-0007a4b0: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
-0007a4c0: 6964 7820 3d20 300d 0a20 2020 2020 2020  idx = 0..       
-0007a4d0: 2020 2020 206d 6178 6964 7820 3d20 6e70       maxidx = np
-0007a4e0: 2e61 7267 6d61 7828 6461 7461 290d 0a20  .argmax(data).. 
-0007a4f0: 2020 2020 2020 206d 696e 6461 7461 203d         mindata =
-0007a500: 2064 6174 615b 6d69 6e69 6478 5d0d 0a20   data[minidx].. 
-0007a510: 2020 2020 2020 206d 6178 6461 7461 203d         maxdata =
-0007a520: 2064 6174 615b 6d61 7869 6478 5d0d 0a20   data[maxidx].. 
-0007a530: 2020 2020 2020 2069 6620 7265 6769 6f6e         if region
-0007a540: 203d 3d20 7365 6c66 2e72 6567 696f 6e5f   == self.region_
-0007a550: 693a 0d0a 2020 2020 2020 2020 2020 2020  i:..            
-0007a560: 7365 6c66 2e72 6567 696f 6e5f 6930 2e73  self.region_i0.s
-0007a570: 6574 426f 756e 6473 2828 6d69 6e28 6461  etBounds((min(da
-0007a580: 7461 292c 2064 6174 615b 6d69 6e69 6478  ta), data[minidx
-0007a590: 5d29 290d 0a20 2020 2020 2020 2065 6c69  ]))..        eli
-0007a5a0: 6620 7265 6769 6f6e 203d 3d20 7365 6c66  f region == self
-0007a5b0: 2e72 6567 696f 6e5f 6930 3a0d 0a20 2020  .region_i0:..   
-0007a5c0: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
-0007a5d0: 6769 6f6e 5f69 2e73 6574 426f 756e 6473  gion_i.setBounds
-0007a5e0: 2828 6461 7461 5b6d 6178 6964 785d 2c20  ((data[maxidx], 
-0007a5f0: 6d61 7828 6461 7461 2929 290d 0a20 2020  max(data)))..   
-0007a600: 2020 2020 2069 6620 736e 6170 7265 6769       if snapregi
-0007a610: 6f6e 3a0d 0a20 2020 2020 2020 2020 2020  on:..           
-0007a620: 2072 6567 696f 6e2e 626c 6f63 6b53 6967   region.blockSig
-0007a630: 6e61 6c73 2854 7275 6529 0d0a 2020 2020  nals(True)..    
-0007a640: 2020 2020 2020 2020 7265 6769 6f6e 2e73          region.s
-0007a650: 6574 5265 6769 6f6e 285b 6d69 6e64 6174  etRegion([mindat
-0007a660: 612c 206d 6178 6461 7461 5d29 2020 2320  a, maxdata])  # 
-0007a670: 736e 6170 2072 6567 696f 6e20 746f 2064  snap region to d
-0007a680: 6174 6120 706f 696e 7473 0d0a 2020 2020  ata points..    
-0007a690: 2020 2020 2020 2020 7265 6769 6f6e 2e62          region.b
-0007a6a0: 6c6f 636b 5369 676e 616c 7328 4661 6c73  lockSignals(Fals
-0007a6b0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-0007a6c0: 2373 656c 662e 7061 7265 6e74 2e4f 6e53  #self.parent.OnS
-0007a6d0: 656c 6563 7469 6f6e 4368 616e 6765 6428  electionChanged(
-0007a6e0: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0007a6f0: 6e20 6d69 6e69 6478 2c20 6d61 7869 6478  n minidx, maxidx
-0007a700: 2c20 6d69 6e64 6174 612c 206d 6178 6461  , mindata, maxda
-0007a710: 7461 0d0a 0d0a 2020 2020 6465 6620 5570  ta....    def Up
-0007a720: 6461 7465 5365 6c65 6374 696f 6e28 7365  dateSelection(se
-0007a730: 6c66 293a 0d0a 2020 2020 2020 2020 6d69  lf):..        mi
-0007a740: 6e69 302c 206d 6178 6930 2c20 6d69 6e64  ni0, maxi0, mind
-0007a750: 6930 2c20 6d61 7864 6930 203d 2073 656c  i0, maxdi0 = sel
-0007a760: 662e 6765 7444 6174 6143 6c6f 7365 7374  f.getDataClosest
-0007a770: 546f 5265 6769 6f6e 2873 656c 662e 7265  ToRegion(self.re
-0007a780: 6769 6f6e 5f69 302c 7365 6c66 2e70 6c6f  gion_i0,self.plo
-0007a790: 7469 7465 6d29 0d0a 2020 2020 2020 2020  titem)..        
-0007a7a0: 6d69 6e69 2c20 6d61 7869 2c20 6d69 6e64  mini, maxi, mind
-0007a7b0: 692c 206d 6178 6469 203d 2073 656c 662e  i, maxdi = self.
-0007a7c0: 6765 7444 6174 6143 6c6f 7365 7374 546f  getDataClosestTo
-0007a7d0: 5265 6769 6f6e 2873 656c 662e 7265 6769  Region(self.regi
-0007a7e0: 6f6e 5f69 2c73 656c 662e 706c 6f74 6974  on_i,self.plotit
-0007a7f0: 656d 290d 0a20 2020 2020 2020 2023 7365  em)..        #se
-0007a800: 6c66 2e72 6567 696f 6e5f 6930 2e62 6c6f  lf.region_i0.blo
-0007a810: 636b 5369 676e 616c 7328 5472 7565 290d  ckSignals(True).
-0007a820: 0a20 2020 2020 2020 2023 7365 6c66 2e72  .        #self.r
-0007a830: 6567 696f 6e5f 692e 626c 6f63 6b53 6967  egion_i.blockSig
-0007a840: 6e61 6c73 2854 7275 6529 0d0a 2020 2020  nals(True)..    
-0007a850: 2020 2020 2373 656c 662e 7265 6769 6f6e      #self.region
-0007a860: 5f69 302e 7365 7442 6f75 6e64 7328 286d  _i0.setBounds((m
-0007a870: 696e 2873 656c 662e 706c 6f74 6974 656d  in(self.plotitem
-0007a880: 2e67 6574 4461 7461 2829 5b30 5d29 2c6d  .getData()[0]),m
-0007a890: 696e 6469 2929 0d0a 2020 2020 2020 2020  indi))..        
-0007a8a0: 2373 656c 662e 7265 6769 6f6e 5f69 2e73  #self.region_i.s
-0007a8b0: 6574 426f 756e 6473 2828 6d61 7864 6930  etBounds((maxdi0
-0007a8c0: 2c6d 6178 2873 656c 662e 706c 6f74 6974  ,max(self.plotit
+00072330: 6963 745b 6974 6865 7461 5d5b 2266 696c  ict[itheta]["fil
+00072340: 7465 7222 5d20 3d20 7365 6c66 2e73 7069  ter"] = self.spi
+00072350: 6e42 6f78 4669 6c74 6572 7369 7a65 2e76  nBoxFiltersize.v
+00072360: 616c 7565 2829 0d0a 2020 2020 2020 2020  alue()..        
+00072370: 7365 6c66 2e73 7461 636b 2e73 6869 6674  self.stack.shift
+00072380: 7364 6963 745b 6974 6865 7461 5d5b 226d  sdict[itheta]["m
+00072390: 6574 686f 6422 5d20 3d20 7365 6c66 2e63  ethod"] = self.c
+000723a0: 6f6d 626f 426f 785f 6170 7072 6f78 2e63  omboBox_approx.c
+000723b0: 7572 7265 6e74 496e 6465 7828 290d 0a20  urrentIndex().. 
+000723c0: 2020 2020 2020 2023 7072 696e 7428 7365         #print(se
+000723d0: 6c66 2e73 7461 636b 2e73 6869 6674 7364  lf.stack.shiftsd
+000723e0: 6963 745b 6974 6865 7461 5d5b 226d 6574  ict[itheta]["met
+000723f0: 686f 6422 5d29 0d0a 2020 2020 2020 2020  hod"])..        
+00072400: 2373 656c 662e 7374 6163 6b2e 7368 6966  #self.stack.shif
+00072410: 7473 6469 6374 5b69 7468 6574 615d 5b22  tsdict[itheta]["
+00072420: 6175 746f 7175 616c 6974 7922 5d20 3d20  autoquality"] = 
+00072430: 7365 6c66 2e63 625f 6175 746f 6572 726f  self.cb_autoerro
+00072440: 722e 6973 4368 6563 6b65 6428 290d 0a20  r.isChecked().. 
+00072450: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
+00072460: 6b2e 7368 6966 7473 6469 6374 5b69 7468  k.shiftsdict[ith
+00072470: 6574 615d 5b22 6578 7472 6170 6f6c 6174  eta]["extrapolat
+00072480: 696f 6e22 5d20 3d20 7365 6c66 2e63 625f  ion"] = self.cb_
+00072490: 6578 7472 6170 6f6c 6174 652e 6973 4368  extrapolate.isCh
+000724a0: 6563 6b65 6428 290d 0a20 2020 2020 2020  ecked()..       
+000724b0: 2073 656c 662e 7374 6163 6b2e 7368 6966   self.stack.shif
+000724c0: 7473 6469 6374 5b69 7468 6574 615d 5b22  tsdict[itheta]["
+000724d0: 7468 7265 7368 6f6c 6422 5d20 3d20 726f  threshold"] = ro
+000724e0: 756e 6428 6e70 2e6d 6561 6e28 7365 6c66  und(np.mean(self
+000724f0: 2e73 7461 636b 2e73 6869 6674 7364 6963  .stack.shiftsdic
+00072500: 745b 6974 6865 7461 5d5b 2265 7272 6f72  t[itheta]["error
+00072510: 7322 5d29 2c20 3429 0d0a 2020 2020 6465  s"]), 4)..    de
+00072520: 6620 7265 7374 6f72 6550 6172 616d 7328  f restoreParams(
+00072530: 7365 6c66 2c69 7468 6574 6129 3a0d 0a20  self,itheta):.. 
+00072540: 2020 2020 2020 2073 656c 662e 7872 6567         self.xreg
+00072550: 696f 6e2e 626c 6f63 6b53 6967 6e61 6c73  ion.blockSignals
+00072560: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
+00072570: 7365 6c66 2e79 7265 6769 6f6e 2e62 6c6f  self.yregion.blo
+00072580: 636b 5369 676e 616c 7328 5472 7565 290d  ckSignals(True).
+00072590: 0a20 2020 2020 2020 2073 656c 662e 6362  .        self.cb
+000725a0: 5f61 7574 6f65 7272 6f72 2e62 6c6f 636b  _autoerror.block
+000725b0: 5369 676e 616c 7328 5472 7565 290d 0a20  Signals(True).. 
+000725c0: 2020 2020 2020 2073 656c 662e 6362 5f65         self.cb_e
+000725d0: 7874 7261 706f 6c61 7465 2e62 6c6f 636b  xtrapolate.block
+000725e0: 5369 676e 616c 7328 5472 7565 290d 0a20  Signals(True).. 
+000725f0: 2020 2020 2020 2073 656c 662e 636f 6d62         self.comb
+00072600: 6f42 6f78 5f61 7070 726f 782e 626c 6f63  oBox_approx.bloc
+00072610: 6b53 6967 6e61 6c73 2854 7275 6529 0d0a  kSignals(True)..
+00072620: 2020 2020 2020 2020 7365 6c66 2e73 7069          self.spi
+00072630: 6e42 6f78 4669 6c74 6572 7369 7a65 2e62  nBoxFiltersize.b
+00072640: 6c6f 636b 5369 676e 616c 7328 5472 7565  lockSignals(True
+00072650: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+00072660: 662e 7872 6567 696f 6e2e 7365 7452 6567  f.xregion.setReg
+00072670: 696f 6e28 7365 6c66 2e73 7461 636b 2e73  ion(self.stack.s
+00072680: 6869 6674 7364 6963 745b 6974 6865 7461  hiftsdict[itheta
+00072690: 5d5b 2272 6567 696f 6e6c 696d 6974 7822  ]["regionlimitx"
+000726a0: 5d29 0d0a 2020 2020 2020 2020 7365 6c66  ])..        self
+000726b0: 2e79 7265 6769 6f6e 2e73 6574 5265 6769  .yregion.setRegi
+000726c0: 6f6e 2873 656c 662e 7374 6163 6b2e 7368  on(self.stack.sh
+000726d0: 6966 7473 6469 6374 5b69 7468 6574 615d  iftsdict[itheta]
+000726e0: 5b22 7265 6769 6f6e 6c69 6d69 7479 225d  ["regionlimity"]
+000726f0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00072700: 6362 5f61 7574 6f65 7272 6f72 2e73 6574  cb_autoerror.set
+00072710: 4368 6563 6b65 6428 7365 6c66 2e73 7461  Checked(self.sta
+00072720: 636b 2e73 6869 6674 7364 6963 745b 6974  ck.shiftsdict[it
+00072730: 6865 7461 5d5b 2261 7574 6f71 7561 6c69  heta]["autoquali
+00072740: 7479 225d 290d 0a20 2020 2020 2020 2073  ty"])..        s
+00072750: 656c 662e 7370 696e 426f 7845 7272 6f72  elf.spinBoxError
+00072760: 2e62 6c6f 636b 5369 676e 616c 7328 5472  .blockSignals(Tr
+00072770: 7565 290d 0a20 2020 2020 2020 2023 7365  ue)..        #se
+00072780: 6c66 2e73 7069 6e42 6f78 4572 726f 722e  lf.spinBoxError.
+00072790: 7365 7456 616c 7565 2873 656c 662e 7374  setValue(self.st
+000727a0: 6163 6b2e 7368 6966 7473 6469 6374 5b73  ack.shiftsdict[s
+000727b0: 656c 662e 6974 6865 7461 5d5b 2274 6872  elf.itheta]["thr
+000727c0: 6573 686f 6c64 225d 290d 0a20 2020 2020  eshold"])..     
+000727d0: 2020 2069 6620 7365 6c66 2e63 625f 6175     if self.cb_au
+000727e0: 746f 6572 726f 722e 6973 4368 6563 6b65  toerror.isChecke
+000727f0: 6428 2920 616e 6420 7365 6c66 2e61 6c69  d() and self.ali
+00072800: 676e 6564 3a0d 0a20 2020 2020 2020 2020  gned:..         
+00072810: 2020 2073 656c 662e 7370 696e 426f 7845     self.spinBoxE
+00072820: 7272 6f72 2e73 6574 456e 6162 6c65 6428  rror.setEnabled(
+00072830: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
+00072840: 2020 2073 656c 662e 7370 696e 426f 7845     self.spinBoxE
+00072850: 7272 6f72 2e73 6574 5661 6c75 6528 7365  rror.setValue(se
+00072860: 6c66 2e73 7461 636b 2e73 6869 6674 7364  lf.stack.shiftsd
+00072870: 6963 745b 7365 6c66 2e69 7468 6574 615d  ict[self.itheta]
+00072880: 5b22 7468 7265 7368 6f6c 6422 5d29 0d0a  ["threshold"])..
+00072890: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+000728a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000728b0: 7370 696e 426f 7845 7272 6f72 2e73 6574  spinBoxError.set
+000728c0: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
+000728d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000728e0: 2e73 7069 6e42 6f78 4572 726f 722e 7365  .spinBoxError.se
+000728f0: 7456 616c 7565 2831 290d 0a20 2020 2020  tValue(1)..     
+00072900: 2020 2073 656c 662e 7370 696e 426f 7845     self.spinBoxE
+00072910: 7272 6f72 2e62 6c6f 636b 5369 676e 616c  rror.blockSignal
+00072920: 7328 4661 6c73 6529 0d0a 2020 2020 2020  s(False)..      
+00072930: 2020 7365 6c66 2e63 625f 6578 7472 6170    self.cb_extrap
+00072940: 6f6c 6174 652e 7365 7443 6865 636b 6564  olate.setChecked
+00072950: 2873 656c 662e 7374 6163 6b2e 7368 6966  (self.stack.shif
+00072960: 7473 6469 6374 5b69 7468 6574 615d 5b22  tsdict[itheta]["
+00072970: 6578 7472 6170 6f6c 6174 696f 6e22 5d29  extrapolation"])
+00072980: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+00072990: 6f6d 626f 426f 785f 6170 7072 6f78 2e73  omboBox_approx.s
+000729a0: 6574 4375 7272 656e 7449 6e64 6578 2873  etCurrentIndex(s
+000729b0: 656c 662e 7374 6163 6b2e 7368 6966 7473  elf.stack.shifts
+000729c0: 6469 6374 5b69 7468 6574 615d 5b22 6d65  dict[itheta]["me
+000729d0: 7468 6f64 225d 290d 0a20 2020 2020 2020  thod"])..       
+000729e0: 2069 6620 7365 6c66 2e63 6f6d 626f 426f   if self.comboBo
+000729f0: 785f 6170 7072 6f78 2e63 7572 7265 6e74  x_approx.current
+00072a00: 496e 6465 7828 2920 3d3d 2030 3a0d 0a20  Index() == 0:.. 
+00072a10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00072a20: 7370 696e 426f 7846 696c 7465 7273 697a  spinBoxFiltersiz
+00072a30: 652e 7365 7445 6e61 626c 6564 2854 7275  e.setEnabled(Tru
+00072a40: 6529 0d0a 2020 2020 2020 2020 656c 6966  e)..        elif
+00072a50: 2073 656c 662e 636f 6d62 6f42 6f78 5f61   self.comboBox_a
+00072a60: 7070 726f 782e 6375 7272 656e 7449 6e64  pprox.currentInd
+00072a70: 6578 2829 203d 3d20 313a 2023 206c 696e  ex() == 1: # lin
+00072a80: 6561 7220 7265 6772 6573 7369 6f6e 0d0a  ear regression..
+00072a90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00072aa0: 2e73 7069 6e42 6f78 4669 6c74 6572 7369  .spinBoxFiltersi
+00072ab0: 7a65 2e73 6574 456e 6162 6c65 6428 4661  ze.setEnabled(Fa
+00072ac0: 6c73 6529 0d0a 2020 2020 2020 2020 7365  lse)..        se
+00072ad0: 6c66 2e73 7069 6e42 6f78 4669 6c74 6572  lf.spinBoxFilter
+00072ae0: 7369 7a65 2e73 6574 5661 6c75 6528 7365  size.setValue(se
+00072af0: 6c66 2e73 7461 636b 2e73 6869 6674 7364  lf.stack.shiftsd
+00072b00: 6963 745b 6974 6865 7461 5d5b 2266 696c  ict[itheta]["fil
+00072b10: 7465 7222 5d29 0d0a 2020 2020 2020 2020  ter"])..        
+00072b20: 2320 6966 206c 696d 6974 733a 0d0a 2020  # if limits:..  
+00072b30: 2020 2020 2020 2320 2020 2020 7265 6769        #     regi
+00072b40: 6f6e 2e73 6574 5265 6769 6f6e 286c 6973  on.setRegion(lis
+00072b50: 7428 6c69 6d69 7473 2929 0d0a 2020 2020  t(limits))..    
+00072b60: 2020 2020 2320 656c 7365 3a0d 0a20 2020      # else:..   
+00072b70: 2020 2020 2023 2020 2020 2072 6567 696f       #     regio
+00072b80: 6e2e 7365 7452 6567 696f 6e28 5b73 656c  n.setRegion([sel
+00072b90: 662e 7374 6163 6b2e 6576 5b30 5d2c 7365  f.stack.ev[0],se
+00072ba0: 6c66 2e73 7461 636b 2e65 765b 2d31 5d5d  lf.stack.ev[-1]]
+00072bb0: 290d 0a20 2020 2020 2020 2023 7365 6c66  )..        #self
+00072bc0: 2e73 7069 6e42 6f78 4572 726f 722e 626c  .spinBoxError.bl
+00072bd0: 6f63 6b53 6967 6e61 6c73 2846 616c 7365  ockSignals(False
+00072be0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00072bf0: 7872 6567 696f 6e2e 626c 6f63 6b53 6967  xregion.blockSig
+00072c00: 6e61 6c73 2846 616c 7365 290d 0a20 2020  nals(False)..   
+00072c10: 2020 2020 2073 656c 662e 7972 6567 696f       self.yregio
+00072c20: 6e2e 626c 6f63 6b53 6967 6e61 6c73 2846  n.blockSignals(F
+00072c30: 616c 7365 290d 0a20 2020 2020 2020 2073  alse)..        s
+00072c40: 656c 662e 6362 5f61 7574 6f65 7272 6f72  elf.cb_autoerror
+00072c50: 2e62 6c6f 636b 5369 676e 616c 7328 4661  .blockSignals(Fa
+00072c60: 6c73 6529 0d0a 2020 2020 2020 2020 7365  lse)..        se
+00072c70: 6c66 2e63 625f 6578 7472 6170 6f6c 6174  lf.cb_extrapolat
+00072c80: 652e 626c 6f63 6b53 6967 6e61 6c73 2846  e.blockSignals(F
+00072c90: 616c 7365 290d 0a20 2020 2020 2020 2073  alse)..        s
+00072ca0: 656c 662e 636f 6d62 6f42 6f78 5f61 7070  elf.comboBox_app
+00072cb0: 726f 782e 626c 6f63 6b53 6967 6e61 6c73  rox.blockSignals
+00072cc0: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
+00072cd0: 2073 656c 662e 7370 696e 426f 7846 696c   self.spinBoxFil
+00072ce0: 7465 7273 697a 652e 626c 6f63 6b53 6967  tersize.blockSig
+00072cf0: 6e61 6c73 2846 616c 7365 290d 0a0d 0a20  nals(False).... 
+00072d00: 2020 2064 6566 2067 6574 4461 7461 436c     def getDataCl
+00072d10: 6f73 6573 7454 6f52 6567 696f 6e28 7365  osestToRegion(se
+00072d20: 6c66 2c72 6567 696f 6e2c 706c 6f74 6974  lf,region,plotit
+00072d30: 656d 2c73 6e61 7072 6567 696f 6e3d 4661  em,snapregion=Fa
+00072d40: 6c73 6529 3a0d 0a20 2020 2020 2020 2073  lse):..        s
+00072d50: 656c 6563 7472 6567 696f 6e20 3d20 7b73  electregion = {s
+00072d60: 656c 662e 7872 6567 696f 6e20 3a20 2272  elf.xregion : "r
+00072d70: 6567 696f 6e6c 696d 6974 7822 2c20 7365  egionlimitx", se
+00072d80: 6c66 2e79 7265 6769 6f6e 203a 2022 7265  lf.yregion : "re
+00072d90: 6769 6f6e 6c69 6d69 7479 227d 0d0a 2020  gionlimity"}..  
+00072da0: 2020 2020 2020 6c69 6d69 7473 203d 2073        limits = s
+00072db0: 656c 6563 7472 6567 696f 6e5b 7265 6769  electregion[regi
+00072dc0: 6f6e 5d0d 0a20 2020 2020 2020 206d 696e  on]..        min
+00072dd0: 6964 782c 206d 6178 6964 7820 3d20 7265  idx, maxidx = re
+00072de0: 6769 6f6e 2e67 6574 5265 6769 6f6e 2829  gion.getRegion()
+00072df0: 0d0a 2020 2020 2020 2020 6461 7461 203d  ..        data =
+00072e00: 2070 6c6f 7469 7465 6d2e 6765 7444 6174   plotitem.getDat
+00072e10: 6128 295b 305d 0d0a 2020 2020 2020 2020  a()[0]..        
+00072e20: 696e 6465 7820 3d20 6c61 6d62 6461 2078  index = lambda x
+00072e30: 3a20 6e70 2e61 7267 6d69 6e28 6e70 2e61  : np.argmin(np.a
+00072e40: 6273 2864 6174 6120 2d20 7829 290d 0a20  bs(data - x)).. 
+00072e50: 2020 2020 2020 206d 696e 6964 7820 3d20         minidx = 
+00072e60: 696e 6465 7828 6d69 6e69 6478 290d 0a20  index(minidx).. 
+00072e70: 2020 2020 2020 206d 6178 6964 7820 3d20         maxidx = 
+00072e80: 696e 6465 7828 6d61 7869 6478 290d 0a20  index(maxidx).. 
+00072e90: 2020 2020 2020 2069 6620 6d69 6e69 6478         if minidx
+00072ea0: 203d 3d20 6d61 7869 6478 3a0d 0a20 2020   == maxidx:..   
+00072eb0: 2020 2020 2020 2020 206d 696e 6964 7820           minidx 
+00072ec0: 3d20 300d 0a20 2020 2020 2020 2020 2020  = 0..           
+00072ed0: 206d 6178 6964 7820 3d20 6e70 2e61 7267   maxidx = np.arg
+00072ee0: 6d61 7828 6461 7461 290d 0a20 2020 2020  max(data)..     
+00072ef0: 2020 206d 696e 6461 7461 203d 2064 6174     mindata = dat
+00072f00: 615b 6d69 6e69 6478 5d0d 0a20 2020 2020  a[minidx]..     
+00072f10: 2020 206d 6178 6461 7461 203d 2064 6174     maxdata = dat
+00072f20: 615b 6d61 7869 6478 5d0d 0a20 2020 2020  a[maxidx]..     
+00072f30: 2020 2069 6620 736e 6170 7265 6769 6f6e     if snapregion
+00072f40: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00072f50: 656c 662e 7374 6163 6b2e 7368 6966 7473  elf.stack.shifts
+00072f60: 6469 6374 5b73 656c 662e 6974 6865 7461  dict[self.itheta
+00072f70: 5d5b 6c69 6d69 7473 5d20 3d20 286d 696e  ][limits] = (min
+00072f80: 6461 7461 2c6d 6178 6461 7461 2920 2023  data,maxdata)  #
+00072f90: 2073 6e61 7020 7265 6769 6f6e 2074 6f20   snap region to 
+00072fa0: 6461 7461 2070 6f69 6e74 730d 0a20 2020  data points..   
+00072fb0: 2020 2020 2020 2020 2072 6567 696f 6e2e           region.
+00072fc0: 7365 7452 6567 696f 6e28 286d 696e 6461  setRegion((minda
+00072fd0: 7461 2c6d 6178 6461 7461 2929 0d0a 2020  ta,maxdata))..  
+00072fe0: 2020 2020 2020 7265 7475 726e 206d 696e        return min
+00072ff0: 6964 782c 206d 6178 6964 782c 206d 696e  idx, maxidx, min
+00073000: 6461 7461 2c20 6d61 7864 6174 610d 0a20  data, maxdata.. 
+00073010: 2020 200d 0a20 2020 2064 6566 2041 7070     ..    def App
+00073020: 6c79 4170 7072 6f78 696d 6174 696f 6e46  lyApproximationF
+00073030: 756e 6374 696f 6e28 7365 6c66 2c72 6567  unction(self,reg
+00073040: 696f 6e29 3a0d 0a20 2020 2020 2020 2062  ion):..        b
+00073050: 6f6f 6c61 7272 6179 203d 2073 656c 662e  oolarray = self.
+00073060: 4d61 736b 6564 5363 6174 7465 7244 6f74  MaskedScatterDot
+00073070: 7341 7272 6179 2872 6567 696f 6e29 0d0a  sArray(region)..
+00073080: 2020 2020 2020 2020 7365 6c65 6374 7363          selectsc
+00073090: 6174 7465 7220 3d20 7b73 656c 662e 7872  atter = {self.xr
+000730a0: 6567 696f 6e3a 205b 7365 6c66 2e78 7363  egion: [self.xsc
+000730b0: 6174 7465 722c 2022 7822 5d20 2c20 7365  atter, "x"] , se
+000730c0: 6c66 2e79 7265 6769 6f6e 3a20 5b73 656c  lf.yregion: [sel
+000730d0: 662e 7973 6361 7474 6572 2c20 2279 225d  f.yscatter, "y"]
+000730e0: 7d0d 0a20 2020 2020 2020 2073 656c 6563  }..        selec
+000730f0: 7466 6974 3d20 7b73 656c 662e 7872 6567  tfit= {self.xreg
+00073100: 696f 6e20 3a20 7365 6c66 2e66 6974 5f78  ion : self.fit_x
+00073110: 2c20 7365 6c66 2e79 7265 6769 6f6e 203a  , self.yregion :
+00073120: 2073 656c 662e 6669 745f 797d 0d0a 2020   self.fit_y}..  
+00073130: 2020 2020 2020 7363 6174 7465 7220 3d20        scatter = 
+00073140: 7365 6c65 6374 7363 6174 7465 725b 7265  selectscatter[re
+00073150: 6769 6f6e 5d5b 305d 0d0a 2020 2020 2020  gion][0]..      
+00073160: 2020 6669 7420 3d20 7365 6c65 6374 6669    fit = selectfi
+00073170: 745b 7265 6769 6f6e 5d0d 0a20 2020 2020  t[region]..     
+00073180: 2020 2023 6d69 6e5f 6964 782c 206d 6178     #min_idx, max
+00073190: 5f69 6478 2c20 2a5f 203d 2073 656c 662e  _idx, *_ = self.
+000731a0: 6765 7444 6174 6143 6c6f 7365 7374 546f  getDataClosestTo
+000731b0: 5265 6769 6f6e 2872 6567 696f 6e2c 7363  Region(region,sc
+000731c0: 6174 7465 7229 0d0a 2020 2020 2020 2020  atter)..        
+000731d0: 7365 6c65 6374 6564 203d 206e 702e 636f  selected = np.co
+000731e0: 756e 745f 6e6f 6e7a 6572 6f28 626f 6f6c  unt_nonzero(bool
+000731f0: 6172 7261 7920 3d3d 2046 616c 7365 290d  array == False).
+00073200: 0a20 2020 2020 2020 2078 6461 7461 2c20  .        xdata, 
+00073210: 7964 6174 6120 3d20 7363 6174 7465 722e  ydata = scatter.
+00073220: 6765 7444 6174 6128 290d 0a20 2020 2020  getData()..     
+00073230: 2020 2023 7864 6174 6120 3d20 7864 6174     #xdata = xdat
+00073240: 615b 6d69 6e5f 6964 783a 6d61 785f 6964  a[min_idx:max_id
+00073250: 785d 0d0a 2020 2020 2020 2020 7864 6174  x]..        xdat
+00073260: 6120 3d20 7864 6174 615b 7e62 6f6f 6c61  a = xdata[~boola
+00073270: 7272 6179 5d0d 0a20 2020 2020 2020 2023  rray]..        #
+00073280: 7964 6174 6120 3d20 7964 6174 615b 6d69  ydata = ydata[mi
+00073290: 6e5f 6964 783a 6d61 785f 6964 785d 0d0a  n_idx:max_idx]..
+000732a0: 2020 2020 2020 2020 7964 6174 6120 3d20          ydata = 
+000732b0: 7964 6174 615b 7e62 6f6f 6c61 7272 6179  ydata[~boolarray
+000732c0: 5d0d 0a20 2020 2020 2020 2023 7072 696e  ]..        #prin
+000732d0: 7428 7365 6c65 6374 6564 290d 0a20 2020  t(selected)..   
+000732e0: 2020 2020 2069 6620 7365 6c65 6374 6564       if selected
+000732f0: 203c 2032 3a0d 0a20 2020 2020 2020 2020   < 2:..         
+00073300: 2020 2051 7457 6964 6765 7473 2e51 4d65     QtWidgets.QMe
+00073310: 7373 6167 6542 6f78 2e77 6172 6e69 6e67  ssageBox.warning
+00073320: 2873 656c 662c 2027 4572 726f 7227 2c20  (self, 'Error', 
+00073330: 2753 656c 6563 7420 6174 206c 6561 7374  'Select at least
+00073340: 2074 776f 2069 6d61 6765 7320 696e 207b   two images in {
+00073350: 7d2d 6469 7265 6374 696f 6e21 272e 666f  }-direction!'.fo
+00073360: 726d 6174 2873 656c 6563 7473 6361 7474  rmat(selectscatt
+00073370: 6572 5b72 6567 696f 6e5d 5b31 5d29 290d  er[region][1])).
+00073380: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00073390: 7572 6e20 5b5d 0d0a 2020 2020 2020 2020  urn []..        
+000733a0: 6966 2073 656c 662e 636f 6d62 6f42 6f78  if self.comboBox
+000733b0: 5f61 7070 726f 782e 6375 7272 656e 7449  _approx.currentI
+000733c0: 6e64 6578 2829 203d 3d20 303a 2023 206d  ndex() == 0: # m
+000733d0: 6f76 696e 6720 6176 6572 6167 650d 0a20  oving average.. 
+000733e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000733f0: 7370 696e 426f 7846 696c 7465 7273 697a  spinBoxFiltersiz
+00073400: 652e 7365 7445 6e61 626c 6564 2854 7275  e.setEnabled(Tru
+00073410: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00073420: 6170 7072 6f78 696d 6174 6564 3d20 6e64  approximated= nd
+00073430: 696d 6167 652e 6669 6c74 6572 732e 756e  image.filters.un
+00073440: 6966 6f72 6d5f 6669 6c74 6572 3164 2879  iform_filter1d(y
+00073450: 6461 7461 2c73 656c 662e 7370 696e 426f  data,self.spinBo
+00073460: 7846 696c 7465 7273 697a 652e 7661 6c75  xFiltersize.valu
+00073470: 6528 292c 6d6f 6465 203d 2022 6e65 6172  e(),mode = "near
+00073480: 6573 7422 290d 0a20 2020 2020 2020 2065  est")..        e
+00073490: 6c69 6620 7365 6c66 2e63 6f6d 626f 426f  lif self.comboBo
+000734a0: 785f 6170 7072 6f78 2e63 7572 7265 6e74  x_approx.current
+000734b0: 496e 6465 7828 2920 3d3d 2031 3a20 2320  Index() == 1: # 
+000734c0: 6c69 6e65 6172 2072 6567 7265 7373 696f  linear regressio
+000734d0: 6e0d 0a20 2020 2020 2020 2020 2020 2073  n..            s
+000734e0: 656c 662e 7370 696e 426f 7846 696c 7465  elf.spinBoxFilte
+000734f0: 7273 697a 652e 7365 7445 6e61 626c 6564  rsize.setEnabled
+00073500: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
+00073510: 2020 2020 2072 6567 203d 206c 696e 7265       reg = linre
+00073520: 6772 6573 7328 5b78 6461 7461 2c79 6461  gress([xdata,yda
+00073530: 7461 5d29 0d0a 2020 2020 2020 2020 2020  ta])..          
+00073540: 2020 6170 7072 6f78 696d 6174 6564 203d    approximated =
+00073550: 205b 7265 672e 736c 6f70 6520 2a20 6920   [reg.slope * i 
+00073560: 2b20 7265 672e 696e 7465 7263 6570 7420  + reg.intercept 
+00073570: 666f 7220 6920 696e 2078 6461 7461 5d0d  for i in xdata].
+00073580: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
+00073590: 6c66 2e63 625f 6578 7472 6170 6f6c 6174  lf.cb_extrapolat
+000735a0: 652e 6973 4368 6563 6b65 6428 293a 0d0a  e.isChecked():..
+000735b0: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
+000735c0: 7661 6c3d 2022 6578 7472 6170 6f6c 6174  val= "extrapolat
+000735d0: 6522 0d0a 2020 2020 2020 2020 656c 7365  e"..        else
+000735e0: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
+000735f0: 696c 6c76 616c 3d28 6170 7072 6f78 696d  illval=(approxim
+00073600: 6174 6564 5b30 5d2c 6170 7072 6f78 696d  ated[0],approxim
+00073610: 6174 6564 5b2d 315d 290d 0a0d 0a20 2020  ated[-1])....   
+00073620: 2020 2020 2069 6e74 6572 706f 6c61 7465       interpolate
+00073630: 5f66 756e 6320 3d20 696e 7465 7270 3164  _func = interp1d
+00073640: 2878 6461 7461 2c20 6170 7072 6f78 696d  (xdata, approxim
+00073650: 6174 6564 2c6b 696e 643d 226c 696e 6561  ated,kind="linea
+00073660: 7222 2c66 696c 6c5f 7661 6c75 653d 6669  r",fill_value=fi
+00073670: 6c6c 7661 6c2c 626f 756e 6473 5f65 7272  llval,bounds_err
+00073680: 6f72 3d46 616c 7365 290d 0a20 2020 2020  or=False)..     
+00073690: 2020 2066 6974 6461 7461 203d 205b 7365     fitdata = [se
+000736a0: 6c66 2e73 7461 636b 2e65 762c 6e70 2e61  lf.stack.ev,np.a
+000736b0: 726f 756e 6428 696e 7465 7270 6f6c 6174  round(interpolat
+000736c0: 655f 6675 6e63 2873 656c 662e 7374 6163  e_func(self.stac
+000736d0: 6b2e 6576 292c 3129 5d20 2320 726f 756e  k.ev),1)] # roun
+000736e0: 6420 6669 7420 746f 2061 2074 656e 7468  d fit to a tenth
+000736f0: 206f 6620 6120 7078 0d0a 2020 2020 2020   of a px..      
+00073700: 2020 6669 742e 7365 7444 6174 6128 783d    fit.setData(x=
+00073710: 6669 7464 6174 615b 305d 2c20 793d 6669  fitdata[0], y=fi
+00073720: 7464 6174 615b 315d 290d 0a20 2020 2020  tdata[1])..     
+00073730: 2020 2066 6974 2e73 686f 7728 290d 0a20     fit.show().. 
+00073740: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
+00073750: 7464 6174 615b 315d 0d0a 0d0a 2020 2020  tdata[1]....    
+00073760: 6465 6620 7265 7365 7450 6f6f 6c54 6872  def resetPoolThr
+00073770: 6561 6428 7365 6c66 293a 0d0a 2020 2020  ead(self):..    
+00073780: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
+00073790: 2020 2020 2020 7365 6c66 2e70 6f6f 6c74        self.poolt
+000737a0: 6872 6561 642e 7374 6172 7465 642e 6469  hread.started.di
+000737b0: 7363 6f6e 6e65 6374 2829 0d0a 2020 2020  sconnect()..    
+000737c0: 2020 2020 2020 2020 7365 6c66 2e70 6f6f          self.poo
+000737d0: 6c74 6872 6561 642e 7175 6974 2829 0d0a  lthread.quit()..
+000737e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000737f0: 2e70 6f6f 6c74 6872 6561 642e 7761 6974  .poolthread.wait
+00073800: 2829 0d0a 2020 2020 2020 2020 6578 6365  ()..        exce
+00073810: 7074 3a0d 0a20 2020 2020 2020 2020 2020  pt:..           
+00073820: 2070 6173 730d 0a20 2020 2020 2020 2073   pass..        s
+00073830: 656c 662e 706f 6f6c 203d 2054 6173 6b44  elf.pool = TaskD
+00073840: 6973 7061 7463 6865 7228 7365 6c66 290d  ispatcher(self).
+00073850: 0a20 2020 2020 2020 2073 656c 662e 706f  .        self.po
+00073860: 6f6c 2e6d 6f76 6554 6f54 6872 6561 6428  ol.moveToThread(
+00073870: 7365 6c66 2e70 6f6f 6c74 6872 6561 6429  self.poolthread)
+00073880: 2023 2047 5549 2069 7320 6e6f 7420 626c   # GUI is not bl
+00073890: 6f63 6b69 6e67 2064 7572 696e 6720 6361  ocking during ca
+000738a0: 6c63 756c 6174 696f 6e20 6475 6520 746f  lculation due to
+000738b0: 2074 6869 730d 0a20 2020 2020 2020 2073   this..        s
+000738c0: 656c 662e 706f 6f6c 7468 7265 6164 2e73  elf.poolthread.s
+000738d0: 7461 7274 6564 2e63 6f6e 6e65 6374 2873  tarted.connect(s
+000738e0: 656c 662e 706f 6f6c 2e72 756e 290d 0a0d  elf.pool.run)...
+000738f0: 0a20 2020 2064 6566 2049 5468 6574 6150  .    def IThetaP
+00073900: 726f 6772 6573 7328 7365 6c66 2c69 7468  rogress(self,ith
+00073910: 6574 6129 3a0d 0a20 2020 2020 2020 2023  eta):..        #
+00073920: 7072 696e 7428 2269 7468 6574 6170 726f  print("ithetapro
+00073930: 6772 6573 7322 290d 0a20 2020 2020 2020  gress")..       
+00073940: 2023 2045 6163 6820 7468 7265 6164 2063   # Each thread c
+00073950: 616c 6c73 2074 6869 7320 6675 6e63 7469  alls this functi
+00073960: 6f6e 2e20 5468 6520 636f 6e64 6974 696f  on. The conditio
+00073970: 6e20 7072 6576 656e 7473 206d 756c 7469  n prevents multi
+00073980: 706c 6520 6361 6c6c 732e 0d0a 2020 2020  ple calls...    
+00073990: 2020 2020 6966 2073 656c 662e 736c 6964      if self.slid
+000739a0: 6572 5f74 6865 7461 2e76 616c 7565 2829  er_theta.value()
+000739b0: 2021 3d20 6974 6865 7461 3a0d 0a20 2020   != itheta:..   
+000739c0: 2020 2020 2020 2020 2023 7365 6c66 2e73           #self.s
+000739d0: 6c69 6465 725f 7468 6574 612e 626c 6f63  lider_theta.bloc
+000739e0: 6b53 6967 6e61 6c73 2854 7275 6529 0d0a  kSignals(True)..
+000739f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00073a00: 2e73 6c69 6465 725f 7468 6574 612e 7365  .slider_theta.se
+00073a10: 7456 616c 7565 2869 7468 6574 6129 0d0a  tValue(itheta)..
+00073a20: 2020 2020 2020 2020 2020 2020 2373 656c              #sel
+00073a30: 662e 736c 6964 6572 5f74 6865 7461 2e62  f.slider_theta.b
+00073a40: 6c6f 636b 5369 676e 616c 7328 4661 6c73  lockSignals(Fals
+00073a50: 6529 0d0a 2020 2020 2020 2020 2370 7269  e)..        #pri
+00073a60: 6e74 2873 656c 662e 706f 6f6c 2e70 6f6f  nt(self.pool.poo
+00073a70: 6c2e 6163 7469 7665 5468 7265 6164 436f  l.activeThreadCo
+00073a80: 756e 7428 2929 0d0a 0d0a 2020 2020 6465  unt())....    de
+00073a90: 6620 5468 7265 6164 506f 6f6c 436f 6d70  f ThreadPoolComp
+00073aa0: 6c65 7465 2873 656c 6629 3a0d 0a20 2020  lete(self):..   
+00073ab0: 2020 2020 2023 7072 696e 7428 7374 7228       #print(str(
+00073ac0: 7365 6c66 2e70 6f6f 6c2e 706f 6f6c 2e61  self.pool.pool.a
+00073ad0: 6374 6976 6554 6872 6561 6443 6f75 6e74  ctiveThreadCount
+00073ae0: 2829 292b 2220 5448 5245 4144 5320 5245  ())+" THREADS RE
+00073af0: 4d41 494e 494e 4720 4652 4f4d 2050 4f4f  MAINING FROM POO
+00073b00: 4c2e 2229 0d0a 2020 2020 2020 2020 2373  L.")..        #s
+00073b10: 656c 662e 736c 6964 6572 5f74 6865 7461  elf.slider_theta
+00073b20: 2e73 6574 5661 6c75 6528 3029 0d0a 2020  .setValue(0)..  
+00073b30: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00073b40: 662e 616c 6967 6e65 6420 616e 6420 7365  f.aligned and se
+00073b50: 6c66 2e70 6f6f 6c2e 706f 6f6c 2e61 6374  lf.pool.pool.act
+00073b60: 6976 6554 6872 6561 6443 6f75 6e74 2829  iveThreadCount()
+00073b70: 203d 3d20 303a 0d0a 2020 2020 2020 2020   == 0:..        
+00073b80: 2020 2020 7365 6c66 2e4f 6e41 6c69 676e      self.OnAlign
+00073b90: 6564 2829 0d0a 0d0a 2020 2020 2020 2020  ed()....        
+00073ba0: 656c 6966 2073 656c 662e 616c 6967 6e65  elif self.aligne
+00073bb0: 6420 616e 6420 7365 6c66 2e70 6f6f 6c2e  d and self.pool.
+00073bc0: 706f 6f6c 2e61 6374 6976 6554 6872 6561  pool.activeThrea
+00073bd0: 6443 6f75 6e74 2829 203d 3d20 303a 0d0a  dCount() == 0:..
+00073be0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00073bf0: 2e4f 6e41 7574 6f43 726f 7028 290d 0a0d  .OnAutoCrop()...
+00073c00: 0a20 2020 2064 6566 2043 6f6d 706f 7365  .    def Compose
+00073c10: 416c 6967 6e51 7565 7565 2873 656c 6629  AlignQueue(self)
+00073c20: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+00073c30: 6275 7474 6f6e 5f61 6c69 676e 2e73 6574  button_align.set
+00073c40: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
+00073c50: 2020 2020 2020 2020 7265 665f 6964 7820          ref_idx 
+00073c60: 3d20 7365 6c66 2e69 6576 0d0a 2020 2020  = self.iev..    
+00073c70: 2020 2020 2320 5265 7365 7420 7265 6665      # Reset refe
+00073c80: 7265 6e63 6520 696d 673a 0d0a 2020 2020  rence img:..    
+00073c90: 2020 2020 7365 6c66 2e72 6573 6574 506f      self.resetPo
+00073ca0: 6f6c 5468 7265 6164 2829 0d0a 0d0a 2020  olThread()....  
+00073cb0: 2020 2020 2020 6974 6865 7461 203d 2030        itheta = 0
+00073cc0: 0d0a 2020 2020 2020 2020 6e74 6865 7461  ..        ntheta
+00073cd0: 203d 206d 6178 2873 656c 662e 7374 6163   = max(self.stac
+00073ce0: 6b2e 6e5f 7468 6574 612c 3129 2023 206e  k.n_theta,1) # n
+00073cf0: 6563 6573 7361 7279 2077 6f72 6b20 6172  ecessary work ar
+00073d00: 6f75 6e64 2066 6f72 2033 6420 7374 6163  ound for 3d stac
+00073d10: 6b73 2061 6e64 2069 6620 3464 2073 7461  ks and if 4d sta
+00073d20: 636b 2069 7320 6c6f 6164 6564 2077 6974  ck is loaded wit
+00073d30: 6820 4c6f 6164 5374 6163 6b28 290d 0a20  h LoadStack().. 
+00073d40: 2020 2020 2020 2077 6869 6c65 2069 7468         while ith
+00073d50: 6574 6120 3c20 6e74 6865 7461 3a0d 0a20  eta < ntheta:.. 
+00073d60: 2020 2020 2020 2020 2020 2069 6478 203d             idx =
+00073d70: 2063 6f70 792e 636f 7079 2873 656c 662e   copy.copy(self.
+00073d80: 7374 6163 6b2e 6e5f 6576 290d 0a20 2020  stack.n_ev)..   
+00073d90: 2020 2020 2020 2020 2077 6869 6c65 2069           while i
+00073da0: 6478 3a20 2320 4765 6e65 7261 7465 2070  dx: # Generate p
+00073db0: 6169 7273 206f 6620 696e 6469 6365 7320  airs of indices 
+00073dc0: 7374 6172 7469 6e67 2061 7420 7265 6665  starting at refe
+00073dd0: 7265 6e63 6520 696d 6167 6520 696e 6465  rence image inde
+00073de0: 782e 0d0a 2020 2020 2020 2020 2020 2020  x...            
+00073df0: 2020 2020 7275 6e6e 696e 6720 3d20 320d      running = 2.
+00073e00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00073e10: 2069 6620 2872 6566 5f69 6478 202b 2028   if (ref_idx + (
+00073e20: 7365 6c66 2e73 7461 636b 2e6e 5f65 762d  self.stack.n_ev-
+00073e30: 6964 7829 2920 3c20 7365 6c66 2e73 7461  idx)) < self.sta
+00073e40: 636b 2e6e 5f65 762d 313a 0d0a 2020 2020  ck.n_ev-1:..    
+00073e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00073e60: 7365 6c66 2e70 6f6f 6c2e 656e 7175 6575  self.pool.enqueu
+00073e70: 6574 6173 6b28 2241 6c69 676e 5265 6665  etask("AlignRefe
+00073e80: 7265 6e63 6564 222c 2028 7265 665f 6964  renced", (ref_id
+00073e90: 7820 2b20 2873 656c 662e 7374 6163 6b2e  x + (self.stack.
+00073ea0: 6e5f 6576 2d69 6478 2920 2b20 312c 2072  n_ev-idx) + 1, r
+00073eb0: 6566 5f69 6478 292c 2069 7468 6574 6129  ef_idx), itheta)
+00073ec0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00073ed0: 2020 2020 2020 2371 2e70 7574 2828 7265        #q.put((re
+00073ee0: 665f 6964 7820 2b20 2873 656c 662e 7374  f_idx + (self.st
+00073ef0: 6163 6b2e 6e5f 6576 2d69 6478 2920 2b20  ack.n_ev-idx) + 
+00073f00: 312c 2072 6566 5f69 6478 2929 0d0a 2020  1, ref_idx))..  
+00073f10: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00073f20: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00073f30: 2020 2020 2020 2020 2072 756e 6e69 6e67           running
+00073f40: 202d 3d20 310d 0a20 2020 2020 2020 2020   -= 1..         
+00073f50: 2020 2020 2020 2069 6620 7265 665f 6964         if ref_id
+00073f60: 7820 2d20 2873 656c 662e 7374 6163 6b2e  x - (self.stack.
+00073f70: 6e5f 6576 2d69 6478 2920 3e20 303a 0d0a  n_ev-idx) > 0:..
+00073f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00073f90: 2020 2020 7365 6c66 2e70 6f6f 6c2e 656e      self.pool.en
+00073fa0: 7175 6575 6574 6173 6b28 2241 6c69 676e  queuetask("Align
+00073fb0: 5265 6665 7265 6e63 6564 222c 2028 7265  Referenced", (re
+00073fc0: 665f 6964 7820 2d20 2873 656c 662e 7374  f_idx - (self.st
+00073fd0: 6163 6b2e 6e5f 6576 2d69 6478 2920 2d20  ack.n_ev-idx) - 
+00073fe0: 312c 2072 6566 5f69 6478 292c 2069 7468  1, ref_idx), ith
+00073ff0: 6574 6129 0d0a 2020 2020 2020 2020 2020  eta)..          
+00074000: 2020 2020 2020 2020 2020 2371 2e70 7574            #q.put
+00074010: 2828 2872 6566 5f69 6478 202d 2028 7365  (((ref_idx - (se
+00074020: 6c66 2e73 7461 636b 2e6e 5f65 762d 6964  lf.stack.n_ev-id
+00074030: 7829 202d 2031 292c 7265 665f 6964 7829  x) - 1),ref_idx)
+00074040: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00074050: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00074060: 2020 2020 2020 2020 2020 2020 2020 7275                ru
+00074070: 6e6e 696e 6720 2d3d 2031 0d0a 2020 2020  nning -= 1..    
+00074080: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00074090: 756e 6e69 6e67 3a0d 0a20 2020 2020 2020  unning:..       
+000740a0: 2020 2020 2020 2020 2020 2020 2069 6478               idx
+000740b0: 202d 3d20 310d 0a20 2020 2020 2020 2020   -= 1..         
+000740c0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+000740d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000740e0: 2020 6272 6561 6b0d 0a20 2020 2020 2020    break..       
+000740f0: 2020 2020 2069 7468 6574 6120 3d20 6974       itheta = it
+00074100: 6865 7461 202b 2031 0d0a 2020 2020 2020  heta + 1..      
+00074110: 2020 6966 206e 6f74 2073 656c 662e 706f    if not self.po
+00074120: 6f6c 2e71 7565 7565 2e65 6d70 7479 2829  ol.queue.empty()
+00074130: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
+00074140: 7269 6e74 2822 746f 7461 6c20 616c 6967  rint("total alig
+00074150: 6e71 7565 7565 2063 6f6d 706f 7365 642e  nqueue composed.
+00074160: 2073 7461 7274 696e 6720 706f 6f6c 7468   starting poolth
+00074170: 7265 6164 2229 0d0a 2020 2020 2020 2020  read")..        
+00074180: 2020 2020 7365 6c66 2e70 6f6f 6c74 6872      self.poolthr
+00074190: 6561 642e 7374 6172 7428 290d 0a20 2020  ead.start()..   
+000741a0: 2020 2020 200d 0a20 2020 2064 6566 2043       ..    def C
+000741b0: 6f6d 706f 7365 5368 6966 7451 7565 7565  omposeShiftQueue
+000741c0: 2873 656c 662c 2069 6e69 743d 4661 6c73  (self, init=Fals
+000741d0: 6529 3a0d 0a20 2020 2020 2020 2070 7269  e):..        pri
+000741e0: 6e74 2822 636f 6d70 6f73 6573 6869 6674  nt("composeshift
+000741f0: 2069 6e69 7469 616c 3f22 2c73 7472 2869   initial?",str(i
+00074200: 6e69 7429 290d 0a20 2020 2020 2020 2073  nit))..        s
+00074210: 656c 662e 7265 7365 7450 6f6f 6c54 6872  elf.resetPoolThr
+00074220: 6561 6428 290d 0a20 2020 2020 2020 2023  ead()..        #
+00074230: 6172 7261 7920 3d20 6e70 2e6c 6f67 6963  array = np.logic
+00074240: 616c 5f6f 7228 7365 6c66 2e4d 6173 6b65  al_or(self.Maske
+00074250: 6453 6361 7474 6572 446f 7473 4172 7261  dScatterDotsArra
+00074260: 7928 7365 6c66 2e78 7265 6769 6f6e 292c  y(self.xregion),
+00074270: 7365 6c66 2e4d 6173 6b65 6453 6361 7474  self.MaskedScatt
+00074280: 6572 446f 7473 4172 7261 7928 7365 6c66  erDotsArray(self
+00074290: 2e79 7265 6769 6f6e 2929 0d0a 2020 2020  .yregion))..    
+000742a0: 2020 2020 6966 206e 6f74 2069 6e69 743a      if not init:
+000742b0: 0d0a 2020 2020 2020 2020 2020 2020 6e74  ..            nt
+000742c0: 6865 7461 203d 205b 7365 6c66 2e69 7468  heta = [self.ith
+000742d0: 6574 615d 0d0a 2020 2020 2020 2020 656c  eta]..        el
+000742e0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+000742f0: 206e 7468 6574 6120 3d20 7261 6e67 6528   ntheta = range(
+00074300: 6d61 7828 7365 6c66 2e73 7461 636b 2e6e  max(self.stack.n
+00074310: 5f74 6865 7461 2c31 2929 2023 206e 6563  _theta,1)) # nec
+00074320: 6573 7361 7279 2077 6f72 6b20 6172 6f75  essary work arou
+00074330: 6e64 2066 6f72 2033 6420 7374 6163 6b73  nd for 3d stacks
+00074340: 2061 6e64 2069 6620 3464 2073 7461 636b   and if 4d stack
+00074350: 2069 7320 6c6f 6164 6564 2077 6974 6820   is loaded with 
+00074360: 4c6f 6164 5374 6163 6b28 290d 0a20 2020  LoadStack()..   
+00074370: 2020 2020 2020 2020 2066 6f72 2069 7468           for ith
+00074380: 6574 6120 696e 206e 7468 6574 613a 0d0a  eta in ntheta:..
+00074390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000743a0: 7365 6c66 2e69 6e69 7450 6172 616d 7328  self.initParams(
+000743b0: 6974 6865 7461 290d 0a20 2020 2020 2020  itheta)..       
+000743c0: 2066 6f72 2069 7468 6574 6120 696e 206e   for itheta in n
+000743d0: 7468 6574 613a 0d0a 2020 2020 2020 2020  theta:..        
+000743e0: 2020 2020 2370 7269 6e74 2869 7468 6574      #print(ithet
+000743f0: 6129 0d0a 2020 2020 2020 2020 2020 2020  a)..            
+00074400: 7365 6c66 2e73 7461 636b 2e73 6869 6674  self.stack.shift
+00074410: 7364 6963 745b 7365 6c66 2e69 7468 6574  sdict[self.ithet
+00074420: 615d 5b22 6669 6c74 6572 225d 203d 2073  a]["filter"] = s
+00074430: 656c 662e 7370 696e 426f 7846 696c 7465  elf.spinBoxFilte
+00074440: 7273 697a 652e 7661 6c75 6528 290d 0a20  rsize.value().. 
+00074450: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00074460: 7374 6163 6b2e 7368 6966 7473 6469 6374  stack.shiftsdict
+00074470: 5b73 656c 662e 6974 6865 7461 5d5b 226d  [self.itheta]["m
+00074480: 6574 686f 6422 5d20 3d20 7365 6c66 2e63  ethod"] = self.c
+00074490: 6f6d 626f 426f 785f 6170 7072 6f78 2e63  omboBox_approx.c
+000744a0: 7572 7265 6e74 496e 6465 7828 290d 0a20  urrentIndex().. 
+000744b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000744c0: 736c 6964 6572 5f74 6865 7461 2e73 6574  slider_theta.set
+000744d0: 5661 6c75 6528 6974 6865 7461 290d 0a20  Value(itheta).. 
+000744e0: 2020 2020 2020 2020 2020 2023 7469 6d65             #time
+000744f0: 2e73 6c65 6570 2830 2e32 290d 0a20 2020  .sleep(0.2)..   
+00074500: 2020 2020 2020 2020 2078 7368 6966 7473           xshifts
+00074510: 203d 2073 656c 662e 4170 706c 7941 7070   = self.ApplyApp
+00074520: 726f 7869 6d61 7469 6f6e 4675 6e63 7469  roximationFuncti
+00074530: 6f6e 2873 656c 662e 7872 6567 696f 6e29  on(self.xregion)
+00074540: 0d0a 2020 2020 2020 2020 2020 2020 7973  ..            ys
+00074550: 6869 6674 7320 3d20 7365 6c66 2e41 7070  hifts = self.App
+00074560: 6c79 4170 7072 6f78 696d 6174 696f 6e46  lyApproximationF
+00074570: 756e 6374 696f 6e28 7365 6c66 2e79 7265  unction(self.yre
+00074580: 6769 6f6e 290d 0a20 2020 2020 2020 2020  gion)..         
+00074590: 2020 2023 2069 6620 656d 7074 7920 6172     # if empty ar
+000745a0: 7261 7973 2c20 692e 652e 2c20 6966 206c  rays, i.e., if l
+000745b0: 6573 7320 7468 616e 2032 2064 6f74 7320  ess than 2 dots 
+000745c0: 7365 6c65 6374 6564 2c20 646f 206e 6f74  selected, do not
+000745d0: 6869 6e67 0d0a 2020 2020 2020 2020 2020  hing..          
+000745e0: 2020 6966 205b 5d20 696e 2028 7873 6869    if [] in (xshi
+000745f0: 6674 732c 2079 7368 6966 7473 293a 0d0a  fts, yshifts):..
+00074600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00074610: 7265 7475 726e 0d0a 2020 2020 2020 2020  return..        
+00074620: 2020 2020 666f 7220 6576 2069 6e20 7261      for ev in ra
+00074630: 6e67 6528 7365 6c66 2e73 7461 636b 2e6e  nge(self.stack.n
+00074640: 5f65 7629 3a0d 0a20 2020 2020 2020 2020  _ev):..         
+00074650: 2020 2020 2020 2023 204f 6e6c 7920 656e         # Only en
+00074660: 7175 6575 6520 6966 206e 6577 2073 6869  queue if new shi
+00074670: 6674 2076 616c 2069 7320 6469 6666 6572  ft val is differ
+00074680: 656e 7420 746f 2070 7265 7669 6f75 7320  ent to previous 
+00074690: 7368 6966 740d 0a20 2020 2020 2020 2020  shift..         
+000746a0: 2020 2020 2020 2069 6620 2873 656c 662e         if (self.
+000746b0: 7374 6163 6b2e 7368 6966 7473 6469 6374  stack.shiftsdict
+000746c0: 5b69 7468 6574 615d 5b22 7873 6869 6674  [itheta]["xshift
+000746d0: 7322 5d5b 6576 5d2c 7365 6c66 2e73 7461  s"][ev],self.sta
+000746e0: 636b 2e73 6869 6674 7364 6963 745b 6974  ck.shiftsdict[it
+000746f0: 6865 7461 5d5b 2279 7368 6966 7473 225d  heta]["yshifts"]
+00074700: 5b65 765d 2920 213d 2028 7873 6869 6674  [ev]) != (xshift
+00074710: 735b 6576 5d2c 7973 6869 6674 735b 6576  s[ev],yshifts[ev
+00074720: 5d29 3a0d 0a20 2020 2020 2020 2020 2020  ]):..           
+00074730: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
+00074740: 6163 6b2e 7368 6966 7473 6469 6374 5b69  ack.shiftsdict[i
+00074750: 7468 6574 615d 5b22 7873 6869 6674 7322  theta]["xshifts"
+00074760: 5d5b 6576 5d20 3d20 7873 6869 6674 735b  ][ev] = xshifts[
+00074770: 6576 5d0d 0a20 2020 2020 2020 2020 2020  ev]..           
+00074780: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
+00074790: 6163 6b2e 7368 6966 7473 6469 6374 5b69  ack.shiftsdict[i
+000747a0: 7468 6574 615d 5b22 7973 6869 6674 7322  theta]["yshifts"
+000747b0: 5d5b 6576 5d20 3d20 7973 6869 6674 735b  ][ev] = yshifts[
+000747c0: 6576 5d0d 0a20 2020 2020 2020 2020 2020  ev]..           
+000747d0: 2020 2020 2020 2020 2073 656c 662e 706f           self.po
+000747e0: 6f6c 2e65 6e71 7565 7565 7461 736b 2822  ol.enqueuetask("
+000747f0: 5368 6966 7449 6d67 222c 2065 762c 2078  ShiftImg", ev, x
+00074800: 7368 6966 7473 5b65 765d 2c20 7973 6869  shifts[ev], yshi
+00074810: 6674 735b 6576 5d2c 6974 6865 7461 290d  fts[ev],itheta).
+00074820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00074830: 2020 2020 2023 7072 696e 7428 2253 6869       #print("Shi
+00074840: 6674 496d 6722 2c20 6576 2c20 7873 6869  ftImg", ev, xshi
+00074850: 6674 735b 6576 5d2c 2079 7368 6966 7473  fts[ev], yshifts
+00074860: 5b65 765d 2c69 7468 6574 6129 0d0a 2020  [ev],itheta)..  
+00074870: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00074880: 662e 706f 6f6c 2e71 7565 7565 2e65 6d70  f.pool.queue.emp
+00074890: 7479 2829 3a0d 0a20 2020 2020 2020 2020  ty():..         
+000748a0: 2020 2070 7269 6e74 2822 746f 7461 6c20     print("total 
+000748b0: 7368 6966 7471 7565 7565 2063 6f6d 706f  shiftqueue compo
+000748c0: 7365 642e 2073 7461 7274 696e 6720 706f  sed. starting po
+000748d0: 6f6c 7468 7265 6164 2077 6974 6820 7175  olthread with qu
+000748e0: 6575 6520 7369 7a65 222c 7365 6c66 2e70  eue size",self.p
+000748f0: 6f6f 6c2e 7175 6575 652e 7173 697a 6528  ool.queue.qsize(
+00074900: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00074910: 7365 6c66 2e70 6f6f 6c74 6872 6561 642e  self.poolthread.
+00074920: 7374 6172 7428 290d 0a0d 0a20 2020 2023  start()....    #
+00074930: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
+00074940: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00074950: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00074960: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00074970: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6566  -------..    def
+00074980: 2047 6574 496e 6465 7850 6169 7273 2873   GetIndexPairs(s
+00074990: 656c 6629 3a0d 0a20 2020 2020 2020 2069  elf):..        i
+000749a0: 6478 7475 706c 656c 7374 203d 205b 2869  dxtuplelst = [(i
+000749b0: 2b31 2c69 2920 666f 7220 6920 696e 2072  +1,i) for i in r
+000749c0: 616e 6765 2873 656c 662e 7374 6163 6b2e  ange(self.stack.
+000749d0: 6e5f 6576 2d31 295d 0d0a 2020 2020 2020  n_ev-1)]..      
+000749e0: 2020 7265 7475 726e 2069 6478 7475 706c    return idxtupl
+000749f0: 656c 7374 0d0a 2020 2020 2320 2d2d 2d2d  elst..    # ----
+00074a00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00074a10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00074a20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00074a30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00074a40: 2d2d 0d0a 2020 2020 6465 6620 4f6e 4175  --..    def OnAu
+00074a50: 746f 4372 6f70 2873 656c 6629 3a0d 0a20  toCrop(self):.. 
+00074a60: 2020 2020 2020 2069 6620 7365 6c66 2e61         if self.a
+00074a70: 6c69 676e 6564 3a0d 0a20 2020 2020 2020  ligned:..       
+00074a80: 2020 2020 2073 656c 662e 6362 5f61 7574       self.cb_aut
+00074a90: 6f63 726f 702e 626c 6f63 6b53 6967 6e61  ocrop.blockSigna
+00074aa0: 6c73 2854 7275 6529 0d0a 2020 2020 2020  ls(True)..      
+00074ab0: 2020 2020 2020 7365 6c66 2e43 726f 7053        self.CropS
+00074ac0: 7461 636b 3444 2829 0d0a 2020 2020 2020  tack4D()..      
+00074ad0: 2020 2020 2020 7365 6c66 2e63 625f 6175        self.cb_au
+00074ae0: 746f 6372 6f70 2e62 6c6f 636b 5369 676e  tocrop.blockSign
+00074af0: 616c 7328 4661 6c73 6529 0d0a 2020 2020  als(False)..    
+00074b00: 2020 2020 2020 2020 7365 6c66 2e4f 6e53          self.OnS
+00074b10: 6372 6f6c 6c45 6e67 2873 656c 662e 6965  crollEng(self.ie
+00074b20: 7629 0d0a 2020 2020 2020 2020 2020 2020  v)..            
+00074b30: 7365 6c66 2e62 7574 746f 6e5f 616c 6967  self.button_alig
+00074b40: 6e2e 7365 7445 6e61 626c 6564 2854 7275  n.setEnabled(Tru
+00074b50: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00074b60: 7365 6c66 2e62 7574 746f 6e5f 6f6b 2e73  self.button_ok.s
+00074b70: 6574 456e 6162 6c65 6428 5472 7565 290d  etEnabled(True).
+00074b80: 0a0d 0a20 2020 2064 6566 2043 726f 7053  ...    def CropS
+00074b90: 7461 636b 3444 2873 656c 6629 3a0d 0a20  tack4D(self):.. 
+00074ba0: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
+00074bb0: 6b2e 6162 7364 6174 6134 645f 7368 6966  k.absdata4d_shif
+00074bc0: 7465 645f 6372 6f70 7065 6420 3d20 7365  ted_cropped = se
+00074bd0: 6c66 2e73 7461 636b 2e61 6273 6461 7461  lf.stack.absdata
+00074be0: 3464 5f73 6869 6674 6564 2e63 6f70 7928  4d_shifted.copy(
+00074bf0: 290d 0a20 2020 2020 2020 2069 6620 7365  )..        if se
+00074c00: 6c66 2e63 625f 6175 746f 6372 6f70 2e69  lf.cb_autocrop.i
+00074c10: 7343 6865 636b 6564 2829 3a0d 0a20 2020  sChecked():..   
+00074c20: 2020 2020 2020 2020 206e 7468 6574 6120           ntheta 
+00074c30: 3d20 7261 6e67 6528 6d61 7828 7365 6c66  = range(max(self
+00074c40: 2e73 7461 636b 2e6e 5f74 6865 7461 2c31  .stack.n_theta,1
+00074c50: 2929 2023 206e 6563 6573 7361 7279 2077  )) # necessary w
+00074c60: 6f72 6b20 6172 6f75 6e64 2066 6f72 2033  ork around for 3
+00074c70: 6420 7374 6163 6b73 2061 6e64 2069 6620  d stacks and if 
+00074c80: 3464 2073 7461 636b 2069 7320 6c6f 6164  4d stack is load
+00074c90: 6564 2077 6974 6820 4c6f 6164 5374 6163  ed with LoadStac
+00074ca0: 6b28 290d 0a20 2020 2020 2020 2020 2020  k()..           
+00074cb0: 2023 7072 696e 7428 6e74 6865 7461 290d   #print(ntheta).
+00074cc0: 0a20 2020 2020 2020 2020 2020 2067 6c6f  .            glo
+00074cd0: 6261 6c6d 696e 7820 3d20 6d69 6e28 5b6a  balminx = min([j
+00074ce0: 2066 6f72 2069 2069 6e20 5b73 656c 662e   for i in [self.
+00074cf0: 7374 6163 6b2e 7368 6966 7473 6469 6374  stack.shiftsdict
+00074d00: 5b74 6865 7461 5d5b 2278 7368 6966 7473  [theta]["xshifts
+00074d10: 225d 2066 6f72 2074 6865 7461 2069 6e20  "] for theta in 
+00074d20: 6e74 6865 7461 5d20 666f 7220 6a20 696e  ntheta] for j in
+00074d30: 2069 5d29 0d0a 2020 2020 2020 2020 2020   i])..          
+00074d40: 2020 676c 6f62 616c 6d61 7878 203d 206d    globalmaxx = m
+00074d50: 6178 285b 6a20 666f 7220 6920 696e 205b  ax([j for i in [
+00074d60: 7365 6c66 2e73 7461 636b 2e73 6869 6674  self.stack.shift
+00074d70: 7364 6963 745b 7468 6574 615d 5b22 7873  sdict[theta]["xs
+00074d80: 6869 6674 7322 5d20 666f 7220 7468 6574  hifts"] for thet
+00074d90: 6120 696e 206e 7468 6574 615d 2066 6f72  a in ntheta] for
+00074da0: 206a 2069 6e20 695d 290d 0a20 2020 2020   j in i])..     
+00074db0: 2020 2020 2020 2067 6c6f 6261 6c6d 696e         globalmin
+00074dc0: 7920 3d20 6d69 6e28 5b6a 2066 6f72 2069  y = min([j for i
+00074dd0: 2069 6e20 5b73 656c 662e 7374 6163 6b2e   in [self.stack.
+00074de0: 7368 6966 7473 6469 6374 5b74 6865 7461  shiftsdict[theta
+00074df0: 5d5b 2279 7368 6966 7473 225d 2066 6f72  ]["yshifts"] for
+00074e00: 2074 6865 7461 2069 6e20 6e74 6865 7461   theta in ntheta
+00074e10: 5d20 666f 7220 6a20 696e 2069 5d29 0d0a  ] for j in i])..
+00074e20: 2020 2020 2020 2020 2020 2020 676c 6f62              glob
+00074e30: 616c 6d61 7879 203d 206d 6178 285b 6a20  almaxy = max([j 
+00074e40: 666f 7220 6920 696e 205b 7365 6c66 2e73  for i in [self.s
+00074e50: 7461 636b 2e73 6869 6674 7364 6963 745b  tack.shiftsdict[
+00074e60: 7468 6574 615d 5b22 7973 6869 6674 7322  theta]["yshifts"
+00074e70: 5d20 666f 7220 7468 6574 6120 696e 206e  ] for theta in n
+00074e80: 7468 6574 615d 2066 6f72 206a 2069 6e20  theta] for j in 
+00074e90: 695d 290d 0a20 2020 2020 2020 2020 2020  i])..           
+00074ea0: 2070 7269 6e74 2822 6372 6f70 7374 6163   print("cropstac
+00074eb0: 6b34 643a 2022 2c67 6c6f 6261 6c6d 696e  k4d: ",globalmin
+00074ec0: 782c 676c 6f62 616c 6d61 7878 2c67 6c6f  x,globalmaxx,glo
+00074ed0: 6261 6c6d 696e 792c 676c 6f62 616c 6d61  balminy,globalma
+00074ee0: 7879 290d 0a20 2020 2020 2020 2020 2020  xy)..           
+00074ef0: 2023 6966 206e 6f74 2073 656c 662e 636f   #if not self.co
+00074f00: 6d2e 7374 6163 6b5f 3464 3a0d 0a20 2020  m.stack_4d:..   
+00074f10: 2020 2020 2020 2020 2073 656c 662e 626f           self.bo
+00074f20: 782e 6869 6465 2829 0d0a 2020 2020 2020  x.hide()..      
+00074f30: 2020 2020 2020 6c20 3d20 2d69 6e74 286e        l = -int(n
+00074f40: 702e 666c 6f6f 7228 676c 6f62 616c 6d69  p.floor(globalmi
+00074f50: 6e78 2929 0d0a 2020 2020 2020 2020 2020  nx))..          
+00074f60: 2020 7220 3d20 2d69 6e74 286e 702e 6365    r = -int(np.ce
+00074f70: 696c 2867 6c6f 6261 6c6d 6178 7829 290d  il(globalmaxx)).
+00074f80: 0a20 2020 2020 2020 2020 2020 2063 7220  .            cr 
+00074f90: 3d20 7220 6966 2072 203c 2030 2065 6c73  = r if r < 0 els
+00074fa0: 6520 4e6f 6e65 0d0a 2020 2020 2020 2020  e None..        
+00074fb0: 2020 2020 6966 206c 203c 2030 3a0d 0a20      if l < 0:.. 
+00074fc0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00074fd0: 203d 2030 0d0a 2020 2020 2020 2020 2020   = 0..          
+00074fe0: 2020 2020 2020 6372 203d 2063 7220 2d20        cr = cr - 
+00074ff0: 6c0d 0a20 2020 2020 2020 2020 2020 2062  l..            b
+00075000: 203d 202d 696e 7428 6e70 2e66 6c6f 6f72   = -int(np.floor
+00075010: 2867 6c6f 6261 6c6d 696e 7929 290d 0a20  (globalminy)).. 
+00075020: 2020 2020 2020 2020 2020 2074 203d 202d             t = -
+00075030: 696e 7428 6e70 2e63 6569 6c28 676c 6f62  int(np.ceil(glob
+00075040: 616c 6d61 7879 2929 0d0a 2020 2020 2020  almaxy))..      
+00075050: 2020 2020 2020 6374 203d 2074 2069 6620        ct = t if 
+00075060: 7420 3c20 3020 656c 7365 204e 6f6e 650d  t < 0 else None.
+00075070: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00075080: 6220 3c20 303a 0d0a 2020 2020 2020 2020  b < 0:..        
+00075090: 2020 2020 2020 2020 6220 3d20 300d 0a20          b = 0.. 
+000750a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000750b0: 7420 3d20 6374 202d 2062 0d0a 2020 2020  t = ct - b..    
+000750c0: 2020 2020 2020 2020 6966 2030 2069 6e20          if 0 in 
+000750d0: 7365 6c66 2e73 7461 636b 2e61 6273 6461  self.stack.absda
+000750e0: 7461 3464 5f73 6869 6674 6564 5f63 726f  ta4d_shifted_cro
+000750f0: 7070 6564 5b6c 3a63 722c 623a 6374 2c3a  pped[l:cr,b:ct,:
+00075100: 2c73 656c 662e 6974 6865 7461 5d2e 7368  ,self.itheta].sh
+00075110: 6170 653a 0d0a 2020 2020 2020 2020 2020  ape:..          
+00075120: 2020 2020 2020 5174 5769 6467 6574 732e        QtWidgets.
+00075130: 514d 6573 7361 6765 426f 782e 7761 726e  QMessageBox.warn
+00075140: 696e 6728 7365 6c66 2c20 2745 7272 6f72  ing(self, 'Error
+00075150: 272c 2027 5468 6520 616c 6967 6e6d 656e  ', 'The alignmen
+00075160: 7420 6661 696c 6564 2e20 4372 6f70 7069  t failed. Croppi
+00075170: 6e67 2077 6f75 6c64 2072 6573 756c 7420  ng would result 
+00075180: 696e 2061 207a 6572 6f2d 6469 6d65 6e73  in a zero-dimens
+00075190: 696f 6e61 6c20 696d 6167 652e 2050 6c65  ional image. Ple
+000751a0: 6173 6520 6368 6563 6b20 796f 7572 2073  ase check your s
+000751b0: 6574 7469 6e67 732e 2041 7574 6f2d 6372  ettings. Auto-cr
+000751c0: 6f70 2068 6173 2062 6565 6e20 6469 7361  op has been disa
+000751d0: 626c 6564 2e20 596f 7520 6361 6e20 7265  bled. You can re
+000751e0: 2d65 6e61 626c 6520 6974 206d 616e 7561  -enable it manua
+000751f0: 6c6c 792e 2729 0d0a 2020 2020 2020 2020  lly.')..        
+00075200: 2020 2020 2020 2020 7365 6c66 2e63 625f          self.cb_
+00075210: 6175 746f 6372 6f70 2e73 6574 4368 6563  autocrop.setChec
+00075220: 6b65 6428 4661 6c73 6529 0d0a 2020 2020  ked(False)..    
+00075230: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00075240: 2e4f 6e52 6573 6574 524f 4928 290d 0a20  .OnResetROI().. 
+00075250: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00075260: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00075270: 2020 7365 6c66 2e73 7461 636b 2e61 6273    self.stack.abs
+00075280: 6461 7461 3464 5f73 6869 6674 6564 5f63  data4d_shifted_c
+00075290: 726f 7070 6564 203d 2073 656c 662e 7374  ropped = self.st
+000752a0: 6163 6b2e 6162 7364 6174 6134 645f 7368  ack.absdata4d_sh
+000752b0: 6966 7465 645f 6372 6f70 7065 645b 6c3a  ifted_cropped[l:
+000752c0: 6372 2c62 3a63 742c 3a2c 3a5d 0d0a 2020  cr,b:ct,:,:]..  
+000752d0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+000752e0: 2020 2020 2020 2020 2073 656c 662e 626f           self.bo
+000752f0: 782e 7368 6f77 2829 0d0a 0d0a 2020 2020  x.show()....    
+00075300: 6465 6620 4f6e 5363 726f 6c6c 456e 6728  def OnScrollEng(
+00075310: 7365 6c66 2c20 7661 6c75 6529 3a0d 0a20  self, value):.. 
+00075320: 2020 2020 2020 2073 656c 662e 736c 6964         self.slid
+00075330: 6572 5f65 6e67 2e73 6574 5661 6c75 6528  er_eng.setValue(
+00075340: 7661 6c75 6529 0d0a 2020 2020 2020 2020  value)..        
+00075350: 7365 6c66 2e69 6576 203d 2076 616c 7565  self.iev = value
+00075360: 0d0a 2020 2020 2020 2020 7365 6c66 2e53  ..        self.S
+00075370: 686f 7749 6d61 6765 2829 0d0a 2020 2020  howImage()..    
+00075380: 2020 2020 7365 6c66 2e72 6566 6d61 726b      self.refmark
+00075390: 6572 782e 7365 7456 616c 7565 2873 656c  erx.setValue(sel
+000753a0: 662e 7374 6163 6b2e 6576 5b73 656c 662e  f.stack.ev[self.
+000753b0: 6965 765d 290d 0a20 2020 2020 2020 2073  iev])..        s
+000753c0: 656c 662e 7265 666d 6172 6b65 7279 2e73  elf.refmarkery.s
+000753d0: 6574 5661 6c75 6528 7365 6c66 2e73 7461  etValue(self.sta
+000753e0: 636b 2e65 765b 7365 6c66 2e69 6576 5d29  ck.ev[self.iev])
+000753f0: 0d0a 2020 2020 6465 6620 4f6e 5363 726f  ..    def OnScro
+00075400: 6c6c 5468 6574 6128 7365 6c66 2c20 7661  llTheta(self, va
+00075410: 6c75 6529 3a0d 0a20 2020 2020 2020 2023  lue):..        #
+00075420: 6966 2076 616c 7565 2021 3d20 7365 6c66  if value != self
+00075430: 2e69 7468 6574 613a 0d0a 2020 2020 2020  .itheta:..      
+00075440: 2020 2370 7269 6e74 2822 5468 6574 6120    #print("Theta 
+00075450: 736c 6964 6572 2220 2b20 7374 7228 7661  slider" + str(va
+00075460: 6c75 6529 290d 0a20 2020 2020 2020 2073  lue))..        s
+00075470: 656c 662e 736c 6964 6572 5f74 6865 7461  elf.slider_theta
+00075480: 2e73 6574 5661 6c75 6528 7661 6c75 6529  .setValue(value)
+00075490: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
+000754a0: 7468 6574 6120 3d20 7661 6c75 650d 0a20  theta = value.. 
+000754b0: 2020 2020 2020 2023 7365 6c66 2e43 6c65         #self.Cle
+000754c0: 6172 5368 6966 7473 2829 0d0a 2020 2020  arShifts()..    
+000754d0: 2020 2020 7365 6c66 2e53 686f 7749 6d61      self.ShowIma
+000754e0: 6765 2829 0d0a 2020 2020 2020 2020 6966  ge()..        if
+000754f0: 2073 656c 662e 616c 6967 6e65 643a 0d0a   self.aligned:..
+00075500: 2020 2020 2020 2020 2020 2020 2373 656c              #sel
+00075510: 662e 4d61 6b65 4e65 7753 6361 7474 6572  f.MakeNewScatter
+00075520: 506c 6f74 7328 290d 0a20 2020 2020 2020  Plots()..       
+00075530: 2020 2020 2065 7272 6f72 7468 7265 7368       errorthresh
+00075540: 6f6c 6420 3d20 7365 6c66 2e73 7461 636b  old = self.stack
+00075550: 2e73 6869 6674 7364 6963 745b 7365 6c66  .shiftsdict[self
+00075560: 2e69 7468 6574 615d 5b22 7468 7265 7368  .itheta]["thresh
+00075570: 6f6c 6422 5d0d 0a20 2020 2020 2020 2020  old"]..         
+00075580: 2020 2065 7272 6f72 7320 3d20 7365 6c66     errors = self
+00075590: 2e73 7461 636b 2e73 6869 6674 7364 6963  .stack.shiftsdic
+000755a0: 745b 7365 6c66 2e69 7468 6574 615d 5b22  t[self.itheta]["
+000755b0: 6572 726f 7273 225d 0d0a 2020 2020 2020  errors"]..      
+000755c0: 2020 2020 2020 6966 206e 6f74 2065 7272        if not err
+000755d0: 6f72 7468 7265 7368 6f6c 643a 0d0a 2020  orthreshold:..  
+000755e0: 2020 2020 2020 2020 2020 2020 2020 6572                er
+000755f0: 726f 7274 6872 6573 686f 6c64 203d 2072  rorthreshold = r
+00075600: 6f75 6e64 286e 702e 6d65 616e 2865 7272  ound(np.mean(err
+00075610: 6f72 7329 2c20 3429 0d0a 2020 2020 2020  ors), 4)..      
+00075620: 2020 2020 2020 7365 6c66 2e72 6573 746f        self.resto
+00075630: 7265 5061 7261 6d73 2873 656c 662e 6974  reParams(self.it
+00075640: 6865 7461 290d 0a20 2020 2020 2020 2020  heta)..         
+00075650: 2020 2073 656c 662e 4d61 736b 5363 6174     self.MaskScat
+00075660: 7465 7244 6f74 7341 626f 7665 4572 726f  terDotsAboveErro
+00075670: 7254 6872 6573 686f 6c64 2828 6572 726f  rThreshold((erro
+00075680: 7273 2c20 6572 726f 7274 6872 6573 686f  rs, errorthresho
+00075690: 6c64 2c20 7365 6c66 2e69 7468 6574 6129  ld, self.itheta)
+000756a0: 290d 0a20 2020 2020 2020 2020 2020 2023  )..            #
+000756b0: 2069 6620 7365 6c66 2e63 625f 6175 746f   if self.cb_auto
+000756c0: 6572 726f 722e 6973 4368 6563 6b65 6428  error.isChecked(
+000756d0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000756e0: 2320 2020 2020 7365 6c66 2e73 7069 6e42  #     self.spinB
+000756f0: 6f78 4572 726f 722e 626c 6f63 6b53 6967  oxError.blockSig
+00075700: 6e61 6c73 2854 7275 6529 0d0a 2020 2020  nals(True)..    
+00075710: 2020 2020 2020 2020 2320 2020 2020 7365          #     se
+00075720: 6c66 2e73 7069 6e42 6f78 4572 726f 722e  lf.spinBoxError.
+00075730: 7365 7456 616c 7565 2865 7272 6f72 7468  setValue(errorth
+00075740: 7265 7368 6f6c 6429 0d0a 2020 2020 2020  reshold)..      
+00075750: 2020 2020 2020 2320 2020 2020 7365 6c66        #     self
+00075760: 2e73 7069 6e42 6f78 4572 726f 722e 626c  .spinBoxError.bl
+00075770: 6f63 6b53 6967 6e61 6c73 2846 616c 7365  ockSignals(False
+00075780: 290d 0a20 2020 2020 2020 2020 2020 2078  )..            x
+00075790: 646f 7473 203d 2073 656c 662e 7374 6163  dots = self.stac
+000757a0: 6b2e 7368 6966 7473 6469 6374 5b73 656c  k.shiftsdict[sel
+000757b0: 662e 6974 6865 7461 5d5b 2278 646f 7473  f.itheta]["xdots
+000757c0: 225d 0d0a 2020 2020 2020 2020 2020 2020  "]..            
+000757d0: 7964 6f74 7320 3d20 7365 6c66 2e73 7461  ydots = self.sta
+000757e0: 636b 2e73 6869 6674 7364 6963 745b 7365  ck.shiftsdict[se
+000757f0: 6c66 2e69 7468 6574 615d 5b22 7964 6f74  lf.itheta]["ydot
+00075800: 7322 5d0d 0a20 2020 2020 2020 2020 2020  s"]..           
+00075810: 206d 6173 6b65 6478 203d 2073 656c 662e   maskedx = self.
+00075820: 4d61 736b 6564 5363 6174 7465 7244 6f74  MaskedScatterDot
+00075830: 7341 7272 6179 2873 656c 662e 7872 6567  sArray(self.xreg
+00075840: 696f 6e29 0d0a 2020 2020 2020 2020 2020  ion)..          
+00075850: 2020 6d61 736b 6564 7920 3d20 7365 6c66    maskedy = self
+00075860: 2e4d 6173 6b65 6453 6361 7474 6572 446f  .MaskedScatterDo
+00075870: 7473 4172 7261 7928 7365 6c66 2e79 7265  tsArray(self.yre
+00075880: 6769 6f6e 290d 0a20 2020 2020 2020 2020  gion)..         
+00075890: 2020 2073 656c 662e 7873 6361 7474 6572     self.xscatter
+000758a0: 2e73 6574 4461 7461 2873 706f 7473 3d73  .setData(spots=s
+000758b0: 656c 662e 4372 6561 7465 5363 6174 7465  elf.CreateScatte
+000758c0: 7244 6f74 7328 7864 6f74 732c 206d 6173  rDots(xdots, mas
+000758d0: 6b65 6478 292c 2070 784d 6f64 653d 5472  kedx), pxMode=Tr
+000758e0: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
+000758f0: 2073 656c 662e 7973 6361 7474 6572 2e73   self.yscatter.s
+00075900: 6574 4461 7461 2873 706f 7473 3d73 656c  etData(spots=sel
+00075910: 662e 4372 6561 7465 5363 6174 7465 7244  f.CreateScatterD
+00075920: 6f74 7328 7964 6f74 732c 206d 6173 6b65  ots(ydots, maske
+00075930: 6479 292c 2070 784d 6f64 653d 5472 7565  dy), pxMode=True
+00075940: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00075950: 656c 662e 6669 745f 782e 7365 7444 6174  elf.fit_x.setDat
+00075960: 6128 783d 7365 6c66 2e73 7461 636b 2e65  a(x=self.stack.e
+00075970: 762c 2079 3d73 656c 662e 7374 6163 6b2e  v, y=self.stack.
+00075980: 7368 6966 7473 6469 6374 5b73 656c 662e  shiftsdict[self.
+00075990: 6974 6865 7461 5d5b 2278 7368 6966 7473  itheta]["xshifts
+000759a0: 225d 290d 0a20 2020 2020 2020 2020 2020  "])..           
+000759b0: 2073 656c 662e 6669 745f 792e 7365 7444   self.fit_y.setD
+000759c0: 6174 6128 783d 7365 6c66 2e73 7461 636b  ata(x=self.stack
+000759d0: 2e65 762c 2079 3d73 656c 662e 7374 6163  .ev, y=self.stac
+000759e0: 6b2e 7368 6966 7473 6469 6374 5b73 656c  k.shiftsdict[sel
+000759f0: 662e 6974 6865 7461 5d5b 2279 7368 6966  f.itheta]["yshif
+00075a00: 7473 225d 290d 0a0d 0a20 2020 2020 2020  ts"])....       
+00075a10: 2020 2020 2023 6d69 6e5f 6964 782c 206d       #min_idx, m
+00075a20: 6178 5f69 6478 2c20 6d69 6e5f 6576 2c20  ax_idx, min_ev, 
+00075a30: 6d61 785f 6576 203d 2073 656c 662e 6765  max_ev = self.ge
+00075a40: 7444 6174 6143 6c6f 7365 7374 546f 5265  tDataClosestToRe
+00075a50: 6769 6f6e 2873 656c 662e 7872 6567 696f  gion(self.xregio
+00075a60: 6e2c 2073 656c 662e 7873 6361 7474 6572  n, self.xscatter
+00075a70: 2c20 5472 7565 290d 0a20 2020 2020 2020  , True)..       
+00075a80: 2020 2020 2023 6d69 6e5f 6964 782c 206d       #min_idx, m
+00075a90: 6178 5f69 6478 2c20 6d69 6e5f 6576 2c20  ax_idx, min_ev, 
+00075aa0: 6d61 785f 6576 203d 2073 656c 662e 6765  max_ev = self.ge
+00075ab0: 7444 6174 6143 6c6f 7365 7374 546f 5265  tDataClosestToRe
+00075ac0: 6769 6f6e 2873 656c 662e 7972 6567 696f  gion(self.yregio
+00075ad0: 6e2c 2073 656c 662e 7973 6361 7474 6572  n, self.yscatter
+00075ae0: 2c20 5472 7565 290d 0a0d 0a20 2020 2020  , True)....     
+00075af0: 2020 2020 2020 2023 7365 6c66 2e66 6974         #self.fit
+00075b00: 5f78 2e73 686f 7728 290d 0a20 2020 2020  _x.show()..     
+00075b10: 2020 2020 2020 2073 656c 662e 4f6e 4c69         self.OnLi
+00075b20: 6e52 6567 696f 6e28 7365 6c66 2e78 7265  nRegion(self.xre
+00075b30: 6769 6f6e 2c20 7570 6461 7465 3d46 616c  gion, update=Fal
+00075b40: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
+00075b50: 2073 656c 662e 4f6e 4c69 6e52 6567 696f   self.OnLinRegio
+00075b60: 6e28 7365 6c66 2e79 7265 6769 6f6e 2c20  n(self.yregion, 
+00075b70: 7570 6461 7465 3d46 616c 7365 290d 0a0d  update=False)...
+00075b80: 0a20 2020 2064 6566 2053 686f 7749 6d61  .    def ShowIma
+00075b90: 6765 2873 656c 6629 3a0d 0a20 2020 2020  ge(self):..     
+00075ba0: 2020 2073 656c 662e 7374 6163 6b2e 6162     self.stack.ab
+00075bb0: 7364 6174 615f 7368 6966 7465 645f 6372  sdata_shifted_cr
+00075bc0: 6f70 7065 6420 3d20 7365 6c66 2e73 7461  opped = self.sta
+00075bd0: 636b 2e61 6273 6461 7461 3464 5f73 6869  ck.absdata4d_shi
+00075be0: 6674 6564 5f63 726f 7070 6564 5b3a 2c20  fted_cropped[:, 
+00075bf0: 3a2c 203a 2c20 696e 7428 7365 6c66 2e69  :, :, int(self.i
+00075c00: 7468 6574 6129 5d0d 0a20 2020 2020 2020  theta)]..       
+00075c10: 2073 656c 662e 695f 6974 656d 2e73 6574   self.i_item.set
+00075c20: 496d 6167 6528 7365 6c66 2e73 7461 636b  Image(self.stack
+00075c30: 2e61 6273 6461 7461 5f73 6869 6674 6564  .absdata_shifted
+00075c40: 5f63 726f 7070 6564 5b3a 2c20 3a2c 2069  _cropped[:, :, i
+00075c50: 6e74 2873 656c 662e 6965 7629 5d29 0d0a  nt(self.iev)])..
+00075c60: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00075c70: 636f 6d2e 7374 6163 6b5f 3464 203d 3d20  com.stack_4d == 
+00075c80: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+00075c90: 7365 6c66 2e67 726f 7570 426f 782e 7365  self.groupBox.se
+00075ca0: 7454 6974 6c65 2873 7472 2827 5374 6163  tTitle(str('Stac
+00075cb0: 6b20 4272 6f77 7365 7220 7c20 496d 6167  k Browser | Imag
+00075cc0: 6520 6174 207b 303a 352e 3266 7d20 6556  e at {0:5.2f} eV
+00075cd0: 2061 6e64 207b 313a 352e 3166 7dc2 b027   and {1:5.1f}..'
+00075ce0: 292e 666f 726d 6174 2866 6c6f 6174 2873  ).format(float(s
+00075cf0: 656c 662e 7374 6163 6b2e 6576 5b73 656c  elf.stack.ev[sel
+00075d00: 662e 6965 765d 292c 666c 6f61 7428 7365  f.iev]),float(se
+00075d10: 6c66 2e73 7461 636b 2e74 6865 7461 5b73  lf.stack.theta[s
+00075d20: 656c 662e 6974 6865 7461 5d29 2c20 2929  elf.itheta]), ))
+00075d30: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00075d40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00075d50: 662e 6772 6f75 7042 6f78 2e73 6574 5469  f.groupBox.setTi
+00075d60: 746c 6528 7374 7228 2753 7461 636b 2042  tle(str('Stack B
+00075d70: 726f 7773 6572 207c 2049 6d61 6765 2061  rowser | Image a
+00075d80: 7420 7b30 3a35 2e32 667d 2065 5627 292e  t {0:5.2f} eV').
+00075d90: 666f 726d 6174 2866 6c6f 6174 2873 656c  format(float(sel
+00075da0: 662e 7374 6163 6b2e 6576 5b73 656c 662e  f.stack.ev[self.
+00075db0: 6965 765d 2929 290d 0a0d 0a20 2020 2023  iev])))....    #
+00075dc0: 2320 5365 7475 7020 6120 524f 4920 666f  # Setup a ROI fo
+00075dd0: 7220 616e 2061 6c69 676e 6d65 6e74 2072  r an alignment r
+00075de0: 6563 7461 6e67 6c65 2e20 4279 2064 6566  ectangle. By def
+00075df0: 6175 6c74 2074 6865 2077 686f 6c65 2069  ault the whole i
+00075e00: 6d61 6765 2061 7265 6120 6973 2075 7365  mage area is use
+00075e10: 642e 0d0a 2020 2020 6465 6620 5365 7475  d...    def Setu
+00075e20: 7052 4f49 2873 656c 6629 3a0d 0a20 2020  pROI(self):..   
+00075e30: 2020 2020 2073 656c 662e 626f 7820 3d20       self.box = 
+00075e40: 7067 2e52 6563 7452 4f49 2873 656c 662e  pg.RectROI(self.
+00075e50: 695f 6974 656d 2e62 6f75 6e64 696e 6752  i_item.boundingR
+00075e60: 6563 7428 292e 746f 704c 6566 7428 292c  ect().topLeft(),
+00075e70: 2073 656c 662e 695f 6974 656d 2e62 6f75   self.i_item.bou
+00075e80: 6e64 696e 6752 6563 7428 292e 626f 7474  ndingRect().bott
+00075e90: 6f6d 5269 6768 7428 292c 0d0a 2020 2020  omRight(),..    
+00075ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00075eb0: 2020 2020 2020 2020 2020 7065 6e3d 2835            pen=(5
+00075ec0: 2c20 3829 2c20 6861 6e64 6c65 5065 6e3d  , 8), handlePen=
+00075ed0: 5174 4775 692e 5150 656e 2851 7447 7569  QtGui.QPen(QtGui
+00075ee0: 2e51 436f 6c6f 7228 3235 352c 2030 2c20  .QColor(255, 0, 
+00075ef0: 3132 382c 2032 3535 2929 2c20 6365 6e74  128, 255)), cent
+00075f00: 6572 6564 3d46 616c 7365 2c0d 0a20 2020  ered=False,..   
+00075f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00075f20: 2020 2020 2020 2020 2020 2073 6964 6553             sideS
+00075f30: 6361 6c65 7273 3d46 616c 7365 2c20 7265  calers=False, re
+00075f40: 6d6f 7661 626c 653d 4661 6c73 652c 2073  movable=False, s
+00075f50: 6361 6c65 536e 6170 3d54 7275 652c 2074  caleSnap=True, t
+00075f60: 7261 6e73 6c61 7465 536e 6170 3d54 7275  ranslateSnap=Tru
+00075f70: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00075f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00075f90: 2020 6d61 7842 6f75 6e64 733d 7365 6c66    maxBounds=self
+00075fa0: 2e69 5f69 7465 6d2e 626f 756e 6469 6e67  .i_item.bounding
+00075fb0: 5265 6374 2829 290d 0a20 2020 2020 2020  Rect())..       
+00075fc0: 2073 656c 662e 7662 2e61 6464 4974 656d   self.vb.addItem
+00075fd0: 2873 656c 662e 626f 782c 2069 676e 6f72  (self.box, ignor
+00075fe0: 6542 6f75 6e64 733d 4661 6c73 6529 0d0a  eBounds=False)..
+00075ff0: 2020 2020 2020 2020 7365 6c66 2e62 6f78          self.box
+00076000: 2e73 6967 5265 6769 6f6e 4368 616e 6765  .sigRegionChange
+00076010: 4669 6e69 7368 6564 2e63 6f6e 6e65 6374  Finished.connect
+00076020: 2873 656c 662e 4f6e 426f 7843 6861 6e67  (self.OnBoxChang
+00076030: 6564 290d 0a20 2020 2020 2020 2073 656c  ed)..        sel
+00076040: 662e 626f 782e 7369 6752 6567 696f 6e43  f.box.sigRegionC
+00076050: 6861 6e67 6553 7461 7274 6564 2e63 6f6e  hangeStarted.con
+00076060: 6e65 6374 2873 656c 662e 4f6e 426f 7843  nect(self.OnBoxC
+00076070: 6861 6e67 696e 6729 0d0a 2020 2020 2020  hanging)..      
+00076080: 2020 7365 6c66 2e62 7574 746f 6e5f 7273    self.button_rs
+00076090: 7472 6f69 2e63 6c69 636b 6564 2e63 6f6e  troi.clicked.con
+000760a0: 6e65 6374 2873 656c 662e 4f6e 5265 7365  nect(self.OnRese
+000760b0: 7452 4f49 290d 0a20 2020 2023 2320 5468  tROI)..    ## Th
+000760c0: 6520 524f 4920 6973 206c 696d 6974 6564  e ROI is limited
+000760d0: 2074 6f20 7468 6520 7669 7369 626c 6520   to the visible 
+000760e0: 696d 6167 6520 6172 6561 2e20 4f6e 4d6f  image area. OnMo
+000760f0: 7573 654d 6f76 654f 7574 7369 6465 2068  useMoveOutside h
+00076100: 616e 646c 6573 2074 6865 2062 6568 6176  andles the behav
+00076110: 696f 7220 7768 656e 0d0a 2020 2020 6465  ior when..    de
+00076120: 6620 436c 6561 7253 6869 6674 7328 7365  f ClearShifts(se
+00076130: 6c66 293a 0d0a 2020 2020 2020 2020 7365  lf):..        se
+00076140: 6c66 2e61 6c69 676e 6564 203d 2046 616c  lf.aligned = Fal
+00076150: 7365 0d0a 2020 2020 2020 2020 7365 6c66  se..        self
+00076160: 2e63 625f 6175 746f 6572 726f 722e 7374  .cb_autoerror.st
+00076170: 6174 6543 6861 6e67 6564 2e64 6973 636f  ateChanged.disco
+00076180: 6e6e 6563 7428 290d 0a20 2020 2020 2020  nnect()..       
+00076190: 2073 656c 662e 6669 745f 782e 6869 6465   self.fit_x.hide
+000761a0: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+000761b0: 2e66 6974 5f79 2e68 6964 6528 290d 0a20  .fit_y.hide().. 
+000761c0: 2020 2020 2020 2073 656c 662e 496e 6974         self.Init
+000761d0: 5368 6966 7473 4469 6374 2829 0d0a 2020  ShiftsDict()..  
+000761e0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+000761f0: 6e5f 616c 6967 6e2e 7365 7445 6e61 626c  n_align.setEnabl
+00076200: 6564 2854 7275 6529 0d0a 2020 2020 2020  ed(True)..      
+00076210: 2020 7365 6c66 2e4d 616b 654e 6577 5363    self.MakeNewSc
+00076220: 6174 7465 7250 6c6f 7473 2829 0d0a 2020  atterPlots()..  
+00076230: 2020 6465 6620 4f6e 5265 7365 7452 4f49    def OnResetROI
+00076240: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00076250: 2073 656c 662e 436c 6561 7253 6869 6674   self.ClearShift
+00076260: 7328 290d 0a20 2020 2020 2020 2073 656c  s()..        sel
+00076270: 662e 7374 6163 6b2e 6162 7364 6174 6134  f.stack.absdata4
+00076280: 645f 7368 6966 7465 645f 6372 6f70 7065  d_shifted_croppe
+00076290: 6420 3d20 7365 6c66 2e73 7461 636b 2e61  d = self.stack.a
+000762a0: 6273 6461 7461 3464 2e63 6f70 7928 290d  bsdata4d.copy().
+000762b0: 0a20 2020 2020 2020 2073 656c 662e 4f6e  .        self.On
+000762c0: 5363 726f 6c6c 456e 6728 7365 6c66 2e69  ScrollEng(self.i
+000762d0: 6576 290d 0a20 2020 2020 2020 2073 656c  ev)..        sel
+000762e0: 662e 626f 782e 7365 7450 6f73 2830 2c20  f.box.setPos(0, 
+000762f0: 302c 2075 7064 6174 653d 4661 6c73 652c  0, update=False,
+00076300: 2066 696e 6973 683d 4661 6c73 6529 0d0a   finish=False)..
+00076310: 2020 2020 2020 2020 7365 6c66 2e62 6f78          self.box
+00076320: 2e73 6574 5369 7a65 2873 656c 662e 695f  .setSize(self.i_
+00076330: 6974 656d 2e62 6f75 6e64 696e 6752 6563  item.boundingRec
+00076340: 7428 292e 626f 7474 6f6d 5269 6768 7428  t().bottomRight(
+00076350: 2920 2d20 7365 6c66 2e62 6f78 2e70 6f73  ) - self.box.pos
+00076360: 2829 2c20 7570 6461 7465 3d54 7275 652c  (), update=True,
+00076370: 2073 6e61 703d 5472 7565 2c20 6669 6e69   snap=True, fini
+00076380: 7368 3d54 7275 6529 0d0a 2020 2020 2020  sh=True)..      
+00076390: 2020 7365 6c66 2e62 6f78 2e73 686f 7728    self.box.show(
+000763a0: 290d 0a20 2020 2064 6566 204f 6e42 6f78  )..    def OnBox
+000763b0: 4368 616e 6769 6e67 2873 656c 6629 3a0d  Changing(self):.
+000763c0: 0a20 2020 2020 2020 2073 656c 662e 626f  .        self.bo
+000763d0: 7873 697a 6520 3d20 7365 6c66 2e62 6f78  xsize = self.box
+000763e0: 2e73 697a 6528 290d 0a20 2020 2020 2020  .size()..       
+000763f0: 2073 656c 662e 7072 6f78 7920 3d20 7067   self.proxy = pg
+00076400: 2e53 6967 6e61 6c50 726f 7879 2873 656c  .SignalProxy(sel
+00076410: 662e 7662 2e73 6365 6e65 2829 2e73 6967  f.vb.scene().sig
+00076420: 4d6f 7573 654d 6f76 6564 2c20 7261 7465  MouseMoved, rate
+00076430: 4c69 6d69 743d 3330 2c20 736c 6f74 3d73  Limit=30, slot=s
+00076440: 656c 662e 4f6e 4d6f 7573 654d 6f76 654f  elf.OnMouseMoveO
+00076450: 7574 7369 6465 290d 0a20 2020 2064 6566  utside)..    def
+00076460: 204f 6e42 6f78 4368 616e 6765 6428 7365   OnBoxChanged(se
+00076470: 6c66 293a 0d0a 2020 2020 2020 2020 7472  lf):..        tr
+00076480: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00076490: 7365 6c66 2e70 726f 7879 2e64 6973 636f  self.proxy.disco
+000764a0: 6e6e 6563 7428 290d 0a20 2020 2020 2020  nnect()..       
+000764b0: 2065 7863 6570 7420 4174 7472 6962 7574   except Attribut
+000764c0: 6545 7272 6f72 3a0d 0a20 2020 2020 2020  eError:..       
+000764d0: 2020 2020 2070 6173 730d 0a20 2020 2020       pass..     
+000764e0: 2020 206c 6566 7420 3d20 696e 7428 7365     left = int(se
+000764f0: 6c66 2e62 6f78 2e70 6f73 2829 2e78 2829  lf.box.pos().x()
+00076500: 290d 0a20 2020 2020 2020 2072 6967 6874  )..        right
+00076510: 203d 206c 6566 7420 2b20 696e 7428 7365   = left + int(se
+00076520: 6c66 2e62 6f78 2e73 697a 6528 292e 7828  lf.box.size().x(
+00076530: 2929 0d0a 2020 2020 2020 2020 626f 7474  ))..        bott
+00076540: 6f6d 203d 2069 6e74 2873 656c 662e 626f  om = int(self.bo
+00076550: 782e 706f 7328 292e 7928 2929 0d0a 2020  x.pos().y())..  
+00076560: 2020 2020 2020 746f 7020 3d20 626f 7474        top = bott
+00076570: 6f6d 202b 2069 6e74 2873 656c 662e 626f  om + int(self.bo
+00076580: 782e 7369 7a65 2829 2e79 2829 290d 0a20  x.size().y()).. 
+00076590: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
+000765a0: 6b2e 6162 7364 6174 615f 6372 6f70 7065  k.absdata_croppe
+000765b0: 6420 3d20 7365 6c66 2e73 7461 636b 2e61  d = self.stack.a
+000765c0: 6273 6461 7461 3464 5b6c 6566 743a 7269  bsdata4d[left:ri
+000765d0: 6768 742c 2062 6f74 746f 6d3a 746f 702c  ght, bottom:top,
+000765e0: 203a 2c3a 5d2e 636f 7079 2829 0d0a 0d0a   :,:].copy()....
+000765f0: 2020 2020 6465 6620 4f6e 4c69 6e52 6567      def OnLinReg
+00076600: 696f 6e28 7365 6c66 2c20 7265 6769 6f6e  ion(self, region
+00076610: 2c20 7570 6461 7465 3d54 7275 6529 3a0d  , update=True):.
+00076620: 0a20 2020 2020 2020 2023 7072 696e 7428  .        #print(
+00076630: 224f 6e4c 696e 5265 6769 6f6e 222c 2073  "OnLinRegion", s
+00076640: 7472 2875 7064 6174 6529 290d 0a20 2020  tr(update))..   
+00076650: 2020 2020 2073 656c 6563 7472 6567 696f       selectregio
+00076660: 6e3d 207b 7365 6c66 2e78 7265 6769 6f6e  n= {self.xregion
+00076670: 203a 2022 6d61 6e75 616c 6d61 736b 6564   : "manualmasked
+00076680: 7822 2c20 7365 6c66 2e79 7265 6769 6f6e  x", self.yregion
+00076690: 203a 2022 6d61 6e75 616c 6d61 736b 6564   : "manualmasked
+000766a0: 7922 7d0d 0a20 2020 2020 2020 2073 656c  y"}..        sel
+000766b0: 6563 7473 6361 7474 6572 203d 207b 7365  ectscatter = {se
+000766c0: 6c66 2e78 7265 6769 6f6e 203a 2073 656c  lf.xregion : sel
+000766d0: 662e 7873 6361 7474 6572 2c20 7365 6c66  f.xscatter, self
+000766e0: 2e79 7265 6769 6f6e 203a 2073 656c 662e  .yregion : self.
+000766f0: 7973 6361 7474 6572 7d0d 0a20 2020 2020  yscatter}..     
+00076700: 2020 2073 656c 6563 7472 6567 696f 6e6c     selectregionl
+00076710: 696d 6974 3d20 7b73 656c 662e 7872 6567  imit= {self.xreg
+00076720: 696f 6e20 3a20 2272 6567 696f 6e6c 696d  ion : "regionlim
+00076730: 6974 7822 2c20 7365 6c66 2e79 7265 6769  itx", self.yregi
+00076740: 6f6e 203a 2022 7265 6769 6f6e 6c69 6d69  on : "regionlimi
+00076750: 7479 227d 0d0a 2020 2020 2020 2020 7365  ty"}..        se
+00076760: 6c65 6374 706c 6f74 203d 207b 7365 6c66  lectplot = {self
+00076770: 2e78 7265 6769 6f6e 203a 2073 656c 662e  .xregion : self.
+00076780: 7078 2c20 7365 6c66 2e79 7265 6769 6f6e  px, self.yregion
+00076790: 203a 2073 656c 662e 7079 7d0d 0a20 2020   : self.py}..   
+000767a0: 2020 2020 2023 7072 696e 7428 226f 6e6c       #print("onl
+000767b0: 696e 7265 6769 6f6e 2022 2b20 7365 6c65  inregion "+ sele
+000767c0: 6374 7265 6769 6f6e 5b72 6567 696f 6e5d  ctregion[region]
+000767d0: 290d 0a20 2020 2020 2020 2073 6361 7474  )..        scatt
+000767e0: 6572 203d 2073 656c 6563 7473 6361 7474  er = selectscatt
+000767f0: 6572 5b72 6567 696f 6e5d 0d0a 2020 2020  er[region]..    
+00076800: 2020 2020 6d69 6e5f 6964 782c 206d 6178      min_idx, max
+00076810: 5f69 6478 2c20 6d69 6e5f 6576 2c20 6d61  _idx, min_ev, ma
+00076820: 785f 6576 203d 2073 656c 662e 6765 7444  x_ev = self.getD
+00076830: 6174 6143 6c6f 7365 7374 546f 5265 6769  ataClosestToRegi
+00076840: 6f6e 2872 6567 696f 6e2c 7363 6174 7465  on(region,scatte
+00076850: 722c 7570 6461 7465 290d 0a20 2020 2020  r,update)..     
+00076860: 2020 2073 656c 6563 7469 6f6e 203d 205b     selection = [
+00076870: 2a72 616e 6765 286d 696e 5f69 6478 2c20  *range(min_idx, 
+00076880: 6d61 785f 6964 782b 3129 5d0d 0a20 2020  max_idx+1)]..   
+00076890: 2020 2020 2066 6f72 2069 6478 2c76 616c       for idx,val
+000768a0: 2069 6e20 656e 756d 6572 6174 6528 7365   in enumerate(se
+000768b0: 6c66 2e73 7461 636b 2e73 6869 6674 7364  lf.stack.shiftsd
+000768c0: 6963 745b 7365 6c66 2e69 7468 6574 615d  ict[self.itheta]
+000768d0: 5b22 6d61 6e75 616c 6d61 736b 6564 7822  ["manualmaskedx"
+000768e0: 5d29 3a0d 0a20 2020 2020 2020 2020 2020  ]):..           
+000768f0: 2069 6620 6964 7820 6e6f 7420 696e 2073   if idx not in s
+00076900: 656c 6563 7469 6f6e 3a0d 0a20 2020 2020  election:..     
+00076910: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00076920: 7374 6163 6b2e 7368 6966 7473 6469 6374  stack.shiftsdict
+00076930: 5b73 656c 662e 6974 6865 7461 5d5b 7365  [self.itheta][se
+00076940: 6c65 6374 7265 6769 6f6e 5b72 6567 696f  lectregion[regio
+00076950: 6e5d 5d5b 6964 785d 203d 2054 7275 650d  n]][idx] = True.
+00076960: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00076970: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00076980: 2020 2020 7365 6c66 2e73 7461 636b 2e73      self.stack.s
+00076990: 6869 6674 7364 6963 745b 7365 6c66 2e69  hiftsdict[self.i
+000769a0: 7468 6574 615d 5b73 656c 6563 7472 6567  theta][selectreg
+000769b0: 696f 6e5b 7265 6769 6f6e 5d5d 5b69 6478  ion[region]][idx
+000769c0: 5d20 3d20 4661 6c73 650d 0a20 2020 2020  ] = False..     
+000769d0: 2020 2079 5f76 616c 733d 2073 656c 6563     y_vals= selec
+000769e0: 7473 6361 7474 6572 5b72 6567 696f 6e5d  tscatter[region]
+000769f0: 2e64 6174 615b 2279 225d 5b6d 696e 5f69  .data["y"][min_i
+00076a00: 6478 3a6d 6178 5f69 6478 202b 2031 5d0d  dx:max_idx + 1].
+00076a10: 0a20 2020 2020 2020 2073 656c 6563 7470  .        selectp
+00076a20: 6c6f 745b 7265 6769 6f6e 5d2e 7365 7452  lot[region].setR
+00076a30: 616e 6765 2879 5261 6e67 653d 5b6e 702e  ange(yRange=[np.
+00076a40: 6d69 6e28 795f 7661 6c73 292c 206e 702e  min(y_vals), np.
+00076a50: 6d61 7828 795f 7661 6c73 295d 2c20 6469  max(y_vals)], di
+00076a60: 7361 626c 6541 7574 6f52 616e 6765 3d54  sableAutoRange=T
+00076a70: 7275 652c 2070 6164 6469 6e67 3d30 2e31  rue, padding=0.1
+00076a80: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00076a90: 436f 6c6f 7269 7a65 5363 6174 7465 7244  ColorizeScatterD
+00076aa0: 6f74 7328 290d 0a20 2020 2020 2020 2023  ots()..        #
+00076ab0: 6669 6c74 6572 203d 205b 5472 7565 2069  filter = [True i
+00076ac0: 6620 6964 7820 696e 2073 656c 6563 7469  f idx in selecti
+00076ad0: 6f6e 2065 6c73 6520 4661 6c73 6520 666f  on else False fo
+00076ae0: 7220 6964 782c 626f 6f6c 2069 6e20 656e  r idx,bool in en
+00076af0: 756d 6572 6174 6528 7365 6c66 2e73 7461  umerate(self.sta
+00076b00: 636b 2e73 6869 6674 7364 6963 745b 7365  ck.shiftsdict[se
+00076b10: 6c66 2e69 7468 6574 615d 5b22 6d61 6e75  lf.itheta]["manu
+00076b20: 616c 6d61 736b 6564 7822 5d29 5d0d 0a20  almaskedx"])].. 
+00076b30: 2020 2020 2020 2023 7072 696e 7428 7365         #print(se
+00076b40: 6c65 6374 696f 6e2c 6669 6c74 6572 290d  lection,filter).
+00076b50: 0a20 2020 2020 2020 2023 7365 6c66 2e55  .        #self.U
+00076b60: 7064 6174 6553 6361 7474 6572 506c 6f74  pdateScatterPlot
+00076b70: 7328 7265 6769 6f6e 2c20 6964 290d 0a20  s(region, id).. 
+00076b80: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+00076b90: 6c66 2e61 6c69 676e 6564 3a0d 0a20 2020  lf.aligned:..   
+00076ba0: 2020 2020 2020 2020 2066 6f72 2074 6865           for the
+00076bb0: 7461 2069 6e20 7261 6e67 6528 7365 6c66  ta in range(self
+00076bc0: 2e73 7461 636b 2e6e 5f74 6865 7461 293a  .stack.n_theta):
+00076bd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00076be0: 2020 7365 6c66 2e73 7461 636b 2e73 6869    self.stack.shi
+00076bf0: 6674 7364 6963 745b 7468 6574 615d 5b73  ftsdict[theta][s
+00076c00: 656c 6563 7472 6567 696f 6e6c 696d 6974  electregionlimit
+00076c10: 5b72 6567 696f 6e5d 5d20 3d20 286d 696e  [region]] = (min
+00076c20: 5f65 762c 206d 6178 5f65 7629 0d0a 2020  _ev, max_ev)..  
+00076c30: 2020 2020 2020 6966 2073 656c 662e 616c        if self.al
+00076c40: 6967 6e65 6420 616e 6420 7570 6461 7465  igned and update
+00076c50: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00076c60: 656c 662e 7374 6163 6b2e 7368 6966 7473  elf.stack.shifts
+00076c70: 6469 6374 5b73 656c 662e 6974 6865 7461  dict[self.itheta
+00076c80: 5d5b 7365 6c65 6374 7265 6769 6f6e 6c69  ][selectregionli
+00076c90: 6d69 745b 7265 6769 6f6e 5d5d 203d 2028  mit[region]] = (
+00076ca0: 6d69 6e5f 6576 2c20 6d61 785f 6576 290d  min_ev, max_ev).
+00076cb0: 0a20 2020 2020 2020 2020 2020 2023 7072  .            #pr
+00076cc0: 696e 7428 2243 6f6d 706f 7365 5368 6966  int("ComposeShif
+00076cd0: 7451 7565 7565 222b 7365 6c65 6374 7265  tQueue"+selectre
+00076ce0: 6769 6f6e 5b72 6567 696f 6e5d 290d 0a20  gion[region]).. 
+00076cf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00076d00: 436f 6d70 6f73 6553 6869 6674 5175 6575  ComposeShiftQueu
+00076d10: 6528 290d 0a0d 0a20 2020 2064 6566 204f  e()....    def O
+00076d20: 6e4d 6f75 7365 4d6f 7665 4f75 7473 6964  nMouseMoveOutsid
+00076d30: 6528 7365 6c66 2c20 6576 293a 0d0a 2020  e(self, ev):..  
+00076d40: 2020 2020 2020 6d6f 7573 6570 6f73 203d        mousepos =
+00076d50: 2073 656c 662e 7662 2e6d 6170 5363 656e   self.vb.mapScen
+00076d60: 6554 6f56 6965 7728 6576 5b30 5d29 0d0a  eToView(ev[0])..
+00076d70: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00076d80: 656c 662e 7662 2e69 7465 6d42 6f75 6e64  elf.vb.itemBound
+00076d90: 696e 6752 6563 7428 7365 6c66 2e69 5f69  ingRect(self.i_i
+00076da0: 7465 6d29 2e63 6f6e 7461 696e 7328 6d6f  tem).contains(mo
+00076db0: 7573 6570 6f73 293a 0d0a 2020 2020 2020  usepos):..      
+00076dc0: 2020 2020 2020 6d61 7872 6563 7420 3d20        maxrect = 
+00076dd0: 7365 6c66 2e69 5f69 7465 6d2e 626f 756e  self.i_item.boun
+00076de0: 6469 6e67 5265 6374 2829 2e62 6f74 746f  dingRect().botto
+00076df0: 6d52 6967 6874 2829 0d0a 2020 2020 2020  mRight()..      
+00076e00: 2020 2020 2020 2320 6966 2062 6f75 6e64        # if bound
+00076e10: 7320 6578 6365 6564 6564 0d0a 2020 2020  s exceeded..    
+00076e20: 2020 2020 2020 2020 6f75 745f 7820 3d20          out_x = 
+00076e30: 6d61 7828 286d 6f75 7365 706f 732d 6d61  max((mousepos-ma
+00076e40: 7872 6563 7429 2e78 2829 2c30 290d 0a20  xrect).x(),0).. 
+00076e50: 2020 2020 2020 2020 2020 206f 7574 5f79             out_y
+00076e60: 203d 206d 6178 2828 6d6f 7573 6570 6f73   = max((mousepos
+00076e70: 2d6d 6178 7265 6374 292e 7928 292c 2030  -maxrect).y(), 0
+00076e80: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00076e90: 6620 7365 6c66 2e62 6f78 2e73 697a 6528  f self.box.size(
+00076ea0: 2920 213d 2073 656c 662e 626f 7873 697a  ) != self.boxsiz
+00076eb0: 653a 2023 2070 7265 7665 6e74 7320 7461  e: # prevents ta
+00076ec0: 6b69 6e67 2061 6374 696f 6e20 7768 656e  king action when
+00076ed0: 2074 6865 2062 6f78 2069 7320 6a75 7374   the box is just
+00076ee0: 2064 7261 6767 6564 2061 6e64 206e 6f74   dragged and not
+00076ef0: 2072 6573 697a 6564 0d0a 2020 2020 2020   resized..      
+00076f00: 2020 2020 2020 2020 2020 6966 206f 7574            if out
+00076f10: 5f78 2061 6e64 206f 7574 5f79 3a0d 0a20  _x and out_y:.. 
+00076f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00076f30: 2020 2073 656c 662e 626f 782e 7365 7453     self.box.setS
+00076f40: 697a 6528 7365 6c66 2e69 5f69 7465 6d2e  ize(self.i_item.
+00076f50: 626f 756e 6469 6e67 5265 6374 2829 2e62  boundingRect().b
+00076f60: 6f74 746f 6d52 6967 6874 2829 2d73 656c  ottomRight()-sel
+00076f70: 662e 626f 782e 706f 7328 292c 2075 7064  f.box.pos(), upd
+00076f80: 6174 653d 5472 7565 2c20 736e 6170 3d54  ate=True, snap=T
+00076f90: 7275 652c 2066 696e 6973 683d 4661 6c73  rue, finish=Fals
+00076fa0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00076fb0: 2020 2020 656c 6966 206f 7574 5f78 3a0d      elif out_x:.
+00076fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00076fd0: 2020 2020 2073 656c 662e 626f 782e 7365       self.box.se
+00076fe0: 7453 697a 6528 5b73 656c 662e 695f 6974  tSize([self.i_it
+00076ff0: 656d 2e62 6f75 6e64 696e 6752 6563 7428  em.boundingRect(
+00077000: 292e 7269 6768 7428 292d 7365 6c66 2e62  ).right()-self.b
+00077010: 6f78 2e70 6f73 2829 2e78 2829 2c6d 6f75  ox.pos().x(),mou
+00077020: 7365 706f 732e 7928 292d 7365 6c66 2e62  sepos.y()-self.b
+00077030: 6f78 2e70 6f73 2829 2e79 2829 5d2c 2075  ox.pos().y()], u
+00077040: 7064 6174 653d 5472 7565 2c20 736e 6170  pdate=True, snap
+00077050: 3d54 7275 652c 2066 696e 6973 683d 4661  =True, finish=Fa
+00077060: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
+00077070: 2020 2020 2020 656c 6966 206f 7574 5f79        elif out_y
+00077080: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00077090: 2020 2020 2020 2073 656c 662e 626f 782e         self.box.
+000770a0: 7365 7453 697a 6528 5b6d 6f75 7365 706f  setSize([mousepo
+000770b0: 732e 7828 292d 7365 6c66 2e62 6f78 2e70  s.x()-self.box.p
+000770c0: 6f73 2829 2e78 2829 2c73 656c 662e 695f  os().x(),self.i_
+000770d0: 6974 656d 2e62 6f75 6e64 696e 6752 6563  item.boundingRec
+000770e0: 7428 292e 626f 7474 6f6d 2829 2d73 656c  t().bottom()-sel
+000770f0: 662e 626f 782e 706f 7328 292e 7928 295d  f.box.pos().y()]
+00077100: 2c20 7570 6461 7465 3d54 7275 652c 2073  , update=True, s
+00077110: 6e61 703d 5472 7565 2c20 6669 6e69 7368  nap=True, finish
+00077120: 3d46 616c 7365 290d 0a23 202d 2d2d 2d2d  =False)..# -----
+00077130: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00077140: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00077150: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00077160: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00077170: 2d0d 0a20 2020 2064 6566 204f 6e43 616e  -..    def OnCan
+00077180: 6365 6c28 7365 6c66 2c20 6576 7429 3a0d  cel(self, evt):.
+00077190: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
+000771a0: 6163 6b2e 6162 7364 6174 615f 7368 6966  ack.absdata_shif
+000771b0: 7465 645f 6372 6f70 7065 6420 3d20 7365  ted_cropped = se
+000771c0: 6c66 2e73 7461 636b 2e61 6273 6461 7461  lf.stack.absdata
+000771d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+000771e0: 6172 656e 742e 7061 6765 312e 6c6f 6164  arent.page1.load
+000771f0: 496d 6167 6528 290d 0a0d 0a20 2020 2020  Image()....     
+00077200: 2020 2069 6620 7368 6f77 6d61 7074 6162     if showmaptab
+00077210: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00077220: 656c 662e 7061 7265 6e74 2e70 6167 6539  elf.parent.page9
+00077230: 2e43 6c65 6172 2829 0d0a 2020 2020 2020  .Clear()..      
+00077240: 2020 2020 2020 7365 6c66 2e70 6172 656e        self.paren
+00077250: 742e 7061 6765 392e 4c6f 6164 456e 7472  t.page9.LoadEntr
+00077260: 6965 7328 290d 0a0d 0a20 2020 2020 2020  ies()....       
+00077270: 2073 656c 662e 636c 6f73 6528 290d 0a20   self.close().. 
+00077280: 2020 2023 202d 2d2d 2d2d 2d2d 2d2d 2d2d     # -----------
+00077290: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000772a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000772b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000772c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020  -----------..   
+000772d0: 2064 6566 204f 6e41 6363 6570 7428 7365   def OnAccept(se
+000772e0: 6c66 2c20 6576 7429 3a0d 0a20 2020 2020  lf, evt):..     
+000772f0: 2020 2069 6620 7365 6c66 2e63 6f6d 2e73     if self.com.s
+00077300: 7461 636b 5f34 6420 3d3d 2030 3a0d 0a20  tack_4d == 0:.. 
+00077310: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00077320: 7374 6163 6b2e 6162 7364 6174 6120 3d20  stack.absdata = 
+00077330: 7365 6c66 2e73 7461 636b 2e61 6273 6461  self.stack.absda
+00077340: 7461 3464 5f73 6869 6674 6564 5f63 726f  ta4d_shifted_cro
+00077350: 7070 6564 5b3a 2c3a 2c3a 2c30 5d0d 0a20  pped[:,:,:,0].. 
+00077360: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00077370: 7374 6163 6b2e 6461 7461 5f73 7472 7563  stack.data_struc
+00077380: 742e 6578 6368 616e 6765 2e64 6174 6120  t.exchange.data 
+00077390: 3d20 7365 6c66 2e73 7461 636b 2e61 6273  = self.stack.abs
+000773a0: 6461 7461 0d0a 2020 2020 2020 2020 656c  data..        el
+000773b0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+000773c0: 2073 656c 662e 7374 6163 6b2e 7374 6163   self.stack.stac
+000773d0: 6b34 4420 3d20 7365 6c66 2e73 7461 636b  k4D = self.stack
+000773e0: 2e61 6273 6461 7461 3464 5f73 6869 6674  .absdata4d_shift
+000773f0: 6564 5f63 726f 7070 6564 0d0a 2020 2020  ed_cropped..    
+00077400: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
+00077410: 636b 2e61 6273 6461 7461 203d 2073 656c  ck.absdata = sel
+00077420: 662e 7374 6163 6b2e 7374 6163 6b34 445b  f.stack.stack4D[
+00077430: 3a2c 203a 2c20 3a2c 2073 656c 662e 6974  :, :, :, self.it
+00077440: 6865 7461 5d0d 0a20 2020 2020 2020 2020  heta]..         
+00077450: 2020 2073 656c 662e 7374 6163 6b2e 6461     self.stack.da
+00077460: 7461 5f73 7472 7563 742e 6578 6368 616e  ta_struct.exchan
+00077470: 6765 2e64 6174 6120 3d20 7365 6c66 2e73  ge.data = self.s
+00077480: 7461 636b 2e73 7461 636b 3444 0d0a 2020  tack.stack4D..  
+00077490: 2020 2020 2020 2020 2020 2351 7457 6964            #QtWid
+000774a0: 6765 7473 2e51 4d65 7373 6167 6542 6f78  gets.QMessageBox
+000774b0: 2e77 6172 6e69 6e67 2873 656c 662c 2027  .warning(self, '
+000774c0: 4572 726f 7227 2c20 2734 4420 7374 6163  Error', '4D stac
+000774d0: 6b20 6e6f 7420 7965 7420 7375 7070 6f72  k not yet suppor
+000774e0: 7465 642e 2729 0d0a 0d0a 2020 2020 2020  ted.')....      
+000774f0: 2020 6461 7461 6469 6d20 3d20 6e70 2e69    datadim = np.i
+00077500: 6e74 3332 2873 656c 662e 7374 6163 6b2e  nt32(self.stack.
+00077510: 6162 7364 6174 612e 7368 6170 6529 0d0a  absdata.shape)..
+00077520: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00077530: 7461 636b 2e6e 5f63 6f6c 7320 3d20 6461  tack.n_cols = da
+00077540: 7461 6469 6d5b 305d 2e63 6f70 7928 290d  tadim[0].copy().
+00077550: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
+00077560: 6163 6b2e 6e5f 726f 7773 203d 2020 6461  ack.n_rows =  da
+00077570: 7461 6469 6d5b 315d 2e63 6f70 7928 290d  tadim[1].copy().
+00077580: 0a20 2020 2020 2020 2023 546f 446f 3a20  .        #ToDo: 
+00077590: 4861 6e64 7368 616b 6520 6461 7461 0d0a  Handshake data..
+000775a0: 2020 2020 2020 2020 2373 656c 662e 7374          #self.st
+000775b0: 6163 6b2e 7873 6869 6674 7320 3d20 7365  ack.xshifts = se
+000775c0: 6c66 2e78 5f73 6869 6674 7374 656d 700d  lf.x_shiftstemp.
+000775d0: 0a20 2020 2020 2020 2023 7365 6c66 2e73  .        #self.s
+000775e0: 7461 636b 2e79 7368 6966 7473 203d 2073  tack.yshifts = s
+000775f0: 656c 662e 795f 7368 6966 7473 7465 6d70  elf.y_shiftstemp
+00077600: 0d0a 0d0a 2020 2020 2020 2020 2354 6f44  ....        #ToD
+00077610: 6f3a 2048 6f77 2074 6f20 6861 6e64 6c65  o: How to handle
+00077620: 2061 6c69 676e 6564 2069 3020 6461 7461   aligned i0 data
+00077630: 3f0d 0a0d 0a20 2020 2020 2020 2023 2069  ?....        # i
+00077640: 6620 7365 6c66 2e63 6f6d 2e69 305f 6c6f  f self.com.i0_lo
+00077650: 6164 6564 203d 3d20 313a 0d0a 2020 2020  aded == 1:..    
+00077660: 2020 2020 2320 2020 2020 6966 2073 656c      #     if sel
+00077670: 662e 636f 6d2e 7374 6163 6b5f 3464 203d  f.com.stack_4d =
+00077680: 3d20 303a 0d0a 2020 2020 2020 2020 2320  = 0:..        # 
+00077690: 2020 2020 2020 2020 2352 6573 697a 6520          #Resize 
+000776a0: 6f70 7469 6361 6c20 6465 6e73 6974 790d  optical density.
+000776b0: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+000776c0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+000776d0: 6528 7365 6c66 2e73 7461 636b 2e6e 5f65  e(self.stack.n_e
+000776e0: 7629 3a0d 0a20 2020 2020 2020 2023 0d0a  v):..        #..
+000776f0: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+00077700: 2020 2020 2020 696d 6720 3d20 7365 6c66        img = self
+00077710: 2e73 7461 636b 2e6f 6433 645b 3a2c 3a2c  .stack.od3d[:,:,
+00077720: 695d 0d0a 2020 2020 2020 2020 2320 2020  i]..        #   
+00077730: 2020 2020 2020 2020 2020 7368 6966 7465            shifte
+00077740: 645f 696d 6720 3d20 7365 6c66 2e73 7461  d_img = self.sta
+00077750: 636b 2e61 7070 6c79 5f69 6d61 6765 5f72  ck.apply_image_r
+00077760: 6567 6973 7472 6174 696f 6e28 696d 672c  egistration(img,
+00077770: 2073 656c 662e 7873 6869 6674 735b 695d   self.xshifts[i]
+00077780: 2c20 7365 6c66 2e79 7368 6966 7473 5b69  , self.yshifts[i
+00077790: 5d29 0d0a 2020 2020 2020 2020 2320 2020  ])..        #   
+000777a0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+000777b0: 7461 636b 2e6f 6433 645b 3a2c 3a2c 695d  tack.od3d[:,:,i]
+000777c0: 203d 2073 6869 6674 6564 5f69 6d67 0d0a   = shifted_img..
+000777d0: 2020 2020 2020 2020 230d 0a20 2020 2020          #..     
+000777e0: 2020 2023 0d0a 2020 2020 2020 2020 2320     #..        # 
+000777f0: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
+00077800: 636b 2e6f 6433 6420 3d20 7365 6c66 2e73  ck.od3d = self.s
+00077810: 7461 636b 2e6f 6433 645b 7365 6c66 2e78  tack.od3d[self.x
+00077820: 6c65 6674 3a73 656c 662e 7872 6967 6874  left:self.xright
+00077830: 2c20 7365 6c66 2e79 626f 7474 6f6d 3a73  , self.ybottom:s
+00077840: 656c 662e 7974 6f70 2c20 3a5d 0d0a 2020  elf.ytop, :]..  
+00077850: 2020 2020 2020 230d 0a20 2020 2020 2020        #..       
+00077860: 2023 2020 2020 2020 2020 2073 656c 662e   #         self.
+00077870: 7374 6163 6b2e 6f64 203d 2073 656c 662e  stack.od = self.
+00077880: 7374 6163 6b2e 6f64 3364 2e63 6f70 7928  stack.od3d.copy(
+00077890: 290d 0a20 2020 2020 2020 2023 2020 2020  )..        #    
+000778a0: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
+000778b0: 6f64 203d 206e 702e 7265 7368 6170 6528  od = np.reshape(
+000778c0: 7365 6c66 2e73 7461 636b 2e6f 642c 2028  self.stack.od, (
+000778d0: 7365 6c66 2e73 7461 636b 2e6e 5f63 6f6c  self.stack.n_col
+000778e0: 732a 7365 6c66 2e73 7461 636b 2e6e 5f72  s*self.stack.n_r
+000778f0: 6f77 732c 2073 656c 662e 7374 6163 6b2e  ows, self.stack.
+00077900: 6e5f 6576 292c 206f 7264 6572 3d27 4627  n_ev), order='F'
+00077910: 290d 0a20 2020 2020 2020 2023 0d0a 2020  )..        #..  
+00077920: 2020 2020 2020 2320 2020 2020 656c 7365        #     else
+00077930: 3a0d 0a20 2020 2020 2020 2023 2020 2020  :..        #    
+00077940: 2020 2020 2023 5265 7369 7a65 206f 7074       #Resize opt
+00077950: 6963 616c 2064 656e 7369 7479 2066 6f72  ical density for
+00077960: 2034 4420 7374 6163 6b0d 0a20 2020 2020   4D stack..     
+00077970: 2020 2023 0d0a 2020 2020 2020 2020 2320     #..        # 
+00077980: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+00077990: 2072 616e 6765 2873 656c 662e 7374 6163   range(self.stac
+000779a0: 6b2e 6e5f 6576 293a 0d0a 2020 2020 2020  k.n_ev):..      
+000779b0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+000779c0: 666f 7220 6a20 696e 2072 616e 6765 2873  for j in range(s
+000779d0: 656c 662e 7374 6163 6b2e 6e5f 7468 6574  elf.stack.n_thet
+000779e0: 6129 3a0d 0a20 2020 2020 2020 2023 2020  a):..        #  
+000779f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00077a00: 6d67 203d 2073 656c 662e 7374 6163 6b2e  mg = self.stack.
+00077a10: 6f64 3444 5b3a 2c3a 2c69 2c6a 5d0d 0a20  od4D[:,:,i,j].. 
+00077a20: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+00077a30: 2020 2020 2020 2020 2073 6869 6674 6564           shifted
+00077a40: 5f69 6d67 203d 2073 656c 662e 7374 6163  _img = self.stac
+00077a50: 6b2e 6170 706c 795f 696d 6167 655f 7265  k.apply_image_re
+00077a60: 6769 7374 7261 7469 6f6e 2869 6d67 2c20  gistration(img, 
+00077a70: 7365 6c66 2e78 7368 6966 7473 5b69 2c6a  self.xshifts[i,j
+00077a80: 5d2c 2073 656c 662e 7973 6869 6674 735b  ], self.yshifts[
+00077a90: 692c 6a5d 290d 0a20 2020 2020 2020 2023  i,j])..        #
+00077aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00077ab0: 2073 656c 662e 7374 6163 6b2e 6f64 3444   self.stack.od4D
+00077ac0: 5b3a 2c3a 2c69 2c6a 5d20 3d20 7368 6966  [:,:,i,j] = shif
+00077ad0: 7465 645f 696d 670d 0a20 2020 2020 2020  ted_img..       
+00077ae0: 2023 0d0a 2020 2020 2020 2020 2320 2020   #..        #   
+00077af0: 2020 2020 2020 7365 6c66 2e73 7461 636b        self.stack
+00077b00: 2e6f 6434 4420 3d20 7365 6c66 2e73 7461  .od4D = self.sta
+00077b10: 636b 2e6f 6434 445b 7365 6c66 2e78 6c65  ck.od4D[self.xle
+00077b20: 6674 3a73 656c 662e 7872 6967 6874 2c20  ft:self.xright, 
+00077b30: 7365 6c66 2e79 626f 7474 6f6d 3a73 656c  self.ybottom:sel
+00077b40: 662e 7974 6f70 2c20 3a2c 203a 5d0d 0a20  f.ytop, :, :].. 
+00077b50: 2020 2020 2020 2023 0d0a 2020 2020 2020         #..      
+00077b60: 2020 2320 2020 2020 2020 2020 7365 6c66    #         self
+00077b70: 2e73 7461 636b 2e6f 6433 6420 3d20 7365  .stack.od3d = se
+00077b80: 6c66 2e73 7461 636b 2e6f 6434 445b 3a2c  lf.stack.od4D[:,
+00077b90: 3a2c 3a2c 7365 6c66 2e69 7468 6574 615d  :,:,self.itheta]
+00077ba0: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
+00077bb0: 2020 2020 7365 6c66 2e73 7461 636b 2e6f      self.stack.o
+00077bc0: 6420 3d20 7365 6c66 2e73 7461 636b 2e6f  d = self.stack.o
+00077bd0: 6433 642e 636f 7079 2829 0d0a 2020 2020  d3d.copy()..    
+00077be0: 2020 2020 2320 2020 2020 2020 2020 6e5f      #         n_
+00077bf0: 7069 7865 6c73 203d 2073 656c 662e 7374  pixels = self.st
+00077c00: 6163 6b2e 6e5f 636f 6c73 2a73 656c 662e  ack.n_cols*self.
+00077c10: 7374 6163 6b2e 6e5f 726f 7773 0d0a 2020  stack.n_rows..  
+00077c20: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+00077c30: 7365 6c66 2e73 7461 636b 2e6f 6420 3d20  self.stack.od = 
+00077c40: 6e70 2e72 6573 6861 7065 2873 656c 662e  np.reshape(self.
+00077c50: 7374 6163 6b2e 6f64 2c20 286e 5f70 6978  stack.od, (n_pix
+00077c60: 656c 732c 2073 656c 662e 7374 6163 6b2e  els, self.stack.
+00077c70: 6e5f 6576 292c 206f 7264 6572 3d27 4627  n_ev), order='F'
+00077c80: 290d 0a20 2020 2020 2020 2023 0d0a 2020  )..        #..  
+00077c90: 2020 2020 2020 2320 2020 2020 7365 6c66        #     self
+00077ca0: 2e73 7461 636b 2e64 6174 615f 7374 7275  .stack.data_stru
+00077cb0: 6374 2e73 7065 6374 726f 6d69 6372 6f73  ct.spectromicros
+00077cc0: 636f 7079 2e6f 7074 6963 616c 5f64 656e  copy.optical_den
+00077cd0: 7369 7479 203d 2073 656c 662e 7374 6163  sity = self.stac
+00077ce0: 6b2e 6f64 0d0a 0d0a 2020 2020 2020 2020  k.od....        
+00077cf0: 7365 6c66 2e73 7461 636b 2e64 6174 615f  self.stack.data_
+00077d00: 7374 7275 6374 2e65 7863 6861 6e67 652e  struct.exchange.
+00077d10: 656e 6572 6779 203d 2073 656c 662e 7374  energy = self.st
+00077d20: 6163 6b2e 6576 0d0a 2020 2020 2020 2020  ack.ev..        
+00077d30: 2354 6f44 6f3a 2048 616e 6473 6861 6b65  #ToDo: Handshake
+00077d40: 2073 6869 6674 2064 6174 610d 0a20 2020   shift data..   
+00077d50: 2020 2020 2023 7365 6c66 2e73 7461 636b       #self.stack
+00077d60: 2e64 6174 615f 7374 7275 6374 2e73 7065  .data_struct.spe
+00077d70: 6374 726f 6d69 6372 6f73 636f 7079 2e78  ctromicroscopy.x
+00077d80: 7368 6966 7473 203d 2073 656c 662e 785f  shifts = self.x_
+00077d90: 7368 6966 7473 7465 6d70 0d0a 2020 2020  shiftstemp..    
+00077da0: 2020 2020 2373 656c 662e 7374 6163 6b2e      #self.stack.
+00077db0: 6461 7461 5f73 7472 7563 742e 7370 6563  data_struct.spec
+00077dc0: 7472 6f6d 6963 726f 7363 6f70 792e 7973  tromicroscopy.ys
+00077dd0: 6869 6674 7320 3d20 7365 6c66 2e79 5f73  hifts = self.y_s
+00077de0: 6869 6674 7374 656d 700d 0a0d 0a20 2020  hiftstemp....   
+00077df0: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
+00077e00: 2e70 6167 6531 2e73 6c69 6465 725f 656e  .page1.slider_en
+00077e10: 672e 7365 7452 616e 6765 2830 2c73 656c  g.setRange(0,sel
+00077e20: 662e 7374 6163 6b2e 6e5f 6576 2d31 290d  f.stack.n_ev-1).
+00077e30: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+00077e40: 7265 6e74 2e70 6167 6531 2e69 6576 203d  rent.page1.iev =
+00077e50: 2069 6e74 2873 656c 662e 7374 6163 6b2e   int(self.stack.
+00077e60: 6e5f 6576 2f32 290d 0a20 2020 2020 2020  n_ev/2)..       
+00077e70: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
+00077e80: 6531 2e73 6c69 6465 725f 656e 672e 7365  e1.slider_eng.se
+00077e90: 7456 616c 7565 2873 656c 662e 7061 7265  tValue(self.pare
+00077ea0: 6e74 2e70 6167 6531 2e69 6576 290d 0a0d  nt.page1.iev)...
+00077eb0: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+00077ec0: 7265 6e74 2e70 6167 6531 2e69 7820 3d20  rent.page1.ix = 
+00077ed0: 696e 7428 7365 6c66 2e73 7461 636b 2e6e  int(self.stack.n
+00077ee0: 5f63 6f6c 732f 3229 0d0a 2020 2020 2020  _cols/2)..      
+00077ef0: 2020 7365 6c66 2e70 6172 656e 742e 7061    self.parent.pa
+00077f00: 6765 312e 6979 203d 2069 6e74 2873 656c  ge1.iy = int(sel
+00077f10: 662e 7374 6163 6b2e 6e5f 726f 7773 2f32  f.stack.n_rows/2
+00077f20: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+00077f30: 662e 7061 7265 6e74 2e70 6167 6531 2e73  f.parent.page1.s
+00077f40: 686f 7753 7065 6374 7275 6d28 7365 6c66  howSpectrum(self
+00077f50: 2e70 6172 656e 742e 7061 6765 312e 6978  .parent.page1.ix
+00077f60: 2c20 7365 6c66 2e70 6172 656e 742e 7061  , self.parent.pa
+00077f70: 6765 312e 6979 290d 0a20 2020 2020 2020  ge1.iy)..       
+00077f80: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
+00077f90: 6531 2e6c 6f61 6449 6d61 6765 2829 0d0a  e1.loadImage()..
+00077fa0: 0d0a 2020 2020 2020 2020 6966 2073 686f  ..        if sho
+00077fb0: 776d 6170 7461 623a 0d0a 2020 2020 2020  wmaptab:..      
+00077fc0: 2020 2020 2020 7365 6c66 2e70 6172 656e        self.paren
+00077fd0: 742e 7061 6765 392e 436c 6561 7228 290d  t.page9.Clear().
+00077fe0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00077ff0: 662e 7061 7265 6e74 2e70 6167 6539 2e4c  f.parent.page9.L
+00078000: 6f61 6445 6e74 7269 6573 2829 0d0a 0d0a  oadEntries()....
+00078010: 2020 2020 2020 2020 7365 6c66 2e63 6c6f          self.clo
+00078020: 7365 2829 0d0a 0d0a 232d 2d2d 2d2d 2d2d  se()....#-------
+00078030: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00078040: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00078050: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00078060: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
+00078070: 0a63 6c61 7373 2053 7065 6374 7261 6c49  .class SpectralI
+00078080: 6d61 6765 4d61 7028 5174 5769 6467 6574  mageMap(QtWidget
+00078090: 732e 5144 6961 6c6f 672c 2051 7457 6964  s.QDialog, QtWid
+000780a0: 6765 7473 2e51 4772 6170 6869 6373 5363  gets.QGraphicsSc
+000780b0: 656e 6529 3a0d 0a20 2020 2023 6576 6c69  ene):..    #evli
+000780c0: 7374 6368 616e 6765 6420 3d20 7079 7174  stchanged = pyqt
+000780d0: 5369 676e 616c 285b 6f62 6a65 6374 5d29  Signal([object])
+000780e0: 0d0a 2020 2020 2374 6865 7461 6c69 7374  ..    #thetalist
+000780f0: 6368 616e 6765 6420 3d20 7079 7174 5369  changed = pyqtSi
+00078100: 676e 616c 285b 6f62 6a65 6374 5d29 0d0a  gnal([object])..
+00078110: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00078120: 2873 656c 662c 2070 6172 656e 742c 2063  (self, parent, c
+00078130: 6f6d 6d6f 6e2c 2073 7461 636b 293a 0d0a  ommon, stack):..
+00078140: 2020 2020 2020 2020 5174 5769 6467 6574          QtWidget
+00078150: 732e 5157 6964 6765 742e 5f5f 696e 6974  s.QWidget.__init
+00078160: 5f5f 2873 656c 662c 2070 6172 656e 7429  __(self, parent)
+00078170: 0d0a 2020 2020 2020 2020 7569 632e 6c6f  ..        uic.lo
+00078180: 6164 5569 286f 732e 7061 7468 2e6a 6f69  adUi(os.path.joi
+00078190: 6e28 6f73 2e70 6174 682e 6469 726e 616d  n(os.path.dirnam
+000781a0: 6528 6f73 2e70 6174 682e 6162 7370 6174  e(os.path.abspat
+000781b0: 6828 5f5f 6669 6c65 5f5f 2929 2c20 2773  h(__file__)), 's
+000781c0: 686f 7773 7065 6374 7261 6c72 6f69 2e75  howspectralroi.u
+000781d0: 6927 292c 2073 656c 6629 0d0a 2020 2020  i'), self)..    
+000781e0: 2020 2020 7365 6c66 2e70 6172 656e 7420      self.parent 
+000781f0: 3d20 7061 7265 6e74 0d0a 2020 2020 2020  = parent..      
+00078200: 2020 7365 6c66 2e73 7461 636b 203d 2073    self.stack = s
+00078210: 7461 636b 0d0a 2020 2020 2020 2020 7365  tack..        se
+00078220: 6c66 2e63 6f6d 203d 2063 6f6d 6d6f 6e0d  lf.com = common.
+00078230: 0a20 2020 2020 2020 2073 656c 662e 6965  .        self.ie
+00078240: 7620 3d20 300d 0a20 2020 2020 2020 2073  v = 0..        s
+00078250: 656c 662e 6974 6865 7461 203d 2030 0d0a  elf.itheta = 0..
+00078260: 2020 2020 2020 2020 2320 7365 6c66 2e73          # self.s
+00078270: 7461 636b 2e61 6273 6461 7461 5f73 6869  tack.absdata_shi
+00078280: 6674 6564 5f63 726f 7070 6564 203d 2073  fted_cropped = s
+00078290: 656c 662e 7374 6163 6b2e 6162 7364 6174  elf.stack.absdat
+000782a0: 615f 7368 6966 7465 642e 636f 7079 2829  a_shifted.copy()
+000782b0: 0d0a 0d0a 2020 2020 2020 2020 2320 7365  ....        # se
+000782c0: 6c66 2e70 6f6f 6c74 6872 6561 6420 3d20  lf.poolthread = 
+000782d0: 5174 436f 7265 2e51 5468 7265 6164 2829  QtCore.QThread()
+000782e0: 0d0a 2020 2020 2020 2020 2320 7365 6c66  ..        # self
+000782f0: 2e61 6c69 676e 6564 203d 2046 616c 7365  .aligned = False
+00078300: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
+00078310: 7574 746f 6e5f 6f6b 2e73 6574 456e 6162  utton_ok.setEnab
+00078320: 6c65 6428 5472 7565 290d 0a0d 0a20 2020  led(True)....   
+00078330: 2020 2020 2073 656c 662e 7365 7457 696e       self.setWin
+00078340: 646f 7754 6974 6c65 2827 5370 6563 7472  dowTitle('Spectr
+00078350: 616c 2049 6d61 6765 204d 6170 2729 0d0a  al Image Map')..
+00078360: 2020 2020 2020 2020 2373 656c 662e 7067          #self.pg
+00078370: 6c61 796f 7574 203d 2070 672e 4772 6170  layout = pg.Grap
+00078380: 6869 6373 4c61 796f 7574 2862 6f72 6465  hicsLayout(borde
+00078390: 723d 4e6f 6e65 290d 0a20 2020 2020 2020  r=None)..       
+000783a0: 2023 7365 6c66 2e63 616e 7661 732e 7365   #self.canvas.se
+000783b0: 7442 6163 6b67 726f 756e 6428 2277 2229  tBackground("w")
+000783c0: 2020 2320 6361 6e76 6173 2069 7320 6120    # canvas is a 
+000783d0: 7067 2e47 7261 7068 6963 7356 6965 7720  pg.GraphicsView 
+000783e0: 7769 6467 6574 0d0a 2020 2020 2020 2020  widget..        
+000783f0: 2373 656c 662e 6361 6e76 6173 2e73 6574  #self.canvas.set
+00078400: 4365 6e74 7261 6c57 6964 6765 7428 7365  CentralWidget(se
+00078410: 6c66 2e70 676c 6179 6f75 7429 0d0a 2020  lf.pglayout)..  
+00078420: 2020 2020 2020 2373 656c 662e 7662 203d        #self.vb =
+00078430: 2073 656c 662e 7067 6c61 796f 7574 2e61   self.pglayout.a
+00078440: 6464 5669 6577 426f 7828 290d 0a20 2020  ddViewBox()..   
+00078450: 2020 2020 2023 7365 6c66 2e76 622e 7365       #self.vb.se
+00078460: 7441 7370 6563 744c 6f63 6b65 6428 290d  tAspectLocked().
+00078470: 0a20 2020 2020 2020 2023 7365 6c66 2e69  .        #self.i
+00078480: 5f69 7465 6d20 3d20 7067 2e49 6d61 6765  _item = pg.Image
+00078490: 4974 656d 2862 6f72 6465 723d 226b 222c  Item(border="k",
+000784a0: 2070 6172 656e 743d 7365 6c66 290d 0a0d   parent=self)...
+000784b0: 0a20 2020 2020 2020 2023 7365 6c66 2e76  .        #self.v
+000784c0: 622e 7365 744d 6f75 7365 456e 6162 6c65  b.setMouseEnable
+000784d0: 6428 783d 4661 6c73 652c 2079 3d46 616c  d(x=False, y=Fal
+000784e0: 7365 290d 0a20 2020 2020 2020 2023 7365  se)..        #se
+000784f0: 6c66 2e76 622e 6164 6449 7465 6d28 7365  lf.vb.addItem(se
+00078500: 6c66 2e69 5f69 7465 6d2c 2069 676e 6f72  lf.i_item, ignor
+00078510: 6542 6f75 6e64 733d 4661 6c73 6529 0d0a  eBounds=False)..
+00078520: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
+00078530: 7574 746f 6e5f 6f6b 2e63 6c69 636b 6564  utton_ok.clicked
+00078540: 2e63 6f6e 6e65 6374 2873 656c 662e 4f6e  .connect(self.On
+00078550: 4163 6365 7074 290d 0a20 2020 2020 2020  Accept)..       
+00078560: 2073 656c 662e 6275 7474 6f6e 5f63 616e   self.button_can
+00078570: 6365 6c2e 636c 6963 6b65 642e 636f 6e6e  cel.clicked.conn
+00078580: 6563 7428 7365 6c66 2e4f 6e43 616e 6365  ect(self.OnCance
+00078590: 6c29 0d0a 0d0a 2020 2020 2020 2020 6966  l)....        if
+000785a0: 2073 656c 662e 636f 6d2e 7374 6163 6b5f   self.com.stack_
+000785b0: 6c6f 6164 6564 203d 3d20 313a 0d0a 2020  loaded == 1:..  
+000785c0: 2020 2020 2020 2320 2020 2020 7365 6c66        #     self
+000785d0: 2e6c 6162 656c 5f74 6865 7461 5f72 616e  .label_theta_ran
+000785e0: 6765 2e73 6574 5669 7369 626c 6528 4661  ge.setVisible(Fa
+000785f0: 6c73 6529 0d0a 2020 2020 2020 2020 2320  lse)..        # 
+00078600: 2020 2020 7365 6c66 2e73 6c69 6465 725f      self.slider_
+00078610: 7468 6574 612e 7365 7456 6973 6962 6c65  theta.setVisible
+00078620: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
+00078630: 2023 2020 2020 2073 656c 662e 6362 5f72   #     self.cb_r
+00078640: 656d 6f76 655f 7468 6574 612e 7365 7456  emove_theta.setV
+00078650: 6973 6962 6c65 2846 616c 7365 290d 0a20  isible(False).. 
+00078660: 2020 2020 2020 2023 2020 2020 2073 656c         #     sel
+00078670: 662e 6772 6f75 7042 6f78 5f74 6865 7461  f.groupBox_theta
+00078680: 2e73 6574 5669 7369 626c 6528 4661 6c73  .setVisible(Fals
+00078690: 6529 0d0a 2020 2020 2020 2020 2320 2020  e)..        #   
+000786a0: 2020 6966 2073 656c 662e 636f 6d2e 7374    if self.com.st
+000786b0: 6163 6b5f 3464 203d 3d20 313a 0d0a 2020  ack_4d == 1:..  
+000786c0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+000786d0: 7365 6c66 2e6c 6162 656c 5f74 6865 7461  self.label_theta
+000786e0: 5f72 616e 6765 2e73 6574 5669 7369 626c  _range.setVisibl
+000786f0: 6528 5472 7565 290d 0a20 2020 2020 2020  e(True)..       
+00078700: 2023 2020 2020 2020 2020 2073 656c 662e   #         self.
+00078710: 736c 6964 6572 5f74 6865 7461 2e73 6574  slider_theta.set
+00078720: 5669 7369 626c 6528 5472 7565 290d 0a20  Visible(True).. 
+00078730: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+00078740: 2073 656c 662e 6362 5f72 656d 6f76 655f   self.cb_remove_
+00078750: 7468 6574 612e 7365 7456 6973 6962 6c65  theta.setVisible
+00078760: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
+00078770: 2320 2020 2020 2020 2020 7365 6c66 2e67  #         self.g
+00078780: 726f 7570 426f 785f 7468 6574 612e 7365  roupBox_theta.se
+00078790: 7456 6973 6962 6c65 2854 7275 6529 0d0a  tVisible(True)..
+000787a0: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+000787b0: 2020 7365 6c66 2e73 6c69 6465 725f 7468    self.slider_th
+000787c0: 6574 612e 7365 7452 616e 6765 2830 2c20  eta.setRange(0, 
+000787d0: 7365 6c66 2e73 7461 636b 2e6e 5f74 6865  self.stack.n_the
+000787e0: 7461 202d 2031 290d 0a20 2020 2020 2020  ta - 1)..       
+000787f0: 2023 2020 2020 2020 2020 2073 656c 662e   #         self.
+00078800: 736c 6964 6572 5f74 6865 7461 2e76 616c  slider_theta.val
+00078810: 7565 4368 616e 6765 645b 696e 745d 2e63  ueChanged[int].c
+00078820: 6f6e 6e65 6374 2873 656c 662e 4f6e 5363  onnect(self.OnSc
+00078830: 726f 6c6c 5468 6574 6129 0d0a 2020 2020  rollTheta)..    
+00078840: 2020 2020 2320 2020 2020 2020 2020 7365      #         se
+00078850: 6c66 2e53 6574 7570 4c69 7374 5468 6574  lf.SetupListThet
+00078860: 6128 290d 0a20 2020 2020 2020 2023 2020  a()..        #  
+00078870: 2020 2023 2073 656c 662e 6d61 736b 6564     # self.masked
+00078880: 7661 6c73 203d 205b 5472 7565 5d20 2a20  vals = [True] * 
+00078890: 696e 7428 7365 6c66 2e73 7461 636b 2e6e  int(self.stack.n
+000788a0: 5f65 7629 0d0a 2020 2020 2020 2020 2320  _ev)..        # 
+000788b0: 2020 2020 2320 7365 6c66 2e73 7069 6e42      # self.spinB
+000788c0: 6f78 4572 726f 722e 7365 7445 6e61 626c  oxError.setEnabl
+000788d0: 6564 2846 616c 7365 290d 0a20 2020 2020  ed(False)..     
+000788e0: 2020 2023 2020 2020 2073 656c 662e 736c     #     self.sl
+000788f0: 6964 6572 5f65 6e67 2e73 6c69 6465 7250  ider_eng.sliderP
+00078900: 7265 7373 6564 2e63 6f6e 6e65 6374 2873  ressed.connect(s
+00078910: 656c 662e 5368 6f77 496d 6167 6529 0d0a  elf.ShowImage)..
+00078920: 2020 2020 2020 2020 2320 2020 2020 7365          #     se
+00078930: 6c66 2e73 6c69 6465 725f 656e 672e 736c  lf.slider_eng.sl
+00078940: 6964 6572 5265 6c65 6173 6564 2e63 6f6e  iderReleased.con
+00078950: 6e65 6374 2873 656c 662e 5368 6f77 496d  nect(self.ShowIm
+00078960: 6167 6529 0d0a 2020 2020 2020 2020 2320  age)..        # 
+00078970: 2020 2020 7365 6c66 2e73 6c69 6465 725f      self.slider_
+00078980: 656e 672e 7661 6c75 6543 6861 6e67 6564  eng.valueChanged
+00078990: 5b69 6e74 5d2e 636f 6e6e 6563 7428 7365  [int].connect(se
+000789a0: 6c66 2e4f 6e53 6372 6f6c 6c45 6e67 290d  lf.OnScrollEng).
+000789b0: 0a20 2020 2020 2020 2023 2020 2020 2073  .        #     s
+000789c0: 656c 662e 736c 6964 6572 5f65 6e67 2e73  elf.slider_eng.s
+000789d0: 6574 5261 6e67 6528 302c 2073 656c 662e  etRange(0, self.
+000789e0: 7374 6163 6b2e 6e5f 6576 202d 2031 290d  stack.n_ev - 1).
+000789f0: 0a20 2020 2020 2020 2023 2020 2020 2073  .        #     s
+00078a00: 656c 662e 7062 5f73 656c 6563 7461 6c6c  elf.pb_selectall
+00078a10: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
+00078a20: 2873 656c 662e 4f6e 5365 6c65 6374 416c  (self.OnSelectAl
+00078a30: 6c29 0d0a 2020 2020 2020 2020 2320 2020  l)..        #   
+00078a40: 2020 7365 6c66 2e70 625f 636c 6561 7261    self.pb_cleara
+00078a50: 6c6c 2e63 6c69 636b 6564 2e63 6f6e 6e65  ll.clicked.conne
+00078a60: 6374 2873 656c 662e 4f6e 436c 6561 7241  ct(self.OnClearA
+00078a70: 6c6c 290d 0a20 2020 2020 2020 2023 2020  ll)..        #  
+00078a80: 2020 2073 656c 662e 6576 6c69 7374 6368     self.evlistch
+00078a90: 616e 6765 642e 636f 6e6e 6563 7428 6c61  anged.connect(la
+00078aa0: 6d62 6461 2072 6f77 3a20 7365 6c66 2e71  mbda row: self.q
+00078ab0: 4c69 7374 4368 616e 6765 4861 6e64 6c65  ListChangeHandle
+00078ac0: 7228 726f 772c 2022 656e 6572 6779 2229  r(row, "energy")
+00078ad0: 290d 0a20 2020 2020 2020 2023 2020 2020  )..        #    
+00078ae0: 2073 656c 662e 7468 6574 616c 6973 7463   self.thetalistc
+00078af0: 6861 6e67 6564 2e63 6f6e 6e65 6374 286c  hanged.connect(l
+00078b00: 616d 6264 6120 726f 773a 2073 656c 662e  ambda row: self.
+00078b10: 714c 6973 7443 6861 6e67 6548 616e 646c  qListChangeHandl
+00078b20: 6572 2872 6f77 2c20 2274 6865 7461 2229  er(row, "theta")
+00078b30: 290d 0a20 2020 2020 2020 2023 2020 2020  )..        #    
+00078b40: 2023 2073 656c 662e 6576 5f77 6964 6765   # self.ev_widge
+00078b50: 742e 6974 656d 436c 6963 6b65 642e 636f  t.itemClicked.co
+00078b60: 6e6e 6563 7428 6c61 6d62 6461 2069 7465  nnect(lambda ite
+00078b70: 6d3a 2073 656c 662e 4f6e 4974 656d 436c  m: self.OnItemCl
+00078b80: 6963 6b65 6428 6974 656d 2929 0d0a 2020  icked(item))..  
+00078b90: 2020 2020 2020 2320 2020 2020 7365 6c66        #     self
+00078ba0: 2e65 765f 7769 6467 6574 2e6d 6f75 7365  .ev_widget.mouse
+00078bb0: 5072 6573 7345 7665 6e74 203d 2073 656c  PressEvent = sel
+00078bc0: 662e 6d6f 7573 6545 7665 6e74 4f6e 4556  f.mouseEventOnEV
+00078bd0: 4c69 7374 0d0a 2020 2020 2020 2020 2320  List..        # 
+00078be0: 2020 2020 7365 6c66 2e65 765f 7769 6467      self.ev_widg
+00078bf0: 6574 2e6d 6f75 7365 4d6f 7665 4576 656e  et.mouseMoveEven
+00078c00: 7420 3d20 7365 6c66 2e6d 6f75 7365 4576  t = self.mouseEv
+00078c10: 656e 744f 6e45 564c 6973 740d 0a20 2020  entOnEVList..   
+00078c20: 2020 2020 2023 2020 2020 2073 656c 662e       #     self.
+00078c30: 7468 6574 615f 7769 6467 6574 2e6d 6f75  theta_widget.mou
+00078c40: 7365 5072 6573 7345 7665 6e74 203d 2073  sePressEvent = s
+00078c50: 656c 662e 6d6f 7573 6545 7665 6e74 4f6e  elf.mouseEventOn
+00078c60: 5468 6574 614c 6973 740d 0a20 2020 2020  ThetaList..     
+00078c70: 2020 2023 2020 2020 2073 656c 662e 7468     #     self.th
+00078c80: 6574 615f 7769 6467 6574 2e6d 6f75 7365  eta_widget.mouse
+00078c90: 4d6f 7665 4576 656e 7420 3d20 7365 6c66  MoveEvent = self
+00078ca0: 2e6d 6f75 7365 4576 656e 744f 6e54 6865  .mouseEventOnThe
+00078cb0: 7461 4c69 7374 0d0a 2020 2020 2020 2020  taList..        
+00078cc0: 2020 2020 2320 7365 6c66 2e65 765f 7769      # self.ev_wi
+00078cd0: 6467 6574 2e69 7465 6d53 656c 6563 7469  dget.itemSelecti
+00078ce0: 6f6e 4368 616e 6765 642e 636f 6e6e 6563  onChanged.connec
+00078cf0: 7428 6c61 6d62 6461 2069 7465 6d3a 2073  t(lambda item: s
+00078d00: 656c 662e 4f6e 4974 656d 436c 6963 6b65  elf.OnItemClicke
+00078d10: 6428 6974 656d 2929 0d0a 2020 2020 2020  d(item))..      
+00078d20: 2020 2020 2020 2373 656c 662e 5365 7475        #self.Setu
+00078d30: 704c 6973 7445 5628 290d 0a20 2020 2020  pListEV()..     
+00078d40: 2020 2020 2020 2023 7365 6c66 2e4f 6e53         #self.OnS
+00078d50: 6372 6f6c 6c45 6e67 2830 290d 0a20 2020  crollEng(0)..   
+00078d60: 2020 2020 2020 2020 2023 7365 6c66 2e53           #self.S
+00078d70: 6574 7570 524f 4928 290d 0a20 2020 2020  etupROI()..     
+00078d80: 2020 2020 2020 2073 656c 662e 5365 7475         self.Setu
+00078d90: 7050 6c6f 7428 290d 0a0d 0a20 2020 2064  pPlot()....    d
+00078da0: 6566 204f 6e53 656c 6563 7469 6f6e 4368  ef OnSelectionCh
+00078db0: 616e 6765 6428 7365 6c66 293a 0d0a 2020  anged(self):..  
+00078dc0: 2020 2020 2020 2373 656c 662e 5265 6472        #self.Redr
+00078dd0: 6177 4e65 7750 6c6f 7428 290d 0a20 2020  awNewPlot()..   
+00078de0: 2020 2020 2023 2073 656c 662e 5570 6461       # self.Upda
+00078df0: 7465 496e 6469 6365 7328 290d 0a20 2020  teIndices()..   
+00078e00: 2020 2020 2073 656c 662e 7265 6769 6f6e       self.region
+00078e10: 5f69 302e 626c 6f63 6b53 6967 6e61 6c73  _i0.blockSignals
+00078e20: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
+00078e30: 6966 2073 656c 662e 6964 785f 7365 6c65  if self.idx_sele
+00078e40: 6374 6564 3a0d 0a20 2020 2020 2020 2020  cted:..         
+00078e50: 2020 2073 656c 662e 7265 6769 6f6e 5f69     self.region_i
+00078e60: 302e 7365 7452 6567 696f 6e28 5b73 656c  0.setRegion([sel
+00078e70: 662e 7374 6163 6b2e 6576 5b6d 696e 2873  f.stack.ev[min(s
+00078e80: 656c 662e 6964 785f 7365 6c65 6374 6564  elf.idx_selected
+00078e90: 295d 2c20 7365 6c66 2e73 7461 636b 2e65  )], self.stack.e
+00078ea0: 765b 6d61 7828 7365 6c66 2e69 6478 5f73  v[max(self.idx_s
+00078eb0: 656c 6563 7465 6429 5d5d 290d 0a20 2020  elected)]])..   
+00078ec0: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
+00078ed0: 6769 6f6e 5f69 302e 626c 6f63 6b53 6967  gion_i0.blockSig
+00078ee0: 6e61 6c73 2846 616c 7365 290d 0a20 2020  nals(False)..   
+00078ef0: 2020 2020 2020 2020 2023 7365 6c66 2e73           #self.s
+00078f00: 7065 6374 7275 6d5f 706c 6f74 7769 6467  pectrum_plotwidg
+00078f10: 6574 2e73 6574 5852 616e 6765 282a 7365  et.setXRange(*se
+00078f20: 6c66 2e72 6567 696f 6e5f 6930 2e67 6574  lf.region_i0.get
+00078f30: 5265 6769 6f6e 2829 290d 0a20 2020 2020  Region())..     
+00078f40: 2020 2020 2020 2023 7365 6c66 2e73 7065         #self.spe
+00078f50: 6374 7275 6d5f 706c 6f74 7769 6467 6574  ctrum_plotwidget
+00078f60: 2e73 6574 5952 616e 6765 286e 702e 6d69  .setYRange(np.mi
+00078f70: 6e28 7365 6c66 2e70 6c6f 7469 7465 6d5f  n(self.plotitem_
+00078f80: 6e65 772e 7944 6174 6129 2c20 6e70 2e6d  new.yData), np.m
+00078f90: 6178 2873 656c 662e 706c 6f74 6974 656d  ax(self.plotitem
+00078fa0: 5f6e 6577 2e79 4461 7461 2929 0d0a 2020  _new.yData))..  
+00078fb0: 2020 2020 2020 7265 7475 726e 0d0a 0d0a        return....
+00078fc0: 2020 2020 6465 6620 4765 6e65 7261 7465      def Generate
+00078fd0: 5370 6563 7472 756d 2873 656c 662c 2065  Spectrum(self, e
+00078fe0: 7673 656c 6563 7469 6f6e 293a 0d0a 2020  vselection):..  
+00078ff0: 2020 2020 2020 236c 6566 742c 7269 6768        #left,righ
+00079000: 742c 746f 702c 626f 7474 6f6d 203d 2073  t,top,bottom = s
+00079010: 656c 662e 4765 7452 6567 696f 6e28 290d  elf.GetRegion().
+00079020: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00079030: 2e63 6f6d 2e69 305f 6c6f 6164 6564 203d  .com.i0_loaded =
+00079040: 3d20 313a 0d0a 2020 2020 2020 2020 2020  = 1:..          
+00079050: 2020 6966 2073 656c 662e 636f 6d2e 7374    if self.com.st
+00079060: 6163 6b5f 3464 203d 3d20 313a 0d0a 2020  ack_4d == 1:..  
+00079070: 2020 2020 2020 2020 2020 2020 2020 746f                to
+00079080: 7461 6c20 3d20 7365 6c66 2e73 7461 636b  tal = self.stack
+00079090: 2e6f 6434 645b 3a2c 203a 2c20 3a2c 2069  .od4d[:, :, :, i
+000790a0: 6e74 2873 656c 662e 6974 6865 7461 295d  nt(self.itheta)]
+000790b0: 2e63 6f70 7928 290d 0a20 2020 2020 2020  .copy()..       
+000790c0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+000790d0: 2020 2020 2020 2020 2020 2020 746f 7461              tota
+000790e0: 6c20 3d20 7365 6c66 2e73 7461 636b 2e6f  l = self.stack.o
+000790f0: 6433 645b 3a2c 203a 2c20 3a5d 2e63 6f70  d3d[:, :, :].cop
+00079100: 7928 290d 0a0d 0a20 2020 2020 2020 2065  y()....        e
+00079110: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00079120: 2020 6966 2073 656c 662e 636f 6d2e 7374    if self.com.st
+00079130: 6163 6b5f 3464 203d 3d20 313a 0d0a 2020  ack_4d == 1:..  
+00079140: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00079150: 7420 3d20 5b73 656c 662e 7374 6163 6b2e  t = [self.stack.
+00079160: 7468 6574 615b 695d 2066 6f72 2069 2069  theta[i] for i i
+00079170: 6e20 7365 6c66 2e74 6865 7461 6964 785f  n self.thetaidx_
+00079180: 7365 6c65 6374 6564 5d0d 0a20 2020 2020  selected]..     
+00079190: 2020 2020 2020 2020 2020 2023 2073 656c             # sel
+000791a0: 662e 6c61 6265 6c5f 7468 6574 615f 7261  f.label_theta_ra
+000791b0: 6e67 652e 7365 7454 6578 7428 0d0a 2020  nge.setText(..  
+000791c0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000791d0: 2020 2020 2254 6865 7461 2072 616e 6765      "Theta range
+000791e0: 3a20 5b20 2220 2b20 7374 7228 6d69 6e28  : [ " + str(min(
+000791f0: 742c 2064 6566 6175 6c74 3d30 2929 202b  t, default=0)) +
+00079200: 2022 c2b0 202e 2e20 2220 2b20 7374 7228   ".. .. " + str(
+00079210: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00079220: 2020 2320 2020 2020 2020 2020 6d61 7828    #         max(
+00079230: 742c 2064 6566 6175 6c74 3d30 2929 202b  t, default=0)) +
+00079240: 2022 c2b0 205d 2c20 2320 7661 6c75 6573   ".. ], # values
+00079250: 3a20 2220 2b20 7374 7228 0d0a 2020 2020  : " + str(..    
+00079260: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+00079270: 2020 2020 2020 6c65 6e28 7429 2929 0d0a        len(t)))..
+00079280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00079290: 746f 7461 6c20 3d20 7365 6c66 2e73 7461  total = self.sta
+000792a0: 636b 2e73 7461 636b 3444 5b3a 2c20 3a2c  ck.stack4D[:, :,
+000792b0: 203a 2c20 696e 7428 7365 6c66 2e69 7468   :, int(self.ith
+000792c0: 6574 6129 5d2e 636f 7079 2829 0d0a 2020  eta)].copy()..  
+000792d0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+000792e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000792f0: 2074 6f74 616c 203d 2073 656c 662e 7374   total = self.st
+00079300: 6163 6b2e 6162 7364 6174 615b 3a2c 203a  ack.absdata[:, :
+00079310: 2c20 3a5d 2e63 6f70 7928 290d 0a20 2020  , :].copy()..   
+00079320: 2020 2020 2074 6f74 616c 203d 2074 6f74       total = tot
+00079330: 616c 2e73 756d 2861 7869 733d 2830 2c31  al.sum(axis=(0,1
+00079340: 2929 2023 2f20 2869 6e74 2873 656c 662e  )) #/ (int(self.
+00079350: 626f 782e 7369 7a65 2829 2e78 2829 2920  box.size().x()) 
+00079360: 2a20 696e 7428 7365 6c66 2e62 6f78 2e73  * int(self.box.s
+00079370: 697a 6528 292e 7928 2929 290d 0a20 2020  ize().y()))..   
+00079380: 2020 2020 2078 203d 2073 656c 662e 7374       x = self.st
+00079390: 6163 6b2e 6576 0d0a 2020 2020 2020 2020  ack.ev..        
+000793a0: 7920 3d20 746f 7461 6c0d 0a20 2020 2020  y = total..     
+000793b0: 2020 2023 7365 6c66 2e6c 6162 656c 5f73     #self.label_s
+000793c0: 7061 7469 616c 5f72 616e 6765 2e73 6574  patial_range.set
+000793d0: 5465 7874 2822 5374 6163 6b20 7369 7a65  Text("Stack size
+000793e0: 3a20 5b20 222b 7374 7228 696e 7428 7365  : [ "+str(int(se
+000793f0: 6c66 2e62 6f78 2e73 697a 6528 292e 7828  lf.box.size().x(
+00079400: 2929 292b 2220 7820 222b 7374 7228 696e  )))+" x "+str(in
+00079410: 7428 7365 6c66 2e62 6f78 2e73 697a 6528  t(self.box.size(
+00079420: 292e 7928 2929 292b 2220 5d20 7078 c2b2  ).y()))+" ] px..
+00079430: 2229 0d0a 2020 2020 2020 2020 2373 656c  ")..        #sel
+00079440: 662e 6c61 6265 6c5f 6576 5f72 616e 6765  f.label_ev_range
+00079450: 2e73 6574 5465 7874 280d 0a20 2020 2020  .setText(..     
+00079460: 2020 2023 2020 2020 2245 6e65 7267 7920     #    "Energy 
+00079470: 7261 6e67 653a 205b 2022 202b 2073 7472  range: [ " + str
+00079480: 286d 696e 2878 2c20 6465 6661 756c 743d  (min(x, default=
+00079490: 3029 2920 2b20 2220 2e2e 2022 202b 2073  0)) + " .. " + s
+000794a0: 7472 286d 6178 2878 2c20 6465 6661 756c  tr(max(x, defaul
+000794b0: 743d 3029 2920 2b20 2220 5d20 6556 2c20  t=0)) + " ] eV, 
+000794c0: 2320 7661 6c75 6573 3a20 222b 2073 7472  # values: "+ str
+000794d0: 286c 656e 2878 2929 290d 0a20 2020 2020  (len(x)))..     
+000794e0: 2020 2072 6574 7572 6e20 2878 2c20 7929     return (x, y)
+000794f0: 0d0a 2020 2020 2320 6465 6620 5570 6461  ..    # def Upda
+00079500: 7465 496e 6469 6365 7328 7365 6c66 293a  teIndices(self):
+00079510: 0d0a 2020 2020 2320 2020 2020 7365 6c66  ..    #     self
+00079520: 2e69 6478 5f73 656c 6563 7465 6420 3d20  .idx_selected = 
+00079530: 736f 7274 6564 285b 7365 6c66 2e65 765f  sorted([self.ev_
+00079540: 7769 6467 6574 2e72 6f77 2869 2920 666f  widget.row(i) fo
+00079550: 7220 6920 696e 2073 656c 662e 6576 5f73  r i in self.ev_s
+00079560: 656c 6563 7465 645d 290d 0a20 2020 2023  elected])..    #
+00079570: 2020 2020 2069 6620 7365 6c66 2e63 6f6d       if self.com
+00079580: 2e73 7461 636b 5f34 643a 0d0a 2020 2020  .stack_4d:..    
+00079590: 2320 2020 2020 2020 2020 7365 6c66 2e74  #         self.t
+000795a0: 6865 7461 6964 785f 7365 6c65 6374 6564  hetaidx_selected
+000795b0: 203d 2073 6f72 7465 6428 5b73 656c 662e   = sorted([self.
+000795c0: 7468 6574 615f 7769 6467 6574 2e72 6f77  theta_widget.row
+000795d0: 2869 2920 666f 7220 6920 696e 2073 656c  (i) for i in sel
+000795e0: 662e 7468 6574 615f 7365 6c65 6374 6564  f.theta_selected
+000795f0: 5d29 0d0a 2020 2020 230d 0a20 2020 2023  ])..    #..    #
+00079600: 2064 6566 2052 6564 7261 7750 6c6f 7473   def RedrawPlots
+00079610: 2873 656c 6629 3a0d 0a20 2020 2023 2020  (self):..    #  
+00079620: 2020 2078 2c20 7920 3d20 7365 6c66 2e47     x, y = self.G
+00079630: 656e 6572 6174 6553 7065 6374 7275 6d28  enerateSpectrum(
+00079640: 6c69 7374 2872 616e 6765 2873 656c 662e  list(range(self.
+00079650: 7374 6163 6b2e 6e5f 6576 2929 290d 0a20  stack.n_ev))).. 
+00079660: 2020 2023 2020 2020 2073 656c 662e 706c     #     self.pl
+00079670: 6f74 6974 656d 2e73 6574 4461 7461 2878  otitem.setData(x
+00079680: 2c20 7929 0d0a 2020 2020 2320 2020 2020  , y)..    #     
+00079690: 7365 6c66 2e4f 6e53 656c 6563 7469 6f6e  self.OnSelection
+000796a0: 4368 616e 6765 6428 290d 0a20 2020 2023  Changed()..    #
+000796b0: 0d0a 2020 2020 2320 6465 6620 5265 6472  ..    # def Redr
+000796c0: 6177 4e65 7750 6c6f 7428 7365 6c66 293a  awNewPlot(self):
+000796d0: 0d0a 2020 2020 2320 2020 2020 2373 656c  ..    #     #sel
+000796e0: 662e 5570 6461 7465 496e 6469 6365 7328  f.UpdateIndices(
+000796f0: 290d 0a20 2020 2023 2020 2020 2078 2c20  )..    #     x, 
+00079700: 7920 3d20 7365 6c66 2e47 656e 6572 6174  y = self.Generat
+00079710: 6553 7065 6374 7275 6d28 7365 6c66 2e69  eSpectrum(self.i
+00079720: 6478 5f73 656c 6563 7465 6429 0d0a 2020  dx_selected)..  
+00079730: 2020 2320 2020 2020 7365 6c66 2e70 6c6f    #     self.plo
+00079740: 7469 7465 6d5f 6e65 772e 7365 7444 6174  titem_new.setDat
+00079750: 6128 782c 2079 290d 0a20 2020 2023 2020  a(x, y)..    #  
+00079760: 2020 2069 6620 7365 6c66 2e69 6478 5f73     if self.idx_s
+00079770: 656c 6563 7465 643a 0d0a 2020 2020 2320  elected:..    # 
+00079780: 2020 2020 2020 2020 7365 6c66 2e72 6567          self.reg
+00079790: 696f 6e5f 6930 2e73 686f 7728 290d 0a20  ion_i0.show().. 
+000797a0: 2020 2023 0d0a 2020 2020 2320 6465 6620     #..    # def 
+000797b0: 714c 6973 7443 6861 6e67 6548 616e 646c  qListChangeHandl
+000797c0: 6572 2873 656c 662c 2072 6f77 2c20 6469  er(self, row, di
+000797d0: 6d65 6e73 696f 6e29 3a0d 0a20 2020 2023  mension):..    #
+000797e0: 2020 2020 2069 6620 6469 6d65 6e73 696f       if dimensio
+000797f0: 6e20 3d3d 2022 7468 6574 6122 3a0d 0a20  n == "theta":.. 
+00079800: 2020 2023 2020 2020 2020 2020 2073 656c     #         sel
+00079810: 6563 7469 6f6e 203d 2073 656c 662e 7468  ection = self.th
+00079820: 6574 615f 7365 6c65 6374 6564 0d0a 2020  eta_selected..  
+00079830: 2020 2320 2020 2020 2020 2020 7769 6467    #         widg
+00079840: 6574 203d 2073 656c 662e 7468 6574 615f  et = self.theta_
+00079850: 7769 6467 6574 0d0a 2020 2020 2320 2020  widget..    #   
+00079860: 2020 656c 6966 2064 696d 656e 7369 6f6e    elif dimension
+00079870: 203d 3d20 2265 6e65 7267 7922 3a0d 0a20   == "energy":.. 
+00079880: 2020 2023 2020 2020 2020 2020 2073 656c     #         sel
+00079890: 6563 7469 6f6e 203d 2073 656c 662e 6576  ection = self.ev
+000798a0: 5f73 656c 6563 7465 640d 0a20 2020 2023  _selected..    #
+000798b0: 2020 2020 2020 2020 2077 6964 6765 7420           widget 
+000798c0: 3d20 7365 6c66 2e65 765f 7769 6467 6574  = self.ev_widget
+000798d0: 0d0a 2020 2020 230d 0a20 2020 2023 2020  ..    #..    #  
+000798e0: 2020 2069 6620 726f 7720 696e 2073 656c     if row in sel
+000798f0: 6563 7469 6f6e 3a0d 0a20 2020 2023 2020  ection:..    #  
+00079900: 2020 2020 2020 2073 656c 6563 7469 6f6e         selection
+00079910: 2e72 656d 6f76 6528 726f 7729 0d0a 2020  .remove(row)..  
+00079920: 2020 2320 2020 2020 2020 2020 726f 772e    #         row.
+00079930: 7365 7442 6163 6b67 726f 756e 6428 5174  setBackground(Qt
+00079940: 4775 692e 5143 6f6c 6f72 2830 2c20 302c  Gui.QColor(0, 0,
+00079950: 2030 2c20 3029 290d 0a20 2020 2023 2020   0, 0))..    #  
+00079960: 2020 2065 6c73 653a 0d0a 2020 2020 2320     else:..    # 
+00079970: 2020 2020 2020 2020 7365 6c65 6374 696f          selectio
+00079980: 6e2e 6170 7065 6e64 2872 6f77 290d 0a20  n.append(row).. 
+00079990: 2020 2023 2020 2020 2020 2020 2072 6f77     #         row
+000799a0: 2e73 6574 4261 636b 6772 6f75 6e64 2851  .setBackground(Q
+000799b0: 7447 7569 2e51 436f 6c6f 7228 2723 6265  tGui.QColor('#be
+000799c0: 6165 6434 2729 290d 0a20 2020 2023 2020  aed4'))..    #  
+000799d0: 2020 2069 6620 6469 6d65 6e73 696f 6e20     if dimension 
+000799e0: 3d3d 2022 7468 6574 6122 3a0d 0a20 2020  == "theta":..   
+000799f0: 2023 2020 2020 2020 2020 2073 656c 662e   #         self.
+00079a00: 4f6e 5363 726f 6c6c 5468 6574 6128 7769  OnScrollTheta(wi
+00079a10: 6467 6574 2e72 6f77 2872 6f77 2929 0d0a  dget.row(row))..
+00079a20: 2020 2020 2320 2020 2020 656c 6966 2064      #     elif d
+00079a30: 696d 656e 7369 6f6e 203d 3d20 2265 6e65  imension == "ene
+00079a40: 7267 7922 3a0d 0a20 2020 2023 2020 2020  rgy":..    #    
+00079a50: 2020 2020 2073 656c 662e 4f6e 5363 726f       self.OnScro
+00079a60: 6c6c 456e 6728 7769 6467 6574 2e72 6f77  llEng(widget.row
+00079a70: 2872 6f77 2929 0d0a 2020 2020 2320 2020  (row))..    #   
+00079a80: 2020 7365 6c66 2e4f 6e53 656c 6563 7469    self.OnSelecti
+00079a90: 6f6e 4368 616e 6765 6428 290d 0a0d 0a20  onChanged().... 
+00079aa0: 2020 2064 6566 2053 6574 7570 506c 6f74     def SetupPlot
+00079ab0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00079ac0: 2078 2c20 7920 3d20 7365 6c66 2e47 656e   x, y = self.Gen
+00079ad0: 6572 6174 6553 7065 6374 7275 6d28 6c69  erateSpectrum(li
+00079ae0: 7374 2872 616e 6765 2873 656c 662e 7374  st(range(self.st
+00079af0: 6163 6b2e 6e5f 6576 2929 290d 0a20 2020  ack.n_ev)))..   
+00079b00: 2020 2020 2073 656c 662e 7370 6563 7472       self.spectr
+00079b10: 756d 5f70 6c6f 7477 6964 6765 742e 7365  um_plotwidget.se
+00079b20: 7442 6163 6b67 726f 756e 6428 2277 2229  tBackground("w")
+00079b30: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00079b40: 2e72 6567 696f 6e5f 6930 203d 2070 672e  .region_i0 = pg.
+00079b50: 4c69 6e65 6172 5265 6769 6f6e 4974 656d  LinearRegionItem
+00079b60: 2862 7275 7368 3d51 7447 7569 2e51 436f  (brush=QtGui.QCo
+00079b70: 6c6f 7228 2723 3838 6265 6165 6434 2729  lor('#88beaed4')
+00079b80: 2c68 6f76 6572 4272 7573 683d 5174 4775  ,hoverBrush=QtGu
+00079b90: 692e 5143 6f6c 6f72 2827 2363 6362 6561  i.QColor('#ccbea
+00079ba0: 6564 3427 292c 2062 6f75 6e64 733d 5b6e  ed4'), bounds=[n
+00079bb0: 702e 6d69 6e28 7829 2c20 6e70 2e6d 6178  p.min(x), np.max
+00079bc0: 2878 295d 290d 0a20 2020 2020 2020 2073  (x)])..        s
+00079bd0: 656c 662e 7265 6769 6f6e 5f69 302e 7365  elf.region_i0.se
+00079be0: 745a 5661 6c75 6528 3130 290d 0a20 2020  tZValue(10)..   
+00079bf0: 2020 2020 2073 656c 662e 7265 6769 6f6e       self.region
+00079c00: 5f69 203d 2070 672e 4c69 6e65 6172 5265  _i = pg.LinearRe
+00079c10: 6769 6f6e 4974 656d 2862 7275 7368 3d51  gionItem(brush=Q
+00079c20: 7447 7569 2e51 436f 6c6f 7228 2723 3838  tGui.QColor('#88
+00079c30: 3766 6339 3766 2729 2c68 6f76 6572 4272  7fc97f'),hoverBr
+00079c40: 7573 683d 5174 4775 692e 5143 6f6c 6f72  ush=QtGui.QColor
+00079c50: 2827 2363 6337 6663 3937 6627 292c 2062  ('#cc7fc97f'), b
+00079c60: 6f75 6e64 733d 5b6e 702e 6d69 6e28 7829  ounds=[np.min(x)
+00079c70: 2c20 6e70 2e6d 6178 2878 295d 290d 0a20  , np.max(x)]).. 
+00079c80: 2020 2020 2020 2073 656c 662e 7265 6769         self.regi
+00079c90: 6f6e 5f69 2e73 6574 5a56 616c 7565 2831  on_i.setZValue(1
+00079ca0: 3029 0d0a 0d0a 2020 2020 2020 2020 706c  0)....        pl
+00079cb0: 6f74 203d 2073 656c 662e 7370 6563 7472  ot = self.spectr
+00079cc0: 756d 5f70 6c6f 7477 6964 6765 740d 0a20  um_plotwidget.. 
+00079cd0: 2020 2020 2020 2070 6c6f 742e 7365 7442         plot.setB
+00079ce0: 6163 6b67 726f 756e 6428 2277 2229 0d0a  ackground("w")..
+00079cf0: 2020 2020 2020 2020 706c 6f74 2e61 6464          plot.add
+00079d00: 4974 656d 2873 656c 662e 7265 6769 6f6e  Item(self.region
+00079d10: 5f69 302c 2069 676e 6f72 6542 6f75 6e64  _i0, ignoreBound
+00079d20: 733d 4661 6c73 6529 0d0a 2020 2020 2020  s=False)..      
+00079d30: 2020 706c 6f74 2e61 6464 4974 656d 2873    plot.addItem(s
+00079d40: 656c 662e 7265 6769 6f6e 5f69 2c20 6967  elf.region_i, ig
+00079d50: 6e6f 7265 426f 756e 6473 3d46 616c 7365  noreBounds=False
+00079d60: 290d 0a20 2020 2020 2020 2070 6c6f 742e  )..        plot.
+00079d70: 7365 744d 6f75 7365 456e 6162 6c65 6428  setMouseEnabled(
+00079d80: 783d 4661 6c73 652c 2079 3d46 616c 7365  x=False, y=False
+00079d90: 290d 0a20 2020 2020 2020 2070 6c6f 742e  )..        plot.
+00079da0: 7368 6f77 4772 6964 2879 3d54 7275 6529  showGrid(y=True)
+00079db0: 0d0a 0d0a 2020 2020 2020 2020 706c 6f74  ....        plot
+00079dc0: 2e73 686f 7741 7869 7328 2274 6f70 222c  .showAxis("top",
+00079dd0: 2073 686f 773d 5472 7565 290d 0a20 2020   show=True)..   
+00079de0: 2020 2020 2070 6c6f 742e 7368 6f77 4178       plot.showAx
+00079df0: 6973 2822 7269 6768 7422 2c20 7368 6f77  is("right", show
+00079e00: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
+00079e10: 6279 203d 2070 6c6f 742e 6765 7441 7869  by = plot.getAxi
+00079e20: 7328 2272 6967 6874 2229 0d0a 2020 2020  s("right")..    
+00079e30: 2020 2020 6278 203d 2070 6c6f 742e 6765      bx = plot.ge
+00079e40: 7441 7869 7328 2274 6f70 2229 0d0a 2020  tAxis("top")..  
+00079e50: 2020 2020 2020 6279 2e73 6574 5374 796c        by.setStyl
+00079e60: 6528 7368 6f77 5661 6c75 6573 3d46 616c  e(showValues=Fal
+00079e70: 7365 2c20 7469 636b 4c65 6e67 7468 3d30  se, tickLength=0
+00079e80: 290d 0a20 2020 2020 2020 2062 782e 7365  )..        bx.se
+00079e90: 7453 7479 6c65 2873 686f 7756 616c 7565  tStyle(showValue
+00079ea0: 733d 4661 6c73 652c 2074 6963 6b4c 656e  s=False, tickLen
+00079eb0: 6774 683d 3029 0d0a 2020 2020 2020 2020  gth=0)..        
+00079ec0: 6179 203d 2070 6c6f 742e 6765 7441 7869  ay = plot.getAxi
+00079ed0: 7328 226c 6566 7422 290d 0a20 2020 2020  s("left")..     
+00079ee0: 2020 2061 7820 3d20 706c 6f74 2e67 6574     ax = plot.get
+00079ef0: 4178 6973 2822 626f 7474 6f6d 2229 0d0a  Axis("bottom")..
+00079f00: 0d0a 2020 2020 2020 2020 6178 2e73 6574  ..        ax.set
+00079f10: 4c61 6265 6c28 7465 7874 3d22 5068 6f74  Label(text="Phot
+00079f20: 6f6e 2065 6e65 7267 7920 5b65 565d 2229  on energy [eV]")
+00079f30: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00079f40: 662e 636f 6d2e 6930 5f6c 6f61 6465 643a  f.com.i0_loaded:
+00079f50: 0d0a 2020 2020 2020 2020 2020 2020 6179  ..            ay
+00079f60: 2e73 6574 4c61 6265 6c28 7465 7874 3d22  .setLabel(text="
+00079f70: 4f70 7469 6361 6c20 6465 6e73 6974 7922  Optical density"
+00079f80: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+00079f90: 0d0a 2020 2020 2020 2020 2020 2020 6179  ..            ay
+00079fa0: 2e73 6574 4c61 6265 6c28 7465 7874 3d22  .setLabel(text="
+00079fb0: 5068 6f74 6f6e 2066 6c75 7820 5b63 7073  Photon flux [cps
+00079fc0: 5d22 290d 0a0d 0a20 2020 2020 2020 2073  ]")....        s
+00079fd0: 656c 662e 706c 6f74 6974 656d 203d 2070  elf.plotitem = p
+00079fe0: 6c6f 742e 706c 6f74 2878 2c20 792c 2070  lot.plot(x, y, p
+00079ff0: 656e 3d70 672e 6d6b 5065 6e28 636f 6c6f  en=pg.mkPen(colo
+0007a000: 723d 2262 222c 2077 6964 7468 3d32 2929  r="b", width=2))
+0007a010: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+0007a020: 6c6f 7469 7465 6d2e 7365 745a 5661 6c75  lotitem.setZValu
+0007a030: 6528 3130 3029 0d0a 2020 2020 2020 2020  e(100)..        
+0007a040: 2320 7365 6c66 2e70 6c6f 7469 7465 6d5f  # self.plotitem_
+0007a050: 6e65 7720 3d20 706c 6f74 2e70 6c6f 7428  new = plot.plot(
+0007a060: 782c 2079 2c20 7065 6e3d 7067 2e6d 6b50  x, y, pen=pg.mkP
+0007a070: 656e 2863 6f6c 6f72 3d22 6222 2c20 7769  en(color="b", wi
+0007a080: 6474 683d 3229 290d 0a20 2020 2020 2020  dth=2))..       
+0007a090: 2023 2073 656c 662e 7265 666d 6172 6b65   # self.refmarke
+0007a0a0: 7220 3d20 7067 2e49 6e66 696e 6974 654c  r = pg.InfiniteL
+0007a0b0: 696e 6528 616e 676c 653d 3930 2c20 6d6f  ine(angle=90, mo
+0007a0c0: 7661 626c 653d 4661 6c73 652c 0d0a 2020  vable=False,..  
+0007a0d0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+0007a0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007a0f0: 2020 2020 2020 2020 2070 656e 3d70 672e           pen=pg.
+0007a100: 6d6b 5065 6e28 636f 6c6f 723d 2262 222c  mkPen(color="b",
+0007a110: 2077 6964 7468 3d32 2c20 7374 796c 653d   width=2, style=
+0007a120: 5174 436f 7265 2e51 742e 4461 7368 4c69  QtCore.Qt.DashLi
+0007a130: 6e65 2929 0d0a 2020 2020 2020 2020 2370  ne))..        #p
+0007a140: 6c6f 742e 6164 6449 7465 6d28 7365 6c66  lot.addItem(self
+0007a150: 2e72 6566 6d61 726b 6572 2c20 6967 6e6f  .refmarker, igno
+0007a160: 7265 426f 756e 6473 3d54 7275 6529 0d0a  reBounds=True)..
+0007a170: 2020 2020 2020 2020 7365 6c66 2e72 6567          self.reg
+0007a180: 696f 6e5f 6930 2e73 6574 5265 6769 6f6e  ion_i0.setRegion
+0007a190: 2828 6d69 6e28 7829 2c20 6d69 6e28 7829  ((min(x), min(x)
+0007a1a0: 2b30 2e32 352a 286d 6178 2878 292d 6d69  +0.25*(max(x)-mi
+0007a1b0: 6e28 7829 2929 290d 0a20 2020 2020 2020  n(x))))..       
+0007a1c0: 2073 656c 662e 7265 6769 6f6e 5f69 2e73   self.region_i.s
+0007a1d0: 6574 5265 6769 6f6e 2828 286d 6178 2878  etRegion(((max(x
+0007a1e0: 292d 302e 3235 2a28 6d61 7828 7829 2d6d  )-0.25*(max(x)-m
+0007a1f0: 696e 2878 2929 292c 206d 6178 2878 2929  in(x))), max(x))
+0007a200: 290d 0a20 2020 2020 2020 2023 7365 6c66  )..        #self
+0007a210: 2e72 6567 696f 6e5f 6930 2e73 6967 5265  .region_i0.sigRe
+0007a220: 6769 6f6e 4368 616e 6765 2e63 6f6e 6e65  gionChange.conne
+0007a230: 6374 2873 656c 662e 5570 6461 7465 5365  ct(self.UpdateSe
+0007a240: 6c65 6374 696f 6e29 0d0a 2020 2020 2020  lection)..      
+0007a250: 2020 2373 656c 662e 7265 6769 6f6e 5f69    #self.region_i
+0007a260: 2e73 6967 5265 6769 6f6e 4368 616e 6765  .sigRegionChange
+0007a270: 2e63 6f6e 6e65 6374 2873 656c 662e 5570  .connect(self.Up
+0007a280: 6461 7465 5365 6c65 6374 696f 6e29 0d0a  dateSelection)..
+0007a290: 2020 2020 2020 2020 7365 6c66 2e72 6567          self.reg
+0007a2a0: 696f 6e5f 6930 2e73 6967 5265 6769 6f6e  ion_i0.sigRegion
+0007a2b0: 4368 616e 6765 4669 6e69 7368 6564 2e63  ChangeFinished.c
+0007a2c0: 6f6e 6e65 6374 2873 656c 662e 5570 6461  onnect(self.Upda
+0007a2d0: 7465 5365 6c65 6374 696f 6e29 0d0a 2020  teSelection)..  
+0007a2e0: 2020 2020 2020 7365 6c66 2e72 6567 696f        self.regio
+0007a2f0: 6e5f 692e 7369 6752 6567 696f 6e43 6861  n_i.sigRegionCha
+0007a300: 6e67 6546 696e 6973 6865 642e 636f 6e6e  ngeFinished.conn
+0007a310: 6563 7428 7365 6c66 2e55 7064 6174 6553  ect(self.UpdateS
+0007a320: 656c 6563 7469 6f6e 290d 0a20 2020 2023  election)..    #
+0007a330: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
+0007a340: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007a350: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007a360: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007a370: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6566  -------..    def
+0007a380: 2067 6574 4461 7461 436c 6f73 6573 7454   getDataClosestT
+0007a390: 6f52 6567 696f 6e28 7365 6c66 2c20 7265  oRegion(self, re
+0007a3a0: 6769 6f6e 2c20 706c 6f74 6974 656d 2c20  gion, plotitem, 
+0007a3b0: 736e 6170 7265 6769 6f6e 3d54 7275 6529  snapregion=True)
+0007a3c0: 3a0d 0a20 2020 2020 2020 2023 6f74 6865  :..        #othe
+0007a3d0: 7272 6567 696f 6e20 3d20 7b73 656c 662e  rregion = {self.
+0007a3e0: 7265 6769 6f6e 5f69 203a 2073 656c 662e  region_i : self.
+0007a3f0: 7265 6769 6f6e 5f69 302c 2073 656c 662e  region_i0, self.
+0007a400: 7265 6769 6f6e 5f69 303a 2073 656c 662e  region_i0: self.
+0007a410: 7265 6769 6f6e 5f69 7d0d 0a20 2020 2020  region_i}..     
+0007a420: 2020 206d 696e 6964 782c 206d 6178 6964     minidx, maxid
+0007a430: 7820 3d20 7265 6769 6f6e 2e67 6574 5265  x = region.getRe
+0007a440: 6769 6f6e 2829 0d0a 2020 2020 2020 2020  gion()..        
+0007a450: 6461 7461 203d 2070 6c6f 7469 7465 6d2e  data = plotitem.
+0007a460: 6765 7444 6174 6128 295b 305d 0d0a 2020  getData()[0]..  
+0007a470: 2020 2020 2020 696e 6465 7820 3d20 6c61        index = la
+0007a480: 6d62 6461 2078 3a20 6e70 2e61 7267 6d69  mbda x: np.argmi
+0007a490: 6e28 6e70 2e61 6273 2864 6174 6120 2d20  n(np.abs(data - 
+0007a4a0: 7829 290d 0a20 2020 2020 2020 206d 696e  x))..        min
+0007a4b0: 6964 7820 3d20 696e 6465 7828 6d69 6e69  idx = index(mini
+0007a4c0: 6478 290d 0a20 2020 2020 2020 206d 6178  dx)..        max
+0007a4d0: 6964 7820 3d20 696e 6465 7828 6d61 7869  idx = index(maxi
+0007a4e0: 6478 290d 0a20 2020 2020 2020 2069 6620  dx)..        if 
+0007a4f0: 6d69 6e69 6478 203d 3d20 6d61 7869 6478  minidx == maxidx
+0007a500: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
+0007a510: 696e 6964 7820 3d20 300d 0a20 2020 2020  inidx = 0..     
+0007a520: 2020 2020 2020 206d 6178 6964 7820 3d20         maxidx = 
+0007a530: 6e70 2e61 7267 6d61 7828 6461 7461 290d  np.argmax(data).
+0007a540: 0a20 2020 2020 2020 206d 696e 6461 7461  .        mindata
+0007a550: 203d 2064 6174 615b 6d69 6e69 6478 5d0d   = data[minidx].
+0007a560: 0a20 2020 2020 2020 206d 6178 6461 7461  .        maxdata
+0007a570: 203d 2064 6174 615b 6d61 7869 6478 5d0d   = data[maxidx].
+0007a580: 0a20 2020 2020 2020 2069 6620 7265 6769  .        if regi
+0007a590: 6f6e 203d 3d20 7365 6c66 2e72 6567 696f  on == self.regio
+0007a5a0: 6e5f 693a 0d0a 2020 2020 2020 2020 2020  n_i:..          
+0007a5b0: 2020 7365 6c66 2e72 6567 696f 6e5f 6930    self.region_i0
+0007a5c0: 2e73 6574 426f 756e 6473 2828 6d69 6e28  .setBounds((min(
+0007a5d0: 6461 7461 292c 2064 6174 615b 6d69 6e69  data), data[mini
+0007a5e0: 6478 5d29 290d 0a20 2020 2020 2020 2065  dx]))..        e
+0007a5f0: 6c69 6620 7265 6769 6f6e 203d 3d20 7365  lif region == se
+0007a600: 6c66 2e72 6567 696f 6e5f 6930 3a0d 0a20  lf.region_i0:.. 
+0007a610: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0007a620: 7265 6769 6f6e 5f69 2e73 6574 426f 756e  region_i.setBoun
+0007a630: 6473 2828 6461 7461 5b6d 6178 6964 785d  ds((data[maxidx]
+0007a640: 2c20 6d61 7828 6461 7461 2929 290d 0a20  , max(data))).. 
+0007a650: 2020 2020 2020 2069 6620 736e 6170 7265         if snapre
+0007a660: 6769 6f6e 3a0d 0a20 2020 2020 2020 2020  gion:..         
+0007a670: 2020 2072 6567 696f 6e2e 626c 6f63 6b53     region.blockS
+0007a680: 6967 6e61 6c73 2854 7275 6529 0d0a 2020  ignals(True)..  
+0007a690: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
+0007a6a0: 2e73 6574 5265 6769 6f6e 285b 6d69 6e64  .setRegion([mind
+0007a6b0: 6174 612c 206d 6178 6461 7461 5d29 2020  ata, maxdata])  
+0007a6c0: 2320 736e 6170 2072 6567 696f 6e20 746f  # snap region to
+0007a6d0: 2064 6174 6120 706f 696e 7473 0d0a 2020   data points..  
+0007a6e0: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
+0007a6f0: 2e62 6c6f 636b 5369 676e 616c 7328 4661  .blockSignals(Fa
+0007a700: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
+0007a710: 2020 2373 656c 662e 7061 7265 6e74 2e4f    #self.parent.O
+0007a720: 6e53 656c 6563 7469 6f6e 4368 616e 6765  nSelectionChange
+0007a730: 6428 290d 0a20 2020 2020 2020 2072 6574  d()..        ret
+0007a740: 7572 6e20 6d69 6e69 6478 2c20 6d61 7869  urn minidx, maxi
+0007a750: 6478 2c20 6d69 6e64 6174 612c 206d 6178  dx, mindata, max
+0007a760: 6461 7461 0d0a 0d0a 2020 2020 6465 6620  data....    def 
+0007a770: 5570 6461 7465 5365 6c65 6374 696f 6e28  UpdateSelection(
+0007a780: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+0007a790: 6d69 6e69 302c 206d 6178 6930 2c20 6d69  mini0, maxi0, mi
+0007a7a0: 6e64 6930 2c20 6d61 7864 6930 203d 2073  ndi0, maxdi0 = s
+0007a7b0: 656c 662e 6765 7444 6174 6143 6c6f 7365  elf.getDataClose
+0007a7c0: 7374 546f 5265 6769 6f6e 2873 656c 662e  stToRegion(self.
+0007a7d0: 7265 6769 6f6e 5f69 302c 7365 6c66 2e70  region_i0,self.p
+0007a7e0: 6c6f 7469 7465 6d29 0d0a 2020 2020 2020  lotitem)..      
+0007a7f0: 2020 6d69 6e69 2c20 6d61 7869 2c20 6d69    mini, maxi, mi
+0007a800: 6e64 692c 206d 6178 6469 203d 2073 656c  ndi, maxdi = sel
+0007a810: 662e 6765 7444 6174 6143 6c6f 7365 7374  f.getDataClosest
+0007a820: 546f 5265 6769 6f6e 2873 656c 662e 7265  ToRegion(self.re
+0007a830: 6769 6f6e 5f69 2c73 656c 662e 706c 6f74  gion_i,self.plot
+0007a840: 6974 656d 290d 0a20 2020 2020 2020 2023  item)..        #
+0007a850: 7365 6c66 2e72 6567 696f 6e5f 6930 2e62  self.region_i0.b
+0007a860: 6c6f 636b 5369 676e 616c 7328 5472 7565  lockSignals(True
+0007a870: 290d 0a20 2020 2020 2020 2023 7365 6c66  )..        #self
+0007a880: 2e72 6567 696f 6e5f 692e 626c 6f63 6b53  .region_i.blockS
+0007a890: 6967 6e61 6c73 2854 7275 6529 0d0a 2020  ignals(True)..  
+0007a8a0: 2020 2020 2020 2373 656c 662e 7265 6769        #self.regi
+0007a8b0: 6f6e 5f69 302e 7365 7442 6f75 6e64 7328  on_i0.setBounds(
+0007a8c0: 286d 696e 2873 656c 662e 706c 6f74 6974  (min(self.plotit
 0007a8d0: 656d 2e67 6574 4461 7461 2829 5b30 5d29  em.getData()[0])
-0007a8e0: 2929 0d0a 2020 2020 2020 2020 2373 656c  ))..        #sel
-0007a8f0: 662e 7265 6769 6f6e 5f69 302e 626c 6f63  f.region_i0.bloc
-0007a900: 6b53 6967 6e61 6c73 2846 616c 7365 290d  kSignals(False).
-0007a910: 0a20 2020 2020 2020 2023 7365 6c66 2e72  .        #self.r
-0007a920: 6567 696f 6e5f 692e 626c 6f63 6b53 6967  egion_i.blockSig
-0007a930: 6e61 6c73 2846 616c 7365 290d 0a0d 0a20  nals(False).... 
-0007a940: 2020 2020 2020 2071 6c69 7374 203d 2073         qlist = s
-0007a950: 656c 662e 7061 7265 6e74 2e4d 6170 5365  elf.parent.MapSe
-0007a960: 6c65 6374 5769 6467 6574 310d 0a20 2020  lectWidget1..   
-0007a970: 2020 2020 2066 6f72 2072 6f77 2069 6e20       for row in 
-0007a980: 7261 6e67 6528 716c 6973 742e 636f 756e  range(qlist.coun
-0007a990: 7428 2929 3a0d 0a20 2020 2020 2020 2020  t()):..         
-0007a9a0: 2020 2069 6620 726f 7720 696e 2072 616e     if row in ran
-0007a9b0: 6765 286d 696e 6930 2c20 6d61 7869 3029  ge(mini0, maxi0)
-0007a9c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0007a9d0: 2020 2073 656c 662e 7374 6163 6b2e 7368     self.stack.sh
-0007a9e0: 6966 7473 5b72 6f77 5d5b 315d 3d20 2d31  ifts[row][1]= -1
-0007a9f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0007aa00: 2020 716c 6973 742e 6974 656d 2872 6f77    qlist.item(row
-0007aa10: 292e 7365 7442 6163 6b67 726f 756e 6428  ).setBackground(
-0007aa20: 5174 4775 692e 5143 6f6c 6f72 2827 2362  QtGui.QColor('#b
-0007aa30: 6561 6564 3427 2929 0d0a 2020 2020 2020  eaed4'))..      
-0007aa40: 2020 2020 2020 656c 6966 2072 6f77 2069        elif row i
-0007aa50: 6e20 7261 6e67 6528 6d69 6e69 2c20 6d61  n range(mini, ma
-0007aa60: 7869 293a 0d0a 2020 2020 2020 2020 2020  xi):..          
-0007aa70: 2020 2020 2020 7365 6c66 2e73 7461 636b        self.stack
-0007aa80: 2e73 6869 6674 735b 726f 775d 5b31 5d3d  .shifts[row][1]=
-0007aa90: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
-0007aaa0: 2020 2020 716c 6973 742e 6974 656d 2872      qlist.item(r
-0007aab0: 6f77 292e 7365 7442 6163 6b67 726f 756e  ow).setBackgroun
-0007aac0: 6428 5174 4775 692e 5143 6f6c 6f72 2827  d(QtGui.QColor('
-0007aad0: 2337 6663 3937 6627 2929 0d0a 2020 2020  #7fc97f'))..    
-0007aae0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0007aaf0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0007ab00: 656c 662e 7374 6163 6b2e 7368 6966 7473  elf.stack.shifts
-0007ab10: 5b72 6f77 5d5b 315d 3d20 300d 0a20 2020  [row][1]= 0..   
-0007ab20: 2020 2020 2020 2020 2020 2020 2071 6c69               qli
-0007ab30: 7374 2e69 7465 6d28 726f 7729 2e73 6574  st.item(row).set
-0007ab40: 4261 636b 6772 6f75 6e64 2851 7447 7569  Background(QtGui
-0007ab50: 2e51 436f 6c6f 7228 302c 2030 2c20 302c  .QColor(0, 0, 0,
-0007ab60: 2030 2929 0d0a 2020 2020 2020 2020 7365   0))..        se
-0007ab70: 6c66 2e70 6172 656e 742e 4f6e 5365 6c65  lf.parent.OnSele
-0007ab80: 6374 696f 6e43 6861 6e67 6564 2829 0d0a  ctionChanged()..
-0007ab90: 2020 2020 2320 2d2d 2d2d 2d2d 2d2d 2d2d      # ----------
-0007aba0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007abb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007abc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007abd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020  ------------..  
-0007abe0: 2020 6465 6620 4f6e 4361 6e63 656c 2873    def OnCancel(s
-0007abf0: 656c 662c 2065 7674 293a 0d0a 2020 2020  elf, evt):..    
-0007ac00: 2020 2020 7365 6c66 2e63 6c6f 7365 2829      self.close()
-0007ac10: 0d0a 0d0a 2020 2020 2320 2320 2d2d 2d2d  ....    # # ----
-0007ac20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007ac30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007ac40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007ac50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007ac60: 2d2d 0d0a 2020 2020 6465 6620 4f6e 4163  --..    def OnAc
-0007ac70: 6365 7074 2873 656c 662c 2065 7674 293a  cept(self, evt):
-0007ac80: 0d0a 2020 2020 2020 2020 7061 7373 0d0a  ..        pass..
-0007ac90: 2020 2020 2320 2020 2020 6966 2073 656c      #     if sel
-0007aca0: 662e 6362 5f63 726f 7074 6f72 6f69 2e69  f.cb_croptoroi.i
-0007acb0: 7343 6865 636b 6564 2829 3a0d 0a20 2020  sChecked():..   
-0007acc0: 2023 2020 2020 2020 2020 206c 6566 742c   #         left,
-0007acd0: 2072 6967 6874 2c20 746f 702c 2062 6f74   right, top, bot
-0007ace0: 746f 6d20 3d20 7365 6c66 2e47 6574 5265  tom = self.GetRe
-0007acf0: 6769 6f6e 2829 0d0a 2020 2020 2320 2020  gion()..    #   
-0007ad00: 2020 656c 7365 3a0d 0a20 2020 2023 2020    else:..    #  
-0007ad10: 2020 2020 2020 206c 6566 742c 2072 6967         left, rig
-0007ad20: 6874 2c20 746f 702c 2062 6f74 746f 6d20  ht, top, bottom 
-0007ad30: 3d20 284e 6f6e 652c 204e 6f6e 652c 204e  = (None, None, N
-0007ad40: 6f6e 652c 204e 6f6e 6529 0d0a 2020 2020  one, None)..    
-0007ad50: 230d 0a20 2020 2023 2020 2020 2069 6620  #..    #     if 
-0007ad60: 7365 6c66 2e63 625f 7265 6d6f 7665 5f65  self.cb_remove_e
-0007ad70: 7673 2e69 7343 6865 636b 6564 2829 3a0d  vs.isChecked():.
-0007ad80: 0a20 2020 2023 2020 2020 2020 2020 2073  .    #         s
-0007ad90: 656c 6563 7469 6f6e 203d 2073 656c 662e  election = self.
-0007ada0: 6964 785f 7365 6c65 6374 6564 0d0a 2020  idx_selected..  
-0007adb0: 2020 2320 2020 2020 2020 2020 6966 206c    #         if l
-0007adc0: 656e 2873 656c 6563 7469 6f6e 2920 3d3d  en(selection) ==
-0007add0: 2030 3a0d 0a20 2020 2023 2020 2020 2020   0:..    #      
-0007ade0: 2020 2020 2020 2051 7457 6964 6765 7473         QtWidgets
-0007adf0: 2e51 4d65 7373 6167 6542 6f78 2e77 6172  .QMessageBox.war
-0007ae00: 6e69 6e67 2873 656c 662c 2027 4572 726f  ning(self, 'Erro
-0007ae10: 7227 2c20 2750 6c65 6173 6520 7365 6c65  r', 'Please sele
-0007ae20: 6374 2061 7420 6c65 6173 7420 6f6e 6520  ct at least one 
-0007ae30: 656e 6572 6779 2076 616c 7565 2127 290d  energy value!').
-0007ae40: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0007ae50: 2020 2072 6574 7572 6e0d 0a20 2020 2023     return..    #
-0007ae60: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-0007ae70: 6163 6b2e 6e5f 6576 203d 206e 702e 6172  ack.n_ev = np.ar
-0007ae80: 7261 7928 6c65 6e28 7365 6c65 6374 696f  ray(len(selectio
-0007ae90: 6e29 290d 0a20 2020 2023 2020 2020 2020  n))..    #      
-0007aea0: 2020 2073 656c 662e 7374 6163 6b2e 6576     self.stack.ev
-0007aeb0: 203d 2073 656c 662e 7374 6163 6b2e 6576   = self.stack.ev
-0007aec0: 5b73 656c 6563 7469 6f6e 5d0d 0a20 2020  [selection]..   
-0007aed0: 2023 2020 2020 2020 2020 2073 656c 662e   #         self.
-0007aee0: 7374 6163 6b2e 6461 7461 5f64 7765 6c6c  stack.data_dwell
-0007aef0: 203d 2073 656c 662e 7374 6163 6b2e 6461   = self.stack.da
-0007af00: 7461 5f64 7765 6c6c 5b73 656c 6563 7469  ta_dwell[selecti
-0007af10: 6f6e 5d0d 0a20 2020 2023 2020 2020 2065  on]..    #     e
-0007af20: 6c73 653a 0d0a 2020 2020 2320 2020 2020  lse:..    #     
-0007af30: 2020 2020 7365 6c65 6374 696f 6e20 3d20      selection = 
-0007af40: 6c69 7374 2872 616e 6765 2873 656c 662e  list(range(self.
-0007af50: 7374 6163 6b2e 6e5f 6576 2929 0d0a 2020  stack.n_ev))..  
-0007af60: 2020 230d 0a20 2020 2023 2020 2020 2073    #..    #     s
-0007af70: 656c 662e 7374 6163 6b2e 6162 7364 6174  elf.stack.absdat
-0007af80: 6120 3d20 7365 6c66 2e73 7461 636b 2e61  a = self.stack.a
-0007af90: 6273 6461 7461 5b6c 6566 743a 7269 6768  bsdata[left:righ
-0007afa0: 742c 2062 6f74 746f 6d3a 746f 702c 2073  t, bottom:top, s
-0007afb0: 656c 6563 7469 6f6e 5d0d 0a20 2020 2023  election]..    #
-0007afc0: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
-0007afd0: 6e5f 636f 6c73 203d 2073 656c 662e 7374  n_cols = self.st
-0007afe0: 6163 6b2e 6162 7364 6174 612e 7368 6170  ack.absdata.shap
-0007aff0: 655b 305d 0d0a 2020 2020 2320 2020 2020  e[0]..    #     
-0007b000: 7365 6c66 2e73 7461 636b 2e6e 5f72 6f77  self.stack.n_row
-0007b010: 7320 3d20 7365 6c66 2e73 7461 636b 2e61  s = self.stack.a
-0007b020: 6273 6461 7461 2e73 6861 7065 5b31 5d0d  bsdata.shape[1].
-0007b030: 0a20 2020 2023 2020 2020 2073 656c 662e  .    #     self.
-0007b040: 7061 7265 6e74 2e70 6167 6531 2e69 7820  parent.page1.ix 
-0007b050: 3d20 696e 7428 7365 6c66 2e73 7461 636b  = int(self.stack
-0007b060: 2e6e 5f63 6f6c 7320 2f20 3229 0d0a 2020  .n_cols / 2)..  
-0007b070: 2020 2320 2020 2020 7365 6c66 2e70 6172    #     self.par
-0007b080: 656e 742e 7061 6765 312e 6979 203d 2069  ent.page1.iy = i
-0007b090: 6e74 2873 656c 662e 7374 6163 6b2e 6e5f  nt(self.stack.n_
-0007b0a0: 726f 7773 202f 2032 290d 0a20 2020 2023  rows / 2)..    #
-0007b0b0: 0d0a 2020 2020 2320 2020 2020 6966 2073  ..    #     if s
-0007b0c0: 656c 662e 636f 6d2e 7374 6163 6b5f 3464  elf.com.stack_4d
-0007b0d0: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
-0007b0e0: 2069 6620 7365 6c66 2e63 625f 7265 6d6f   if self.cb_remo
-0007b0f0: 7665 5f74 6865 7461 2e69 7343 6865 636b  ve_theta.isCheck
-0007b100: 6564 2829 3a0d 0a20 2020 2023 2020 2020  ed():..    #    
-0007b110: 2020 2020 2020 2020 2074 6865 7461 7320           thetas 
-0007b120: 3d20 7365 6c66 2e74 6865 7461 6964 785f  = self.thetaidx_
-0007b130: 7365 6c65 6374 6564 0d0a 2020 2020 2320  selected..    # 
-0007b140: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0007b150: 656e 2874 6865 7461 7329 203d 3d20 303a  en(thetas) == 0:
-0007b160: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-0007b170: 2020 2020 2020 2020 5174 5769 6467 6574          QtWidget
-0007b180: 732e 514d 6573 7361 6765 426f 782e 7761  s.QMessageBox.wa
-0007b190: 726e 696e 6728 7365 6c66 2c20 2745 7272  rning(self, 'Err
-0007b1a0: 6f72 272c 2027 506c 6561 7365 2073 656c  or', 'Please sel
-0007b1b0: 6563 7420 6174 206c 6561 7374 206f 6e65  ect at least one
-0007b1c0: 2074 6865 7461 2076 616c 7565 2127 290d   theta value!').
-0007b1d0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0007b1e0: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
-0007b1f0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0007b200: 2073 656c 662e 7374 6163 6b2e 6e5f 7468   self.stack.n_th
-0007b210: 6574 6120 3d20 6c65 6e28 7468 6574 6173  eta = len(thetas
+0007a8e0: 2c6d 696e 6469 2929 0d0a 2020 2020 2020  ,mindi))..      
+0007a8f0: 2020 2373 656c 662e 7265 6769 6f6e 5f69    #self.region_i
+0007a900: 2e73 6574 426f 756e 6473 2828 6d61 7864  .setBounds((maxd
+0007a910: 6930 2c6d 6178 2873 656c 662e 706c 6f74  i0,max(self.plot
+0007a920: 6974 656d 2e67 6574 4461 7461 2829 5b30  item.getData()[0
+0007a930: 5d29 2929 0d0a 2020 2020 2020 2020 2373  ])))..        #s
+0007a940: 656c 662e 7265 6769 6f6e 5f69 302e 626c  elf.region_i0.bl
+0007a950: 6f63 6b53 6967 6e61 6c73 2846 616c 7365  ockSignals(False
+0007a960: 290d 0a20 2020 2020 2020 2023 7365 6c66  )..        #self
+0007a970: 2e72 6567 696f 6e5f 692e 626c 6f63 6b53  .region_i.blockS
+0007a980: 6967 6e61 6c73 2846 616c 7365 290d 0a0d  ignals(False)...
+0007a990: 0a20 2020 2020 2020 2071 6c69 7374 203d  .        qlist =
+0007a9a0: 2073 656c 662e 7061 7265 6e74 2e4d 6170   self.parent.Map
+0007a9b0: 5365 6c65 6374 5769 6467 6574 310d 0a20  SelectWidget1.. 
+0007a9c0: 2020 2020 2020 2066 6f72 2072 6f77 2069         for row i
+0007a9d0: 6e20 7261 6e67 6528 716c 6973 742e 636f  n range(qlist.co
+0007a9e0: 756e 7428 2929 3a0d 0a20 2020 2020 2020  unt()):..       
+0007a9f0: 2020 2020 2069 6620 726f 7720 696e 2072       if row in r
+0007aa00: 616e 6765 286d 696e 6930 2c20 6d61 7869  ange(mini0, maxi
+0007aa10: 3029 3a0d 0a20 2020 2020 2020 2020 2020  0):..           
+0007aa20: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
+0007aa30: 7368 6966 7473 5b72 6f77 5d5b 315d 3d20  shifts[row][1]= 
+0007aa40: 2d31 0d0a 2020 2020 2020 2020 2020 2020  -1..            
+0007aa50: 2020 2020 716c 6973 742e 6974 656d 2872      qlist.item(r
+0007aa60: 6f77 292e 7365 7442 6163 6b67 726f 756e  ow).setBackgroun
+0007aa70: 6428 5174 4775 692e 5143 6f6c 6f72 2827  d(QtGui.QColor('
+0007aa80: 2362 6561 6564 3427 2929 0d0a 2020 2020  #beaed4'))..    
+0007aa90: 2020 2020 2020 2020 656c 6966 2072 6f77          elif row
+0007aaa0: 2069 6e20 7261 6e67 6528 6d69 6e69 2c20   in range(mini, 
+0007aab0: 6d61 7869 293a 0d0a 2020 2020 2020 2020  maxi):..        
+0007aac0: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
+0007aad0: 636b 2e73 6869 6674 735b 726f 775d 5b31  ck.shifts[row][1
+0007aae0: 5d3d 2031 0d0a 2020 2020 2020 2020 2020  ]= 1..          
+0007aaf0: 2020 2020 2020 716c 6973 742e 6974 656d        qlist.item
+0007ab00: 2872 6f77 292e 7365 7442 6163 6b67 726f  (row).setBackgro
+0007ab10: 756e 6428 5174 4775 692e 5143 6f6c 6f72  und(QtGui.QColor
+0007ab20: 2827 2337 6663 3937 6627 2929 0d0a 2020  ('#7fc97f'))..  
+0007ab30: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+0007ab40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007ab50: 2073 656c 662e 7374 6163 6b2e 7368 6966   self.stack.shif
+0007ab60: 7473 5b72 6f77 5d5b 315d 3d20 300d 0a20  ts[row][1]= 0.. 
+0007ab70: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+0007ab80: 6c69 7374 2e69 7465 6d28 726f 7729 2e73  list.item(row).s
+0007ab90: 6574 4261 636b 6772 6f75 6e64 2851 7447  etBackground(QtG
+0007aba0: 7569 2e51 436f 6c6f 7228 302c 2030 2c20  ui.QColor(0, 0, 
+0007abb0: 302c 2030 2929 0d0a 2020 2020 2020 2020  0, 0))..        
+0007abc0: 7365 6c66 2e70 6172 656e 742e 4f6e 5365  self.parent.OnSe
+0007abd0: 6c65 6374 696f 6e43 6861 6e67 6564 2829  lectionChanged()
+0007abe0: 0d0a 2020 2020 2320 2d2d 2d2d 2d2d 2d2d  ..    # --------
+0007abf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007ac00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007ac10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007ac20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a  --------------..
+0007ac30: 2020 2020 6465 6620 4f6e 4361 6e63 656c      def OnCancel
+0007ac40: 2873 656c 662c 2065 7674 293a 0d0a 2020  (self, evt):..  
+0007ac50: 2020 2020 2020 7365 6c66 2e63 6c6f 7365        self.close
+0007ac60: 2829 0d0a 0d0a 2020 2020 2320 2320 2d2d  ()....    # # --
+0007ac70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007ac80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007ac90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007aca0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007acb0: 2d2d 2d2d 0d0a 2020 2020 6465 6620 4f6e  ----..    def On
+0007acc0: 4163 6365 7074 2873 656c 662c 2065 7674  Accept(self, evt
+0007acd0: 293a 0d0a 2020 2020 2020 2020 7061 7373  ):..        pass
+0007ace0: 0d0a 2020 2020 2320 2020 2020 6966 2073  ..    #     if s
+0007acf0: 656c 662e 6362 5f63 726f 7074 6f72 6f69  elf.cb_croptoroi
+0007ad00: 2e69 7343 6865 636b 6564 2829 3a0d 0a20  .isChecked():.. 
+0007ad10: 2020 2023 2020 2020 2020 2020 206c 6566     #         lef
+0007ad20: 742c 2072 6967 6874 2c20 746f 702c 2062  t, right, top, b
+0007ad30: 6f74 746f 6d20 3d20 7365 6c66 2e47 6574  ottom = self.Get
+0007ad40: 5265 6769 6f6e 2829 0d0a 2020 2020 2320  Region()..    # 
+0007ad50: 2020 2020 656c 7365 3a0d 0a20 2020 2023      else:..    #
+0007ad60: 2020 2020 2020 2020 206c 6566 742c 2072           left, r
+0007ad70: 6967 6874 2c20 746f 702c 2062 6f74 746f  ight, top, botto
+0007ad80: 6d20 3d20 284e 6f6e 652c 204e 6f6e 652c  m = (None, None,
+0007ad90: 204e 6f6e 652c 204e 6f6e 6529 0d0a 2020   None, None)..  
+0007ada0: 2020 230d 0a20 2020 2023 2020 2020 2069    #..    #     i
+0007adb0: 6620 7365 6c66 2e63 625f 7265 6d6f 7665  f self.cb_remove
+0007adc0: 5f65 7673 2e69 7343 6865 636b 6564 2829  _evs.isChecked()
+0007add0: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
+0007ade0: 2073 656c 6563 7469 6f6e 203d 2073 656c   selection = sel
+0007adf0: 662e 6964 785f 7365 6c65 6374 6564 0d0a  f.idx_selected..
+0007ae00: 2020 2020 2320 2020 2020 2020 2020 6966      #         if
+0007ae10: 206c 656e 2873 656c 6563 7469 6f6e 2920   len(selection) 
+0007ae20: 3d3d 2030 3a0d 0a20 2020 2023 2020 2020  == 0:..    #    
+0007ae30: 2020 2020 2020 2020 2051 7457 6964 6765           QtWidge
+0007ae40: 7473 2e51 4d65 7373 6167 6542 6f78 2e77  ts.QMessageBox.w
+0007ae50: 6172 6e69 6e67 2873 656c 662c 2027 4572  arning(self, 'Er
+0007ae60: 726f 7227 2c20 2750 6c65 6173 6520 7365  ror', 'Please se
+0007ae70: 6c65 6374 2061 7420 6c65 6173 7420 6f6e  lect at least on
+0007ae80: 6520 656e 6572 6779 2076 616c 7565 2127  e energy value!'
+0007ae90: 290d 0a20 2020 2023 2020 2020 2020 2020  )..    #        
+0007aea0: 2020 2020 2072 6574 7572 6e0d 0a20 2020       return..   
+0007aeb0: 2023 2020 2020 2020 2020 2073 656c 662e   #         self.
+0007aec0: 7374 6163 6b2e 6e5f 6576 203d 206e 702e  stack.n_ev = np.
+0007aed0: 6172 7261 7928 6c65 6e28 7365 6c65 6374  array(len(select
+0007aee0: 696f 6e29 290d 0a20 2020 2023 2020 2020  ion))..    #    
+0007aef0: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
+0007af00: 6576 203d 2073 656c 662e 7374 6163 6b2e  ev = self.stack.
+0007af10: 6576 5b73 656c 6563 7469 6f6e 5d0d 0a20  ev[selection].. 
+0007af20: 2020 2023 2020 2020 2020 2020 2073 656c     #         sel
+0007af30: 662e 7374 6163 6b2e 6461 7461 5f64 7765  f.stack.data_dwe
+0007af40: 6c6c 203d 2073 656c 662e 7374 6163 6b2e  ll = self.stack.
+0007af50: 6461 7461 5f64 7765 6c6c 5b73 656c 6563  data_dwell[selec
+0007af60: 7469 6f6e 5d0d 0a20 2020 2023 2020 2020  tion]..    #    
+0007af70: 2065 6c73 653a 0d0a 2020 2020 2320 2020   else:..    #   
+0007af80: 2020 2020 2020 7365 6c65 6374 696f 6e20        selection 
+0007af90: 3d20 6c69 7374 2872 616e 6765 2873 656c  = list(range(sel
+0007afa0: 662e 7374 6163 6b2e 6e5f 6576 2929 0d0a  f.stack.n_ev))..
+0007afb0: 2020 2020 230d 0a20 2020 2023 2020 2020      #..    #    
+0007afc0: 2073 656c 662e 7374 6163 6b2e 6162 7364   self.stack.absd
+0007afd0: 6174 6120 3d20 7365 6c66 2e73 7461 636b  ata = self.stack
+0007afe0: 2e61 6273 6461 7461 5b6c 6566 743a 7269  .absdata[left:ri
+0007aff0: 6768 742c 2062 6f74 746f 6d3a 746f 702c  ght, bottom:top,
+0007b000: 2073 656c 6563 7469 6f6e 5d0d 0a20 2020   selection]..   
+0007b010: 2023 2020 2020 2073 656c 662e 7374 6163   #     self.stac
+0007b020: 6b2e 6e5f 636f 6c73 203d 2073 656c 662e  k.n_cols = self.
+0007b030: 7374 6163 6b2e 6162 7364 6174 612e 7368  stack.absdata.sh
+0007b040: 6170 655b 305d 0d0a 2020 2020 2320 2020  ape[0]..    #   
+0007b050: 2020 7365 6c66 2e73 7461 636b 2e6e 5f72    self.stack.n_r
+0007b060: 6f77 7320 3d20 7365 6c66 2e73 7461 636b  ows = self.stack
+0007b070: 2e61 6273 6461 7461 2e73 6861 7065 5b31  .absdata.shape[1
+0007b080: 5d0d 0a20 2020 2023 2020 2020 2073 656c  ]..    #     sel
+0007b090: 662e 7061 7265 6e74 2e70 6167 6531 2e69  f.parent.page1.i
+0007b0a0: 7820 3d20 696e 7428 7365 6c66 2e73 7461  x = int(self.sta
+0007b0b0: 636b 2e6e 5f63 6f6c 7320 2f20 3229 0d0a  ck.n_cols / 2)..
+0007b0c0: 2020 2020 2320 2020 2020 7365 6c66 2e70      #     self.p
+0007b0d0: 6172 656e 742e 7061 6765 312e 6979 203d  arent.page1.iy =
+0007b0e0: 2069 6e74 2873 656c 662e 7374 6163 6b2e   int(self.stack.
+0007b0f0: 6e5f 726f 7773 202f 2032 290d 0a20 2020  n_rows / 2)..   
+0007b100: 2023 0d0a 2020 2020 2320 2020 2020 6966   #..    #     if
+0007b110: 2073 656c 662e 636f 6d2e 7374 6163 6b5f   self.com.stack_
+0007b120: 3464 3a0d 0a20 2020 2023 2020 2020 2020  4d:..    #      
+0007b130: 2020 2069 6620 7365 6c66 2e63 625f 7265     if self.cb_re
+0007b140: 6d6f 7665 5f74 6865 7461 2e69 7343 6865  move_theta.isChe
+0007b150: 636b 6564 2829 3a0d 0a20 2020 2023 2020  cked():..    #  
+0007b160: 2020 2020 2020 2020 2020 2074 6865 7461             theta
+0007b170: 7320 3d20 7365 6c66 2e74 6865 7461 6964  s = self.thetaid
+0007b180: 785f 7365 6c65 6374 6564 0d0a 2020 2020  x_selected..    
+0007b190: 2320 2020 2020 2020 2020 2020 2020 6966  #             if
+0007b1a0: 206c 656e 2874 6865 7461 7329 203d 3d20   len(thetas) == 
+0007b1b0: 303a 0d0a 2020 2020 2320 2020 2020 2020  0:..    #       
+0007b1c0: 2020 2020 2020 2020 2020 5174 5769 6467            QtWidg
+0007b1d0: 6574 732e 514d 6573 7361 6765 426f 782e  ets.QMessageBox.
+0007b1e0: 7761 726e 696e 6728 7365 6c66 2c20 2745  warning(self, 'E
+0007b1f0: 7272 6f72 272c 2027 506c 6561 7365 2073  rror', 'Please s
+0007b200: 656c 6563 7420 6174 206c 6561 7374 206f  elect at least o
+0007b210: 6e65 2074 6865 7461 2076 616c 7565 2127  ne theta value!'
 0007b220: 290d 0a20 2020 2023 2020 2020 2020 2020  )..    #        
-0007b230: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
-0007b240: 7468 6574 6120 3d20 7365 6c66 2e73 7461  theta = self.sta
-0007b250: 636b 2e74 6865 7461 5b74 6865 7461 735d  ck.theta[thetas]
-0007b260: 0d0a 2020 2020 230d 0a20 2020 2023 2020  ..    #..    #  
-0007b270: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0007b280: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0007b290: 7468 6574 6173 203d 206c 6973 7428 7261  thetas = list(ra
-0007b2a0: 6e67 6528 7365 6c66 2e73 7461 636b 2e6e  nge(self.stack.n
-0007b2b0: 5f74 6865 7461 2929 0d0a 2020 2020 2320  _theta))..    # 
-0007b2c0: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
-0007b2d0: 636b 2e73 7461 636b 3444 203d 2073 656c  ck.stack4D = sel
-0007b2e0: 662e 7374 6163 6b2e 7374 6163 6b34 445b  f.stack.stack4D[
-0007b2f0: 6c65 6674 3a72 6967 6874 2c20 626f 7474  left:right, bott
-0007b300: 6f6d 3a74 6f70 2c20 7365 6c65 6374 696f  om:top, selectio
-0007b310: 6e2c 203a 5d0d 0a20 2020 2023 2020 2020  n, :]..    #    
-0007b320: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
-0007b330: 7374 6163 6b34 4420 3d20 7365 6c66 2e73  stack4D = self.s
-0007b340: 7461 636b 2e73 7461 636b 3444 5b3a 2c20  tack.stack4D[:, 
-0007b350: 3a2c 203a 2c20 7468 6574 6173 5d0d 0a20  :, :, thetas].. 
-0007b360: 2020 2023 2020 2020 2069 6620 7365 6c66     #     if self
-0007b370: 2e63 6f6d 2e69 305f 6c6f 6164 6564 3a0d  .com.i0_loaded:.
-0007b380: 0a20 2020 2023 2020 2020 2020 2020 2069  .    #         i
-0007b390: 6620 7365 6c66 2e63 6f6d 2e73 7461 636b  f self.com.stack
-0007b3a0: 5f34 643a 0d0a 2020 2020 2320 2020 2020  _4d:..    #     
-0007b3b0: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
-0007b3c0: 636b 2e6f 6434 4420 3d20 7365 6c66 2e73  ck.od4D = self.s
-0007b3d0: 7461 636b 2e6f 6434 445b 6c65 6674 3a72  tack.od4D[left:r
-0007b3e0: 6967 6874 2c20 626f 7474 6f6d 3a74 6f70  ight, bottom:top
-0007b3f0: 2c20 7365 6c65 6374 696f 6e2c 2074 6865  , selection, the
-0007b400: 7461 735d 0d0a 2020 2020 2320 2020 2020  tas]..    #     
-0007b410: 2020 2020 656c 7365 3a0d 0a20 2020 2023      else:..    #
-0007b420: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0007b430: 662e 7374 6163 6b2e 6f64 3364 203d 2073  f.stack.od3d = s
-0007b440: 656c 662e 7374 6163 6b2e 6f64 3364 5b6c  elf.stack.od3d[l
-0007b450: 6566 743a 7269 6768 742c 2062 6f74 746f  eft:right, botto
-0007b460: 6d3a 746f 702c 2073 656c 6563 7469 6f6e  m:top, selection
-0007b470: 5d0d 0a20 2020 2023 2020 2020 2020 2020  ]..    #        
-0007b480: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
-0007b490: 6f64 203d 2073 656c 662e 7374 6163 6b2e  od = self.stack.
-0007b4a0: 6f64 3364 2e63 6f70 7928 290d 0a20 2020  od3d.copy()..   
-0007b4b0: 2023 2020 2020 2020 2020 2020 2020 2073   #             s
-0007b4c0: 656c 662e 7374 6163 6b2e 6f64 203d 206e  elf.stack.od = n
-0007b4d0: 702e 7265 7368 6170 6528 7365 6c66 2e73  p.reshape(self.s
-0007b4e0: 7461 636b 2e6f 642c 2028 7365 6c66 2e73  tack.od, (self.s
-0007b4f0: 7461 636b 2e6e 5f72 6f77 7320 2a20 7365  tack.n_rows * se
-0007b500: 6c66 2e73 7461 636b 2e6e 5f63 6f6c 732c  lf.stack.n_cols,
-0007b510: 2073 656c 662e 7374 6163 6b2e 6e5f 6576   self.stack.n_ev
-0007b520: 292c 0d0a 2020 2020 2320 2020 2020 2020  ),..    #       
-0007b530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007b550: 206f 7264 6572 3d27 4627 290d 0a20 2020   order='F')..   
-0007b560: 2023 0d0a 2020 2020 2320 2020 2020 7365   #..    #     se
-0007b570: 6c66 2e73 7461 636b 2e66 696c 6c5f 6835  lf.stack.fill_h5
-0007b580: 5f73 7472 7563 745f 6672 6f6d 5f73 746b  _struct_from_stk
-0007b590: 2829 0d0a 2020 2020 2320 2020 2020 6966  ()..    #     if
-0007b5a0: 2073 656c 662e 636f 6d2e 6930 5f6c 6f61   self.com.i0_loa
-0007b5b0: 6465 6420 3d3d 2031 3a0d 0a20 2020 2023  ded == 1:..    #
-0007b5c0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-0007b5d0: 6163 6b2e 6669 6c6c 5f68 355f 7374 7275  ack.fill_h5_stru
-0007b5e0: 6374 5f6e 6f72 6d61 6c69 7a61 7469 6f6e  ct_normalization
-0007b5f0: 2829 0d0a 2020 2020 230d 0a20 2020 2023  ()..    #..    #
-0007b600: 2020 2020 2023 2046 6978 2074 6865 2073       # Fix the s
-0007b610: 6c69 6465 7220 6f6e 2050 6167 6520 3121  lider on Page 1!
-0007b620: 0d0a 2020 2020 2320 2020 2020 6966 2073  ..    #     if s
-0007b630: 656c 662e 636f 6d2e 7374 6163 6b5f 3464  elf.com.stack_4d
-0007b640: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
-0007b650: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
-0007b660: 6531 2e73 6c69 6465 725f 7468 6574 612e  e1.slider_theta.
-0007b670: 7365 7452 616e 6765 2830 2c20 7365 6c66  setRange(0, self
-0007b680: 2e73 7461 636b 2e6e 5f74 6865 7461 202d  .stack.n_theta -
-0007b690: 2031 290d 0a20 2020 2023 2020 2020 2020   1)..    #      
+0007b230: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
+0007b240: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0007b250: 2020 2073 656c 662e 7374 6163 6b2e 6e5f     self.stack.n_
+0007b260: 7468 6574 6120 3d20 6c65 6e28 7468 6574  theta = len(thet
+0007b270: 6173 290d 0a20 2020 2023 2020 2020 2020  as)..    #      
+0007b280: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
+0007b290: 6b2e 7468 6574 6120 3d20 7365 6c66 2e73  k.theta = self.s
+0007b2a0: 7461 636b 2e74 6865 7461 5b74 6865 7461  tack.theta[theta
+0007b2b0: 735d 0d0a 2020 2020 230d 0a20 2020 2023  s]..    #..    #
+0007b2c0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0007b2d0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0007b2e0: 2020 7468 6574 6173 203d 206c 6973 7428    thetas = list(
+0007b2f0: 7261 6e67 6528 7365 6c66 2e73 7461 636b  range(self.stack
+0007b300: 2e6e 5f74 6865 7461 2929 0d0a 2020 2020  .n_theta))..    
+0007b310: 2320 2020 2020 2020 2020 7365 6c66 2e73  #         self.s
+0007b320: 7461 636b 2e73 7461 636b 3444 203d 2073  tack.stack4D = s
+0007b330: 656c 662e 7374 6163 6b2e 7374 6163 6b34  elf.stack.stack4
+0007b340: 445b 6c65 6674 3a72 6967 6874 2c20 626f  D[left:right, bo
+0007b350: 7474 6f6d 3a74 6f70 2c20 7365 6c65 6374  ttom:top, select
+0007b360: 696f 6e2c 203a 5d0d 0a20 2020 2023 2020  ion, :]..    #  
+0007b370: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
+0007b380: 6b2e 7374 6163 6b34 4420 3d20 7365 6c66  k.stack4D = self
+0007b390: 2e73 7461 636b 2e73 7461 636b 3444 5b3a  .stack.stack4D[:
+0007b3a0: 2c20 3a2c 203a 2c20 7468 6574 6173 5d0d  , :, :, thetas].
+0007b3b0: 0a20 2020 2023 2020 2020 2069 6620 7365  .    #     if se
+0007b3c0: 6c66 2e63 6f6d 2e69 305f 6c6f 6164 6564  lf.com.i0_loaded
+0007b3d0: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
+0007b3e0: 2069 6620 7365 6c66 2e63 6f6d 2e73 7461   if self.com.sta
+0007b3f0: 636b 5f34 643a 0d0a 2020 2020 2320 2020  ck_4d:..    #   
+0007b400: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0007b410: 7461 636b 2e6f 6434 4420 3d20 7365 6c66  tack.od4D = self
+0007b420: 2e73 7461 636b 2e6f 6434 445b 6c65 6674  .stack.od4D[left
+0007b430: 3a72 6967 6874 2c20 626f 7474 6f6d 3a74  :right, bottom:t
+0007b440: 6f70 2c20 7365 6c65 6374 696f 6e2c 2074  op, selection, t
+0007b450: 6865 7461 735d 0d0a 2020 2020 2320 2020  hetas]..    #   
+0007b460: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0007b470: 2023 2020 2020 2020 2020 2020 2020 2073   #             s
+0007b480: 656c 662e 7374 6163 6b2e 6f64 3364 203d  elf.stack.od3d =
+0007b490: 2073 656c 662e 7374 6163 6b2e 6f64 3364   self.stack.od3d
+0007b4a0: 5b6c 6566 743a 7269 6768 742c 2062 6f74  [left:right, bot
+0007b4b0: 746f 6d3a 746f 702c 2073 656c 6563 7469  tom:top, selecti
+0007b4c0: 6f6e 5d0d 0a20 2020 2023 2020 2020 2020  on]..    #      
+0007b4d0: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
+0007b4e0: 6b2e 6f64 203d 2073 656c 662e 7374 6163  k.od = self.stac
+0007b4f0: 6b2e 6f64 3364 2e63 6f70 7928 290d 0a20  k.od3d.copy().. 
+0007b500: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0007b510: 2073 656c 662e 7374 6163 6b2e 6f64 203d   self.stack.od =
+0007b520: 206e 702e 7265 7368 6170 6528 7365 6c66   np.reshape(self
+0007b530: 2e73 7461 636b 2e6f 642c 2028 7365 6c66  .stack.od, (self
+0007b540: 2e73 7461 636b 2e6e 5f72 6f77 7320 2a20  .stack.n_rows * 
+0007b550: 7365 6c66 2e73 7461 636b 2e6e 5f63 6f6c  self.stack.n_col
+0007b560: 732c 2073 656c 662e 7374 6163 6b2e 6e5f  s, self.stack.n_
+0007b570: 6576 292c 0d0a 2020 2020 2320 2020 2020  ev),..    #     
+0007b580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007b5a0: 2020 206f 7264 6572 3d27 4627 290d 0a20     order='F').. 
+0007b5b0: 2020 2023 0d0a 2020 2020 2320 2020 2020     #..    #     
+0007b5c0: 7365 6c66 2e73 7461 636b 2e66 696c 6c5f  self.stack.fill_
+0007b5d0: 6835 5f73 7472 7563 745f 6672 6f6d 5f73  h5_struct_from_s
+0007b5e0: 746b 2829 0d0a 2020 2020 2320 2020 2020  tk()..    #     
+0007b5f0: 6966 2073 656c 662e 636f 6d2e 6930 5f6c  if self.com.i0_l
+0007b600: 6f61 6465 6420 3d3d 2031 3a0d 0a20 2020  oaded == 1:..   
+0007b610: 2023 2020 2020 2020 2020 2073 656c 662e   #         self.
+0007b620: 7374 6163 6b2e 6669 6c6c 5f68 355f 7374  stack.fill_h5_st
+0007b630: 7275 6374 5f6e 6f72 6d61 6c69 7a61 7469  ruct_normalizati
+0007b640: 6f6e 2829 0d0a 2020 2020 230d 0a20 2020  on()..    #..   
+0007b650: 2023 2020 2020 2023 2046 6978 2074 6865   #     # Fix the
+0007b660: 2073 6c69 6465 7220 6f6e 2050 6167 6520   slider on Page 
+0007b670: 3121 0d0a 2020 2020 2320 2020 2020 6966  1!..    #     if
+0007b680: 2073 656c 662e 636f 6d2e 7374 6163 6b5f   self.com.stack_
+0007b690: 3464 3a0d 0a20 2020 2023 2020 2020 2020  4d:..    #      
 0007b6a0: 2020 2073 656c 662e 7061 7265 6e74 2e70     self.parent.p
-0007b6b0: 6167 6531 2e69 7468 6574 6120 3d20 300d  age1.itheta = 0.
-0007b6c0: 0a20 2020 2023 2020 2020 2020 2020 2073  .    #         s
-0007b6d0: 656c 662e 7061 7265 6e74 2e70 6167 6531  elf.parent.page1
-0007b6e0: 2e73 6c69 6465 725f 7468 6574 612e 626c  .slider_theta.bl
-0007b6f0: 6f63 6b53 6967 6e61 6c73 2854 7275 6529  ockSignals(True)
-0007b700: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-0007b710: 7365 6c66 2e70 6172 656e 742e 7061 6765  self.parent.page
-0007b720: 312e 736c 6964 6572 5f74 6865 7461 2e73  1.slider_theta.s
-0007b730: 6574 5661 6c75 6528 696e 7428 7365 6c66  etValue(int(self
-0007b740: 2e70 6172 656e 742e 7061 6765 312e 6974  .parent.page1.it
-0007b750: 6865 7461 2929 0d0a 2020 2020 2320 2020  heta))..    #   
-0007b760: 2020 2020 2020 7365 6c66 2e70 6172 656e        self.paren
-0007b770: 742e 7061 6765 312e 736c 6964 6572 5f74  t.page1.slider_t
-0007b780: 6865 7461 2e62 6c6f 636b 5369 676e 616c  heta.blockSignal
-0007b790: 7328 4661 6c73 6529 0d0a 2020 2020 230d  s(False)..    #.
-0007b7a0: 0a20 2020 2023 2020 2020 2020 2020 2073  .    #         s
-0007b7b0: 656c 662e 7061 7265 6e74 2e70 6167 6530  elf.parent.page0
-0007b7c0: 2e73 6c69 6465 725f 7468 6574 612e 7365  .slider_theta.se
-0007b7d0: 7452 616e 6765 2830 2c20 7365 6c66 2e73  tRange(0, self.s
-0007b7e0: 7461 636b 2e6e 5f74 6865 7461 202d 2031  tack.n_theta - 1
-0007b7f0: 290d 0a20 2020 2023 2020 2020 2020 2020  )..    #        
+0007b6b0: 6167 6531 2e73 6c69 6465 725f 7468 6574  age1.slider_thet
+0007b6c0: 612e 7365 7452 616e 6765 2830 2c20 7365  a.setRange(0, se
+0007b6d0: 6c66 2e73 7461 636b 2e6e 5f74 6865 7461  lf.stack.n_theta
+0007b6e0: 202d 2031 290d 0a20 2020 2023 2020 2020   - 1)..    #    
+0007b6f0: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
+0007b700: 2e70 6167 6531 2e69 7468 6574 6120 3d20  .page1.itheta = 
+0007b710: 300d 0a20 2020 2023 2020 2020 2020 2020  0..    #        
+0007b720: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
+0007b730: 6531 2e73 6c69 6465 725f 7468 6574 612e  e1.slider_theta.
+0007b740: 626c 6f63 6b53 6967 6e61 6c73 2854 7275  blockSignals(Tru
+0007b750: 6529 0d0a 2020 2020 2320 2020 2020 2020  e)..    #       
+0007b760: 2020 7365 6c66 2e70 6172 656e 742e 7061    self.parent.pa
+0007b770: 6765 312e 736c 6964 6572 5f74 6865 7461  ge1.slider_theta
+0007b780: 2e73 6574 5661 6c75 6528 696e 7428 7365  .setValue(int(se
+0007b790: 6c66 2e70 6172 656e 742e 7061 6765 312e  lf.parent.page1.
+0007b7a0: 6974 6865 7461 2929 0d0a 2020 2020 2320  itheta))..    # 
+0007b7b0: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
+0007b7c0: 656e 742e 7061 6765 312e 736c 6964 6572  ent.page1.slider
+0007b7d0: 5f74 6865 7461 2e62 6c6f 636b 5369 676e  _theta.blockSign
+0007b7e0: 616c 7328 4661 6c73 6529 0d0a 2020 2020  als(False)..    
+0007b7f0: 230d 0a20 2020 2023 2020 2020 2020 2020  #..    #        
 0007b800: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
-0007b810: 6530 2e69 7468 6574 6120 3d20 300d 0a20  e0.itheta = 0.. 
-0007b820: 2020 2023 2020 2020 2020 2020 2073 656c     #         sel
-0007b830: 662e 7061 7265 6e74 2e70 6167 6530 2e73  f.parent.page0.s
-0007b840: 6c69 6465 725f 7468 6574 612e 626c 6f63  lider_theta.bloc
-0007b850: 6b53 6967 6e61 6c73 2854 7275 6529 0d0a  kSignals(True)..
-0007b860: 2020 2020 2320 2020 2020 2020 2020 7365      #         se
-0007b870: 6c66 2e70 6172 656e 742e 7061 6765 302e  lf.parent.page0.
-0007b880: 736c 6964 6572 5f74 6865 7461 2e73 6574  slider_theta.set
-0007b890: 5661 6c75 6528 696e 7428 7365 6c66 2e70  Value(int(self.p
-0007b8a0: 6172 656e 742e 7061 6765 312e 6974 6865  arent.page1.ithe
-0007b8b0: 7461 2929 0d0a 2020 2020 2320 2020 2020  ta))..    #     
-0007b8c0: 2020 2020 7365 6c66 2e70 6172 656e 742e      self.parent.
-0007b8d0: 7061 6765 302e 736c 6964 6572 5f74 6865  page0.slider_the
-0007b8e0: 7461 2e62 6c6f 636b 5369 676e 616c 7328  ta.blockSignals(
-0007b8f0: 4661 6c73 6529 0d0a 2020 2020 230d 0a20  False)..    #.. 
-0007b900: 2020 2023 2020 2020 2073 656c 662e 7061     #     self.pa
-0007b910: 7265 6e74 2e70 6167 6531 2e73 6c69 6465  rent.page1.slide
-0007b920: 725f 656e 672e 7365 7452 616e 6765 2830  r_eng.setRange(0
-0007b930: 2c20 7365 6c66 2e73 7461 636b 2e6e 5f65  , self.stack.n_e
-0007b940: 7620 2d20 3129 0d0a 2020 2020 2320 2020  v - 1)..    #   
-0007b950: 2020 7365 6c66 2e70 6172 656e 742e 7061    self.parent.pa
-0007b960: 6765 312e 6965 7620 3d20 300d 0a20 2020  ge1.iev = 0..   
-0007b970: 2023 2020 2020 2073 656c 662e 7061 7265   #     self.pare
-0007b980: 6e74 2e70 6167 6531 2e73 6c69 6465 725f  nt.page1.slider_
-0007b990: 656e 672e 7365 7456 616c 7565 2869 6e74  eng.setValue(int
-0007b9a0: 2873 656c 662e 7061 7265 6e74 2e70 6167  (self.parent.pag
-0007b9b0: 6531 2e69 6576 2929 0d0a 2020 2020 230d  e1.iev))..    #.
-0007b9c0: 0a20 2020 2023 2020 2020 2073 656c 662e  .    #     self.
-0007b9d0: 7061 7265 6e74 2e70 6167 6530 2e73 6c69  parent.page0.sli
-0007b9e0: 6465 725f 656e 672e 7365 7452 616e 6765  der_eng.setRange
-0007b9f0: 2830 2c20 7365 6c66 2e73 7461 636b 2e6e  (0, self.stack.n
-0007ba00: 5f65 7620 2d20 3129 0d0a 2020 2020 2320  _ev - 1)..    # 
-0007ba10: 2020 2020 7365 6c66 2e70 6172 656e 742e      self.parent.
-0007ba20: 7061 6765 302e 6965 7620 3d20 300d 0a20  page0.iev = 0.. 
-0007ba30: 2020 2023 2020 2020 2073 656c 662e 7061     #     self.pa
-0007ba40: 7265 6e74 2e70 6167 6530 2e73 6c69 6465  rent.page0.slide
-0007ba50: 725f 656e 672e 7365 7456 616c 7565 2869  r_eng.setValue(i
-0007ba60: 6e74 2873 656c 662e 7061 7265 6e74 2e70  nt(self.parent.p
-0007ba70: 6167 6531 2e69 6576 2929 0d0a 2020 2020  age1.iev))..    
-0007ba80: 230d 0a20 2020 2023 2020 2020 2073 656c  #..    #     sel
-0007ba90: 662e 7061 7265 6e74 2e70 6167 6531 2e73  f.parent.page1.s
-0007baa0: 686f 7753 7065 6374 7275 6d28 7365 6c66  howSpectrum(self
-0007bab0: 2e70 6172 656e 742e 7061 6765 312e 6978  .parent.page1.ix
-0007bac0: 2c20 7365 6c66 2e70 6172 656e 742e 7061  , self.parent.pa
-0007bad0: 6765 312e 6979 290d 0a20 2020 2023 2020  ge1.iy)..    #  
-0007bae0: 2020 2073 656c 662e 7061 7265 6e74 2e70     self.parent.p
-0007baf0: 6167 6531 2e6c 6f61 6449 6d61 6765 2829  age1.loadImage()
-0007bb00: 0d0a 2020 2020 2320 2020 2020 7365 6c66  ..    #     self
-0007bb10: 2e70 6172 656e 742e 7061 6765 302e 436c  .parent.page0.Cl
-0007bb20: 6561 7228 290d 0a20 2020 2023 2020 2020  ear()..    #    
-0007bb30: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
-0007bb40: 6530 2e4c 6f61 6445 6e74 7269 6573 2829  e0.LoadEntries()
-0007bb50: 0d0a 2020 2020 230d 0a20 2020 2023 2020  ..    #..    #  
-0007bb60: 2020 2069 6620 7368 6f77 6d61 7074 6162     if showmaptab
-0007bb70: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
-0007bb80: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
-0007bb90: 6539 2e43 6c65 6172 2829 0d0a 2020 2020  e9.Clear()..    
-0007bba0: 2320 2020 2020 2020 2020 7365 6c66 2e70  #         self.p
-0007bbb0: 6172 656e 742e 7061 6765 392e 4c6f 6164  arent.page9.Load
-0007bbc0: 456e 7472 6965 7328 290d 0a20 2020 2023  Entries()..    #
-0007bbd0: 0d0a 2020 2020 2320 2020 2020 7365 6c66  ..    #     self
-0007bbe0: 2e63 6c6f 7365 2829 0d0a 0d0a 636c 6173  .close()....clas
-0007bbf0: 7320 5370 6563 7472 616c 524f 4928 5174  s SpectralROI(Qt
-0007bc00: 5769 6467 6574 732e 5144 6961 6c6f 6729  Widgets.QDialog)
-0007bc10: 3a0d 0a0d 0a20 2020 2064 6566 205f 5f69  :....    def __i
-0007bc20: 6e69 745f 5f28 7365 6c66 2c20 7061 7265  nit__(self, pare
-0007bc30: 6e74 2c20 2063 6f6d 6d6f 6e2c 2073 7461  nt,  common, sta
-0007bc40: 636b 293a 0d0a 2020 2020 2020 2020 5174  ck):..        Qt
-0007bc50: 5769 6467 6574 732e 5157 6964 6765 742e  Widgets.QWidget.
-0007bc60: 5f5f 696e 6974 5f5f 2873 656c 662c 2070  __init__(self, p
-0007bc70: 6172 656e 7429 0d0a 0d0a 2020 2020 2020  arent)....      
-0007bc80: 2020 7365 6c66 2e70 6172 656e 7420 3d20    self.parent = 
-0007bc90: 7061 7265 6e74 0d0a 0d0a 2020 2020 2020  parent....      
-0007bca0: 2020 7365 6c66 2e73 7461 636b 203d 2073    self.stack = s
-0007bcb0: 7461 636b 0d0a 2020 2020 2020 2020 7365  tack..        se
-0007bcc0: 6c66 2e63 6f6d 203d 2063 6f6d 6d6f 6e0d  lf.com = common.
-0007bcd0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0007bce0: 7265 7369 7a65 2836 3330 2c20 3730 3029  resize(630, 700)
-0007bcf0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-0007bd00: 6574 5769 6e64 6f77 5469 746c 6528 2753  etWindowTitle('S
-0007bd10: 7065 6374 7261 6c20 5265 6769 6f6e 7320  pectral Regions 
-0007bd20: 6f66 2049 6e74 6572 6573 7427 290d 0a0d  of Interest')...
-0007bd30: 0a20 2020 2020 2020 2070 616c 203d 2051  .        pal = Q
-0007bd40: 7447 7569 2e51 5061 6c65 7474 6528 290d  tGui.QPalette().
-0007bd50: 0a20 2020 2020 2020 2073 656c 662e 7365  .        self.se
-0007bd60: 7441 7574 6f46 696c 6c42 6163 6b67 726f  tAutoFillBackgro
-0007bd70: 756e 6428 5472 7565 290d 0a20 2020 2020  und(True)..     
-0007bd80: 2020 2070 616c 2e73 6574 436f 6c6f 7228     pal.setColor(
-0007bd90: 5174 4775 692e 5150 616c 6574 7465 2e57  QtGui.QPalette.W
-0007bda0: 696e 646f 772c 5174 4775 692e 5143 6f6c  indow,QtGui.QCol
-0007bdb0: 6f72 2827 7768 6974 6527 2929 0d0a 2020  or('white'))..  
-0007bdc0: 2020 2020 2020 7365 6c66 2e73 6574 5061        self.setPa
-0007bdd0: 6c65 7474 6528 7061 6c29 0d0a 0d0a 2020  lette(pal)....  
-0007bde0: 2020 2020 2020 7365 6c66 2e73 7461 636b        self.stack
-0007bdf0: 203d 2073 7461 636b 0d0a 2020 2020 2020   = stack..      
-0007be00: 2020 7365 6c66 2e63 6f6d 203d 2063 6f6d    self.com = com
-0007be10: 6d6f 6e0d 0a0d 0a0d 0a20 2020 2020 2020  mon......       
-0007be20: 2073 656c 662e 696d 696e 203d 2030 0d0a   self.imin = 0..
-0007be30: 2020 2020 2020 2020 7365 6c66 2e69 6d61          self.ima
-0007be40: 7820 3d20 300d 0a20 2020 2020 2020 2073  x = 0..        s
-0007be50: 656c 662e 6930 6d69 6e20 3d20 300d 0a20  elf.i0min = 0.. 
-0007be60: 2020 2020 2020 2073 656c 662e 6930 6d61         self.i0ma
-0007be70: 7820 3d20 300d 0a20 2020 2020 2020 2073  x = 0..        s
-0007be80: 656c 662e 6973 656c 6563 7465 6420 3d20  elf.iselected = 
-0007be90: 300d 0a20 2020 2020 2020 2073 656c 662e  0..        self.
-0007bea0: 6930 7365 6c65 6374 6564 203d 2030 0d0a  i0selected = 0..
-0007beb0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-0007bec0: 2e6f 6474 6f74 616c 203d 2073 656c 662e  .odtotal = self.
-0007bed0: 7374 6163 6b2e 6f64 3364 2e73 756d 2861  stack.od3d.sum(a
-0007bee0: 7869 733d 3029 0d0a 2020 2020 2020 2020  xis=0)..        
-0007bef0: 7365 6c66 2e6f 6474 6f74 616c 203d 2073  self.odtotal = s
-0007bf00: 656c 662e 6f64 746f 7461 6c2e 7375 6d28  elf.odtotal.sum(
-0007bf10: 6178 6973 3d30 292f 2873 656c 662e 7374  axis=0)/(self.st
-0007bf20: 6163 6b2e 6e5f 726f 7773 2a73 656c 662e  ack.n_rows*self.
-0007bf30: 7374 6163 6b2e 6e5f 636f 6c73 290d 0a0d  stack.n_cols)...
-0007bf40: 0a20 2020 2020 2020 2073 656c 662e 696d  .        self.im
-0007bf50: 6167 655f 6930 203d 206e 702e 7a65 726f  age_i0 = np.zero
-0007bf60: 7328 2873 656c 662e 7374 6163 6b2e 6e5f  s((self.stack.n_
-0007bf70: 636f 6c73 2c20 7365 6c66 2e73 7461 636b  cols, self.stack
-0007bf80: 2e6e 5f72 6f77 7329 290d 0a20 2020 2020  .n_rows))..     
-0007bf90: 2020 2073 656c 662e 696d 6167 655f 6920     self.image_i 
-0007bfa0: 3d20 6e70 2e7a 6572 6f73 2828 7365 6c66  = np.zeros((self
-0007bfb0: 2e73 7461 636b 2e6e 5f63 6f6c 732c 2073  .stack.n_cols, s
-0007bfc0: 656c 662e 7374 6163 6b2e 6e5f 726f 7773  elf.stack.n_rows
-0007bfd0: 2929 0d0a 2020 2020 2020 2020 7365 6c66  ))..        self
-0007bfe0: 2e6f 6474 6869 636b 6d61 7020 3d20 6e70  .odthickmap = np
-0007bff0: 2e7a 6572 6f73 2828 7365 6c66 2e73 7461  .zeros((self.sta
-0007c000: 636b 2e6e 5f63 6f6c 732c 2073 656c 662e  ck.n_cols, self.
-0007c010: 7374 6163 6b2e 6e5f 726f 7773 2929 0d0a  stack.n_rows))..
-0007c020: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7662  ......        vb
-0007c030: 6f78 203d 2051 7457 6964 6765 7473 2e51  ox = QtWidgets.Q
-0007c040: 5642 6f78 4c61 796f 7574 2829 0d0a 2020  VBoxLayout()..  
-0007c050: 2020 2020 2020 7465 7874 203d 2051 7457        text = QtW
-0007c060: 6964 6765 7473 2e51 4c61 6265 6c28 7365  idgets.QLabel(se
-0007c070: 6c66 290d 0a20 2020 2020 2020 2074 6578  lf)..        tex
-0007c080: 742e 7365 7454 6578 7428 2746 6972 7374  t.setText('First
-0007c090: 2073 656c 6563 7420 4930 2072 6567 696f   select I0 regio
-0007c0a0: 6e20 6265 6c6f 7720 7468 6520 6564 6765  n below the edge
-0007c0b0: 2c20 7468 656e 2073 656c 6563 7420 4920  , then select I 
-0007c0c0: 7265 6769 6f6e 2061 626f 7665 2074 6865  region above the
-0007c0d0: 2065 6467 653a 2729 0d0a 2020 2020 2020   edge:')..      
-0007c0e0: 2020 7662 6f78 2e61 6464 5769 6467 6574    vbox.addWidget
-0007c0f0: 2874 6578 7429 0d0a 0d0a 2020 2020 2020  (text)....      
-0007c100: 2020 6672 616d 6520 3d20 5174 5769 6467    frame = QtWidg
-0007c110: 6574 732e 5146 7261 6d65 2829 0d0a 2020  ets.QFrame()..  
-0007c120: 2020 2020 2020 6672 616d 652e 7365 7446        frame.setF
-0007c130: 7261 6d65 5374 796c 6528 5174 5769 6467  rameStyle(QtWidg
-0007c140: 6574 732e 5146 7261 6d65 2e53 7479 6c65  ets.QFrame.Style
-0007c150: 6450 616e 656c 7c51 7457 6964 6765 7473  dPanel|QtWidgets
-0007c160: 2e51 4672 616d 652e 5375 6e6b 656e 290d  .QFrame.Sunken).
-0007c170: 0a20 2020 2020 2020 2066 626f 7820 3d20  .        fbox = 
-0007c180: 5174 5769 6467 6574 732e 5148 426f 784c  QtWidgets.QHBoxL
-0007c190: 6179 6f75 7428 290d 0a0d 0a20 2020 2020  ayout()....     
-0007c1a0: 2020 2073 656c 662e 7370 6563 6669 6720     self.specfig 
-0007c1b0: 3d20 4669 6775 7265 2828 362e 302c 2034  = Figure((6.0, 4
-0007c1c0: 2e32 2929 0d0a 2020 2020 2020 2020 7365  .2))..        se
-0007c1d0: 6c66 2e53 7065 6374 7275 6d50 616e 656c  lf.SpectrumPanel
-0007c1e0: 203d 2046 6967 7572 6543 616e 7661 7328   = FigureCanvas(
-0007c1f0: 7365 6c66 2e73 7065 6366 6967 290d 0a20  self.specfig).. 
-0007c200: 2020 2020 2020 2073 656c 662e 5370 6563         self.Spec
-0007c210: 7472 756d 5061 6e65 6c2e 7365 7450 6172  trumPanel.setPar
-0007c220: 656e 7428 7365 6c66 290d 0a20 2020 2020  ent(self)..     
-0007c230: 2020 2073 656c 662e 5370 6563 7472 756d     self.Spectrum
-0007c240: 5061 6e65 6c2e 6d70 6c5f 636f 6e6e 6563  Panel.mpl_connec
-0007c250: 7428 2762 7574 746f 6e5f 7072 6573 735f  t('button_press_
-0007c260: 6576 656e 7427 2c20 7365 6c66 2e4f 6e53  event', self.OnS
-0007c270: 656c 6563 7469 6f6e 3129 0d0a 2020 2020  election1)..    
-0007c280: 2020 2020 7365 6c66 2e53 7065 6374 7275      self.Spectru
-0007c290: 6d50 616e 656c 2e6d 706c 5f63 6f6e 6e65  mPanel.mpl_conne
-0007c2a0: 6374 2827 6275 7474 6f6e 5f72 656c 6561  ct('button_relea
-0007c2b0: 7365 5f65 7665 6e74 272c 2073 656c 662e  se_event', self.
-0007c2c0: 4f6e 5365 6c65 6374 696f 6e32 290d 0a0d  OnSelection2)...
-0007c2d0: 0a20 2020 2020 2020 2066 626f 782e 6164  .        fbox.ad
-0007c2e0: 6457 6964 6765 7428 7365 6c66 2e53 7065  dWidget(self.Spe
-0007c2f0: 6374 7275 6d50 616e 656c 290d 0a20 2020  ctrumPanel)..   
-0007c300: 2020 2020 2066 7261 6d65 2e73 6574 4c61       frame.setLa
-0007c310: 796f 7574 2866 626f 7829 0d0a 2020 2020  yout(fbox)..    
-0007c320: 2020 2020 7662 6f78 2e61 6464 5769 6467      vbox.addWidg
-0007c330: 6574 2866 7261 6d65 290d 0a0d 0a0d 0a20  et(frame)...... 
-0007c340: 2020 2020 2020 2068 626f 7832 203d 2051         hbox2 = Q
-0007c350: 7457 6964 6765 7473 2e51 4842 6f78 4c61  tWidgets.QHBoxLa
-0007c360: 796f 7574 2829 0d0a 0d0a 0d0a 2020 2020  yout()......    
-0007c370: 2020 2020 7369 7a65 7232 203d 5174 5769      sizer2 =QtWi
-0007c380: 6467 6574 732e 5147 726f 7570 426f 7828  dgets.QGroupBox(
-0007c390: 2753 656c 6563 7465 6420 5370 6563 7472  'Selected Spectr
-0007c3a0: 616c 2052 6567 696f 6e73 2729 0d0a 2020  al Regions')..  
-0007c3b0: 2020 2020 2020 7369 7a65 7232 2e73 6574        sizer2.set
-0007c3c0: 4d69 6e69 6d75 6d57 6964 7468 2833 3530  MinimumWidth(350
-0007c3d0: 290d 0a20 2020 2020 2020 2076 626f 7832  )..        vbox2
-0007c3e0: 203d 2051 7457 6964 6765 7473 2e51 5642   = QtWidgets.QVB
-0007c3f0: 6f78 4c61 796f 7574 2829 0d0a 2020 2020  oxLayout()..    
-0007c400: 2020 2020 7465 7874 203d 2051 7457 6964      text = QtWid
-0007c410: 6765 7473 2e51 4c61 6265 6c28 7365 6c66  gets.QLabel(self
-0007c420: 290d 0a20 2020 2020 2020 2074 6578 742e  )..        text.
-0007c430: 7365 7454 6578 7428 2749 2053 656c 6563  setText('I Selec
-0007c440: 7469 6f6e 2028 7265 6429 3a20 2729 0d0a  tion (red): ')..
-0007c450: 2020 2020 2020 2020 7365 6c66 2e74 6578          self.tex
-0007c460: 7463 7472 6c31 203d 2051 7457 6964 6765  tctrl1 = QtWidge
-0007c470: 7473 2e51 4c61 6265 6c28 7365 6c66 290d  ts.QLabel(self).
-0007c480: 0a20 2020 2020 2020 2073 656c 662e 7465  .        self.te
-0007c490: 7874 6374 726c 312e 7365 7454 6578 7428  xtctrl1.setText(
-0007c4a0: 275b 2020 5d27 2029 0d0a 2020 2020 2020  '[  ]' )..      
-0007c4b0: 2020 7662 6f78 322e 6164 6457 6964 6765    vbox2.addWidge
-0007c4c0: 7428 7465 7874 290d 0a20 2020 2020 2020  t(text)..       
-0007c4d0: 2076 626f 7832 2e61 6464 5769 6467 6574   vbox2.addWidget
-0007c4e0: 2873 656c 662e 7465 7874 6374 726c 3129  (self.textctrl1)
-0007c4f0: 0d0a 0d0a 2020 2020 2020 2020 7465 7874  ....        text
-0007c500: 203d 2051 7457 6964 6765 7473 2e51 4c61   = QtWidgets.QLa
-0007c510: 6265 6c28 7365 6c66 290d 0a20 2020 2020  bel(self)..     
-0007c520: 2020 2074 6578 742e 7365 7454 6578 7428     text.setText(
-0007c530: 2749 3020 5365 6c65 6374 696f 6e20 2867  'I0 Selection (g
-0007c540: 7265 656e 293a 2027 290d 0a20 2020 2020  reen): ')..     
-0007c550: 2020 2073 656c 662e 7465 7874 6374 726c     self.textctrl
-0007c560: 3220 3d20 5174 5769 6467 6574 732e 514c  2 = QtWidgets.QL
-0007c570: 6162 656c 2873 656c 6629 0d0a 2020 2020  abel(self)..    
-0007c580: 2020 2020 7365 6c66 2e74 6578 7463 7472      self.textctr
-0007c590: 6c32 2e73 6574 5465 7874 2827 5b20 205d  l2.setText('[  ]
-0007c5a0: 2720 290d 0a20 2020 2020 2020 2076 626f  ' )..        vbo
-0007c5b0: 7832 2e61 6464 5769 6467 6574 2874 6578  x2.addWidget(tex
-0007c5c0: 7429 0d0a 2020 2020 2020 2020 7662 6f78  t)..        vbox
-0007c5d0: 322e 6164 6457 6964 6765 7428 7365 6c66  2.addWidget(self
-0007c5e0: 2e74 6578 7463 7472 6c32 290d 0a20 2020  .textctrl2)..   
-0007c5f0: 2020 2020 2073 697a 6572 322e 7365 744c       sizer2.setL
-0007c600: 6179 6f75 7428 7662 6f78 3229 0d0a 0d0a  ayout(vbox2)....
-0007c610: 2020 2020 2020 2020 7465 7874 203d 2051          text = Q
-0007c620: 7457 6964 6765 7473 2e51 4c61 6265 6c28  tWidgets.QLabel(
-0007c630: 7365 6c66 290d 0a20 2020 2020 2020 2074  self)..        t
-0007c640: 6578 742e 7365 7454 6578 7428 274f 7074  ext.setText('Opt
-0007c650: 6963 616c 2064 656e 7369 7479 206d 6170  ical density map
-0007c660: 2729 0d0a 2020 2020 2020 2020 7662 6f78  ')..        vbox
-0007c670: 2e61 6464 5769 6467 6574 2874 6578 7429  .addWidget(text)
-0007c680: 0d0a 0d0a 2020 2020 2020 2020 6672 616d  ....        fram
-0007c690: 6520 3d20 5174 5769 6467 6574 732e 5146  e = QtWidgets.QF
-0007c6a0: 7261 6d65 2829 0d0a 2020 2020 2020 2020  rame()..        
-0007c6b0: 6672 616d 652e 7365 7446 7261 6d65 5374  frame.setFrameSt
-0007c6c0: 796c 6528 5174 5769 6467 6574 732e 5146  yle(QtWidgets.QF
-0007c6d0: 7261 6d65 2e53 7479 6c65 6450 616e 656c  rame.StyledPanel
-0007c6e0: 7c51 7457 6964 6765 7473 2e51 4672 616d  |QtWidgets.QFram
-0007c6f0: 652e 5375 6e6b 656e 290d 0a20 2020 2020  e.Sunken)..     
-0007c700: 2020 2066 626f 7820 3d20 5174 5769 6467     fbox = QtWidg
-0007c710: 6574 732e 5148 426f 784c 6179 6f75 7428  ets.QHBoxLayout(
-0007c720: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-0007c730: 662e 6f64 6d66 6967 203d 2046 6967 7572  f.odmfig = Figur
-0007c740: 6528 2832 2e34 2c32 2e34 2929 0d0a 2020  e((2.4,2.4))..  
-0007c750: 2020 2020 2020 7365 6c66 2e4f 444d 496d        self.ODMIm
-0007c760: 6167 6550 616e 656c 203d 2046 6967 7572  agePanel = Figur
-0007c770: 6543 616e 7661 7328 7365 6c66 2e6f 646d  eCanvas(self.odm
-0007c780: 6669 6729 0d0a 2020 2020 2020 2020 7365  fig)..        se
-0007c790: 6c66 2e4f 444d 496d 6167 6550 616e 656c  lf.ODMImagePanel
-0007c7a0: 2e73 6574 5061 7265 6e74 2873 656c 6629  .setParent(self)
-0007c7b0: 0d0a 0d0a 2020 2020 2020 2020 6662 6f78  ....        fbox
-0007c7c0: 2e61 6464 5769 6467 6574 2873 656c 662e  .addWidget(self.
-0007c7d0: 4f44 4d49 6d61 6765 5061 6e65 6c2c 2073  ODMImagePanel, s
-0007c7e0: 7472 6574 6368 3d30 290d 0a20 2020 2020  tretch=0)..     
-0007c7f0: 2020 2066 7261 6d65 2e73 6574 4c61 796f     frame.setLayo
-0007c800: 7574 2866 626f 7829 0d0a 2020 2020 2020  ut(fbox)..      
-0007c810: 2020 6862 6f78 322e 6164 6457 6964 6765    hbox2.addWidge
-0007c820: 7428 6672 616d 652c 2073 7472 6574 6368  t(frame, stretch
-0007c830: 3d30 290d 0a20 2020 2020 2020 2068 626f  =0)..        hbo
-0007c840: 7832 2e61 6464 5374 7265 7463 6828 302e  x2.addStretch(0.
-0007c850: 3529 0d0a 2020 2020 2020 2020 6862 6f78  5)..        hbox
-0007c860: 322e 6164 6457 6964 6765 7428 7369 7a65  2.addWidget(size
-0007c870: 7232 290d 0a0d 0a20 2020 2020 2020 2076  r2)....        v
-0007c880: 626f 782e 6164 644c 6179 6f75 7428 6862  box.addLayout(hb
-0007c890: 6f78 3229 0d0a 0d0a 2020 2020 2020 2020  ox2)....        
-0007c8a0: 6862 6f78 203d 2051 7457 6964 6765 7473  hbox = QtWidgets
-0007c8b0: 2e51 4842 6f78 4c61 796f 7574 2829 0d0a  .QHBoxLayout()..
-0007c8c0: 0d0a 2020 2020 2020 2020 6275 7474 6f6e  ..        button
-0007c8d0: 5f73 6176 6520 3d20 5174 5769 6467 6574  _save = QtWidget
-0007c8e0: 732e 5150 7573 6842 7574 746f 6e28 2753  s.QPushButton('S
-0007c8f0: 6176 6527 290d 0a20 2020 2020 2020 2062  ave')..        b
-0007c900: 7574 746f 6e5f 7361 7665 2e63 6c69 636b  utton_save.click
-0007c910: 6564 2e63 6f6e 6e65 6374 2873 656c 662e  ed.connect(self.
-0007c920: 4f6e 5361 7665 290d 0a20 2020 2020 2020  OnSave)..       
-0007c930: 2068 626f 782e 6164 6457 6964 6765 7428   hbox.addWidget(
-0007c940: 6275 7474 6f6e 5f73 6176 6529 0d0a 0d0a  button_save)....
-0007c950: 2020 2020 2020 2020 6275 7474 6f6e 5f63          button_c
-0007c960: 616e 6365 6c20 3d20 5174 5769 6467 6574  ancel = QtWidget
-0007c970: 732e 5150 7573 6842 7574 746f 6e28 2744  s.QPushButton('D
-0007c980: 6973 6d69 7373 2729 0d0a 2020 2020 2020  ismiss')..      
-0007c990: 2020 6275 7474 6f6e 5f63 616e 6365 6c2e    button_cancel.
-0007c9a0: 636c 6963 6b65 642e 636f 6e6e 6563 7428  clicked.connect(
-0007c9b0: 7365 6c66 2e63 6c6f 7365 290d 0a20 2020  self.close)..   
-0007c9c0: 2020 2020 2068 626f 782e 6164 6457 6964       hbox.addWid
-0007c9d0: 6765 7428 6275 7474 6f6e 5f63 616e 6365  get(button_cance
-0007c9e0: 6c29 0d0a 0d0a 2020 2020 2020 2020 7662  l)....        vb
-0007c9f0: 6f78 2e61 6464 4c61 796f 7574 2868 626f  ox.addLayout(hbo
-0007ca00: 7829 0d0a 0d0a 0d0a 2020 2020 2020 2020  x)......        
-0007ca10: 7365 6c66 2e73 6574 4c61 796f 7574 2876  self.setLayout(v
-0007ca20: 626f 7829 0d0a 0d0a 2020 2020 2020 2020  box)....        
-0007ca30: 7365 6c66 2e64 7261 775f 7370 6563 7472  self.draw_spectr
-0007ca40: 756d 2829 0d0a 0d0a 0d0a 232d 2d2d 2d2d  um()......#-----
-0007ca50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007ca60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007ca70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007ca80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007ca90: 2d0d 0a20 2020 2064 6566 2064 7261 775f  -..    def draw_
-0007caa0: 7370 6563 7472 756d 2873 656c 6629 3a0d  spectrum(self):.
-0007cab0: 0a0d 0a0d 0a20 2020 2020 2020 2066 6967  .....        fig
-0007cac0: 203d 2073 656c 662e 7370 6563 6669 670d   = self.specfig.
-0007cad0: 0a20 2020 2020 2020 2066 6967 2e63 6c66  .        fig.clf
-0007cae0: 2829 0d0a 2020 2020 2020 2020 6669 672e  ()..        fig.
-0007caf0: 6164 645f 6178 6573 2828 302e 3135 2c30  add_axes((0.15,0
-0007cb00: 2e31 352c 302e 3735 2c30 2e37 3529 290d  .15,0.75,0.75)).
-0007cb10: 0a20 2020 2020 2020 2073 656c 662e 6178  .        self.ax
-0007cb20: 6573 203d 2066 6967 2e67 6361 2829 0d0a  es = fig.gca()..
-0007cb30: 0d0a 0d0a 2020 2020 2020 2020 7370 6563  ....        spec
-0007cb40: 706c 6f74 203d 2073 656c 662e 6178 6573  plot = self.axes
-0007cb50: 2e70 6c6f 7428 7365 6c66 2e73 7461 636b  .plot(self.stack
-0007cb60: 2e65 762c 7365 6c66 2e6f 6474 6f74 616c  .ev,self.odtotal
-0007cb70: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
-0007cb80: 7365 6c66 2e69 3073 656c 6563 7465 6420  self.i0selected 
-0007cb90: 3d3d 2031 3a0d 0a20 2020 2020 2020 2020  == 1:..         
-0007cba0: 2020 2073 656c 662e 6178 6573 2e61 7876     self.axes.axv
-0007cbb0: 7370 616e 2873 656c 662e 7374 6163 6b2e  span(self.stack.
-0007cbc0: 6576 5b73 656c 662e 6930 6d69 6e5d 2c20  ev[self.i0min], 
-0007cbd0: 7365 6c66 2e73 7461 636b 2e65 765b 7365  self.stack.ev[se
-0007cbe0: 6c66 2e69 306d 6178 5d2c 2066 6163 6563  lf.i0max], facec
-0007cbf0: 6f6c 6f72 3d27 6727 2c20 616c 7068 613d  olor='g', alpha=
-0007cc00: 302e 3529 0d0a 0d0a 2020 2020 2020 2020  0.5)....        
-0007cc10: 6966 2073 656c 662e 6973 656c 6563 7465  if self.iselecte
-0007cc20: 6420 3d3d 2031 3a0d 0a20 2020 2020 2020  d == 1:..       
-0007cc30: 2020 2020 2073 656c 662e 6178 6573 2e61       self.axes.a
-0007cc40: 7876 7370 616e 2873 656c 662e 7374 6163  xvspan(self.stac
-0007cc50: 6b2e 6576 5b73 656c 662e 696d 696e 5d2c  k.ev[self.imin],
-0007cc60: 2073 656c 662e 7374 6163 6b2e 6576 5b73   self.stack.ev[s
-0007cc70: 656c 662e 696d 6178 5d2c 2066 6163 6563  elf.imax], facec
-0007cc80: 6f6c 6f72 3d27 7227 2c20 616c 7068 613d  olor='r', alpha=
-0007cc90: 302e 3529 0d0a 0d0a 0d0a 2020 2020 2020  0.5)......      
-0007cca0: 2020 7365 6c66 2e61 7865 732e 7365 745f    self.axes.set_
-0007ccb0: 786c 6162 656c 2827 5068 6f74 6f6e 2045  xlabel('Photon E
-0007ccc0: 6e65 7267 7920 5b65 565d 2729 0d0a 2020  nergy [eV]')..  
-0007ccd0: 2020 2020 2020 7365 6c66 2e61 7865 732e        self.axes.
-0007cce0: 7365 745f 796c 6162 656c 2827 4f70 7469  set_ylabel('Opti
-0007ccf0: 6361 6c20 4465 6e73 6974 7927 290d 0a0d  cal Density')...
-0007cd00: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0007cd10: 5370 6563 7472 756d 5061 6e65 6c2e 6472  SpectrumPanel.dr
-0007cd20: 6177 2829 0d0a 0d0a 0d0a 232d 2d2d 2d2d  aw()......#-----
-0007cd30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007cd40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007cd50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007cd60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007cd70: 2d0d 0a20 2020 2064 6566 2064 7261 775f  -..    def draw_
-0007cd80: 696d 6167 6528 7365 6c66 293a 0d0a 0d0a  image(self):....
-0007cd90: 0d0a 2020 2020 2020 2020 6669 6720 3d20  ..        fig = 
-0007cda0: 7365 6c66 2e6f 646d 6669 670d 0a20 2020  self.odmfig..   
-0007cdb0: 2020 2020 2066 6967 2e63 6c66 2829 0d0a       fig.clf()..
-0007cdc0: 2020 2020 2020 2020 6669 672e 6164 645f          fig.add_
-0007cdd0: 6178 6573 2828 302e 3032 2c30 2e30 322c  axes((0.02,0.02,
-0007cde0: 302e 3936 2c30 2e39 3629 290d 0a0d 0a20  0.96,0.96)).... 
-0007cdf0: 2020 2020 2020 2061 7865 7320 3d20 6669         axes = fi
-0007ce00: 672e 6763 6128 290d 0a20 2020 2020 2020  g.gca()..       
-0007ce10: 2064 6976 6964 6572 203d 206d 616b 655f   divider = make_
-0007ce20: 6178 6573 5f6c 6f63 6174 6162 6c65 2861  axes_locatable(a
-0007ce30: 7865 7329 0d0a 2020 2020 2020 2020 6178  xes)..        ax
-0007ce40: 6362 203d 2064 6976 6964 6572 2e6e 6577  cb = divider.new
-0007ce50: 5f68 6f72 697a 6f6e 7461 6c28 7369 7a65  _horizontal(size
-0007ce60: 3d22 3325 222c 2070 6164 3d30 2e30 3329  ="3%", pad=0.03)
-0007ce70: 0d0a 0d0a 2020 2020 2020 2020 6669 672e  ....        fig.
-0007ce80: 6164 645f 6178 6573 2861 7863 6229 0d0a  add_axes(axcb)..
-0007ce90: 0d0a 2020 2020 2020 2020 6178 6573 2e73  ..        axes.s
-0007cea0: 6574 5f70 6f73 6974 696f 6e28 5b30 2e30  et_position([0.0
-0007ceb0: 332c 302e 3033 2c30 2e38 2c30 2e39 345d  3,0.03,0.8,0.94]
-0007cec0: 290d 0a0d 0a0d 0a20 2020 2020 2020 2069  )......        i
-0007ced0: 6d20 3d20 6178 6573 2e69 6d73 686f 7728  m = axes.imshow(
-0007cee0: 6e70 2e72 6f74 3930 2873 656c 662e 6f64  np.rot90(self.od
-0007cef0: 7468 6963 6b6d 6170 292c 2063 6d61 703d  thickmap), cmap=
-0007cf00: 6d61 7470 6c6f 746c 6962 2e63 6d2e 6765  matplotlib.cm.ge
-0007cf10: 745f 636d 6170 2822 6772 6179 2229 290d  t_cmap("gray")).
-0007cf20: 0a0d 0a20 2020 2020 2020 2063 6261 7220  ...        cbar 
-0007cf30: 3d20 6178 6573 2e66 6967 7572 652e 636f  = axes.figure.co
-0007cf40: 6c6f 7262 6172 2869 6d2c 206f 7269 656e  lorbar(im, orien
-0007cf50: 7461 7469 6f6e 3d27 7665 7274 6963 616c  tation='vertical
-0007cf60: 272c 6361 783d 6178 6362 290d 0a0d 0a20  ',cax=axcb).... 
-0007cf70: 2020 2020 2020 2023 5368 6f77 2053 6361         #Show Sca
-0007cf80: 6c65 2042 6172 0d0a 2020 2020 2020 2020  le Bar..        
-0007cf90: 7374 6172 7478 203d 2069 6e74 2873 656c  startx = int(sel
-0007cfa0: 662e 7374 6163 6b2e 6e5f 726f 7773 2a30  f.stack.n_rows*0
-0007cfb0: 2e30 3529 0d0a 2020 2020 2020 2020 7374  .05)..        st
-0007cfc0: 6172 7479 203d 2073 656c 662e 7374 6163  arty = self.stac
-0007cfd0: 6b2e 6e5f 636f 6c73 2d69 6e74 2873 656c  k.n_cols-int(sel
-0007cfe0: 662e 7374 6163 6b2e 6e5f 636f 6c73 2a30  f.stack.n_cols*0
-0007cff0: 2e30 3529 2d73 656c 662e 7374 6163 6b2e  .05)-self.stack.
-0007d000: 7363 616c 655f 6261 725f 7069 7865 6c73  scale_bar_pixels
-0007d010: 5f79 0d0a 2020 2020 2020 2020 756d 5f73  _y..        um_s
-0007d020: 7472 696e 6720 3d20 2720 245c 6d61 7468  tring = ' $\math
-0007d030: 726d 7b5c 6d75 206d 7d24 270d 0a20 2020  rm{\mu m}$'..   
-0007d040: 2020 2020 206d 6963 726f 6e73 203d 2027       microns = '
-0007d050: 2427 2b73 656c 662e 7374 6163 6b2e 7363  $'+self.stack.sc
-0007d060: 616c 655f 6261 725f 7374 7269 6e67 2b27  ale_bar_string+'
-0007d070: 2024 272b 756d 5f73 7472 696e 670d 0a20   $'+um_string.. 
-0007d080: 2020 2020 2020 2061 7865 732e 7465 7874         axes.text
-0007d090: 2873 656c 662e 7374 6163 6b2e 7363 616c  (self.stack.scal
-0007d0a0: 655f 6261 725f 7069 7865 6c73 5f78 2b73  e_bar_pixels_x+s
-0007d0b0: 7461 7274 782b 312c 7374 6172 7479 2b31  tartx+1,starty+1
-0007d0c0: 2c20 6d69 6372 6f6e 732c 2068 6f72 697a  , microns, horiz
-0007d0d0: 6f6e 7461 6c61 6c69 676e 6d65 6e74 3d27  ontalalignment='
-0007d0e0: 6c65 6674 272c 2076 6572 7469 6361 6c61  left', verticala
-0007d0f0: 6c69 676e 6d65 6e74 3d27 6365 6e74 6572  lignment='center
-0007d100: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-0007d110: 2020 2020 2020 636f 6c6f 7220 3d20 2777        color = 'w
-0007d120: 6869 7465 272c 2066 6f6e 7473 697a 653d  hite', fontsize=
-0007d130: 3134 290d 0a20 2020 2020 2020 2023 4d61  14)..        #Ma
-0007d140: 7470 6c6f 746c 6962 2068 6173 2066 6c69  tplotlib has fli
-0007d150: 7070 6564 2073 6361 6c65 7320 736f 2049  pped scales so I
-0007d160: 276d 2075 7369 6e67 2072 6f77 7320 696e  'm using rows in
-0007d170: 7374 6561 6420 6f66 2063 6f6c 7321 0d0a  stead of cols!..
-0007d180: 2020 2020 2020 2020 7020 3d20 6d61 7470          p = matp
-0007d190: 6c6f 746c 6962 2e70 6174 6368 6573 2e52  lotlib.patches.R
-0007d1a0: 6563 7461 6e67 6c65 2828 7374 6172 7478  ectangle((startx
-0007d1b0: 2c73 7461 7274 7929 2c20 7365 6c66 2e73  ,starty), self.s
-0007d1c0: 7461 636b 2e73 6361 6c65 5f62 6172 5f70  tack.scale_bar_p
-0007d1d0: 6978 656c 735f 782c 2073 656c 662e 7374  ixels_x, self.st
-0007d1e0: 6163 6b2e 7363 616c 655f 6261 725f 7069  ack.scale_bar_pi
-0007d1f0: 7865 6c73 5f79 2c0d 0a20 2020 2020 2020  xels_y,..       
-0007d200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007d210: 2020 2020 2020 2020 636f 6c6f 7220 3d20          color = 
-0007d220: 2777 6869 7465 272c 2066 696c 6c20 3d20  'white', fill = 
-0007d230: 5472 7565 290d 0a20 2020 2020 2020 2061  True)..        a
-0007d240: 7865 732e 6164 645f 7061 7463 6828 7029  xes.add_patch(p)
-0007d250: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6178  ......        ax
-0007d260: 6573 2e61 7869 7328 226f 6666 2229 0d0a  es.axis("off")..
-0007d270: 2020 2020 2020 2020 7365 6c66 2e4f 444d          self.ODM
-0007d280: 496d 6167 6550 616e 656c 2e64 7261 7728  ImagePanel.draw(
-0007d290: 290d 0a0d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d  )......#--------
-0007d2a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007d2b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007d2c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007d2d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a  --------------..
-0007d2e0: 2020 2020 6465 6620 4f6e 5365 6c65 6374      def OnSelect
-0007d2f0: 696f 6e31 2873 656c 662c 2065 7674 293a  ion1(self, evt):
-0007d300: 0d0a 0d0a 2020 2020 2020 2020 7831 203d  ....        x1 =
-0007d310: 2065 7674 2e78 6461 7461 0d0a 0d0a 2020   evt.xdata....  
-0007d320: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
-0007d330: 6e5f 7072 6573 7365 6420 3d20 5472 7565  n_pressed = True
-0007d340: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-0007d350: 6174 6368 203d 204e 6f6e 650d 0a20 2020  atch = None..   
-0007d360: 2020 2020 2073 656c 662e 636f 6e6e 203d       self.conn =
-0007d370: 2073 656c 662e 5370 6563 7472 756d 5061   self.SpectrumPa
-0007d380: 6e65 6c2e 6d70 6c5f 636f 6e6e 6563 7428  nel.mpl_connect(
-0007d390: 276d 6f74 696f 6e5f 6e6f 7469 6679 5f65  'motion_notify_e
-0007d3a0: 7665 6e74 272c 2073 656c 662e 4f6e 5365  vent', self.OnSe
-0007d3b0: 6c65 6374 696f 6e4d 6f74 696f 6e29 0d0a  lectionMotion)..
-0007d3c0: 0d0a 2020 2020 2020 2020 6966 2078 3120  ..        if x1 
-0007d3d0: 3d3d 204e 6f6e 653a 0d0a 2020 2020 2020  == None:..      
-0007d3e0: 2020 2020 2020 7265 7475 726e 0d0a 0d0a        return....
-0007d3f0: 2020 2020 2020 2020 7365 6c66 2e78 3120          self.x1 
-0007d400: 3d20 7831 0d0a 0d0a 232d 2d2d 2d2d 2d2d  = x1....#-------
-0007d410: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007d420: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007d430: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007d440: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
-0007d450: 0a20 2020 2064 6566 204f 6e53 656c 6563  .    def OnSelec
-0007d460: 7469 6f6e 3228 7365 6c66 2c20 6576 7429  tion2(self, evt)
-0007d470: 3a0d 0a0d 0a20 2020 2020 2020 2078 3220  :....        x2 
-0007d480: 3d20 6576 742e 7864 6174 610d 0a0d 0a0d  = evt.xdata.....
-0007d490: 0a20 2020 2020 2020 2073 656c 662e 6275  .        self.bu
-0007d4a0: 7474 6f6e 5f70 7265 7373 6564 203d 2046  tton_pressed = F
-0007d4b0: 616c 7365 0d0a 2020 2020 2020 2020 7365  alse..        se
-0007d4c0: 6c66 2e53 7065 6374 7275 6d50 616e 656c  lf.SpectrumPanel
-0007d4d0: 2e6d 706c 5f64 6973 636f 6e6e 6563 7428  .mpl_disconnect(
-0007d4e0: 7365 6c66 2e63 6f6e 6e29 0d0a 0d0a 2020  self.conn)....  
-0007d4f0: 2020 2020 2020 6966 2078 3220 3d3d 204e        if x2 == N
-0007d500: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-0007d510: 2020 7265 7475 726e 0d0a 0d0a 2020 2020    return....    
-0007d520: 2020 2020 7831 203d 2073 656c 662e 7831      x1 = self.x1
-0007d530: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6966  ......        if
-0007d540: 2028 7365 6c66 2e69 3073 656c 6563 7465   (self.i0selecte
-0007d550: 6420 3d3d 2031 2920 616e 6420 2873 656c  d == 1) and (sel
-0007d560: 662e 6973 656c 6563 7465 6420 3d3d 3129  f.iselected ==1)
-0007d570: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0007d580: 656c 662e 6930 7365 6c65 6374 6564 203d  elf.i0selected =
-0007d590: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
-0007d5a0: 7365 6c66 2e69 7365 6c65 6374 6564 203d  self.iselected =
-0007d5b0: 2030 0d0a 0d0a 2020 2020 2020 2020 6966   0....        if
-0007d5c0: 2073 656c 662e 6930 7365 6c65 6374 6564   self.i0selected
-0007d5d0: 203d 3d20 303a 0d0a 2020 2020 2020 2020   == 0:..        
-0007d5e0: 2020 2020 7365 6c66 2e69 306d 696e 203d      self.i0min =
-0007d5f0: 206e 702e 6162 7328 7365 6c66 2e73 7461   np.abs(self.sta
-0007d600: 636b 2e65 7620 2d20 7831 292e 6172 676d  ck.ev - x1).argm
-0007d610: 696e 2829 0d0a 2020 2020 2020 2020 2020  in()..          
-0007d620: 2020 7365 6c66 2e69 306d 6178 203d 206e    self.i0max = n
-0007d630: 702e 6162 7328 7365 6c66 2e73 7461 636b  p.abs(self.stack
-0007d640: 2e65 7620 2d20 7832 292e 6172 676d 696e  .ev - x2).argmin
-0007d650: 2829 0d0a 0d0a 2020 2020 2020 2020 2020  ()....          
-0007d660: 2020 7365 6c66 2e69 6d61 6765 5f69 3020    self.image_i0 
-0007d670: 3d20 6e70 2e73 756d 2873 656c 662e 7374  = np.sum(self.st
-0007d680: 6163 6b2e 6162 7364 6174 615b 3a2c 203a  ack.absdata[:, :
-0007d690: 2c20 7365 6c66 2e69 306d 696e 3a73 656c  , self.i0min:sel
-0007d6a0: 662e 6930 6d61 782b 315d 2c20 6178 6973  f.i0max+1], axis
-0007d6b0: 3d32 292f 2873 656c 662e 6930 6d61 782b  =2)/(self.i0max+
-0007d6c0: 312d 7365 6c66 2e69 306d 696e 290d 0a0d  1-self.i0min)...
-0007d6d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0007d6e0: 662e 7465 7874 6374 726c 312e 7365 7454  f.textctrl1.setT
-0007d6f0: 6578 7428 2753 656c 6563 7469 6f6e 3a20  ext('Selection: 
-0007d700: 5b20 272b 7374 7228 7365 6c66 2e73 7461  [ '+str(self.sta
-0007d710: 636b 2e65 765b 7365 6c66 2e69 306d 696e  ck.ev[self.i0min
-0007d720: 5d29 202b 2027 2065 562c 2027 2b20 7374  ]) + ' eV, '+ st
-0007d730: 7228 7365 6c66 2e73 7461 636b 2e65 765b  r(self.stack.ev[
-0007d740: 7365 6c66 2e69 306d 6178 5d29 2b27 2065  self.i0max])+' e
-0007d750: 5620 5d27 2029 0d0a 2020 2020 2020 2020  V ]' )..        
-0007d760: 2020 2020 7365 6c66 2e69 3073 656c 6563      self.i0selec
-0007d770: 7465 6420 3d20 310d 0a0d 0a20 2020 2020  ted = 1....     
-0007d780: 2020 2065 6c69 6620 7365 6c66 2e69 7365     elif self.ise
-0007d790: 6c65 6374 6564 203d 3d20 303a 0d0a 2020  lected == 0:..  
-0007d7a0: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-0007d7b0: 6d69 6e20 3d20 6e70 2e61 6273 2873 656c  min = np.abs(sel
-0007d7c0: 662e 7374 6163 6b2e 6576 202d 2078 3129  f.stack.ev - x1)
-0007d7d0: 2e61 7267 6d69 6e28 290d 0a20 2020 2020  .argmin()..     
-0007d7e0: 2020 2020 2020 2073 656c 662e 696d 6178         self.imax
-0007d7f0: 203d 206e 702e 6162 7328 7365 6c66 2e73   = np.abs(self.s
-0007d800: 7461 636b 2e65 7620 2d20 7832 292e 6172  tack.ev - x2).ar
-0007d810: 676d 696e 2829 0d0a 0d0a 2020 2020 2020  gmin()....      
-0007d820: 2020 2020 2020 7365 6c66 2e69 6d61 6765        self.image
-0007d830: 5f69 203d 206e 702e 7375 6d28 7365 6c66  _i = np.sum(self
-0007d840: 2e73 7461 636b 2e61 6273 6461 7461 5b3a  .stack.absdata[:
-0007d850: 2c20 3a2c 2073 656c 662e 696d 696e 3a73  , :, self.imin:s
-0007d860: 656c 662e 696d 6178 2b31 5d2c 2061 7869  elf.imax+1], axi
-0007d870: 733d 3229 2f28 7365 6c66 2e69 6d61 782b  s=2)/(self.imax+
-0007d880: 312d 7365 6c66 2e69 6d69 6e29 0d0a 0d0a  1-self.imin)....
-0007d890: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0007d8a0: 2e74 6578 7463 7472 6c32 2e73 6574 5465  .textctrl2.setTe
-0007d8b0: 7874 2827 5365 6c65 6374 696f 6e3a 205b  xt('Selection: [
-0007d8c0: 2027 2b73 7472 2873 656c 662e 7374 6163   '+str(self.stac
-0007d8d0: 6b2e 6576 5b73 656c 662e 696d 696e 5d29  k.ev[self.imin])
-0007d8e0: 202b 2027 2065 562c 2027 2b20 7374 7228   + ' eV, '+ str(
-0007d8f0: 7365 6c66 2e73 7461 636b 2e65 765b 7365  self.stack.ev[se
-0007d900: 6c66 2e69 6d61 785d 292b 2720 6556 205d  lf.imax])+' eV ]
-0007d910: 2720 290d 0a20 2020 2020 2020 2020 2020  ' )..           
-0007d920: 2073 656c 662e 6973 656c 6563 7465 6420   self.iselected 
-0007d930: 3d20 310d 0a0d 0a20 2020 2020 2020 2069  = 1....        i
-0007d940: 6620 2873 656c 662e 6930 7365 6c65 6374  f (self.i0select
-0007d950: 6564 203d 3d20 3129 2061 6e64 2028 7365  ed == 1) and (se
-0007d960: 6c66 2e69 7365 6c65 6374 6564 203d 3d31  lf.iselected ==1
-0007d970: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0007d980: 6e6f 6e7a 6572 6f69 6e64 203d 2073 656c  nonzeroind = sel
-0007d990: 662e 696d 6167 655f 6930 2e6e 6f6e 7a65  f.image_i0.nonze
-0007d9a0: 726f 2829 0d0a 2020 2020 2020 2020 2020  ro()..          
-0007d9b0: 2020 7365 6c66 2e6f 6474 6869 636b 6d61    self.odthickma
-0007d9c0: 7020 3d20 6e70 2e7a 6572 6f73 2828 7365  p = np.zeros((se
-0007d9d0: 6c66 2e73 7461 636b 2e6e 5f63 6f6c 732c  lf.stack.n_cols,
-0007d9e0: 2073 656c 662e 7374 6163 6b2e 6e5f 726f   self.stack.n_ro
-0007d9f0: 7773 2929 0d0a 2020 2020 2020 2020 2020  ws))..          
-0007da00: 2020 7365 6c66 2e6f 6474 6869 636b 6d61    self.odthickma
-0007da10: 705b 6e6f 6e7a 6572 6f69 6e64 5d20 3d20  p[nonzeroind] = 
-0007da20: 2d20 6e70 2e6c 6f67 2873 656c 662e 696d  - np.log(self.im
-0007da30: 6167 655f 695b 6e6f 6e7a 6572 6f69 6e64  age_i[nonzeroind
-0007da40: 5d2f 7365 6c66 2e69 6d61 6765 5f69 305b  ]/self.image_i0[
-0007da50: 6e6f 6e7a 6572 6f69 6e64 5d29 0d0a 2020  nonzeroind])..  
-0007da60: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-0007da70: 7261 775f 696d 6167 6528 290d 0a0d 0a0d  raw_image().....
-0007da80: 0a20 2020 2020 2020 2073 656c 662e 6472  .        self.dr
-0007da90: 6177 5f73 7065 6374 7275 6d28 290d 0a0d  aw_spectrum()...
-0007daa0: 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ...#------------
-0007dab0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007dac0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007dad0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007dae0: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
-0007daf0: 6465 6620 4f6e 5365 6c65 6374 696f 6e4d  def OnSelectionM
-0007db00: 6f74 696f 6e28 7365 6c66 2c20 6576 656e  otion(self, even
-0007db10: 7429 3a0d 0a0d 0a20 2020 2020 2020 2078  t):....        x
-0007db20: 3220 3d20 6576 656e 742e 7864 6174 610d  2 = event.xdata.
-0007db30: 0a0d 0a20 2020 2020 2020 2069 6620 7832  ...        if x2
-0007db40: 203d 3d20 4e6f 6e65 3a0d 0a20 2020 2020   == None:..     
-0007db50: 2020 2020 2020 2072 6574 7572 6e0d 0a0d         return...
-0007db60: 0a20 2020 2020 2020 2078 3120 3d20 7365  .        x1 = se
-0007db70: 6c66 2e78 310d 0a0d 0a0d 0a20 2020 2020  lf.x1......     
-0007db80: 2020 2066 6967 203d 2073 656c 662e 7370     fig = self.sp
-0007db90: 6563 6669 670d 0a0d 0a20 2020 2020 2020  ecfig....       
-0007dba0: 2061 7865 7320 3d20 6669 672e 6763 6128   axes = fig.gca(
-0007dbb0: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
-0007dbc0: 7365 6c66 2e70 6174 6368 2021 3d20 4e6f  self.patch != No
-0007dbd0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0007dbe0: 2073 656c 662e 7061 7463 682e 7265 6d6f   self.patch.remo
-0007dbf0: 7665 2829 0d0a 2020 2020 2020 2020 7365  ve()..        se
-0007dc00: 6c66 2e70 6174 6368 203d 2073 656c 662e  lf.patch = self.
-0007dc10: 6178 6573 2e61 7876 7370 616e 2878 312c  axes.axvspan(x1,
-0007dc20: 2078 322c 2066 6163 6563 6f6c 6f72 3d27   x2, facecolor='
-0007dc30: 7727 2c20 616c 7068 613d 302e 3529 0d0a  w', alpha=0.5)..
-0007dc40: 0d0a 2020 2020 2020 2020 7365 6c66 2e53  ..        self.S
-0007dc50: 7065 6374 7275 6d50 616e 656c 2e64 7261  pectrumPanel.dra
-0007dc60: 7728 290d 0a0d 0a0d 0a23 2d2d 2d2d 2d2d  w()......#------
-0007dc70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007dc80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007dc90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007dca0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007dcb0: 0d0a 2020 2020 6465 6620 4f6e 5361 7665  ..    def OnSave
-0007dcc0: 2873 656c 662c 2065 7674 293a 0d0a 2020  (self, evt):..  
-0007dcd0: 2020 2020 2020 2353 6176 6520 696d 6167        #Save imag
-0007dce0: 6573 0d0a 0d0a 2020 2020 2020 2020 7769  es....        wi
-0007dcf0: 6c64 6361 7264 203d 2022 506f 7274 6162  ldcard = "Portab
-0007dd00: 6c65 204e 6574 776f 726b 2047 7261 7068  le Network Graph
-0007dd10: 6963 7320 282a 2e70 6e67 293b 3b41 646f  ics (*.png);;Ado
-0007dd20: 6265 2050 4446 2046 696c 6573 2028 2a2e  be PDF Files (*.
-0007dd30: 7064 6629 3b3b 5449 4646 2046 696c 6520  pdf);;TIFF File 
-0007dd40: 282a 2e74 6966 293b 3b22 0d0a 0d0a 2020  (*.tif);;"....  
-0007dd50: 2020 2020 2020 6669 6c65 4e61 6d65 2c20        fileName, 
-0007dd60: 5f66 696c 7465 7220 3d20 5174 5769 6467  _filter = QtWidg
-0007dd70: 6574 732e 5146 696c 6544 6961 6c6f 672e  ets.QFileDialog.
-0007dd80: 6765 7453 6176 6546 696c 654e 616d 6528  getSaveFileName(
-0007dd90: 7365 6c66 2c20 2753 6176 6520 4f44 204d  self, 'Save OD M
-0007dda0: 6170 272c 2027 272c 2077 696c 6463 6172  ap', '', wildcar
-0007ddb0: 6429 0d0a 0d0a 2020 2020 2020 2020 6669  d)....        fi
-0007ddc0: 6c65 4e61 6d65 203d 2073 7472 2866 696c  leName = str(fil
-0007ddd0: 654e 616d 6529 0d0a 2020 2020 2020 2020  eName)..        
-0007dde0: 6966 2066 696c 654e 616d 6520 3d3d 2027  if fileName == '
-0007ddf0: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-0007de00: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
-0007de10: 2020 7061 7468 2c20 6578 7420 3d20 6f73    path, ext = os
-0007de20: 2e70 6174 682e 7370 6c69 7465 7874 2866  .path.splitext(f
-0007de30: 696c 654e 616d 6529 0d0a 2020 2020 2020  ileName)..      
-0007de40: 2020 6578 7420 3d20 6578 745b 313a 5d2e    ext = ext[1:].
-0007de50: 6c6f 7765 7228 290d 0a0d 0a0d 0a0d 0a20  lower()........ 
-0007de60: 2020 2020 2020 2069 6620 6578 7420 213d         if ext !=
-0007de70: 2027 706e 6727 2061 6e64 2065 7874 2021   'png' and ext !
-0007de80: 3d20 2770 6466 2720 616e 6420 6578 7420  = 'pdf' and ext 
-0007de90: 213d 2027 7469 6627 3a0d 0a20 2020 2020  != 'tif':..     
-0007dea0: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
-0007deb0: 7361 6765 203d 2028 0d0a 2020 2020 2020  sage = (..      
-0007dec0: 2020 2020 2020 2020 2020 2020 274f 6e6c              'Onl
-0007ded0: 7920 7468 6520 504e 4720 616e 6420 5044  y the PNG and PD
-0007dee0: 4620 696d 6167 6520 666f 726d 6174 7320  F image formats 
-0007def0: 6172 6520 7375 7070 6f72 7465 642e 5c6e  are supported.\n
-0007df00: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
-0007df10: 2020 2020 2741 2066 696c 6520 6578 7465      'A file exte
-0007df20: 6e73 696f 6e20 6f66 2060 706e 675c 2720  nsion of `png\' 
-0007df30: 6f72 2060 7064 665c 2720 6d75 7374 2062  or `pdf\' must b
-0007df40: 6520 7573 6564 2e27 290d 0a20 2020 2020  e used.')..     
-0007df50: 2020 2020 2020 2051 7457 6964 6765 7473         QtWidgets
-0007df60: 2e51 4d65 7373 6167 6542 6f78 2e77 6172  .QMessageBox.war
-0007df70: 6e69 6e67 2873 656c 662c 2027 4572 726f  ning(self, 'Erro
-0007df80: 7227 2c20 2745 7272 6f72 202d 2043 6f75  r', 'Error - Cou
-0007df90: 6c64 206e 6f74 2073 6176 6520 6669 6c65  ld not save file
-0007dfa0: 2e27 290d 0a20 2020 2020 2020 2020 2020  .')..           
-0007dfb0: 2072 6574 7572 6e0d 0a0d 0a0d 0a20 2020   return......   
-0007dfc0: 2020 2020 2069 6620 6578 7420 3d3d 2027       if ext == '
-0007dfd0: 7469 6627 3a0d 0a20 2020 2020 2020 2020  tif':..         
-0007dfe0: 2020 2066 726f 6d20 5049 4c20 696d 706f     from PIL impo
-0007dff0: 7274 2049 6d61 6765 0d0a 2020 2020 2020  rt Image..      
-0007e000: 2020 2020 2020 696d 6731 203d 2049 6d61        img1 = Ima
-0007e010: 6765 2e66 726f 6d61 7272 6179 2873 656c  ge.fromarray(sel
-0007e020: 662e 6f64 7468 6963 6b6d 6170 290d 0a20  f.odthickmap).. 
-0007e030: 2020 2020 2020 2020 2020 2069 6d67 312e             img1.
-0007e040: 7361 7665 2866 696c 654e 616d 6529 0d0a  save(fileName)..
-0007e050: 2020 2020 2020 2020 656c 7365 3a0d 0a0d          else:...
-0007e060: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-0007e070: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0007e080: 2020 206d 6174 706c 6f74 6c69 622e 7263     matplotlib.rc
-0007e090: 5061 7261 6d73 5b27 7064 662e 666f 6e74  Params['pdf.font
-0007e0a0: 7479 7065 275d 203d 2034 320d 0a0d 0a20  type'] = 42.... 
-0007e0b0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0007e0c0: 6967 203d 2073 656c 662e 6f64 6d66 6967  ig = self.odmfig
-0007e0d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0007e0e0: 2020 6669 672e 7361 7665 6669 6728 6669    fig.savefig(fi
-0007e0f0: 6c65 4e61 6d65 290d 0a0d 0a0d 0a20 2020  leName)......   
-0007e100: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-0007e110: 494f 4572 726f 7220 6173 2065 3a0d 0a20  IOError as e:.. 
-0007e120: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0007e130: 6620 652e 7374 7265 7272 6f72 3a0d 0a20  f e.strerror:.. 
-0007e140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e150: 2020 2065 7272 203d 2065 2e73 7472 6572     err = e.strer
-0007e160: 726f 720d 0a20 2020 2020 2020 2020 2020  ror..           
-0007e170: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0007e180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e190: 6572 7220 3d20 650d 0a0d 0a20 2020 2020  err = e....     
-0007e1a0: 2020 2020 2020 2020 2020 2051 7447 7569             QtGui
-0007e1b0: 2e51 4d65 7373 6167 6542 6f78 2e77 6172  .QMessageBox.war
-0007e1c0: 6e69 6e67 2873 656c 662c 2027 4572 726f  ning(self, 'Erro
-0007e1d0: 7227 2c20 2743 6f75 6c64 206e 6f74 2073  r', 'Could not s
-0007e1e0: 6176 6520 6669 6c65 3a20 2573 2720 2520  ave file: %s' % 
-0007e1f0: 6572 7229 0d0a 0d0a 0d0a 0d0a 0d0a 232d  err)..........#-
-0007e200: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007e210: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007e220: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007e230: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007e240: 2d2d 2d2d 2d0d 0a63 6c61 7373 2044 6f73  -----..class Dos
-0007e250: 6543 616c 6375 6c61 7469 6f6e 2851 7457  eCalculation(QtW
-0007e260: 6964 6765 7473 2e51 4469 616c 6f67 293a  idgets.QDialog):
-0007e270: 0d0a 0d0a 2020 2020 6465 6620 5f5f 696e  ....    def __in
-0007e280: 6974 5f5f 2873 656c 662c 2070 6172 656e  it__(self, paren
-0007e290: 742c 2020 7374 6163 6b2c 2052 4f49 7370  t,  stack, ROIsp
-0007e2a0: 6563 7472 756d 293a 0d0a 2020 2020 2020  ectrum):..      
-0007e2b0: 2020 5174 5769 6467 6574 732e 5157 6964    QtWidgets.QWid
-0007e2c0: 6765 742e 5f5f 696e 6974 5f5f 2873 656c  get.__init__(sel
-0007e2d0: 662c 2070 6172 656e 7429 0d0a 0d0a 2020  f, parent)....  
-0007e2e0: 2020 2020 2020 7365 6c66 2e70 6172 656e        self.paren
-0007e2f0: 7420 3d20 7061 7265 6e74 0d0a 0d0a 2020  t = parent....  
-0007e300: 2020 2020 2020 7365 6c66 2e72 6573 697a        self.resiz
-0007e310: 6528 3330 302c 2031 3730 290d 0a20 2020  e(300, 170)..   
-0007e320: 2020 2020 2073 656c 662e 7365 7457 696e       self.setWin
-0007e330: 646f 7754 6974 6c65 2827 446f 7365 2043  dowTitle('Dose C
-0007e340: 616c 6375 6c61 7469 6f6e 2729 0d0a 0d0a  alculation')....
-0007e350: 2020 2020 2020 2020 7061 6c20 3d20 5174          pal = Qt
-0007e360: 4775 692e 5150 616c 6574 7465 2829 0d0a  Gui.QPalette()..
-0007e370: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-0007e380: 4175 746f 4669 6c6c 4261 636b 6772 6f75  AutoFillBackgrou
-0007e390: 6e64 2854 7275 6529 0d0a 2020 2020 2020  nd(True)..      
-0007e3a0: 2020 7061 6c2e 7365 7443 6f6c 6f72 2851    pal.setColor(Q
-0007e3b0: 7447 7569 2e51 5061 6c65 7474 652e 5769  tGui.QPalette.Wi
-0007e3c0: 6e64 6f77 2c51 7447 7569 2e51 436f 6c6f  ndow,QtGui.QColo
-0007e3d0: 7228 2777 6869 7465 2729 290d 0a20 2020  r('white'))..   
-0007e3e0: 2020 2020 2073 656c 662e 7365 7450 616c       self.setPal
-0007e3f0: 6574 7465 2870 616c 290d 0a0d 0a20 2020  ette(pal)....   
-0007e400: 2020 2020 2073 656c 662e 7374 6163 6b20       self.stack 
-0007e410: 3d20 7374 6163 6b0d 0a20 2020 2020 2020  = stack..       
-0007e420: 2073 656c 662e 524f 4973 7065 6374 7275   self.ROIspectru
-0007e430: 6d20 3d20 524f 4973 7065 6374 7275 6d0d  m = ROIspectrum.
-0007e440: 0a0d 0a0d 0a0d 0a20 2020 2020 2020 2076  .......        v
-0007e450: 626f 7874 6f70 203d 2051 7457 6964 6765  boxtop = QtWidge
-0007e460: 7473 2e51 5642 6f78 4c61 796f 7574 2829  ts.QVBoxLayout()
-0007e470: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6772  ......        gr
-0007e480: 6964 746f 7020 3d20 5174 5769 6467 6574  idtop = QtWidget
-0007e490: 732e 5147 7269 644c 6179 6f75 7428 290d  s.QGridLayout().
-0007e4a0: 0a0d 0a0d 0a20 2020 2020 2020 2023 666f  .....        #fo
-0007e4b0: 6e74 6220 3d20 7778 2e53 7973 7465 6d53  ntb = wx.SystemS
-0007e4c0: 6574 7469 6e67 735f 4765 7446 6f6e 7428  ettings_GetFont(
-0007e4d0: 7778 2e53 5953 5f44 4546 4155 4c54 5f47  wx.SYS_DEFAULT_G
-0007e4e0: 5549 5f46 4f4e 5429 0d0a 2020 2020 2020  UI_FONT)..      
-0007e4f0: 2020 2366 6f6e 7462 2e53 6574 5765 6967    #fontb.SetWeig
-0007e500: 6874 2877 782e 424f 4c44 290d 0a0d 0a0d  ht(wx.BOLD).....
-0007e510: 0a20 2020 2020 2020 2073 7431 203d 2051  .        st1 = Q
-0007e520: 7457 6964 6765 7473 2e51 4c61 6265 6c28  tWidgets.QLabel(
-0007e530: 7365 6c66 290d 0a20 2020 2020 2020 2073  self)..        s
-0007e540: 7431 2e73 6574 5465 7874 2827 4465 7465  t1.setText('Dete
-0007e550: 6374 6f72 2065 6666 6963 6965 6e63 7920  ctor efficiency 
-0007e560: 5b25 5d3a 2729 0d0a 2020 2020 2020 2020  [%]:')..        
-0007e570: 2373 7431 2e53 6574 466f 6e74 2866 6f6e  #st1.SetFont(fon
-0007e580: 7462 290d 0a20 2020 2020 2020 2073 7432  tb)..        st2
-0007e590: 203d 2051 7457 6964 6765 7473 2e51 4c61   = QtWidgets.QLa
-0007e5a0: 6265 6c28 7365 6c66 290d 0a20 2020 2020  bel(self)..     
-0007e5b0: 2020 2073 7432 2e73 6574 5465 7874 2827     st2.setText('
-0007e5c0: 4920 7265 6769 6f6e 2063 6f6d 706f 7369  I region composi
-0007e5d0: 7469 6f6e 3a27 290d 0a20 2020 2020 2020  tion:')..       
-0007e5e0: 2023 7374 322e 5365 7446 6f6e 7428 666f   #st2.SetFont(fo
-0007e5f0: 6e74 6229 0d0a 2320 2020 2020 2020 2073  ntb)..#        s
-0007e600: 7433 203d 2051 7457 6964 6765 7473 2e51  t3 = QtWidgets.Q
-0007e610: 4c61 6265 6c28 7365 6c66 2c27 5872 6179  Label(self,'Xray
-0007e620: 2061 6273 6f72 7074 696f 6e20 6c65 6e67   absorption leng
-0007e630: 7468 3a27 290d 0a23 2020 2020 2020 2020  th:')..#        
-0007e640: 7374 332e 5365 7446 6f6e 7428 666f 6e74  st3.SetFont(font
-0007e650: 6229 0d0a 2020 2020 2020 2020 7374 3420  b)..        st4 
-0007e660: 3d20 5174 5769 6467 6574 732e 514c 6162  = QtWidgets.QLab
-0007e670: 656c 2873 656c 6629 0d0a 2020 2020 2020  el(self)..      
-0007e680: 2020 7374 342e 7365 7454 6578 7428 2744    st4.setText('D
-0007e690: 6f73 6520 5b47 7261 795d 3a27 290d 0a20  ose [Gray]:').. 
-0007e6a0: 2020 2020 2020 2023 7374 342e 5365 7446         #st4.SetF
-0007e6b0: 6f6e 7428 666f 6e74 6229 0d0a 0d0a 0d0a  ont(fontb)......
-0007e6c0: 2020 2020 2020 2020 7365 6c66 2e74 635f          self.tc_
-0007e6d0: 3120 3d20 5174 5769 6467 6574 732e 514c  1 = QtWidgets.QL
-0007e6e0: 696e 6545 6469 7428 7365 6c66 290d 0a20  ineEdit(self).. 
-0007e6f0: 2020 2020 2020 2073 656c 662e 7463 5f31         self.tc_1
-0007e700: 2e73 6574 5465 7874 2827 3330 2729 0d0a  .setText('30')..
+0007b810: 6530 2e73 6c69 6465 725f 7468 6574 612e  e0.slider_theta.
+0007b820: 7365 7452 616e 6765 2830 2c20 7365 6c66  setRange(0, self
+0007b830: 2e73 7461 636b 2e6e 5f74 6865 7461 202d  .stack.n_theta -
+0007b840: 2031 290d 0a20 2020 2023 2020 2020 2020   1)..    #      
+0007b850: 2020 2073 656c 662e 7061 7265 6e74 2e70     self.parent.p
+0007b860: 6167 6530 2e69 7468 6574 6120 3d20 300d  age0.itheta = 0.
+0007b870: 0a20 2020 2023 2020 2020 2020 2020 2073  .    #         s
+0007b880: 656c 662e 7061 7265 6e74 2e70 6167 6530  elf.parent.page0
+0007b890: 2e73 6c69 6465 725f 7468 6574 612e 626c  .slider_theta.bl
+0007b8a0: 6f63 6b53 6967 6e61 6c73 2854 7275 6529  ockSignals(True)
+0007b8b0: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
+0007b8c0: 7365 6c66 2e70 6172 656e 742e 7061 6765  self.parent.page
+0007b8d0: 302e 736c 6964 6572 5f74 6865 7461 2e73  0.slider_theta.s
+0007b8e0: 6574 5661 6c75 6528 696e 7428 7365 6c66  etValue(int(self
+0007b8f0: 2e70 6172 656e 742e 7061 6765 312e 6974  .parent.page1.it
+0007b900: 6865 7461 2929 0d0a 2020 2020 2320 2020  heta))..    #   
+0007b910: 2020 2020 2020 7365 6c66 2e70 6172 656e        self.paren
+0007b920: 742e 7061 6765 302e 736c 6964 6572 5f74  t.page0.slider_t
+0007b930: 6865 7461 2e62 6c6f 636b 5369 676e 616c  heta.blockSignal
+0007b940: 7328 4661 6c73 6529 0d0a 2020 2020 230d  s(False)..    #.
+0007b950: 0a20 2020 2023 2020 2020 2073 656c 662e  .    #     self.
+0007b960: 7061 7265 6e74 2e70 6167 6531 2e73 6c69  parent.page1.sli
+0007b970: 6465 725f 656e 672e 7365 7452 616e 6765  der_eng.setRange
+0007b980: 2830 2c20 7365 6c66 2e73 7461 636b 2e6e  (0, self.stack.n
+0007b990: 5f65 7620 2d20 3129 0d0a 2020 2020 2320  _ev - 1)..    # 
+0007b9a0: 2020 2020 7365 6c66 2e70 6172 656e 742e      self.parent.
+0007b9b0: 7061 6765 312e 6965 7620 3d20 300d 0a20  page1.iev = 0.. 
+0007b9c0: 2020 2023 2020 2020 2073 656c 662e 7061     #     self.pa
+0007b9d0: 7265 6e74 2e70 6167 6531 2e73 6c69 6465  rent.page1.slide
+0007b9e0: 725f 656e 672e 7365 7456 616c 7565 2869  r_eng.setValue(i
+0007b9f0: 6e74 2873 656c 662e 7061 7265 6e74 2e70  nt(self.parent.p
+0007ba00: 6167 6531 2e69 6576 2929 0d0a 2020 2020  age1.iev))..    
+0007ba10: 230d 0a20 2020 2023 2020 2020 2073 656c  #..    #     sel
+0007ba20: 662e 7061 7265 6e74 2e70 6167 6530 2e73  f.parent.page0.s
+0007ba30: 6c69 6465 725f 656e 672e 7365 7452 616e  lider_eng.setRan
+0007ba40: 6765 2830 2c20 7365 6c66 2e73 7461 636b  ge(0, self.stack
+0007ba50: 2e6e 5f65 7620 2d20 3129 0d0a 2020 2020  .n_ev - 1)..    
+0007ba60: 2320 2020 2020 7365 6c66 2e70 6172 656e  #     self.paren
+0007ba70: 742e 7061 6765 302e 6965 7620 3d20 300d  t.page0.iev = 0.
+0007ba80: 0a20 2020 2023 2020 2020 2073 656c 662e  .    #     self.
+0007ba90: 7061 7265 6e74 2e70 6167 6530 2e73 6c69  parent.page0.sli
+0007baa0: 6465 725f 656e 672e 7365 7456 616c 7565  der_eng.setValue
+0007bab0: 2869 6e74 2873 656c 662e 7061 7265 6e74  (int(self.parent
+0007bac0: 2e70 6167 6531 2e69 6576 2929 0d0a 2020  .page1.iev))..  
+0007bad0: 2020 230d 0a20 2020 2023 2020 2020 2073    #..    #     s
+0007bae0: 656c 662e 7061 7265 6e74 2e70 6167 6531  elf.parent.page1
+0007baf0: 2e73 686f 7753 7065 6374 7275 6d28 7365  .showSpectrum(se
+0007bb00: 6c66 2e70 6172 656e 742e 7061 6765 312e  lf.parent.page1.
+0007bb10: 6978 2c20 7365 6c66 2e70 6172 656e 742e  ix, self.parent.
+0007bb20: 7061 6765 312e 6979 290d 0a20 2020 2023  page1.iy)..    #
+0007bb30: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
+0007bb40: 2e70 6167 6531 2e6c 6f61 6449 6d61 6765  .page1.loadImage
+0007bb50: 2829 0d0a 2020 2020 2320 2020 2020 7365  ()..    #     se
+0007bb60: 6c66 2e70 6172 656e 742e 7061 6765 302e  lf.parent.page0.
+0007bb70: 436c 6561 7228 290d 0a20 2020 2023 2020  Clear()..    #  
+0007bb80: 2020 2073 656c 662e 7061 7265 6e74 2e70     self.parent.p
+0007bb90: 6167 6530 2e4c 6f61 6445 6e74 7269 6573  age0.LoadEntries
+0007bba0: 2829 0d0a 2020 2020 230d 0a20 2020 2023  ()..    #..    #
+0007bbb0: 2020 2020 2069 6620 7368 6f77 6d61 7074       if showmapt
+0007bbc0: 6162 3a0d 0a20 2020 2023 2020 2020 2020  ab:..    #      
+0007bbd0: 2020 2073 656c 662e 7061 7265 6e74 2e70     self.parent.p
+0007bbe0: 6167 6539 2e43 6c65 6172 2829 0d0a 2020  age9.Clear()..  
+0007bbf0: 2020 2320 2020 2020 2020 2020 7365 6c66    #         self
+0007bc00: 2e70 6172 656e 742e 7061 6765 392e 4c6f  .parent.page9.Lo
+0007bc10: 6164 456e 7472 6965 7328 290d 0a20 2020  adEntries()..   
+0007bc20: 2023 0d0a 2020 2020 2320 2020 2020 7365   #..    #     se
+0007bc30: 6c66 2e63 6c6f 7365 2829 0d0a 0d0a 636c  lf.close()....cl
+0007bc40: 6173 7320 5370 6563 7472 616c 524f 4928  ass SpectralROI(
+0007bc50: 5174 5769 6467 6574 732e 5144 6961 6c6f  QtWidgets.QDialo
+0007bc60: 6729 3a0d 0a0d 0a20 2020 2064 6566 205f  g):....    def _
+0007bc70: 5f69 6e69 745f 5f28 7365 6c66 2c20 7061  _init__(self, pa
+0007bc80: 7265 6e74 2c20 2063 6f6d 6d6f 6e2c 2073  rent,  common, s
+0007bc90: 7461 636b 293a 0d0a 2020 2020 2020 2020  tack):..        
+0007bca0: 5174 5769 6467 6574 732e 5157 6964 6765  QtWidgets.QWidge
+0007bcb0: 742e 5f5f 696e 6974 5f5f 2873 656c 662c  t.__init__(self,
+0007bcc0: 2070 6172 656e 7429 0d0a 0d0a 2020 2020   parent)....    
+0007bcd0: 2020 2020 7365 6c66 2e70 6172 656e 7420      self.parent 
+0007bce0: 3d20 7061 7265 6e74 0d0a 0d0a 2020 2020  = parent....    
+0007bcf0: 2020 2020 7365 6c66 2e73 7461 636b 203d      self.stack =
+0007bd00: 2073 7461 636b 0d0a 2020 2020 2020 2020   stack..        
+0007bd10: 7365 6c66 2e63 6f6d 203d 2063 6f6d 6d6f  self.com = commo
+0007bd20: 6e0d 0a0d 0a20 2020 2020 2020 2073 656c  n....        sel
+0007bd30: 662e 7265 7369 7a65 2836 3330 2c20 3730  f.resize(630, 70
+0007bd40: 3029 0d0a 2020 2020 2020 2020 7365 6c66  0)..        self
+0007bd50: 2e73 6574 5769 6e64 6f77 5469 746c 6528  .setWindowTitle(
+0007bd60: 2753 7065 6374 7261 6c20 5265 6769 6f6e  'Spectral Region
+0007bd70: 7320 6f66 2049 6e74 6572 6573 7427 290d  s of Interest').
+0007bd80: 0a0d 0a20 2020 2020 2020 2070 616c 203d  ...        pal =
+0007bd90: 2051 7447 7569 2e51 5061 6c65 7474 6528   QtGui.QPalette(
+0007bda0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0007bdb0: 7365 7441 7574 6f46 696c 6c42 6163 6b67  setAutoFillBackg
+0007bdc0: 726f 756e 6428 5472 7565 290d 0a20 2020  round(True)..   
+0007bdd0: 2020 2020 2070 616c 2e73 6574 436f 6c6f       pal.setColo
+0007bde0: 7228 5174 4775 692e 5150 616c 6574 7465  r(QtGui.QPalette
+0007bdf0: 2e57 696e 646f 772c 5174 4775 692e 5143  .Window,QtGui.QC
+0007be00: 6f6c 6f72 2827 7768 6974 6527 2929 0d0a  olor('white'))..
+0007be10: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
+0007be20: 5061 6c65 7474 6528 7061 6c29 0d0a 0d0a  Palette(pal)....
+0007be30: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
+0007be40: 636b 203d 2073 7461 636b 0d0a 2020 2020  ck = stack..    
+0007be50: 2020 2020 7365 6c66 2e63 6f6d 203d 2063      self.com = c
+0007be60: 6f6d 6d6f 6e0d 0a0d 0a0d 0a20 2020 2020  ommon......     
+0007be70: 2020 2073 656c 662e 696d 696e 203d 2030     self.imin = 0
+0007be80: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
+0007be90: 6d61 7820 3d20 300d 0a20 2020 2020 2020  max = 0..       
+0007bea0: 2073 656c 662e 6930 6d69 6e20 3d20 300d   self.i0min = 0.
+0007beb0: 0a20 2020 2020 2020 2073 656c 662e 6930  .        self.i0
+0007bec0: 6d61 7820 3d20 300d 0a20 2020 2020 2020  max = 0..       
+0007bed0: 2073 656c 662e 6973 656c 6563 7465 6420   self.iselected 
+0007bee0: 3d20 300d 0a20 2020 2020 2020 2073 656c  = 0..        sel
+0007bef0: 662e 6930 7365 6c65 6374 6564 203d 2030  f.i0selected = 0
+0007bf00: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7365  ......        se
+0007bf10: 6c66 2e6f 6474 6f74 616c 203d 2073 656c  lf.odtotal = sel
+0007bf20: 662e 7374 6163 6b2e 6f64 3364 2e73 756d  f.stack.od3d.sum
+0007bf30: 2861 7869 733d 3029 0d0a 2020 2020 2020  (axis=0)..      
+0007bf40: 2020 7365 6c66 2e6f 6474 6f74 616c 203d    self.odtotal =
+0007bf50: 2073 656c 662e 6f64 746f 7461 6c2e 7375   self.odtotal.su
+0007bf60: 6d28 6178 6973 3d30 292f 2873 656c 662e  m(axis=0)/(self.
+0007bf70: 7374 6163 6b2e 6e5f 726f 7773 2a73 656c  stack.n_rows*sel
+0007bf80: 662e 7374 6163 6b2e 6e5f 636f 6c73 290d  f.stack.n_cols).
+0007bf90: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+0007bfa0: 696d 6167 655f 6930 203d 206e 702e 7a65  image_i0 = np.ze
+0007bfb0: 726f 7328 2873 656c 662e 7374 6163 6b2e  ros((self.stack.
+0007bfc0: 6e5f 636f 6c73 2c20 7365 6c66 2e73 7461  n_cols, self.sta
+0007bfd0: 636b 2e6e 5f72 6f77 7329 290d 0a20 2020  ck.n_rows))..   
+0007bfe0: 2020 2020 2073 656c 662e 696d 6167 655f       self.image_
+0007bff0: 6920 3d20 6e70 2e7a 6572 6f73 2828 7365  i = np.zeros((se
+0007c000: 6c66 2e73 7461 636b 2e6e 5f63 6f6c 732c  lf.stack.n_cols,
+0007c010: 2073 656c 662e 7374 6163 6b2e 6e5f 726f   self.stack.n_ro
+0007c020: 7773 2929 0d0a 2020 2020 2020 2020 7365  ws))..        se
+0007c030: 6c66 2e6f 6474 6869 636b 6d61 7020 3d20  lf.odthickmap = 
+0007c040: 6e70 2e7a 6572 6f73 2828 7365 6c66 2e73  np.zeros((self.s
+0007c050: 7461 636b 2e6e 5f63 6f6c 732c 2073 656c  tack.n_cols, sel
+0007c060: 662e 7374 6163 6b2e 6e5f 726f 7773 2929  f.stack.n_rows))
+0007c070: 0d0a 0d0a 0d0a 0d0a 2020 2020 2020 2020  ........        
+0007c080: 7662 6f78 203d 2051 7457 6964 6765 7473  vbox = QtWidgets
+0007c090: 2e51 5642 6f78 4c61 796f 7574 2829 0d0a  .QVBoxLayout()..
+0007c0a0: 2020 2020 2020 2020 7465 7874 203d 2051          text = Q
+0007c0b0: 7457 6964 6765 7473 2e51 4c61 6265 6c28  tWidgets.QLabel(
+0007c0c0: 7365 6c66 290d 0a20 2020 2020 2020 2074  self)..        t
+0007c0d0: 6578 742e 7365 7454 6578 7428 2746 6972  ext.setText('Fir
+0007c0e0: 7374 2073 656c 6563 7420 4930 2072 6567  st select I0 reg
+0007c0f0: 696f 6e20 6265 6c6f 7720 7468 6520 6564  ion below the ed
+0007c100: 6765 2c20 7468 656e 2073 656c 6563 7420  ge, then select 
+0007c110: 4920 7265 6769 6f6e 2061 626f 7665 2074  I region above t
+0007c120: 6865 2065 6467 653a 2729 0d0a 2020 2020  he edge:')..    
+0007c130: 2020 2020 7662 6f78 2e61 6464 5769 6467      vbox.addWidg
+0007c140: 6574 2874 6578 7429 0d0a 0d0a 2020 2020  et(text)....    
+0007c150: 2020 2020 6672 616d 6520 3d20 5174 5769      frame = QtWi
+0007c160: 6467 6574 732e 5146 7261 6d65 2829 0d0a  dgets.QFrame()..
+0007c170: 2020 2020 2020 2020 6672 616d 652e 7365          frame.se
+0007c180: 7446 7261 6d65 5374 796c 6528 5174 5769  tFrameStyle(QtWi
+0007c190: 6467 6574 732e 5146 7261 6d65 2e53 7479  dgets.QFrame.Sty
+0007c1a0: 6c65 6450 616e 656c 7c51 7457 6964 6765  ledPanel|QtWidge
+0007c1b0: 7473 2e51 4672 616d 652e 5375 6e6b 656e  ts.QFrame.Sunken
+0007c1c0: 290d 0a20 2020 2020 2020 2066 626f 7820  )..        fbox 
+0007c1d0: 3d20 5174 5769 6467 6574 732e 5148 426f  = QtWidgets.QHBo
+0007c1e0: 784c 6179 6f75 7428 290d 0a0d 0a20 2020  xLayout()....   
+0007c1f0: 2020 2020 2073 656c 662e 7370 6563 6669       self.specfi
+0007c200: 6720 3d20 4669 6775 7265 2828 362e 302c  g = Figure((6.0,
+0007c210: 2034 2e32 2929 0d0a 2020 2020 2020 2020   4.2))..        
+0007c220: 7365 6c66 2e53 7065 6374 7275 6d50 616e  self.SpectrumPan
+0007c230: 656c 203d 2046 6967 7572 6543 616e 7661  el = FigureCanva
+0007c240: 7328 7365 6c66 2e73 7065 6366 6967 290d  s(self.specfig).
+0007c250: 0a20 2020 2020 2020 2073 656c 662e 5370  .        self.Sp
+0007c260: 6563 7472 756d 5061 6e65 6c2e 7365 7450  ectrumPanel.setP
+0007c270: 6172 656e 7428 7365 6c66 290d 0a20 2020  arent(self)..   
+0007c280: 2020 2020 2073 656c 662e 5370 6563 7472       self.Spectr
+0007c290: 756d 5061 6e65 6c2e 6d70 6c5f 636f 6e6e  umPanel.mpl_conn
+0007c2a0: 6563 7428 2762 7574 746f 6e5f 7072 6573  ect('button_pres
+0007c2b0: 735f 6576 656e 7427 2c20 7365 6c66 2e4f  s_event', self.O
+0007c2c0: 6e53 656c 6563 7469 6f6e 3129 0d0a 2020  nSelection1)..  
+0007c2d0: 2020 2020 2020 7365 6c66 2e53 7065 6374        self.Spect
+0007c2e0: 7275 6d50 616e 656c 2e6d 706c 5f63 6f6e  rumPanel.mpl_con
+0007c2f0: 6e65 6374 2827 6275 7474 6f6e 5f72 656c  nect('button_rel
+0007c300: 6561 7365 5f65 7665 6e74 272c 2073 656c  ease_event', sel
+0007c310: 662e 4f6e 5365 6c65 6374 696f 6e32 290d  f.OnSelection2).
+0007c320: 0a0d 0a20 2020 2020 2020 2066 626f 782e  ...        fbox.
+0007c330: 6164 6457 6964 6765 7428 7365 6c66 2e53  addWidget(self.S
+0007c340: 7065 6374 7275 6d50 616e 656c 290d 0a20  pectrumPanel).. 
+0007c350: 2020 2020 2020 2066 7261 6d65 2e73 6574         frame.set
+0007c360: 4c61 796f 7574 2866 626f 7829 0d0a 2020  Layout(fbox)..  
+0007c370: 2020 2020 2020 7662 6f78 2e61 6464 5769        vbox.addWi
+0007c380: 6467 6574 2866 7261 6d65 290d 0a0d 0a0d  dget(frame).....
+0007c390: 0a20 2020 2020 2020 2068 626f 7832 203d  .        hbox2 =
+0007c3a0: 2051 7457 6964 6765 7473 2e51 4842 6f78   QtWidgets.QHBox
+0007c3b0: 4c61 796f 7574 2829 0d0a 0d0a 0d0a 2020  Layout()......  
+0007c3c0: 2020 2020 2020 7369 7a65 7232 203d 5174        sizer2 =Qt
+0007c3d0: 5769 6467 6574 732e 5147 726f 7570 426f  Widgets.QGroupBo
+0007c3e0: 7828 2753 656c 6563 7465 6420 5370 6563  x('Selected Spec
+0007c3f0: 7472 616c 2052 6567 696f 6e73 2729 0d0a  tral Regions')..
+0007c400: 2020 2020 2020 2020 7369 7a65 7232 2e73          sizer2.s
+0007c410: 6574 4d69 6e69 6d75 6d57 6964 7468 2833  etMinimumWidth(3
+0007c420: 3530 290d 0a20 2020 2020 2020 2076 626f  50)..        vbo
+0007c430: 7832 203d 2051 7457 6964 6765 7473 2e51  x2 = QtWidgets.Q
+0007c440: 5642 6f78 4c61 796f 7574 2829 0d0a 2020  VBoxLayout()..  
+0007c450: 2020 2020 2020 7465 7874 203d 2051 7457        text = QtW
+0007c460: 6964 6765 7473 2e51 4c61 6265 6c28 7365  idgets.QLabel(se
+0007c470: 6c66 290d 0a20 2020 2020 2020 2074 6578  lf)..        tex
+0007c480: 742e 7365 7454 6578 7428 2749 2053 656c  t.setText('I Sel
+0007c490: 6563 7469 6f6e 2028 7265 6429 3a20 2729  ection (red): ')
+0007c4a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
+0007c4b0: 6578 7463 7472 6c31 203d 2051 7457 6964  extctrl1 = QtWid
+0007c4c0: 6765 7473 2e51 4c61 6265 6c28 7365 6c66  gets.QLabel(self
+0007c4d0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0007c4e0: 7465 7874 6374 726c 312e 7365 7454 6578  textctrl1.setTex
+0007c4f0: 7428 275b 2020 5d27 2029 0d0a 2020 2020  t('[  ]' )..    
+0007c500: 2020 2020 7662 6f78 322e 6164 6457 6964      vbox2.addWid
+0007c510: 6765 7428 7465 7874 290d 0a20 2020 2020  get(text)..     
+0007c520: 2020 2076 626f 7832 2e61 6464 5769 6467     vbox2.addWidg
+0007c530: 6574 2873 656c 662e 7465 7874 6374 726c  et(self.textctrl
+0007c540: 3129 0d0a 0d0a 2020 2020 2020 2020 7465  1)....        te
+0007c550: 7874 203d 2051 7457 6964 6765 7473 2e51  xt = QtWidgets.Q
+0007c560: 4c61 6265 6c28 7365 6c66 290d 0a20 2020  Label(self)..   
+0007c570: 2020 2020 2074 6578 742e 7365 7454 6578       text.setTex
+0007c580: 7428 2749 3020 5365 6c65 6374 696f 6e20  t('I0 Selection 
+0007c590: 2867 7265 656e 293a 2027 290d 0a20 2020  (green): ')..   
+0007c5a0: 2020 2020 2073 656c 662e 7465 7874 6374       self.textct
+0007c5b0: 726c 3220 3d20 5174 5769 6467 6574 732e  rl2 = QtWidgets.
+0007c5c0: 514c 6162 656c 2873 656c 6629 0d0a 2020  QLabel(self)..  
+0007c5d0: 2020 2020 2020 7365 6c66 2e74 6578 7463        self.textc
+0007c5e0: 7472 6c32 2e73 6574 5465 7874 2827 5b20  trl2.setText('[ 
+0007c5f0: 205d 2720 290d 0a20 2020 2020 2020 2076   ]' )..        v
+0007c600: 626f 7832 2e61 6464 5769 6467 6574 2874  box2.addWidget(t
+0007c610: 6578 7429 0d0a 2020 2020 2020 2020 7662  ext)..        vb
+0007c620: 6f78 322e 6164 6457 6964 6765 7428 7365  ox2.addWidget(se
+0007c630: 6c66 2e74 6578 7463 7472 6c32 290d 0a20  lf.textctrl2).. 
+0007c640: 2020 2020 2020 2073 697a 6572 322e 7365         sizer2.se
+0007c650: 744c 6179 6f75 7428 7662 6f78 3229 0d0a  tLayout(vbox2)..
+0007c660: 0d0a 2020 2020 2020 2020 7465 7874 203d  ..        text =
+0007c670: 2051 7457 6964 6765 7473 2e51 4c61 6265   QtWidgets.QLabe
+0007c680: 6c28 7365 6c66 290d 0a20 2020 2020 2020  l(self)..       
+0007c690: 2074 6578 742e 7365 7454 6578 7428 274f   text.setText('O
+0007c6a0: 7074 6963 616c 2064 656e 7369 7479 206d  ptical density m
+0007c6b0: 6170 2729 0d0a 2020 2020 2020 2020 7662  ap')..        vb
+0007c6c0: 6f78 2e61 6464 5769 6467 6574 2874 6578  ox.addWidget(tex
+0007c6d0: 7429 0d0a 0d0a 2020 2020 2020 2020 6672  t)....        fr
+0007c6e0: 616d 6520 3d20 5174 5769 6467 6574 732e  ame = QtWidgets.
+0007c6f0: 5146 7261 6d65 2829 0d0a 2020 2020 2020  QFrame()..      
+0007c700: 2020 6672 616d 652e 7365 7446 7261 6d65    frame.setFrame
+0007c710: 5374 796c 6528 5174 5769 6467 6574 732e  Style(QtWidgets.
+0007c720: 5146 7261 6d65 2e53 7479 6c65 6450 616e  QFrame.StyledPan
+0007c730: 656c 7c51 7457 6964 6765 7473 2e51 4672  el|QtWidgets.QFr
+0007c740: 616d 652e 5375 6e6b 656e 290d 0a20 2020  ame.Sunken)..   
+0007c750: 2020 2020 2066 626f 7820 3d20 5174 5769       fbox = QtWi
+0007c760: 6467 6574 732e 5148 426f 784c 6179 6f75  dgets.QHBoxLayou
+0007c770: 7428 290d 0a0d 0a20 2020 2020 2020 2073  t()....        s
+0007c780: 656c 662e 6f64 6d66 6967 203d 2046 6967  elf.odmfig = Fig
+0007c790: 7572 6528 2832 2e34 2c32 2e34 2929 0d0a  ure((2.4,2.4))..
+0007c7a0: 2020 2020 2020 2020 7365 6c66 2e4f 444d          self.ODM
+0007c7b0: 496d 6167 6550 616e 656c 203d 2046 6967  ImagePanel = Fig
+0007c7c0: 7572 6543 616e 7661 7328 7365 6c66 2e6f  ureCanvas(self.o
+0007c7d0: 646d 6669 6729 0d0a 2020 2020 2020 2020  dmfig)..        
+0007c7e0: 7365 6c66 2e4f 444d 496d 6167 6550 616e  self.ODMImagePan
+0007c7f0: 656c 2e73 6574 5061 7265 6e74 2873 656c  el.setParent(sel
+0007c800: 6629 0d0a 0d0a 2020 2020 2020 2020 6662  f)....        fb
+0007c810: 6f78 2e61 6464 5769 6467 6574 2873 656c  ox.addWidget(sel
+0007c820: 662e 4f44 4d49 6d61 6765 5061 6e65 6c2c  f.ODMImagePanel,
+0007c830: 2073 7472 6574 6368 3d30 290d 0a20 2020   stretch=0)..   
+0007c840: 2020 2020 2066 7261 6d65 2e73 6574 4c61       frame.setLa
+0007c850: 796f 7574 2866 626f 7829 0d0a 2020 2020  yout(fbox)..    
+0007c860: 2020 2020 6862 6f78 322e 6164 6457 6964      hbox2.addWid
+0007c870: 6765 7428 6672 616d 652c 2073 7472 6574  get(frame, stret
+0007c880: 6368 3d30 290d 0a20 2020 2020 2020 2068  ch=0)..        h
+0007c890: 626f 7832 2e61 6464 5374 7265 7463 6828  box2.addStretch(
+0007c8a0: 302e 3529 0d0a 2020 2020 2020 2020 6862  0.5)..        hb
+0007c8b0: 6f78 322e 6164 6457 6964 6765 7428 7369  ox2.addWidget(si
+0007c8c0: 7a65 7232 290d 0a0d 0a20 2020 2020 2020  zer2)....       
+0007c8d0: 2076 626f 782e 6164 644c 6179 6f75 7428   vbox.addLayout(
+0007c8e0: 6862 6f78 3229 0d0a 0d0a 2020 2020 2020  hbox2)....      
+0007c8f0: 2020 6862 6f78 203d 2051 7457 6964 6765    hbox = QtWidge
+0007c900: 7473 2e51 4842 6f78 4c61 796f 7574 2829  ts.QHBoxLayout()
+0007c910: 0d0a 0d0a 2020 2020 2020 2020 6275 7474  ....        butt
+0007c920: 6f6e 5f73 6176 6520 3d20 5174 5769 6467  on_save = QtWidg
+0007c930: 6574 732e 5150 7573 6842 7574 746f 6e28  ets.QPushButton(
+0007c940: 2753 6176 6527 290d 0a20 2020 2020 2020  'Save')..       
+0007c950: 2062 7574 746f 6e5f 7361 7665 2e63 6c69   button_save.cli
+0007c960: 636b 6564 2e63 6f6e 6e65 6374 2873 656c  cked.connect(sel
+0007c970: 662e 4f6e 5361 7665 290d 0a20 2020 2020  f.OnSave)..     
+0007c980: 2020 2068 626f 782e 6164 6457 6964 6765     hbox.addWidge
+0007c990: 7428 6275 7474 6f6e 5f73 6176 6529 0d0a  t(button_save)..
+0007c9a0: 0d0a 2020 2020 2020 2020 6275 7474 6f6e  ..        button
+0007c9b0: 5f63 616e 6365 6c20 3d20 5174 5769 6467  _cancel = QtWidg
+0007c9c0: 6574 732e 5150 7573 6842 7574 746f 6e28  ets.QPushButton(
+0007c9d0: 2744 6973 6d69 7373 2729 0d0a 2020 2020  'Dismiss')..    
+0007c9e0: 2020 2020 6275 7474 6f6e 5f63 616e 6365      button_cance
+0007c9f0: 6c2e 636c 6963 6b65 642e 636f 6e6e 6563  l.clicked.connec
+0007ca00: 7428 7365 6c66 2e63 6c6f 7365 290d 0a20  t(self.close).. 
+0007ca10: 2020 2020 2020 2068 626f 782e 6164 6457         hbox.addW
+0007ca20: 6964 6765 7428 6275 7474 6f6e 5f63 616e  idget(button_can
+0007ca30: 6365 6c29 0d0a 0d0a 2020 2020 2020 2020  cel)....        
+0007ca40: 7662 6f78 2e61 6464 4c61 796f 7574 2868  vbox.addLayout(h
+0007ca50: 626f 7829 0d0a 0d0a 0d0a 2020 2020 2020  box)......      
+0007ca60: 2020 7365 6c66 2e73 6574 4c61 796f 7574    self.setLayout
+0007ca70: 2876 626f 7829 0d0a 0d0a 2020 2020 2020  (vbox)....      
+0007ca80: 2020 7365 6c66 2e64 7261 775f 7370 6563    self.draw_spec
+0007ca90: 7472 756d 2829 0d0a 0d0a 0d0a 232d 2d2d  trum()......#---
+0007caa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007cab0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007cac0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007cad0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007cae0: 2d2d 2d0d 0a20 2020 2064 6566 2064 7261  ---..    def dra
+0007caf0: 775f 7370 6563 7472 756d 2873 656c 6629  w_spectrum(self)
+0007cb00: 3a0d 0a0d 0a0d 0a20 2020 2020 2020 2066  :......        f
+0007cb10: 6967 203d 2073 656c 662e 7370 6563 6669  ig = self.specfi
+0007cb20: 670d 0a20 2020 2020 2020 2066 6967 2e63  g..        fig.c
+0007cb30: 6c66 2829 0d0a 2020 2020 2020 2020 6669  lf()..        fi
+0007cb40: 672e 6164 645f 6178 6573 2828 302e 3135  g.add_axes((0.15
+0007cb50: 2c30 2e31 352c 302e 3735 2c30 2e37 3529  ,0.15,0.75,0.75)
+0007cb60: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0007cb70: 6178 6573 203d 2066 6967 2e67 6361 2829  axes = fig.gca()
+0007cb80: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7370  ......        sp
+0007cb90: 6563 706c 6f74 203d 2073 656c 662e 6178  ecplot = self.ax
+0007cba0: 6573 2e70 6c6f 7428 7365 6c66 2e73 7461  es.plot(self.sta
+0007cbb0: 636b 2e65 762c 7365 6c66 2e6f 6474 6f74  ck.ev,self.odtot
+0007cbc0: 616c 290d 0a0d 0a20 2020 2020 2020 2069  al)....        i
+0007cbd0: 6620 7365 6c66 2e69 3073 656c 6563 7465  f self.i0selecte
+0007cbe0: 6420 3d3d 2031 3a0d 0a20 2020 2020 2020  d == 1:..       
+0007cbf0: 2020 2020 2073 656c 662e 6178 6573 2e61       self.axes.a
+0007cc00: 7876 7370 616e 2873 656c 662e 7374 6163  xvspan(self.stac
+0007cc10: 6b2e 6576 5b73 656c 662e 6930 6d69 6e5d  k.ev[self.i0min]
+0007cc20: 2c20 7365 6c66 2e73 7461 636b 2e65 765b  , self.stack.ev[
+0007cc30: 7365 6c66 2e69 306d 6178 5d2c 2066 6163  self.i0max], fac
+0007cc40: 6563 6f6c 6f72 3d27 6727 2c20 616c 7068  ecolor='g', alph
+0007cc50: 613d 302e 3529 0d0a 0d0a 2020 2020 2020  a=0.5)....      
+0007cc60: 2020 6966 2073 656c 662e 6973 656c 6563    if self.iselec
+0007cc70: 7465 6420 3d3d 2031 3a0d 0a20 2020 2020  ted == 1:..     
+0007cc80: 2020 2020 2020 2073 656c 662e 6178 6573         self.axes
+0007cc90: 2e61 7876 7370 616e 2873 656c 662e 7374  .axvspan(self.st
+0007cca0: 6163 6b2e 6576 5b73 656c 662e 696d 696e  ack.ev[self.imin
+0007ccb0: 5d2c 2073 656c 662e 7374 6163 6b2e 6576  ], self.stack.ev
+0007ccc0: 5b73 656c 662e 696d 6178 5d2c 2066 6163  [self.imax], fac
+0007ccd0: 6563 6f6c 6f72 3d27 7227 2c20 616c 7068  ecolor='r', alph
+0007cce0: 613d 302e 3529 0d0a 0d0a 0d0a 2020 2020  a=0.5)......    
+0007ccf0: 2020 2020 7365 6c66 2e61 7865 732e 7365      self.axes.se
+0007cd00: 745f 786c 6162 656c 2827 5068 6f74 6f6e  t_xlabel('Photon
+0007cd10: 2045 6e65 7267 7920 5b65 565d 2729 0d0a   Energy [eV]')..
+0007cd20: 2020 2020 2020 2020 7365 6c66 2e61 7865          self.axe
+0007cd30: 732e 7365 745f 796c 6162 656c 2827 4f70  s.set_ylabel('Op
+0007cd40: 7469 6361 6c20 4465 6e73 6974 7927 290d  tical Density').
+0007cd50: 0a0d 0a0d 0a20 2020 2020 2020 2073 656c  .....        sel
+0007cd60: 662e 5370 6563 7472 756d 5061 6e65 6c2e  f.SpectrumPanel.
+0007cd70: 6472 6177 2829 0d0a 0d0a 0d0a 232d 2d2d  draw()......#---
+0007cd80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007cd90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007cda0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007cdb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007cdc0: 2d2d 2d0d 0a20 2020 2064 6566 2064 7261  ---..    def dra
+0007cdd0: 775f 696d 6167 6528 7365 6c66 293a 0d0a  w_image(self):..
+0007cde0: 0d0a 0d0a 2020 2020 2020 2020 6669 6720  ....        fig 
+0007cdf0: 3d20 7365 6c66 2e6f 646d 6669 670d 0a20  = self.odmfig.. 
+0007ce00: 2020 2020 2020 2066 6967 2e63 6c66 2829         fig.clf()
+0007ce10: 0d0a 2020 2020 2020 2020 6669 672e 6164  ..        fig.ad
+0007ce20: 645f 6178 6573 2828 302e 3032 2c30 2e30  d_axes((0.02,0.0
+0007ce30: 322c 302e 3936 2c30 2e39 3629 290d 0a0d  2,0.96,0.96))...
+0007ce40: 0a20 2020 2020 2020 2061 7865 7320 3d20  .        axes = 
+0007ce50: 6669 672e 6763 6128 290d 0a20 2020 2020  fig.gca()..     
+0007ce60: 2020 2064 6976 6964 6572 203d 206d 616b     divider = mak
+0007ce70: 655f 6178 6573 5f6c 6f63 6174 6162 6c65  e_axes_locatable
+0007ce80: 2861 7865 7329 0d0a 2020 2020 2020 2020  (axes)..        
+0007ce90: 6178 6362 203d 2064 6976 6964 6572 2e6e  axcb = divider.n
+0007cea0: 6577 5f68 6f72 697a 6f6e 7461 6c28 7369  ew_horizontal(si
+0007ceb0: 7a65 3d22 3325 222c 2070 6164 3d30 2e30  ze="3%", pad=0.0
+0007cec0: 3329 0d0a 0d0a 2020 2020 2020 2020 6669  3)....        fi
+0007ced0: 672e 6164 645f 6178 6573 2861 7863 6229  g.add_axes(axcb)
+0007cee0: 0d0a 0d0a 2020 2020 2020 2020 6178 6573  ....        axes
+0007cef0: 2e73 6574 5f70 6f73 6974 696f 6e28 5b30  .set_position([0
+0007cf00: 2e30 332c 302e 3033 2c30 2e38 2c30 2e39  .03,0.03,0.8,0.9
+0007cf10: 345d 290d 0a0d 0a0d 0a20 2020 2020 2020  4])......       
+0007cf20: 2069 6d20 3d20 6178 6573 2e69 6d73 686f   im = axes.imsho
+0007cf30: 7728 6e70 2e72 6f74 3930 2873 656c 662e  w(np.rot90(self.
+0007cf40: 6f64 7468 6963 6b6d 6170 292c 2063 6d61  odthickmap), cma
+0007cf50: 703d 6d61 7470 6c6f 746c 6962 2e63 6d2e  p=matplotlib.cm.
+0007cf60: 6765 745f 636d 6170 2822 6772 6179 2229  get_cmap("gray")
+0007cf70: 290d 0a0d 0a20 2020 2020 2020 2063 6261  )....        cba
+0007cf80: 7220 3d20 6178 6573 2e66 6967 7572 652e  r = axes.figure.
+0007cf90: 636f 6c6f 7262 6172 2869 6d2c 206f 7269  colorbar(im, ori
+0007cfa0: 656e 7461 7469 6f6e 3d27 7665 7274 6963  entation='vertic
+0007cfb0: 616c 272c 6361 783d 6178 6362 290d 0a0d  al',cax=axcb)...
+0007cfc0: 0a20 2020 2020 2020 2023 5368 6f77 2053  .        #Show S
+0007cfd0: 6361 6c65 2042 6172 0d0a 2020 2020 2020  cale Bar..      
+0007cfe0: 2020 7374 6172 7478 203d 2069 6e74 2873    startx = int(s
+0007cff0: 656c 662e 7374 6163 6b2e 6e5f 726f 7773  elf.stack.n_rows
+0007d000: 2a30 2e30 3529 0d0a 2020 2020 2020 2020  *0.05)..        
+0007d010: 7374 6172 7479 203d 2073 656c 662e 7374  starty = self.st
+0007d020: 6163 6b2e 6e5f 636f 6c73 2d69 6e74 2873  ack.n_cols-int(s
+0007d030: 656c 662e 7374 6163 6b2e 6e5f 636f 6c73  elf.stack.n_cols
+0007d040: 2a30 2e30 3529 2d73 656c 662e 7374 6163  *0.05)-self.stac
+0007d050: 6b2e 7363 616c 655f 6261 725f 7069 7865  k.scale_bar_pixe
+0007d060: 6c73 5f79 0d0a 2020 2020 2020 2020 756d  ls_y..        um
+0007d070: 5f73 7472 696e 6720 3d20 2720 245c 6d61  _string = ' $\ma
+0007d080: 7468 726d 7b5c 6d75 206d 7d24 270d 0a20  thrm{\mu m}$'.. 
+0007d090: 2020 2020 2020 206d 6963 726f 6e73 203d         microns =
+0007d0a0: 2027 2427 2b73 656c 662e 7374 6163 6b2e   '$'+self.stack.
+0007d0b0: 7363 616c 655f 6261 725f 7374 7269 6e67  scale_bar_string
+0007d0c0: 2b27 2024 272b 756d 5f73 7472 696e 670d  +' $'+um_string.
+0007d0d0: 0a20 2020 2020 2020 2061 7865 732e 7465  .        axes.te
+0007d0e0: 7874 2873 656c 662e 7374 6163 6b2e 7363  xt(self.stack.sc
+0007d0f0: 616c 655f 6261 725f 7069 7865 6c73 5f78  ale_bar_pixels_x
+0007d100: 2b73 7461 7274 782b 312c 7374 6172 7479  +startx+1,starty
+0007d110: 2b31 2c20 6d69 6372 6f6e 732c 2068 6f72  +1, microns, hor
+0007d120: 697a 6f6e 7461 6c61 6c69 676e 6d65 6e74  izontalalignment
+0007d130: 3d27 6c65 6674 272c 2076 6572 7469 6361  ='left', vertica
+0007d140: 6c61 6c69 676e 6d65 6e74 3d27 6365 6e74  lalignment='cent
+0007d150: 6572 272c 0d0a 2020 2020 2020 2020 2020  er',..          
+0007d160: 2020 2020 2020 2020 636f 6c6f 7220 3d20          color = 
+0007d170: 2777 6869 7465 272c 2066 6f6e 7473 697a  'white', fontsiz
+0007d180: 653d 3134 290d 0a20 2020 2020 2020 2023  e=14)..        #
+0007d190: 4d61 7470 6c6f 746c 6962 2068 6173 2066  Matplotlib has f
+0007d1a0: 6c69 7070 6564 2073 6361 6c65 7320 736f  lipped scales so
+0007d1b0: 2049 276d 2075 7369 6e67 2072 6f77 7320   I'm using rows 
+0007d1c0: 696e 7374 6561 6420 6f66 2063 6f6c 7321  instead of cols!
+0007d1d0: 0d0a 2020 2020 2020 2020 7020 3d20 6d61  ..        p = ma
+0007d1e0: 7470 6c6f 746c 6962 2e70 6174 6368 6573  tplotlib.patches
+0007d1f0: 2e52 6563 7461 6e67 6c65 2828 7374 6172  .Rectangle((star
+0007d200: 7478 2c73 7461 7274 7929 2c20 7365 6c66  tx,starty), self
+0007d210: 2e73 7461 636b 2e73 6361 6c65 5f62 6172  .stack.scale_bar
+0007d220: 5f70 6978 656c 735f 782c 2073 656c 662e  _pixels_x, self.
+0007d230: 7374 6163 6b2e 7363 616c 655f 6261 725f  stack.scale_bar_
+0007d240: 7069 7865 6c73 5f79 2c0d 0a20 2020 2020  pixels_y,..     
+0007d250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007d260: 2020 2020 2020 2020 2020 636f 6c6f 7220            color 
+0007d270: 3d20 2777 6869 7465 272c 2066 696c 6c20  = 'white', fill 
+0007d280: 3d20 5472 7565 290d 0a20 2020 2020 2020  = True)..       
+0007d290: 2061 7865 732e 6164 645f 7061 7463 6828   axes.add_patch(
+0007d2a0: 7029 0d0a 0d0a 0d0a 2020 2020 2020 2020  p)......        
+0007d2b0: 6178 6573 2e61 7869 7328 226f 6666 2229  axes.axis("off")
+0007d2c0: 0d0a 2020 2020 2020 2020 7365 6c66 2e4f  ..        self.O
+0007d2d0: 444d 496d 6167 6550 616e 656c 2e64 7261  DMImagePanel.dra
+0007d2e0: 7728 290d 0a0d 0a0d 0a23 2d2d 2d2d 2d2d  w()......#------
+0007d2f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007d300: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007d310: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007d320: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007d330: 0d0a 2020 2020 6465 6620 4f6e 5365 6c65  ..    def OnSele
+0007d340: 6374 696f 6e31 2873 656c 662c 2065 7674  ction1(self, evt
+0007d350: 293a 0d0a 0d0a 2020 2020 2020 2020 7831  ):....        x1
+0007d360: 203d 2065 7674 2e78 6461 7461 0d0a 0d0a   = evt.xdata....
+0007d370: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
+0007d380: 746f 6e5f 7072 6573 7365 6420 3d20 5472  ton_pressed = Tr
+0007d390: 7565 0d0a 2020 2020 2020 2020 7365 6c66  ue..        self
+0007d3a0: 2e70 6174 6368 203d 204e 6f6e 650d 0a20  .patch = None.. 
+0007d3b0: 2020 2020 2020 2073 656c 662e 636f 6e6e         self.conn
+0007d3c0: 203d 2073 656c 662e 5370 6563 7472 756d   = self.Spectrum
+0007d3d0: 5061 6e65 6c2e 6d70 6c5f 636f 6e6e 6563  Panel.mpl_connec
+0007d3e0: 7428 276d 6f74 696f 6e5f 6e6f 7469 6679  t('motion_notify
+0007d3f0: 5f65 7665 6e74 272c 2073 656c 662e 4f6e  _event', self.On
+0007d400: 5365 6c65 6374 696f 6e4d 6f74 696f 6e29  SelectionMotion)
+0007d410: 0d0a 0d0a 2020 2020 2020 2020 6966 2078  ....        if x
+0007d420: 3120 3d3d 204e 6f6e 653a 0d0a 2020 2020  1 == None:..    
+0007d430: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
+0007d440: 0d0a 2020 2020 2020 2020 7365 6c66 2e78  ..        self.x
+0007d450: 3120 3d20 7831 0d0a 0d0a 232d 2d2d 2d2d  1 = x1....#-----
+0007d460: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007d470: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007d480: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007d490: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007d4a0: 2d0d 0a20 2020 2064 6566 204f 6e53 656c  -..    def OnSel
+0007d4b0: 6563 7469 6f6e 3228 7365 6c66 2c20 6576  ection2(self, ev
+0007d4c0: 7429 3a0d 0a0d 0a20 2020 2020 2020 2078  t):....        x
+0007d4d0: 3220 3d20 6576 742e 7864 6174 610d 0a0d  2 = evt.xdata...
+0007d4e0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+0007d4f0: 6275 7474 6f6e 5f70 7265 7373 6564 203d  button_pressed =
+0007d500: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+0007d510: 7365 6c66 2e53 7065 6374 7275 6d50 616e  self.SpectrumPan
+0007d520: 656c 2e6d 706c 5f64 6973 636f 6e6e 6563  el.mpl_disconnec
+0007d530: 7428 7365 6c66 2e63 6f6e 6e29 0d0a 0d0a  t(self.conn)....
+0007d540: 2020 2020 2020 2020 6966 2078 3220 3d3d          if x2 ==
+0007d550: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0007d560: 2020 2020 7265 7475 726e 0d0a 0d0a 2020      return....  
+0007d570: 2020 2020 2020 7831 203d 2073 656c 662e        x1 = self.
+0007d580: 7831 0d0a 0d0a 0d0a 2020 2020 2020 2020  x1......        
+0007d590: 6966 2028 7365 6c66 2e69 3073 656c 6563  if (self.i0selec
+0007d5a0: 7465 6420 3d3d 2031 2920 616e 6420 2873  ted == 1) and (s
+0007d5b0: 656c 662e 6973 656c 6563 7465 6420 3d3d  elf.iselected ==
+0007d5c0: 3129 3a0d 0a20 2020 2020 2020 2020 2020  1):..           
+0007d5d0: 2073 656c 662e 6930 7365 6c65 6374 6564   self.i0selected
+0007d5e0: 203d 2030 0d0a 2020 2020 2020 2020 2020   = 0..          
+0007d5f0: 2020 7365 6c66 2e69 7365 6c65 6374 6564    self.iselected
+0007d600: 203d 2030 0d0a 0d0a 2020 2020 2020 2020   = 0....        
+0007d610: 6966 2073 656c 662e 6930 7365 6c65 6374  if self.i0select
+0007d620: 6564 203d 3d20 303a 0d0a 2020 2020 2020  ed == 0:..      
+0007d630: 2020 2020 2020 7365 6c66 2e69 306d 696e        self.i0min
+0007d640: 203d 206e 702e 6162 7328 7365 6c66 2e73   = np.abs(self.s
+0007d650: 7461 636b 2e65 7620 2d20 7831 292e 6172  tack.ev - x1).ar
+0007d660: 676d 696e 2829 0d0a 2020 2020 2020 2020  gmin()..        
+0007d670: 2020 2020 7365 6c66 2e69 306d 6178 203d      self.i0max =
+0007d680: 206e 702e 6162 7328 7365 6c66 2e73 7461   np.abs(self.sta
+0007d690: 636b 2e65 7620 2d20 7832 292e 6172 676d  ck.ev - x2).argm
+0007d6a0: 696e 2829 0d0a 0d0a 2020 2020 2020 2020  in()....        
+0007d6b0: 2020 2020 7365 6c66 2e69 6d61 6765 5f69      self.image_i
+0007d6c0: 3020 3d20 6e70 2e73 756d 2873 656c 662e  0 = np.sum(self.
+0007d6d0: 7374 6163 6b2e 6162 7364 6174 615b 3a2c  stack.absdata[:,
+0007d6e0: 203a 2c20 7365 6c66 2e69 306d 696e 3a73   :, self.i0min:s
+0007d6f0: 656c 662e 6930 6d61 782b 315d 2c20 6178  elf.i0max+1], ax
+0007d700: 6973 3d32 292f 2873 656c 662e 6930 6d61  is=2)/(self.i0ma
+0007d710: 782b 312d 7365 6c66 2e69 306d 696e 290d  x+1-self.i0min).
+0007d720: 0a0d 0a20 2020 2020 2020 2020 2020 2073  ...            s
+0007d730: 656c 662e 7465 7874 6374 726c 312e 7365  elf.textctrl1.se
+0007d740: 7454 6578 7428 2753 656c 6563 7469 6f6e  tText('Selection
+0007d750: 3a20 5b20 272b 7374 7228 7365 6c66 2e73  : [ '+str(self.s
+0007d760: 7461 636b 2e65 765b 7365 6c66 2e69 306d  tack.ev[self.i0m
+0007d770: 696e 5d29 202b 2027 2065 562c 2027 2b20  in]) + ' eV, '+ 
+0007d780: 7374 7228 7365 6c66 2e73 7461 636b 2e65  str(self.stack.e
+0007d790: 765b 7365 6c66 2e69 306d 6178 5d29 2b27  v[self.i0max])+'
+0007d7a0: 2065 5620 5d27 2029 0d0a 2020 2020 2020   eV ]' )..      
+0007d7b0: 2020 2020 2020 7365 6c66 2e69 3073 656c        self.i0sel
+0007d7c0: 6563 7465 6420 3d20 310d 0a0d 0a20 2020  ected = 1....   
+0007d7d0: 2020 2020 2065 6c69 6620 7365 6c66 2e69       elif self.i
+0007d7e0: 7365 6c65 6374 6564 203d 3d20 303a 0d0a  selected == 0:..
+0007d7f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0007d800: 2e69 6d69 6e20 3d20 6e70 2e61 6273 2873  .imin = np.abs(s
+0007d810: 656c 662e 7374 6163 6b2e 6576 202d 2078  elf.stack.ev - x
+0007d820: 3129 2e61 7267 6d69 6e28 290d 0a20 2020  1).argmin()..   
+0007d830: 2020 2020 2020 2020 2073 656c 662e 696d           self.im
+0007d840: 6178 203d 206e 702e 6162 7328 7365 6c66  ax = np.abs(self
+0007d850: 2e73 7461 636b 2e65 7620 2d20 7832 292e  .stack.ev - x2).
+0007d860: 6172 676d 696e 2829 0d0a 0d0a 2020 2020  argmin()....    
+0007d870: 2020 2020 2020 2020 7365 6c66 2e69 6d61          self.ima
+0007d880: 6765 5f69 203d 206e 702e 7375 6d28 7365  ge_i = np.sum(se
+0007d890: 6c66 2e73 7461 636b 2e61 6273 6461 7461  lf.stack.absdata
+0007d8a0: 5b3a 2c20 3a2c 2073 656c 662e 696d 696e  [:, :, self.imin
+0007d8b0: 3a73 656c 662e 696d 6178 2b31 5d2c 2061  :self.imax+1], a
+0007d8c0: 7869 733d 3229 2f28 7365 6c66 2e69 6d61  xis=2)/(self.ima
+0007d8d0: 782b 312d 7365 6c66 2e69 6d69 6e29 0d0a  x+1-self.imin)..
+0007d8e0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0007d8f0: 6c66 2e74 6578 7463 7472 6c32 2e73 6574  lf.textctrl2.set
+0007d900: 5465 7874 2827 5365 6c65 6374 696f 6e3a  Text('Selection:
+0007d910: 205b 2027 2b73 7472 2873 656c 662e 7374   [ '+str(self.st
+0007d920: 6163 6b2e 6576 5b73 656c 662e 696d 696e  ack.ev[self.imin
+0007d930: 5d29 202b 2027 2065 562c 2027 2b20 7374  ]) + ' eV, '+ st
+0007d940: 7228 7365 6c66 2e73 7461 636b 2e65 765b  r(self.stack.ev[
+0007d950: 7365 6c66 2e69 6d61 785d 292b 2720 6556  self.imax])+' eV
+0007d960: 205d 2720 290d 0a20 2020 2020 2020 2020   ]' )..         
+0007d970: 2020 2073 656c 662e 6973 656c 6563 7465     self.iselecte
+0007d980: 6420 3d20 310d 0a0d 0a20 2020 2020 2020  d = 1....       
+0007d990: 2069 6620 2873 656c 662e 6930 7365 6c65   if (self.i0sele
+0007d9a0: 6374 6564 203d 3d20 3129 2061 6e64 2028  cted == 1) and (
+0007d9b0: 7365 6c66 2e69 7365 6c65 6374 6564 203d  self.iselected =
+0007d9c0: 3d31 293a 0d0a 2020 2020 2020 2020 2020  =1):..          
+0007d9d0: 2020 6e6f 6e7a 6572 6f69 6e64 203d 2073    nonzeroind = s
+0007d9e0: 656c 662e 696d 6167 655f 6930 2e6e 6f6e  elf.image_i0.non
+0007d9f0: 7a65 726f 2829 0d0a 2020 2020 2020 2020  zero()..        
+0007da00: 2020 2020 7365 6c66 2e6f 6474 6869 636b      self.odthick
+0007da10: 6d61 7020 3d20 6e70 2e7a 6572 6f73 2828  map = np.zeros((
+0007da20: 7365 6c66 2e73 7461 636b 2e6e 5f63 6f6c  self.stack.n_col
+0007da30: 732c 2073 656c 662e 7374 6163 6b2e 6e5f  s, self.stack.n_
+0007da40: 726f 7773 2929 0d0a 2020 2020 2020 2020  rows))..        
+0007da50: 2020 2020 7365 6c66 2e6f 6474 6869 636b      self.odthick
+0007da60: 6d61 705b 6e6f 6e7a 6572 6f69 6e64 5d20  map[nonzeroind] 
+0007da70: 3d20 2d20 6e70 2e6c 6f67 2873 656c 662e  = - np.log(self.
+0007da80: 696d 6167 655f 695b 6e6f 6e7a 6572 6f69  image_i[nonzeroi
+0007da90: 6e64 5d2f 7365 6c66 2e69 6d61 6765 5f69  nd]/self.image_i
+0007daa0: 305b 6e6f 6e7a 6572 6f69 6e64 5d29 0d0a  0[nonzeroind])..
+0007dab0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0007dac0: 2e64 7261 775f 696d 6167 6528 290d 0a0d  .draw_image()...
+0007dad0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+0007dae0: 6472 6177 5f73 7065 6374 7275 6d28 290d  draw_spectrum().
+0007daf0: 0a0d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d  .....#----------
+0007db00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007db10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007db20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007db30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020  ------------..  
+0007db40: 2020 6465 6620 4f6e 5365 6c65 6374 696f    def OnSelectio
+0007db50: 6e4d 6f74 696f 6e28 7365 6c66 2c20 6576  nMotion(self, ev
+0007db60: 656e 7429 3a0d 0a0d 0a20 2020 2020 2020  ent):....       
+0007db70: 2078 3220 3d20 6576 656e 742e 7864 6174   x2 = event.xdat
+0007db80: 610d 0a0d 0a20 2020 2020 2020 2069 6620  a....        if 
+0007db90: 7832 203d 3d20 4e6f 6e65 3a0d 0a20 2020  x2 == None:..   
+0007dba0: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
+0007dbb0: 0a0d 0a20 2020 2020 2020 2078 3120 3d20  ...        x1 = 
+0007dbc0: 7365 6c66 2e78 310d 0a0d 0a0d 0a20 2020  self.x1......   
+0007dbd0: 2020 2020 2066 6967 203d 2073 656c 662e       fig = self.
+0007dbe0: 7370 6563 6669 670d 0a0d 0a20 2020 2020  specfig....     
+0007dbf0: 2020 2061 7865 7320 3d20 6669 672e 6763     axes = fig.gc
+0007dc00: 6128 290d 0a0d 0a20 2020 2020 2020 2069  a()....        i
+0007dc10: 6620 7365 6c66 2e70 6174 6368 2021 3d20  f self.patch != 
+0007dc20: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0007dc30: 2020 2073 656c 662e 7061 7463 682e 7265     self.patch.re
+0007dc40: 6d6f 7665 2829 0d0a 2020 2020 2020 2020  move()..        
+0007dc50: 7365 6c66 2e70 6174 6368 203d 2073 656c  self.patch = sel
+0007dc60: 662e 6178 6573 2e61 7876 7370 616e 2878  f.axes.axvspan(x
+0007dc70: 312c 2078 322c 2066 6163 6563 6f6c 6f72  1, x2, facecolor
+0007dc80: 3d27 7727 2c20 616c 7068 613d 302e 3529  ='w', alpha=0.5)
+0007dc90: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+0007dca0: 2e53 7065 6374 7275 6d50 616e 656c 2e64  .SpectrumPanel.d
+0007dcb0: 7261 7728 290d 0a0d 0a0d 0a23 2d2d 2d2d  raw()......#----
+0007dcc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007dcd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007dce0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007dcf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007dd00: 2d2d 0d0a 2020 2020 6465 6620 4f6e 5361  --..    def OnSa
+0007dd10: 7665 2873 656c 662c 2065 7674 293a 0d0a  ve(self, evt):..
+0007dd20: 2020 2020 2020 2020 2353 6176 6520 696d          #Save im
+0007dd30: 6167 6573 0d0a 0d0a 2020 2020 2020 2020  ages....        
+0007dd40: 7769 6c64 6361 7264 203d 2022 506f 7274  wildcard = "Port
+0007dd50: 6162 6c65 204e 6574 776f 726b 2047 7261  able Network Gra
+0007dd60: 7068 6963 7320 282a 2e70 6e67 293b 3b41  phics (*.png);;A
+0007dd70: 646f 6265 2050 4446 2046 696c 6573 2028  dobe PDF Files (
+0007dd80: 2a2e 7064 6629 3b3b 5449 4646 2046 696c  *.pdf);;TIFF Fil
+0007dd90: 6520 282a 2e74 6966 293b 3b22 0d0a 0d0a  e (*.tif);;"....
+0007dda0: 2020 2020 2020 2020 6669 6c65 4e61 6d65          fileName
+0007ddb0: 2c20 5f66 696c 7465 7220 3d20 5174 5769  , _filter = QtWi
+0007ddc0: 6467 6574 732e 5146 696c 6544 6961 6c6f  dgets.QFileDialo
+0007ddd0: 672e 6765 7453 6176 6546 696c 654e 616d  g.getSaveFileNam
+0007dde0: 6528 7365 6c66 2c20 2753 6176 6520 4f44  e(self, 'Save OD
+0007ddf0: 204d 6170 272c 2027 272c 2077 696c 6463   Map', '', wildc
+0007de00: 6172 6429 0d0a 0d0a 2020 2020 2020 2020  ard)....        
+0007de10: 6669 6c65 4e61 6d65 203d 2073 7472 2866  fileName = str(f
+0007de20: 696c 654e 616d 6529 0d0a 2020 2020 2020  ileName)..      
+0007de30: 2020 6966 2066 696c 654e 616d 6520 3d3d    if fileName ==
+0007de40: 2027 273a 0d0a 2020 2020 2020 2020 2020   '':..          
+0007de50: 2020 7265 7475 726e 0d0a 0d0a 2020 2020    return....    
+0007de60: 2020 2020 7061 7468 2c20 6578 7420 3d20      path, ext = 
+0007de70: 6f73 2e70 6174 682e 7370 6c69 7465 7874  os.path.splitext
+0007de80: 2866 696c 654e 616d 6529 0d0a 2020 2020  (fileName)..    
+0007de90: 2020 2020 6578 7420 3d20 6578 745b 313a      ext = ext[1:
+0007dea0: 5d2e 6c6f 7765 7228 290d 0a0d 0a0d 0a0d  ].lower().......
+0007deb0: 0a20 2020 2020 2020 2069 6620 6578 7420  .        if ext 
+0007dec0: 213d 2027 706e 6727 2061 6e64 2065 7874  != 'png' and ext
+0007ded0: 2021 3d20 2770 6466 2720 616e 6420 6578   != 'pdf' and ex
+0007dee0: 7420 213d 2027 7469 6627 3a0d 0a20 2020  t != 'tif':..   
+0007def0: 2020 2020 2020 2020 2065 7272 6f72 5f6d           error_m
+0007df00: 6573 7361 6765 203d 2028 0d0a 2020 2020  essage = (..    
+0007df10: 2020 2020 2020 2020 2020 2020 2020 274f                'O
+0007df20: 6e6c 7920 7468 6520 504e 4720 616e 6420  nly the PNG and 
+0007df30: 5044 4620 696d 6167 6520 666f 726d 6174  PDF image format
+0007df40: 7320 6172 6520 7375 7070 6f72 7465 642e  s are supported.
+0007df50: 5c6e 270d 0a20 2020 2020 2020 2020 2020  \n'..           
+0007df60: 2020 2020 2020 2741 2066 696c 6520 6578        'A file ex
+0007df70: 7465 6e73 696f 6e20 6f66 2060 706e 675c  tension of `png\
+0007df80: 2720 6f72 2060 7064 665c 2720 6d75 7374  ' or `pdf\' must
+0007df90: 2062 6520 7573 6564 2e27 290d 0a20 2020   be used.')..   
+0007dfa0: 2020 2020 2020 2020 2051 7457 6964 6765           QtWidge
+0007dfb0: 7473 2e51 4d65 7373 6167 6542 6f78 2e77  ts.QMessageBox.w
+0007dfc0: 6172 6e69 6e67 2873 656c 662c 2027 4572  arning(self, 'Er
+0007dfd0: 726f 7227 2c20 2745 7272 6f72 202d 2043  ror', 'Error - C
+0007dfe0: 6f75 6c64 206e 6f74 2073 6176 6520 6669  ould not save fi
+0007dff0: 6c65 2e27 290d 0a20 2020 2020 2020 2020  le.')..         
+0007e000: 2020 2072 6574 7572 6e0d 0a0d 0a0d 0a20     return...... 
+0007e010: 2020 2020 2020 2069 6620 6578 7420 3d3d         if ext ==
+0007e020: 2027 7469 6627 3a0d 0a20 2020 2020 2020   'tif':..       
+0007e030: 2020 2020 2066 726f 6d20 5049 4c20 696d       from PIL im
+0007e040: 706f 7274 2049 6d61 6765 0d0a 2020 2020  port Image..    
+0007e050: 2020 2020 2020 2020 696d 6731 203d 2049          img1 = I
+0007e060: 6d61 6765 2e66 726f 6d61 7272 6179 2873  mage.fromarray(s
+0007e070: 656c 662e 6f64 7468 6963 6b6d 6170 290d  elf.odthickmap).
+0007e080: 0a20 2020 2020 2020 2020 2020 2069 6d67  .            img
+0007e090: 312e 7361 7665 2866 696c 654e 616d 6529  1.save(fileName)
+0007e0a0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+0007e0b0: 0a0d 0a20 2020 2020 2020 2020 2020 2074  ...            t
+0007e0c0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+0007e0d0: 2020 2020 206d 6174 706c 6f74 6c69 622e       matplotlib.
+0007e0e0: 7263 5061 7261 6d73 5b27 7064 662e 666f  rcParams['pdf.fo
+0007e0f0: 6e74 7479 7065 275d 203d 2034 320d 0a0d  nttype'] = 42...
+0007e100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007e110: 2066 6967 203d 2073 656c 662e 6f64 6d66   fig = self.odmf
+0007e120: 6967 0d0a 2020 2020 2020 2020 2020 2020  ig..            
+0007e130: 2020 2020 6669 672e 7361 7665 6669 6728      fig.savefig(
+0007e140: 6669 6c65 4e61 6d65 290d 0a0d 0a0d 0a20  fileName)...... 
+0007e150: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0007e160: 7420 494f 4572 726f 7220 6173 2065 3a0d  t IOError as e:.
+0007e170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007e180: 2069 6620 652e 7374 7265 7272 6f72 3a0d   if e.strerror:.
+0007e190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0007e1a0: 2020 2020 2065 7272 203d 2065 2e73 7472       err = e.str
+0007e1b0: 6572 726f 720d 0a20 2020 2020 2020 2020  error..         
+0007e1c0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0007e1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e1e0: 2020 6572 7220 3d20 650d 0a0d 0a20 2020    err = e....   
+0007e1f0: 2020 2020 2020 2020 2020 2020 2051 7447               QtG
+0007e200: 7569 2e51 4d65 7373 6167 6542 6f78 2e77  ui.QMessageBox.w
+0007e210: 6172 6e69 6e67 2873 656c 662c 2027 4572  arning(self, 'Er
+0007e220: 726f 7227 2c20 2743 6f75 6c64 206e 6f74  ror', 'Could not
+0007e230: 2073 6176 6520 6669 6c65 3a20 2573 2720   save file: %s' 
+0007e240: 2520 6572 7229 0d0a 0d0a 0d0a 0d0a 0d0a  % err)..........
+0007e250: 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  #---------------
+0007e260: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007e270: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007e280: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007e290: 2d2d 2d2d 2d2d 2d0d 0a63 6c61 7373 2044  -------..class D
+0007e2a0: 6f73 6543 616c 6375 6c61 7469 6f6e 2851  oseCalculation(Q
+0007e2b0: 7457 6964 6765 7473 2e51 4469 616c 6f67  tWidgets.QDialog
+0007e2c0: 293a 0d0a 0d0a 2020 2020 6465 6620 5f5f  ):....    def __
+0007e2d0: 696e 6974 5f5f 2873 656c 662c 2070 6172  init__(self, par
+0007e2e0: 656e 742c 2020 7374 6163 6b2c 2052 4f49  ent,  stack, ROI
+0007e2f0: 7370 6563 7472 756d 293a 0d0a 2020 2020  spectrum):..    
+0007e300: 2020 2020 5174 5769 6467 6574 732e 5157      QtWidgets.QW
+0007e310: 6964 6765 742e 5f5f 696e 6974 5f5f 2873  idget.__init__(s
+0007e320: 656c 662c 2070 6172 656e 7429 0d0a 0d0a  elf, parent)....
+0007e330: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
+0007e340: 656e 7420 3d20 7061 7265 6e74 0d0a 0d0a  ent = parent....
+0007e350: 2020 2020 2020 2020 7365 6c66 2e72 6573          self.res
+0007e360: 697a 6528 3330 302c 2031 3730 290d 0a20  ize(300, 170).. 
+0007e370: 2020 2020 2020 2073 656c 662e 7365 7457         self.setW
+0007e380: 696e 646f 7754 6974 6c65 2827 446f 7365  indowTitle('Dose
+0007e390: 2043 616c 6375 6c61 7469 6f6e 2729 0d0a   Calculation')..
+0007e3a0: 0d0a 2020 2020 2020 2020 7061 6c20 3d20  ..        pal = 
+0007e3b0: 5174 4775 692e 5150 616c 6574 7465 2829  QtGui.QPalette()
+0007e3c0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+0007e3d0: 6574 4175 746f 4669 6c6c 4261 636b 6772  etAutoFillBackgr
+0007e3e0: 6f75 6e64 2854 7275 6529 0d0a 2020 2020  ound(True)..    
+0007e3f0: 2020 2020 7061 6c2e 7365 7443 6f6c 6f72      pal.setColor
+0007e400: 2851 7447 7569 2e51 5061 6c65 7474 652e  (QtGui.QPalette.
+0007e410: 5769 6e64 6f77 2c51 7447 7569 2e51 436f  Window,QtGui.QCo
+0007e420: 6c6f 7228 2777 6869 7465 2729 290d 0a20  lor('white')).. 
+0007e430: 2020 2020 2020 2073 656c 662e 7365 7450         self.setP
+0007e440: 616c 6574 7465 2870 616c 290d 0a0d 0a20  alette(pal).... 
+0007e450: 2020 2020 2020 2073 656c 662e 7374 6163         self.stac
+0007e460: 6b20 3d20 7374 6163 6b0d 0a20 2020 2020  k = stack..     
+0007e470: 2020 2073 656c 662e 524f 4973 7065 6374     self.ROIspect
+0007e480: 7275 6d20 3d20 524f 4973 7065 6374 7275  rum = ROIspectru
+0007e490: 6d0d 0a0d 0a0d 0a0d 0a20 2020 2020 2020  m........       
+0007e4a0: 2076 626f 7874 6f70 203d 2051 7457 6964   vboxtop = QtWid
+0007e4b0: 6765 7473 2e51 5642 6f78 4c61 796f 7574  gets.QVBoxLayout
+0007e4c0: 2829 0d0a 0d0a 0d0a 2020 2020 2020 2020  ()......        
+0007e4d0: 6772 6964 746f 7020 3d20 5174 5769 6467  gridtop = QtWidg
+0007e4e0: 6574 732e 5147 7269 644c 6179 6f75 7428  ets.QGridLayout(
+0007e4f0: 290d 0a0d 0a0d 0a20 2020 2020 2020 2023  )......        #
+0007e500: 666f 6e74 6220 3d20 7778 2e53 7973 7465  fontb = wx.Syste
+0007e510: 6d53 6574 7469 6e67 735f 4765 7446 6f6e  mSettings_GetFon
+0007e520: 7428 7778 2e53 5953 5f44 4546 4155 4c54  t(wx.SYS_DEFAULT
+0007e530: 5f47 5549 5f46 4f4e 5429 0d0a 2020 2020  _GUI_FONT)..    
+0007e540: 2020 2020 2366 6f6e 7462 2e53 6574 5765      #fontb.SetWe
+0007e550: 6967 6874 2877 782e 424f 4c44 290d 0a0d  ight(wx.BOLD)...
+0007e560: 0a0d 0a20 2020 2020 2020 2073 7431 203d  ...        st1 =
+0007e570: 2051 7457 6964 6765 7473 2e51 4c61 6265   QtWidgets.QLabe
+0007e580: 6c28 7365 6c66 290d 0a20 2020 2020 2020  l(self)..       
+0007e590: 2073 7431 2e73 6574 5465 7874 2827 4465   st1.setText('De
+0007e5a0: 7465 6374 6f72 2065 6666 6963 6965 6e63  tector efficienc
+0007e5b0: 7920 5b25 5d3a 2729 0d0a 2020 2020 2020  y [%]:')..      
+0007e5c0: 2020 2373 7431 2e53 6574 466f 6e74 2866    #st1.SetFont(f
+0007e5d0: 6f6e 7462 290d 0a20 2020 2020 2020 2073  ontb)..        s
+0007e5e0: 7432 203d 2051 7457 6964 6765 7473 2e51  t2 = QtWidgets.Q
+0007e5f0: 4c61 6265 6c28 7365 6c66 290d 0a20 2020  Label(self)..   
+0007e600: 2020 2020 2073 7432 2e73 6574 5465 7874       st2.setText
+0007e610: 2827 4920 7265 6769 6f6e 2063 6f6d 706f  ('I region compo
+0007e620: 7369 7469 6f6e 3a27 290d 0a20 2020 2020  sition:')..     
+0007e630: 2020 2023 7374 322e 5365 7446 6f6e 7428     #st2.SetFont(
+0007e640: 666f 6e74 6229 0d0a 2320 2020 2020 2020  fontb)..#       
+0007e650: 2073 7433 203d 2051 7457 6964 6765 7473   st3 = QtWidgets
+0007e660: 2e51 4c61 6265 6c28 7365 6c66 2c27 5872  .QLabel(self,'Xr
+0007e670: 6179 2061 6273 6f72 7074 696f 6e20 6c65  ay absorption le
+0007e680: 6e67 7468 3a27 290d 0a23 2020 2020 2020  ngth:')..#      
+0007e690: 2020 7374 332e 5365 7446 6f6e 7428 666f    st3.SetFont(fo
+0007e6a0: 6e74 6229 0d0a 2020 2020 2020 2020 7374  ntb)..        st
+0007e6b0: 3420 3d20 5174 5769 6467 6574 732e 514c  4 = QtWidgets.QL
+0007e6c0: 6162 656c 2873 656c 6629 0d0a 2020 2020  abel(self)..    
+0007e6d0: 2020 2020 7374 342e 7365 7454 6578 7428      st4.setText(
+0007e6e0: 2744 6f73 6520 5b47 7261 795d 3a27 290d  'Dose [Gray]:').
+0007e6f0: 0a20 2020 2020 2020 2023 7374 342e 5365  .        #st4.Se
+0007e700: 7446 6f6e 7428 666f 6e74 6229 0d0a 0d0a  tFont(fontb)....
 0007e710: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
-0007e720: 635f 3220 3d20 5174 5769 6467 6574 732e  c_2 = QtWidgets.
+0007e720: 635f 3120 3d20 5174 5769 6467 6574 732e  c_1 = QtWidgets.
 0007e730: 514c 696e 6545 6469 7428 7365 6c66 290d  QLineEdit(self).
-0007e740: 0a0d 0a23 2020 2020 2020 2020 7365 6c66  ...#        self
-0007e750: 2e74 635f 3320 3d20 7778 2e54 6578 7443  .tc_3 = wx.TextC
-0007e760: 7472 6c28 7061 6e65 6c31 2c20 2d31 2c20  trl(panel1, -1, 
-0007e770: 7369 7a65 3d28 2832 3030 2c2d 3129 292c  size=((200,-1)),
-0007e780: 2073 7479 6c65 3d77 782e 5445 5f52 4943   style=wx.TE_RIC
-0007e790: 487c 7778 2e56 5343 524f 4c4c 7c77 782e  H|wx.VSCROLL|wx.
-0007e7a0: 5445 5f52 4541 444f 4e4c 592c 0d0a 2320  TE_READONLY,..# 
-0007e7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0007e7d0: 2020 2020 2020 2020 7661 6c75 653d 2720          value=' 
-0007e7e0: 2729 0d0a 0d0a 2020 2020 2020 2020 7365  ')....        se
-0007e7f0: 6c66 2e74 635f 3420 3d20 5174 5769 6467  lf.tc_4 = QtWidg
-0007e800: 6574 732e 514c 6162 656c 2873 656c 6629  ets.QLabel(self)
-0007e810: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6772  ......        gr
-0007e820: 6964 746f 702e 6164 6457 6964 6765 7428  idtop.addWidget(
-0007e830: 7374 312c 2030 2c30 290d 0a20 2020 2020  st1, 0,0)..     
-0007e840: 2020 2067 7269 6474 6f70 2e61 6464 5769     gridtop.addWi
-0007e850: 6467 6574 2820 7365 6c66 2e74 635f 312c  dget( self.tc_1,
-0007e860: 2030 2c31 290d 0a20 2020 2020 2020 2067   0,1)..        g
-0007e870: 7269 6474 6f70 2e61 6464 5769 6467 6574  ridtop.addWidget
-0007e880: 2873 7432 2c20 312c 3029 0d0a 2020 2020  (st2, 1,0)..    
-0007e890: 2020 2020 6772 6964 746f 702e 6164 6457      gridtop.addW
-0007e8a0: 6964 6765 7428 2073 656c 662e 7463 5f32  idget( self.tc_2
-0007e8b0: 2c20 312c 3129 0d0a 2320 2020 2020 2020  , 1,1)..#       
+0007e740: 0a20 2020 2020 2020 2073 656c 662e 7463  .        self.tc
+0007e750: 5f31 2e73 6574 5465 7874 2827 3330 2729  _1.setText('30')
+0007e760: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+0007e770: 2e74 635f 3220 3d20 5174 5769 6467 6574  .tc_2 = QtWidget
+0007e780: 732e 514c 696e 6545 6469 7428 7365 6c66  s.QLineEdit(self
+0007e790: 290d 0a0d 0a23 2020 2020 2020 2020 7365  )....#        se
+0007e7a0: 6c66 2e74 635f 3320 3d20 7778 2e54 6578  lf.tc_3 = wx.Tex
+0007e7b0: 7443 7472 6c28 7061 6e65 6c31 2c20 2d31  tCtrl(panel1, -1
+0007e7c0: 2c20 7369 7a65 3d28 2832 3030 2c2d 3129  , size=((200,-1)
+0007e7d0: 292c 2073 7479 6c65 3d77 782e 5445 5f52  ), style=wx.TE_R
+0007e7e0: 4943 487c 7778 2e56 5343 524f 4c4c 7c77  ICH|wx.VSCROLL|w
+0007e7f0: 782e 5445 5f52 4541 444f 4e4c 592c 0d0a  x.TE_READONLY,..
+0007e800: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0007e810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0007e820: 2020 2020 2020 2020 2020 7661 6c75 653d            value=
+0007e830: 2720 2729 0d0a 0d0a 2020 2020 2020 2020  ' ')....        
+0007e840: 7365 6c66 2e74 635f 3420 3d20 5174 5769  self.tc_4 = QtWi
+0007e850: 6467 6574 732e 514c 6162 656c 2873 656c  dgets.QLabel(sel
+0007e860: 6629 0d0a 0d0a 0d0a 2020 2020 2020 2020  f)......        
+0007e870: 6772 6964 746f 702e 6164 6457 6964 6765  gridtop.addWidge
+0007e880: 7428 7374 312c 2030 2c30 290d 0a20 2020  t(st1, 0,0)..   
+0007e890: 2020 2020 2067 7269 6474 6f70 2e61 6464       gridtop.add
+0007e8a0: 5769 6467 6574 2820 7365 6c66 2e74 635f  Widget( self.tc_
+0007e8b0: 312c 2030 2c31 290d 0a20 2020 2020 2020  1, 0,1)..       
 0007e8c0: 2067 7269 6474 6f70 2e61 6464 5769 6467   gridtop.addWidg
-0007e8d0: 6574 2873 7433 2c20 3029 0d0a 2320 2020  et(st3, 0)..#   
-0007e8e0: 2020 2020 2067 7269 6474 6f70 2e61 6464       gridtop.add
-0007e8f0: 5769 6467 6574 2820 7365 6c66 2e74 635f  Widget( self.tc_
-0007e900: 332c 2030 290d 0a20 2020 2020 2020 2067  3, 0)..        g
-0007e910: 7269 6474 6f70 2e61 6464 5769 6467 6574  ridtop.addWidget
-0007e920: 2873 7434 2c20 322c 3029 0d0a 2020 2020  (st4, 2,0)..    
-0007e930: 2020 2020 6772 6964 746f 702e 6164 6457      gridtop.addW
-0007e940: 6964 6765 7428 2073 656c 662e 7463 5f34  idget( self.tc_4
-0007e950: 2c20 322c 3129 0d0a 0d0a 0d0a 0d0a 2020  , 2,1)........  
-0007e960: 2020 2020 2020 6275 7474 6f6e 5f63 616c        button_cal
-0007e970: 6364 6f73 6520 3d20 5174 5769 6467 6574  cdose = QtWidget
-0007e980: 732e 5150 7573 6842 7574 746f 6e28 2743  s.QPushButton('C
-0007e990: 616c 6375 6c61 7465 2044 6f73 6527 290d  alculate Dose').
-0007e9a0: 0a20 2020 2020 2020 2062 7574 746f 6e5f  .        button_
-0007e9b0: 6361 6c63 646f 7365 2e63 6c69 636b 6564  calcdose.clicked
-0007e9c0: 2e63 6f6e 6e65 6374 2873 656c 662e 4f6e  .connect(self.On
-0007e9d0: 4361 6c63 446f 7365 290d 0a0d 0a20 2020  CalcDose)....   
-0007e9e0: 2020 2020 2062 7574 746f 6e5f 6361 6e63       button_canc
-0007e9f0: 656c 203d 2051 7457 6964 6765 7473 2e51  el = QtWidgets.Q
-0007ea00: 5075 7368 4275 7474 6f6e 2827 4469 736d  PushButton('Dism
-0007ea10: 6973 7327 290d 0a20 2020 2020 2020 2062  iss')..        b
-0007ea20: 7574 746f 6e5f 6361 6e63 656c 2e63 6c69  utton_cancel.cli
-0007ea30: 636b 6564 2e63 6f6e 6e65 6374 2873 656c  cked.connect(sel
-0007ea40: 662e 636c 6f73 6529 0d0a 0d0a 0d0a 2020  f.close)......  
-0007ea50: 2020 2020 2020 7662 6f78 746f 702e 6164        vboxtop.ad
-0007ea60: 644c 6179 6f75 7428 6772 6964 746f 7029  dLayout(gridtop)
-0007ea70: 0d0a 2020 2020 2020 2020 7662 6f78 746f  ..        vboxto
-0007ea80: 702e 6164 6457 6964 6765 7428 6275 7474  p.addWidget(butt
-0007ea90: 6f6e 5f63 616c 6364 6f73 6529 0d0a 2020  on_calcdose)..  
-0007eaa0: 2020 2020 2020 7662 6f78 746f 702e 6164        vboxtop.ad
-0007eab0: 6457 6964 6765 7428 6275 7474 6f6e 5f63  dWidget(button_c
-0007eac0: 616e 6365 6c29 0d0a 0d0a 2020 2020 2020  ancel)....      
-0007ead0: 2020 7365 6c66 2e73 6574 4c61 796f 7574    self.setLayout
-0007eae0: 2876 626f 7874 6f70 290d 0a0d 0a0d 0a23  (vboxtop)......#
-0007eaf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007eb00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007eb10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007eb20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007eb30: 2d2d 2d2d 2d2d 0d0a 2020 2020 6465 6620  ------..    def 
-0007eb40: 4361 6c63 446f 7365 2873 656c 6629 3a0d  CalcDose(self):.
-0007eb50: 0a0d 0a0d 0a20 2020 2020 2020 2074 7279  .....        try
-0007eb60: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
-0007eb70: 6574 6563 746f 725f 6566 6620 3d20 302e  etector_eff = 0.
-0007eb80: 3031 2a66 6c6f 6174 2873 656c 662e 7463  01*float(self.tc
-0007eb90: 5f31 2e74 6578 7428 2929 0d0a 2020 2020  _1.text())..    
-0007eba0: 2020 2020 6578 6365 7074 3a0d 0a20 2020      except:..   
-0007ebb0: 2020 2020 2020 2020 2051 7447 7569 2e51           QtGui.Q
-0007ebc0: 4d65 7373 6167 6542 6f78 2e77 6172 6e69  MessageBox.warni
-0007ebd0: 6e67 2873 656c 662c 2027 4572 726f 7227  ng(self, 'Error'
-0007ebe0: 2c20 2750 6c65 6173 6520 656e 7465 7220  , 'Please enter 
-0007ebf0: 6e75 6d65 7269 6320 6e75 6d62 6572 2066  numeric number f
-0007ec00: 6f72 2064 6574 6563 746f 7220 6566 6669  or detector effi
-0007ec10: 6369 656e 6379 2e27 290d 0a20 2020 2020  ciency.')..     
-0007ec20: 2020 2020 2020 2070 7269 6e74 2827 506c         print('Pl
-0007ec30: 6561 7365 2065 6e74 6572 206e 756d 6572  ease enter numer
-0007ec40: 6963 206e 756d 6265 7220 666f 7220 6465  ic number for de
-0007ec50: 7465 6374 6f72 2065 6666 6963 6965 6e63  tector efficienc
-0007ec60: 792e 2729 0d0a 2020 2020 2020 2020 2020  y.')..          
-0007ec70: 2020 7265 7475 726e 0d0a 0d0a 0d0a 2020    return......  
-0007ec80: 2020 2020 2020 695f 636f 6d70 6f73 6974        i_composit
-0007ec90: 696f 6e20 3d20 7374 7228 7365 6c66 2e74  ion = str(self.t
-0007eca0: 635f 322e 7465 7874 2829 290d 0a0d 0a20  c_2.text()).... 
-0007ecb0: 2020 2020 2020 2064 6f73 6520 3d20 302e         dose = 0.
-0007ecc0: 0d0a 0d0a 2020 2020 2020 2020 4368 656e  ....        Chen
-0007ecd0: 6b65 203d 2068 656e 6b65 2e68 656e 6b65  ke = henke.henke
-0007ece0: 2829 0d0a 0d0a 2020 2020 2020 2020 2343  ()....        #C
-0007ecf0: 6865 636b 2069 6620 636f 6d70 6f73 6974  heck if composit
-0007ed00: 696f 6e20 6172 7261 7920 6973 2072 6563  ion array is rec
-0007ed10: 6f67 6e69 7a61 626c 650d 0a20 2020 2020  ognizable..     
-0007ed20: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-0007ed30: 2020 2020 207a 5f61 7272 6179 2c20 6174       z_array, at
-0007ed40: 7774 203d 2043 6865 6e6b 652e 636f 6d70  wt = Chenke.comp
-0007ed50: 6f75 6e64 2869 5f63 6f6d 706f 7369 7469  ound(i_compositi
-0007ed60: 6f6e 2c31 2e30 290d 0a20 2020 2020 2020  on,1.0)..       
-0007ed70: 2065 7863 6570 743a 0d0a 2020 2020 2020   except:..      
-0007ed80: 2020 2020 2020 5174 4775 692e 514d 6573        QtGui.QMes
-0007ed90: 7361 6765 426f 782e 7761 726e 696e 6728  sageBox.warning(
-0007eda0: 7365 6c66 2c20 2745 7272 6f72 272c 2022  self, 'Error', "
-0007edb0: 506c 6561 7365 2065 6e74 6572 206e 6577  Please enter new
-0007edc0: 2063 6f6d 706f 756e 642e 2229 0d0a 2020   compound.")..  
-0007edd0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0007ede0: 0d0a 0d0a 2020 2020 2020 2020 7472 793a  ....        try:
-0007edf0: 0d0a 2020 2020 2020 2020 2020 2020 646f  ..            do
-0007ee00: 7365 203d 2043 6865 6e6b 652e 646f 7365  se = Chenke.dose
-0007ee10: 5f63 616c 6328 7365 6c66 2e73 7461 636b  _calc(self.stack
-0007ee20: 2c20 695f 636f 6d70 6f73 6974 696f 6e2c  , i_composition,
-0007ee30: 2073 656c 662e 524f 4973 7065 6374 7275   self.ROIspectru
-0007ee40: 6d2c 2073 656c 662e 7374 6163 6b2e 6930  m, self.stack.i0
-0007ee50: 6461 7461 2c20 6465 7465 6374 6f72 5f65  data, detector_e
-0007ee60: 6666 290d 0a20 2020 2020 2020 2065 7863  ff)..        exc
-0007ee70: 6570 743a 0d0a 2020 2020 2020 2020 2020  ept:..          
-0007ee80: 2020 5174 4775 692e 514d 6573 7361 6765    QtGui.QMessage
-0007ee90: 426f 782e 7761 726e 696e 6728 7365 6c66  Box.warning(self
-0007eea0: 2c20 2745 7272 6f72 272c 2022 436f 756c  , 'Error', "Coul
-0007eeb0: 6420 6e6f 7420 6361 6c63 756c 6174 6520  d not calculate 
-0007eec0: 646f 7365 2e20 506c 6561 7365 2065 6e74  dose. Please ent
-0007eed0: 6572 206e 6577 2063 6f6d 706f 756e 642e  er new compound.
-0007eee0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-0007eef0: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
-0007ef00: 2020 7365 6c66 2e74 635f 342e 7365 7454    self.tc_4.setT
-0007ef10: 6578 7428 7374 7228 646f 7365 2929 0d0a  ext(str(dose))..
-0007ef20: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0007ef30: 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d  ......#---------
-0007ef40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007ef50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007ef60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007ef70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20  -------------.. 
-0007ef80: 2020 2064 6566 204f 6e43 616c 6344 6f73     def OnCalcDos
-0007ef90: 6528 7365 6c66 2c20 6576 7429 3a0d 0a0d  e(self, evt):...
-0007efa0: 0a20 2020 2020 2020 2051 7457 6964 6765  .        QtWidge
-0007efb0: 7473 2e51 4170 706c 6963 6174 696f 6e2e  ts.QApplication.
-0007efc0: 7365 744f 7665 7272 6964 6543 7572 736f  setOverrideCurso
-0007efd0: 7228 5174 4775 692e 5143 7572 736f 7228  r(QtGui.QCursor(
-0007efe0: 5174 2e57 6169 7443 7572 736f 7229 290d  Qt.WaitCursor)).
-0007eff0: 0a20 2020 2020 2020 2073 656c 662e 4361  .        self.Ca
-0007f000: 6c63 446f 7365 2829 0d0a 2020 2020 2020  lcDose()..      
-0007f010: 2020 5174 5769 6467 6574 732e 5141 7070    QtWidgets.QApp
-0007f020: 6c69 6361 7469 6f6e 2e72 6573 746f 7265  lication.restore
-0007f030: 4f76 6572 7269 6465 4375 7273 6f72 2829  OverrideCursor()
-0007f040: 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d  ......#---------
-0007f050: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007f060: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007f070: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007f080: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a63  -------------..c
-0007f090: 6c61 7373 2044 6172 6b53 6967 6e61 6c28  lass DarkSignal(
-0007f0a0: 5174 5769 6467 6574 732e 5144 6961 6c6f  QtWidgets.QDialo
-0007f0b0: 6729 3a0d 0a0d 0a20 2020 2064 6566 205f  g):....    def _
-0007f0c0: 5f69 6e69 745f 5f28 7365 6c66 2c20 7061  _init__(self, pa
-0007f0d0: 7265 6e74 2c20 636f 6d6d 6f6e 2c20 7374  rent, common, st
-0007f0e0: 6163 6b29 3a0d 0a20 2020 2020 2020 2051  ack):..        Q
-0007f0f0: 7457 6964 6765 7473 2e51 5769 6467 6574  tWidgets.QWidget
-0007f100: 2e5f 5f69 6e69 745f 5f28 7365 6c66 2c20  .__init__(self, 
-0007f110: 7061 7265 6e74 290d 0a0d 0a20 2020 2020  parent)....     
-0007f120: 2020 2073 656c 662e 7061 7265 6e74 203d     self.parent =
-0007f130: 2070 6172 656e 740d 0a0d 0a20 2020 2020   parent....     
-0007f140: 2020 2073 656c 662e 7374 6163 6b20 3d20     self.stack = 
-0007f150: 7374 6163 6b0d 0a20 2020 2020 2020 2073  stack..        s
-0007f160: 656c 662e 636f 6d20 3d20 636f 6d6d 6f6e  elf.com = common
-0007f170: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-0007f180: 2e72 6573 697a 6528 3330 302c 2031 3730  .resize(300, 170
-0007f190: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0007f1a0: 7365 7457 696e 646f 7754 6974 6c65 2827  setWindowTitle('
-0007f1b0: 4461 726b 2053 6967 6e61 6c20 436f 7272  Dark Signal Corr
-0007f1c0: 6563 7469 6f6e 2729 0d0a 0d0a 2020 2020  ection')....    
-0007f1d0: 2020 2020 7061 6c20 3d20 5174 4775 692e      pal = QtGui.
-0007f1e0: 5150 616c 6574 7465 2829 0d0a 2020 2020  QPalette()..    
-0007f1f0: 2020 2020 7365 6c66 2e73 6574 4175 746f      self.setAuto
-0007f200: 4669 6c6c 4261 636b 6772 6f75 6e64 2854  FillBackground(T
-0007f210: 7275 6529 0d0a 2020 2020 2020 2020 7061  rue)..        pa
-0007f220: 6c2e 7365 7443 6f6c 6f72 2851 7447 7569  l.setColor(QtGui
-0007f230: 2e51 5061 6c65 7474 652e 5769 6e64 6f77  .QPalette.Window
-0007f240: 2c51 7447 7569 2e51 436f 6c6f 7228 2777  ,QtGui.QColor('w
-0007f250: 6869 7465 2729 290d 0a20 2020 2020 2020  hite'))..       
-0007f260: 2073 656c 662e 7365 7450 616c 6574 7465   self.setPalette
-0007f270: 2870 616c 290d 0a0d 0a0d 0a20 2020 2020  (pal)......     
-0007f280: 2020 2076 626f 7874 6f70 203d 2051 7457     vboxtop = QtW
-0007f290: 6964 6765 7473 2e51 5642 6f78 4c61 796f  idgets.QVBoxLayo
-0007f2a0: 7574 2829 0d0a 0d0a 0d0a 2020 2020 2020  ut()......      
-0007f2b0: 2020 6772 6964 746f 7020 3d20 5174 5769    gridtop = QtWi
-0007f2c0: 6467 6574 732e 5147 7269 644c 6179 6f75  dgets.QGridLayou
-0007f2d0: 7428 290d 0a0d 0a0d 0a20 2020 2020 2020  t()......       
-0007f2e0: 2023 666f 6e74 6220 3d20 7778 2e53 7973   #fontb = wx.Sys
-0007f2f0: 7465 6d53 6574 7469 6e67 735f 4765 7446  temSettings_GetF
-0007f300: 6f6e 7428 7778 2e53 5953 5f44 4546 4155  ont(wx.SYS_DEFAU
-0007f310: 4c54 5f47 5549 5f46 4f4e 5429 0d0a 2020  LT_GUI_FONT)..  
-0007f320: 2020 2020 2020 2366 6f6e 7462 2e53 6574        #fontb.Set
-0007f330: 5765 6967 6874 2877 782e 424f 4c44 290d  Weight(wx.BOLD).
-0007f340: 0a0d 0a0d 0a20 2020 2020 2020 2073 7431  .....        st1
-0007f350: 203d 2051 7457 6964 6765 7473 2e51 4c61   = QtWidgets.QLa
-0007f360: 6265 6c28 7365 6c66 290d 0a20 2020 2020  bel(self)..     
-0007f370: 2020 2073 7431 2e73 6574 5465 7874 2827     st1.setText('
-0007f380: 4461 726b 2053 6967 6e61 6c20 5661 6c75  Dark Signal Valu
-0007f390: 653a 2729 0d0a 0d0a 0d0a 2020 2020 2020  e:')......      
-0007f3a0: 2020 7365 6c66 2e6e 7463 5f64 7320 3d20    self.ntc_ds = 
-0007f3b0: 5174 5769 6467 6574 732e 514c 696e 6545  QtWidgets.QLineE
-0007f3c0: 6469 7428 7365 6c66 290d 0a20 2020 2020  dit(self)..     
-0007f3d0: 2020 2073 656c 662e 6e74 635f 6473 2e73     self.ntc_ds.s
-0007f3e0: 6574 4669 7865 6457 6964 7468 2831 3530  etFixedWidth(150
-0007f3f0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0007f400: 6e74 635f 6473 2e73 6574 5661 6c69 6461  ntc_ds.setValida
-0007f410: 746f 7228 5174 4775 692e 5144 6f75 626c  tor(QtGui.QDoubl
-0007f420: 6556 616c 6964 6174 6f72 282d 3939 3939  eValidator(-9999
-0007f430: 392c 2039 3939 3939 2c20 322c 2073 656c  9, 99999, 2, sel
-0007f440: 6629 290d 0a20 2020 2020 2020 2073 656c  f))..        sel
-0007f450: 662e 6e74 635f 6473 2e73 6574 416c 6967  f.ntc_ds.setAlig
-0007f460: 6e6d 656e 7428 5174 436f 7265 2e51 742e  nment(QtCore.Qt.
-0007f470: 416c 6967 6e52 6967 6874 290d 0a0d 0a20  AlignRight).... 
-0007f480: 2020 2020 2020 2073 656c 662e 6e74 635f         self.ntc_
-0007f490: 6473 2e73 6574 5465 7874 2873 7472 2830  ds.setText(str(0
-0007f4a0: 2e30 2929 0d0a 0d0a 0d0a 2020 2020 2020  .0))......      
-0007f4b0: 2020 6772 6964 746f 702e 6164 6457 6964    gridtop.addWid
-0007f4c0: 6765 7428 7374 312c 2030 2c30 290d 0a20  get(st1, 0,0).. 
-0007f4d0: 2020 2020 2020 2067 7269 6474 6f70 2e61         gridtop.a
-0007f4e0: 6464 5769 6467 6574 2873 656c 662e 6e74  ddWidget(self.nt
-0007f4f0: 635f 6473 2c20 302c 3129 0d0a 0d0a 0d0a  c_ds, 0,1)......
-0007f500: 2020 2020 2020 2020 6275 7474 6f6e 5f64          button_d
-0007f510: 7363 616c 6320 3d20 5174 5769 6467 6574  scalc = QtWidget
-0007f520: 732e 5150 7573 6842 7574 746f 6e28 2753  s.QPushButton('S
-0007f530: 7562 7472 6163 7420 4461 726b 2053 6967  ubtract Dark Sig
-0007f540: 6e61 6c27 290d 0a20 2020 2020 2020 2062  nal')..        b
-0007f550: 7574 746f 6e5f 6473 6361 6c63 2e63 6c69  utton_dscalc.cli
-0007f560: 636b 6564 2e63 6f6e 6e65 6374 2873 656c  cked.connect(sel
-0007f570: 662e 4f6e 4453 4361 6c63 290d 0a0d 0a20  f.OnDSCalc).... 
-0007f580: 2020 2020 2020 2062 7574 746f 6e5f 6361         button_ca
-0007f590: 6e63 656c 203d 2051 7457 6964 6765 7473  ncel = QtWidgets
-0007f5a0: 2e51 5075 7368 4275 7474 6f6e 2827 4469  .QPushButton('Di
-0007f5b0: 736d 6973 7327 290d 0a20 2020 2020 2020  smiss')..       
-0007f5c0: 2062 7574 746f 6e5f 6361 6e63 656c 2e63   button_cancel.c
-0007f5d0: 6c69 636b 6564 2e63 6f6e 6e65 6374 2873  licked.connect(s
-0007f5e0: 656c 662e 636c 6f73 6529 0d0a 0d0a 0d0a  elf.close)......
-0007f5f0: 2020 2020 2020 2020 7662 6f78 746f 702e          vboxtop.
-0007f600: 6164 644c 6179 6f75 7428 6772 6964 746f  addLayout(gridto
-0007f610: 7029 0d0a 2020 2020 2020 2020 7662 6f78  p)..        vbox
-0007f620: 746f 702e 6164 6457 6964 6765 7428 6275  top.addWidget(bu
-0007f630: 7474 6f6e 5f64 7363 616c 6329 0d0a 2020  tton_dscalc)..  
-0007f640: 2020 2020 2020 7662 6f78 746f 702e 6164        vboxtop.ad
-0007f650: 6457 6964 6765 7428 6275 7474 6f6e 5f63  dWidget(button_c
-0007f660: 616e 6365 6c29 0d0a 0d0a 2020 2020 2020  ancel)....      
-0007f670: 2020 7365 6c66 2e73 6574 4c61 796f 7574    self.setLayout
-0007f680: 2876 626f 7874 6f70 290d 0a0d 0a0d 0a23  (vboxtop)......#
-0007f690: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007f6a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007f6b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007f6c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007f6d0: 2d2d 2d2d 2d2d 0d0a 2020 2020 6465 6620  ------..    def 
-0007f6e0: 4f6e 4453 4361 6c63 2873 656c 6629 3a0d  OnDSCalc(self):.
-0007f6f0: 0a0d 0a20 2020 2020 2020 2051 7457 6964  ...        QtWid
-0007f700: 6765 7473 2e51 4170 706c 6963 6174 696f  gets.QApplicatio
-0007f710: 6e2e 7365 744f 7665 7272 6964 6543 7572  n.setOverrideCur
-0007f720: 736f 7228 5174 4775 692e 5143 7572 736f  sor(QtGui.QCurso
-0007f730: 7228 5174 2e57 6169 7443 7572 736f 7229  r(Qt.WaitCursor)
-0007f740: 290d 0a0d 0a20 2020 2020 2020 2064 6172  )....        dar
-0007f750: 6b73 6967 203d 2030 2e30 0d0a 0d0a 2020  ksig = 0.0....  
-0007f760: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-0007f770: 2020 2020 2020 2020 7661 6c75 6520 3d20          value = 
-0007f780: 7365 6c66 2e6e 7463 5f64 732e 7465 7874  self.ntc_ds.text
-0007f790: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0007f7a0: 6461 726b 7369 6720 3d20 666c 6f61 7428  darksig = float(
-0007f7b0: 7661 6c75 6529 0d0a 2020 2020 2020 2020  value)..        
-0007f7c0: 6578 6365 7074 3a0d 0a20 2020 2020 2020  except:..       
-0007f7d0: 2020 2020 2051 7457 6964 6765 7473 2e51       QtWidgets.Q
-0007f7e0: 4170 706c 6963 6174 696f 6e2e 7265 7374  Application.rest
-0007f7f0: 6f72 654f 7665 7272 6964 6543 7572 736f  oreOverrideCurso
-0007f800: 7228 290d 0a20 2020 2020 2020 2020 2020  r()..           
-0007f810: 2051 7447 7569 2e51 4d65 7373 6167 6542   QtGui.QMessageB
-0007f820: 6f78 2e77 6172 6e69 6e67 2873 656c 662c  ox.warning(self,
-0007f830: 2027 4572 726f 7227 2c20 2750 6c65 6173   'Error', 'Pleas
-0007f840: 6520 656e 7465 7220 6e75 6d65 7269 6320  e enter numeric 
-0007f850: 6e75 6d62 6572 2066 6f72 2064 6172 6b20  number for dark 
-0007f860: 7369 676e 616c 2e27 290d 0a20 2020 2020  signal.')..     
-0007f870: 2020 2020 2020 2072 6574 7572 6e0d 0a0d         return...
-0007f880: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0007f890: 7374 6163 6b2e 6162 7364 6174 6120 3d20  stack.absdata = 
-0007f8a0: 7365 6c66 2e73 7461 636b 2e61 6273 6461  self.stack.absda
-0007f8b0: 7461 202d 2064 6172 6b73 6967 0d0a 0d0a  ta - darksig....
-0007f8c0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0007f8d0: 636f 6d2e 6930 5f6c 6f61 6465 6420 3d3d  com.i0_loaded ==
-0007f8e0: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
-0007f8f0: 2073 656c 662e 7374 6163 6b2e 6361 6c63   self.stack.calc
-0007f900: 756c 6174 655f 6f70 7469 6361 6c5f 6465  ulate_optical_de
-0007f910: 6e73 6974 7928 290d 0a0d 0a20 2020 2020  nsity()....     
-0007f920: 2020 2073 656c 662e 7374 6163 6b2e 6669     self.stack.fi
-0007f930: 6c6c 5f68 355f 7374 7275 6374 5f66 726f  ll_h5_struct_fro
-0007f940: 6d5f 7374 6b28 290d 0a20 2020 2020 2020  m_stk()..       
-0007f950: 2069 6620 7365 6c66 2e63 6f6d 2e69 305f   if self.com.i0_
-0007f960: 6c6f 6164 6564 203d 3d20 313a 0d0a 2020  loaded == 1:..  
-0007f970: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-0007f980: 7461 636b 2e66 696c 6c5f 6835 5f73 7472  tack.fill_h5_str
-0007f990: 7563 745f 6e6f 726d 616c 697a 6174 696f  uct_normalizatio
-0007f9a0: 6e28 290d 0a0d 0a0d 0a20 2020 2020 2020  n()......       
-0007f9b0: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
-0007f9c0: 6531 2e73 686f 7753 7065 6374 7275 6d28  e1.showSpectrum(
-0007f9d0: 7365 6c66 2e70 6172 656e 742e 7061 6765  self.parent.page
-0007f9e0: 312e 6978 2c20 7365 6c66 2e70 6172 656e  1.ix, self.paren
-0007f9f0: 742e 7061 6765 312e 6979 290d 0a20 2020  t.page1.iy)..   
-0007fa00: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
-0007fa10: 2e70 6167 6531 2e6c 6f61 6449 6d61 6765  .page1.loadImage
-0007fa20: 2829 0d0a 0d0a 0d0a 0d0a 2020 2020 2020  ()........      
-0007fa30: 2020 5174 5769 6467 6574 732e 5141 7070    QtWidgets.QApp
-0007fa40: 6c69 6361 7469 6f6e 2e72 6573 746f 7265  lication.restore
-0007fa50: 4f76 6572 7269 6465 4375 7273 6f72 2829  OverrideCursor()
-0007fa60: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-0007fa70: 2e63 6c6f 7365 2829 0d0a 0d0a 2020 2020  .close()....    
-0007fa80: 2020 2020 7265 7475 726e 0d0a 0d0a 0d0a      return......
-0007fa90: 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d  ....#-----------
-0007faa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007fab0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007fac0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0007fad0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a63 6c61  -----------..cla
-0007fae0: 7373 2050 6c6f 7446 7261 6d65 2851 7457  ss PlotFrame(QtW
-0007faf0: 6964 6765 7473 2e51 4469 616c 6f67 293a  idgets.QDialog):
-0007fb00: 0d0a 0d0a 2020 2020 6465 6620 5f5f 696e  ....    def __in
-0007fb10: 6974 5f5f 2873 656c 662c 2070 6172 656e  it__(self, paren
-0007fb20: 742c 2064 6174 6178 2c20 6461 7461 792c  t, datax, datay,
-0007fb30: 2074 6974 6c65 203d 2022 4930 2064 6174   title = "I0 dat
-0007fb40: 6122 293a 0d0a 2020 2020 2020 2020 5174  a"):..        Qt
-0007fb50: 5769 6467 6574 732e 5157 6964 6765 742e  Widgets.QWidget.
-0007fb60: 5f5f 696e 6974 5f5f 2873 656c 662c 2070  __init__(self, p
-0007fb70: 6172 656e 7429 0d0a 0d0a 2020 2020 2020  arent)....      
-0007fb80: 2020 7365 6c66 2e70 6172 656e 7420 3d20    self.parent = 
-0007fb90: 7061 7265 6e74 0d0a 0d0a 2020 2020 2020  parent....      
-0007fba0: 2020 7365 6c66 2e74 6974 6c65 203d 2074    self.title = t
-0007fbb0: 6974 6c65 0d0a 0d0a 2020 2020 2020 2020  itle....        
-0007fbc0: 7365 6c66 2e64 6174 6178 203d 2064 6174  self.datax = dat
-0007fbd0: 6178 0d0a 2020 2020 2020 2020 7365 6c66  ax..        self
-0007fbe0: 2e64 6174 6179 203d 2064 6174 6179 0d0a  .datay = datay..
-0007fbf0: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
-0007fc00: 6573 697a 6528 3633 302c 2035 3030 290d  esize(630, 500).
-0007fc10: 0a20 2020 2020 2020 2073 656c 662e 7365  .        self.se
-0007fc20: 7457 696e 646f 7754 6974 6c65 2874 6974  tWindowTitle(tit
-0007fc30: 6c65 290d 0a0d 0a20 2020 2020 2020 2070  le)....        p
-0007fc40: 616c 203d 2051 7447 7569 2e51 5061 6c65  al = QtGui.QPale
-0007fc50: 7474 6528 290d 0a20 2020 2020 2020 2073  tte()..        s
-0007fc60: 656c 662e 7365 7441 7574 6f46 696c 6c42  elf.setAutoFillB
-0007fc70: 6163 6b67 726f 756e 6428 5472 7565 290d  ackground(True).
-0007fc80: 0a20 2020 2020 2020 2070 616c 2e73 6574  .        pal.set
-0007fc90: 436f 6c6f 7228 5174 4775 692e 5150 616c  Color(QtGui.QPal
-0007fca0: 6574 7465 2e57 696e 646f 772c 5174 4775  ette.Window,QtGu
-0007fcb0: 692e 5143 6f6c 6f72 2827 7768 6974 6527  i.QColor('white'
-0007fcc0: 2929 0d0a 2020 2020 2020 2020 7365 6c66  ))..        self
-0007fcd0: 2e73 6574 5061 6c65 7474 6528 7061 6c29  .setPalette(pal)
-0007fce0: 0d0a 0d0a 0d0a 0d0a 2020 2020 2020 2020  ........        
-0007fcf0: 7662 6f78 203d 2051 7457 6964 6765 7473  vbox = QtWidgets
-0007fd00: 2e51 5642 6f78 4c61 796f 7574 2829 0d0a  .QVBoxLayout()..
-0007fd10: 0d0a 2020 2020 2020 2020 6672 616d 6520  ..        frame 
-0007fd20: 3d20 5174 5769 6467 6574 732e 5146 7261  = QtWidgets.QFra
-0007fd30: 6d65 2829 0d0a 2020 2020 2020 2020 6672  me()..        fr
-0007fd40: 616d 652e 7365 7446 7261 6d65 5374 796c  ame.setFrameStyl
-0007fd50: 6528 5174 5769 6467 6574 732e 5146 7261  e(QtWidgets.QFra
-0007fd60: 6d65 2e53 7479 6c65 6450 616e 656c 7c51  me.StyledPanel|Q
-0007fd70: 7457 6964 6765 7473 2e51 4672 616d 652e  tWidgets.QFrame.
-0007fd80: 5375 6e6b 656e 290d 0a20 2020 2020 2020  Sunken)..       
-0007fd90: 2066 626f 7820 3d20 5174 5769 6467 6574   fbox = QtWidget
-0007fda0: 732e 5148 426f 784c 6179 6f75 7428 290d  s.QHBoxLayout().
-0007fdb0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0007fdc0: 706c 6f74 6669 6720 3d20 4669 6775 7265  plotfig = Figure
-0007fdd0: 2828 362e 302c 2034 2e32 2929 0d0a 2020  ((6.0, 4.2))..  
-0007fde0: 2020 2020 2020 7365 6c66 2e50 6c6f 7450        self.PlotP
-0007fdf0: 616e 656c 203d 2046 6967 7572 6543 616e  anel = FigureCan
-0007fe00: 7661 7328 7365 6c66 2e70 6c6f 7466 6967  vas(self.plotfig
-0007fe10: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0007fe20: 506c 6f74 5061 6e65 6c2e 7365 7450 6172  PlotPanel.setPar
-0007fe30: 656e 7428 7365 6c66 290d 0a0d 0a20 2020  ent(self)....   
-0007fe40: 2020 2020 2066 626f 782e 6164 6457 6964       fbox.addWid
-0007fe50: 6765 7428 7365 6c66 2e50 6c6f 7450 616e  get(self.PlotPan
-0007fe60: 656c 290d 0a20 2020 2020 2020 2066 7261  el)..        fra
-0007fe70: 6d65 2e73 6574 4c61 796f 7574 2866 626f  me.setLayout(fbo
-0007fe80: 7829 0d0a 2020 2020 2020 2020 7662 6f78  x)..        vbox
-0007fe90: 2e61 6464 5769 6467 6574 2866 7261 6d65  .addWidget(frame
-0007fea0: 290d 0a0d 0a0d 0a20 2020 2020 2020 2068  )......        h
-0007feb0: 626f 7820 3d20 5174 5769 6467 6574 732e  box = QtWidgets.
-0007fec0: 5148 426f 784c 6179 6f75 7428 290d 0a0d  QHBoxLayout()...
-0007fed0: 0a20 2020 2020 2020 2062 7574 746f 6e5f  .        button_
-0007fee0: 7361 7665 203d 2051 7457 6964 6765 7473  save = QtWidgets
-0007fef0: 2e51 5075 7368 4275 7474 6f6e 2827 5361  .QPushButton('Sa
-0007ff00: 7665 2053 7065 6374 7275 6d27 290d 0a20  ve Spectrum').. 
-0007ff10: 2020 2020 2020 2062 7574 746f 6e5f 7361         button_sa
-0007ff20: 7665 2e63 6c69 636b 6564 2e63 6f6e 6e65  ve.clicked.conne
-0007ff30: 6374 2873 656c 662e 4f6e 5361 7665 290d  ct(self.OnSave).
-0007ff40: 0a20 2020 2020 2020 2068 626f 782e 6164  .        hbox.ad
-0007ff50: 6457 6964 6765 7428 6275 7474 6f6e 5f73  dWidget(button_s
-0007ff60: 6176 6529 0d0a 0d0a 2020 2020 2020 2020  ave)....        
-0007ff70: 6275 7474 6f6e 5f63 6c6f 7365 203d 2051  button_close = Q
-0007ff80: 7457 6964 6765 7473 2e51 5075 7368 4275  tWidgets.QPushBu
-0007ff90: 7474 6f6e 2827 436c 6f73 6527 290d 0a20  tton('Close').. 
-0007ffa0: 2020 2020 2020 2062 7574 746f 6e5f 636c         button_cl
-0007ffb0: 6f73 652e 636c 6963 6b65 642e 636f 6e6e  ose.clicked.conn
-0007ffc0: 6563 7428 7365 6c66 2e63 6c6f 7365 290d  ect(self.close).
-0007ffd0: 0a20 2020 2020 2020 2068 626f 782e 6164  .        hbox.ad
-0007ffe0: 6457 6964 6765 7428 6275 7474 6f6e 5f63  dWidget(button_c
-0007fff0: 6c6f 7365 290d 0a0d 0a20 2020 2020 2020  lose)....       
-00080000: 2076 626f 782e 6164 644c 6179 6f75 7428   vbox.addLayout(
-00080010: 6862 6f78 290d 0a0d 0a20 2020 2020 2020  hbox)....       
-00080020: 2073 656c 662e 7365 744c 6179 6f75 7428   self.setLayout(
-00080030: 7662 6f78 290d 0a0d 0a0d 0a20 2020 2020  vbox)......     
-00080040: 2020 2073 656c 662e 6472 6177 5f70 6c6f     self.draw_plo
-00080050: 7428 6461 7461 782c 6461 7461 7929 0d0a  t(datax,datay)..
-00080060: 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d  ....#-----------
-00080070: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00080080: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00080090: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000800a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020  -----------..   
-000800b0: 2064 6566 2064 7261 775f 706c 6f74 2873   def draw_plot(s
-000800c0: 656c 662c 2064 6174 6178 2c20 6461 7461  elf, datax, data
-000800d0: 7929 3a0d 0a0d 0a0d 0a20 2020 2020 2020  y):......       
-000800e0: 2066 6967 203d 2073 656c 662e 706c 6f74   fig = self.plot
-000800f0: 6669 670d 0a20 2020 2020 2020 2066 6967  fig..        fig
-00080100: 2e63 6c66 2829 0d0a 2020 2020 2020 2020  .clf()..        
-00080110: 6669 672e 6164 645f 6178 6573 2828 302e  fig.add_axes((0.
-00080120: 3135 2c30 2e31 352c 302e 3735 2c30 2e37  15,0.15,0.75,0.7
-00080130: 3529 290d 0a20 2020 2020 2020 2073 656c  5))..        sel
-00080140: 662e 6178 6573 203d 2066 6967 2e67 6361  f.axes = fig.gca
-00080150: 2829 0d0a 0d0a 0d0a 2020 2020 2020 2020  ()......        
-00080160: 706c 6f74 203d 2073 656c 662e 6178 6573  plot = self.axes
-00080170: 2e70 6c6f 7428 6461 7461 782c 6461 7461  .plot(datax,data
-00080180: 7929 0d0a 0d0a 2020 2020 2020 2020 7365  y)....        se
-00080190: 6c66 2e61 7865 732e 7365 745f 786c 6162  lf.axes.set_xlab
-000801a0: 656c 2827 5068 6f74 6f6e 2045 6e65 7267  el('Photon Energ
-000801b0: 7920 5b65 565d 2729 0d0a 2020 2020 2020  y [eV]')..      
-000801c0: 2020 7365 6c66 2e61 7865 732e 7365 745f    self.axes.set_
-000801d0: 796c 6162 656c 2827 4930 2046 6c75 7827  ylabel('I0 Flux'
-000801e0: 290d 0a0d 0a0d 0a0d 0a20 2020 2020 2020  )........       
-000801f0: 2073 656c 662e 506c 6f74 5061 6e65 6c2e   self.PlotPanel.
-00080200: 6472 6177 2829 0d0a 0d0a 232d 2d2d 2d2d  draw()....#-----
-00080210: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00080220: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00080230: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00080240: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00080250: 2d0d 0a20 2020 2064 6566 204f 6e53 6176  -..    def OnSav
-00080260: 6528 7365 6c66 2c20 6576 656e 7429 3a0d  e(self, event):.
-00080270: 0a0d 0a0d 0a20 2020 2020 2020 2074 7279  .....        try
-00080280: 3a0d 0a20 2020 2020 2020 2020 2020 2077  :..            w
-00080290: 696c 6463 6172 6420 3d20 2243 5356 2066  ildcard = "CSV f
-000802a0: 696c 6573 2028 2a2e 6373 7629 220d 0a0d  iles (*.csv)"...
-000802b0: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-000802c0: 6570 6174 682c 205f 6669 6c74 6572 203d  epath, _filter =
-000802d0: 2051 7457 6964 6765 7473 2e51 4669 6c65   QtWidgets.QFile
-000802e0: 4469 616c 6f67 2e67 6574 5361 7665 4669  Dialog.getSaveFi
-000802f0: 6c65 4e61 6d65 2873 656c 662c 2027 5361  leName(self, 'Sa
-00080300: 7665 2070 6c6f 7420 6173 202e 6373 7620  ve plot as .csv 
-00080310: 282e 6373 7629 272c 2027 272c 2077 696c  (.csv)', '', wil
-00080320: 6463 6172 6429 0d0a 0d0a 2020 2020 2020  dcard)....      
-00080330: 2020 2020 2020 6669 6c65 7061 7468 203d        filepath =
-00080340: 2073 7472 2866 696c 6570 6174 6829 0d0a   str(filepath)..
-00080350: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-00080360: 696c 6570 6174 6820 3d3d 2027 273a 0d0a  ilepath == '':..
-00080370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00080380: 7265 7475 726e 0d0a 0d0a 0d0a 2020 2020  return......    
-00080390: 2020 2020 2020 2020 5174 5769 6467 6574          QtWidget
-000803a0: 732e 5141 7070 6c69 6361 7469 6f6e 2e73  s.QApplication.s
-000803b0: 6574 4f76 6572 7269 6465 4375 7273 6f72  etOverrideCursor
-000803c0: 2851 7447 7569 2e51 4375 7273 6f72 2851  (QtGui.QCursor(Q
-000803d0: 742e 5761 6974 4375 7273 6f72 2929 0d0a  t.WaitCursor))..
-000803e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000803f0: 2e53 6176 6528 6669 6c65 7061 7468 290d  .Save(filepath).
-00080400: 0a20 2020 2020 2020 2020 2020 2051 7457  .            QtW
-00080410: 6964 6765 7473 2e51 4170 706c 6963 6174  idgets.QApplicat
-00080420: 696f 6e2e 7265 7374 6f72 654f 7665 7272  ion.restoreOverr
-00080430: 6964 6543 7572 736f 7228 290d 0a0d 0a20  ideCursor().... 
-00080440: 2020 2020 2020 2065 7863 6570 743a 0d0a         except:..
-00080450: 0d0a 2020 2020 2020 2020 2020 2020 5174  ..            Qt
-00080460: 5769 6467 6574 732e 5141 7070 6c69 6361  Widgets.QApplica
-00080470: 7469 6f6e 2e72 6573 746f 7265 4f76 6572  tion.restoreOver
-00080480: 7269 6465 4375 7273 6f72 2829 0d0a 2020  rideCursor()..  
-00080490: 2020 2020 2020 2020 2020 5174 4775 692e            QtGui.
-000804a0: 514d 6573 7361 6765 426f 782e 7761 726e  QMessageBox.warn
-000804b0: 696e 6728 7365 6c66 2c20 2745 7272 6f72  ing(self, 'Error
-000804c0: 272c 2022 436f 756c 6420 6e6f 7420 7361  ', "Could not sa
-000804d0: 7665 202e 6373 7620 6669 6c65 2e22 290d  ve .csv file.").
-000804e0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-000804f0: 636c 6f73 6528 290d 0a0d 0a0d 0a20 2020  close()......   
-00080500: 2020 2020 2072 6574 7572 6e0d 0a0d 0a23       return....#
-00080510: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00080520: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00080530: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00080540: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00080550: 2d2d 2d2d 2d2d 0d0a 2020 2020 6465 6620  ------..    def 
-00080560: 5361 7665 2873 656c 662c 2066 696c 656e  Save(self, filen
-00080570: 616d 6529 3a0d 0a0d 0a20 2020 2020 2020  ame):....       
-00080580: 2066 203d 206f 7065 6e28 6669 6c65 6e61   f = open(filena
-00080590: 6d65 2c20 2777 2729 0d0a 2020 2020 2020  me, 'w')..      
-000805a0: 2020 7072 696e 7428 272a 2a2a 2a2a 2a2a    print('*******
-000805b0: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2020  **************  
-000805c0: 582d 7261 7920 4162 736f 7270 7469 6f6e  X-ray Absorption
-000805d0: 2044 6174 6120 202a 2a2a 2a2a 2a2a 2a2a   Data  *********
-000805e0: 2a2a 2a2a 2a2a 2a2a 2a2a 2a27 2c20 6669  ***********', fi
-000805f0: 6c65 3d66 290d 0a20 2020 2020 2020 2070  le=f)..        p
-00080600: 7269 6e74 2827 2a27 2c20 6669 6c65 3d66  rint('*', file=f
-00080610: 290d 0a20 2020 2020 2020 2070 7269 6e74  )..        print
-00080620: 2827 2a20 466f 726d 756c 613a 2027 2c20  ('* Formula: ', 
-00080630: 6669 6c65 3d66 290d 0a20 2020 2020 2020  file=f)..       
-00080640: 2070 7269 6e74 2827 2a20 436f 6d6d 6f6e   print('* Common
-00080650: 206e 616d 653a 2027 2c20 7365 6c66 2e74   name: ', self.t
-00080660: 6974 6c65 2c20 6669 6c65 3d66 290d 0a20  itle, file=f).. 
-00080670: 2020 2020 2020 2070 7269 6e74 2827 2a20         print('* 
-00080680: 4564 6765 3a20 272c 2066 696c 653d 6629  Edge: ', file=f)
-00080690: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
-000806a0: 272a 2041 6371 7569 7369 7469 6f6e 206d  '* Acquisition m
-000806b0: 6f64 653a 2027 2c20 6669 6c65 3d66 290d  ode: ', file=f).
+0007e8d0: 6574 2873 7432 2c20 312c 3029 0d0a 2020  et(st2, 1,0)..  
+0007e8e0: 2020 2020 2020 6772 6964 746f 702e 6164        gridtop.ad
+0007e8f0: 6457 6964 6765 7428 2073 656c 662e 7463  dWidget( self.tc
+0007e900: 5f32 2c20 312c 3129 0d0a 2320 2020 2020  _2, 1,1)..#     
+0007e910: 2020 2067 7269 6474 6f70 2e61 6464 5769     gridtop.addWi
+0007e920: 6467 6574 2873 7433 2c20 3029 0d0a 2320  dget(st3, 0)..# 
+0007e930: 2020 2020 2020 2067 7269 6474 6f70 2e61         gridtop.a
+0007e940: 6464 5769 6467 6574 2820 7365 6c66 2e74  ddWidget( self.t
+0007e950: 635f 332c 2030 290d 0a20 2020 2020 2020  c_3, 0)..       
+0007e960: 2067 7269 6474 6f70 2e61 6464 5769 6467   gridtop.addWidg
+0007e970: 6574 2873 7434 2c20 322c 3029 0d0a 2020  et(st4, 2,0)..  
+0007e980: 2020 2020 2020 6772 6964 746f 702e 6164        gridtop.ad
+0007e990: 6457 6964 6765 7428 2073 656c 662e 7463  dWidget( self.tc
+0007e9a0: 5f34 2c20 322c 3129 0d0a 0d0a 0d0a 0d0a  _4, 2,1)........
+0007e9b0: 2020 2020 2020 2020 6275 7474 6f6e 5f63          button_c
+0007e9c0: 616c 6364 6f73 6520 3d20 5174 5769 6467  alcdose = QtWidg
+0007e9d0: 6574 732e 5150 7573 6842 7574 746f 6e28  ets.QPushButton(
+0007e9e0: 2743 616c 6375 6c61 7465 2044 6f73 6527  'Calculate Dose'
+0007e9f0: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
+0007ea00: 6e5f 6361 6c63 646f 7365 2e63 6c69 636b  n_calcdose.click
+0007ea10: 6564 2e63 6f6e 6e65 6374 2873 656c 662e  ed.connect(self.
+0007ea20: 4f6e 4361 6c63 446f 7365 290d 0a0d 0a20  OnCalcDose).... 
+0007ea30: 2020 2020 2020 2062 7574 746f 6e5f 6361         button_ca
+0007ea40: 6e63 656c 203d 2051 7457 6964 6765 7473  ncel = QtWidgets
+0007ea50: 2e51 5075 7368 4275 7474 6f6e 2827 4469  .QPushButton('Di
+0007ea60: 736d 6973 7327 290d 0a20 2020 2020 2020  smiss')..       
+0007ea70: 2062 7574 746f 6e5f 6361 6e63 656c 2e63   button_cancel.c
+0007ea80: 6c69 636b 6564 2e63 6f6e 6e65 6374 2873  licked.connect(s
+0007ea90: 656c 662e 636c 6f73 6529 0d0a 0d0a 0d0a  elf.close)......
+0007eaa0: 2020 2020 2020 2020 7662 6f78 746f 702e          vboxtop.
+0007eab0: 6164 644c 6179 6f75 7428 6772 6964 746f  addLayout(gridto
+0007eac0: 7029 0d0a 2020 2020 2020 2020 7662 6f78  p)..        vbox
+0007ead0: 746f 702e 6164 6457 6964 6765 7428 6275  top.addWidget(bu
+0007eae0: 7474 6f6e 5f63 616c 6364 6f73 6529 0d0a  tton_calcdose)..
+0007eaf0: 2020 2020 2020 2020 7662 6f78 746f 702e          vboxtop.
+0007eb00: 6164 6457 6964 6765 7428 6275 7474 6f6e  addWidget(button
+0007eb10: 5f63 616e 6365 6c29 0d0a 0d0a 2020 2020  _cancel)....    
+0007eb20: 2020 2020 7365 6c66 2e73 6574 4c61 796f      self.setLayo
+0007eb30: 7574 2876 626f 7874 6f70 290d 0a0d 0a0d  ut(vboxtop).....
+0007eb40: 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  .#--------------
+0007eb50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007eb60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007eb70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007eb80: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 6465  --------..    de
+0007eb90: 6620 4361 6c63 446f 7365 2873 656c 6629  f CalcDose(self)
+0007eba0: 3a0d 0a0d 0a0d 0a20 2020 2020 2020 2074  :......        t
+0007ebb0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+0007ebc0: 2064 6574 6563 746f 725f 6566 6620 3d20   detector_eff = 
+0007ebd0: 302e 3031 2a66 6c6f 6174 2873 656c 662e  0.01*float(self.
+0007ebe0: 7463 5f31 2e74 6578 7428 2929 0d0a 2020  tc_1.text())..  
+0007ebf0: 2020 2020 2020 6578 6365 7074 3a0d 0a20        except:.. 
+0007ec00: 2020 2020 2020 2020 2020 2051 7447 7569             QtGui
+0007ec10: 2e51 4d65 7373 6167 6542 6f78 2e77 6172  .QMessageBox.war
+0007ec20: 6e69 6e67 2873 656c 662c 2027 4572 726f  ning(self, 'Erro
+0007ec30: 7227 2c20 2750 6c65 6173 6520 656e 7465  r', 'Please ente
+0007ec40: 7220 6e75 6d65 7269 6320 6e75 6d62 6572  r numeric number
+0007ec50: 2066 6f72 2064 6574 6563 746f 7220 6566   for detector ef
+0007ec60: 6669 6369 656e 6379 2e27 290d 0a20 2020  ficiency.')..   
+0007ec70: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0007ec80: 506c 6561 7365 2065 6e74 6572 206e 756d  Please enter num
+0007ec90: 6572 6963 206e 756d 6265 7220 666f 7220  eric number for 
+0007eca0: 6465 7465 6374 6f72 2065 6666 6963 6965  detector efficie
+0007ecb0: 6e63 792e 2729 0d0a 2020 2020 2020 2020  ncy.')..        
+0007ecc0: 2020 2020 7265 7475 726e 0d0a 0d0a 0d0a      return......
+0007ecd0: 2020 2020 2020 2020 695f 636f 6d70 6f73          i_compos
+0007ece0: 6974 696f 6e20 3d20 7374 7228 7365 6c66  ition = str(self
+0007ecf0: 2e74 635f 322e 7465 7874 2829 290d 0a0d  .tc_2.text())...
+0007ed00: 0a20 2020 2020 2020 2064 6f73 6520 3d20  .        dose = 
+0007ed10: 302e 0d0a 0d0a 2020 2020 2020 2020 4368  0.....        Ch
+0007ed20: 656e 6b65 203d 2068 656e 6b65 2e68 656e  enke = henke.hen
+0007ed30: 6b65 2829 0d0a 0d0a 2020 2020 2020 2020  ke()....        
+0007ed40: 2343 6865 636b 2069 6620 636f 6d70 6f73  #Check if compos
+0007ed50: 6974 696f 6e20 6172 7261 7920 6973 2072  ition array is r
+0007ed60: 6563 6f67 6e69 7a61 626c 650d 0a20 2020  ecognizable..   
+0007ed70: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+0007ed80: 2020 2020 2020 207a 5f61 7272 6179 2c20         z_array, 
+0007ed90: 6174 7774 203d 2043 6865 6e6b 652e 636f  atwt = Chenke.co
+0007eda0: 6d70 6f75 6e64 2869 5f63 6f6d 706f 7369  mpound(i_composi
+0007edb0: 7469 6f6e 2c31 2e30 290d 0a20 2020 2020  tion,1.0)..     
+0007edc0: 2020 2065 7863 6570 743a 0d0a 2020 2020     except:..    
+0007edd0: 2020 2020 2020 2020 5174 4775 692e 514d          QtGui.QM
+0007ede0: 6573 7361 6765 426f 782e 7761 726e 696e  essageBox.warnin
+0007edf0: 6728 7365 6c66 2c20 2745 7272 6f72 272c  g(self, 'Error',
+0007ee00: 2022 506c 6561 7365 2065 6e74 6572 206e   "Please enter n
+0007ee10: 6577 2063 6f6d 706f 756e 642e 2229 0d0a  ew compound.")..
+0007ee20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0007ee30: 726e 0d0a 0d0a 2020 2020 2020 2020 7472  rn....        tr
+0007ee40: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+0007ee50: 646f 7365 203d 2043 6865 6e6b 652e 646f  dose = Chenke.do
+0007ee60: 7365 5f63 616c 6328 7365 6c66 2e73 7461  se_calc(self.sta
+0007ee70: 636b 2c20 695f 636f 6d70 6f73 6974 696f  ck, i_compositio
+0007ee80: 6e2c 2073 656c 662e 524f 4973 7065 6374  n, self.ROIspect
+0007ee90: 7275 6d2c 2073 656c 662e 7374 6163 6b2e  rum, self.stack.
+0007eea0: 6930 6461 7461 2c20 6465 7465 6374 6f72  i0data, detector
+0007eeb0: 5f65 6666 290d 0a20 2020 2020 2020 2065  _eff)..        e
+0007eec0: 7863 6570 743a 0d0a 2020 2020 2020 2020  xcept:..        
+0007eed0: 2020 2020 5174 4775 692e 514d 6573 7361      QtGui.QMessa
+0007eee0: 6765 426f 782e 7761 726e 696e 6728 7365  geBox.warning(se
+0007eef0: 6c66 2c20 2745 7272 6f72 272c 2022 436f  lf, 'Error', "Co
+0007ef00: 756c 6420 6e6f 7420 6361 6c63 756c 6174  uld not calculat
+0007ef10: 6520 646f 7365 2e20 506c 6561 7365 2065  e dose. Please e
+0007ef20: 6e74 6572 206e 6577 2063 6f6d 706f 756e  nter new compoun
+0007ef30: 642e 2229 0d0a 2020 2020 2020 2020 2020  d.")..          
+0007ef40: 2020 7265 7475 726e 0d0a 0d0a 2020 2020    return....    
+0007ef50: 2020 2020 7365 6c66 2e74 635f 342e 7365      self.tc_4.se
+0007ef60: 7454 6578 7428 7374 7228 646f 7365 2929  tText(str(dose))
+0007ef70: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
+0007ef80: 726e 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d  rn......#-------
+0007ef90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007efa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007efb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007efc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
+0007efd0: 0a20 2020 2064 6566 204f 6e43 616c 6344  .    def OnCalcD
+0007efe0: 6f73 6528 7365 6c66 2c20 6576 7429 3a0d  ose(self, evt):.
+0007eff0: 0a0d 0a20 2020 2020 2020 2051 7457 6964  ...        QtWid
+0007f000: 6765 7473 2e51 4170 706c 6963 6174 696f  gets.QApplicatio
+0007f010: 6e2e 7365 744f 7665 7272 6964 6543 7572  n.setOverrideCur
+0007f020: 736f 7228 5174 4775 692e 5143 7572 736f  sor(QtGui.QCurso
+0007f030: 7228 5174 2e57 6169 7443 7572 736f 7229  r(Qt.WaitCursor)
+0007f040: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0007f050: 4361 6c63 446f 7365 2829 0d0a 2020 2020  CalcDose()..    
+0007f060: 2020 2020 5174 5769 6467 6574 732e 5141      QtWidgets.QA
+0007f070: 7070 6c69 6361 7469 6f6e 2e72 6573 746f  pplication.resto
+0007f080: 7265 4f76 6572 7269 6465 4375 7273 6f72  reOverrideCursor
+0007f090: 2829 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d  ()......#-------
+0007f0a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007f0b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007f0c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007f0d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
+0007f0e0: 0a63 6c61 7373 2044 6172 6b53 6967 6e61  .class DarkSigna
+0007f0f0: 6c28 5174 5769 6467 6574 732e 5144 6961  l(QtWidgets.QDia
+0007f100: 6c6f 6729 3a0d 0a0d 0a20 2020 2064 6566  log):....    def
+0007f110: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+0007f120: 7061 7265 6e74 2c20 636f 6d6d 6f6e 2c20  parent, common, 
+0007f130: 7374 6163 6b29 3a0d 0a20 2020 2020 2020  stack):..       
+0007f140: 2051 7457 6964 6765 7473 2e51 5769 6467   QtWidgets.QWidg
+0007f150: 6574 2e5f 5f69 6e69 745f 5f28 7365 6c66  et.__init__(self
+0007f160: 2c20 7061 7265 6e74 290d 0a0d 0a20 2020  , parent)....   
+0007f170: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
+0007f180: 203d 2070 6172 656e 740d 0a0d 0a20 2020   = parent....   
+0007f190: 2020 2020 2073 656c 662e 7374 6163 6b20       self.stack 
+0007f1a0: 3d20 7374 6163 6b0d 0a20 2020 2020 2020  = stack..       
+0007f1b0: 2073 656c 662e 636f 6d20 3d20 636f 6d6d   self.com = comm
+0007f1c0: 6f6e 0d0a 0d0a 2020 2020 2020 2020 7365  on....        se
+0007f1d0: 6c66 2e72 6573 697a 6528 3330 302c 2031  lf.resize(300, 1
+0007f1e0: 3730 290d 0a20 2020 2020 2020 2073 656c  70)..        sel
+0007f1f0: 662e 7365 7457 696e 646f 7754 6974 6c65  f.setWindowTitle
+0007f200: 2827 4461 726b 2053 6967 6e61 6c20 436f  ('Dark Signal Co
+0007f210: 7272 6563 7469 6f6e 2729 0d0a 0d0a 2020  rrection')....  
+0007f220: 2020 2020 2020 7061 6c20 3d20 5174 4775        pal = QtGu
+0007f230: 692e 5150 616c 6574 7465 2829 0d0a 2020  i.QPalette()..  
+0007f240: 2020 2020 2020 7365 6c66 2e73 6574 4175        self.setAu
+0007f250: 746f 4669 6c6c 4261 636b 6772 6f75 6e64  toFillBackground
+0007f260: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
+0007f270: 7061 6c2e 7365 7443 6f6c 6f72 2851 7447  pal.setColor(QtG
+0007f280: 7569 2e51 5061 6c65 7474 652e 5769 6e64  ui.QPalette.Wind
+0007f290: 6f77 2c51 7447 7569 2e51 436f 6c6f 7228  ow,QtGui.QColor(
+0007f2a0: 2777 6869 7465 2729 290d 0a20 2020 2020  'white'))..     
+0007f2b0: 2020 2073 656c 662e 7365 7450 616c 6574     self.setPalet
+0007f2c0: 7465 2870 616c 290d 0a0d 0a0d 0a20 2020  te(pal)......   
+0007f2d0: 2020 2020 2076 626f 7874 6f70 203d 2051       vboxtop = Q
+0007f2e0: 7457 6964 6765 7473 2e51 5642 6f78 4c61  tWidgets.QVBoxLa
+0007f2f0: 796f 7574 2829 0d0a 0d0a 0d0a 2020 2020  yout()......    
+0007f300: 2020 2020 6772 6964 746f 7020 3d20 5174      gridtop = Qt
+0007f310: 5769 6467 6574 732e 5147 7269 644c 6179  Widgets.QGridLay
+0007f320: 6f75 7428 290d 0a0d 0a0d 0a20 2020 2020  out()......     
+0007f330: 2020 2023 666f 6e74 6220 3d20 7778 2e53     #fontb = wx.S
+0007f340: 7973 7465 6d53 6574 7469 6e67 735f 4765  ystemSettings_Ge
+0007f350: 7446 6f6e 7428 7778 2e53 5953 5f44 4546  tFont(wx.SYS_DEF
+0007f360: 4155 4c54 5f47 5549 5f46 4f4e 5429 0d0a  AULT_GUI_FONT)..
+0007f370: 2020 2020 2020 2020 2366 6f6e 7462 2e53          #fontb.S
+0007f380: 6574 5765 6967 6874 2877 782e 424f 4c44  etWeight(wx.BOLD
+0007f390: 290d 0a0d 0a0d 0a20 2020 2020 2020 2073  )......        s
+0007f3a0: 7431 203d 2051 7457 6964 6765 7473 2e51  t1 = QtWidgets.Q
+0007f3b0: 4c61 6265 6c28 7365 6c66 290d 0a20 2020  Label(self)..   
+0007f3c0: 2020 2020 2073 7431 2e73 6574 5465 7874       st1.setText
+0007f3d0: 2827 4461 726b 2053 6967 6e61 6c20 5661  ('Dark Signal Va
+0007f3e0: 6c75 653a 2729 0d0a 0d0a 0d0a 2020 2020  lue:')......    
+0007f3f0: 2020 2020 7365 6c66 2e6e 7463 5f64 7320      self.ntc_ds 
+0007f400: 3d20 5174 5769 6467 6574 732e 514c 696e  = QtWidgets.QLin
+0007f410: 6545 6469 7428 7365 6c66 290d 0a20 2020  eEdit(self)..   
+0007f420: 2020 2020 2073 656c 662e 6e74 635f 6473       self.ntc_ds
+0007f430: 2e73 6574 4669 7865 6457 6964 7468 2831  .setFixedWidth(1
+0007f440: 3530 290d 0a20 2020 2020 2020 2073 656c  50)..        sel
+0007f450: 662e 6e74 635f 6473 2e73 6574 5661 6c69  f.ntc_ds.setVali
+0007f460: 6461 746f 7228 5174 4775 692e 5144 6f75  dator(QtGui.QDou
+0007f470: 626c 6556 616c 6964 6174 6f72 282d 3939  bleValidator(-99
+0007f480: 3939 392c 2039 3939 3939 2c20 322c 2073  999, 99999, 2, s
+0007f490: 656c 6629 290d 0a20 2020 2020 2020 2073  elf))..        s
+0007f4a0: 656c 662e 6e74 635f 6473 2e73 6574 416c  elf.ntc_ds.setAl
+0007f4b0: 6967 6e6d 656e 7428 5174 436f 7265 2e51  ignment(QtCore.Q
+0007f4c0: 742e 416c 6967 6e52 6967 6874 290d 0a0d  t.AlignRight)...
+0007f4d0: 0a20 2020 2020 2020 2073 656c 662e 6e74  .        self.nt
+0007f4e0: 635f 6473 2e73 6574 5465 7874 2873 7472  c_ds.setText(str
+0007f4f0: 2830 2e30 2929 0d0a 0d0a 0d0a 2020 2020  (0.0))......    
+0007f500: 2020 2020 6772 6964 746f 702e 6164 6457      gridtop.addW
+0007f510: 6964 6765 7428 7374 312c 2030 2c30 290d  idget(st1, 0,0).
+0007f520: 0a20 2020 2020 2020 2067 7269 6474 6f70  .        gridtop
+0007f530: 2e61 6464 5769 6467 6574 2873 656c 662e  .addWidget(self.
+0007f540: 6e74 635f 6473 2c20 302c 3129 0d0a 0d0a  ntc_ds, 0,1)....
+0007f550: 0d0a 2020 2020 2020 2020 6275 7474 6f6e  ..        button
+0007f560: 5f64 7363 616c 6320 3d20 5174 5769 6467  _dscalc = QtWidg
+0007f570: 6574 732e 5150 7573 6842 7574 746f 6e28  ets.QPushButton(
+0007f580: 2753 7562 7472 6163 7420 4461 726b 2053  'Subtract Dark S
+0007f590: 6967 6e61 6c27 290d 0a20 2020 2020 2020  ignal')..       
+0007f5a0: 2062 7574 746f 6e5f 6473 6361 6c63 2e63   button_dscalc.c
+0007f5b0: 6c69 636b 6564 2e63 6f6e 6e65 6374 2873  licked.connect(s
+0007f5c0: 656c 662e 4f6e 4453 4361 6c63 290d 0a0d  elf.OnDSCalc)...
+0007f5d0: 0a20 2020 2020 2020 2062 7574 746f 6e5f  .        button_
+0007f5e0: 6361 6e63 656c 203d 2051 7457 6964 6765  cancel = QtWidge
+0007f5f0: 7473 2e51 5075 7368 4275 7474 6f6e 2827  ts.QPushButton('
+0007f600: 4469 736d 6973 7327 290d 0a20 2020 2020  Dismiss')..     
+0007f610: 2020 2062 7574 746f 6e5f 6361 6e63 656c     button_cancel
+0007f620: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
+0007f630: 2873 656c 662e 636c 6f73 6529 0d0a 0d0a  (self.close)....
+0007f640: 0d0a 2020 2020 2020 2020 7662 6f78 746f  ..        vboxto
+0007f650: 702e 6164 644c 6179 6f75 7428 6772 6964  p.addLayout(grid
+0007f660: 746f 7029 0d0a 2020 2020 2020 2020 7662  top)..        vb
+0007f670: 6f78 746f 702e 6164 6457 6964 6765 7428  oxtop.addWidget(
+0007f680: 6275 7474 6f6e 5f64 7363 616c 6329 0d0a  button_dscalc)..
+0007f690: 2020 2020 2020 2020 7662 6f78 746f 702e          vboxtop.
+0007f6a0: 6164 6457 6964 6765 7428 6275 7474 6f6e  addWidget(button
+0007f6b0: 5f63 616e 6365 6c29 0d0a 0d0a 2020 2020  _cancel)....    
+0007f6c0: 2020 2020 7365 6c66 2e73 6574 4c61 796f      self.setLayo
+0007f6d0: 7574 2876 626f 7874 6f70 290d 0a0d 0a0d  ut(vboxtop).....
+0007f6e0: 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  .#--------------
+0007f6f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007f700: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007f710: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007f720: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 6465  --------..    de
+0007f730: 6620 4f6e 4453 4361 6c63 2873 656c 6629  f OnDSCalc(self)
+0007f740: 3a0d 0a0d 0a20 2020 2020 2020 2051 7457  :....        QtW
+0007f750: 6964 6765 7473 2e51 4170 706c 6963 6174  idgets.QApplicat
+0007f760: 696f 6e2e 7365 744f 7665 7272 6964 6543  ion.setOverrideC
+0007f770: 7572 736f 7228 5174 4775 692e 5143 7572  ursor(QtGui.QCur
+0007f780: 736f 7228 5174 2e57 6169 7443 7572 736f  sor(Qt.WaitCurso
+0007f790: 7229 290d 0a0d 0a20 2020 2020 2020 2064  r))....        d
+0007f7a0: 6172 6b73 6967 203d 2030 2e30 0d0a 0d0a  arksig = 0.0....
+0007f7b0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+0007f7c0: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
+0007f7d0: 3d20 7365 6c66 2e6e 7463 5f64 732e 7465  = self.ntc_ds.te
+0007f7e0: 7874 2829 0d0a 2020 2020 2020 2020 2020  xt()..          
+0007f7f0: 2020 6461 726b 7369 6720 3d20 666c 6f61    darksig = floa
+0007f800: 7428 7661 6c75 6529 0d0a 2020 2020 2020  t(value)..      
+0007f810: 2020 6578 6365 7074 3a0d 0a20 2020 2020    except:..     
+0007f820: 2020 2020 2020 2051 7457 6964 6765 7473         QtWidgets
+0007f830: 2e51 4170 706c 6963 6174 696f 6e2e 7265  .QApplication.re
+0007f840: 7374 6f72 654f 7665 7272 6964 6543 7572  storeOverrideCur
+0007f850: 736f 7228 290d 0a20 2020 2020 2020 2020  sor()..         
+0007f860: 2020 2051 7447 7569 2e51 4d65 7373 6167     QtGui.QMessag
+0007f870: 6542 6f78 2e77 6172 6e69 6e67 2873 656c  eBox.warning(sel
+0007f880: 662c 2027 4572 726f 7227 2c20 2750 6c65  f, 'Error', 'Ple
+0007f890: 6173 6520 656e 7465 7220 6e75 6d65 7269  ase enter numeri
+0007f8a0: 6320 6e75 6d62 6572 2066 6f72 2064 6172  c number for dar
+0007f8b0: 6b20 7369 676e 616c 2e27 290d 0a20 2020  k signal.')..   
+0007f8c0: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
+0007f8d0: 0a0d 0a0d 0a20 2020 2020 2020 2073 656c  .....        sel
+0007f8e0: 662e 7374 6163 6b2e 6162 7364 6174 6120  f.stack.absdata 
+0007f8f0: 3d20 7365 6c66 2e73 7461 636b 2e61 6273  = self.stack.abs
+0007f900: 6461 7461 202d 2064 6172 6b73 6967 0d0a  data - darksig..
+0007f910: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0007f920: 662e 636f 6d2e 6930 5f6c 6f61 6465 6420  f.com.i0_loaded 
+0007f930: 3d3d 2031 3a0d 0a20 2020 2020 2020 2020  == 1:..         
+0007f940: 2020 2073 656c 662e 7374 6163 6b2e 6361     self.stack.ca
+0007f950: 6c63 756c 6174 655f 6f70 7469 6361 6c5f  lculate_optical_
+0007f960: 6465 6e73 6974 7928 290d 0a0d 0a20 2020  density()....   
+0007f970: 2020 2020 2073 656c 662e 7374 6163 6b2e       self.stack.
+0007f980: 6669 6c6c 5f68 355f 7374 7275 6374 5f66  fill_h5_struct_f
+0007f990: 726f 6d5f 7374 6b28 290d 0a20 2020 2020  rom_stk()..     
+0007f9a0: 2020 2069 6620 7365 6c66 2e63 6f6d 2e69     if self.com.i
+0007f9b0: 305f 6c6f 6164 6564 203d 3d20 313a 0d0a  0_loaded == 1:..
+0007f9c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0007f9d0: 2e73 7461 636b 2e66 696c 6c5f 6835 5f73  .stack.fill_h5_s
+0007f9e0: 7472 7563 745f 6e6f 726d 616c 697a 6174  truct_normalizat
+0007f9f0: 696f 6e28 290d 0a0d 0a0d 0a20 2020 2020  ion()......     
+0007fa00: 2020 2073 656c 662e 7061 7265 6e74 2e70     self.parent.p
+0007fa10: 6167 6531 2e73 686f 7753 7065 6374 7275  age1.showSpectru
+0007fa20: 6d28 7365 6c66 2e70 6172 656e 742e 7061  m(self.parent.pa
+0007fa30: 6765 312e 6978 2c20 7365 6c66 2e70 6172  ge1.ix, self.par
+0007fa40: 656e 742e 7061 6765 312e 6979 290d 0a20  ent.page1.iy).. 
+0007fa50: 2020 2020 2020 2073 656c 662e 7061 7265         self.pare
+0007fa60: 6e74 2e70 6167 6531 2e6c 6f61 6449 6d61  nt.page1.loadIma
+0007fa70: 6765 2829 0d0a 0d0a 0d0a 0d0a 2020 2020  ge()........    
+0007fa80: 2020 2020 5174 5769 6467 6574 732e 5141      QtWidgets.QA
+0007fa90: 7070 6c69 6361 7469 6f6e 2e72 6573 746f  pplication.resto
+0007faa0: 7265 4f76 6572 7269 6465 4375 7273 6f72  reOverrideCursor
+0007fab0: 2829 0d0a 0d0a 2020 2020 2020 2020 7365  ()....        se
+0007fac0: 6c66 2e63 6c6f 7365 2829 0d0a 0d0a 2020  lf.close()....  
+0007fad0: 2020 2020 2020 7265 7475 726e 0d0a 0d0a        return....
+0007fae0: 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d  ......#---------
+0007faf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007fb00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007fb10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0007fb20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a63  -------------..c
+0007fb30: 6c61 7373 2050 6c6f 7446 7261 6d65 2851  lass PlotFrame(Q
+0007fb40: 7457 6964 6765 7473 2e51 4469 616c 6f67  tWidgets.QDialog
+0007fb50: 293a 0d0a 0d0a 2020 2020 6465 6620 5f5f  ):....    def __
+0007fb60: 696e 6974 5f5f 2873 656c 662c 2070 6172  init__(self, par
+0007fb70: 656e 742c 2064 6174 6178 2c20 6461 7461  ent, datax, data
+0007fb80: 792c 2074 6974 6c65 203d 2022 4930 2064  y, title = "I0 d
+0007fb90: 6174 6122 293a 0d0a 2020 2020 2020 2020  ata"):..        
+0007fba0: 5174 5769 6467 6574 732e 5157 6964 6765  QtWidgets.QWidge
+0007fbb0: 742e 5f5f 696e 6974 5f5f 2873 656c 662c  t.__init__(self,
+0007fbc0: 2070 6172 656e 7429 0d0a 0d0a 2020 2020   parent)....    
+0007fbd0: 2020 2020 7365 6c66 2e70 6172 656e 7420      self.parent 
+0007fbe0: 3d20 7061 7265 6e74 0d0a 0d0a 2020 2020  = parent....    
+0007fbf0: 2020 2020 7365 6c66 2e74 6974 6c65 203d      self.title =
+0007fc00: 2074 6974 6c65 0d0a 0d0a 2020 2020 2020   title....      
+0007fc10: 2020 7365 6c66 2e64 6174 6178 203d 2064    self.datax = d
+0007fc20: 6174 6178 0d0a 2020 2020 2020 2020 7365  atax..        se
+0007fc30: 6c66 2e64 6174 6179 203d 2064 6174 6179  lf.datay = datay
+0007fc40: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+0007fc50: 2e72 6573 697a 6528 3633 302c 2035 3030  .resize(630, 500
+0007fc60: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0007fc70: 7365 7457 696e 646f 7754 6974 6c65 2874  setWindowTitle(t
+0007fc80: 6974 6c65 290d 0a0d 0a20 2020 2020 2020  itle)....       
+0007fc90: 2070 616c 203d 2051 7447 7569 2e51 5061   pal = QtGui.QPa
+0007fca0: 6c65 7474 6528 290d 0a20 2020 2020 2020  lette()..       
+0007fcb0: 2073 656c 662e 7365 7441 7574 6f46 696c   self.setAutoFil
+0007fcc0: 6c42 6163 6b67 726f 756e 6428 5472 7565  lBackground(True
+0007fcd0: 290d 0a20 2020 2020 2020 2070 616c 2e73  )..        pal.s
+0007fce0: 6574 436f 6c6f 7228 5174 4775 692e 5150  etColor(QtGui.QP
+0007fcf0: 616c 6574 7465 2e57 696e 646f 772c 5174  alette.Window,Qt
+0007fd00: 4775 692e 5143 6f6c 6f72 2827 7768 6974  Gui.QColor('whit
+0007fd10: 6527 2929 0d0a 2020 2020 2020 2020 7365  e'))..        se
+0007fd20: 6c66 2e73 6574 5061 6c65 7474 6528 7061  lf.setPalette(pa
+0007fd30: 6c29 0d0a 0d0a 0d0a 0d0a 2020 2020 2020  l)........      
+0007fd40: 2020 7662 6f78 203d 2051 7457 6964 6765    vbox = QtWidge
+0007fd50: 7473 2e51 5642 6f78 4c61 796f 7574 2829  ts.QVBoxLayout()
+0007fd60: 0d0a 0d0a 2020 2020 2020 2020 6672 616d  ....        fram
+0007fd70: 6520 3d20 5174 5769 6467 6574 732e 5146  e = QtWidgets.QF
+0007fd80: 7261 6d65 2829 0d0a 2020 2020 2020 2020  rame()..        
+0007fd90: 6672 616d 652e 7365 7446 7261 6d65 5374  frame.setFrameSt
+0007fda0: 796c 6528 5174 5769 6467 6574 732e 5146  yle(QtWidgets.QF
+0007fdb0: 7261 6d65 2e53 7479 6c65 6450 616e 656c  rame.StyledPanel
+0007fdc0: 7c51 7457 6964 6765 7473 2e51 4672 616d  |QtWidgets.QFram
+0007fdd0: 652e 5375 6e6b 656e 290d 0a20 2020 2020  e.Sunken)..     
+0007fde0: 2020 2066 626f 7820 3d20 5174 5769 6467     fbox = QtWidg
+0007fdf0: 6574 732e 5148 426f 784c 6179 6f75 7428  ets.QHBoxLayout(
+0007fe00: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+0007fe10: 662e 706c 6f74 6669 6720 3d20 4669 6775  f.plotfig = Figu
+0007fe20: 7265 2828 362e 302c 2034 2e32 2929 0d0a  re((6.0, 4.2))..
+0007fe30: 2020 2020 2020 2020 7365 6c66 2e50 6c6f          self.Plo
+0007fe40: 7450 616e 656c 203d 2046 6967 7572 6543  tPanel = FigureC
+0007fe50: 616e 7661 7328 7365 6c66 2e70 6c6f 7466  anvas(self.plotf
+0007fe60: 6967 290d 0a20 2020 2020 2020 2073 656c  ig)..        sel
+0007fe70: 662e 506c 6f74 5061 6e65 6c2e 7365 7450  f.PlotPanel.setP
+0007fe80: 6172 656e 7428 7365 6c66 290d 0a0d 0a20  arent(self).... 
+0007fe90: 2020 2020 2020 2066 626f 782e 6164 6457         fbox.addW
+0007fea0: 6964 6765 7428 7365 6c66 2e50 6c6f 7450  idget(self.PlotP
+0007feb0: 616e 656c 290d 0a20 2020 2020 2020 2066  anel)..        f
+0007fec0: 7261 6d65 2e73 6574 4c61 796f 7574 2866  rame.setLayout(f
+0007fed0: 626f 7829 0d0a 2020 2020 2020 2020 7662  box)..        vb
+0007fee0: 6f78 2e61 6464 5769 6467 6574 2866 7261  ox.addWidget(fra
+0007fef0: 6d65 290d 0a0d 0a0d 0a20 2020 2020 2020  me)......       
+0007ff00: 2068 626f 7820 3d20 5174 5769 6467 6574   hbox = QtWidget
+0007ff10: 732e 5148 426f 784c 6179 6f75 7428 290d  s.QHBoxLayout().
+0007ff20: 0a0d 0a20 2020 2020 2020 2062 7574 746f  ...        butto
+0007ff30: 6e5f 7361 7665 203d 2051 7457 6964 6765  n_save = QtWidge
+0007ff40: 7473 2e51 5075 7368 4275 7474 6f6e 2827  ts.QPushButton('
+0007ff50: 5361 7665 2053 7065 6374 7275 6d27 290d  Save Spectrum').
+0007ff60: 0a20 2020 2020 2020 2062 7574 746f 6e5f  .        button_
+0007ff70: 7361 7665 2e63 6c69 636b 6564 2e63 6f6e  save.clicked.con
+0007ff80: 6e65 6374 2873 656c 662e 4f6e 5361 7665  nect(self.OnSave
+0007ff90: 290d 0a20 2020 2020 2020 2068 626f 782e  )..        hbox.
+0007ffa0: 6164 6457 6964 6765 7428 6275 7474 6f6e  addWidget(button
+0007ffb0: 5f73 6176 6529 0d0a 0d0a 2020 2020 2020  _save)....      
+0007ffc0: 2020 6275 7474 6f6e 5f63 6c6f 7365 203d    button_close =
+0007ffd0: 2051 7457 6964 6765 7473 2e51 5075 7368   QtWidgets.QPush
+0007ffe0: 4275 7474 6f6e 2827 436c 6f73 6527 290d  Button('Close').
+0007fff0: 0a20 2020 2020 2020 2062 7574 746f 6e5f  .        button_
+00080000: 636c 6f73 652e 636c 6963 6b65 642e 636f  close.clicked.co
+00080010: 6e6e 6563 7428 7365 6c66 2e63 6c6f 7365  nnect(self.close
+00080020: 290d 0a20 2020 2020 2020 2068 626f 782e  )..        hbox.
+00080030: 6164 6457 6964 6765 7428 6275 7474 6f6e  addWidget(button
+00080040: 5f63 6c6f 7365 290d 0a0d 0a20 2020 2020  _close)....     
+00080050: 2020 2076 626f 782e 6164 644c 6179 6f75     vbox.addLayou
+00080060: 7428 6862 6f78 290d 0a0d 0a20 2020 2020  t(hbox)....     
+00080070: 2020 2073 656c 662e 7365 744c 6179 6f75     self.setLayou
+00080080: 7428 7662 6f78 290d 0a0d 0a0d 0a20 2020  t(vbox)......   
+00080090: 2020 2020 2073 656c 662e 6472 6177 5f70       self.draw_p
+000800a0: 6c6f 7428 6461 7461 782c 6461 7461 7929  lot(datax,datay)
+000800b0: 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d  ......#---------
+000800c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000800d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000800e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000800f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20  -------------.. 
+00080100: 2020 2064 6566 2064 7261 775f 706c 6f74     def draw_plot
+00080110: 2873 656c 662c 2064 6174 6178 2c20 6461  (self, datax, da
+00080120: 7461 7929 3a0d 0a0d 0a0d 0a20 2020 2020  tay):......     
+00080130: 2020 2066 6967 203d 2073 656c 662e 706c     fig = self.pl
+00080140: 6f74 6669 670d 0a20 2020 2020 2020 2066  otfig..        f
+00080150: 6967 2e63 6c66 2829 0d0a 2020 2020 2020  ig.clf()..      
+00080160: 2020 6669 672e 6164 645f 6178 6573 2828    fig.add_axes((
+00080170: 302e 3135 2c30 2e31 352c 302e 3735 2c30  0.15,0.15,0.75,0
+00080180: 2e37 3529 290d 0a20 2020 2020 2020 2073  .75))..        s
+00080190: 656c 662e 6178 6573 203d 2066 6967 2e67  elf.axes = fig.g
+000801a0: 6361 2829 0d0a 0d0a 0d0a 2020 2020 2020  ca()......      
+000801b0: 2020 706c 6f74 203d 2073 656c 662e 6178    plot = self.ax
+000801c0: 6573 2e70 6c6f 7428 6461 7461 782c 6461  es.plot(datax,da
+000801d0: 7461 7929 0d0a 0d0a 2020 2020 2020 2020  tay)....        
+000801e0: 7365 6c66 2e61 7865 732e 7365 745f 786c  self.axes.set_xl
+000801f0: 6162 656c 2827 5068 6f74 6f6e 2045 6e65  abel('Photon Ene
+00080200: 7267 7920 5b65 565d 2729 0d0a 2020 2020  rgy [eV]')..    
+00080210: 2020 2020 7365 6c66 2e61 7865 732e 7365      self.axes.se
+00080220: 745f 796c 6162 656c 2827 4930 2046 6c75  t_ylabel('I0 Flu
+00080230: 7827 290d 0a0d 0a0d 0a0d 0a20 2020 2020  x')........     
+00080240: 2020 2073 656c 662e 506c 6f74 5061 6e65     self.PlotPane
+00080250: 6c2e 6472 6177 2829 0d0a 0d0a 232d 2d2d  l.draw()....#---
+00080260: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00080270: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00080280: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00080290: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000802a0: 2d2d 2d0d 0a20 2020 2064 6566 204f 6e53  ---..    def OnS
+000802b0: 6176 6528 7365 6c66 2c20 6576 656e 7429  ave(self, event)
+000802c0: 3a0d 0a0d 0a0d 0a20 2020 2020 2020 2074  :......        t
+000802d0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+000802e0: 2077 696c 6463 6172 6420 3d20 2243 5356   wildcard = "CSV
+000802f0: 2066 696c 6573 2028 2a2e 6373 7629 220d   files (*.csv)".
+00080300: 0a0d 0a20 2020 2020 2020 2020 2020 2066  ...            f
+00080310: 696c 6570 6174 682c 205f 6669 6c74 6572  ilepath, _filter
+00080320: 203d 2051 7457 6964 6765 7473 2e51 4669   = QtWidgets.QFi
+00080330: 6c65 4469 616c 6f67 2e67 6574 5361 7665  leDialog.getSave
+00080340: 4669 6c65 4e61 6d65 2873 656c 662c 2027  FileName(self, '
+00080350: 5361 7665 2070 6c6f 7420 6173 202e 6373  Save plot as .cs
+00080360: 7620 282e 6373 7629 272c 2027 272c 2077  v (.csv)', '', w
+00080370: 696c 6463 6172 6429 0d0a 0d0a 2020 2020  ildcard)....    
+00080380: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
+00080390: 203d 2073 7472 2866 696c 6570 6174 6829   = str(filepath)
+000803a0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000803b0: 2066 696c 6570 6174 6820 3d3d 2027 273a   filepath == '':
+000803c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000803d0: 2020 7265 7475 726e 0d0a 0d0a 0d0a 2020    return......  
+000803e0: 2020 2020 2020 2020 2020 5174 5769 6467            QtWidg
+000803f0: 6574 732e 5141 7070 6c69 6361 7469 6f6e  ets.QApplication
+00080400: 2e73 6574 4f76 6572 7269 6465 4375 7273  .setOverrideCurs
+00080410: 6f72 2851 7447 7569 2e51 4375 7273 6f72  or(QtGui.QCursor
+00080420: 2851 742e 5761 6974 4375 7273 6f72 2929  (Qt.WaitCursor))
+00080430: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00080440: 6c66 2e53 6176 6528 6669 6c65 7061 7468  lf.Save(filepath
+00080450: 290d 0a20 2020 2020 2020 2020 2020 2051  )..            Q
+00080460: 7457 6964 6765 7473 2e51 4170 706c 6963  tWidgets.QApplic
+00080470: 6174 696f 6e2e 7265 7374 6f72 654f 7665  ation.restoreOve
+00080480: 7272 6964 6543 7572 736f 7228 290d 0a0d  rrideCursor()...
+00080490: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
+000804a0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+000804b0: 5174 5769 6467 6574 732e 5141 7070 6c69  QtWidgets.QAppli
+000804c0: 6361 7469 6f6e 2e72 6573 746f 7265 4f76  cation.restoreOv
+000804d0: 6572 7269 6465 4375 7273 6f72 2829 0d0a  errideCursor()..
+000804e0: 2020 2020 2020 2020 2020 2020 5174 4775              QtGu
+000804f0: 692e 514d 6573 7361 6765 426f 782e 7761  i.QMessageBox.wa
+00080500: 726e 696e 6728 7365 6c66 2c20 2745 7272  rning(self, 'Err
+00080510: 6f72 272c 2022 436f 756c 6420 6e6f 7420  or', "Could not 
+00080520: 7361 7665 202e 6373 7620 6669 6c65 2e22  save .csv file."
+00080530: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+00080540: 662e 636c 6f73 6528 290d 0a0d 0a0d 0a20  f.close()...... 
+00080550: 2020 2020 2020 2072 6574 7572 6e0d 0a0d         return...
+00080560: 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  .#--------------
+00080570: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00080580: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00080590: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000805a0: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 6465  --------..    de
+000805b0: 6620 5361 7665 2873 656c 662c 2066 696c  f Save(self, fil
+000805c0: 656e 616d 6529 3a0d 0a0d 0a20 2020 2020  ename):....     
+000805d0: 2020 2066 203d 206f 7065 6e28 6669 6c65     f = open(file
+000805e0: 6e61 6d65 2c20 2777 2729 0d0a 2020 2020  name, 'w')..    
+000805f0: 2020 2020 7072 696e 7428 272a 2a2a 2a2a      print('*****
+00080600: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a  ****************
+00080610: 2020 582d 7261 7920 4162 736f 7270 7469    X-ray Absorpti
+00080620: 6f6e 2044 6174 6120 202a 2a2a 2a2a 2a2a  on Data  *******
+00080630: 2a2a 2a2a 2a2a 2a2a 2a2a 2a2a 2a27 2c20  *************', 
+00080640: 6669 6c65 3d66 290d 0a20 2020 2020 2020  file=f)..       
+00080650: 2070 7269 6e74 2827 2a27 2c20 6669 6c65   print('*', file
+00080660: 3d66 290d 0a20 2020 2020 2020 2070 7269  =f)..        pri
+00080670: 6e74 2827 2a20 466f 726d 756c 613a 2027  nt('* Formula: '
+00080680: 2c20 6669 6c65 3d66 290d 0a20 2020 2020  , file=f)..     
+00080690: 2020 2070 7269 6e74 2827 2a20 436f 6d6d     print('* Comm
+000806a0: 6f6e 206e 616d 653a 2027 2c20 7365 6c66  on name: ', self
+000806b0: 2e74 6974 6c65 2c20 6669 6c65 3d66 290d  .title, file=f).
 000806c0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-000806d0: 2a20 536f 7572 6365 2061 6e64 2070 7572  * Source and pur
-000806e0: 6974 793a 2027 2c20 6669 6c65 3d66 290d  ity: ', file=f).
-000806f0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00080700: 2a20 436f 6d6d 656e 7473 3a20 5374 6163  * Comments: Stac
-00080710: 6b20 6c69 7374 2052 4f49 2022 2227 2c20  k list ROI ""', 
-00080720: 6669 6c65 3d66 290d 0a20 2020 2020 2020  file=f)..       
-00080730: 2070 7269 6e74 2827 2a20 4465 6c74 6120   print('* Delta 
-00080740: 6556 3a20 272c 2066 696c 653d 6629 0d0a  eV: ', file=f)..
-00080750: 2020 2020 2020 2020 7072 696e 7428 272a          print('*
-00080760: 204d 696e 2065 563a 2027 2c20 6669 6c65   Min eV: ', file
-00080770: 3d66 290d 0a20 2020 2020 2020 2070 7269  =f)..        pri
-00080780: 6e74 2827 2a20 4d61 7820 6556 3a20 272c  nt('* Max eV: ',
-00080790: 2066 696c 653d 6629 0d0a 2020 2020 2020   file=f)..      
-000807a0: 2020 7072 696e 7428 272a 2059 2061 7869    print('* Y axi
-000807b0: 733a 2027 2c20 6669 6c65 3d66 290d 0a20  s: ', file=f).. 
-000807c0: 2020 2020 2020 2070 7269 6e74 2827 2a20         print('* 
-000807d0: 436f 6e74 6163 7420 7065 7273 6f6e 3a20  Contact person: 
+000806d0: 2a20 4564 6765 3a20 272c 2066 696c 653d  * Edge: ', file=
+000806e0: 6629 0d0a 2020 2020 2020 2020 7072 696e  f)..        prin
+000806f0: 7428 272a 2041 6371 7569 7369 7469 6f6e  t('* Acquisition
+00080700: 206d 6f64 653a 2027 2c20 6669 6c65 3d66   mode: ', file=f
+00080710: 290d 0a20 2020 2020 2020 2070 7269 6e74  )..        print
+00080720: 2827 2a20 536f 7572 6365 2061 6e64 2070  ('* Source and p
+00080730: 7572 6974 793a 2027 2c20 6669 6c65 3d66  urity: ', file=f
+00080740: 290d 0a20 2020 2020 2020 2070 7269 6e74  )..        print
+00080750: 2827 2a20 436f 6d6d 656e 7473 3a20 5374  ('* Comments: St
+00080760: 6163 6b20 6c69 7374 2052 4f49 2022 2227  ack list ROI ""'
+00080770: 2c20 6669 6c65 3d66 290d 0a20 2020 2020  , file=f)..     
+00080780: 2020 2070 7269 6e74 2827 2a20 4465 6c74     print('* Delt
+00080790: 6120 6556 3a20 272c 2066 696c 653d 6629  a eV: ', file=f)
+000807a0: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+000807b0: 272a 204d 696e 2065 563a 2027 2c20 6669  '* Min eV: ', fi
+000807c0: 6c65 3d66 290d 0a20 2020 2020 2020 2070  le=f)..        p
+000807d0: 7269 6e74 2827 2a20 4d61 7820 6556 3a20  rint('* Max eV: 
 000807e0: 272c 2066 696c 653d 6629 0d0a 2020 2020  ', file=f)..    
-000807f0: 2020 2020 7072 696e 7428 272a 2057 7269      print('* Wri
-00080800: 7465 2064 6174 653a 2027 2c20 6669 6c65  te date: ', file
-00080810: 3d66 290d 0a20 2020 2020 2020 2070 7269  =f)..        pri
-00080820: 6e74 2827 2a20 4a6f 7572 6e61 6c3a 2027  nt('* Journal: '
-00080830: 2c20 6669 6c65 3d66 290d 0a20 2020 2020  , file=f)..     
-00080840: 2020 2070 7269 6e74 2827 2a20 4175 7468     print('* Auth
-00080850: 6f72 733a 2027 2c20 6669 6c65 3d66 290d  ors: ', file=f).
-00080860: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00080870: 2a20 5469 746c 653a 2027 2c20 6669 6c65  * Title: ', file
-00080880: 3d66 290d 0a20 2020 2020 2020 2070 7269  =f)..        pri
-00080890: 6e74 2827 2a20 566f 6c75 6d65 3a20 272c  nt('* Volume: ',
-000808a0: 2066 696c 653d 6629 0d0a 2020 2020 2020   file=f)..      
-000808b0: 2020 7072 696e 7428 272a 2049 7373 7565    print('* Issue
-000808c0: 206e 756d 6265 723a 2027 2c20 6669 6c65   number: ', file
-000808d0: 3d66 290d 0a20 2020 2020 2020 2070 7269  =f)..        pri
-000808e0: 6e74 2827 2a20 5965 6172 3a20 272c 2066  nt('* Year: ', f
-000808f0: 696c 653d 6629 0d0a 2020 2020 2020 2020  ile=f)..        
-00080900: 7072 696e 7428 272a 2050 6167 6573 3a20  print('* Pages: 
-00080910: 272c 2066 696c 653d 6629 0d0a 2020 2020  ', file=f)..    
-00080920: 2020 2020 7072 696e 7428 272a 2042 6f6f      print('* Boo
-00080930: 6b74 6974 6c65 3a20 272c 2066 696c 653d  ktitle: ', file=
-00080940: 6629 0d0a 2020 2020 2020 2020 7072 696e  f)..        prin
-00080950: 7428 272a 2045 6469 746f 7273 3a20 272c  t('* Editors: ',
-00080960: 2066 696c 653d 6629 0d0a 2020 2020 2020   file=f)..      
-00080970: 2020 7072 696e 7428 272a 2050 7562 6c69    print('* Publi
-00080980: 7368 6572 3a20 272c 2066 696c 653d 6629  sher: ', file=f)
-00080990: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
-000809a0: 272a 2041 6464 7265 7373 3a20 272c 2066  '* Address: ', f
-000809b0: 696c 653d 6629 0d0a 2020 2020 2020 2020  ile=f)..        
-000809c0: 7072 696e 7428 272a 2d2d 2d2d 2d2d 2d2d  print('*--------
-000809d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000809e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000809f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00080a00: 2d2d 2d2d 2d2d 272c 2066 696c 653d 6629  ------', file=f)
-00080a10: 0d0a 2020 2020 2020 2020 6469 6d20 3d20  ..        dim = 
-00080a20: 7365 6c66 2e64 6174 6178 2e73 6861 7065  self.datax.shape
-00080a30: 0d0a 2020 2020 2020 2020 6e3d 6469 6d5b  ..        n=dim[
-00080a40: 305d 0d0a 2020 2020 2020 2020 666f 7220  0]..        for 
-00080a50: 6965 2069 6e20 7261 6e67 6528 6e29 3a0d  ie in range(n):.
-00080a60: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00080a70: 6e74 2827 7b30 3a30 362e 3266 7d2c 207b  nt('{0:06.2f}, {
-00080a80: 313a 3036 667d 272e 666f 726d 6174 2873  1:06f}'.format(s
-00080a90: 656c 662e 6461 7461 785b 6965 5d2c 2073  elf.datax[ie], s
-00080aa0: 656c 662e 6461 7461 795b 6965 5d29 2c20  elf.datay[ie]), 
-00080ab0: 6669 6c65 3d66 290d 0a0d 0a20 2020 2020  file=f)....     
-00080ac0: 2020 2066 2e63 6c6f 7365 2829 0d0a 0d0a     f.close()....
-00080ad0: 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d  ....#-----------
-00080ae0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00080af0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00080b00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00080b10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a63 6c61  -----------..cla
-00080b20: 7373 2043 6f6c 6f72 5461 626c 6546 7261  ss ColorTableFra
-00080b30: 6d65 2851 7457 6964 6765 7473 2e51 4469  me(QtWidgets.QDi
-00080b40: 616c 6f67 293a 0d0a 0d0a 2020 2020 6465  alog):....    de
-00080b50: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00080b60: 2070 6172 656e 7429 3a0d 0a20 2020 2020   parent):..     
-00080b70: 2020 2051 7457 6964 6765 7473 2e51 5769     QtWidgets.QWi
-00080b80: 6467 6574 2e5f 5f69 6e69 745f 5f28 7365  dget.__init__(se
-00080b90: 6c66 2c20 7061 7265 6e74 290d 0a0d 0a20  lf, parent).... 
-00080ba0: 2020 2020 2020 2073 656c 662e 7061 7265         self.pare
-00080bb0: 6e74 203d 2070 6172 656e 740d 0a0d 0a0d  nt = parent.....
-00080bc0: 0a20 2020 2020 2020 2073 656c 662e 7265  .        self.re
-00080bd0: 7369 7a65 2832 3030 2c20 3433 3029 0d0a  size(200, 430)..
-00080be0: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-00080bf0: 5769 6e64 6f77 5469 746c 6528 2750 6963  WindowTitle('Pic
-00080c00: 6b20 436f 6c6f 7220 5461 626c 6527 290d  k Color Table').
-00080c10: 0a0d 0a20 2020 2020 2020 2070 616c 203d  ...        pal =
-00080c20: 2051 7447 7569 2e51 5061 6c65 7474 6528   QtGui.QPalette(
-00080c30: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00080c40: 7365 7441 7574 6f46 696c 6c42 6163 6b67  setAutoFillBackg
-00080c50: 726f 756e 6428 5472 7565 290d 0a20 2020  round(True)..   
-00080c60: 2020 2020 2070 616c 2e73 6574 436f 6c6f       pal.setColo
-00080c70: 7228 5174 4775 692e 5150 616c 6574 7465  r(QtGui.QPalette
-00080c80: 2e57 696e 646f 772c 5174 4775 692e 5143  .Window,QtGui.QC
-00080c90: 6f6c 6f72 2827 7768 6974 6527 2929 0d0a  olor('white'))..
-00080ca0: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-00080cb0: 5061 6c65 7474 6528 7061 6c29 0d0a 0d0a  Palette(pal)....
-00080cc0: 2020 2020 2020 2020 7365 6c66 2e63 6f6c          self.col
-00080cd0: 6f72 733d 205b 2267 7261 7922 2c22 6a65  ors= ["gray","je
-00080ce0: 7422 2c22 6175 7475 6d6e 222c 2262 6f6e  t","autumn","bon
-00080cf0: 6522 2c20 2263 6f6f 6c22 2c22 636f 7070  e", "cool","copp
-00080d00: 6572 222c 2022 666c 6167 222c 2268 6f74  er", "flag","hot
-00080d10: 222c 2268 7376 222c 2270 696e 6b22 2c0d  ","hsv","pink",.
-00080d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00080d30: 2020 2020 2020 2022 7072 6973 6d22 2c22         "prism","
-00080d40: 7370 7269 6e67 222c 2273 756d 6d65 7222  spring","summer"
-00080d50: 2c22 7769 6e74 6572 222c 2022 7370 6563  ,"winter", "spec
-00080d60: 7472 616c 225d 0d0a 0d0a 2020 2020 2020  tral"]....      
-00080d70: 2020 7662 6f78 746f 7020 3d20 5174 5769    vboxtop = QtWi
-00080d80: 6467 6574 732e 5156 426f 784c 6179 6f75  dgets.QVBoxLayou
-00080d90: 7428 290d 0a0d 0a0d 0a0d 0a20 2020 2020  t()........     
-00080da0: 2020 2073 697a 6572 3120 3d20 5174 5769     sizer1 = QtWi
-00080db0: 6467 6574 732e 5147 726f 7570 426f 7828  dgets.QGroupBox(
-00080dc0: 2743 6f6c 6f72 2054 6162 6c65 7327 290d  'Color Tables').
-00080dd0: 0a20 2020 2020 2020 2076 626f 7820 3d20  .        vbox = 
-00080de0: 5174 5769 6467 6574 732e 5156 426f 784c  QtWidgets.QVBoxL
-00080df0: 6179 6f75 7428 290d 0a0d 0a20 2020 2020  ayout()....     
-00080e00: 2020 2073 656c 662e 7262 5f67 7265 7920     self.rb_grey 
-00080e10: 3d20 5174 5769 6467 6574 732e 5152 6164  = QtWidgets.QRad
-00080e20: 696f 4275 7474 6f6e 2873 656c 662e 636f  ioButton(self.co
-00080e30: 6c6f 7273 5b30 5d2c 2073 656c 6629 0d0a  lors[0], self)..
-00080e40: 2020 2020 2020 2020 7365 6c66 2e72 625f          self.rb_
-00080e50: 6a65 7420 203d 2051 7457 6964 6765 7473  jet  = QtWidgets
-00080e60: 2e51 5261 6469 6f42 7574 746f 6e28 7365  .QRadioButton(se
-00080e70: 6c66 2e63 6f6c 6f72 735b 315d 2c20 7365  lf.colors[1], se
-00080e80: 6c66 290d 0a20 2020 2020 2020 2073 656c  lf)..        sel
-00080e90: 662e 7262 5f61 7574 756d 6e20 3d20 5174  f.rb_autumn = Qt
-00080ea0: 5769 6467 6574 732e 5152 6164 696f 4275  Widgets.QRadioBu
-00080eb0: 7474 6f6e 2873 656c 662e 636f 6c6f 7273  tton(self.colors
-00080ec0: 5b32 5d2c 2073 656c 6629 0d0a 2020 2020  [2], self)..    
-00080ed0: 2020 2020 7365 6c66 2e72 625f 626f 6e65      self.rb_bone
-00080ee0: 203d 2051 7457 6964 6765 7473 2e51 5261   = QtWidgets.QRa
-00080ef0: 6469 6f42 7574 746f 6e28 7365 6c66 2e63  dioButton(self.c
-00080f00: 6f6c 6f72 735b 335d 2c20 7365 6c66 290d  olors[3], self).
-00080f10: 0a20 2020 2020 2020 2073 656c 662e 7262  .        self.rb
-00080f20: 5f63 6f6f 6c20 3d20 5174 5769 6467 6574  _cool = QtWidget
-00080f30: 732e 5152 6164 696f 4275 7474 6f6e 2873  s.QRadioButton(s
-00080f40: 656c 662e 636f 6c6f 7273 5b34 5d2c 2073  elf.colors[4], s
-00080f50: 656c 6629 0d0a 2020 2020 2020 2020 7365  elf)..        se
-00080f60: 6c66 2e72 625f 636f 7070 6572 203d 2051  lf.rb_copper = Q
-00080f70: 7457 6964 6765 7473 2e51 5261 6469 6f42  tWidgets.QRadioB
-00080f80: 7574 746f 6e28 7365 6c66 2e63 6f6c 6f72  utton(self.color
-00080f90: 735b 355d 2c20 7365 6c66 290d 0a20 2020  s[5], self)..   
-00080fa0: 2020 2020 2073 656c 662e 7262 5f66 6c61       self.rb_fla
-00080fb0: 6720 3d20 5174 5769 6467 6574 732e 5152  g = QtWidgets.QR
-00080fc0: 6164 696f 4275 7474 6f6e 2873 656c 662e  adioButton(self.
-00080fd0: 636f 6c6f 7273 5b36 5d2c 2073 656c 6629  colors[6], self)
-00080fe0: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
-00080ff0: 625f 686f 7420 3d20 5174 5769 6467 6574  b_hot = QtWidget
-00081000: 732e 5152 6164 696f 4275 7474 6f6e 2873  s.QRadioButton(s
-00081010: 656c 662e 636f 6c6f 7273 5b37 5d2c 2073  elf.colors[7], s
-00081020: 656c 6629 0d0a 2020 2020 2020 2020 7365  elf)..        se
-00081030: 6c66 2e72 625f 6873 7620 3d20 5174 5769  lf.rb_hsv = QtWi
-00081040: 6467 6574 732e 5152 6164 696f 4275 7474  dgets.QRadioButt
-00081050: 6f6e 2873 656c 662e 636f 6c6f 7273 5b38  on(self.colors[8
-00081060: 5d2c 2073 656c 6629 0d0a 2020 2020 2020  ], self)..      
-00081070: 2020 7365 6c66 2e72 625f 7069 6e6b 203d    self.rb_pink =
-00081080: 2051 7457 6964 6765 7473 2e51 5261 6469   QtWidgets.QRadi
-00081090: 6f42 7574 746f 6e28 7365 6c66 2e63 6f6c  oButton(self.col
-000810a0: 6f72 735b 395d 2c20 7365 6c66 290d 0a20  ors[9], self).. 
-000810b0: 2020 2020 2020 2073 656c 662e 7262 5f70         self.rb_p
-000810c0: 7269 736d 203d 2051 7457 6964 6765 7473  rism = QtWidgets
-000810d0: 2e51 5261 6469 6f42 7574 746f 6e28 7365  .QRadioButton(se
-000810e0: 6c66 2e63 6f6c 6f72 735b 3130 5d2c 2073  lf.colors[10], s
-000810f0: 656c 6629 0d0a 2020 2020 2020 2020 7365  elf)..        se
-00081100: 6c66 2e72 625f 7370 7269 6e67 203d 2051  lf.rb_spring = Q
-00081110: 7457 6964 6765 7473 2e51 5261 6469 6f42  tWidgets.QRadioB
-00081120: 7574 746f 6e28 7365 6c66 2e63 6f6c 6f72  utton(self.color
-00081130: 735b 3131 5d2c 2073 656c 6629 0d0a 2020  s[11], self)..  
-00081140: 2020 2020 2020 7365 6c66 2e72 625f 7375        self.rb_su
-00081150: 6d6d 6572 203d 2051 7457 6964 6765 7473  mmer = QtWidgets
-00081160: 2e51 5261 6469 6f42 7574 746f 6e28 7365  .QRadioButton(se
-00081170: 6c66 2e63 6f6c 6f72 735b 3132 5d2c 2073  lf.colors[12], s
-00081180: 656c 6629 0d0a 2020 2020 2020 2020 7365  elf)..        se
-00081190: 6c66 2e72 625f 7769 6e74 6572 203d 2051  lf.rb_winter = Q
-000811a0: 7457 6964 6765 7473 2e51 5261 6469 6f42  tWidgets.QRadioB
-000811b0: 7574 746f 6e28 7365 6c66 2e63 6f6c 6f72  utton(self.color
-000811c0: 735b 3133 5d2c 2073 656c 6629 0d0a 2020  s[13], self)..  
-000811d0: 2020 2020 2020 7365 6c66 2e72 625f 7370        self.rb_sp
-000811e0: 6563 7472 616c 203d 2051 7457 6964 6765  ectral = QtWidge
-000811f0: 7473 2e51 5261 6469 6f42 7574 746f 6e28  ts.QRadioButton(
-00081200: 7365 6c66 2e63 6f6c 6f72 735b 3134 5d2c  self.colors[14],
-00081210: 2073 656c 6629 0d0a 0d0a 0d0a 2020 2020   self)......    
-00081220: 2020 2020 7365 6c66 2e72 6164 696f 7320      self.radios 
-00081230: 3d20 5b5d 0d0a 0d0a 2020 2020 2020 2020  = []....        
-00081240: 7365 6c66 2e72 6164 696f 732e 6170 7065  self.radios.appe
-00081250: 6e64 2873 656c 662e 7262 5f67 7265 7929  nd(self.rb_grey)
-00081260: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
-00081270: 6164 696f 732e 6170 7065 6e64 2873 656c  adios.append(sel
-00081280: 662e 7262 5f6a 6574 290d 0a20 2020 2020  f.rb_jet)..     
-00081290: 2020 2073 656c 662e 7261 6469 6f73 2e61     self.radios.a
-000812a0: 7070 656e 6428 7365 6c66 2e72 625f 6175  ppend(self.rb_au
-000812b0: 7475 6d6e 290d 0a20 2020 2020 2020 2073  tumn)..        s
-000812c0: 656c 662e 7261 6469 6f73 2e61 7070 656e  elf.radios.appen
-000812d0: 6428 7365 6c66 2e72 625f 626f 6e65 290d  d(self.rb_bone).
-000812e0: 0a20 2020 2020 2020 2073 656c 662e 7261  .        self.ra
-000812f0: 6469 6f73 2e61 7070 656e 6428 7365 6c66  dios.append(self
-00081300: 2e72 625f 636f 6f6c 290d 0a20 2020 2020  .rb_cool)..     
-00081310: 2020 2073 656c 662e 7261 6469 6f73 2e61     self.radios.a
-00081320: 7070 656e 6428 7365 6c66 2e72 625f 636f  ppend(self.rb_co
-00081330: 7070 6572 290d 0a20 2020 2020 2020 2073  pper)..        s
-00081340: 656c 662e 7261 6469 6f73 2e61 7070 656e  elf.radios.appen
-00081350: 6428 7365 6c66 2e72 625f 666c 6167 290d  d(self.rb_flag).
-00081360: 0a20 2020 2020 2020 2073 656c 662e 7261  .        self.ra
-00081370: 6469 6f73 2e61 7070 656e 6428 7365 6c66  dios.append(self
-00081380: 2e72 625f 686f 7429 0d0a 2020 2020 2020  .rb_hot)..      
-00081390: 2020 7365 6c66 2e72 6164 696f 732e 6170    self.radios.ap
-000813a0: 7065 6e64 2873 656c 662e 7262 5f68 7376  pend(self.rb_hsv
+000807f0: 2020 2020 7072 696e 7428 272a 2059 2061      print('* Y a
+00080800: 7869 733a 2027 2c20 6669 6c65 3d66 290d  xis: ', file=f).
+00080810: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+00080820: 2a20 436f 6e74 6163 7420 7065 7273 6f6e  * Contact person
+00080830: 3a20 272c 2066 696c 653d 6629 0d0a 2020  : ', file=f)..  
+00080840: 2020 2020 2020 7072 696e 7428 272a 2057        print('* W
+00080850: 7269 7465 2064 6174 653a 2027 2c20 6669  rite date: ', fi
+00080860: 6c65 3d66 290d 0a20 2020 2020 2020 2070  le=f)..        p
+00080870: 7269 6e74 2827 2a20 4a6f 7572 6e61 6c3a  rint('* Journal:
+00080880: 2027 2c20 6669 6c65 3d66 290d 0a20 2020   ', file=f)..   
+00080890: 2020 2020 2070 7269 6e74 2827 2a20 4175       print('* Au
+000808a0: 7468 6f72 733a 2027 2c20 6669 6c65 3d66  thors: ', file=f
+000808b0: 290d 0a20 2020 2020 2020 2070 7269 6e74  )..        print
+000808c0: 2827 2a20 5469 746c 653a 2027 2c20 6669  ('* Title: ', fi
+000808d0: 6c65 3d66 290d 0a20 2020 2020 2020 2070  le=f)..        p
+000808e0: 7269 6e74 2827 2a20 566f 6c75 6d65 3a20  rint('* Volume: 
+000808f0: 272c 2066 696c 653d 6629 0d0a 2020 2020  ', file=f)..    
+00080900: 2020 2020 7072 696e 7428 272a 2049 7373      print('* Iss
+00080910: 7565 206e 756d 6265 723a 2027 2c20 6669  ue number: ', fi
+00080920: 6c65 3d66 290d 0a20 2020 2020 2020 2070  le=f)..        p
+00080930: 7269 6e74 2827 2a20 5965 6172 3a20 272c  rint('* Year: ',
+00080940: 2066 696c 653d 6629 0d0a 2020 2020 2020   file=f)..      
+00080950: 2020 7072 696e 7428 272a 2050 6167 6573    print('* Pages
+00080960: 3a20 272c 2066 696c 653d 6629 0d0a 2020  : ', file=f)..  
+00080970: 2020 2020 2020 7072 696e 7428 272a 2042        print('* B
+00080980: 6f6f 6b74 6974 6c65 3a20 272c 2066 696c  ooktitle: ', fil
+00080990: 653d 6629 0d0a 2020 2020 2020 2020 7072  e=f)..        pr
+000809a0: 696e 7428 272a 2045 6469 746f 7273 3a20  int('* Editors: 
+000809b0: 272c 2066 696c 653d 6629 0d0a 2020 2020  ', file=f)..    
+000809c0: 2020 2020 7072 696e 7428 272a 2050 7562      print('* Pub
+000809d0: 6c69 7368 6572 3a20 272c 2066 696c 653d  lisher: ', file=
+000809e0: 6629 0d0a 2020 2020 2020 2020 7072 696e  f)..        prin
+000809f0: 7428 272a 2041 6464 7265 7373 3a20 272c  t('* Address: ',
+00080a00: 2066 696c 653d 6629 0d0a 2020 2020 2020   file=f)..      
+00080a10: 2020 7072 696e 7428 272a 2d2d 2d2d 2d2d    print('*------
+00080a20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00080a30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00080a40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00080a50: 2d2d 2d2d 2d2d 2d2d 272c 2066 696c 653d  --------', file=
+00080a60: 6629 0d0a 2020 2020 2020 2020 6469 6d20  f)..        dim 
+00080a70: 3d20 7365 6c66 2e64 6174 6178 2e73 6861  = self.datax.sha
+00080a80: 7065 0d0a 2020 2020 2020 2020 6e3d 6469  pe..        n=di
+00080a90: 6d5b 305d 0d0a 2020 2020 2020 2020 666f  m[0]..        fo
+00080aa0: 7220 6965 2069 6e20 7261 6e67 6528 6e29  r ie in range(n)
+00080ab0: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
+00080ac0: 7269 6e74 2827 7b30 3a30 362e 3266 7d2c  rint('{0:06.2f},
+00080ad0: 207b 313a 3036 667d 272e 666f 726d 6174   {1:06f}'.format
+00080ae0: 2873 656c 662e 6461 7461 785b 6965 5d2c  (self.datax[ie],
+00080af0: 2073 656c 662e 6461 7461 795b 6965 5d29   self.datay[ie])
+00080b00: 2c20 6669 6c65 3d66 290d 0a0d 0a20 2020  , file=f)....   
+00080b10: 2020 2020 2066 2e63 6c6f 7365 2829 0d0a       f.close()..
+00080b20: 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d  ......#---------
+00080b30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00080b40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00080b50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00080b60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a63  -------------..c
+00080b70: 6c61 7373 2043 6f6c 6f72 5461 626c 6546  lass ColorTableF
+00080b80: 7261 6d65 2851 7457 6964 6765 7473 2e51  rame(QtWidgets.Q
+00080b90: 4469 616c 6f67 293a 0d0a 0d0a 2020 2020  Dialog):....    
+00080ba0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00080bb0: 662c 2070 6172 656e 7429 3a0d 0a20 2020  f, parent):..   
+00080bc0: 2020 2020 2051 7457 6964 6765 7473 2e51       QtWidgets.Q
+00080bd0: 5769 6467 6574 2e5f 5f69 6e69 745f 5f28  Widget.__init__(
+00080be0: 7365 6c66 2c20 7061 7265 6e74 290d 0a0d  self, parent)...
+00080bf0: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+00080c00: 7265 6e74 203d 2070 6172 656e 740d 0a0d  rent = parent...
+00080c10: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00080c20: 7265 7369 7a65 2832 3030 2c20 3433 3029  resize(200, 430)
+00080c30: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00080c40: 6574 5769 6e64 6f77 5469 746c 6528 2750  etWindowTitle('P
+00080c50: 6963 6b20 436f 6c6f 7220 5461 626c 6527  ick Color Table'
+00080c60: 290d 0a0d 0a20 2020 2020 2020 2070 616c  )....        pal
+00080c70: 203d 2051 7447 7569 2e51 5061 6c65 7474   = QtGui.QPalett
+00080c80: 6528 290d 0a20 2020 2020 2020 2073 656c  e()..        sel
+00080c90: 662e 7365 7441 7574 6f46 696c 6c42 6163  f.setAutoFillBac
+00080ca0: 6b67 726f 756e 6428 5472 7565 290d 0a20  kground(True).. 
+00080cb0: 2020 2020 2020 2070 616c 2e73 6574 436f         pal.setCo
+00080cc0: 6c6f 7228 5174 4775 692e 5150 616c 6574  lor(QtGui.QPalet
+00080cd0: 7465 2e57 696e 646f 772c 5174 4775 692e  te.Window,QtGui.
+00080ce0: 5143 6f6c 6f72 2827 7768 6974 6527 2929  QColor('white'))
+00080cf0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00080d00: 6574 5061 6c65 7474 6528 7061 6c29 0d0a  etPalette(pal)..
+00080d10: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+00080d20: 6f6c 6f72 733d 205b 2267 7261 7922 2c22  olors= ["gray","
+00080d30: 6a65 7422 2c22 6175 7475 6d6e 222c 2262  jet","autumn","b
+00080d40: 6f6e 6522 2c20 2263 6f6f 6c22 2c22 636f  one", "cool","co
+00080d50: 7070 6572 222c 2022 666c 6167 222c 2268  pper", "flag","h
+00080d60: 6f74 222c 2268 7376 222c 2270 696e 6b22  ot","hsv","pink"
+00080d70: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00080d80: 2020 2020 2020 2020 2022 7072 6973 6d22           "prism"
+00080d90: 2c22 7370 7269 6e67 222c 2273 756d 6d65  ,"spring","summe
+00080da0: 7222 2c22 7769 6e74 6572 222c 2022 7370  r","winter", "sp
+00080db0: 6563 7472 616c 225d 0d0a 0d0a 2020 2020  ectral"]....    
+00080dc0: 2020 2020 7662 6f78 746f 7020 3d20 5174      vboxtop = Qt
+00080dd0: 5769 6467 6574 732e 5156 426f 784c 6179  Widgets.QVBoxLay
+00080de0: 6f75 7428 290d 0a0d 0a0d 0a0d 0a20 2020  out()........   
+00080df0: 2020 2020 2073 697a 6572 3120 3d20 5174       sizer1 = Qt
+00080e00: 5769 6467 6574 732e 5147 726f 7570 426f  Widgets.QGroupBo
+00080e10: 7828 2743 6f6c 6f72 2054 6162 6c65 7327  x('Color Tables'
+00080e20: 290d 0a20 2020 2020 2020 2076 626f 7820  )..        vbox 
+00080e30: 3d20 5174 5769 6467 6574 732e 5156 426f  = QtWidgets.QVBo
+00080e40: 784c 6179 6f75 7428 290d 0a0d 0a20 2020  xLayout()....   
+00080e50: 2020 2020 2073 656c 662e 7262 5f67 7265       self.rb_gre
+00080e60: 7920 3d20 5174 5769 6467 6574 732e 5152  y = QtWidgets.QR
+00080e70: 6164 696f 4275 7474 6f6e 2873 656c 662e  adioButton(self.
+00080e80: 636f 6c6f 7273 5b30 5d2c 2073 656c 6629  colors[0], self)
+00080e90: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+00080ea0: 625f 6a65 7420 203d 2051 7457 6964 6765  b_jet  = QtWidge
+00080eb0: 7473 2e51 5261 6469 6f42 7574 746f 6e28  ts.QRadioButton(
+00080ec0: 7365 6c66 2e63 6f6c 6f72 735b 315d 2c20  self.colors[1], 
+00080ed0: 7365 6c66 290d 0a20 2020 2020 2020 2073  self)..        s
+00080ee0: 656c 662e 7262 5f61 7574 756d 6e20 3d20  elf.rb_autumn = 
+00080ef0: 5174 5769 6467 6574 732e 5152 6164 696f  QtWidgets.QRadio
+00080f00: 4275 7474 6f6e 2873 656c 662e 636f 6c6f  Button(self.colo
+00080f10: 7273 5b32 5d2c 2073 656c 6629 0d0a 2020  rs[2], self)..  
+00080f20: 2020 2020 2020 7365 6c66 2e72 625f 626f        self.rb_bo
+00080f30: 6e65 203d 2051 7457 6964 6765 7473 2e51  ne = QtWidgets.Q
+00080f40: 5261 6469 6f42 7574 746f 6e28 7365 6c66  RadioButton(self
+00080f50: 2e63 6f6c 6f72 735b 335d 2c20 7365 6c66  .colors[3], self
+00080f60: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00080f70: 7262 5f63 6f6f 6c20 3d20 5174 5769 6467  rb_cool = QtWidg
+00080f80: 6574 732e 5152 6164 696f 4275 7474 6f6e  ets.QRadioButton
+00080f90: 2873 656c 662e 636f 6c6f 7273 5b34 5d2c  (self.colors[4],
+00080fa0: 2073 656c 6629 0d0a 2020 2020 2020 2020   self)..        
+00080fb0: 7365 6c66 2e72 625f 636f 7070 6572 203d  self.rb_copper =
+00080fc0: 2051 7457 6964 6765 7473 2e51 5261 6469   QtWidgets.QRadi
+00080fd0: 6f42 7574 746f 6e28 7365 6c66 2e63 6f6c  oButton(self.col
+00080fe0: 6f72 735b 355d 2c20 7365 6c66 290d 0a20  ors[5], self).. 
+00080ff0: 2020 2020 2020 2073 656c 662e 7262 5f66         self.rb_f
+00081000: 6c61 6720 3d20 5174 5769 6467 6574 732e  lag = QtWidgets.
+00081010: 5152 6164 696f 4275 7474 6f6e 2873 656c  QRadioButton(sel
+00081020: 662e 636f 6c6f 7273 5b36 5d2c 2073 656c  f.colors[6], sel
+00081030: 6629 0d0a 2020 2020 2020 2020 7365 6c66  f)..        self
+00081040: 2e72 625f 686f 7420 3d20 5174 5769 6467  .rb_hot = QtWidg
+00081050: 6574 732e 5152 6164 696f 4275 7474 6f6e  ets.QRadioButton
+00081060: 2873 656c 662e 636f 6c6f 7273 5b37 5d2c  (self.colors[7],
+00081070: 2073 656c 6629 0d0a 2020 2020 2020 2020   self)..        
+00081080: 7365 6c66 2e72 625f 6873 7620 3d20 5174  self.rb_hsv = Qt
+00081090: 5769 6467 6574 732e 5152 6164 696f 4275  Widgets.QRadioBu
+000810a0: 7474 6f6e 2873 656c 662e 636f 6c6f 7273  tton(self.colors
+000810b0: 5b38 5d2c 2073 656c 6629 0d0a 2020 2020  [8], self)..    
+000810c0: 2020 2020 7365 6c66 2e72 625f 7069 6e6b      self.rb_pink
+000810d0: 203d 2051 7457 6964 6765 7473 2e51 5261   = QtWidgets.QRa
+000810e0: 6469 6f42 7574 746f 6e28 7365 6c66 2e63  dioButton(self.c
+000810f0: 6f6c 6f72 735b 395d 2c20 7365 6c66 290d  olors[9], self).
+00081100: 0a20 2020 2020 2020 2073 656c 662e 7262  .        self.rb
+00081110: 5f70 7269 736d 203d 2051 7457 6964 6765  _prism = QtWidge
+00081120: 7473 2e51 5261 6469 6f42 7574 746f 6e28  ts.QRadioButton(
+00081130: 7365 6c66 2e63 6f6c 6f72 735b 3130 5d2c  self.colors[10],
+00081140: 2073 656c 6629 0d0a 2020 2020 2020 2020   self)..        
+00081150: 7365 6c66 2e72 625f 7370 7269 6e67 203d  self.rb_spring =
+00081160: 2051 7457 6964 6765 7473 2e51 5261 6469   QtWidgets.QRadi
+00081170: 6f42 7574 746f 6e28 7365 6c66 2e63 6f6c  oButton(self.col
+00081180: 6f72 735b 3131 5d2c 2073 656c 6629 0d0a  ors[11], self)..
+00081190: 2020 2020 2020 2020 7365 6c66 2e72 625f          self.rb_
+000811a0: 7375 6d6d 6572 203d 2051 7457 6964 6765  summer = QtWidge
+000811b0: 7473 2e51 5261 6469 6f42 7574 746f 6e28  ts.QRadioButton(
+000811c0: 7365 6c66 2e63 6f6c 6f72 735b 3132 5d2c  self.colors[12],
+000811d0: 2073 656c 6629 0d0a 2020 2020 2020 2020   self)..        
+000811e0: 7365 6c66 2e72 625f 7769 6e74 6572 203d  self.rb_winter =
+000811f0: 2051 7457 6964 6765 7473 2e51 5261 6469   QtWidgets.QRadi
+00081200: 6f42 7574 746f 6e28 7365 6c66 2e63 6f6c  oButton(self.col
+00081210: 6f72 735b 3133 5d2c 2073 656c 6629 0d0a  ors[13], self)..
+00081220: 2020 2020 2020 2020 7365 6c66 2e72 625f          self.rb_
+00081230: 7370 6563 7472 616c 203d 2051 7457 6964  spectral = QtWid
+00081240: 6765 7473 2e51 5261 6469 6f42 7574 746f  gets.QRadioButto
+00081250: 6e28 7365 6c66 2e63 6f6c 6f72 735b 3134  n(self.colors[14
+00081260: 5d2c 2073 656c 6629 0d0a 0d0a 0d0a 2020  ], self)......  
+00081270: 2020 2020 2020 7365 6c66 2e72 6164 696f        self.radio
+00081280: 7320 3d20 5b5d 0d0a 0d0a 2020 2020 2020  s = []....      
+00081290: 2020 7365 6c66 2e72 6164 696f 732e 6170    self.radios.ap
+000812a0: 7065 6e64 2873 656c 662e 7262 5f67 7265  pend(self.rb_gre
+000812b0: 7929 0d0a 2020 2020 2020 2020 7365 6c66  y)..        self
+000812c0: 2e72 6164 696f 732e 6170 7065 6e64 2873  .radios.append(s
+000812d0: 656c 662e 7262 5f6a 6574 290d 0a20 2020  elf.rb_jet)..   
+000812e0: 2020 2020 2073 656c 662e 7261 6469 6f73       self.radios
+000812f0: 2e61 7070 656e 6428 7365 6c66 2e72 625f  .append(self.rb_
+00081300: 6175 7475 6d6e 290d 0a20 2020 2020 2020  autumn)..       
+00081310: 2073 656c 662e 7261 6469 6f73 2e61 7070   self.radios.app
+00081320: 656e 6428 7365 6c66 2e72 625f 626f 6e65  end(self.rb_bone
+00081330: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00081340: 7261 6469 6f73 2e61 7070 656e 6428 7365  radios.append(se
+00081350: 6c66 2e72 625f 636f 6f6c 290d 0a20 2020  lf.rb_cool)..   
+00081360: 2020 2020 2073 656c 662e 7261 6469 6f73       self.radios
+00081370: 2e61 7070 656e 6428 7365 6c66 2e72 625f  .append(self.rb_
+00081380: 636f 7070 6572 290d 0a20 2020 2020 2020  copper)..       
+00081390: 2073 656c 662e 7261 6469 6f73 2e61 7070   self.radios.app
+000813a0: 656e 6428 7365 6c66 2e72 625f 666c 6167  end(self.rb_flag
 000813b0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
 000813c0: 7261 6469 6f73 2e61 7070 656e 6428 7365  radios.append(se
-000813d0: 6c66 2e72 625f 7069 6e6b 290d 0a20 2020  lf.rb_pink)..   
-000813e0: 2020 2020 2073 656c 662e 7261 6469 6f73       self.radios
-000813f0: 2e61 7070 656e 6428 7365 6c66 2e72 625f  .append(self.rb_
-00081400: 7072 6973 6d29 0d0a 2020 2020 2020 2020  prism)..        
-00081410: 7365 6c66 2e72 6164 696f 732e 6170 7065  self.radios.appe
-00081420: 6e64 2873 656c 662e 7262 5f73 7072 696e  nd(self.rb_sprin
-00081430: 6729 0d0a 2020 2020 2020 2020 7365 6c66  g)..        self
-00081440: 2e72 6164 696f 732e 6170 7065 6e64 2873  .radios.append(s
-00081450: 656c 662e 7262 5f73 756d 6d65 7229 0d0a  elf.rb_summer)..
-00081460: 2020 2020 2020 2020 7365 6c66 2e72 6164          self.rad
-00081470: 696f 732e 6170 7065 6e64 2873 656c 662e  ios.append(self.
-00081480: 7262 5f77 696e 7465 7229 0d0a 2020 2020  rb_winter)..    
-00081490: 2020 2020 7365 6c66 2e72 6164 696f 732e      self.radios.
-000814a0: 6170 7065 6e64 2873 656c 662e 7262 5f73  append(self.rb_s
-000814b0: 7065 6374 7261 6c29 0d0a 0d0a 2020 2020  pectral)....    
-000814c0: 2020 2020 7365 6c66 2e63 745f 6469 6374      self.ct_dict
-000814d0: 203d 2064 6963 7428 5b28 7365 6c66 2e63   = dict([(self.c
-000814e0: 6f6c 6f72 735b 785d 2c20 7365 6c66 2e72  olors[x], self.r
-000814f0: 6164 696f 735b 785d 2920 666f 7220 7820  adios[x]) for x 
-00081500: 696e 2072 616e 6765 286c 656e 2873 656c  in range(len(sel
-00081510: 662e 636f 6c6f 7273 2929 5d29 0d0a 0d0a  f.colors))])....
-00081520: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
-00081530: 625f 6772 6579 2e63 6c69 636b 6564 2e63  b_grey.clicked.c
-00081540: 6f6e 6e65 6374 2873 656c 662e 4f6e 436f  onnect(self.OnCo
-00081550: 6c6f 7254 6162 6c65 290d 0a20 2020 2020  lorTable)..     
-00081560: 2020 2073 656c 662e 7262 5f6a 6574 2e63     self.rb_jet.c
-00081570: 6c69 636b 6564 2e63 6f6e 6e65 6374 2873  licked.connect(s
-00081580: 656c 662e 4f6e 436f 6c6f 7254 6162 6c65  elf.OnColorTable
-00081590: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000815a0: 7262 5f61 7574 756d 6e2e 636c 6963 6b65  rb_autumn.clicke
-000815b0: 642e 636f 6e6e 6563 7428 7365 6c66 2e4f  d.connect(self.O
-000815c0: 6e43 6f6c 6f72 5461 626c 6529 0d0a 2020  nColorTable)..  
-000815d0: 2020 2020 2020 7365 6c66 2e72 625f 626f        self.rb_bo
-000815e0: 6e65 2e63 6c69 636b 6564 2e63 6f6e 6e65  ne.clicked.conne
-000815f0: 6374 2873 656c 662e 4f6e 436f 6c6f 7254  ct(self.OnColorT
-00081600: 6162 6c65 290d 0a20 2020 2020 2020 2073  able)..        s
-00081610: 656c 662e 7262 5f63 6f6f 6c2e 636c 6963  elf.rb_cool.clic
-00081620: 6b65 642e 636f 6e6e 6563 7428 7365 6c66  ked.connect(self
-00081630: 2e4f 6e43 6f6c 6f72 5461 626c 6529 0d0a  .OnColorTable)..
-00081640: 2020 2020 2020 2020 7365 6c66 2e72 625f          self.rb_
-00081650: 636f 7070 6572 2e63 6c69 636b 6564 2e63  copper.clicked.c
-00081660: 6f6e 6e65 6374 2873 656c 662e 4f6e 436f  onnect(self.OnCo
-00081670: 6c6f 7254 6162 6c65 290d 0a20 2020 2020  lorTable)..     
-00081680: 2020 2073 656c 662e 7262 5f66 6c61 672e     self.rb_flag.
-00081690: 636c 6963 6b65 642e 636f 6e6e 6563 7428  clicked.connect(
-000816a0: 7365 6c66 2e4f 6e43 6f6c 6f72 5461 626c  self.OnColorTabl
-000816b0: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-000816c0: 2e72 625f 686f 742e 636c 6963 6b65 642e  .rb_hot.clicked.
-000816d0: 636f 6e6e 6563 7428 7365 6c66 2e4f 6e43  connect(self.OnC
-000816e0: 6f6c 6f72 5461 626c 6529 0d0a 2020 2020  olorTable)..    
-000816f0: 2020 2020 7365 6c66 2e72 625f 6873 762e      self.rb_hsv.
-00081700: 636c 6963 6b65 642e 636f 6e6e 6563 7428  clicked.connect(
-00081710: 7365 6c66 2e4f 6e43 6f6c 6f72 5461 626c  self.OnColorTabl
-00081720: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-00081730: 2e72 625f 7069 6e6b 2e63 6c69 636b 6564  .rb_pink.clicked
-00081740: 2e63 6f6e 6e65 6374 2873 656c 662e 4f6e  .connect(self.On
-00081750: 436f 6c6f 7254 6162 6c65 290d 0a20 2020  ColorTable)..   
-00081760: 2020 2020 2073 656c 662e 7262 5f70 7269       self.rb_pri
-00081770: 736d 2e63 6c69 636b 6564 2e63 6f6e 6e65  sm.clicked.conne
-00081780: 6374 2873 656c 662e 4f6e 436f 6c6f 7254  ct(self.OnColorT
-00081790: 6162 6c65 290d 0a20 2020 2020 2020 2073  able)..        s
-000817a0: 656c 662e 7262 5f73 7072 696e 672e 636c  elf.rb_spring.cl
-000817b0: 6963 6b65 642e 636f 6e6e 6563 7428 7365  icked.connect(se
-000817c0: 6c66 2e4f 6e43 6f6c 6f72 5461 626c 6529  lf.OnColorTable)
-000817d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
-000817e0: 625f 7375 6d6d 6572 2e63 6c69 636b 6564  b_summer.clicked
-000817f0: 2e63 6f6e 6e65 6374 2873 656c 662e 4f6e  .connect(self.On
-00081800: 436f 6c6f 7254 6162 6c65 290d 0a20 2020  ColorTable)..   
-00081810: 2020 2020 2073 656c 662e 7262 5f77 696e       self.rb_win
-00081820: 7465 722e 636c 6963 6b65 642e 636f 6e6e  ter.clicked.conn
-00081830: 6563 7428 7365 6c66 2e4f 6e43 6f6c 6f72  ect(self.OnColor
-00081840: 5461 626c 6529 0d0a 2020 2020 2020 2020  Table)..        
-00081850: 7365 6c66 2e72 625f 7370 6563 7472 616c  self.rb_spectral
-00081860: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
-00081870: 2873 656c 662e 4f6e 436f 6c6f 7254 6162  (self.OnColorTab
-00081880: 6c65 290d 0a0d 0a20 2020 2020 2020 2076  le)....        v
-00081890: 626f 782e 6164 6457 6964 6765 7428 7365  box.addWidget(se
-000818a0: 6c66 2e72 625f 6772 6579 290d 0a20 2020  lf.rb_grey)..   
-000818b0: 2020 2020 2076 626f 782e 6164 6457 6964       vbox.addWid
-000818c0: 6765 7428 7365 6c66 2e72 625f 6a65 7429  get(self.rb_jet)
-000818d0: 0d0a 2020 2020 2020 2020 7662 6f78 2e61  ..        vbox.a
-000818e0: 6464 5769 6467 6574 2873 656c 662e 7262  ddWidget(self.rb
-000818f0: 5f61 7574 756d 6e29 0d0a 2020 2020 2020  _autumn)..      
-00081900: 2020 7662 6f78 2e61 6464 5769 6467 6574    vbox.addWidget
-00081910: 2873 656c 662e 7262 5f62 6f6e 6529 0d0a  (self.rb_bone)..
-00081920: 2020 2020 2020 2020 7662 6f78 2e61 6464          vbox.add
-00081930: 5769 6467 6574 2873 656c 662e 7262 5f63  Widget(self.rb_c
-00081940: 6f6f 6c29 0d0a 2020 2020 2020 2020 7662  ool)..        vb
-00081950: 6f78 2e61 6464 5769 6467 6574 2873 656c  ox.addWidget(sel
-00081960: 662e 7262 5f63 6f70 7065 7229 0d0a 2020  f.rb_copper)..  
-00081970: 2020 2020 2020 7662 6f78 2e61 6464 5769        vbox.addWi
-00081980: 6467 6574 2873 656c 662e 7262 5f66 6c61  dget(self.rb_fla
-00081990: 6729 0d0a 2020 2020 2020 2020 7662 6f78  g)..        vbox
-000819a0: 2e61 6464 5769 6467 6574 2873 656c 662e  .addWidget(self.
-000819b0: 7262 5f68 6f74 290d 0a20 2020 2020 2020  rb_hot)..       
-000819c0: 2076 626f 782e 6164 6457 6964 6765 7428   vbox.addWidget(
-000819d0: 7365 6c66 2e72 625f 6873 7629 0d0a 2020  self.rb_hsv)..  
-000819e0: 2020 2020 2020 7662 6f78 2e61 6464 5769        vbox.addWi
-000819f0: 6467 6574 2873 656c 662e 7262 5f70 696e  dget(self.rb_pin
-00081a00: 6b29 0d0a 2020 2020 2020 2020 7662 6f78  k)..        vbox
-00081a10: 2e61 6464 5769 6467 6574 2873 656c 662e  .addWidget(self.
-00081a20: 7262 5f70 7269 736d 290d 0a20 2020 2020  rb_prism)..     
-00081a30: 2020 2076 626f 782e 6164 6457 6964 6765     vbox.addWidge
-00081a40: 7428 7365 6c66 2e72 625f 7370 7269 6e67  t(self.rb_spring
-00081a50: 290d 0a20 2020 2020 2020 2076 626f 782e  )..        vbox.
-00081a60: 6164 6457 6964 6765 7428 7365 6c66 2e72  addWidget(self.r
-00081a70: 625f 7375 6d6d 6572 290d 0a20 2020 2020  b_summer)..     
-00081a80: 2020 2076 626f 782e 6164 6457 6964 6765     vbox.addWidge
-00081a90: 7428 7365 6c66 2e72 625f 7769 6e74 6572  t(self.rb_winter
-00081aa0: 290d 0a20 2020 2020 2020 2076 626f 782e  )..        vbox.
-00081ab0: 6164 6457 6964 6765 7428 7365 6c66 2e72  addWidget(self.r
-00081ac0: 625f 7370 6563 7472 616c 290d 0a0d 0a20  b_spectral).... 
-00081ad0: 2020 2020 2020 2073 697a 6572 312e 7365         sizer1.se
-00081ae0: 744c 6179 6f75 7428 7662 6f78 290d 0a20  tLayout(vbox).. 
-00081af0: 2020 2020 2020 2076 626f 7874 6f70 2e61         vboxtop.a
-00081b00: 6464 5769 6467 6574 2873 697a 6572 3129  ddWidget(sizer1)
-00081b10: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6275  ......        bu
-00081b20: 7474 6f6e 5f63 6c6f 7365 203d 2051 7457  tton_close = QtW
-00081b30: 6964 6765 7473 2e51 5075 7368 4275 7474  idgets.QPushButt
-00081b40: 6f6e 2827 436c 6f73 6527 290d 0a20 2020  on('Close')..   
-00081b50: 2020 2020 2062 7574 746f 6e5f 636c 6f73       button_clos
-00081b60: 652e 636c 6963 6b65 642e 636f 6e6e 6563  e.clicked.connec
-00081b70: 7428 7365 6c66 2e63 6c6f 7365 290d 0a20  t(self.close).. 
-00081b80: 2020 2020 2020 2076 626f 7874 6f70 2e61         vboxtop.a
-00081b90: 6464 5769 6467 6574 2862 7574 746f 6e5f  ddWidget(button_
-00081ba0: 636c 6f73 6529 0d0a 0d0a 2020 2020 2020  close)....      
-00081bb0: 2020 7365 6c66 2e73 6574 4c61 796f 7574    self.setLayout
-00081bc0: 2876 626f 7874 6f70 290d 0a0d 0a20 2020  (vboxtop)....   
-00081bd0: 2020 2020 2073 656c 662e 6374 5f64 6963       self.ct_dic
-00081be0: 745b 7365 6c66 2e70 6172 656e 742e 7061  t[self.parent.pa
-00081bf0: 6765 312e 636f 6c6f 7274 6162 6c65 5d2e  ge1.colortable].
-00081c00: 7365 7443 6865 636b 6564 2854 7275 6529  setChecked(True)
-00081c10: 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d  ......#---------
-00081c20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00081c30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00081c40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00081c50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20  -------------.. 
-00081c60: 2020 2064 6566 204f 6e43 6f6c 6f72 5461     def OnColorTa
-00081c70: 626c 6528 7365 6c66 2c20 6576 656e 7429  ble(self, event)
-00081c80: 3a0d 0a0d 0a20 2020 2020 2020 2066 6f72  :....        for
-00081c90: 2072 6164 696f 4275 7474 6f6e 2069 6e20   radioButton in 
-00081ca0: 7365 6c66 2e66 696e 6443 6869 6c64 7265  self.findChildre
-00081cb0: 6e28 5174 5769 6467 6574 732e 5152 6164  n(QtWidgets.QRad
-00081cc0: 696f 4275 7474 6f6e 293a 0d0a 2020 2020  ioButton):..    
-00081cd0: 2020 2020 2020 2020 6966 2072 6164 696f          if radio
-00081ce0: 4275 7474 6f6e 2e69 7343 6865 636b 6564  Button.isChecked
-00081cf0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-00081d00: 2020 2020 2072 6164 696f 4275 7474 6f6e       radioButton
-00081d10: 5465 7874 203d 2072 6164 696f 4275 7474  Text = radioButt
-00081d20: 6f6e 2e74 6578 7428 290d 0a20 2020 2020  on.text()..     
-00081d30: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00081d40: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7365  ......        se
-00081d50: 6c66 2e70 6172 656e 742e 7061 6765 312e  lf.parent.page1.
-00081d60: 636f 6c6f 7274 6162 6c65 203d 2073 7472  colortable = str
-00081d70: 2872 6164 696f 4275 7474 6f6e 5465 7874  (radioButtonText
-00081d80: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-00081d90: 662e 7061 7265 6e74 2e70 6167 6531 2e6c  f.parent.page1.l
-00081da0: 6f61 6449 6d61 6765 2829 0d0a 0d0a 0d0a  oadImage()......
-00081db0: 0d0a 2222 2220 2d2d 2d2d 2d2d 2d2d 2d2d  ..""" ----------
-00081dc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00081dd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00081de0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00081df0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00081e00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00081e10: 2d2d 2d2d 2d2d 2222 220d 0a0d 0a63 6c61  ------"""....cla
-00081e20: 7373 2050 6167 654c 6f61 6444 6174 6128  ss PageLoadData(
-00081e30: 5174 5769 6467 6574 732e 5157 6964 6765  QtWidgets.QWidge
-00081e40: 7429 3a0d 0a20 2020 2064 6566 205f 5f69  t):..    def __i
-00081e50: 6e69 745f 5f28 7365 6c66 2c20 636f 6d6d  nit__(self, comm
-00081e60: 6f6e 2c20 6461 7461 5f73 7472 7563 742c  on, data_struct,
-00081e70: 2073 7461 636b 293a 0d0a 2020 2020 2020   stack):..      
-00081e80: 2020 7375 7065 7228 5061 6765 4c6f 6164    super(PageLoad
-00081e90: 4461 7461 2c20 7365 6c66 292e 5f5f 696e  Data, self).__in
-00081ea0: 6974 5f5f 2829 0d0a 2020 2020 2020 2020  it__()..        
-00081eb0: 7569 632e 6c6f 6164 5569 286f 732e 7061  uic.loadUi(os.pa
-00081ec0: 7468 2e6a 6f69 6e28 6f73 2e70 6174 682e  th.join(os.path.
-00081ed0: 6469 726e 616d 6528 6f73 2e70 6174 682e  dirname(os.path.
-00081ee0: 6162 7370 6174 6828 5f5f 6669 6c65 5f5f  abspath(__file__
-00081ef0: 2929 2c20 2770 6167 656c 6f61 6464 6174  )), 'pageloaddat
-00081f00: 612e 7569 2729 2c20 7365 6c66 290d 0a20  a.ui'), self).. 
-00081f10: 2020 2020 2020 2073 656c 662e 7368 6f77         self.show
-00081f20: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
-00081f30: 2e63 6d61 7073 203d 205b 2827 5065 7263  .cmaps = [('Perc
-00081f40: 6570 7475 616c 6c79 2055 6e69 666f 726d  eptually Uniform
-00081f50: 2053 6571 7565 6e74 6961 6c27 2c20 5b0d   Sequential', [.
-00081f60: 0a20 2020 2020 2020 2020 2020 2027 7669  .            'vi
-00081f70: 7269 6469 7327 2c20 2770 6c61 736d 6127  ridis', 'plasma'
-00081f80: 2c20 2769 6e66 6572 6e6f 272c 2027 6d61  , 'inferno', 'ma
-00081f90: 676d 6127 5d29 2c0d 0a20 2020 2020 2020  gma']),..       
-00081fa0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00081fb0: 2753 6571 7565 6e74 6961 6c27 2c20 5b0d  'Sequential', [.
-00081fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00081fd0: 2020 2020 2020 2020 2020 2027 4772 6579             'Grey
-00081fe0: 7327 2c20 2750 7572 706c 6573 272c 2027  s', 'Purples', '
-00081ff0: 426c 7565 7327 2c20 2747 7265 656e 7327  Blues', 'Greens'
-00082000: 2c20 274f 7261 6e67 6573 272c 2027 5265  , 'Oranges', 'Re
-00082010: 6473 272c 0d0a 2020 2020 2020 2020 2020  ds',..          
-00082020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082030: 2759 6c4f 7242 7227 2c20 2759 6c4f 7252  'YlOrBr', 'YlOrR
-00082040: 6427 2c20 274f 7252 6427 2c20 2750 7552  d', 'OrRd', 'PuR
-00082050: 6427 2c20 2752 6450 7527 2c20 2742 7550  d', 'RdPu', 'BuP
-00082060: 7527 2c0d 0a20 2020 2020 2020 2020 2020  u',..           
-00082070: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00082080: 476e 4275 272c 2027 5075 4275 272c 2027  GnBu', 'PuBu', '
-00082090: 596c 476e 4275 272c 2027 5075 4275 476e  YlGnBu', 'PuBuGn
-000820a0: 272c 2027 4275 476e 272c 2027 596c 476e  ', 'BuGn', 'YlGn
-000820b0: 275d 292c 0d0a 2020 2020 2020 2020 2020  ']),..          
-000820c0: 2020 2020 2020 2020 2020 2020 2827 5365              ('Se
-000820d0: 7175 656e 7469 616c 2028 3229 272c 205b  quential (2)', [
-000820e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000820f0: 2020 2020 2020 2020 2020 2020 2762 696e              'bin
-00082100: 6172 7927 2c20 2767 6973 745f 7961 7267  ary', 'gist_yarg
-00082110: 272c 2027 6769 7374 5f67 7261 7927 2c20  ', 'gist_gray', 
-00082120: 2767 7261 7927 2c20 2762 6f6e 6527 2c20  'gray', 'bone', 
-00082130: 2770 696e 6b27 2c0d 0a20 2020 2020 2020  'pink',..       
-00082140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082150: 2020 2027 7370 7269 6e67 272c 2027 7375     'spring', 'su
-00082160: 6d6d 6572 272c 2027 6175 7475 6d6e 272c  mmer', 'autumn',
-00082170: 2027 7769 6e74 6572 272c 2027 636f 6f6c   'winter', 'cool
-00082180: 272c 2027 5769 7374 6961 272c 0d0a 2020  ', 'Wistia',..  
+000813d0: 6c66 2e72 625f 686f 7429 0d0a 2020 2020  lf.rb_hot)..    
+000813e0: 2020 2020 7365 6c66 2e72 6164 696f 732e      self.radios.
+000813f0: 6170 7065 6e64 2873 656c 662e 7262 5f68  append(self.rb_h
+00081400: 7376 290d 0a20 2020 2020 2020 2073 656c  sv)..        sel
+00081410: 662e 7261 6469 6f73 2e61 7070 656e 6428  f.radios.append(
+00081420: 7365 6c66 2e72 625f 7069 6e6b 290d 0a20  self.rb_pink).. 
+00081430: 2020 2020 2020 2073 656c 662e 7261 6469         self.radi
+00081440: 6f73 2e61 7070 656e 6428 7365 6c66 2e72  os.append(self.r
+00081450: 625f 7072 6973 6d29 0d0a 2020 2020 2020  b_prism)..      
+00081460: 2020 7365 6c66 2e72 6164 696f 732e 6170    self.radios.ap
+00081470: 7065 6e64 2873 656c 662e 7262 5f73 7072  pend(self.rb_spr
+00081480: 696e 6729 0d0a 2020 2020 2020 2020 7365  ing)..        se
+00081490: 6c66 2e72 6164 696f 732e 6170 7065 6e64  lf.radios.append
+000814a0: 2873 656c 662e 7262 5f73 756d 6d65 7229  (self.rb_summer)
+000814b0: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+000814c0: 6164 696f 732e 6170 7065 6e64 2873 656c  adios.append(sel
+000814d0: 662e 7262 5f77 696e 7465 7229 0d0a 2020  f.rb_winter)..  
+000814e0: 2020 2020 2020 7365 6c66 2e72 6164 696f        self.radio
+000814f0: 732e 6170 7065 6e64 2873 656c 662e 7262  s.append(self.rb
+00081500: 5f73 7065 6374 7261 6c29 0d0a 0d0a 2020  _spectral)....  
+00081510: 2020 2020 2020 7365 6c66 2e63 745f 6469        self.ct_di
+00081520: 6374 203d 2064 6963 7428 5b28 7365 6c66  ct = dict([(self
+00081530: 2e63 6f6c 6f72 735b 785d 2c20 7365 6c66  .colors[x], self
+00081540: 2e72 6164 696f 735b 785d 2920 666f 7220  .radios[x]) for 
+00081550: 7820 696e 2072 616e 6765 286c 656e 2873  x in range(len(s
+00081560: 656c 662e 636f 6c6f 7273 2929 5d29 0d0a  elf.colors))])..
+00081570: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00081580: 2e72 625f 6772 6579 2e63 6c69 636b 6564  .rb_grey.clicked
+00081590: 2e63 6f6e 6e65 6374 2873 656c 662e 4f6e  .connect(self.On
+000815a0: 436f 6c6f 7254 6162 6c65 290d 0a20 2020  ColorTable)..   
+000815b0: 2020 2020 2073 656c 662e 7262 5f6a 6574       self.rb_jet
+000815c0: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
+000815d0: 2873 656c 662e 4f6e 436f 6c6f 7254 6162  (self.OnColorTab
+000815e0: 6c65 290d 0a20 2020 2020 2020 2073 656c  le)..        sel
+000815f0: 662e 7262 5f61 7574 756d 6e2e 636c 6963  f.rb_autumn.clic
+00081600: 6b65 642e 636f 6e6e 6563 7428 7365 6c66  ked.connect(self
+00081610: 2e4f 6e43 6f6c 6f72 5461 626c 6529 0d0a  .OnColorTable)..
+00081620: 2020 2020 2020 2020 7365 6c66 2e72 625f          self.rb_
+00081630: 626f 6e65 2e63 6c69 636b 6564 2e63 6f6e  bone.clicked.con
+00081640: 6e65 6374 2873 656c 662e 4f6e 436f 6c6f  nect(self.OnColo
+00081650: 7254 6162 6c65 290d 0a20 2020 2020 2020  rTable)..       
+00081660: 2073 656c 662e 7262 5f63 6f6f 6c2e 636c   self.rb_cool.cl
+00081670: 6963 6b65 642e 636f 6e6e 6563 7428 7365  icked.connect(se
+00081680: 6c66 2e4f 6e43 6f6c 6f72 5461 626c 6529  lf.OnColorTable)
+00081690: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+000816a0: 625f 636f 7070 6572 2e63 6c69 636b 6564  b_copper.clicked
+000816b0: 2e63 6f6e 6e65 6374 2873 656c 662e 4f6e  .connect(self.On
+000816c0: 436f 6c6f 7254 6162 6c65 290d 0a20 2020  ColorTable)..   
+000816d0: 2020 2020 2073 656c 662e 7262 5f66 6c61       self.rb_fla
+000816e0: 672e 636c 6963 6b65 642e 636f 6e6e 6563  g.clicked.connec
+000816f0: 7428 7365 6c66 2e4f 6e43 6f6c 6f72 5461  t(self.OnColorTa
+00081700: 626c 6529 0d0a 2020 2020 2020 2020 7365  ble)..        se
+00081710: 6c66 2e72 625f 686f 742e 636c 6963 6b65  lf.rb_hot.clicke
+00081720: 642e 636f 6e6e 6563 7428 7365 6c66 2e4f  d.connect(self.O
+00081730: 6e43 6f6c 6f72 5461 626c 6529 0d0a 2020  nColorTable)..  
+00081740: 2020 2020 2020 7365 6c66 2e72 625f 6873        self.rb_hs
+00081750: 762e 636c 6963 6b65 642e 636f 6e6e 6563  v.clicked.connec
+00081760: 7428 7365 6c66 2e4f 6e43 6f6c 6f72 5461  t(self.OnColorTa
+00081770: 626c 6529 0d0a 2020 2020 2020 2020 7365  ble)..        se
+00081780: 6c66 2e72 625f 7069 6e6b 2e63 6c69 636b  lf.rb_pink.click
+00081790: 6564 2e63 6f6e 6e65 6374 2873 656c 662e  ed.connect(self.
+000817a0: 4f6e 436f 6c6f 7254 6162 6c65 290d 0a20  OnColorTable).. 
+000817b0: 2020 2020 2020 2073 656c 662e 7262 5f70         self.rb_p
+000817c0: 7269 736d 2e63 6c69 636b 6564 2e63 6f6e  rism.clicked.con
+000817d0: 6e65 6374 2873 656c 662e 4f6e 436f 6c6f  nect(self.OnColo
+000817e0: 7254 6162 6c65 290d 0a20 2020 2020 2020  rTable)..       
+000817f0: 2073 656c 662e 7262 5f73 7072 696e 672e   self.rb_spring.
+00081800: 636c 6963 6b65 642e 636f 6e6e 6563 7428  clicked.connect(
+00081810: 7365 6c66 2e4f 6e43 6f6c 6f72 5461 626c  self.OnColorTabl
+00081820: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
+00081830: 2e72 625f 7375 6d6d 6572 2e63 6c69 636b  .rb_summer.click
+00081840: 6564 2e63 6f6e 6e65 6374 2873 656c 662e  ed.connect(self.
+00081850: 4f6e 436f 6c6f 7254 6162 6c65 290d 0a20  OnColorTable).. 
+00081860: 2020 2020 2020 2073 656c 662e 7262 5f77         self.rb_w
+00081870: 696e 7465 722e 636c 6963 6b65 642e 636f  inter.clicked.co
+00081880: 6e6e 6563 7428 7365 6c66 2e4f 6e43 6f6c  nnect(self.OnCol
+00081890: 6f72 5461 626c 6529 0d0a 2020 2020 2020  orTable)..      
+000818a0: 2020 7365 6c66 2e72 625f 7370 6563 7472    self.rb_spectr
+000818b0: 616c 2e63 6c69 636b 6564 2e63 6f6e 6e65  al.clicked.conne
+000818c0: 6374 2873 656c 662e 4f6e 436f 6c6f 7254  ct(self.OnColorT
+000818d0: 6162 6c65 290d 0a0d 0a20 2020 2020 2020  able)....       
+000818e0: 2076 626f 782e 6164 6457 6964 6765 7428   vbox.addWidget(
+000818f0: 7365 6c66 2e72 625f 6772 6579 290d 0a20  self.rb_grey).. 
+00081900: 2020 2020 2020 2076 626f 782e 6164 6457         vbox.addW
+00081910: 6964 6765 7428 7365 6c66 2e72 625f 6a65  idget(self.rb_je
+00081920: 7429 0d0a 2020 2020 2020 2020 7662 6f78  t)..        vbox
+00081930: 2e61 6464 5769 6467 6574 2873 656c 662e  .addWidget(self.
+00081940: 7262 5f61 7574 756d 6e29 0d0a 2020 2020  rb_autumn)..    
+00081950: 2020 2020 7662 6f78 2e61 6464 5769 6467      vbox.addWidg
+00081960: 6574 2873 656c 662e 7262 5f62 6f6e 6529  et(self.rb_bone)
+00081970: 0d0a 2020 2020 2020 2020 7662 6f78 2e61  ..        vbox.a
+00081980: 6464 5769 6467 6574 2873 656c 662e 7262  ddWidget(self.rb
+00081990: 5f63 6f6f 6c29 0d0a 2020 2020 2020 2020  _cool)..        
+000819a0: 7662 6f78 2e61 6464 5769 6467 6574 2873  vbox.addWidget(s
+000819b0: 656c 662e 7262 5f63 6f70 7065 7229 0d0a  elf.rb_copper)..
+000819c0: 2020 2020 2020 2020 7662 6f78 2e61 6464          vbox.add
+000819d0: 5769 6467 6574 2873 656c 662e 7262 5f66  Widget(self.rb_f
+000819e0: 6c61 6729 0d0a 2020 2020 2020 2020 7662  lag)..        vb
+000819f0: 6f78 2e61 6464 5769 6467 6574 2873 656c  ox.addWidget(sel
+00081a00: 662e 7262 5f68 6f74 290d 0a20 2020 2020  f.rb_hot)..     
+00081a10: 2020 2076 626f 782e 6164 6457 6964 6765     vbox.addWidge
+00081a20: 7428 7365 6c66 2e72 625f 6873 7629 0d0a  t(self.rb_hsv)..
+00081a30: 2020 2020 2020 2020 7662 6f78 2e61 6464          vbox.add
+00081a40: 5769 6467 6574 2873 656c 662e 7262 5f70  Widget(self.rb_p
+00081a50: 696e 6b29 0d0a 2020 2020 2020 2020 7662  ink)..        vb
+00081a60: 6f78 2e61 6464 5769 6467 6574 2873 656c  ox.addWidget(sel
+00081a70: 662e 7262 5f70 7269 736d 290d 0a20 2020  f.rb_prism)..   
+00081a80: 2020 2020 2076 626f 782e 6164 6457 6964       vbox.addWid
+00081a90: 6765 7428 7365 6c66 2e72 625f 7370 7269  get(self.rb_spri
+00081aa0: 6e67 290d 0a20 2020 2020 2020 2076 626f  ng)..        vbo
+00081ab0: 782e 6164 6457 6964 6765 7428 7365 6c66  x.addWidget(self
+00081ac0: 2e72 625f 7375 6d6d 6572 290d 0a20 2020  .rb_summer)..   
+00081ad0: 2020 2020 2076 626f 782e 6164 6457 6964       vbox.addWid
+00081ae0: 6765 7428 7365 6c66 2e72 625f 7769 6e74  get(self.rb_wint
+00081af0: 6572 290d 0a20 2020 2020 2020 2076 626f  er)..        vbo
+00081b00: 782e 6164 6457 6964 6765 7428 7365 6c66  x.addWidget(self
+00081b10: 2e72 625f 7370 6563 7472 616c 290d 0a0d  .rb_spectral)...
+00081b20: 0a20 2020 2020 2020 2073 697a 6572 312e  .        sizer1.
+00081b30: 7365 744c 6179 6f75 7428 7662 6f78 290d  setLayout(vbox).
+00081b40: 0a20 2020 2020 2020 2076 626f 7874 6f70  .        vboxtop
+00081b50: 2e61 6464 5769 6467 6574 2873 697a 6572  .addWidget(sizer
+00081b60: 3129 0d0a 0d0a 0d0a 2020 2020 2020 2020  1)......        
+00081b70: 6275 7474 6f6e 5f63 6c6f 7365 203d 2051  button_close = Q
+00081b80: 7457 6964 6765 7473 2e51 5075 7368 4275  tWidgets.QPushBu
+00081b90: 7474 6f6e 2827 436c 6f73 6527 290d 0a20  tton('Close').. 
+00081ba0: 2020 2020 2020 2062 7574 746f 6e5f 636c         button_cl
+00081bb0: 6f73 652e 636c 6963 6b65 642e 636f 6e6e  ose.clicked.conn
+00081bc0: 6563 7428 7365 6c66 2e63 6c6f 7365 290d  ect(self.close).
+00081bd0: 0a20 2020 2020 2020 2076 626f 7874 6f70  .        vboxtop
+00081be0: 2e61 6464 5769 6467 6574 2862 7574 746f  .addWidget(butto
+00081bf0: 6e5f 636c 6f73 6529 0d0a 0d0a 2020 2020  n_close)....    
+00081c00: 2020 2020 7365 6c66 2e73 6574 4c61 796f      self.setLayo
+00081c10: 7574 2876 626f 7874 6f70 290d 0a0d 0a20  ut(vboxtop).... 
+00081c20: 2020 2020 2020 2073 656c 662e 6374 5f64         self.ct_d
+00081c30: 6963 745b 7365 6c66 2e70 6172 656e 742e  ict[self.parent.
+00081c40: 7061 6765 312e 636f 6c6f 7274 6162 6c65  page1.colortable
+00081c50: 5d2e 7365 7443 6865 636b 6564 2854 7275  ].setChecked(Tru
+00081c60: 6529 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d  e)......#-------
+00081c70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00081c80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00081c90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00081ca0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
+00081cb0: 0a20 2020 2064 6566 204f 6e43 6f6c 6f72  .    def OnColor
+00081cc0: 5461 626c 6528 7365 6c66 2c20 6576 656e  Table(self, even
+00081cd0: 7429 3a0d 0a0d 0a20 2020 2020 2020 2066  t):....        f
+00081ce0: 6f72 2072 6164 696f 4275 7474 6f6e 2069  or radioButton i
+00081cf0: 6e20 7365 6c66 2e66 696e 6443 6869 6c64  n self.findChild
+00081d00: 7265 6e28 5174 5769 6467 6574 732e 5152  ren(QtWidgets.QR
+00081d10: 6164 696f 4275 7474 6f6e 293a 0d0a 2020  adioButton):..  
+00081d20: 2020 2020 2020 2020 2020 6966 2072 6164            if rad
+00081d30: 696f 4275 7474 6f6e 2e69 7343 6865 636b  ioButton.isCheck
+00081d40: 6564 2829 3a0d 0a20 2020 2020 2020 2020  ed():..         
+00081d50: 2020 2020 2020 2072 6164 696f 4275 7474         radioButt
+00081d60: 6f6e 5465 7874 203d 2072 6164 696f 4275  onText = radioBu
+00081d70: 7474 6f6e 2e74 6578 7428 290d 0a20 2020  tton.text()..   
+00081d80: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+00081d90: 616b 0d0a 0d0a 0d0a 2020 2020 2020 2020  ak......        
+00081da0: 7365 6c66 2e70 6172 656e 742e 7061 6765  self.parent.page
+00081db0: 312e 636f 6c6f 7274 6162 6c65 203d 2073  1.colortable = s
+00081dc0: 7472 2872 6164 696f 4275 7474 6f6e 5465  tr(radioButtonTe
+00081dd0: 7874 290d 0a0d 0a20 2020 2020 2020 2073  xt)....        s
+00081de0: 656c 662e 7061 7265 6e74 2e70 6167 6531  elf.parent.page1
+00081df0: 2e6c 6f61 6449 6d61 6765 2829 0d0a 0d0a  .loadImage()....
+00081e00: 0d0a 0d0a 2222 2220 2d2d 2d2d 2d2d 2d2d  ....""" --------
+00081e10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00081e20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00081e30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00081e40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00081e50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00081e60: 2d2d 2d2d 2d2d 2d2d 2222 220d 0a0d 0a63  --------"""....c
+00081e70: 6c61 7373 2050 6167 654c 6f61 6444 6174  lass PageLoadDat
+00081e80: 6128 5174 5769 6467 6574 732e 5157 6964  a(QtWidgets.QWid
+00081e90: 6765 7429 3a0d 0a20 2020 2064 6566 205f  get):..    def _
+00081ea0: 5f69 6e69 745f 5f28 7365 6c66 2c20 636f  _init__(self, co
+00081eb0: 6d6d 6f6e 2c20 6461 7461 5f73 7472 7563  mmon, data_struc
+00081ec0: 742c 2073 7461 636b 293a 0d0a 2020 2020  t, stack):..    
+00081ed0: 2020 2020 7375 7065 7228 5061 6765 4c6f      super(PageLo
+00081ee0: 6164 4461 7461 2c20 7365 6c66 292e 5f5f  adData, self).__
+00081ef0: 696e 6974 5f5f 2829 0d0a 2020 2020 2020  init__()..      
+00081f00: 2020 7569 632e 6c6f 6164 5569 286f 732e    uic.loadUi(os.
+00081f10: 7061 7468 2e6a 6f69 6e28 6f73 2e70 6174  path.join(os.pat
+00081f20: 682e 6469 726e 616d 6528 6f73 2e70 6174  h.dirname(os.pat
+00081f30: 682e 6162 7370 6174 6828 5f5f 6669 6c65  h.abspath(__file
+00081f40: 5f5f 2929 2c20 2770 6167 656c 6f61 6464  __)), 'pageloadd
+00081f50: 6174 612e 7569 2729 2c20 7365 6c66 290d  ata.ui'), self).
+00081f60: 0a20 2020 2020 2020 2073 656c 662e 7368  .        self.sh
+00081f70: 6f77 2829 0d0a 2020 2020 2020 2020 7365  ow()..        se
+00081f80: 6c66 2e63 6d61 7073 203d 205b 2827 5065  lf.cmaps = [('Pe
+00081f90: 7263 6570 7475 616c 6c79 2055 6e69 666f  rceptually Unifo
+00081fa0: 726d 2053 6571 7565 6e74 6961 6c27 2c20  rm Sequential', 
+00081fb0: 5b0d 0a20 2020 2020 2020 2020 2020 2027  [..            '
+00081fc0: 7669 7269 6469 7327 2c20 2770 6c61 736d  viridis', 'plasm
+00081fd0: 6127 2c20 2769 6e66 6572 6e6f 272c 2027  a', 'inferno', '
+00081fe0: 6d61 676d 6127 5d29 2c0d 0a20 2020 2020  magma']),..     
+00081ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082000: 2028 2753 6571 7565 6e74 6961 6c27 2c20   ('Sequential', 
+00082010: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
+00082020: 2020 2020 2020 2020 2020 2020 2027 4772               'Gr
+00082030: 6579 7327 2c20 2750 7572 706c 6573 272c  eys', 'Purples',
+00082040: 2027 426c 7565 7327 2c20 2747 7265 656e   'Blues', 'Green
+00082050: 7327 2c20 274f 7261 6e67 6573 272c 2027  s', 'Oranges', '
+00082060: 5265 6473 272c 0d0a 2020 2020 2020 2020  Reds',..        
+00082070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082080: 2020 2759 6c4f 7242 7227 2c20 2759 6c4f    'YlOrBr', 'YlO
+00082090: 7252 6427 2c20 274f 7252 6427 2c20 2750  rRd', 'OrRd', 'P
+000820a0: 7552 6427 2c20 2752 6450 7527 2c20 2742  uRd', 'RdPu', 'B
+000820b0: 7550 7527 2c0d 0a20 2020 2020 2020 2020  uPu',..         
+000820c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000820d0: 2027 476e 4275 272c 2027 5075 4275 272c   'GnBu', 'PuBu',
+000820e0: 2027 596c 476e 4275 272c 2027 5075 4275   'YlGnBu', 'PuBu
+000820f0: 476e 272c 2027 4275 476e 272c 2027 596c  Gn', 'BuGn', 'Yl
+00082100: 476e 275d 292c 0d0a 2020 2020 2020 2020  Gn']),..        
+00082110: 2020 2020 2020 2020 2020 2020 2020 2827                ('
+00082120: 5365 7175 656e 7469 616c 2028 3229 272c  Sequential (2)',
+00082130: 205b 0d0a 2020 2020 2020 2020 2020 2020   [..            
+00082140: 2020 2020 2020 2020 2020 2020 2020 2762                'b
+00082150: 696e 6172 7927 2c20 2767 6973 745f 7961  inary', 'gist_ya
+00082160: 7267 272c 2027 6769 7374 5f67 7261 7927  rg', 'gist_gray'
+00082170: 2c20 2767 7261 7927 2c20 2762 6f6e 6527  , 'gray', 'bone'
+00082180: 2c20 2770 696e 6b27 2c0d 0a20 2020 2020  , 'pink',..     
 00082190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000821a0: 2020 2020 2020 2020 2768 6f74 272c 2027          'hot', '
-000821b0: 6166 6d68 6f74 272c 2027 6769 7374 5f68  afmhot', 'gist_h
-000821c0: 6561 7427 2c20 2763 6f70 7065 7227 5d29  eat', 'copper'])
-000821d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000821e0: 2020 2020 2020 2020 2028 2744 6976 6572           ('Diver
-000821f0: 6769 6e67 272c 205b 0d0a 2020 2020 2020  ging', [..      
-00082200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082210: 2020 2020 2750 6959 4727 2c20 2750 5247      'PiYG', 'PRG
-00082220: 6e27 2c20 2742 7242 4727 2c20 2750 754f  n', 'BrBG', 'PuO
-00082230: 7227 2c20 2752 6447 7927 2c20 2752 6442  r', 'RdGy', 'RdB
-00082240: 7527 2c0d 0a20 2020 2020 2020 2020 2020  u',..           
-00082250: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00082260: 5264 596c 4275 272c 2027 5264 596c 476e  RdYlBu', 'RdYlGn
-00082270: 272c 2027 5370 6563 7472 616c 272c 2027  ', 'Spectral', '
-00082280: 636f 6f6c 7761 726d 272c 2027 6277 7227  coolwarm', 'bwr'
-00082290: 2c20 2773 6569 736d 6963 275d 292c 0d0a  , 'seismic']),..
+000821a0: 2020 2020 2027 7370 7269 6e67 272c 2027       'spring', '
+000821b0: 7375 6d6d 6572 272c 2027 6175 7475 6d6e  summer', 'autumn
+000821c0: 272c 2027 7769 6e74 6572 272c 2027 636f  ', 'winter', 'co
+000821d0: 6f6c 272c 2027 5769 7374 6961 272c 0d0a  ol', 'Wistia',..
+000821e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000821f0: 2020 2020 2020 2020 2020 2768 6f74 272c            'hot',
+00082200: 2027 6166 6d68 6f74 272c 2027 6769 7374   'afmhot', 'gist
+00082210: 5f68 6561 7427 2c20 2763 6f70 7065 7227  _heat', 'copper'
+00082220: 5d29 2c0d 0a20 2020 2020 2020 2020 2020  ]),..           
+00082230: 2020 2020 2020 2020 2020 2028 2744 6976             ('Div
+00082240: 6572 6769 6e67 272c 205b 0d0a 2020 2020  erging', [..    
+00082250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082260: 2020 2020 2020 2750 6959 4727 2c20 2750        'PiYG', 'P
+00082270: 5247 6e27 2c20 2742 7242 4727 2c20 2750  RGn', 'BrBG', 'P
+00082280: 754f 7227 2c20 2752 6447 7927 2c20 2752  uOr', 'RdGy', 'R
+00082290: 6442 7527 2c0d 0a20 2020 2020 2020 2020  dBu',..         
 000822a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000822b0: 2020 2020 2020 2827 5175 616c 6974 6174        ('Qualitat
-000822c0: 6976 6527 2c20 5b0d 0a20 2020 2020 2020  ive', [..       
-000822d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000822e0: 2020 2027 5061 7374 656c 3127 2c20 2750     'Pastel1', 'P
-000822f0: 6173 7465 6c32 272c 2027 5061 6972 6564  astel2', 'Paired
-00082300: 272c 2027 4163 6365 6e74 272c 0d0a 2020  ', 'Accent',..  
-00082310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082320: 2020 2020 2020 2020 2744 6172 6b32 272c          'Dark2',
-00082330: 2027 5365 7431 272c 2027 5365 7432 272c   'Set1', 'Set2',
-00082340: 2027 5365 7433 272c 0d0a 2020 2020 2020   'Set3',..      
-00082350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082360: 2020 2020 2774 6162 3130 272c 2027 7461      'tab10', 'ta
-00082370: 6232 3027 2c20 2774 6162 3230 6227 2c20  b20', 'tab20b', 
-00082380: 2774 6162 3230 6327 5d29 2c0d 0a20 2020  'tab20c']),..   
-00082390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000823a0: 2020 2028 274d 6973 6365 6c6c 616e 656f     ('Miscellaneo
-000823b0: 7573 272c 205b 0d0a 2020 2020 2020 2020  us', [..        
-000823c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000823d0: 2020 2766 6c61 6727 2c20 2770 7269 736d    'flag', 'prism
-000823e0: 272c 2027 6f63 6561 6e27 2c20 2767 6973  ', 'ocean', 'gis
-000823f0: 745f 6561 7274 6827 2c20 2774 6572 7261  t_earth', 'terra
-00082400: 696e 272c 2027 6769 7374 5f73 7465 726e  in', 'gist_stern
-00082410: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-00082420: 2020 2020 2020 2020 2020 2020 2020 2767                'g
-00082430: 6e75 706c 6f74 272c 2027 676e 7570 6c6f  nuplot', 'gnuplo
-00082440: 7432 272c 2027 434d 526d 6170 272c 2027  t2', 'CMRmap', '
-00082450: 6375 6265 6865 6c69 7827 2c20 2762 7267  cubehelix', 'brg
-00082460: 272c 2027 6873 7627 2c0d 0a20 2020 2020  ', 'hsv',..     
+000822b0: 2027 5264 596c 4275 272c 2027 5264 596c   'RdYlBu', 'RdYl
+000822c0: 476e 272c 2027 5370 6563 7472 616c 272c  Gn', 'Spectral',
+000822d0: 2027 636f 6f6c 7761 726d 272c 2027 6277   'coolwarm', 'bw
+000822e0: 7227 2c20 2773 6569 736d 6963 275d 292c  r', 'seismic']),
+000822f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00082300: 2020 2020 2020 2020 2827 5175 616c 6974          ('Qualit
+00082310: 6174 6976 6527 2c20 5b0d 0a20 2020 2020  ative', [..     
+00082320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082330: 2020 2020 2027 5061 7374 656c 3127 2c20       'Pastel1', 
+00082340: 2750 6173 7465 6c32 272c 2027 5061 6972  'Pastel2', 'Pair
+00082350: 6564 272c 2027 4163 6365 6e74 272c 0d0a  ed', 'Accent',..
+00082360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082370: 2020 2020 2020 2020 2020 2744 6172 6b32            'Dark2
+00082380: 272c 2027 5365 7431 272c 2027 5365 7432  ', 'Set1', 'Set2
+00082390: 272c 2027 5365 7433 272c 0d0a 2020 2020  ', 'Set3',..    
+000823a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000823b0: 2020 2020 2020 2774 6162 3130 272c 2027        'tab10', '
+000823c0: 7461 6232 3027 2c20 2774 6162 3230 6227  tab20', 'tab20b'
+000823d0: 2c20 2774 6162 3230 6327 5d29 2c0d 0a20  , 'tab20c']),.. 
+000823e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000823f0: 2020 2020 2028 274d 6973 6365 6c6c 616e       ('Miscellan
+00082400: 656f 7573 272c 205b 0d0a 2020 2020 2020  eous', [..      
+00082410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00082420: 2020 2020 2766 6c61 6727 2c20 2770 7269      'flag', 'pri
+00082430: 736d 272c 2027 6f63 6561 6e27 2c20 2767  sm', 'ocean', 'g
+00082440: 6973 745f 6561 7274 6827 2c20 2774 6572  ist_earth', 'ter
+00082450: 7261 696e 272c 2027 6769 7374 5f73 7465  rain', 'gist_ste
+00082460: 726e 272c 0d0a 2020 2020 2020 2020 2020  rn',..          
 00082470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00082480: 2020 2020 2027 6769 7374 5f72 6169 6e62       'gist_rainb
-00082490: 6f77 272c 2027 7261 696e 626f 7727 2c20  ow', 'rainbow', 
-000824a0: 276a 6574 272c 2027 6e69 7079 5f73 7065  'jet', 'nipy_spe
-000824b0: 6374 7261 6c27 2c20 2767 6973 745f 6e63  ctral', 'gist_nc
-000824c0: 6172 275d 295d 0d0a 0d0a 2020 2020 2020  ar'])]....      
-000824d0: 2020 7365 6c66 2e69 6e69 7455 4928 636f    self.initUI(co
-000824e0: 6d6d 6f6e 2c20 6461 7461 5f73 7472 7563  mmon, data_struc
-000824f0: 742c 2073 7461 636b 290d 0a0d 0a23 2d2d  t, stack)....#--
-00082500: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00082510: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00082520: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00082530: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00082540: 2d2d 2d2d 0d0a 2020 2020 6465 6620 696e  ----..    def in
-00082550: 6974 5549 2873 656c 662c 2063 6f6d 6d6f  itUI(self, commo
-00082560: 6e2c 2064 6174 615f 7374 7275 6374 2c20  n, data_struct, 
-00082570: 7374 6163 6b29 3a0d 0a20 2020 2020 2020  stack):..       
-00082580: 2073 656c 662e 7363 616c 6520 3d20 302e   self.scale = 0.
-00082590: 3030 3030 3031 0d0a 2020 2020 2020 2020  000001..        
-000825a0: 7365 6c66 2e64 6174 615f 7374 7275 6374  self.data_struct
-000825b0: 203d 2064 6174 615f 7374 7275 6374 0d0a   = data_struct..
-000825c0: 2020 2020 2020 2020 7365 6c66 2e73 746b          self.stk
-000825d0: 203d 2073 7461 636b 0d0a 2020 2020 2020   = stack..      
-000825e0: 2020 7365 6c66 2e63 6f6d 203d 2063 6f6d    self.com = com
-000825f0: 6d6f 6e0d 0a0d 0a20 2020 2020 2020 2073  mon....        s
-00082600: 656c 662e 6669 6c65 6e61 6d65 203d 2022  elf.filename = "
-00082610: 2022 0d0a 2020 2020 2020 2020 7365 6c66   "..        self
-00082620: 2e73 6c69 6465 725f 656e 672e 7661 6c75  .slider_eng.valu
-00082630: 6543 6861 6e67 6564 5b69 6e74 5d2e 636f  eChanged[int].co
-00082640: 6e6e 6563 7428 7365 6c66 2e4f 6e53 6372  nnect(self.OnScr
-00082650: 6f6c 6c45 6e67 290d 0a20 2020 2020 2020  ollEng)..       
-00082660: 2073 656c 662e 736c 6964 6572 5f74 6865   self.slider_the
-00082670: 7461 2e76 616c 7565 4368 616e 6765 645b  ta.valueChanged[
-00082680: 696e 745d 2e63 6f6e 6e65 6374 2873 656c  int].connect(sel
-00082690: 662e 4f6e 5363 726f 6c6c 5468 6574 6129  f.OnScrollTheta)
-000826a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
-000826b0: 6576 203d 2030 0d0a 2020 2020 2020 2020  ev = 0..        
-000826c0: 7365 6c66 2e69 7468 6574 6120 3d20 300d  self.itheta = 0.
-000826d0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-000826e0: 6275 7474 6f6e 5f6d 756c 7469 6c6f 6164  button_multiload
-000826f0: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
-00082700: 2820 7365 6c66 2e4f 6e4c 6f61 644d 756c  ( self.OnLoadMul
-00082710: 7469 290d 0a20 2020 2020 2020 2073 656c  ti)..        sel
-00082720: 662e 6275 7474 6f6e 5f6d 756c 7469 6c6f  f.button_multilo
-00082730: 6164 2e73 6574 546f 6f6c 5469 7028 2753  ad.setToolTip('S
-00082740: 7570 706f 7274 6564 2046 6f72 6d61 7473  upported Formats
-00082750: 202e 6864 6620 2e68 6466 3520 2e6e 6362   .hdf .hdf5 .ncb
-00082760: 202e 6e78 7320 2e68 6472 202e 7374 6b20   .nxs .hdr .stk 
-00082770: 2e74 6966 202e 7469 6666 202e 7478 726d  .tif .tiff .txrm
-00082780: 2729 0d0a 0d0a 2020 2020 2020 2020 7365  ')....        se
-00082790: 6c66 2e62 7574 746f 6e5f 3464 2e73 6574  lf.button_4d.set
-000827a0: 546f 6f6c 5469 7028 2753 7570 706f 7274  ToolTip('Support
-000827b0: 6564 2046 6f72 6d61 7473 202e 6864 6635  ed Formats .hdf5
-000827c0: 202e 6e63 6227 290d 0a20 2020 2020 2020   .ncb')..       
-000827d0: 2073 656c 662e 6275 7474 6f6e 5f34 642e   self.button_4d.
-000827e0: 636c 6963 6b65 642e 636f 6e6e 6563 7428  clicked.connect(
-000827f0: 2073 656c 662e 4f6e 4c6f 6164 3444 290d   self.OnLoad4D).
-00082800: 0a0d 0a20 2020 2020 2020 2023 546f 446f  ...        #ToDo
-00082810: 3a20 5265 7061 6972 2053 7461 636b 2042  : Repair Stack B
-00082820: 7569 6c64 6572 0d0a 2020 2020 2020 2020  uilder..        
-00082830: 2354 6f44 6f3a 2052 6570 6169 7220 5363  #ToDo: Repair Sc
-00082840: 616c 696e 672f 7363 616c 6562 6172 2066  aling/scalebar f
-00082850: 6f72 2048 4446 3520 6669 6c65 732e 0d0a  or HDF5 files...
-00082860: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-00082870: 746f 6e5f 736d 2e73 6574 546f 6f6c 5469  ton_sm.setToolTi
-00082880: 7028 2753 7570 706f 7274 6564 2046 6f72  p('Supported For
-00082890: 6d61 7473 202e 736d 2c20 2e78 726d 2729  mats .sm, .xrm')
-000828a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
-000828b0: 7574 746f 6e5f 736d 2e63 6c69 636b 6564  utton_sm.clicked
-000828c0: 2e63 6f6e 6e65 6374 2820 7365 6c66 2e4f  .connect( self.O
-000828d0: 6e42 7569 6c64 5374 6163 6b29 0d0a 0d0a  nBuildStack)....
-000828e0: 2020 2020 2020 2020 7365 6c66 2e4d 6574          self.Met
-000828f0: 7269 6343 6865 636b 426f 782e 746f 6767  ricCheckBox.togg
-00082900: 6c65 642e 636f 6e6e 6563 7428 6c61 6d62  led.connect(lamb
-00082910: 6461 3a20 2020 2020 7365 6c66 2e4f 6e4d  da:     self.OnM
-00082920: 6574 7269 6353 6361 6c65 2873 656c 662e  etricScale(self.
-00082930: 4d65 7472 6963 4368 6563 6b42 6f78 2e69  MetricCheckBox.i
-00082940: 7343 6865 636b 6564 2829 2c20 7365 6c66  sChecked(), self
-00082950: 2e5a 6572 6f4f 7269 6769 6e43 6865 636b  .ZeroOriginCheck
-00082960: 426f 782e 6973 4368 6563 6b65 6428 292c  Box.isChecked(),
-00082970: 7365 6c66 2e53 7175 6172 6550 7843 6865  self.SquarePxChe
-00082980: 636b 426f 782e 6973 4368 6563 6b65 6428  ckBox.isChecked(
-00082990: 2929 290d 0a20 2020 2020 2020 2073 656c  )))..        sel
-000829a0: 662e 5a65 726f 4f72 6967 696e 4368 6563  f.ZeroOriginChec
-000829b0: 6b42 6f78 2e74 6f67 676c 6564 2e63 6f6e  kBox.toggled.con
-000829c0: 6e65 6374 286c 616d 6264 613a 2073 656c  nect(lambda: sel
-000829d0: 662e 4f6e 4d65 7472 6963 5363 616c 6528  f.OnMetricScale(
-000829e0: 7365 6c66 2e4d 6574 7269 6343 6865 636b  self.MetricCheck
-000829f0: 426f 782e 6973 4368 6563 6b65 6428 292c  Box.isChecked(),
-00082a00: 2073 656c 662e 5a65 726f 4f72 6967 696e   self.ZeroOrigin
-00082a10: 4368 6563 6b42 6f78 2e69 7343 6865 636b  CheckBox.isCheck
-00082a20: 6564 2829 2c73 656c 662e 5371 7561 7265  ed(),self.Square
-00082a30: 5078 4368 6563 6b42 6f78 2e69 7343 6865  PxCheckBox.isChe
-00082a40: 636b 6564 2829 2929 0d0a 2020 2020 2020  cked()))..      
-00082a50: 2020 7365 6c66 2e53 7175 6172 6550 7843    self.SquarePxC
-00082a60: 6865 636b 426f 782e 746f 6767 6c65 642e  heckBox.toggled.
-00082a70: 636f 6e6e 6563 7428 6c61 6d62 6461 3a20  connect(lambda: 
-00082a80: 2020 7365 6c66 2e4f 6e4d 6574 7269 6353    self.OnMetricS
-00082a90: 6361 6c65 2873 656c 662e 4d65 7472 6963  cale(self.Metric
-00082aa0: 4368 6563 6b42 6f78 2e69 7343 6865 636b  CheckBox.isCheck
-00082ab0: 6564 2829 2c20 7365 6c66 2e5a 6572 6f4f  ed(), self.ZeroO
-00082ac0: 7269 6769 6e43 6865 636b 426f 782e 6973  riginCheckBox.is
-00082ad0: 4368 6563 6b65 6428 292c 7365 6c66 2e53  Checked(),self.S
-00082ae0: 7175 6172 6550 7843 6865 636b 426f 782e  quarePxCheckBox.
-00082af0: 6973 4368 6563 6b65 6428 2929 290d 0a20  isChecked())).. 
-00082b00: 2020 2020 2020 2073 656c 662e 5371 7561         self.Squa
-00082b10: 7265 5078 4368 6563 6b42 6f78 2e73 6574  rePxCheckBox.set
-00082b20: 5669 7369 626c 6528 4661 6c73 6529 0d0a  Visible(False)..
-00082b30: 0d0a 2020 2020 2020 2020 7365 6c66 2e43  ..        self.C
-00082b40: 4d43 6174 426f 782e 6164 6449 7465 6d73  MCatBox.addItems
-00082b50: 285b 7365 6c66 2e63 6d61 7073 5b30 5d5b  ([self.cmaps[0][
-00082b60: 305d 2c73 656c 662e 636d 6170 735b 315d  0],self.cmaps[1]
-00082b70: 5b30 5d2c 7365 6c66 2e63 6d61 7073 5b32  [0],self.cmaps[2
-00082b80: 5d5b 305d 2c73 656c 662e 636d 6170 735b  ][0],self.cmaps[
-00082b90: 335d 5b30 5d2c 7365 6c66 2e63 6d61 7073  3][0],self.cmaps
-00082ba0: 5b34 5d5b 305d 2c73 656c 662e 636d 6170  [4][0],self.cmap
-00082bb0: 735b 355d 5b30 5d5d 290d 0a20 2020 2020  s[5][0]])..     
-00082bc0: 2020 2073 656c 662e 434d 4d61 7042 6f78     self.CMMapBox
-00082bd0: 2e61 6464 4974 656d 7328 7365 6c66 2e63  .addItems(self.c
-00082be0: 6d61 7073 5b32 5d5b 315d 290d 0a20 2020  maps[2][1])..   
-00082bf0: 2020 2020 2073 656c 662e 434d 4361 7442       self.CMCatB
-00082c00: 6f78 2e73 6574 4375 7272 656e 7449 6e64  ox.setCurrentInd
-00082c10: 6578 2832 290d 0a20 2020 2020 2020 2073  ex(2)..        s
-00082c20: 656c 662e 434d 4d61 7042 6f78 2e73 6574  elf.CMMapBox.set
-00082c30: 4375 7272 656e 7449 6e64 6578 2833 290d  CurrentIndex(3).
-00082c40: 0a20 2020 2020 2020 2073 656c 662e 434d  .        self.CM
-00082c50: 4361 7442 6f78 2e63 7572 7265 6e74 496e  CatBox.currentIn
-00082c60: 6465 7843 6861 6e67 6564 2e63 6f6e 6e65  dexChanged.conne
-00082c70: 6374 2873 656c 662e 4f6e 4361 7443 6861  ct(self.OnCatCha
-00082c80: 6e67 6564 290d 0a20 2020 2020 2020 2073  nged)..        s
-00082c90: 656c 662e 434d 4d61 7042 6f78 2e63 7572  elf.CMMapBox.cur
-00082ca0: 7265 6e74 496e 6465 7843 6861 6e67 6564  rentIndexChanged
-00082cb0: 2e63 6f6e 6e65 6374 286c 616d 6264 613a  .connect(lambda:
-00082cc0: 2073 656c 662e 4f6e 436f 6c6f 726d 6170   self.OnColormap
-00082cd0: 286d 6170 3d73 656c 662e 434d 4d61 7042  (map=self.CMMapB
-00082ce0: 6f78 2e63 7572 7265 6e74 5465 7874 2829  ox.currentText()
-00082cf0: 2c63 6f6c 6f72 733d 7365 6c66 2e53 7465  ,colors=self.Ste
-00082d00: 7053 7069 6e2e 7661 6c75 6528 2929 290d  pSpin.value())).
-00082d10: 0a20 2020 2020 2020 2073 656c 662e 5374  .        self.St
-00082d20: 6570 5370 696e 2e76 616c 7565 4368 616e  epSpin.valueChan
-00082d30: 6765 642e 636f 6e6e 6563 7428 6c61 6d62  ged.connect(lamb
-00082d40: 6461 3a20 2020 2020 2020 2073 656c 662e  da:        self.
-00082d50: 4f6e 436f 6c6f 726d 6170 286d 6170 3d73  OnColormap(map=s
-00082d60: 656c 662e 434d 4d61 7042 6f78 2e63 7572  elf.CMMapBox.cur
-00082d70: 7265 6e74 5465 7874 2829 2c63 6f6c 6f72  rentText(),color
-00082d80: 733d 7365 6c66 2e53 7465 7053 7069 6e2e  s=self.StepSpin.
-00082d90: 7661 6c75 6528 2929 290d 0a0d 0a20 2020  value()))....   
-00082da0: 2020 2020 2073 656c 662e 7062 5f72 6f74       self.pb_rot
-00082db0: 6174 652e 636c 6963 6b65 642e 636f 6e6e  ate.clicked.conn
-00082dc0: 6563 7428 7365 6c66 2e4f 6e52 6f74 6174  ect(self.OnRotat
-00082dd0: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-00082de0: 2e70 625f 6d69 7272 6f72 2e63 6c69 636b  .pb_mirror.click
-00082df0: 6564 2e63 6f6e 6e65 6374 2873 656c 662e  ed.connect(self.
-00082e00: 4f6e 4d69 7272 6f72 290d 0a20 2020 2020  OnMirror)..     
-00082e10: 2020 2073 656c 662e 7062 5f63 6f70 792e     self.pb_copy.
-00082e20: 636c 6963 6b65 642e 636f 6e6e 6563 7428  clicked.connect(
-00082e30: 7365 6c66 2e4f 6e43 6f70 7929 0d0a 2020  self.OnCopy)..  
-00082e40: 2020 2020 2020 7365 6c66 2e70 676c 6179        self.pglay
-00082e50: 6f75 7420 3d20 7067 2e47 7261 7068 6963  out = pg.Graphic
-00082e60: 734c 6179 6f75 7428 626f 7264 6572 3d4e  sLayout(border=N
-00082e70: 6f6e 6529 0d0a 2020 2020 2020 2020 7365  one)..        se
-00082e80: 6c66 2e63 616e 7661 732e 7365 7442 6163  lf.canvas.setBac
-00082e90: 6b67 726f 756e 6428 2277 2229 2023 2063  kground("w") # c
-00082ea0: 616e 7661 7320 6973 2061 2070 672e 4772  anvas is a pg.Gr
-00082eb0: 6170 6869 6373 5669 6577 2077 6964 6765  aphicsView widge
-00082ec0: 740d 0a20 2020 2020 2020 2073 656c 662e  t..        self.
-00082ed0: 6361 6e76 6173 2e73 6574 4365 6e74 7261  canvas.setCentra
-00082ee0: 6c57 6964 6765 7428 7365 6c66 2e70 676c  lWidget(self.pgl
-00082ef0: 6179 6f75 7429 0d0a 0d0a 2020 2020 2020  ayout)....      
-00082f00: 2020 7365 6c66 2e70 3120 3d20 7365 6c66    self.p1 = self
-00082f10: 2e70 676c 6179 6f75 742e 6164 6450 6c6f  .pglayout.addPlo
-00082f20: 7428 726f 773d 302c 2063 6f6c 3d30 2c20  t(row=0, col=0, 
-00082f30: 726f 7773 7061 6e3d 312c 2063 6f6c 7370  rowspan=1, colsp
-00082f40: 616e 3d31 290d 0a20 2020 2020 2020 2073  an=1)..        s
-00082f50: 656c 662e 7031 2e73 6574 4d6f 7573 6545  elf.p1.setMouseE
-00082f60: 6e61 626c 6564 2878 3d46 616c 7365 2c20  nabled(x=False, 
-00082f70: 793d 4661 6c73 6529 0d0a 2020 2020 2020  y=False)..      
-00082f80: 2020 7365 6c66 2e69 5f69 7465 6d20 3d20    self.i_item = 
-00082f90: 7067 2e49 6d61 6765 4974 656d 2862 6f72  pg.ImageItem(bor
-00082fa0: 6465 723d 226b 2229 0d0a 2020 2020 2020  der="k")..      
-00082fb0: 2020 7365 6c66 2e70 312e 7365 7441 7370    self.p1.setAsp
-00082fc0: 6563 744c 6f63 6b65 6428 6c6f 636b 3d54  ectLocked(lock=T
-00082fd0: 7275 652c 2072 6174 696f 3d31 290d 0a20  rue, ratio=1).. 
-00082fe0: 2020 2020 2020 2073 656c 662e 7031 2e73         self.p1.s
-00082ff0: 686f 7741 7869 7328 2274 6f70 222c 2073  howAxis("top", s
-00083000: 686f 773d 5472 7565 290d 0a20 2020 2020  how=True)..     
-00083010: 2020 2073 656c 662e 7031 2e73 686f 7741     self.p1.showA
-00083020: 7869 7328 2262 6f74 746f 6d22 2c20 7368  xis("bottom", sh
-00083030: 6f77 3d54 7275 6529 0d0a 2020 2020 2020  ow=True)..      
-00083040: 2020 7365 6c66 2e70 312e 7368 6f77 4178    self.p1.showAx
-00083050: 6973 2822 6c65 6674 222c 2073 686f 773d  is("left", show=
-00083060: 5472 7565 290d 0a20 2020 2020 2020 2073  True)..        s
-00083070: 656c 662e 7031 2e73 686f 7741 7869 7328  elf.p1.showAxis(
-00083080: 2272 6967 6874 222c 2073 686f 773d 5472  "right", show=Tr
-00083090: 7565 290d 0a20 2020 2020 2020 2073 656c  ue)..        sel
-000830a0: 662e 6179 3120 3d20 7365 6c66 2e70 312e  f.ay1 = self.p1.
-000830b0: 6765 7441 7869 7328 226c 6566 7422 290d  getAxis("left").
-000830c0: 0a20 2020 2020 2020 2062 7931 203d 2073  .        by1 = s
-000830d0: 656c 662e 7031 2e67 6574 4178 6973 2822  elf.p1.getAxis("
-000830e0: 7269 6768 7422 290d 0a20 2020 2020 2020  right")..       
-000830f0: 2073 656c 662e 6178 3120 3d20 7365 6c66   self.ax1 = self
-00083100: 2e70 312e 6765 7441 7869 7328 2262 6f74  .p1.getAxis("bot
-00083110: 746f 6d22 290d 0a20 2020 2020 2020 2062  tom")..        b
-00083120: 7831 203d 2073 656c 662e 7031 2e67 6574  x1 = self.p1.get
-00083130: 4178 6973 2822 746f 7022 290d 0a20 2020  Axis("top")..   
-00083140: 2020 2020 2073 656c 662e 6179 312e 7365       self.ay1.se
-00083150: 744c 6162 656c 2874 6578 743d 2279 222c  tLabel(text="y",
-00083160: 756e 6974 733d 2270 7822 290d 0a20 2020  units="px")..   
-00083170: 2020 2020 2073 656c 662e 6179 312e 656e       self.ay1.en
-00083180: 6162 6c65 4175 746f 5349 5072 6566 6978  ableAutoSIPrefix
-00083190: 2865 6e61 626c 653d 5472 7565 290d 0a20  (enable=True).. 
-000831a0: 2020 2020 2020 2073 656c 662e 6178 312e         self.ax1.
-000831b0: 7365 744c 6162 656c 2874 6578 743d 2278  setLabel(text="x
-000831c0: 222c 756e 6974 733d 2270 7822 290d 0a20  ",units="px").. 
-000831d0: 2020 2020 2020 2073 656c 662e 6178 312e         self.ax1.
-000831e0: 656e 6162 6c65 4175 746f 5349 5072 6566  enableAutoSIPref
-000831f0: 6978 2865 6e61 626c 653d 5472 7565 290d  ix(enable=True).
-00083200: 0a20 2020 2020 2020 2073 656c 662e 6179  .        self.ay
-00083210: 312e 7365 7453 7479 6c65 2874 6963 6b4c  1.setStyle(tickL
-00083220: 656e 6774 683d 3829 0d0a 2020 2020 2020  ength=8)..      
-00083230: 2020 7365 6c66 2e61 7831 2e73 6574 5374    self.ax1.setSt
-00083240: 796c 6528 7469 636b 4c65 6e67 7468 3d38  yle(tickLength=8
-00083250: 290d 0a20 2020 2020 2020 2062 7931 2e73  )..        by1.s
-00083260: 6574 5374 796c 6528 7368 6f77 5661 6c75  etStyle(showValu
-00083270: 6573 3d46 616c 7365 2c74 6963 6b4c 656e  es=False,tickLen
-00083280: 6774 683d 3029 0d0a 2020 2020 2020 2020  gth=0)..        
-00083290: 6278 312e 7365 7453 7479 6c65 2873 686f  bx1.setStyle(sho
-000832a0: 7756 616c 7565 733d 4661 6c73 652c 7469  wValues=False,ti
-000832b0: 636b 4c65 6e67 7468 3d30 290d 0a20 2020  ckLength=0)..   
-000832c0: 2020 2020 2073 656c 662e 7031 2e73 6574       self.p1.set
-000832d0: 5469 746c 6528 224e 6f20 6461 7461 206c  Title("No data l
-000832e0: 6f61 6465 6422 290d 0a0d 0a20 2020 2020  oaded")....     
-000832f0: 2020 2073 656c 662e 636d 696d 6720 3d20     self.cmimg = 
-00083300: 7067 2e49 6d61 6765 4974 656d 2862 6f72  pg.ImageItem(bor
-00083310: 6465 723d 4e6f 6e65 290d 0a20 2020 2020  der=None)..     
-00083320: 2020 2073 656c 662e 636d 203d 2073 656c     self.cm = sel
-00083330: 662e 7067 6c61 796f 7574 2e61 6464 506c  f.pglayout.addPl
-00083340: 6f74 2872 6f77 3d30 2c20 636f 6c3d 312c  ot(row=0, col=1,
-00083350: 2072 6f77 7370 616e 3d31 2c20 636f 6c73   rowspan=1, cols
-00083360: 7061 6e3d 3129 0d0a 2020 2020 2020 2020  pan=1)..        
-00083370: 7365 6c66 2e63 6d2e 6164 6449 7465 6d28  self.cm.addItem(
-00083380: 7365 6c66 2e63 6d69 6d67 290d 0a20 2020  self.cmimg)..   
-00083390: 2020 2020 2073 656c 662e 636d 2e73 6574       self.cm.set
-000833a0: 4d6f 7573 6545 6e61 626c 6564 2878 3d46  MouseEnabled(x=F
-000833b0: 616c 7365 2c20 793d 4661 6c73 6529 0d0a  alse, y=False)..
-000833c0: 2020 2020 2020 2020 7365 6c66 2e63 6d2e          self.cm.
-000833d0: 6765 7456 6965 7742 6f78 2829 2e61 7574  getViewBox().aut
-000833e0: 6f52 616e 6765 2870 6164 6469 6e67 3d30  oRange(padding=0
-000833f0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00083400: 636d 2e73 686f 7741 7869 7328 2274 6f70  cm.showAxis("top
-00083410: 222c 2073 686f 773d 5472 7565 290d 0a20  ", show=True).. 
-00083420: 2020 2020 2020 2073 656c 662e 636d 2e73         self.cm.s
-00083430: 686f 7741 7869 7328 2262 6f74 746f 6d22  howAxis("bottom"
-00083440: 2c20 7368 6f77 3d54 7275 6529 0d0a 2020  , show=True)..  
-00083450: 2020 2020 2020 7365 6c66 2e63 6d2e 7368        self.cm.sh
-00083460: 6f77 4178 6973 2822 6c65 6674 222c 2073  owAxis("left", s
-00083470: 686f 773d 5472 7565 290d 0a20 2020 2020  how=True)..     
-00083480: 2020 2073 656c 662e 636d 2e73 686f 7741     self.cm.showA
-00083490: 7869 7328 2272 6967 6874 222c 2073 686f  xis("right", sho
-000834a0: 773d 5472 7565 290d 0a20 2020 2020 2020  w=True)..       
-000834b0: 2073 656c 662e 636d 2e73 6574 5469 746c   self.cm.setTitl
-000834c0: 6528 2222 290d 0a20 2020 2020 2020 2061  e("")..        a
-000834d0: 7933 203d 2073 656c 662e 636d 2e67 6574  y3 = self.cm.get
-000834e0: 4178 6973 2822 6c65 6674 2229 0d0a 2020  Axis("left")..  
-000834f0: 2020 2020 2020 6179 332e 7365 745a 5661        ay3.setZVa
-00083500: 6c75 6528 3130 3030 290d 0a20 2020 2020  lue(1000)..     
-00083510: 2020 2062 7933 203d 2073 656c 662e 636d     by3 = self.cm
-00083520: 2e67 6574 4178 6973 2822 7269 6768 7422  .getAxis("right"
-00083530: 290d 0a20 2020 2020 2020 2062 7933 2e73  )..        by3.s
-00083540: 6574 5a56 616c 7565 2831 3030 3029 0d0a  etZValue(1000)..
-00083550: 2020 2020 2020 2020 6278 3320 3d20 7365          bx3 = se
-00083560: 6c66 2e63 6d2e 6765 7441 7869 7328 2274  lf.cm.getAxis("t
-00083570: 6f70 2229 0d0a 2020 2020 2020 2020 6278  op")..        bx
-00083580: 332e 7365 745a 5661 6c75 6528 3130 3030  3.setZValue(1000
-00083590: 290d 0a20 2020 2020 2020 2061 7833 203d  )..        ax3 =
-000835a0: 2073 656c 662e 636d 2e67 6574 4178 6973   self.cm.getAxis
-000835b0: 2822 626f 7474 6f6d 2229 0d0a 2020 2020  ("bottom")..    
-000835c0: 2020 2020 6178 332e 7365 7448 6569 6768      ax3.setHeigh
-000835d0: 7428 683d 3436 2e32 2920 2377 6f72 6b61  t(h=46.2) #worka
-000835e0: 726f 756e 6420 666f 7220 6f76 6572 6c79  round for overly
-000835f0: 206c 6f6e 6720 636f 6c6f 7262 6172 2069   long colorbar i
-00083600: 6e20 6c69 6e75 780d 0a20 2020 2020 2020  n linux..       
-00083610: 2062 7933 2e73 6574 5769 6474 6828 773d   by3.setWidth(w=
-00083620: 3630 290d 0a20 2020 2020 2020 2061 7833  60)..        ax3
-00083630: 2e73 6574 5a56 616c 7565 2831 3030 3029  .setZValue(1000)
-00083640: 0d0a 2020 2020 2020 2020 6178 332e 7365  ..        ax3.se
-00083650: 7454 6963 6b73 285b 5d29 0d0a 2020 2020  tTicks([])..    
-00083660: 2020 2020 6178 332e 7365 744c 6162 656c      ax3.setLabel
-00083670: 2874 6578 743d 2222 2c20 756e 6974 733d  (text="", units=
-00083680: 2222 290d 0a20 2020 2020 2020 2062 7933  "")..        by3
-00083690: 203d 2073 656c 662e 636d 2e67 6574 4178   = self.cm.getAx
-000836a0: 6973 2822 7269 6768 7422 290d 0a20 2020  is("right")..   
-000836b0: 2020 2020 2062 7933 2e73 6574 4c61 6265       by3.setLabe
-000836c0: 6c28 7465 7874 3d22 636f 756e 7473 222c  l(text="counts",
-000836d0: 2075 6e69 7473 3d22 2229 0d0a 2020 2020   units="")..    
-000836e0: 2020 2020 6279 332e 7365 7453 7479 6c65      by3.setStyle
-000836f0: 2874 6963 6b4c 656e 6774 683d 3829 0d0a  (tickLength=8)..
-00083700: 2020 2020 2020 2020 6179 332e 7365 7453          ay3.setS
-00083710: 7479 6c65 2873 686f 7756 616c 7565 733d  tyle(showValues=
-00083720: 4661 6c73 652c 7469 636b 4c65 6e67 7468  False,tickLength
-00083730: 3d30 290d 0a20 2020 2020 2020 2062 7833  =0)..        bx3
-00083740: 2e73 6574 5374 796c 6528 7368 6f77 5661  .setStyle(showVa
-00083750: 6c75 6573 3d46 616c 7365 2c74 6963 6b4c  lues=False,tickL
-00083760: 656e 6774 683d 3029 0d0a 0d0a 0d0a 2020  ength=0)......  
-00083770: 2020 2020 2020 7365 6c66 2e70 676c 6179        self.pglay
-00083780: 6f75 742e 6c61 796f 7574 2e73 6574 436f  out.layout.setCo
-00083790: 6c75 6d6e 4d69 6e69 6d75 6d57 6964 7468  lumnMinimumWidth
-000837a0: 2831 2c20 3830 290d 0a20 2020 2020 2020  (1, 80)..       
-000837b0: 2073 656c 662e 7067 6c61 796f 7574 2e6c   self.pglayout.l
-000837c0: 6179 6f75 742e 7365 7443 6f6c 756d 6e4d  ayout.setColumnM
-000837d0: 6178 696d 756d 5769 6474 6828 312c 2038  aximumWidth(1, 8
-000837e0: 3029 0d0a 0d0a 2020 2020 2020 2020 7365  0)....        se
-000837f0: 6c66 2e74 635f 6669 6c65 2e73 6574 5465  lf.tc_file.setTe
-00083800: 7874 2827 4669 6c65 206e 616d 6527 290d  xt('File name').
-00083810: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00083820: 7463 5f70 6174 682e 7365 7454 6578 7428  tc_path.setText(
-00083830: 2744 3a2f 2729 0d0a 2020 2020 2020 2020  'D:/')..        
-00083840: 7365 6c66 2e73 6c69 6465 725f 7468 6574  self.slider_thet
-00083850: 612e 7365 7456 6973 6962 6c65 2846 616c  a.setVisible(Fal
-00083860: 7365 290d 0a0d 0a20 2020 2064 6566 2043  se)....    def C
-00083870: 6c65 6172 2873 656c 6629 3a0d 0a20 2020  lear(self):..   
-00083880: 2020 2020 2073 656c 662e 7031 2e63 6c65       self.p1.cle
-00083890: 6172 2829 0d0a 0d0a 2020 2020 6465 6620  ar()....    def 
-000838a0: 4c6f 6164 456e 7472 6965 7328 7365 6c66  LoadEntries(self
-000838b0: 293a 2023 2043 616c 6c65 6420 7768 656e  ): # Called when
-000838c0: 2066 7265 7368 2064 6174 6120 6172 6520   fresh data are 
-000838d0: 6c6f 6164 6564 2e0d 0a20 2020 2020 2020  loaded...       
-000838e0: 2073 656c 662e 7031 2e61 6464 4974 656d   self.p1.addItem
-000838f0: 2873 656c 662e 695f 6974 656d 290d 0a20  (self.i_item).. 
-00083900: 2020 2020 2020 2073 656c 662e 4f6e 5363         self.OnSc
-00083910: 726f 6c6c 456e 6728 3029 2023 2050 6c6f  rollEng(0) # Plo
-00083920: 7420 6669 7273 7420 696d 6167 6520 2620  t first image & 
-00083930: 7365 7420 5363 726f 6c6c 6261 720d 0a20  set Scrollbar.. 
-00083940: 2020 2020 2020 2073 656c 662e 4f6e 4d65         self.OnMe
-00083950: 7472 6963 5363 616c 6528 7365 6c66 2e4d  tricScale(self.M
-00083960: 6574 7269 6343 6865 636b 426f 782e 6973  etricCheckBox.is
-00083970: 4368 6563 6b65 6428 292c 2054 7275 652c  Checked(), True,
-00083980: 2046 616c 7365 290d 0a0d 0a20 2020 2064   False)....    d
-00083990: 6566 206b 6579 5072 6573 7345 7665 6e74  ef keyPressEvent
-000839a0: 2873 656c 662c 2065 293a 0d0a 2020 2020  (self, e):..    
-000839b0: 2020 2020 6966 2065 2e6b 6579 2829 203d      if e.key() =
-000839c0: 3d20 3637 2061 6e64 2028 652e 6d6f 6469  = 67 and (e.modi
-000839d0: 6669 6572 7328 2920 2620 5174 436f 7265  fiers() & QtCore
-000839e0: 2e51 742e 436f 6e74 726f 6c4d 6f64 6966  .Qt.ControlModif
-000839f0: 6965 7229 3a0d 0a20 2020 2020 2020 2020  ier):..         
-00083a00: 2020 2073 656c 662e 4f6e 436f 7079 2829     self.OnCopy()
-00083a10: 0d0a 0d0a 2020 2020 6465 6620 4f6e 4d65  ....    def OnMe
-00083a20: 7472 6963 5363 616c 6528 7365 6c66 2c20  tricScale(self, 
-00083a30: 7365 746d 6574 7269 633d 2054 7275 652c  setmetric= True,
-00083a40: 207a 6572 6f6f 7269 6769 6e3d 2054 7275   zeroorigin= Tru
-00083a50: 652c 2073 7175 6172 653d 2046 616c 7365  e, square= False
-00083a60: 293a 0d0a 2020 2020 2020 2020 6966 2073  ):..        if s
-00083a70: 656c 662e 636f 6d2e 7374 6163 6b5f 6c6f  elf.com.stack_lo
-00083a80: 6164 6564 203d 3d20 313a 0d0a 2020 2020  aded == 1:..    
-00083a90: 2020 2020 2020 2020 6966 2073 6574 6d65          if setme
-00083aa0: 7472 6963 3d3d 5472 7565 3a0d 0a20 2020  tric==True:..   
-00083ab0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00083ac0: 662e 5371 7561 7265 5078 4368 6563 6b42  f.SquarePxCheckB
-00083ad0: 6f78 2e73 6574 5669 7369 626c 6528 4661  ox.setVisible(Fa
-00083ae0: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
-00083af0: 2020 2020 2020 7365 6c66 2e5a 6572 6f4f        self.ZeroO
-00083b00: 7269 6769 6e43 6865 636b 426f 782e 7365  riginCheckBox.se
-00083b10: 7456 6973 6962 6c65 2854 7275 6529 0d0a  tVisible(True)..
-00083b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00083b30: 7365 6c66 2e70 312e 7365 7441 7370 6563  self.p1.setAspec
-00083b40: 744c 6f63 6b65 6428 6c6f 636b 3d54 7275  tLocked(lock=Tru
-00083b50: 652c 2072 6174 696f 3d31 290d 0a20 2020  e, ratio=1)..   
-00083b60: 2020 2020 2020 2020 2020 2020 2023 7365               #se
-00083b70: 6c66 2e70 322e 7365 7441 7370 6563 744c  lf.p2.setAspectL
-00083b80: 6f63 6b65 6428 6c6f 636b 3d54 7275 652c  ocked(lock=True,
-00083b90: 2072 6174 696f 3d31 290d 0a20 2020 2020   ratio=1)..     
-00083ba0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00083bb0: 7420 7a65 726f 6f72 6967 696e 3a0d 0a20  t zeroorigin:.. 
-00083bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00083bd0: 2020 2078 5f73 7461 7274 203d 2073 656c     x_start = sel
-00083be0: 662e 7374 6b2e 785f 7374 6172 742a 7365  f.stk.x_start*se
-00083bf0: 6c66 2e73 6361 6c65 0d0a 2020 2020 2020  lf.scale..      
-00083c00: 2020 2020 2020 2020 2020 2020 2020 795f                y_
-00083c10: 7374 6172 7420 3d20 7365 6c66 2e73 746b  start = self.stk
-00083c20: 2e79 5f73 7461 7274 2a73 656c 662e 7363  .y_start*self.sc
-00083c30: 616c 650d 0a20 2020 2020 2020 2020 2020  ale..           
-00083c40: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00082480: 2767 6e75 706c 6f74 272c 2027 676e 7570  'gnuplot', 'gnup
+00082490: 6c6f 7432 272c 2027 434d 526d 6170 272c  lot2', 'CMRmap',
+000824a0: 2027 6375 6265 6865 6c69 7827 2c20 2762   'cubehelix', 'b
+000824b0: 7267 272c 2027 6873 7627 2c0d 0a20 2020  rg', 'hsv',..   
+000824c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000824d0: 2020 2020 2020 2027 6769 7374 5f72 6169         'gist_rai
+000824e0: 6e62 6f77 272c 2027 7261 696e 626f 7727  nbow', 'rainbow'
+000824f0: 2c20 276a 6574 272c 2027 6e69 7079 5f73  , 'jet', 'nipy_s
+00082500: 7065 6374 7261 6c27 2c20 2767 6973 745f  pectral', 'gist_
+00082510: 6e63 6172 275d 295d 0d0a 0d0a 2020 2020  ncar'])]....    
+00082520: 2020 2020 7365 6c66 2e69 6e69 7455 4928      self.initUI(
+00082530: 636f 6d6d 6f6e 2c20 6461 7461 5f73 7472  common, data_str
+00082540: 7563 742c 2073 7461 636b 290d 0a0d 0a23  uct, stack)....#
+00082550: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00082560: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00082570: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00082580: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00082590: 2d2d 2d2d 2d2d 0d0a 2020 2020 6465 6620  ------..    def 
+000825a0: 696e 6974 5549 2873 656c 662c 2063 6f6d  initUI(self, com
+000825b0: 6d6f 6e2c 2064 6174 615f 7374 7275 6374  mon, data_struct
+000825c0: 2c20 7374 6163 6b29 3a0d 0a20 2020 2020  , stack):..     
+000825d0: 2020 2073 656c 662e 7363 616c 6520 3d20     self.scale = 
+000825e0: 302e 3030 3030 3031 0d0a 2020 2020 2020  0.000001..      
+000825f0: 2020 7365 6c66 2e64 6174 615f 7374 7275    self.data_stru
+00082600: 6374 203d 2064 6174 615f 7374 7275 6374  ct = data_struct
+00082610: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00082620: 746b 203d 2073 7461 636b 0d0a 2020 2020  tk = stack..    
+00082630: 2020 2020 7365 6c66 2e63 6f6d 203d 2063      self.com = c
+00082640: 6f6d 6d6f 6e0d 0a0d 0a20 2020 2020 2020  ommon....       
+00082650: 2073 656c 662e 6669 6c65 6e61 6d65 203d   self.filename =
+00082660: 2022 2022 0d0a 2020 2020 2020 2020 7365   " "..        se
+00082670: 6c66 2e73 6c69 6465 725f 656e 672e 7661  lf.slider_eng.va
+00082680: 6c75 6543 6861 6e67 6564 5b69 6e74 5d2e  lueChanged[int].
+00082690: 636f 6e6e 6563 7428 7365 6c66 2e4f 6e53  connect(self.OnS
+000826a0: 6372 6f6c 6c45 6e67 290d 0a20 2020 2020  crollEng)..     
+000826b0: 2020 2073 656c 662e 736c 6964 6572 5f74     self.slider_t
+000826c0: 6865 7461 2e76 616c 7565 4368 616e 6765  heta.valueChange
+000826d0: 645b 696e 745d 2e63 6f6e 6e65 6374 2873  d[int].connect(s
+000826e0: 656c 662e 4f6e 5363 726f 6c6c 5468 6574  elf.OnScrollThet
+000826f0: 6129 0d0a 2020 2020 2020 2020 7365 6c66  a)..        self
+00082700: 2e69 6576 203d 2030 0d0a 2020 2020 2020  .iev = 0..      
+00082710: 2020 7365 6c66 2e69 7468 6574 6120 3d20    self.itheta = 
+00082720: 300d 0a0d 0a20 2020 2020 2020 2073 656c  0....        sel
+00082730: 662e 6275 7474 6f6e 5f6d 756c 7469 6c6f  f.button_multilo
+00082740: 6164 2e63 6c69 636b 6564 2e63 6f6e 6e65  ad.clicked.conne
+00082750: 6374 2820 7365 6c66 2e4f 6e4c 6f61 644d  ct( self.OnLoadM
+00082760: 756c 7469 290d 0a20 2020 2020 2020 2073  ulti)..        s
+00082770: 656c 662e 6275 7474 6f6e 5f6d 756c 7469  elf.button_multi
+00082780: 6c6f 6164 2e73 6574 546f 6f6c 5469 7028  load.setToolTip(
+00082790: 2753 7570 706f 7274 6564 2046 6f72 6d61  'Supported Forma
+000827a0: 7473 202e 6864 6620 2e68 6466 3520 2e6e  ts .hdf .hdf5 .n
+000827b0: 6362 202e 6e78 7320 2e68 6472 202e 7374  cb .nxs .hdr .st
+000827c0: 6b20 2e74 6966 202e 7469 6666 202e 7478  k .tif .tiff .tx
+000827d0: 726d 2729 0d0a 0d0a 2020 2020 2020 2020  rm')....        
+000827e0: 7365 6c66 2e62 7574 746f 6e5f 3464 2e73  self.button_4d.s
+000827f0: 6574 546f 6f6c 5469 7028 2753 7570 706f  etToolTip('Suppo
+00082800: 7274 6564 2046 6f72 6d61 7473 202e 6864  rted Formats .hd
+00082810: 6635 202e 6e63 6227 290d 0a20 2020 2020  f5 .ncb')..     
+00082820: 2020 2073 656c 662e 6275 7474 6f6e 5f34     self.button_4
+00082830: 642e 636c 6963 6b65 642e 636f 6e6e 6563  d.clicked.connec
+00082840: 7428 2073 656c 662e 4f6e 4c6f 6164 3444  t( self.OnLoad4D
+00082850: 290d 0a0d 0a20 2020 2020 2020 2023 546f  )....        #To
+00082860: 446f 3a20 5265 7061 6972 2053 7461 636b  Do: Repair Stack
+00082870: 2042 7569 6c64 6572 0d0a 2020 2020 2020   Builder..      
+00082880: 2020 2354 6f44 6f3a 2052 6570 6169 7220    #ToDo: Repair 
+00082890: 5363 616c 696e 672f 7363 616c 6562 6172  Scaling/scalebar
+000828a0: 2066 6f72 2048 4446 3520 6669 6c65 732e   for HDF5 files.
+000828b0: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
+000828c0: 7574 746f 6e5f 736d 2e73 6574 546f 6f6c  utton_sm.setTool
+000828d0: 5469 7028 2753 7570 706f 7274 6564 2046  Tip('Supported F
+000828e0: 6f72 6d61 7473 202e 736d 2c20 2e78 726d  ormats .sm, .xrm
+000828f0: 2729 0d0a 2020 2020 2020 2020 7365 6c66  ')..        self
+00082900: 2e62 7574 746f 6e5f 736d 2e63 6c69 636b  .button_sm.click
+00082910: 6564 2e63 6f6e 6e65 6374 2820 7365 6c66  ed.connect( self
+00082920: 2e4f 6e42 7569 6c64 5374 6163 6b29 0d0a  .OnBuildStack)..
+00082930: 0d0a 2020 2020 2020 2020 7365 6c66 2e4d  ..        self.M
+00082940: 6574 7269 6343 6865 636b 426f 782e 746f  etricCheckBox.to
+00082950: 6767 6c65 642e 636f 6e6e 6563 7428 6c61  ggled.connect(la
+00082960: 6d62 6461 3a20 2020 2020 7365 6c66 2e4f  mbda:     self.O
+00082970: 6e4d 6574 7269 6353 6361 6c65 2873 656c  nMetricScale(sel
+00082980: 662e 4d65 7472 6963 4368 6563 6b42 6f78  f.MetricCheckBox
+00082990: 2e69 7343 6865 636b 6564 2829 2c20 7365  .isChecked(), se
+000829a0: 6c66 2e5a 6572 6f4f 7269 6769 6e43 6865  lf.ZeroOriginChe
+000829b0: 636b 426f 782e 6973 4368 6563 6b65 6428  ckBox.isChecked(
+000829c0: 292c 7365 6c66 2e53 7175 6172 6550 7843  ),self.SquarePxC
+000829d0: 6865 636b 426f 782e 6973 4368 6563 6b65  heckBox.isChecke
+000829e0: 6428 2929 290d 0a20 2020 2020 2020 2073  d()))..        s
+000829f0: 656c 662e 5a65 726f 4f72 6967 696e 4368  elf.ZeroOriginCh
+00082a00: 6563 6b42 6f78 2e74 6f67 676c 6564 2e63  eckBox.toggled.c
+00082a10: 6f6e 6e65 6374 286c 616d 6264 613a 2073  onnect(lambda: s
+00082a20: 656c 662e 4f6e 4d65 7472 6963 5363 616c  elf.OnMetricScal
+00082a30: 6528 7365 6c66 2e4d 6574 7269 6343 6865  e(self.MetricChe
+00082a40: 636b 426f 782e 6973 4368 6563 6b65 6428  ckBox.isChecked(
+00082a50: 292c 2073 656c 662e 5a65 726f 4f72 6967  ), self.ZeroOrig
+00082a60: 696e 4368 6563 6b42 6f78 2e69 7343 6865  inCheckBox.isChe
+00082a70: 636b 6564 2829 2c73 656c 662e 5371 7561  cked(),self.Squa
+00082a80: 7265 5078 4368 6563 6b42 6f78 2e69 7343  rePxCheckBox.isC
+00082a90: 6865 636b 6564 2829 2929 0d0a 2020 2020  hecked()))..    
+00082aa0: 2020 2020 7365 6c66 2e53 7175 6172 6550      self.SquareP
+00082ab0: 7843 6865 636b 426f 782e 746f 6767 6c65  xCheckBox.toggle
+00082ac0: 642e 636f 6e6e 6563 7428 6c61 6d62 6461  d.connect(lambda
+00082ad0: 3a20 2020 7365 6c66 2e4f 6e4d 6574 7269  :   self.OnMetri
+00082ae0: 6353 6361 6c65 2873 656c 662e 4d65 7472  cScale(self.Metr
+00082af0: 6963 4368 6563 6b42 6f78 2e69 7343 6865  icCheckBox.isChe
+00082b00: 636b 6564 2829 2c20 7365 6c66 2e5a 6572  cked(), self.Zer
+00082b10: 6f4f 7269 6769 6e43 6865 636b 426f 782e  oOriginCheckBox.
+00082b20: 6973 4368 6563 6b65 6428 292c 7365 6c66  isChecked(),self
+00082b30: 2e53 7175 6172 6550 7843 6865 636b 426f  .SquarePxCheckBo
+00082b40: 782e 6973 4368 6563 6b65 6428 2929 290d  x.isChecked())).
+00082b50: 0a20 2020 2020 2020 2073 656c 662e 5371  .        self.Sq
+00082b60: 7561 7265 5078 4368 6563 6b42 6f78 2e73  uarePxCheckBox.s
+00082b70: 6574 5669 7369 626c 6528 4661 6c73 6529  etVisible(False)
+00082b80: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00082b90: 2e43 4d43 6174 426f 782e 6164 6449 7465  .CMCatBox.addIte
+00082ba0: 6d73 285b 7365 6c66 2e63 6d61 7073 5b30  ms([self.cmaps[0
+00082bb0: 5d5b 305d 2c73 656c 662e 636d 6170 735b  ][0],self.cmaps[
+00082bc0: 315d 5b30 5d2c 7365 6c66 2e63 6d61 7073  1][0],self.cmaps
+00082bd0: 5b32 5d5b 305d 2c73 656c 662e 636d 6170  [2][0],self.cmap
+00082be0: 735b 335d 5b30 5d2c 7365 6c66 2e63 6d61  s[3][0],self.cma
+00082bf0: 7073 5b34 5d5b 305d 2c73 656c 662e 636d  ps[4][0],self.cm
+00082c00: 6170 735b 355d 5b30 5d5d 290d 0a20 2020  aps[5][0]])..   
+00082c10: 2020 2020 2073 656c 662e 434d 4d61 7042       self.CMMapB
+00082c20: 6f78 2e61 6464 4974 656d 7328 7365 6c66  ox.addItems(self
+00082c30: 2e63 6d61 7073 5b32 5d5b 315d 290d 0a20  .cmaps[2][1]).. 
+00082c40: 2020 2020 2020 2073 656c 662e 434d 4361         self.CMCa
+00082c50: 7442 6f78 2e73 6574 4375 7272 656e 7449  tBox.setCurrentI
+00082c60: 6e64 6578 2832 290d 0a20 2020 2020 2020  ndex(2)..       
+00082c70: 2073 656c 662e 434d 4d61 7042 6f78 2e73   self.CMMapBox.s
+00082c80: 6574 4375 7272 656e 7449 6e64 6578 2833  etCurrentIndex(3
+00082c90: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00082ca0: 434d 4361 7442 6f78 2e63 7572 7265 6e74  CMCatBox.current
+00082cb0: 496e 6465 7843 6861 6e67 6564 2e63 6f6e  IndexChanged.con
+00082cc0: 6e65 6374 2873 656c 662e 4f6e 4361 7443  nect(self.OnCatC
+00082cd0: 6861 6e67 6564 290d 0a20 2020 2020 2020  hanged)..       
+00082ce0: 2073 656c 662e 434d 4d61 7042 6f78 2e63   self.CMMapBox.c
+00082cf0: 7572 7265 6e74 496e 6465 7843 6861 6e67  urrentIndexChang
+00082d00: 6564 2e63 6f6e 6e65 6374 286c 616d 6264  ed.connect(lambd
+00082d10: 613a 2073 656c 662e 4f6e 436f 6c6f 726d  a: self.OnColorm
+00082d20: 6170 286d 6170 3d73 656c 662e 434d 4d61  ap(map=self.CMMa
+00082d30: 7042 6f78 2e63 7572 7265 6e74 5465 7874  pBox.currentText
+00082d40: 2829 2c63 6f6c 6f72 733d 7365 6c66 2e53  (),colors=self.S
+00082d50: 7465 7053 7069 6e2e 7661 6c75 6528 2929  tepSpin.value())
+00082d60: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00082d70: 5374 6570 5370 696e 2e76 616c 7565 4368  StepSpin.valueCh
+00082d80: 616e 6765 642e 636f 6e6e 6563 7428 6c61  anged.connect(la
+00082d90: 6d62 6461 3a20 2020 2020 2020 2073 656c  mbda:        sel
+00082da0: 662e 4f6e 436f 6c6f 726d 6170 286d 6170  f.OnColormap(map
+00082db0: 3d73 656c 662e 434d 4d61 7042 6f78 2e63  =self.CMMapBox.c
+00082dc0: 7572 7265 6e74 5465 7874 2829 2c63 6f6c  urrentText(),col
+00082dd0: 6f72 733d 7365 6c66 2e53 7465 7053 7069  ors=self.StepSpi
+00082de0: 6e2e 7661 6c75 6528 2929 290d 0a0d 0a20  n.value())).... 
+00082df0: 2020 2020 2020 2073 656c 662e 7062 5f72         self.pb_r
+00082e00: 6f74 6174 652e 636c 6963 6b65 642e 636f  otate.clicked.co
+00082e10: 6e6e 6563 7428 7365 6c66 2e4f 6e52 6f74  nnect(self.OnRot
+00082e20: 6174 6529 0d0a 2020 2020 2020 2020 7365  ate)..        se
+00082e30: 6c66 2e70 625f 6d69 7272 6f72 2e63 6c69  lf.pb_mirror.cli
+00082e40: 636b 6564 2e63 6f6e 6e65 6374 2873 656c  cked.connect(sel
+00082e50: 662e 4f6e 4d69 7272 6f72 290d 0a20 2020  f.OnMirror)..   
+00082e60: 2020 2020 2073 656c 662e 7062 5f63 6f70       self.pb_cop
+00082e70: 792e 636c 6963 6b65 642e 636f 6e6e 6563  y.clicked.connec
+00082e80: 7428 7365 6c66 2e4f 6e43 6f70 7929 0d0a  t(self.OnCopy)..
+00082e90: 2020 2020 2020 2020 7365 6c66 2e70 676c          self.pgl
+00082ea0: 6179 6f75 7420 3d20 7067 2e47 7261 7068  ayout = pg.Graph
+00082eb0: 6963 734c 6179 6f75 7428 626f 7264 6572  icsLayout(border
+00082ec0: 3d4e 6f6e 6529 0d0a 2020 2020 2020 2020  =None)..        
+00082ed0: 7365 6c66 2e63 616e 7661 732e 7365 7442  self.canvas.setB
+00082ee0: 6163 6b67 726f 756e 6428 2277 2229 2023  ackground("w") #
+00082ef0: 2063 616e 7661 7320 6973 2061 2070 672e   canvas is a pg.
+00082f00: 4772 6170 6869 6373 5669 6577 2077 6964  GraphicsView wid
+00082f10: 6765 740d 0a20 2020 2020 2020 2073 656c  get..        sel
+00082f20: 662e 6361 6e76 6173 2e73 6574 4365 6e74  f.canvas.setCent
+00082f30: 7261 6c57 6964 6765 7428 7365 6c66 2e70  ralWidget(self.p
+00082f40: 676c 6179 6f75 7429 0d0a 0d0a 2020 2020  glayout)....    
+00082f50: 2020 2020 7365 6c66 2e70 3120 3d20 7365      self.p1 = se
+00082f60: 6c66 2e70 676c 6179 6f75 742e 6164 6450  lf.pglayout.addP
+00082f70: 6c6f 7428 726f 773d 302c 2063 6f6c 3d30  lot(row=0, col=0
+00082f80: 2c20 726f 7773 7061 6e3d 312c 2063 6f6c  , rowspan=1, col
+00082f90: 7370 616e 3d31 290d 0a20 2020 2020 2020  span=1)..       
+00082fa0: 2073 656c 662e 7031 2e73 6574 4d6f 7573   self.p1.setMous
+00082fb0: 6545 6e61 626c 6564 2878 3d46 616c 7365  eEnabled(x=False
+00082fc0: 2c20 793d 4661 6c73 6529 0d0a 2020 2020  , y=False)..    
+00082fd0: 2020 2020 7365 6c66 2e69 5f69 7465 6d20      self.i_item 
+00082fe0: 3d20 7067 2e49 6d61 6765 4974 656d 2862  = pg.ImageItem(b
+00082ff0: 6f72 6465 723d 226b 2229 0d0a 2020 2020  order="k")..    
+00083000: 2020 2020 7365 6c66 2e70 312e 7365 7441      self.p1.setA
+00083010: 7370 6563 744c 6f63 6b65 6428 6c6f 636b  spectLocked(lock
+00083020: 3d54 7275 652c 2072 6174 696f 3d31 290d  =True, ratio=1).
+00083030: 0a20 2020 2020 2020 2073 656c 662e 7031  .        self.p1
+00083040: 2e73 686f 7741 7869 7328 2274 6f70 222c  .showAxis("top",
+00083050: 2073 686f 773d 5472 7565 290d 0a20 2020   show=True)..   
+00083060: 2020 2020 2073 656c 662e 7031 2e73 686f       self.p1.sho
+00083070: 7741 7869 7328 2262 6f74 746f 6d22 2c20  wAxis("bottom", 
+00083080: 7368 6f77 3d54 7275 6529 0d0a 2020 2020  show=True)..    
+00083090: 2020 2020 7365 6c66 2e70 312e 7368 6f77      self.p1.show
+000830a0: 4178 6973 2822 6c65 6674 222c 2073 686f  Axis("left", sho
+000830b0: 773d 5472 7565 290d 0a20 2020 2020 2020  w=True)..       
+000830c0: 2073 656c 662e 7031 2e73 686f 7741 7869   self.p1.showAxi
+000830d0: 7328 2272 6967 6874 222c 2073 686f 773d  s("right", show=
+000830e0: 5472 7565 290d 0a20 2020 2020 2020 2073  True)..        s
+000830f0: 656c 662e 6179 3120 3d20 7365 6c66 2e70  elf.ay1 = self.p
+00083100: 312e 6765 7441 7869 7328 226c 6566 7422  1.getAxis("left"
+00083110: 290d 0a20 2020 2020 2020 2062 7931 203d  )..        by1 =
+00083120: 2073 656c 662e 7031 2e67 6574 4178 6973   self.p1.getAxis
+00083130: 2822 7269 6768 7422 290d 0a20 2020 2020  ("right")..     
+00083140: 2020 2073 656c 662e 6178 3120 3d20 7365     self.ax1 = se
+00083150: 6c66 2e70 312e 6765 7441 7869 7328 2262  lf.p1.getAxis("b
+00083160: 6f74 746f 6d22 290d 0a20 2020 2020 2020  ottom")..       
+00083170: 2062 7831 203d 2073 656c 662e 7031 2e67   bx1 = self.p1.g
+00083180: 6574 4178 6973 2822 746f 7022 290d 0a20  etAxis("top").. 
+00083190: 2020 2020 2020 2073 656c 662e 6179 312e         self.ay1.
+000831a0: 7365 744c 6162 656c 2874 6578 743d 2279  setLabel(text="y
+000831b0: 222c 756e 6974 733d 2270 7822 290d 0a20  ",units="px").. 
+000831c0: 2020 2020 2020 2073 656c 662e 6179 312e         self.ay1.
+000831d0: 656e 6162 6c65 4175 746f 5349 5072 6566  enableAutoSIPref
+000831e0: 6978 2865 6e61 626c 653d 5472 7565 290d  ix(enable=True).
+000831f0: 0a20 2020 2020 2020 2073 656c 662e 6178  .        self.ax
+00083200: 312e 7365 744c 6162 656c 2874 6578 743d  1.setLabel(text=
+00083210: 2278 222c 756e 6974 733d 2270 7822 290d  "x",units="px").
+00083220: 0a20 2020 2020 2020 2073 656c 662e 6178  .        self.ax
+00083230: 312e 656e 6162 6c65 4175 746f 5349 5072  1.enableAutoSIPr
+00083240: 6566 6978 2865 6e61 626c 653d 5472 7565  efix(enable=True
+00083250: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00083260: 6179 312e 7365 7453 7479 6c65 2874 6963  ay1.setStyle(tic
+00083270: 6b4c 656e 6774 683d 3829 0d0a 2020 2020  kLength=8)..    
+00083280: 2020 2020 7365 6c66 2e61 7831 2e73 6574      self.ax1.set
+00083290: 5374 796c 6528 7469 636b 4c65 6e67 7468  Style(tickLength
+000832a0: 3d38 290d 0a20 2020 2020 2020 2062 7931  =8)..        by1
+000832b0: 2e73 6574 5374 796c 6528 7368 6f77 5661  .setStyle(showVa
+000832c0: 6c75 6573 3d46 616c 7365 2c74 6963 6b4c  lues=False,tickL
+000832d0: 656e 6774 683d 3029 0d0a 2020 2020 2020  ength=0)..      
+000832e0: 2020 6278 312e 7365 7453 7479 6c65 2873    bx1.setStyle(s
+000832f0: 686f 7756 616c 7565 733d 4661 6c73 652c  howValues=False,
+00083300: 7469 636b 4c65 6e67 7468 3d30 290d 0a20  tickLength=0).. 
+00083310: 2020 2020 2020 2073 656c 662e 7031 2e73         self.p1.s
+00083320: 6574 5469 746c 6528 224e 6f20 6461 7461  etTitle("No data
+00083330: 206c 6f61 6465 6422 290d 0a0d 0a20 2020   loaded")....   
+00083340: 2020 2020 2073 656c 662e 636d 696d 6720       self.cmimg 
+00083350: 3d20 7067 2e49 6d61 6765 4974 656d 2862  = pg.ImageItem(b
+00083360: 6f72 6465 723d 4e6f 6e65 290d 0a20 2020  order=None)..   
+00083370: 2020 2020 2073 656c 662e 636d 203d 2073       self.cm = s
+00083380: 656c 662e 7067 6c61 796f 7574 2e61 6464  elf.pglayout.add
+00083390: 506c 6f74 2872 6f77 3d30 2c20 636f 6c3d  Plot(row=0, col=
+000833a0: 312c 2072 6f77 7370 616e 3d31 2c20 636f  1, rowspan=1, co
+000833b0: 6c73 7061 6e3d 3129 0d0a 2020 2020 2020  lspan=1)..      
+000833c0: 2020 7365 6c66 2e63 6d2e 6164 6449 7465    self.cm.addIte
+000833d0: 6d28 7365 6c66 2e63 6d69 6d67 290d 0a20  m(self.cmimg).. 
+000833e0: 2020 2020 2020 2073 656c 662e 636d 2e73         self.cm.s
+000833f0: 6574 4d6f 7573 6545 6e61 626c 6564 2878  etMouseEnabled(x
+00083400: 3d46 616c 7365 2c20 793d 4661 6c73 6529  =False, y=False)
+00083410: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+00083420: 6d2e 6765 7456 6965 7742 6f78 2829 2e61  m.getViewBox().a
+00083430: 7574 6f52 616e 6765 2870 6164 6469 6e67  utoRange(padding
+00083440: 3d30 290d 0a20 2020 2020 2020 2073 656c  =0)..        sel
+00083450: 662e 636d 2e73 686f 7741 7869 7328 2274  f.cm.showAxis("t
+00083460: 6f70 222c 2073 686f 773d 5472 7565 290d  op", show=True).
+00083470: 0a20 2020 2020 2020 2073 656c 662e 636d  .        self.cm
+00083480: 2e73 686f 7741 7869 7328 2262 6f74 746f  .showAxis("botto
+00083490: 6d22 2c20 7368 6f77 3d54 7275 6529 0d0a  m", show=True)..
+000834a0: 2020 2020 2020 2020 7365 6c66 2e63 6d2e          self.cm.
+000834b0: 7368 6f77 4178 6973 2822 6c65 6674 222c  showAxis("left",
+000834c0: 2073 686f 773d 5472 7565 290d 0a20 2020   show=True)..   
+000834d0: 2020 2020 2073 656c 662e 636d 2e73 686f       self.cm.sho
+000834e0: 7741 7869 7328 2272 6967 6874 222c 2073  wAxis("right", s
+000834f0: 686f 773d 5472 7565 290d 0a20 2020 2020  how=True)..     
+00083500: 2020 2073 656c 662e 636d 2e73 6574 5469     self.cm.setTi
+00083510: 746c 6528 2222 290d 0a20 2020 2020 2020  tle("")..       
+00083520: 2061 7933 203d 2073 656c 662e 636d 2e67   ay3 = self.cm.g
+00083530: 6574 4178 6973 2822 6c65 6674 2229 0d0a  etAxis("left")..
+00083540: 2020 2020 2020 2020 6179 332e 7365 745a          ay3.setZ
+00083550: 5661 6c75 6528 3130 3030 290d 0a20 2020  Value(1000)..   
+00083560: 2020 2020 2062 7933 203d 2073 656c 662e       by3 = self.
+00083570: 636d 2e67 6574 4178 6973 2822 7269 6768  cm.getAxis("righ
+00083580: 7422 290d 0a20 2020 2020 2020 2062 7933  t")..        by3
+00083590: 2e73 6574 5a56 616c 7565 2831 3030 3029  .setZValue(1000)
+000835a0: 0d0a 2020 2020 2020 2020 6278 3320 3d20  ..        bx3 = 
+000835b0: 7365 6c66 2e63 6d2e 6765 7441 7869 7328  self.cm.getAxis(
+000835c0: 2274 6f70 2229 0d0a 2020 2020 2020 2020  "top")..        
+000835d0: 6278 332e 7365 745a 5661 6c75 6528 3130  bx3.setZValue(10
+000835e0: 3030 290d 0a20 2020 2020 2020 2061 7833  00)..        ax3
+000835f0: 203d 2073 656c 662e 636d 2e67 6574 4178   = self.cm.getAx
+00083600: 6973 2822 626f 7474 6f6d 2229 0d0a 2020  is("bottom")..  
+00083610: 2020 2020 2020 6178 332e 7365 7448 6569        ax3.setHei
+00083620: 6768 7428 683d 3436 2e32 2920 2377 6f72  ght(h=46.2) #wor
+00083630: 6b61 726f 756e 6420 666f 7220 6f76 6572  karound for over
+00083640: 6c79 206c 6f6e 6720 636f 6c6f 7262 6172  ly long colorbar
+00083650: 2069 6e20 6c69 6e75 780d 0a20 2020 2020   in linux..     
+00083660: 2020 2062 7933 2e73 6574 5769 6474 6828     by3.setWidth(
+00083670: 773d 3630 290d 0a20 2020 2020 2020 2061  w=60)..        a
+00083680: 7833 2e73 6574 5a56 616c 7565 2831 3030  x3.setZValue(100
+00083690: 3029 0d0a 2020 2020 2020 2020 6178 332e  0)..        ax3.
+000836a0: 7365 7454 6963 6b73 285b 5d29 0d0a 2020  setTicks([])..  
+000836b0: 2020 2020 2020 6178 332e 7365 744c 6162        ax3.setLab
+000836c0: 656c 2874 6578 743d 2222 2c20 756e 6974  el(text="", unit
+000836d0: 733d 2222 290d 0a20 2020 2020 2020 2062  s="")..        b
+000836e0: 7933 203d 2073 656c 662e 636d 2e67 6574  y3 = self.cm.get
+000836f0: 4178 6973 2822 7269 6768 7422 290d 0a20  Axis("right").. 
+00083700: 2020 2020 2020 2062 7933 2e73 6574 4c61         by3.setLa
+00083710: 6265 6c28 7465 7874 3d22 636f 756e 7473  bel(text="counts
+00083720: 222c 2075 6e69 7473 3d22 2229 0d0a 2020  ", units="")..  
+00083730: 2020 2020 2020 6279 332e 7365 7453 7479        by3.setSty
+00083740: 6c65 2874 6963 6b4c 656e 6774 683d 3829  le(tickLength=8)
+00083750: 0d0a 2020 2020 2020 2020 6179 332e 7365  ..        ay3.se
+00083760: 7453 7479 6c65 2873 686f 7756 616c 7565  tStyle(showValue
+00083770: 733d 4661 6c73 652c 7469 636b 4c65 6e67  s=False,tickLeng
+00083780: 7468 3d30 290d 0a20 2020 2020 2020 2062  th=0)..        b
+00083790: 7833 2e73 6574 5374 796c 6528 7368 6f77  x3.setStyle(show
+000837a0: 5661 6c75 6573 3d46 616c 7365 2c74 6963  Values=False,tic
+000837b0: 6b4c 656e 6774 683d 3029 0d0a 0d0a 0d0a  kLength=0)......
+000837c0: 2020 2020 2020 2020 7365 6c66 2e70 676c          self.pgl
+000837d0: 6179 6f75 742e 6c61 796f 7574 2e73 6574  ayout.layout.set
+000837e0: 436f 6c75 6d6e 4d69 6e69 6d75 6d57 6964  ColumnMinimumWid
+000837f0: 7468 2831 2c20 3830 290d 0a20 2020 2020  th(1, 80)..     
+00083800: 2020 2073 656c 662e 7067 6c61 796f 7574     self.pglayout
+00083810: 2e6c 6179 6f75 742e 7365 7443 6f6c 756d  .layout.setColum
+00083820: 6e4d 6178 696d 756d 5769 6474 6828 312c  nMaximumWidth(1,
+00083830: 2038 3029 0d0a 0d0a 2020 2020 2020 2020   80)....        
+00083840: 7365 6c66 2e74 635f 6669 6c65 2e73 6574  self.tc_file.set
+00083850: 5465 7874 2827 4669 6c65 206e 616d 6527  Text('File name'
+00083860: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+00083870: 662e 7463 5f70 6174 682e 7365 7454 6578  f.tc_path.setTex
+00083880: 7428 2744 3a2f 2729 0d0a 2020 2020 2020  t('D:/')..      
+00083890: 2020 7365 6c66 2e73 6c69 6465 725f 7468    self.slider_th
+000838a0: 6574 612e 7365 7456 6973 6962 6c65 2846  eta.setVisible(F
+000838b0: 616c 7365 290d 0a0d 0a20 2020 2064 6566  alse)....    def
+000838c0: 2043 6c65 6172 2873 656c 6629 3a0d 0a20   Clear(self):.. 
+000838d0: 2020 2020 2020 2073 656c 662e 7031 2e63         self.p1.c
+000838e0: 6c65 6172 2829 0d0a 0d0a 2020 2020 6465  lear()....    de
+000838f0: 6620 4c6f 6164 456e 7472 6965 7328 7365  f LoadEntries(se
+00083900: 6c66 293a 2023 2043 616c 6c65 6420 7768  lf): # Called wh
+00083910: 656e 2066 7265 7368 2064 6174 6120 6172  en fresh data ar
+00083920: 6520 6c6f 6164 6564 2e0d 0a20 2020 2020  e loaded...     
+00083930: 2020 2073 656c 662e 7031 2e61 6464 4974     self.p1.addIt
+00083940: 656d 2873 656c 662e 695f 6974 656d 290d  em(self.i_item).
+00083950: 0a20 2020 2020 2020 2073 656c 662e 4f6e  .        self.On
+00083960: 5363 726f 6c6c 456e 6728 3029 2023 2050  ScrollEng(0) # P
+00083970: 6c6f 7420 6669 7273 7420 696d 6167 6520  lot first image 
+00083980: 2620 7365 7420 5363 726f 6c6c 6261 720d  & set Scrollbar.
+00083990: 0a20 2020 2020 2020 2073 656c 662e 4f6e  .        self.On
+000839a0: 4d65 7472 6963 5363 616c 6528 7365 6c66  MetricScale(self
+000839b0: 2e4d 6574 7269 6343 6865 636b 426f 782e  .MetricCheckBox.
+000839c0: 6973 4368 6563 6b65 6428 292c 2054 7275  isChecked(), Tru
+000839d0: 652c 2046 616c 7365 290d 0a0d 0a20 2020  e, False)....   
+000839e0: 2064 6566 206b 6579 5072 6573 7345 7665   def keyPressEve
+000839f0: 6e74 2873 656c 662c 2065 293a 0d0a 2020  nt(self, e):..  
+00083a00: 2020 2020 2020 6966 2065 2e6b 6579 2829        if e.key()
+00083a10: 203d 3d20 3637 2061 6e64 2028 652e 6d6f   == 67 and (e.mo
+00083a20: 6469 6669 6572 7328 2920 2620 5174 436f  difiers() & QtCo
+00083a30: 7265 2e51 742e 436f 6e74 726f 6c4d 6f64  re.Qt.ControlMod
+00083a40: 6966 6965 7229 3a0d 0a20 2020 2020 2020  ifier):..       
+00083a50: 2020 2020 2073 656c 662e 4f6e 436f 7079       self.OnCopy
+00083a60: 2829 0d0a 0d0a 2020 2020 6465 6620 4f6e  ()....    def On
+00083a70: 4d65 7472 6963 5363 616c 6528 7365 6c66  MetricScale(self
+00083a80: 2c20 7365 746d 6574 7269 633d 2054 7275  , setmetric= Tru
+00083a90: 652c 207a 6572 6f6f 7269 6769 6e3d 2054  e, zeroorigin= T
+00083aa0: 7275 652c 2073 7175 6172 653d 2046 616c  rue, square= Fal
+00083ab0: 7365 293a 0d0a 2020 2020 2020 2020 6966  se):..        if
+00083ac0: 2073 656c 662e 636f 6d2e 7374 6163 6b5f   self.com.stack_
+00083ad0: 6c6f 6164 6564 203d 3d20 313a 0d0a 2020  loaded == 1:..  
+00083ae0: 2020 2020 2020 2020 2020 6966 2073 6574            if set
+00083af0: 6d65 7472 6963 3d3d 5472 7565 3a0d 0a20  metric==True:.. 
+00083b00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00083b10: 656c 662e 5371 7561 7265 5078 4368 6563  elf.SquarePxChec
+00083b20: 6b42 6f78 2e73 6574 5669 7369 626c 6528  kBox.setVisible(
+00083b30: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
+00083b40: 2020 2020 2020 2020 7365 6c66 2e5a 6572          self.Zer
+00083b50: 6f4f 7269 6769 6e43 6865 636b 426f 782e  oOriginCheckBox.
+00083b60: 7365 7456 6973 6962 6c65 2854 7275 6529  setVisible(True)
+00083b70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00083b80: 2020 7365 6c66 2e70 312e 7365 7441 7370    self.p1.setAsp
+00083b90: 6563 744c 6f63 6b65 6428 6c6f 636b 3d54  ectLocked(lock=T
+00083ba0: 7275 652c 2072 6174 696f 3d31 290d 0a20  rue, ratio=1).. 
+00083bb0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00083bc0: 7365 6c66 2e70 322e 7365 7441 7370 6563  self.p2.setAspec
+00083bd0: 744c 6f63 6b65 6428 6c6f 636b 3d54 7275  tLocked(lock=Tru
+00083be0: 652c 2072 6174 696f 3d31 290d 0a20 2020  e, ratio=1)..   
+00083bf0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00083c00: 6e6f 7420 7a65 726f 6f72 6967 696e 3a0d  not zeroorigin:.
+00083c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00083c20: 2020 2020 2078 5f73 7461 7274 203d 2073       x_start = s
+00083c30: 656c 662e 7374 6b2e 785f 7374 6172 742a  elf.stk.x_start*
+00083c40: 7365 6c66 2e73 6361 6c65 0d0a 2020 2020  self.scale..    
 00083c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00083c60: 785f 7374 6172 7420 3d20 300d 0a20 2020  x_start = 0..   
-00083c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00083c80: 2079 5f73 7461 7274 203d 2030 0d0a 2020   y_start = 0..  
-00083c90: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00083ca0: 6c66 2e61 7931 2e73 6574 4c61 6265 6c28  lf.ay1.setLabel(
-00083cb0: 7465 7874 3d22 7922 2c20 756e 6974 733d  text="y", units=
-00083cc0: 226d 2229 0d0a 2020 2020 2020 2020 2020  "m")..          
-00083cd0: 2020 2020 2020 7365 6c66 2e61 7831 2e73        self.ax1.s
-00083ce0: 6574 4c61 6265 6c28 7465 7874 3d22 7822  etLabel(text="x"
-00083cf0: 2c20 756e 6974 733d 226d 2229 0d0a 2020  , units="m")..  
-00083d00: 2020 2020 2020 2020 2020 2020 2020 2373                #s
-00083d10: 656c 662e 6179 322e 7365 744c 6162 656c  elf.ay2.setLabel
-00083d20: 2874 6578 743d 2279 222c 2075 6e69 7473  (text="y", units
-00083d30: 3d22 6d22 290d 0a20 2020 2020 2020 2020  ="m")..         
-00083d40: 2020 2020 2020 2023 7365 6c66 2e61 7832         #self.ax2
-00083d50: 2e73 6574 4c61 6265 6c28 7465 7874 3d22  .setLabel(text="
-00083d60: 7822 2c20 756e 6974 733d 226d 2229 0d0a  x", units="m")..
-00083d70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00083d80: 2020 7365 6c66 2e69 5f69 7465 6d2e 7365    self.i_item.se
-00083d90: 7452 6563 7428 5174 436f 7265 2e51 5265  tRect(QtCore.QRe
-00083da0: 6374 4628 785f 7374 6172 742c 2079 5f73  ctF(x_start, y_s
-00083db0: 7461 7274 2c20 7365 6c66 2e73 6361 6c65  tart, self.scale
-00083dc0: 2a73 656c 662e 7374 6b2e 6e5f 636f 6c73  *self.stk.n_cols
-00083dd0: 2a73 656c 662e 7374 6b2e 785f 7078 7369  *self.stk.x_pxsi
-00083de0: 7a65 2c20 7365 6c66 2e73 6361 6c65 2a73  ze, self.scale*s
-00083df0: 656c 662e 7374 6b2e 6e5f 726f 7773 2a73  elf.stk.n_rows*s
-00083e00: 656c 662e 7374 6b2e 795f 7078 7369 7a65  elf.stk.y_pxsize
-00083e10: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00083e20: 2020 2020 2369 6620 6861 7361 7474 7228      #if hasattr(
-00083e30: 7365 6c66 2c20 224f 4422 293a 0d0a 2020  self, "OD"):..  
-00083e40: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00083e50: 2020 2073 656c 662e 6d5f 6974 656d 2e73     self.m_item.s
-00083e60: 6574 5265 6374 2851 7443 6f72 652e 5152  etRect(QtCore.QR
-00083e70: 6563 7446 2878 5f73 7461 7274 2c20 795f  ectF(x_start, y_
-00083e80: 7374 6172 742c 2073 656c 662e 7363 616c  start, self.scal
-00083e90: 652a 6e70 2e73 6861 7065 2873 656c 662e  e*np.shape(self.
-00083ea0: 4f44 295b 305d 2a73 656c 662e 7374 6b2e  OD)[0]*self.stk.
-00083eb0: 785f 7078 7369 7a65 2c20 7365 6c66 2e73  x_pxsize, self.s
-00083ec0: 6361 6c65 2a6e 702e 7368 6170 6528 7365  cale*np.shape(se
-00083ed0: 6c66 2e4f 4429 5b31 5d2a 7365 6c66 2e73  lf.OD)[1]*self.s
-00083ee0: 746b 2e79 5f70 7873 697a 6529 290d 0a20  tk.y_pxsize)).. 
-00083ef0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00083f00: 2020 2020 7365 6c66 2e73 6574 4372 6f73      self.setCros
-00083f10: 7368 6169 7228 290d 0a20 2020 2020 2020  shair()..       
-00083f20: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00083f30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00083f40: 2e5a 6572 6f4f 7269 6769 6e43 6865 636b  .ZeroOriginCheck
-00083f50: 426f 782e 7365 7456 6973 6962 6c65 2846  Box.setVisible(F
-00083f60: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
-00083f70: 2020 2020 2020 2073 656c 662e 5371 7561         self.Squa
-00083f80: 7265 5078 4368 6563 6b42 6f78 2e73 6574  rePxCheckBox.set
-00083f90: 5669 7369 626c 6528 5472 7565 290d 0a20  Visible(True).. 
-00083fa0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00083fb0: 6620 7371 7561 7265 203d 3d20 5472 7565  f square == True
-00083fc0: 206f 7220 7365 6c66 2e73 746b 2e78 5f70   or self.stk.x_p
-00083fd0: 7873 697a 6520 3d3d 2030 206f 7220 7365  xsize == 0 or se
-00083fe0: 6c66 2e73 746b 2e79 5f70 7873 697a 6520  lf.stk.y_pxsize 
-00083ff0: 3d3d 2030 3a0d 0a20 2020 2020 2020 2020  == 0:..         
-00084000: 2020 2020 2020 2020 2020 2061 7370 6563             aspec
-00084010: 7420 3d20 310d 0a20 2020 2020 2020 2020  t = 1..         
-00084020: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00084030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00084040: 2020 6173 7065 6374 203d 2073 656c 662e    aspect = self.
-00084050: 7374 6b2e 785f 7078 7369 7a65 2f73 656c  stk.x_pxsize/sel
-00084060: 662e 7374 6b2e 795f 7078 7369 7a65 0d0a  f.stk.y_pxsize..
-00084070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00084080: 2020 2020 2370 7269 6e74 2861 7370 6563      #print(aspec
-00084090: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-000840a0: 2020 2020 7365 6c66 2e70 312e 7365 7441      self.p1.setA
-000840b0: 7370 6563 744c 6f63 6b65 6428 6c6f 636b  spectLocked(lock
-000840c0: 3d54 7275 652c 2072 6174 696f 3d61 7370  =True, ratio=asp
-000840d0: 6563 7429 0d0a 2020 2020 2020 2020 2020  ect)..          
-000840e0: 2020 2020 2020 7365 6c66 2e61 7931 2e73        self.ay1.s
-000840f0: 6574 4c61 6265 6c28 7465 7874 3d22 7922  etLabel(text="y"
-00084100: 2c20 756e 6974 733d 2270 7822 290d 0a20  , units="px").. 
-00084110: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00084120: 656c 662e 6178 312e 7365 744c 6162 656c  elf.ax1.setLabel
-00084130: 2874 6578 743d 2278 222c 2075 6e69 7473  (text="x", units
-00084140: 3d22 7078 2229 0d0a 2020 2020 2020 2020  ="px")..        
-00084150: 2020 2020 2020 2020 7365 6c66 2e69 5f69          self.i_i
-00084160: 7465 6d2e 7365 7452 6563 7428 5174 436f  tem.setRect(QtCo
-00084170: 7265 2e51 5265 6374 4628 302c 2030 2c20  re.QRectF(0, 0, 
-00084180: 7365 6c66 2e73 746b 2e6e 5f63 6f6c 732c  self.stk.n_cols,
-00084190: 2073 656c 662e 7374 6b2e 6e5f 726f 7773   self.stk.n_rows
-000841a0: 2929 0d0a 2320 2d2d 2d2d 2d2d 2d2d 2d2d  ))..# ----------
-000841b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000841c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000841d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000841e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020  ------------..  
-000841f0: 2020 6465 6620 4f6e 4361 7443 6861 6e67    def OnCatChang
-00084200: 6564 2873 656c 6629 3a0d 0a20 2020 2020  ed(self):..     
-00084210: 2020 2073 656c 662e 434d 4d61 7042 6f78     self.CMMapBox
-00084220: 2e62 6c6f 636b 5369 676e 616c 7328 5472  .blockSignals(Tr
-00084230: 7565 290d 0a20 2020 2020 2020 2073 656c  ue)..        sel
-00084240: 662e 434d 4d61 7042 6f78 2e63 6c65 6172  f.CMMapBox.clear
-00084250: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
-00084260: 2e43 4d4d 6170 426f 782e 626c 6f63 6b53  .CMMapBox.blockS
-00084270: 6967 6e61 6c73 2846 616c 7365 290d 0a20  ignals(False).. 
-00084280: 2020 2020 2020 2073 656c 662e 434d 4d61         self.CMMa
-00084290: 7042 6f78 2e61 6464 4974 656d 7328 7365  pBox.addItems(se
-000842a0: 6c66 2e63 6d61 7073 5b73 656c 662e 434d  lf.cmaps[self.CM
-000842b0: 4361 7442 6f78 2e63 7572 7265 6e74 496e  CatBox.currentIn
-000842c0: 6465 7828 295d 5b31 5d29 0d0a 0d0a 2020  dex()][1])....  
-000842d0: 2020 6465 6620 6361 6c63 4269 6e53 697a    def calcBinSiz
-000842e0: 6528 7365 6c66 2c69 2c4e 293a 0d0a 2020  e(self,i,N):..  
-000842f0: 2020 2020 2020 7265 7475 726e 2069 6e74        return int
-00084300: 2872 6f75 6e64 2832 3536 2a28 692b 3129  (round(256*(i+1)
-00084310: 2f4e 2920 2d20 726f 756e 6428 3235 362a  /N) - round(256*
-00084320: 692f 4e29 290d 0a0d 0a20 2020 2064 6566  i/N))....    def
-00084330: 204f 6e43 6f70 7928 7365 6c66 293a 0d0a   OnCopy(self):..
-00084340: 2020 2020 2020 2020 7365 6c66 2e65 7870          self.exp
-00084350: 203d 2070 672e 6578 706f 7274 6572 732e   = pg.exporters.
-00084360: 496d 6167 6545 7870 6f72 7465 7228 7365  ImageExporter(se
-00084370: 6c66 2e70 676c 6179 6f75 7429 0d0a 2020  lf.pglayout)..  
-00084380: 2020 2020 2020 7365 6c66 2e65 7870 2e65        self.exp.e
-00084390: 7870 6f72 7428 636f 7079 3d54 7275 6529  xport(copy=True)
-000843a0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000843b0: 0d0a 0d0a 2020 2020 6465 6620 4f6e 4d69  ....    def OnMi
-000843c0: 7272 6f72 2873 656c 6629 3a0d 0a20 2020  rror(self):..   
-000843d0: 2020 2020 2069 6620 7365 6c66 2e63 6f6d       if self.com
-000843e0: 2e73 7461 636b 5f6c 6f61 6465 6420 3d3d  .stack_loaded ==
-000843f0: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
-00084400: 2069 6620 7365 6c66 2e63 6f6d 2e73 7461   if self.com.sta
-00084410: 636b 5f34 6420 3d3d 2031 3a0d 0a20 2020  ck_4d == 1:..   
-00084420: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00084430: 662e 7374 6b2e 7374 6163 6b34 4420 3d20  f.stk.stack4D = 
-00084440: 6e70 2e66 6c69 7028 7365 6c66 2e73 746b  np.flip(self.stk
-00084450: 2e73 7461 636b 3444 2c20 6178 6973 3d30  .stack4D, axis=0
-00084460: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00084470: 2020 2073 656c 662e 7374 6b2e 6162 7364     self.stk.absd
-00084480: 6174 6120 3d20 7365 6c66 2e73 746b 2e73  ata = self.stk.s
-00084490: 7461 636b 3444 5b3a 2c20 3a2c 203a 2c20  tack4D[:, :, :, 
-000844a0: 7365 6c66 2e69 7468 6574 615d 2e63 6f70  self.itheta].cop
-000844b0: 7928 290d 0a20 2020 2020 2020 2020 2020  y()..           
-000844c0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-000844d0: 2020 2020 2020 2020 7365 6c66 2e73 746b          self.stk
-000844e0: 2e61 6273 6461 7461 203d 206e 702e 666c  .absdata = np.fl
-000844f0: 6970 2873 656c 662e 7374 6b2e 6162 7364  ip(self.stk.absd
-00084500: 6174 612c 2061 7869 733d 3029 0d0a 0d0a  ata, axis=0)....
-00084510: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00084520: 656c 662e 636f 6d2e 6930 5f6c 6f61 6465  elf.com.i0_loade
-00084530: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-00084540: 2020 2020 6966 2073 656c 662e 636f 6d2e      if self.com.
-00084550: 7374 6163 6b5f 3464 3a0d 0a20 2020 2020  stack_4d:..     
-00084560: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00084570: 656c 662e 7374 6b2e 6f64 3444 203d 206e  elf.stk.od4D = n
-00084580: 702e 666c 6970 2873 656c 662e 7374 6b2e  p.flip(self.stk.
-00084590: 6f64 3444 2c20 6178 6973 3d30 290d 0a20  od4D, axis=0).. 
-000845a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000845b0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-000845c0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-000845d0: 746b 2e6f 6433 6420 3d20 6e70 2e66 6c69  tk.od3d = np.fli
-000845e0: 7028 7365 6c66 2e73 746b 2e6f 6433 642c  p(self.stk.od3d,
-000845f0: 2061 7869 733d 3029 0d0a 2020 2020 2020   axis=0)..      
-00084600: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00084610: 6c66 2e73 746b 2e6f 6420 3d20 7365 6c66  lf.stk.od = self
-00084620: 2e73 746b 2e6f 6433 642e 636f 7079 2829  .stk.od3d.copy()
-00084630: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00084640: 2020 2020 2020 7365 6c66 2e73 746b 2e6f        self.stk.o
-00084650: 6420 3d20 6e70 2e72 6573 6861 7065 2873  d = np.reshape(s
-00084660: 656c 662e 7374 6b2e 6f64 2c20 2873 656c  elf.stk.od, (sel
-00084670: 662e 7374 6b2e 6e5f 726f 7773 202a 2073  f.stk.n_rows * s
-00084680: 656c 662e 7374 6b2e 6e5f 636f 6c73 2c20  elf.stk.n_cols, 
-00084690: 7365 6c66 2e73 746b 2e6e 5f65 7629 2c0d  self.stk.n_ev),.
-000846a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000846b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000846c0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-000846d0: 723d 2746 2729 0d0a 0d0a 2020 2020 2020  r='F')....      
-000846e0: 2020 2020 2020 7365 6c66 2e73 746b 2e66        self.stk.f
-000846f0: 696c 6c5f 6835 5f73 7472 7563 745f 6672  ill_h5_struct_fr
-00084700: 6f6d 5f73 746b 2829 0d0a 2020 2020 2020  om_stk()..      
-00084710: 2020 2020 2020 6966 2073 656c 662e 636f        if self.co
-00084720: 6d2e 6930 5f6c 6f61 6465 6420 3d3d 2031  m.i0_loaded == 1
-00084730: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00084740: 2020 2073 656c 662e 7374 6b2e 6669 6c6c     self.stk.fill
-00084750: 5f68 355f 7374 7275 6374 5f6e 6f72 6d61  _h5_struct_norma
-00084760: 6c69 7a61 7469 6f6e 2829 0d0a 0d0a 2020  lization()....  
-00084770: 2020 2020 2020 2020 2020 7365 6c66 2e4f            self.O
-00084780: 6e53 6372 6f6c 6c45 6e67 2873 656c 662e  nScrollEng(self.
-00084790: 6965 7629 0d0a 2020 2020 2020 2020 2020  iev)..          
-000847a0: 2020 2320 5570 6461 7465 2f52 6566 7265    # Update/Refre
-000847b0: 7368 2077 6964 6765 7473 3a0d 0a20 2020  sh widgets:..   
-000847c0: 2020 2020 2020 2020 2069 6620 7368 6f77           if show
-000847d0: 6d61 7074 6162 3a0d 0a20 2020 2020 2020  maptab:..       
-000847e0: 2020 2020 2020 2020 2073 656c 662e 7769           self.wi
-000847f0: 6e64 6f77 2829 2e70 6167 6539 2e43 6c65  ndow().page9.Cle
-00084800: 6172 2829 0d0a 2020 2020 2020 2020 2020  ar()..          
-00084810: 2020 2020 2020 7365 6c66 2e77 696e 646f        self.windo
-00084820: 7728 292e 7061 6765 392e 4c6f 6164 456e  w().page9.LoadEn
-00084830: 7472 6965 7328 290d 0a20 2020 2020 2020  tries()..       
-00084840: 2020 2020 2073 656c 662e 7769 6e64 6f77       self.window
-00084850: 2829 2e70 6167 6531 2e6c 6f61 6449 6d61  ().page1.loadIma
-00084860: 6765 2829 0d0a 2020 2020 2020 2020 7265  ge()..        re
-00084870: 7475 726e 0d0a 0d0a 2020 2020 6465 6620  turn....    def 
-00084880: 4f6e 526f 7461 7465 2873 656c 6629 3a0d  OnRotate(self):.
-00084890: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000848a0: 2e63 6f6d 2e73 7461 636b 5f6c 6f61 6465  .com.stack_loade
-000848b0: 6420 3d3d 2031 3a0d 0a20 2020 2020 2020  d == 1:..       
-000848c0: 2020 2020 2069 6620 7365 6c66 2e63 6f6d       if self.com
-000848d0: 2e73 7461 636b 5f34 6420 3d3d 2031 3a0d  .stack_4d == 1:.
-000848e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000848f0: 2073 656c 662e 7374 6b2e 7374 6163 6b34   self.stk.stack4
-00084900: 4420 3d20 6e70 2e72 6f74 3930 2873 656c  D = np.rot90(sel
-00084910: 662e 7374 6b2e 7374 6163 6b34 442c 2033  f.stk.stack4D, 3
-00084920: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00084930: 2020 2073 656c 662e 7374 6b2e 6162 7364     self.stk.absd
-00084940: 6174 6120 3d20 7365 6c66 2e73 746b 2e73  ata = self.stk.s
-00084950: 7461 636b 3444 5b3a 2c20 3a2c 203a 2c20  tack4D[:, :, :, 
-00084960: 7365 6c66 2e69 7468 6574 615d 2e63 6f70  self.itheta].cop
-00084970: 7928 290d 0a20 2020 2020 2020 2020 2020  y()..           
-00084980: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00084990: 2020 2020 2020 2020 7365 6c66 2e73 746b          self.stk
-000849a0: 2e61 6273 6461 7461 203d 206e 702e 726f  .absdata = np.ro
-000849b0: 7439 3028 7365 6c66 2e73 746b 2e61 6273  t90(self.stk.abs
-000849c0: 6461 7461 2c20 3329 0d0a 0d0a 2020 2020  data, 3)....    
-000849d0: 2020 2020 2020 2020 2320 5377 6170 2078          # Swap x
-000849e0: 2f79 2063 6f6e 7374 616e 7473 3a0d 0a20  /y constants:.. 
-000849f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00084a00: 7374 6b2e 6e5f 636f 6c73 2c20 7365 6c66  stk.n_cols, self
-00084a10: 2e73 746b 2e6e 5f72 6f77 7320 3d20 7365  .stk.n_rows = se
-00084a20: 6c66 2e73 746b 2e6e 5f72 6f77 732c 2073  lf.stk.n_rows, s
-00084a30: 656c 662e 7374 6b2e 6e5f 636f 6c73 0d0a  elf.stk.n_cols..
-00084a40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00084a50: 2e73 746b 2e78 5f70 7873 697a 652c 2073  .stk.x_pxsize, s
-00084a60: 656c 662e 7374 6b2e 795f 7078 7369 7a65  elf.stk.y_pxsize
-00084a70: 203d 2073 656c 662e 7374 6b2e 795f 7078   = self.stk.y_px
-00084a80: 7369 7a65 2c20 7365 6c66 2e73 746b 2e78  size, self.stk.x
-00084a90: 5f70 7873 697a 650d 0a20 2020 2020 2020  _pxsize..       
-00084aa0: 2020 2020 2073 656c 662e 7374 6b2e 785f       self.stk.x_
-00084ab0: 7374 6172 742c 2073 656c 662e 7374 6b2e  start, self.stk.
-00084ac0: 795f 7374 6172 7420 3d20 7365 6c66 2e73  y_start = self.s
-00084ad0: 746b 2e79 5f73 7461 7274 2c20 7365 6c66  tk.y_start, self
-00084ae0: 2e73 746b 2e78 5f73 7461 7274 0d0a 2020  .stk.x_start..  
-00084af0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-00084b00: 746b 2e78 5f64 6973 742c 2073 656c 662e  tk.x_dist, self.
-00084b10: 7374 6b2e 795f 6469 7374 203d 2073 656c  stk.y_dist = sel
-00084b20: 662e 7374 6b2e 795f 6469 7374 2c20 7365  f.stk.y_dist, se
-00084b30: 6c66 2e73 746b 2e78 5f64 6973 740d 0a0d  lf.stk.x_dist...
-00084b40: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00084b50: 7365 6c66 2e63 6f6d 2e69 305f 6c6f 6164  self.com.i0_load
-00084b60: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-00084b70: 2020 2020 2069 6620 7365 6c66 2e63 6f6d       if self.com
-00084b80: 2e73 7461 636b 5f34 643a 0d0a 2020 2020  .stack_4d:..    
-00084b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00084ba0: 7365 6c66 2e73 746b 2e6f 6434 4420 3d20  self.stk.od4D = 
-00084bb0: 6e70 2e72 6f74 3930 2873 656c 662e 7374  np.rot90(self.st
-00084bc0: 6b2e 6f64 3444 2c20 3329 0d0a 2020 2020  k.od4D, 3)..    
-00084bd0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00084be0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00084bf0: 2020 2020 2020 2073 656c 662e 7374 6b2e         self.stk.
-00084c00: 6f64 3364 203d 2020 6e70 2e72 6f74 3930  od3d =  np.rot90
-00084c10: 2873 656c 662e 7374 6b2e 6f64 3364 2c20  (self.stk.od3d, 
-00084c20: 3329 0d0a 2020 2020 2020 2020 2020 2020  3)..            
-00084c30: 2020 2020 2020 2020 7365 6c66 2e73 746b          self.stk
-00084c40: 2e6f 6420 3d20 7365 6c66 2e73 746b 2e6f  .od = self.stk.o
-00084c50: 6433 642e 636f 7079 2829 0d0a 2020 2020  d3d.copy()..    
-00084c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00084c70: 7365 6c66 2e73 746b 2e6f 6420 3d20 6e70  self.stk.od = np
-00084c80: 2e72 6573 6861 7065 2873 656c 662e 7374  .reshape(self.st
-00084c90: 6b2e 6f64 2c20 2873 656c 662e 7374 6b2e  k.od, (self.stk.
-00084ca0: 6e5f 726f 7773 202a 2073 656c 662e 7374  n_rows * self.st
-00084cb0: 6b2e 6e5f 636f 6c73 2c20 7365 6c66 2e73  k.n_cols, self.s
-00084cc0: 746b 2e6e 5f65 7629 2c0d 0a20 2020 2020  tk.n_ev),..     
-00084cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00084ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00084cf0: 2020 2020 2020 6f72 6465 723d 2746 2729        order='F')
-00084d00: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00084d10: 7365 6c66 2e73 746b 2e66 696c 6c5f 6835  self.stk.fill_h5
-00084d20: 5f73 7472 7563 745f 6672 6f6d 5f73 746b  _struct_from_stk
-00084d30: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00084d40: 6966 2073 656c 662e 636f 6d2e 6930 5f6c  if self.com.i0_l
-00084d50: 6f61 6465 6420 3d3d 2031 3a0d 0a20 2020  oaded == 1:..   
-00084d60: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00084d70: 662e 7374 6b2e 6669 6c6c 5f68 355f 7374  f.stk.fill_h5_st
-00084d80: 7275 6374 5f6e 6f72 6d61 6c69 7a61 7469  ruct_normalizati
-00084d90: 6f6e 2829 0d0a 0d0a 2020 2020 2020 2020  on()....        
-00084da0: 2020 2020 2320 5570 6461 7465 2f52 6566      # Update/Ref
-00084db0: 7265 7368 2077 6964 6765 7473 3a0d 0a20  resh widgets:.. 
-00084dc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00084dd0: 4f6e 5363 726f 6c6c 456e 6728 7365 6c66  OnScrollEng(self
-00084de0: 2e69 6576 290d 0a20 2020 2020 2020 2020  .iev)..         
-00084df0: 2020 2073 656c 662e 4f6e 4d65 7472 6963     self.OnMetric
-00084e00: 5363 616c 6528 7365 6c66 2e4d 6574 7269  Scale(self.Metri
-00084e10: 6343 6865 636b 426f 782e 6973 4368 6563  cCheckBox.isChec
-00084e20: 6b65 6428 292c 2073 656c 662e 5a65 726f  ked(), self.Zero
-00084e30: 4f72 6967 696e 4368 6563 6b42 6f78 2e69  OriginCheckBox.i
-00084e40: 7343 6865 636b 6564 2829 2c73 656c 662e  sChecked(),self.
-00084e50: 5371 7561 7265 5078 4368 6563 6b42 6f78  SquarePxCheckBox
-00084e60: 2e69 7343 6865 636b 6564 2829 290d 0a20  .isChecked()).. 
-00084e70: 2020 2020 2020 2020 2020 2069 6620 7368             if sh
-00084e80: 6f77 6d61 7074 6162 3a0d 0a20 2020 2020  owmaptab:..     
-00084e90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00084ea0: 7769 6e64 6f77 2829 2e70 6167 6539 2e43  window().page9.C
-00084eb0: 6c65 6172 2829 0d0a 2020 2020 2020 2020  lear()..        
-00084ec0: 2020 2020 2020 2020 7365 6c66 2e77 696e          self.win
-00084ed0: 646f 7728 292e 7061 6765 392e 4c6f 6164  dow().page9.Load
-00084ee0: 456e 7472 6965 7328 290d 0a20 2020 2020  Entries()..     
-00084ef0: 2020 2020 2020 2073 656c 662e 7769 6e64         self.wind
-00084f00: 6f77 2829 2e70 6167 6531 2e69 7820 3d20  ow().page1.ix = 
-00084f10: 696e 7428 7365 6c66 2e73 746b 2e6e 5f63  int(self.stk.n_c
-00084f20: 6f6c 7320 2f20 3229 0d0a 2020 2020 2020  ols / 2)..      
-00084f30: 2020 2020 2020 7365 6c66 2e77 696e 646f        self.windo
-00084f40: 7728 292e 7061 6765 312e 6979 203d 2069  w().page1.iy = i
-00084f50: 6e74 2873 656c 662e 7374 6b2e 6e5f 726f  nt(self.stk.n_ro
-00084f60: 7773 202f 2032 290d 0a20 2020 2020 2020  ws / 2)..       
-00084f70: 2020 2020 2073 656c 662e 7769 6e64 6f77       self.window
-00084f80: 2829 2e70 6167 6531 2e73 686f 7753 7065  ().page1.showSpe
-00084f90: 6374 7275 6d28 7365 6c66 2e77 696e 646f  ctrum(self.windo
-00084fa0: 7728 292e 7061 6765 312e 6978 2c20 7365  w().page1.ix, se
-00084fb0: 6c66 2e77 696e 646f 7728 292e 7061 6765  lf.window().page
-00084fc0: 312e 6979 290d 0a20 2020 2020 2020 2020  1.iy)..         
-00084fd0: 2020 2073 656c 662e 7769 6e64 6f77 2829     self.window()
-00084fe0: 2e70 6167 6531 2e6c 6f61 6449 6d61 6765  .page1.loadImage
-00084ff0: 2829 0d0a 2020 2020 2020 2020 7265 7475  ()..        retu
-00085000: 726e 0d0a 0d0a 2020 2020 6465 6620 4f6e  rn....    def On
-00085010: 436f 6c6f 726d 6170 2873 656c 662c 6d61  Colormap(self,ma
-00085020: 703d 2267 7261 7922 2c20 636f 6c6f 7273  p="gray", colors
-00085030: 3d32 3536 293a 0d0a 2020 2020 2020 2020  =256):..        
-00085040: 6966 2073 656c 662e 636f 6d2e 7374 6163  if self.com.stac
-00085050: 6b5f 6c6f 6164 6564 203d 3d20 313a 0d0a  k_loaded == 1:..
-00085060: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
-00085070: 726d 6170 203d 2063 6d2e 6765 745f 636d  rmap = cm.get_cm
-00085080: 6170 286d 6170 2c20 636f 6c6f 7273 290d  ap(map, colors).
-00085090: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-000850a0: 6f72 6d61 7020 3d20 636f 6c6f 726d 6170  ormap = colormap
-000850b0: 286e 702e 6172 616e 6765 2863 6f6c 6f72  (np.arange(color
-000850c0: 7329 290d 0a20 2020 2020 2020 2020 2020  s))..           
-000850d0: 2063 6d5f 6c73 7420 3d20 5b5b 636f 6c6f   cm_lst = [[colo
-000850e0: 726d 6170 5b69 6478 5d5b 305d 2c20 636f  rmap[idx][0], co
-000850f0: 6c6f 726d 6170 5b69 6478 5d5b 315d 2c20  lormap[idx][1], 
-00085100: 636f 6c6f 726d 6170 5b69 6478 5d5b 325d  colormap[idx][2]
-00085110: 2c20 636f 6c6f 726d 6170 5b69 6478 5d5b  , colormap[idx][
-00085120: 335d 5d20 666f 7220 6964 7820 696e 2072  3]] for idx in r
-00085130: 616e 6765 286e 702e 7368 6170 6528 636f  ange(np.shape(co
-00085140: 6c6f 726d 6170 295b 305d 295d 2023 636f  lormap)[0])] #co
-00085150: 6e76 6572 7420 746f 2072 2c67 2c62 2c61  nvert to r,g,b,a
-00085160: 206c 6973 740d 0a20 2020 2020 2020 2020   list..         
-00085170: 2020 2063 6d5f 6c73 7420 3d20 5b69 7465     cm_lst = [ite
-00085180: 6d20 666f 7220 7375 6220 696e 205b 5b63  m for sub in [[c
-00085190: 6d5f 6c73 745b 695d 5d2a 7365 6c66 2e63  m_lst[i]]*self.c
-000851a0: 616c 6342 696e 5369 7a65 2869 2c63 6f6c  alcBinSize(i,col
-000851b0: 6f72 7329 2066 6f72 2069 2069 6e20 7261  ors) for i in ra
-000851c0: 6e67 6528 636f 6c6f 7273 295d 2066 6f72  nge(colors)] for
-000851d0: 2069 7465 6d20 696e 2073 7562 5d20 2366   item in sub] #f
-000851e0: 696c 6c73 2032 3536 2062 696e 7320 6173  ills 256 bins as
-000851f0: 2065 7175 616c 2061 7320 706f 7373 6962   equal as possib
-00085200: 6c65 2077 6974 6820 6e20 636f 6c6f 7273  le with n colors
-00085210: 0d0a 2020 2020 2020 2020 2020 2020 636d  ..            cm
-00085220: 5f61 7272 6179 203d 206e 702e 6172 7261  _array = np.arra
-00085230: 7928 5b6e 702e 6173 6172 7261 7928 636d  y([np.asarray(cm
-00085240: 5f6c 7374 295d 2920 2376 6572 7469 6361  _lst)]) #vertica
-00085250: 6c20 636f 6c6f 7262 6172 0d0a 2020 2020  l colorbar..    
-00085260: 2020 2020 2020 2020 636d 5f6c 7374 2e65          cm_lst.e
-00085270: 7874 656e 6428 2863 6d5f 6c73 745b 2d31  xtend((cm_lst[-1
-00085280: 5d2c 636d 5f6c 7374 5b2d 315d 2c63 6d5f  ],cm_lst[-1],cm_
-00085290: 6c73 745b 2d31 5d29 290d 0a20 2020 2020  lst[-1]))..     
-000852a0: 2020 2020 2020 206c 7574 203d 206e 702e         lut = np.
-000852b0: 6173 6172 7261 7928 636d 5f6c 7374 290d  asarray(cm_lst).
-000852c0: 0a20 2020 2020 2020 2020 2020 206c 7574  .            lut
-000852d0: 203d 2028 6c75 7420 2a20 3235 3529 2e76   = (lut * 255).v
-000852e0: 6965 7728 6e70 2e6e 6461 7272 6179 290d  iew(np.ndarray).
-000852f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00085300: 662e 636d 696d 672e 7365 7449 6d61 6765  f.cmimg.setImage
-00085310: 2863 6d5f 6172 7261 7929 0d0a 2020 2020  (cm_array)..    
-00085320: 2020 2020 2020 2020 7365 6c66 2e69 5f69          self.i_i
-00085330: 7465 6d2e 7365 744c 6f6f 6b75 7054 6162  tem.setLookupTab
-00085340: 6c65 286c 7574 290d 0a20 2020 2020 2020  le(lut)..       
-00085350: 2020 2020 2073 656c 662e 7365 744f 4462       self.setODb
-00085360: 6172 2873 656c 662e 4f44 6d69 6e2c 2073  ar(self.ODmin, s
-00085370: 656c 662e 4f44 6d61 7829 0d0a 0d0a 2020  elf.ODmax)....  
-00085380: 2020 6465 6620 7365 744f 4462 6172 2873    def setODbar(s
-00085390: 656c 662c 6d69 6e3d 4e6f 6e65 2c6d 6178  elf,min=None,max
-000853a0: 3d4e 6f6e 6529 3a0d 0a20 2020 2020 2020  =None):..       
-000853b0: 2073 656c 662e 636d 2e73 6574 5261 6e67   self.cm.setRang
-000853c0: 6528 7852 616e 6765 3d5b 302c 315d 2c20  e(xRange=[0,1], 
-000853d0: 7952 616e 6765 3d5b 6d69 6e2c 6d61 785d  yRange=[min,max]
-000853e0: 2c20 7570 6461 7465 3d46 616c 7365 2c20  , update=False, 
-000853f0: 6469 7361 626c 6541 7574 6f52 616e 6765  disableAutoRange
-00085400: 3d54 7275 652c 7061 6464 696e 673d 3029  =True,padding=0)
-00085410: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00085420: 6d69 6d67 2e73 6574 5265 6374 2851 7443  mimg.setRect(QtC
-00085430: 6f72 652e 5152 6563 7446 2830 2c6d 696e  ore.QRectF(0,min
-00085440: 2c31 2c6d 6178 2d6d 696e 2929 0d0a 232d  ,1,max-min))..#-
-00085450: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085460: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085470: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085480: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085490: 2d2d 2d2d 2d0d 0a20 2020 2064 6566 204f  -----..    def O
-000854a0: 6e4c 6f61 644d 756c 7469 2873 656c 662c  nLoadMulti(self,
-000854b0: 2065 7665 6e74 293a 0d0a 0d0a 2020 2020   event):....    
-000854c0: 2020 2020 7365 6c66 2e77 696e 646f 7728      self.window(
-000854d0: 292e 4c6f 6164 5374 6163 6b28 290d 0a0d  ).LoadStack()...
-000854e0: 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ...#------------
-000854f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085500: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085510: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085520: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
-00085530: 6465 6620 4f6e 4c6f 6164 3444 2873 656c  def OnLoad4D(sel
-00085540: 662c 2065 7665 6e74 293a 0d0a 0d0a 2020  f, event):....  
-00085550: 2020 2020 2020 7365 6c66 2e77 696e 646f        self.windo
-00085560: 7728 292e 4c6f 6164 5374 6163 6b34 4428  w().LoadStack4D(
-00085570: 290d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d  )....#----------
-00085580: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085590: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000855a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000855b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020  ------------..  
-000855c0: 2020 6465 6620 4f6e 4275 696c 6453 7461    def OnBuildSta
-000855d0: 636b 2873 656c 662c 2065 7665 6e74 293a  ck(self, event):
-000855e0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-000855f0: 2e77 696e 646f 7728 292e 4275 696c 6453  .window().BuildS
-00085600: 7461 636b 2829 0d0a 0d0a 232d 2d2d 2d2d  tack()....#-----
-00085610: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085620: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085630: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085640: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085650: 2d0d 0a20 2020 2064 6566 204f 6e53 6372  -..    def OnScr
-00085660: 6f6c 6c45 6e67 2873 656c 662c 2076 616c  ollEng(self, val
-00085670: 7565 293a 0d0a 2020 2020 2020 2020 7365  ue):..        se
-00085680: 6c66 2e73 6c69 6465 725f 656e 672e 7365  lf.slider_eng.se
-00085690: 7456 616c 7565 2876 616c 7565 290d 0a20  tValue(value).. 
-000856a0: 2020 2020 2020 2023 7365 6c66 2e4d 6170         #self.Map
-000856b0: 5365 6c65 6374 5769 6467 6574 312e 7365  SelectWidget1.se
-000856c0: 7443 7572 7265 6e74 526f 7728 7661 6c75  tCurrentRow(valu
-000856d0: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-000856e0: 2e69 6576 203d 2076 616c 7565 0d0a 2020  .iev = value..  
-000856f0: 2020 2020 2020 6966 2073 656c 662e 636f        if self.co
-00085700: 6d2e 7374 6163 6b5f 6c6f 6164 6564 203d  m.stack_loaded =
-00085710: 3d20 313a 0d0a 2020 2020 2020 2020 2020  = 1:..          
-00085720: 2020 696d 6167 6520 3d20 7365 6c66 2e73    image = self.s
-00085730: 746b 2e61 6273 6461 7461 5b3a 2c20 3a2c  tk.absdata[:, :,
-00085740: 2069 6e74 2873 656c 662e 6965 7629 5d2e   int(self.iev)].
-00085750: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
-00085760: 2020 2020 6966 2073 656c 662e 636f 6d2e      if self.com.
-00085770: 7374 6163 6b5f 3464 203d 3d20 313a 0d0a  stack_4d == 1:..
-00085780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085790: 7365 6c66 2e70 312e 7365 7454 6974 6c65  self.p1.setTitle
-000857a0: 2822 3c63 656e 7465 723e 496d 6167 6520  ("<center>Image 
-000857b0: 6174 207b 303a 352e 3266 7d20 6556 2061  at {0:5.2f} eV a
-000857c0: 6e64 207b 313a 352e 3166 7dc2 b03c 2f63  nd {1:5.1f}..</c
-000857d0: 656e 7465 723e 222e 666f 726d 6174 2866  enter>".format(f
-000857e0: 6c6f 6174 2873 656c 662e 7374 6b2e 6576  loat(self.stk.ev
-000857f0: 5b73 656c 662e 6965 765d 292c 0d0a 2020  [self.iev]),..  
-00085800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085840: 2020 2020 2020 2020 2020 2066 6c6f 6174             float
-00085850: 2873 656c 662e 7374 6b2e 7468 6574 615b  (self.stk.theta[
-00085860: 7365 6c66 2e69 7468 6574 615d 2929 290d  self.itheta]))).
-00085870: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00085880: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00085890: 2020 2020 7365 6c66 2e70 312e 7365 7454      self.p1.setT
-000858a0: 6974 6c65 2822 3c63 656e 7465 723e 496d  itle("<center>Im
-000858b0: 6167 6520 6174 2065 6e65 7267 7920 7b30  age at energy {0
-000858c0: 3a35 2e32 667d 2065 563c 2f63 656e 7465  :5.2f} eV</cente
-000858d0: 723e 222e 666f 726d 6174 2866 6c6f 6174  r>".format(float
-000858e0: 2873 656c 662e 7374 6b2e 6576 5b73 656c  (self.stk.ev[sel
-000858f0: 662e 6965 765d 2929 290d 0a20 2020 2020  f.iev])))..     
-00085900: 2020 2020 2020 2073 656c 662e 4f44 6d69         self.ODmi
-00085910: 6e20 3d20 6e70 2e6d 696e 2869 6d61 6765  n = np.min(image
-00085920: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00085930: 656c 662e 4f44 6d61 7820 3d20 6e70 2e6d  elf.ODmax = np.m
-00085940: 6178 2869 6d61 6765 290d 0a20 2020 2020  ax(image)..     
-00085950: 2020 2020 2020 2073 656c 662e 695f 6974         self.i_it
-00085960: 656d 2e73 6574 496d 6167 6528 696d 6167  em.setImage(imag
-00085970: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00085980: 7365 6c66 2e4f 6e43 6f6c 6f72 6d61 7028  self.OnColormap(
-00085990: 6d61 703d 7365 6c66 2e43 4d4d 6170 426f  map=self.CMMapBo
-000859a0: 782e 6375 7272 656e 7454 6578 7428 292c  x.currentText(),
-000859b0: 636f 6c6f 7273 3d73 656c 662e 5374 6570  colors=self.Step
-000859c0: 5370 696e 2e76 616c 7565 2829 290d 0a23  Spin.value())..#
-000859d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000859e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000859f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085a00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085a10: 2d2d 2d2d 2d2d 0d0a 2020 2020 6465 6620  ------..    def 
-00085a20: 4f6e 5363 726f 6c6c 5468 6574 6128 7365  OnScrollTheta(se
-00085a30: 6c66 2c20 7661 6c75 6529 3a0d 0a20 2020  lf, value):..   
-00085a40: 2020 2020 2073 656c 662e 736c 6964 6572       self.slider
-00085a50: 5f74 6865 7461 2e73 6574 5661 6c75 6528  _theta.setValue(
-00085a60: 7661 6c75 6529 0d0a 2020 2020 2020 2020  value)..        
-00085a70: 7365 6c66 2e69 7468 6574 6120 3d20 7661  self.itheta = va
-00085a80: 6c75 650d 0a0d 0a20 2020 2020 2020 2073  lue....        s
-00085a90: 656c 662e 7374 6b2e 6162 7364 6174 6120  elf.stk.absdata 
-00085aa0: 3d20 7365 6c66 2e73 746b 2e73 7461 636b  = self.stk.stack
-00085ab0: 3444 5b3a 2c3a 2c3a 2c73 656c 662e 6974  4D[:,:,:,self.it
-00085ac0: 6865 7461 5d2e 636f 7079 2829 0d0a 2020  heta].copy()..  
-00085ad0: 2020 2020 2020 696d 6167 6520 3d20 7365        image = se
-00085ae0: 6c66 2e73 746b 2e61 6273 6461 7461 5b3a  lf.stk.absdata[:
-00085af0: 2c20 3a2c 2069 6e74 2873 656c 662e 736c  , :, int(self.sl
-00085b00: 6964 6572 5f65 6e67 2e76 616c 7565 2829  ider_eng.value()
-00085b10: 295d 2e63 6f70 7928 290d 0a20 2020 2020  )].copy()..     
-00085b20: 2020 2023 7365 6c66 2e74 635f 696d 6167     #self.tc_imag
-00085b30: 6574 6865 7461 2e73 6574 5465 7874 2822  etheta.setText("
-00085b40: 3444 2044 6174 6120 416e 676c 653a 2022  4D Data Angle: "
-00085b50: 2b73 7472 2873 656c 662e 7374 6b2e 7468  +str(self.stk.th
-00085b60: 6574 615b 7365 6c66 2e69 7468 6574 615d  eta[self.itheta]
-00085b70: 2929 0d0a 0d0a 2020 2020 2020 2020 6966  ))....        if
-00085b80: 2073 656c 662e 636f 6d2e 7374 6163 6b5f   self.com.stack_
-00085b90: 6c6f 6164 6564 203d 3d20 313a 0d0a 2020  loaded == 1:..  
-00085ba0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00085bb0: 312e 7365 7454 6974 6c65 2822 3c63 656e  1.setTitle("<cen
-00085bc0: 7465 723e 496d 6167 6520 6174 207b 303a  ter>Image at {0:
-00085bd0: 352e 3266 7d20 6556 2061 6e64 207b 313a  5.2f} eV and {1:
-00085be0: 352e 3166 7dc2 b03c 2f63 656e 7465 723e  5.1f}..</center>
-00085bf0: 222e 666f 726d 6174 2866 6c6f 6174 2873  ".format(float(s
-00085c00: 656c 662e 7374 6b2e 6576 5b73 656c 662e  elf.stk.ev[self.
-00085c10: 6965 765d 292c 0d0a 2020 2020 2020 2020  iev]),..        
-00085c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00085c60: 2066 6c6f 6174 2873 656c 662e 7374 6b2e   float(self.stk.
-00085c70: 7468 6574 615b 7365 6c66 2e69 7468 6574  theta[self.ithet
-00085c80: 615d 2929 290d 0a20 2020 2020 2020 2020  a])))..         
-00085c90: 2020 2073 656c 662e 4f44 6d69 6e20 3d20     self.ODmin = 
-00085ca0: 6e70 2e6d 696e 2869 6d61 6765 290d 0a20  np.min(image).. 
-00085cb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00085cc0: 4f44 6d61 7820 3d20 6e70 2e6d 6178 2869  ODmax = np.max(i
-00085cd0: 6d61 6765 290d 0a20 2020 2020 2020 2020  mage)..         
-00085ce0: 2020 2073 656c 662e 695f 6974 656d 2e73     self.i_item.s
-00085cf0: 6574 496d 6167 6528 696d 6167 6529 0d0a  etImage(image)..
-00085d00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00085d10: 2e4f 6e43 6f6c 6f72 6d61 7028 6d61 703d  .OnColormap(map=
-00085d20: 7365 6c66 2e43 4d4d 6170 426f 782e 6375  self.CMMapBox.cu
-00085d30: 7272 656e 7454 6578 7428 292c 636f 6c6f  rrentText(),colo
-00085d40: 7273 3d73 656c 662e 5374 6570 5370 696e  rs=self.StepSpin
-00085d50: 2e76 616c 7565 2829 290d 0a20 2020 2020  .value())..     
-00085d60: 2020 2023 7365 6c66 2e77 696e 646f 7728     #self.window(
-00085d70: 292e 7061 6765 312e 6974 6865 7461 203d  ).page1.itheta =
-00085d80: 2073 656c 662e 6974 6865 7461 0d0a 2020   self.itheta..  
-00085d90: 2020 2020 2020 2373 656c 662e 7769 6e64        #self.wind
-00085da0: 6f77 2829 2e70 6167 6531 2e73 6c69 6465  ow().page1.slide
-00085db0: 725f 7468 6574 612e 7365 7456 616c 7565  r_theta.setValue
-00085dc0: 2873 656c 662e 6974 6865 7461 290d 0a0d  (self.itheta)...
-00085dd0: 0a20 2020 2020 2020 2023 7365 6c66 2e77  .        #self.w
-00085de0: 696e 646f 7728 292e 7061 6765 322e 6974  indow().page2.it
-00085df0: 6865 7461 203d 2073 656c 662e 6974 6865  heta = self.ithe
-00085e00: 7461 0d0a 2020 2020 2020 2020 2373 656c  ta..        #sel
-00085e10: 662e 7769 6e64 6f77 2829 2e70 6167 6532  f.window().page2
-00085e20: 2e73 6c69 6465 725f 7468 6574 612e 7365  .slider_theta.se
-00085e30: 7456 616c 7565 2873 656c 662e 6974 6865  tValue(self.ithe
-00085e40: 7461 290d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d  ta)....#--------
-00085e50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085e60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085e70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085e80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a  --------------..
-00085e90: 2020 2020 6465 6620 5368 6f77 496e 666f      def ShowInfo
-00085ea0: 2873 656c 662c 2066 696c 656e 616d 652c  (self, filename,
-00085eb0: 2066 696c 6570 6174 6829 3a0d 0a0d 0a20   filepath):.... 
-00085ec0: 2020 2020 2020 2073 656c 662e 7463 5f66         self.tc_f
-00085ed0: 696c 652e 7365 7454 6578 7428 6669 6c65  ile.setText(file
-00085ee0: 6e61 6d65 290d 0a20 2020 2020 2020 2073  name)..        s
-00085ef0: 656c 662e 7463 5f70 6174 682e 7365 7454  elf.tc_path.setT
-00085f00: 6578 7428 6669 6c65 7061 7468 290d 0a0d  ext(filepath)...
-00085f10: 0a22 2222 202d 2d2d 2d2d 2d2d 2d2d 2d2d  .""" -----------
-00085f20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085f30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00083c60: 795f 7374 6172 7420 3d20 7365 6c66 2e73  y_start = self.s
+00083c70: 746b 2e79 5f73 7461 7274 2a73 656c 662e  tk.y_start*self.
+00083c80: 7363 616c 650d 0a20 2020 2020 2020 2020  scale..         
+00083c90: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00083ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00083cb0: 2020 785f 7374 6172 7420 3d20 300d 0a20    x_start = 0.. 
+00083cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00083cd0: 2020 2079 5f73 7461 7274 203d 2030 0d0a     y_start = 0..
+00083ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00083cf0: 7365 6c66 2e61 7931 2e73 6574 4c61 6265  self.ay1.setLabe
+00083d00: 6c28 7465 7874 3d22 7922 2c20 756e 6974  l(text="y", unit
+00083d10: 733d 226d 2229 0d0a 2020 2020 2020 2020  s="m")..        
+00083d20: 2020 2020 2020 2020 7365 6c66 2e61 7831          self.ax1
+00083d30: 2e73 6574 4c61 6265 6c28 7465 7874 3d22  .setLabel(text="
+00083d40: 7822 2c20 756e 6974 733d 226d 2229 0d0a  x", units="m")..
+00083d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00083d60: 2373 656c 662e 6179 322e 7365 744c 6162  #self.ay2.setLab
+00083d70: 656c 2874 6578 743d 2279 222c 2075 6e69  el(text="y", uni
+00083d80: 7473 3d22 6d22 290d 0a20 2020 2020 2020  ts="m")..       
+00083d90: 2020 2020 2020 2020 2023 7365 6c66 2e61           #self.a
+00083da0: 7832 2e73 6574 4c61 6265 6c28 7465 7874  x2.setLabel(text
+00083db0: 3d22 7822 2c20 756e 6974 733d 226d 2229  ="x", units="m")
+00083dc0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00083dd0: 2020 2020 7365 6c66 2e69 5f69 7465 6d2e      self.i_item.
+00083de0: 7365 7452 6563 7428 5174 436f 7265 2e51  setRect(QtCore.Q
+00083df0: 5265 6374 4628 785f 7374 6172 742c 2079  RectF(x_start, y
+00083e00: 5f73 7461 7274 2c20 7365 6c66 2e73 6361  _start, self.sca
+00083e10: 6c65 2a73 656c 662e 7374 6b2e 6e5f 636f  le*self.stk.n_co
+00083e20: 6c73 2a73 656c 662e 7374 6b2e 785f 7078  ls*self.stk.x_px
+00083e30: 7369 7a65 2c20 7365 6c66 2e73 6361 6c65  size, self.scale
+00083e40: 2a73 656c 662e 7374 6b2e 6e5f 726f 7773  *self.stk.n_rows
+00083e50: 2a73 656c 662e 7374 6b2e 795f 7078 7369  *self.stk.y_pxsi
+00083e60: 7a65 2929 0d0a 2020 2020 2020 2020 2020  ze))..          
+00083e70: 2020 2020 2020 2369 6620 6861 7361 7474        #if hasatt
+00083e80: 7228 7365 6c66 2c20 224f 4422 293a 0d0a  r(self, "OD"):..
+00083e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00083ea0: 2320 2020 2073 656c 662e 6d5f 6974 656d  #    self.m_item
+00083eb0: 2e73 6574 5265 6374 2851 7443 6f72 652e  .setRect(QtCore.
+00083ec0: 5152 6563 7446 2878 5f73 7461 7274 2c20  QRectF(x_start, 
+00083ed0: 795f 7374 6172 742c 2073 656c 662e 7363  y_start, self.sc
+00083ee0: 616c 652a 6e70 2e73 6861 7065 2873 656c  ale*np.shape(sel
+00083ef0: 662e 4f44 295b 305d 2a73 656c 662e 7374  f.OD)[0]*self.st
+00083f00: 6b2e 785f 7078 7369 7a65 2c20 7365 6c66  k.x_pxsize, self
+00083f10: 2e73 6361 6c65 2a6e 702e 7368 6170 6528  .scale*np.shape(
+00083f20: 7365 6c66 2e4f 4429 5b31 5d2a 7365 6c66  self.OD)[1]*self
+00083f30: 2e73 746b 2e79 5f70 7873 697a 6529 290d  .stk.y_pxsize)).
+00083f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00083f50: 2023 2020 2020 7365 6c66 2e73 6574 4372   #    self.setCr
+00083f60: 6f73 7368 6169 7228 290d 0a20 2020 2020  osshair()..     
+00083f70: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00083f80: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00083f90: 6c66 2e5a 6572 6f4f 7269 6769 6e43 6865  lf.ZeroOriginChe
+00083fa0: 636b 426f 782e 7365 7456 6973 6962 6c65  ckBox.setVisible
+00083fb0: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
+00083fc0: 2020 2020 2020 2020 2073 656c 662e 5371           self.Sq
+00083fd0: 7561 7265 5078 4368 6563 6b42 6f78 2e73  uarePxCheckBox.s
+00083fe0: 6574 5669 7369 626c 6528 5472 7565 290d  etVisible(True).
+00083ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00084000: 2069 6620 7371 7561 7265 203d 3d20 5472   if square == Tr
+00084010: 7565 206f 7220 7365 6c66 2e73 746b 2e78  ue or self.stk.x
+00084020: 5f70 7873 697a 6520 3d3d 2030 206f 7220  _pxsize == 0 or 
+00084030: 7365 6c66 2e73 746b 2e79 5f70 7873 697a  self.stk.y_pxsiz
+00084040: 6520 3d3d 2030 3a0d 0a20 2020 2020 2020  e == 0:..       
+00084050: 2020 2020 2020 2020 2020 2020 2061 7370               asp
+00084060: 6563 7420 3d20 310d 0a20 2020 2020 2020  ect = 1..       
+00084070: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00084080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00084090: 2020 2020 6173 7065 6374 203d 2073 656c      aspect = sel
+000840a0: 662e 7374 6b2e 785f 7078 7369 7a65 2f73  f.stk.x_pxsize/s
+000840b0: 656c 662e 7374 6b2e 795f 7078 7369 7a65  elf.stk.y_pxsize
+000840c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000840d0: 2020 2020 2020 2370 7269 6e74 2861 7370        #print(asp
+000840e0: 6563 7429 0d0a 2020 2020 2020 2020 2020  ect)..          
+000840f0: 2020 2020 2020 7365 6c66 2e70 312e 7365        self.p1.se
+00084100: 7441 7370 6563 744c 6f63 6b65 6428 6c6f  tAspectLocked(lo
+00084110: 636b 3d54 7275 652c 2072 6174 696f 3d61  ck=True, ratio=a
+00084120: 7370 6563 7429 0d0a 2020 2020 2020 2020  spect)..        
+00084130: 2020 2020 2020 2020 7365 6c66 2e61 7931          self.ay1
+00084140: 2e73 6574 4c61 6265 6c28 7465 7874 3d22  .setLabel(text="
+00084150: 7922 2c20 756e 6974 733d 2270 7822 290d  y", units="px").
+00084160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00084170: 2073 656c 662e 6178 312e 7365 744c 6162   self.ax1.setLab
+00084180: 656c 2874 6578 743d 2278 222c 2075 6e69  el(text="x", uni
+00084190: 7473 3d22 7078 2229 0d0a 2020 2020 2020  ts="px")..      
+000841a0: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+000841b0: 5f69 7465 6d2e 7365 7452 6563 7428 5174  _item.setRect(Qt
+000841c0: 436f 7265 2e51 5265 6374 4628 302c 2030  Core.QRectF(0, 0
+000841d0: 2c20 7365 6c66 2e73 746b 2e6e 5f63 6f6c  , self.stk.n_col
+000841e0: 732c 2073 656c 662e 7374 6b2e 6e5f 726f  s, self.stk.n_ro
+000841f0: 7773 2929 0d0a 2320 2d2d 2d2d 2d2d 2d2d  ws))..# --------
+00084200: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00084210: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00084220: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00084230: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a  --------------..
+00084240: 2020 2020 6465 6620 4f6e 4361 7443 6861      def OnCatCha
+00084250: 6e67 6564 2873 656c 6629 3a0d 0a20 2020  nged(self):..   
+00084260: 2020 2020 2073 656c 662e 434d 4d61 7042       self.CMMapB
+00084270: 6f78 2e62 6c6f 636b 5369 676e 616c 7328  ox.blockSignals(
+00084280: 5472 7565 290d 0a20 2020 2020 2020 2073  True)..        s
+00084290: 656c 662e 434d 4d61 7042 6f78 2e63 6c65  elf.CMMapBox.cle
+000842a0: 6172 2829 0d0a 2020 2020 2020 2020 7365  ar()..        se
+000842b0: 6c66 2e43 4d4d 6170 426f 782e 626c 6f63  lf.CMMapBox.bloc
+000842c0: 6b53 6967 6e61 6c73 2846 616c 7365 290d  kSignals(False).
+000842d0: 0a20 2020 2020 2020 2073 656c 662e 434d  .        self.CM
+000842e0: 4d61 7042 6f78 2e61 6464 4974 656d 7328  MapBox.addItems(
+000842f0: 7365 6c66 2e63 6d61 7073 5b73 656c 662e  self.cmaps[self.
+00084300: 434d 4361 7442 6f78 2e63 7572 7265 6e74  CMCatBox.current
+00084310: 496e 6465 7828 295d 5b31 5d29 0d0a 0d0a  Index()][1])....
+00084320: 2020 2020 6465 6620 6361 6c63 4269 6e53      def calcBinS
+00084330: 697a 6528 7365 6c66 2c69 2c4e 293a 0d0a  ize(self,i,N):..
+00084340: 2020 2020 2020 2020 7265 7475 726e 2069          return i
+00084350: 6e74 2872 6f75 6e64 2832 3536 2a28 692b  nt(round(256*(i+
+00084360: 3129 2f4e 2920 2d20 726f 756e 6428 3235  1)/N) - round(25
+00084370: 362a 692f 4e29 290d 0a0d 0a20 2020 2064  6*i/N))....    d
+00084380: 6566 204f 6e43 6f70 7928 7365 6c66 293a  ef OnCopy(self):
+00084390: 0d0a 2020 2020 2020 2020 7365 6c66 2e65  ..        self.e
+000843a0: 7870 203d 2070 672e 6578 706f 7274 6572  xp = pg.exporter
+000843b0: 732e 496d 6167 6545 7870 6f72 7465 7228  s.ImageExporter(
+000843c0: 7365 6c66 2e70 676c 6179 6f75 7429 0d0a  self.pglayout)..
+000843d0: 2020 2020 2020 2020 7365 6c66 2e65 7870          self.exp
+000843e0: 2e65 7870 6f72 7428 636f 7079 3d54 7275  .export(copy=Tru
+000843f0: 6529 0d0a 2020 2020 2020 2020 7265 7475  e)..        retu
+00084400: 726e 0d0a 0d0a 2020 2020 6465 6620 4f6e  rn....    def On
+00084410: 4d69 7272 6f72 2873 656c 6629 3a0d 0a20  Mirror(self):.. 
+00084420: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
+00084430: 6f6d 2e73 7461 636b 5f6c 6f61 6465 6420  om.stack_loaded 
+00084440: 3d3d 2031 3a0d 0a20 2020 2020 2020 2020  == 1:..         
+00084450: 2020 2069 6620 7365 6c66 2e63 6f6d 2e73     if self.com.s
+00084460: 7461 636b 5f34 6420 3d3d 2031 3a0d 0a20  tack_4d == 1:.. 
+00084470: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00084480: 656c 662e 7374 6b2e 7374 6163 6b34 4420  elf.stk.stack4D 
+00084490: 3d20 6e70 2e66 6c69 7028 7365 6c66 2e73  = np.flip(self.s
+000844a0: 746b 2e73 7461 636b 3444 2c20 6178 6973  tk.stack4D, axis
+000844b0: 3d30 290d 0a20 2020 2020 2020 2020 2020  =0)..           
+000844c0: 2020 2020 2073 656c 662e 7374 6b2e 6162       self.stk.ab
+000844d0: 7364 6174 6120 3d20 7365 6c66 2e73 746b  sdata = self.stk
+000844e0: 2e73 7461 636b 3444 5b3a 2c20 3a2c 203a  .stack4D[:, :, :
+000844f0: 2c20 7365 6c66 2e69 7468 6574 615d 2e63  , self.itheta].c
+00084500: 6f70 7928 290d 0a20 2020 2020 2020 2020  opy()..         
+00084510: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00084520: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00084530: 746b 2e61 6273 6461 7461 203d 206e 702e  tk.absdata = np.
+00084540: 666c 6970 2873 656c 662e 7374 6b2e 6162  flip(self.stk.ab
+00084550: 7364 6174 612c 2061 7869 733d 3029 0d0a  sdata, axis=0)..
+00084560: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00084570: 2073 656c 662e 636f 6d2e 6930 5f6c 6f61   self.com.i0_loa
+00084580: 6465 643a 0d0a 2020 2020 2020 2020 2020  ded:..          
+00084590: 2020 2020 2020 6966 2073 656c 662e 636f        if self.co
+000845a0: 6d2e 7374 6163 6b5f 3464 3a0d 0a20 2020  m.stack_4d:..   
+000845b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000845c0: 2073 656c 662e 7374 6b2e 6f64 3444 203d   self.stk.od4D =
+000845d0: 206e 702e 666c 6970 2873 656c 662e 7374   np.flip(self.st
+000845e0: 6b2e 6f64 3444 2c20 6178 6973 3d30 290d  k.od4D, axis=0).
+000845f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00084600: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00084610: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00084620: 2e73 746b 2e6f 6433 6420 3d20 6e70 2e66  .stk.od3d = np.f
+00084630: 6c69 7028 7365 6c66 2e73 746b 2e6f 6433  lip(self.stk.od3
+00084640: 642c 2061 7869 733d 3029 0d0a 2020 2020  d, axis=0)..    
+00084650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00084660: 7365 6c66 2e73 746b 2e6f 6420 3d20 7365  self.stk.od = se
+00084670: 6c66 2e73 746b 2e6f 6433 642e 636f 7079  lf.stk.od3d.copy
+00084680: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00084690: 2020 2020 2020 2020 7365 6c66 2e73 746b          self.stk
+000846a0: 2e6f 6420 3d20 6e70 2e72 6573 6861 7065  .od = np.reshape
+000846b0: 2873 656c 662e 7374 6b2e 6f64 2c20 2873  (self.stk.od, (s
+000846c0: 656c 662e 7374 6b2e 6e5f 726f 7773 202a  elf.stk.n_rows *
+000846d0: 2073 656c 662e 7374 6b2e 6e5f 636f 6c73   self.stk.n_cols
+000846e0: 2c20 7365 6c66 2e73 746b 2e6e 5f65 7629  , self.stk.n_ev)
+000846f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00084700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00084710: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00084720: 6465 723d 2746 2729 0d0a 0d0a 2020 2020  der='F')....    
+00084730: 2020 2020 2020 2020 7365 6c66 2e73 746b          self.stk
+00084740: 2e66 696c 6c5f 6835 5f73 7472 7563 745f  .fill_h5_struct_
+00084750: 6672 6f6d 5f73 746b 2829 0d0a 2020 2020  from_stk()..    
+00084760: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00084770: 636f 6d2e 6930 5f6c 6f61 6465 6420 3d3d  com.i0_loaded ==
+00084780: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
+00084790: 2020 2020 2073 656c 662e 7374 6b2e 6669       self.stk.fi
+000847a0: 6c6c 5f68 355f 7374 7275 6374 5f6e 6f72  ll_h5_struct_nor
+000847b0: 6d61 6c69 7a61 7469 6f6e 2829 0d0a 0d0a  malization()....
+000847c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000847d0: 2e4f 6e53 6372 6f6c 6c45 6e67 2873 656c  .OnScrollEng(sel
+000847e0: 662e 6965 7629 0d0a 2020 2020 2020 2020  f.iev)..        
+000847f0: 2020 2020 2320 5570 6461 7465 2f52 6566      # Update/Ref
+00084800: 7265 7368 2077 6964 6765 7473 3a0d 0a20  resh widgets:.. 
+00084810: 2020 2020 2020 2020 2020 2069 6620 7368             if sh
+00084820: 6f77 6d61 7074 6162 3a0d 0a20 2020 2020  owmaptab:..     
+00084830: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00084840: 7769 6e64 6f77 2829 2e70 6167 6539 2e43  window().page9.C
+00084850: 6c65 6172 2829 0d0a 2020 2020 2020 2020  lear()..        
+00084860: 2020 2020 2020 2020 7365 6c66 2e77 696e          self.win
+00084870: 646f 7728 292e 7061 6765 392e 4c6f 6164  dow().page9.Load
+00084880: 456e 7472 6965 7328 290d 0a20 2020 2020  Entries()..     
+00084890: 2020 2020 2020 2073 656c 662e 7769 6e64         self.wind
+000848a0: 6f77 2829 2e70 6167 6531 2e6c 6f61 6449  ow().page1.loadI
+000848b0: 6d61 6765 2829 0d0a 2020 2020 2020 2020  mage()..        
+000848c0: 7265 7475 726e 0d0a 0d0a 2020 2020 6465  return....    de
+000848d0: 6620 4f6e 526f 7461 7465 2873 656c 6629  f OnRotate(self)
+000848e0: 3a0d 0a20 2020 2020 2020 2069 6620 7365  :..        if se
+000848f0: 6c66 2e63 6f6d 2e73 7461 636b 5f6c 6f61  lf.com.stack_loa
+00084900: 6465 6420 3d3d 2031 3a0d 0a20 2020 2020  ded == 1:..     
+00084910: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
+00084920: 6f6d 2e73 7461 636b 5f34 6420 3d3d 2031  om.stack_4d == 1
+00084930: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00084940: 2020 2073 656c 662e 7374 6b2e 7374 6163     self.stk.stac
+00084950: 6b34 4420 3d20 6e70 2e72 6f74 3930 2873  k4D = np.rot90(s
+00084960: 656c 662e 7374 6b2e 7374 6163 6b34 442c  elf.stk.stack4D,
+00084970: 2033 290d 0a20 2020 2020 2020 2020 2020   3)..           
+00084980: 2020 2020 2073 656c 662e 7374 6b2e 6162       self.stk.ab
+00084990: 7364 6174 6120 3d20 7365 6c66 2e73 746b  sdata = self.stk
+000849a0: 2e73 7461 636b 3444 5b3a 2c20 3a2c 203a  .stack4D[:, :, :
+000849b0: 2c20 7365 6c66 2e69 7468 6574 615d 2e63  , self.itheta].c
+000849c0: 6f70 7928 290d 0a20 2020 2020 2020 2020  opy()..         
+000849d0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000849e0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+000849f0: 746b 2e61 6273 6461 7461 203d 206e 702e  tk.absdata = np.
+00084a00: 726f 7439 3028 7365 6c66 2e73 746b 2e61  rot90(self.stk.a
+00084a10: 6273 6461 7461 2c20 3329 0d0a 0d0a 2020  bsdata, 3)....  
+00084a20: 2020 2020 2020 2020 2020 2320 5377 6170            # Swap
+00084a30: 2078 2f79 2063 6f6e 7374 616e 7473 3a0d   x/y constants:.
+00084a40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00084a50: 662e 7374 6b2e 6e5f 636f 6c73 2c20 7365  f.stk.n_cols, se
+00084a60: 6c66 2e73 746b 2e6e 5f72 6f77 7320 3d20  lf.stk.n_rows = 
+00084a70: 7365 6c66 2e73 746b 2e6e 5f72 6f77 732c  self.stk.n_rows,
+00084a80: 2073 656c 662e 7374 6b2e 6e5f 636f 6c73   self.stk.n_cols
+00084a90: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00084aa0: 6c66 2e73 746b 2e78 5f70 7873 697a 652c  lf.stk.x_pxsize,
+00084ab0: 2073 656c 662e 7374 6b2e 795f 7078 7369   self.stk.y_pxsi
+00084ac0: 7a65 203d 2073 656c 662e 7374 6b2e 795f  ze = self.stk.y_
+00084ad0: 7078 7369 7a65 2c20 7365 6c66 2e73 746b  pxsize, self.stk
+00084ae0: 2e78 5f70 7873 697a 650d 0a20 2020 2020  .x_pxsize..     
+00084af0: 2020 2020 2020 2073 656c 662e 7374 6b2e         self.stk.
+00084b00: 785f 7374 6172 742c 2073 656c 662e 7374  x_start, self.st
+00084b10: 6b2e 795f 7374 6172 7420 3d20 7365 6c66  k.y_start = self
+00084b20: 2e73 746b 2e79 5f73 7461 7274 2c20 7365  .stk.y_start, se
+00084b30: 6c66 2e73 746b 2e78 5f73 7461 7274 0d0a  lf.stk.x_start..
+00084b40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00084b50: 2e73 746b 2e78 5f64 6973 742c 2073 656c  .stk.x_dist, sel
+00084b60: 662e 7374 6b2e 795f 6469 7374 203d 2073  f.stk.y_dist = s
+00084b70: 656c 662e 7374 6b2e 795f 6469 7374 2c20  elf.stk.y_dist, 
+00084b80: 7365 6c66 2e73 746b 2e78 5f64 6973 740d  self.stk.x_dist.
+00084b90: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+00084ba0: 6620 7365 6c66 2e63 6f6d 2e69 305f 6c6f  f self.com.i0_lo
+00084bb0: 6164 6564 3a0d 0a20 2020 2020 2020 2020  aded:..         
+00084bc0: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
+00084bd0: 6f6d 2e73 7461 636b 5f34 643a 0d0a 2020  om.stack_4d:..  
+00084be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00084bf0: 2020 7365 6c66 2e73 746b 2e6f 6434 4420    self.stk.od4D 
+00084c00: 3d20 6e70 2e72 6f74 3930 2873 656c 662e  = np.rot90(self.
+00084c10: 7374 6b2e 6f64 3444 2c20 3329 0d0a 2020  stk.od4D, 3)..  
+00084c20: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00084c30: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00084c40: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
+00084c50: 6b2e 6f64 3364 203d 2020 6e70 2e72 6f74  k.od3d =  np.rot
+00084c60: 3930 2873 656c 662e 7374 6b2e 6f64 3364  90(self.stk.od3d
+00084c70: 2c20 3329 0d0a 2020 2020 2020 2020 2020  , 3)..          
+00084c80: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00084c90: 746b 2e6f 6420 3d20 7365 6c66 2e73 746b  tk.od = self.stk
+00084ca0: 2e6f 6433 642e 636f 7079 2829 0d0a 2020  .od3d.copy()..  
+00084cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00084cc0: 2020 7365 6c66 2e73 746b 2e6f 6420 3d20    self.stk.od = 
+00084cd0: 6e70 2e72 6573 6861 7065 2873 656c 662e  np.reshape(self.
+00084ce0: 7374 6b2e 6f64 2c20 2873 656c 662e 7374  stk.od, (self.st
+00084cf0: 6b2e 6e5f 726f 7773 202a 2073 656c 662e  k.n_rows * self.
+00084d00: 7374 6b2e 6e5f 636f 6c73 2c20 7365 6c66  stk.n_cols, self
+00084d10: 2e73 746b 2e6e 5f65 7629 2c0d 0a20 2020  .stk.n_ev),..   
+00084d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00084d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00084d40: 2020 2020 2020 2020 6f72 6465 723d 2746          order='F
+00084d50: 2729 0d0a 0d0a 2020 2020 2020 2020 2020  ')....          
+00084d60: 2020 7365 6c66 2e73 746b 2e66 696c 6c5f    self.stk.fill_
+00084d70: 6835 5f73 7472 7563 745f 6672 6f6d 5f73  h5_struct_from_s
+00084d80: 746b 2829 0d0a 2020 2020 2020 2020 2020  tk()..          
+00084d90: 2020 6966 2073 656c 662e 636f 6d2e 6930    if self.com.i0
+00084da0: 5f6c 6f61 6465 6420 3d3d 2031 3a0d 0a20  _loaded == 1:.. 
+00084db0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00084dc0: 656c 662e 7374 6b2e 6669 6c6c 5f68 355f  elf.stk.fill_h5_
+00084dd0: 7374 7275 6374 5f6e 6f72 6d61 6c69 7a61  struct_normaliza
+00084de0: 7469 6f6e 2829 0d0a 0d0a 2020 2020 2020  tion()....      
+00084df0: 2020 2020 2020 2320 5570 6461 7465 2f52        # Update/R
+00084e00: 6566 7265 7368 2077 6964 6765 7473 3a0d  efresh widgets:.
+00084e10: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00084e20: 662e 4f6e 5363 726f 6c6c 456e 6728 7365  f.OnScrollEng(se
+00084e30: 6c66 2e69 6576 290d 0a20 2020 2020 2020  lf.iev)..       
+00084e40: 2020 2020 2073 656c 662e 4f6e 4d65 7472       self.OnMetr
+00084e50: 6963 5363 616c 6528 7365 6c66 2e4d 6574  icScale(self.Met
+00084e60: 7269 6343 6865 636b 426f 782e 6973 4368  ricCheckBox.isCh
+00084e70: 6563 6b65 6428 292c 2073 656c 662e 5a65  ecked(), self.Ze
+00084e80: 726f 4f72 6967 696e 4368 6563 6b42 6f78  roOriginCheckBox
+00084e90: 2e69 7343 6865 636b 6564 2829 2c73 656c  .isChecked(),sel
+00084ea0: 662e 5371 7561 7265 5078 4368 6563 6b42  f.SquarePxCheckB
+00084eb0: 6f78 2e69 7343 6865 636b 6564 2829 290d  ox.isChecked()).
+00084ec0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00084ed0: 7368 6f77 6d61 7074 6162 3a0d 0a20 2020  showmaptab:..   
+00084ee0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00084ef0: 662e 7769 6e64 6f77 2829 2e70 6167 6539  f.window().page9
+00084f00: 2e43 6c65 6172 2829 0d0a 2020 2020 2020  .Clear()..      
+00084f10: 2020 2020 2020 2020 2020 7365 6c66 2e77            self.w
+00084f20: 696e 646f 7728 292e 7061 6765 392e 4c6f  indow().page9.Lo
+00084f30: 6164 456e 7472 6965 7328 290d 0a20 2020  adEntries()..   
+00084f40: 2020 2020 2020 2020 2073 656c 662e 7769           self.wi
+00084f50: 6e64 6f77 2829 2e70 6167 6531 2e69 7820  ndow().page1.ix 
+00084f60: 3d20 696e 7428 7365 6c66 2e73 746b 2e6e  = int(self.stk.n
+00084f70: 5f63 6f6c 7320 2f20 3229 0d0a 2020 2020  _cols / 2)..    
+00084f80: 2020 2020 2020 2020 7365 6c66 2e77 696e          self.win
+00084f90: 646f 7728 292e 7061 6765 312e 6979 203d  dow().page1.iy =
+00084fa0: 2069 6e74 2873 656c 662e 7374 6b2e 6e5f   int(self.stk.n_
+00084fb0: 726f 7773 202f 2032 290d 0a20 2020 2020  rows / 2)..     
+00084fc0: 2020 2020 2020 2073 656c 662e 7769 6e64         self.wind
+00084fd0: 6f77 2829 2e70 6167 6531 2e73 686f 7753  ow().page1.showS
+00084fe0: 7065 6374 7275 6d28 7365 6c66 2e77 696e  pectrum(self.win
+00084ff0: 646f 7728 292e 7061 6765 312e 6978 2c20  dow().page1.ix, 
+00085000: 7365 6c66 2e77 696e 646f 7728 292e 7061  self.window().pa
+00085010: 6765 312e 6979 290d 0a20 2020 2020 2020  ge1.iy)..       
+00085020: 2020 2020 2073 656c 662e 7769 6e64 6f77       self.window
+00085030: 2829 2e70 6167 6531 2e6c 6f61 6449 6d61  ().page1.loadIma
+00085040: 6765 2829 0d0a 2020 2020 2020 2020 7265  ge()..        re
+00085050: 7475 726e 0d0a 0d0a 2020 2020 6465 6620  turn....    def 
+00085060: 4f6e 436f 6c6f 726d 6170 2873 656c 662c  OnColormap(self,
+00085070: 6d61 703d 2267 7261 7922 2c20 636f 6c6f  map="gray", colo
+00085080: 7273 3d32 3536 293a 0d0a 2020 2020 2020  rs=256):..      
+00085090: 2020 6966 2073 656c 662e 636f 6d2e 7374    if self.com.st
+000850a0: 6163 6b5f 6c6f 6164 6564 203d 3d20 313a  ack_loaded == 1:
+000850b0: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+000850c0: 6c6f 726d 6170 203d 2063 6d2e 6765 745f  lormap = cm.get_
+000850d0: 636d 6170 286d 6170 2c20 636f 6c6f 7273  cmap(map, colors
+000850e0: 290d 0a20 2020 2020 2020 2020 2020 2063  )..            c
+000850f0: 6f6c 6f72 6d61 7020 3d20 636f 6c6f 726d  olormap = colorm
+00085100: 6170 286e 702e 6172 616e 6765 2863 6f6c  ap(np.arange(col
+00085110: 6f72 7329 290d 0a20 2020 2020 2020 2020  ors))..         
+00085120: 2020 2063 6d5f 6c73 7420 3d20 5b5b 636f     cm_lst = [[co
+00085130: 6c6f 726d 6170 5b69 6478 5d5b 305d 2c20  lormap[idx][0], 
+00085140: 636f 6c6f 726d 6170 5b69 6478 5d5b 315d  colormap[idx][1]
+00085150: 2c20 636f 6c6f 726d 6170 5b69 6478 5d5b  , colormap[idx][
+00085160: 325d 2c20 636f 6c6f 726d 6170 5b69 6478  2], colormap[idx
+00085170: 5d5b 335d 5d20 666f 7220 6964 7820 696e  ][3]] for idx in
+00085180: 2072 616e 6765 286e 702e 7368 6170 6528   range(np.shape(
+00085190: 636f 6c6f 726d 6170 295b 305d 295d 2023  colormap)[0])] #
+000851a0: 636f 6e76 6572 7420 746f 2072 2c67 2c62  convert to r,g,b
+000851b0: 2c61 206c 6973 740d 0a20 2020 2020 2020  ,a list..       
+000851c0: 2020 2020 2063 6d5f 6c73 7420 3d20 5b69       cm_lst = [i
+000851d0: 7465 6d20 666f 7220 7375 6220 696e 205b  tem for sub in [
+000851e0: 5b63 6d5f 6c73 745b 695d 5d2a 7365 6c66  [cm_lst[i]]*self
+000851f0: 2e63 616c 6342 696e 5369 7a65 2869 2c63  .calcBinSize(i,c
+00085200: 6f6c 6f72 7329 2066 6f72 2069 2069 6e20  olors) for i in 
+00085210: 7261 6e67 6528 636f 6c6f 7273 295d 2066  range(colors)] f
+00085220: 6f72 2069 7465 6d20 696e 2073 7562 5d20  or item in sub] 
+00085230: 2366 696c 6c73 2032 3536 2062 696e 7320  #fills 256 bins 
+00085240: 6173 2065 7175 616c 2061 7320 706f 7373  as equal as poss
+00085250: 6962 6c65 2077 6974 6820 6e20 636f 6c6f  ible with n colo
+00085260: 7273 0d0a 2020 2020 2020 2020 2020 2020  rs..            
+00085270: 636d 5f61 7272 6179 203d 206e 702e 6172  cm_array = np.ar
+00085280: 7261 7928 5b6e 702e 6173 6172 7261 7928  ray([np.asarray(
+00085290: 636d 5f6c 7374 295d 2920 2376 6572 7469  cm_lst)]) #verti
+000852a0: 6361 6c20 636f 6c6f 7262 6172 0d0a 2020  cal colorbar..  
+000852b0: 2020 2020 2020 2020 2020 636d 5f6c 7374            cm_lst
+000852c0: 2e65 7874 656e 6428 2863 6d5f 6c73 745b  .extend((cm_lst[
+000852d0: 2d31 5d2c 636d 5f6c 7374 5b2d 315d 2c63  -1],cm_lst[-1],c
+000852e0: 6d5f 6c73 745b 2d31 5d29 290d 0a20 2020  m_lst[-1]))..   
+000852f0: 2020 2020 2020 2020 206c 7574 203d 206e           lut = n
+00085300: 702e 6173 6172 7261 7928 636d 5f6c 7374  p.asarray(cm_lst
+00085310: 290d 0a20 2020 2020 2020 2020 2020 206c  )..            l
+00085320: 7574 203d 2028 6c75 7420 2a20 3235 3529  ut = (lut * 255)
+00085330: 2e76 6965 7728 6e70 2e6e 6461 7272 6179  .view(np.ndarray
+00085340: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00085350: 656c 662e 636d 696d 672e 7365 7449 6d61  elf.cmimg.setIma
+00085360: 6765 2863 6d5f 6172 7261 7929 0d0a 2020  ge(cm_array)..  
+00085370: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+00085380: 5f69 7465 6d2e 7365 744c 6f6f 6b75 7054  _item.setLookupT
+00085390: 6162 6c65 286c 7574 290d 0a20 2020 2020  able(lut)..     
+000853a0: 2020 2020 2020 2073 656c 662e 7365 744f         self.setO
+000853b0: 4462 6172 2873 656c 662e 4f44 6d69 6e2c  Dbar(self.ODmin,
+000853c0: 2073 656c 662e 4f44 6d61 7829 0d0a 0d0a   self.ODmax)....
+000853d0: 2020 2020 6465 6620 7365 744f 4462 6172      def setODbar
+000853e0: 2873 656c 662c 6d69 6e3d 4e6f 6e65 2c6d  (self,min=None,m
+000853f0: 6178 3d4e 6f6e 6529 3a0d 0a20 2020 2020  ax=None):..     
+00085400: 2020 2073 656c 662e 636d 2e73 6574 5261     self.cm.setRa
+00085410: 6e67 6528 7852 616e 6765 3d5b 302c 315d  nge(xRange=[0,1]
+00085420: 2c20 7952 616e 6765 3d5b 6d69 6e2c 6d61  , yRange=[min,ma
+00085430: 785d 2c20 7570 6461 7465 3d46 616c 7365  x], update=False
+00085440: 2c20 6469 7361 626c 6541 7574 6f52 616e  , disableAutoRan
+00085450: 6765 3d54 7275 652c 7061 6464 696e 673d  ge=True,padding=
+00085460: 3029 0d0a 2020 2020 2020 2020 7365 6c66  0)..        self
+00085470: 2e63 6d69 6d67 2e73 6574 5265 6374 2851  .cmimg.setRect(Q
+00085480: 7443 6f72 652e 5152 6563 7446 2830 2c6d  tCore.QRectF(0,m
+00085490: 696e 2c31 2c6d 6178 2d6d 696e 2929 0d0a  in,1,max-min))..
+000854a0: 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  #---------------
+000854b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000854c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000854d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000854e0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6566  -------..    def
+000854f0: 204f 6e4c 6f61 644d 756c 7469 2873 656c   OnLoadMulti(sel
+00085500: 662c 2065 7665 6e74 293a 0d0a 0d0a 2020  f, event):....  
+00085510: 2020 2020 2020 7365 6c66 2e77 696e 646f        self.windo
+00085520: 7728 292e 4c6f 6164 5374 6163 6b28 290d  w().LoadStack().
+00085530: 0a0d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d  .....#----------
+00085540: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00085550: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00085560: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00085570: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020  ------------..  
+00085580: 2020 6465 6620 4f6e 4c6f 6164 3444 2873    def OnLoad4D(s
+00085590: 656c 662c 2065 7665 6e74 293a 0d0a 0d0a  elf, event):....
+000855a0: 2020 2020 2020 2020 7365 6c66 2e77 696e          self.win
+000855b0: 646f 7728 292e 4c6f 6164 5374 6163 6b34  dow().LoadStack4
+000855c0: 4428 290d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d  D()....#--------
+000855d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000855e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000855f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00085600: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a  --------------..
+00085610: 2020 2020 6465 6620 4f6e 4275 696c 6453      def OnBuildS
+00085620: 7461 636b 2873 656c 662c 2065 7665 6e74  tack(self, event
+00085630: 293a 0d0a 0d0a 2020 2020 2020 2020 7365  ):....        se
+00085640: 6c66 2e77 696e 646f 7728 292e 4275 696c  lf.window().Buil
+00085650: 6453 7461 636b 2829 0d0a 0d0a 232d 2d2d  dStack()....#---
+00085660: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00085670: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00085680: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00085690: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000856a0: 2d2d 2d0d 0a20 2020 2064 6566 204f 6e53  ---..    def OnS
+000856b0: 6372 6f6c 6c45 6e67 2873 656c 662c 2076  crollEng(self, v
+000856c0: 616c 7565 293a 0d0a 2020 2020 2020 2020  alue):..        
+000856d0: 7365 6c66 2e73 6c69 6465 725f 656e 672e  self.slider_eng.
+000856e0: 7365 7456 616c 7565 2876 616c 7565 290d  setValue(value).
+000856f0: 0a20 2020 2020 2020 2023 7365 6c66 2e4d  .        #self.M
+00085700: 6170 5365 6c65 6374 5769 6467 6574 312e  apSelectWidget1.
+00085710: 7365 7443 7572 7265 6e74 526f 7728 7661  setCurrentRow(va
+00085720: 6c75 6529 0d0a 2020 2020 2020 2020 7365  lue)..        se
+00085730: 6c66 2e69 6576 203d 2076 616c 7565 0d0a  lf.iev = value..
+00085740: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00085750: 636f 6d2e 7374 6163 6b5f 6c6f 6164 6564  com.stack_loaded
+00085760: 203d 3d20 313a 0d0a 2020 2020 2020 2020   == 1:..        
+00085770: 2020 2020 696d 6167 6520 3d20 7365 6c66      image = self
+00085780: 2e73 746b 2e61 6273 6461 7461 5b3a 2c20  .stk.absdata[:, 
+00085790: 3a2c 2069 6e74 2873 656c 662e 6965 7629  :, int(self.iev)
+000857a0: 5d2e 636f 7079 2829 0d0a 2020 2020 2020  ].copy()..      
+000857b0: 2020 2020 2020 6966 2073 656c 662e 636f        if self.co
+000857c0: 6d2e 7374 6163 6b5f 3464 203d 3d20 313a  m.stack_4d == 1:
+000857d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000857e0: 2020 7365 6c66 2e70 312e 7365 7454 6974    self.p1.setTit
+000857f0: 6c65 2822 3c63 656e 7465 723e 496d 6167  le("<center>Imag
+00085800: 6520 6174 207b 303a 352e 3266 7d20 6556  e at {0:5.2f} eV
+00085810: 2061 6e64 207b 313a 352e 3166 7dc2 b03c   and {1:5.1f}..<
+00085820: 2f63 656e 7465 723e 222e 666f 726d 6174  /center>".format
+00085830: 2866 6c6f 6174 2873 656c 662e 7374 6b2e  (float(self.stk.
+00085840: 6576 5b73 656c 662e 6965 765d 292c 0d0a  ev[self.iev]),..
+00085850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085890: 2020 2020 2020 2020 2020 2020 2066 6c6f               flo
+000858a0: 6174 2873 656c 662e 7374 6b2e 7468 6574  at(self.stk.thet
+000858b0: 615b 7365 6c66 2e69 7468 6574 615d 2929  a[self.itheta]))
+000858c0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+000858d0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+000858e0: 2020 2020 2020 7365 6c66 2e70 312e 7365        self.p1.se
+000858f0: 7454 6974 6c65 2822 3c63 656e 7465 723e  tTitle("<center>
+00085900: 496d 6167 6520 6174 2065 6e65 7267 7920  Image at energy 
+00085910: 7b30 3a35 2e32 667d 2065 563c 2f63 656e  {0:5.2f} eV</cen
+00085920: 7465 723e 222e 666f 726d 6174 2866 6c6f  ter>".format(flo
+00085930: 6174 2873 656c 662e 7374 6b2e 6576 5b73  at(self.stk.ev[s
+00085940: 656c 662e 6965 765d 2929 290d 0a20 2020  elf.iev])))..   
+00085950: 2020 2020 2020 2020 2073 656c 662e 4f44           self.OD
+00085960: 6d69 6e20 3d20 6e70 2e6d 696e 2869 6d61  min = np.min(ima
+00085970: 6765 290d 0a20 2020 2020 2020 2020 2020  ge)..           
+00085980: 2073 656c 662e 4f44 6d61 7820 3d20 6e70   self.ODmax = np
+00085990: 2e6d 6178 2869 6d61 6765 290d 0a20 2020  .max(image)..   
+000859a0: 2020 2020 2020 2020 2073 656c 662e 695f           self.i_
+000859b0: 6974 656d 2e73 6574 496d 6167 6528 696d  item.setImage(im
+000859c0: 6167 6529 0d0a 2020 2020 2020 2020 2020  age)..          
+000859d0: 2020 6966 206e 702e 6973 6669 6e69 7465    if np.isfinite
+000859e0: 2873 656c 662e 4f44 6d69 6e29 206f 7220  (self.ODmin) or 
+000859f0: 6e70 2e69 7366 696e 6974 6528 7365 6c66  np.isfinite(self
+00085a00: 2e4f 446d 6178 293a 2023 696e 636f 6d70  .ODmax): #incomp
+00085a10: 6c65 7465 2073 7461 636b 7320 6361 6e20  lete stacks can 
+00085a20: 636f 6e74 6169 6e20 4e41 4e20 7661 6c75  contain NAN valu
+00085a30: 6573 2074 6861 7420 6d65 7373 2075 7020  es that mess up 
+00085a40: 7468 6520 6675 6e63 7469 6f6e 206f 6e20  the function on 
+00085a50: 7468 6520 6e65 7874 206c 696e 650d 0a20  the next line.. 
+00085a60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00085a70: 656c 662e 4f6e 436f 6c6f 726d 6170 286d  elf.OnColormap(m
+00085a80: 6170 3d73 656c 662e 434d 4d61 7042 6f78  ap=self.CMMapBox
+00085a90: 2e63 7572 7265 6e74 5465 7874 2829 2c63  .currentText(),c
+00085aa0: 6f6c 6f72 733d 7365 6c66 2e53 7465 7053  olors=self.StepS
+00085ab0: 7069 6e2e 7661 6c75 6528 2929 0d0a 232d  pin.value())..#-
+00085ac0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00085ad0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00085ae0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00085af0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00085b00: 2d2d 2d2d 2d0d 0a20 2020 2064 6566 204f  -----..    def O
+00085b10: 6e53 6372 6f6c 6c54 6865 7461 2873 656c  nScrollTheta(sel
+00085b20: 662c 2076 616c 7565 293a 0d0a 2020 2020  f, value):..    
+00085b30: 2020 2020 7365 6c66 2e73 6c69 6465 725f      self.slider_
+00085b40: 7468 6574 612e 7365 7456 616c 7565 2876  theta.setValue(v
+00085b50: 616c 7565 290d 0a20 2020 2020 2020 2073  alue)..        s
+00085b60: 656c 662e 6974 6865 7461 203d 2076 616c  elf.itheta = val
+00085b70: 7565 0d0a 0d0a 2020 2020 2020 2020 7365  ue....        se
+00085b80: 6c66 2e73 746b 2e61 6273 6461 7461 203d  lf.stk.absdata =
+00085b90: 2073 656c 662e 7374 6b2e 7374 6163 6b34   self.stk.stack4
+00085ba0: 445b 3a2c 3a2c 3a2c 7365 6c66 2e69 7468  D[:,:,:,self.ith
+00085bb0: 6574 615d 2e63 6f70 7928 290d 0a20 2020  eta].copy()..   
+00085bc0: 2020 2020 2069 6d61 6765 203d 2073 656c       image = sel
+00085bd0: 662e 7374 6b2e 6162 7364 6174 615b 3a2c  f.stk.absdata[:,
+00085be0: 203a 2c20 696e 7428 7365 6c66 2e73 6c69   :, int(self.sli
+00085bf0: 6465 725f 656e 672e 7661 6c75 6528 2929  der_eng.value())
+00085c00: 5d2e 636f 7079 2829 0d0a 2020 2020 2020  ].copy()..      
+00085c10: 2020 2373 656c 662e 7463 5f69 6d61 6765    #self.tc_image
+00085c20: 7468 6574 612e 7365 7454 6578 7428 2234  theta.setText("4
+00085c30: 4420 4461 7461 2041 6e67 6c65 3a20 222b  D Data Angle: "+
+00085c40: 7374 7228 7365 6c66 2e73 746b 2e74 6865  str(self.stk.the
+00085c50: 7461 5b73 656c 662e 6974 6865 7461 5d29  ta[self.itheta])
+00085c60: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
+00085c70: 7365 6c66 2e63 6f6d 2e73 7461 636b 5f6c  self.com.stack_l
+00085c80: 6f61 6465 6420 3d3d 2031 3a0d 0a20 2020  oaded == 1:..   
+00085c90: 2020 2020 2020 2020 2073 656c 662e 7031           self.p1
+00085ca0: 2e73 6574 5469 746c 6528 223c 6365 6e74  .setTitle("<cent
+00085cb0: 6572 3e49 6d61 6765 2061 7420 7b30 3a35  er>Image at {0:5
+00085cc0: 2e32 667d 2065 5620 616e 6420 7b31 3a35  .2f} eV and {1:5
+00085cd0: 2e31 667d c2b0 3c2f 6365 6e74 6572 3e22  .1f}..</center>"
+00085ce0: 2e66 6f72 6d61 7428 666c 6f61 7428 7365  .format(float(se
+00085cf0: 6c66 2e73 746b 2e65 765b 7365 6c66 2e69  lf.stk.ev[self.i
+00085d00: 6576 5d29 2c0d 0a20 2020 2020 2020 2020  ev]),..         
+00085d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00085d50: 666c 6f61 7428 7365 6c66 2e73 746b 2e74  float(self.stk.t
+00085d60: 6865 7461 5b73 656c 662e 6974 6865 7461  heta[self.itheta
+00085d70: 5d29 2929 0d0a 2020 2020 2020 2020 2020  ])))..          
+00085d80: 2020 7365 6c66 2e4f 446d 696e 203d 206e    self.ODmin = n
+00085d90: 702e 6d69 6e28 696d 6167 6529 0d0a 2020  p.min(image)..  
+00085da0: 2020 2020 2020 2020 2020 7365 6c66 2e4f            self.O
+00085db0: 446d 6178 203d 206e 702e 6d61 7828 696d  Dmax = np.max(im
+00085dc0: 6167 6529 0d0a 2020 2020 2020 2020 2020  age)..          
+00085dd0: 2020 7365 6c66 2e69 5f69 7465 6d2e 7365    self.i_item.se
+00085de0: 7449 6d61 6765 2869 6d61 6765 290d 0a20  tImage(image).. 
+00085df0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00085e00: 4f6e 436f 6c6f 726d 6170 286d 6170 3d73  OnColormap(map=s
+00085e10: 656c 662e 434d 4d61 7042 6f78 2e63 7572  elf.CMMapBox.cur
+00085e20: 7265 6e74 5465 7874 2829 2c63 6f6c 6f72  rentText(),color
+00085e30: 733d 7365 6c66 2e53 7465 7053 7069 6e2e  s=self.StepSpin.
+00085e40: 7661 6c75 6528 2929 0d0a 2020 2020 2020  value())..      
+00085e50: 2020 2373 656c 662e 7769 6e64 6f77 2829    #self.window()
+00085e60: 2e70 6167 6531 2e69 7468 6574 6120 3d20  .page1.itheta = 
+00085e70: 7365 6c66 2e69 7468 6574 610d 0a20 2020  self.itheta..   
+00085e80: 2020 2020 2023 7365 6c66 2e77 696e 646f       #self.windo
+00085e90: 7728 292e 7061 6765 312e 736c 6964 6572  w().page1.slider
+00085ea0: 5f74 6865 7461 2e73 6574 5661 6c75 6528  _theta.setValue(
+00085eb0: 7365 6c66 2e69 7468 6574 6129 0d0a 0d0a  self.itheta)....
+00085ec0: 2020 2020 2020 2020 2373 656c 662e 7769          #self.wi
+00085ed0: 6e64 6f77 2829 2e70 6167 6532 2e69 7468  ndow().page2.ith
+00085ee0: 6574 6120 3d20 7365 6c66 2e69 7468 6574  eta = self.ithet
+00085ef0: 610d 0a20 2020 2020 2020 2023 7365 6c66  a..        #self
+00085f00: 2e77 696e 646f 7728 292e 7061 6765 322e  .window().page2.
+00085f10: 736c 6964 6572 5f74 6865 7461 2e73 6574  slider_theta.set
+00085f20: 5661 6c75 6528 7365 6c66 2e69 7468 6574  Value(self.ithet
+00085f30: 6129 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d  a)....#---------
 00085f40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00085f50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00085f60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00085f70: 2d2d 2d2d 2d22 2222 0d0a 636c 6173 7320  -----"""..class 
-00085f80: 5061 6765 4d61 7028 5174 5769 6467 6574  PageMap(QtWidget
-00085f90: 732e 5157 6964 6765 7429 3a0d 0a20 2020  s.QWidget):..   
-00085fa0: 2071 6c69 7374 6368 616e 6765 6420 3d20   qlistchanged = 
-00085fb0: 7079 7174 5369 676e 616c 285b 7475 706c  pyqtSignal([tupl
-00085fc0: 655d 290d 0a20 2020 2064 6566 205f 5f69  e])..    def __i
-00085fd0: 6e69 745f 5f28 7365 6c66 2c20 636f 6d6d  nit__(self, comm
-00085fe0: 6f6e 2c20 6461 7461 5f73 7472 7563 742c  on, data_struct,
-00085ff0: 2073 7461 636b 293a 0d0a 2020 2020 2020   stack):..      
-00086000: 2020 7375 7065 7228 5061 6765 4d61 702c    super(PageMap,
-00086010: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
-00086020: 290d 0a20 2020 2020 2020 2064 6972 5f70  )..        dir_p
-00086030: 6174 6820 3d20 6f73 2e70 6174 682e 6469  ath = os.path.di
-00086040: 726e 616d 6528 6f73 2e70 6174 682e 7265  rname(os.path.re
-00086050: 616c 7061 7468 285f 5f66 696c 655f 5f29  alpath(__file__)
-00086060: 290d 0a20 2020 2020 2020 2075 6963 2e6c  )..        uic.l
-00086070: 6f61 6455 6928 6f73 2e70 6174 682e 6a6f  oadUi(os.path.jo
-00086080: 696e 2864 6972 5f70 6174 682c 2770 6167  in(dir_path,'pag
-00086090: 656d 6170 2e75 6927 292c 2073 656c 6629  emap.ui'), self)
-000860a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-000860b0: 686f 7728 290d 0a20 2020 2020 2020 2073  how()..        s
-000860c0: 656c 662e 636d 6170 7320 3d20 5b28 2750  elf.cmaps = [('P
-000860d0: 6572 6365 7074 7561 6c6c 7920 556e 6966  erceptually Unif
-000860e0: 6f72 6d20 5365 7175 656e 7469 616c 272c  orm Sequential',
-000860f0: 205b 0d0a 2020 2020 2020 2020 2020 2020   [..            
-00086100: 2776 6972 6964 6973 272c 2027 706c 6173  'viridis', 'plas
-00086110: 6d61 272c 2027 696e 6665 726e 6f27 2c20  ma', 'inferno', 
-00086120: 276d 6167 6d61 275d 292c 0d0a 2020 2020  'magma']),..    
-00086130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00086140: 2020 2827 5365 7175 656e 7469 616c 272c    ('Sequential',
-00086150: 205b 0d0a 2020 2020 2020 2020 2020 2020   [..            
-00086160: 2020 2020 2020 2020 2020 2020 2020 2747                'G
-00086170: 7265 7973 272c 2027 5075 7270 6c65 7327  reys', 'Purples'
-00086180: 2c20 2742 6c75 6573 272c 2027 4772 6565  , 'Blues', 'Gree
-00086190: 6e73 272c 2027 4f72 616e 6765 7327 2c20  ns', 'Oranges', 
-000861a0: 2752 6564 7327 2c0d 0a20 2020 2020 2020  'Reds',..       
-000861b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000861c0: 2020 2027 596c 4f72 4272 272c 2027 596c     'YlOrBr', 'Yl
-000861d0: 4f72 5264 272c 2027 4f72 5264 272c 2027  OrRd', 'OrRd', '
-000861e0: 5075 5264 272c 2027 5264 5075 272c 2027  PuRd', 'RdPu', '
-000861f0: 4275 5075 272c 0d0a 2020 2020 2020 2020  BuPu',..        
-00086200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00086210: 2020 2747 6e42 7527 2c20 2750 7542 7527    'GnBu', 'PuBu'
-00086220: 2c20 2759 6c47 6e42 7527 2c20 2750 7542  , 'YlGnBu', 'PuB
-00086230: 7547 6e27 2c20 2742 7547 6e27 2c20 2759  uGn', 'BuGn', 'Y
-00086240: 6c47 6e27 5d29 2c0d 0a20 2020 2020 2020  lGn']),..       
-00086250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00086260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00086270: 2020 2020 2028 2753 6571 7565 6e74 6961       ('Sequentia
-00086280: 6c20 2832 2927 2c20 5b0d 0a20 2020 2020  l (2)', [..     
-00086290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000862a0: 2020 2020 2027 6269 6e61 7279 272c 2027       'binary', '
-000862b0: 6769 7374 5f79 6172 6727 2c20 2767 6973  gist_yarg', 'gis
-000862c0: 745f 6772 6179 272c 2027 6772 6179 272c  t_gray', 'gray',
-000862d0: 2027 626f 6e65 272c 2027 7069 6e6b 272c   'bone', 'pink',
-000862e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000862f0: 2020 2020 2020 2020 2020 2020 2773 7072              'spr
-00086300: 696e 6727 2c20 2773 756d 6d65 7227 2c20  ing', 'summer', 
-00086310: 2761 7574 756d 6e27 2c20 2777 696e 7465  'autumn', 'winte
-00086320: 7227 2c20 2763 6f6f 6c27 2c20 2757 6973  r', 'cool', 'Wis
-00086330: 7469 6127 2c0d 0a20 2020 2020 2020 2020  tia',..         
+00085f70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20  -------------.. 
+00085f80: 2020 2064 6566 2053 686f 7749 6e66 6f28     def ShowInfo(
+00085f90: 7365 6c66 2c20 6669 6c65 6e61 6d65 2c20  self, filename, 
+00085fa0: 6669 6c65 7061 7468 293a 0d0a 0d0a 2020  filepath):....  
+00085fb0: 2020 2020 2020 7365 6c66 2e74 635f 6669        self.tc_fi
+00085fc0: 6c65 2e73 6574 5465 7874 2866 696c 656e  le.setText(filen
+00085fd0: 616d 6529 0d0a 2020 2020 2020 2020 7365  ame)..        se
+00085fe0: 6c66 2e74 635f 7061 7468 2e73 6574 5465  lf.tc_path.setTe
+00085ff0: 7874 2866 696c 6570 6174 6829 0d0a 0d0a  xt(filepath)....
+00086000: 2222 2220 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  """ ------------
+00086010: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00086020: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00086030: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00086040: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00086050: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00086060: 2d2d 2d2d 2222 220d 0a63 6c61 7373 2050  ----"""..class P
+00086070: 6167 654d 6170 2851 7457 6964 6765 7473  ageMap(QtWidgets
+00086080: 2e51 5769 6467 6574 293a 0d0a 2020 2020  .QWidget):..    
+00086090: 716c 6973 7463 6861 6e67 6564 203d 2070  qlistchanged = p
+000860a0: 7971 7453 6967 6e61 6c28 5b74 7570 6c65  yqtSignal([tuple
+000860b0: 5d29 0d0a 2020 2020 6465 6620 5f5f 696e  ])..    def __in
+000860c0: 6974 5f5f 2873 656c 662c 2063 6f6d 6d6f  it__(self, commo
+000860d0: 6e2c 2064 6174 615f 7374 7275 6374 2c20  n, data_struct, 
+000860e0: 7374 6163 6b29 3a0d 0a20 2020 2020 2020  stack):..       
+000860f0: 2073 7570 6572 2850 6167 654d 6170 2c20   super(PageMap, 
+00086100: 7365 6c66 292e 5f5f 696e 6974 5f5f 2829  self).__init__()
+00086110: 0d0a 2020 2020 2020 2020 6469 725f 7061  ..        dir_pa
+00086120: 7468 203d 206f 732e 7061 7468 2e64 6972  th = os.path.dir
+00086130: 6e61 6d65 286f 732e 7061 7468 2e72 6561  name(os.path.rea
+00086140: 6c70 6174 6828 5f5f 6669 6c65 5f5f 2929  lpath(__file__))
+00086150: 0d0a 2020 2020 2020 2020 7569 632e 6c6f  ..        uic.lo
+00086160: 6164 5569 286f 732e 7061 7468 2e6a 6f69  adUi(os.path.joi
+00086170: 6e28 6469 725f 7061 7468 2c27 7061 6765  n(dir_path,'page
+00086180: 6d61 702e 7569 2729 2c20 7365 6c66 290d  map.ui'), self).
+00086190: 0a20 2020 2020 2020 2073 656c 662e 7368  .        self.sh
+000861a0: 6f77 2829 0d0a 2020 2020 2020 2020 7365  ow()..        se
+000861b0: 6c66 2e63 6d61 7073 203d 205b 2827 5065  lf.cmaps = [('Pe
+000861c0: 7263 6570 7475 616c 6c79 2055 6e69 666f  rceptually Unifo
+000861d0: 726d 2053 6571 7565 6e74 6961 6c27 2c20  rm Sequential', 
+000861e0: 5b0d 0a20 2020 2020 2020 2020 2020 2027  [..            '
+000861f0: 7669 7269 6469 7327 2c20 2770 6c61 736d  viridis', 'plasm
+00086200: 6127 2c20 2769 6e66 6572 6e6f 272c 2027  a', 'inferno', '
+00086210: 6d61 676d 6127 5d29 2c0d 0a20 2020 2020  magma']),..     
+00086220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00086230: 2028 2753 6571 7565 6e74 6961 6c27 2c20   ('Sequential', 
+00086240: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
+00086250: 2020 2020 2020 2020 2020 2020 2027 4772               'Gr
+00086260: 6579 7327 2c20 2750 7572 706c 6573 272c  eys', 'Purples',
+00086270: 2027 426c 7565 7327 2c20 2747 7265 656e   'Blues', 'Green
+00086280: 7327 2c20 274f 7261 6e67 6573 272c 2027  s', 'Oranges', '
+00086290: 5265 6473 272c 0d0a 2020 2020 2020 2020  Reds',..        
+000862a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000862b0: 2020 2759 6c4f 7242 7227 2c20 2759 6c4f    'YlOrBr', 'YlO
+000862c0: 7252 6427 2c20 274f 7252 6427 2c20 2750  rRd', 'OrRd', 'P
+000862d0: 7552 6427 2c20 2752 6450 7527 2c20 2742  uRd', 'RdPu', 'B
+000862e0: 7550 7527 2c0d 0a20 2020 2020 2020 2020  uPu',..         
+000862f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00086300: 2027 476e 4275 272c 2027 5075 4275 272c   'GnBu', 'PuBu',
+00086310: 2027 596c 476e 4275 272c 2027 5075 4275   'YlGnBu', 'PuBu
+00086320: 476e 272c 2027 4275 476e 272c 2027 596c  Gn', 'BuGn', 'Yl
+00086330: 476e 275d 292c 0d0a 2020 2020 2020 2020  Gn']),..        
 00086340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00086350: 2027 686f 7427 2c20 2761 666d 686f 7427   'hot', 'afmhot'
-00086360: 2c20 2767 6973 745f 6865 6174 272c 2027  , 'gist_heat', '
-00086370: 636f 7070 6572 275d 292c 0d0a 2020 2020  copper']),..    
+00086350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00086360: 2020 2020 2827 5365 7175 656e 7469 616c      ('Sequential
+00086370: 2028 3229 272c 205b 0d0a 2020 2020 2020   (2)', [..      
 00086380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00086390: 2020 2827 4469 7665 7267 696e 6727 2c20    ('Diverging', 
-000863a0: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
-000863b0: 2020 2020 2020 2020 2020 2020 2027 5069               'Pi
-000863c0: 5947 272c 2027 5052 476e 272c 2027 4272  YG', 'PRGn', 'Br
-000863d0: 4247 272c 2027 5075 4f72 272c 2027 5264  BG', 'PuOr', 'Rd
-000863e0: 4779 272c 2027 5264 4275 272c 0d0a 2020  Gy', 'RdBu',..  
-000863f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00086400: 2020 2020 2020 2020 2752 6459 6c42 7527          'RdYlBu'
-00086410: 2c20 2752 6459 6c47 6e27 2c20 2753 7065  , 'RdYlGn', 'Spe
-00086420: 6374 7261 6c27 2c20 2763 6f6f 6c77 6172  ctral', 'coolwar
-00086430: 6d27 2c20 2762 7772 272c 2027 7365 6973  m', 'bwr', 'seis
-00086440: 6d69 6327 5d29 2c0d 0a20 2020 2020 2020  mic']),..       
-00086450: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00086460: 2751 7561 6c69 7461 7469 7665 272c 205b  'Qualitative', [
-00086470: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00086480: 2020 2020 2020 2020 2020 2020 2750 6173              'Pas
-00086490: 7465 6c31 272c 2027 5061 7374 656c 3227  tel1', 'Pastel2'
-000864a0: 2c20 2750 6169 7265 6427 2c20 2741 6363  , 'Paired', 'Acc
-000864b0: 656e 7427 2c0d 0a20 2020 2020 2020 2020  ent',..         
-000864c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000864d0: 2027 4461 726b 3227 2c20 2753 6574 3127   'Dark2', 'Set1'
-000864e0: 2c20 2753 6574 3227 2c20 2753 6574 3327  , 'Set2', 'Set3'
-000864f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00086500: 2020 2020 2020 2020 2020 2020 2027 7461               'ta
-00086510: 6231 3027 2c20 2774 6162 3230 272c 2027  b10', 'tab20', '
-00086520: 7461 6232 3062 272c 2027 7461 6232 3063  tab20b', 'tab20c
-00086530: 275d 292c 0d0a 2020 2020 2020 2020 2020  ']),..          
-00086540: 2020 2020 2020 2020 2020 2020 2827 4d69              ('Mi
-00086550: 7363 656c 6c61 6e65 6f75 7327 2c20 5b0d  scellaneous', [.
+00086390: 2020 2020 2762 696e 6172 7927 2c20 2767      'binary', 'g
+000863a0: 6973 745f 7961 7267 272c 2027 6769 7374  ist_yarg', 'gist
+000863b0: 5f67 7261 7927 2c20 2767 7261 7927 2c20  _gray', 'gray', 
+000863c0: 2762 6f6e 6527 2c20 2770 696e 6b27 2c0d  'bone', 'pink',.
+000863d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000863e0: 2020 2020 2020 2020 2020 2027 7370 7269             'spri
+000863f0: 6e67 272c 2027 7375 6d6d 6572 272c 2027  ng', 'summer', '
+00086400: 6175 7475 6d6e 272c 2027 7769 6e74 6572  autumn', 'winter
+00086410: 272c 2027 636f 6f6c 272c 2027 5769 7374  ', 'cool', 'Wist
+00086420: 6961 272c 0d0a 2020 2020 2020 2020 2020  ia',..          
+00086430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00086440: 2768 6f74 272c 2027 6166 6d68 6f74 272c  'hot', 'afmhot',
+00086450: 2027 6769 7374 5f68 6561 7427 2c20 2763   'gist_heat', 'c
+00086460: 6f70 7065 7227 5d29 2c0d 0a20 2020 2020  opper']),..     
+00086470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00086480: 2028 2744 6976 6572 6769 6e67 272c 205b   ('Diverging', [
+00086490: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000864a0: 2020 2020 2020 2020 2020 2020 2750 6959              'PiY
+000864b0: 4727 2c20 2750 5247 6e27 2c20 2742 7242  G', 'PRGn', 'BrB
+000864c0: 4727 2c20 2750 754f 7227 2c20 2752 6447  G', 'PuOr', 'RdG
+000864d0: 7927 2c20 2752 6442 7527 2c0d 0a20 2020  y', 'RdBu',..   
+000864e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000864f0: 2020 2020 2020 2027 5264 596c 4275 272c         'RdYlBu',
+00086500: 2027 5264 596c 476e 272c 2027 5370 6563   'RdYlGn', 'Spec
+00086510: 7472 616c 272c 2027 636f 6f6c 7761 726d  tral', 'coolwarm
+00086520: 272c 2027 6277 7227 2c20 2773 6569 736d  ', 'bwr', 'seism
+00086530: 6963 275d 292c 0d0a 2020 2020 2020 2020  ic']),..        
+00086540: 2020 2020 2020 2020 2020 2020 2020 2827                ('
+00086550: 5175 616c 6974 6174 6976 6527 2c20 5b0d  Qualitative', [.
 00086560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00086570: 2020 2020 2020 2020 2020 2027 666c 6167             'flag
-00086580: 272c 2027 7072 6973 6d27 2c20 276f 6365  ', 'prism', 'oce
-00086590: 616e 272c 2027 6769 7374 5f65 6172 7468  an', 'gist_earth
-000865a0: 272c 2027 7465 7272 6169 6e27 2c20 2767  ', 'terrain', 'g
-000865b0: 6973 745f 7374 6572 6e27 2c0d 0a20 2020  ist_stern',..   
-000865c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000865d0: 2020 2020 2020 2027 676e 7570 6c6f 7427         'gnuplot'
-000865e0: 2c20 2767 6e75 706c 6f74 3227 2c20 2743  , 'gnuplot2', 'C
-000865f0: 4d52 6d61 7027 2c20 2763 7562 6568 656c  MRmap', 'cubehel
-00086600: 6978 272c 2027 6272 6727 2c20 2768 7376  ix', 'brg', 'hsv
-00086610: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-00086620: 2020 2020 2020 2020 2020 2020 2020 2767                'g
-00086630: 6973 745f 7261 696e 626f 7727 2c20 2772  ist_rainbow', 'r
-00086640: 6169 6e62 6f77 272c 2027 6a65 7427 2c20  ainbow', 'jet', 
-00086650: 276e 6970 795f 7370 6563 7472 616c 272c  'nipy_spectral',
-00086660: 2027 6769 7374 5f6e 6361 7227 5d29 5d0d   'gist_ncar'])].
-00086670: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-00086680: 6974 5549 2863 6f6d 6d6f 6e2c 2064 6174  itUI(common, dat
-00086690: 615f 7374 7275 6374 2c20 7374 6163 6b29  a_struct, stack)
-000866a0: 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d  ....#-----------
-000866b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000866c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000866d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000866e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020  -----------..   
-000866f0: 2064 6566 2069 6e69 7455 4928 7365 6c66   def initUI(self
-00086700: 2c20 636f 6d6d 6f6e 2c20 6461 7461 5f73  , common, data_s
-00086710: 7472 7563 742c 2073 7461 636b 293a 0d0a  truct, stack):..
-00086720: 2020 2020 2020 2020 7365 6c66 2e78 6f66          self.xof
-00086730: 6673 6574 203d 2030 0d0a 2020 2020 2020  fset = 0..      
-00086740: 2020 7365 6c66 2e79 6f66 6673 6574 203d    self.yoffset =
-00086750: 2030 0d0a 2020 2020 2020 2020 7365 6c66   0..        self
-00086760: 2e73 6361 6c65 203d 2030 2e30 3030 3030  .scale = 0.00000
-00086770: 310d 0a20 2020 2020 2020 2073 656c 662e  1..        self.
-00086780: 7062 5253 542e 636c 6963 6b65 642e 636f  pbRST.clicked.co
-00086790: 6e6e 6563 7428 6c61 6d62 6461 3a20 7365  nnect(lambda: se
-000867a0: 6c66 2e73 6574 5368 6966 7473 2830 2c20  lf.setShifts(0, 
-000867b0: 3029 290d 0a20 2020 2020 2020 2073 656c  0))..        sel
-000867c0: 662e 7062 4c2e 636c 6963 6b65 642e 636f  f.pbL.clicked.co
-000867d0: 6e6e 6563 7428 6c61 6d62 6461 3a20 7365  nnect(lambda: se
-000867e0: 6c66 2e73 6574 5368 6966 7473 282d 302e  lf.setShifts(-0.
-000867f0: 322c 3029 290d 0a20 2020 2020 2020 2073  2,0))..        s
-00086800: 656c 662e 7062 522e 636c 6963 6b65 642e  elf.pbR.clicked.
-00086810: 636f 6e6e 6563 7428 6c61 6d62 6461 3a20  connect(lambda: 
-00086820: 7365 6c66 2e73 6574 5368 6966 7473 2830  self.setShifts(0
-00086830: 2e32 2c30 2929 0d0a 2020 2020 2020 2020  .2,0))..        
-00086840: 7365 6c66 2e70 6255 2e63 6c69 636b 6564  self.pbU.clicked
-00086850: 2e63 6f6e 6e65 6374 286c 616d 6264 613a  .connect(lambda:
-00086860: 2073 656c 662e 7365 7453 6869 6674 7328   self.setShifts(
-00086870: 302c 302e 3229 290d 0a20 2020 2020 2020  0,0.2))..       
-00086880: 2073 656c 662e 7062 442e 636c 6963 6b65   self.pbD.clicke
-00086890: 642e 636f 6e6e 6563 7428 6c61 6d62 6461  d.connect(lambda
-000868a0: 3a20 7365 6c66 2e73 6574 5368 6966 7473  : self.setShifts
-000868b0: 2830 2c2d 302e 3229 290d 0a20 2020 2020  (0,-0.2))..     
-000868c0: 2020 2073 656c 662e 7062 5244 2e63 6c69     self.pbRD.cli
-000868d0: 636b 6564 2e63 6f6e 6e65 6374 286c 616d  cked.connect(lam
-000868e0: 6264 613a 2073 656c 662e 7365 7453 6869  bda: self.setShi
-000868f0: 6674 7328 302e 322c 2d30 2e32 2929 0d0a  fts(0.2,-0.2))..
-00086900: 2020 2020 2020 2020 7365 6c66 2e70 6252          self.pbR
-00086910: 552e 636c 6963 6b65 642e 636f 6e6e 6563  U.clicked.connec
-00086920: 7428 6c61 6d62 6461 3a20 7365 6c66 2e73  t(lambda: self.s
-00086930: 6574 5368 6966 7473 2830 2e32 2c30 2e32  etShifts(0.2,0.2
-00086940: 2929 0d0a 2020 2020 2020 2020 7365 6c66  ))..        self
-00086950: 2e70 624c 442e 636c 6963 6b65 642e 636f  .pbLD.clicked.co
-00086960: 6e6e 6563 7428 6c61 6d62 6461 3a20 7365  nnect(lambda: se
-00086970: 6c66 2e73 6574 5368 6966 7473 282d 302e  lf.setShifts(-0.
-00086980: 322c 2d30 2e32 2929 0d0a 2020 2020 2020  2,-0.2))..      
-00086990: 2020 7365 6c66 2e70 624c 552e 636c 6963    self.pbLU.clic
-000869a0: 6b65 642e 636f 6e6e 6563 7428 6c61 6d62  ked.connect(lamb
-000869b0: 6461 3a20 7365 6c66 2e73 6574 5368 6966  da: self.setShif
-000869c0: 7473 282d 302e 322c 302e 3229 290d 0a20  ts(-0.2,0.2)).. 
-000869d0: 2020 2020 2020 2073 656c 662e 7062 4c4c         self.pbLL
-000869e0: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
-000869f0: 286c 616d 6264 613a 2073 656c 662e 7365  (lambda: self.se
-00086a00: 7453 6869 6674 7328 2d31 2c30 2929 0d0a  tShifts(-1,0))..
-00086a10: 2020 2020 2020 2020 7365 6c66 2e70 6252          self.pbR
-00086a20: 522e 636c 6963 6b65 642e 636f 6e6e 6563  R.clicked.connec
-00086a30: 7428 6c61 6d62 6461 3a20 7365 6c66 2e73  t(lambda: self.s
-00086a40: 6574 5368 6966 7473 2831 2c30 2929 0d0a  etShifts(1,0))..
-00086a50: 2020 2020 2020 2020 7365 6c66 2e70 6255          self.pbU
-00086a60: 552e 636c 6963 6b65 642e 636f 6e6e 6563  U.clicked.connec
-00086a70: 7428 6c61 6d62 6461 3a20 7365 6c66 2e73  t(lambda: self.s
-00086a80: 6574 5368 6966 7473 2830 2c31 2929 0d0a  etShifts(0,1))..
-00086a90: 2020 2020 2020 2020 7365 6c66 2e70 6244          self.pbD
-00086aa0: 442e 636c 6963 6b65 642e 636f 6e6e 6563  D.clicked.connec
-00086ab0: 7428 6c61 6d62 6461 3a20 7365 6c66 2e73  t(lambda: self.s
-00086ac0: 6574 5368 6966 7473 2830 2c2d 3129 290d  etShifts(0,-1)).
-00086ad0: 0a20 2020 2020 2020 2073 656c 662e 7062  .        self.pb
-00086ae0: 4c4c 4444 2e63 6c69 636b 6564 2e63 6f6e  LLDD.clicked.con
-00086af0: 6e65 6374 286c 616d 6264 613a 2073 656c  nect(lambda: sel
-00086b00: 662e 7365 7453 6869 6674 7328 2d31 2c2d  f.setShifts(-1,-
-00086b10: 3129 290d 0a20 2020 2020 2020 2073 656c  1))..        sel
-00086b20: 662e 7062 5252 5555 2e63 6c69 636b 6564  f.pbRRUU.clicked
-00086b30: 2e63 6f6e 6e65 6374 286c 616d 6264 613a  .connect(lambda:
-00086b40: 2073 656c 662e 7365 7453 6869 6674 7328   self.setShifts(
-00086b50: 312c 3129 290d 0a20 2020 2020 2020 2073  1,1))..        s
-00086b60: 656c 662e 7062 4c4c 5555 2e63 6c69 636b  elf.pbLLUU.click
-00086b70: 6564 2e63 6f6e 6e65 6374 286c 616d 6264  ed.connect(lambd
-00086b80: 613a 2073 656c 662e 7365 7453 6869 6674  a: self.setShift
-00086b90: 7328 2d31 2c31 2929 0d0a 2020 2020 2020  s(-1,1))..      
-00086ba0: 2020 7365 6c66 2e70 6252 5244 442e 636c    self.pbRRDD.cl
-00086bb0: 6963 6b65 642e 636f 6e6e 6563 7428 6c61  icked.connect(la
-00086bc0: 6d62 6461 3a20 7365 6c66 2e73 6574 5368  mbda: self.setSh
-00086bd0: 6966 7473 2831 2c2d 3129 290d 0a0d 0a20  ifts(1,-1)).... 
-00086be0: 2020 2020 2020 2073 656c 662e 7062 4578         self.pbEx
-00086bf0: 7044 6174 612e 636c 6963 6b65 642e 636f  pData.clicked.co
-00086c00: 6e6e 6563 7428 7365 6c66 2e4f 6e53 6176  nnect(self.OnSav
-00086c10: 6544 6174 6129 0d0a 2020 2020 2020 2020  eData)..        
-00086c20: 7365 6c66 2e70 6245 7870 496d 672e 636c  self.pbExpImg.cl
-00086c30: 6963 6b65 642e 636f 6e6e 6563 7428 7365  icked.connect(se
-00086c40: 6c66 2e4f 6e53 6176 6549 6d61 6765 290d  lf.OnSaveImage).
-00086c50: 0a20 2020 2020 2020 2073 656c 662e 7062  .        self.pb
-00086c60: 436f 7079 2e63 6c69 636b 6564 2e63 6f6e  Copy.clicked.con
-00086c70: 6e65 6374 2873 656c 662e 4f6e 436f 7079  nect(self.OnCopy
-00086c80: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-00086c90: 662e 4d65 7472 6963 4368 6563 6b42 6f78  f.MetricCheckBox
-00086ca0: 2e74 6f67 676c 6564 2e63 6f6e 6e65 6374  .toggled.connect
-00086cb0: 286c 616d 6264 613a 2073 656c 662e 4f6e  (lambda: self.On
-00086cc0: 4d65 7472 6963 5363 616c 6528 7365 6c66  MetricScale(self
-00086cd0: 2e4d 6574 7269 6343 6865 636b 426f 782e  .MetricCheckBox.
-00086ce0: 6973 4368 6563 6b65 6428 292c 2073 656c  isChecked(), sel
-00086cf0: 662e 5a65 726f 4f72 6967 696e 4368 6563  f.ZeroOriginChec
-00086d00: 6b42 6f78 2e69 7343 6865 636b 6564 2829  kBox.isChecked()
-00086d10: 2c73 656c 662e 5371 7561 7265 5078 4368  ,self.SquarePxCh
-00086d20: 6563 6b42 6f78 2e69 7343 6865 636b 6564  eckBox.isChecked
-00086d30: 2829 2929 0d0a 2020 2020 2020 2020 7365  ()))..        se
-00086d40: 6c66 2e5a 6572 6f4f 7269 6769 6e43 6865  lf.ZeroOriginChe
-00086d50: 636b 426f 782e 746f 6767 6c65 642e 636f  ckBox.toggled.co
-00086d60: 6e6e 6563 7428 6c61 6d62 6461 3a20 7365  nnect(lambda: se
-00086d70: 6c66 2e4f 6e4d 6574 7269 6353 6361 6c65  lf.OnMetricScale
-00086d80: 2873 656c 662e 4d65 7472 6963 4368 6563  (self.MetricChec
-00086d90: 6b42 6f78 2e69 7343 6865 636b 6564 2829  kBox.isChecked()
-00086da0: 2c20 7365 6c66 2e5a 6572 6f4f 7269 6769  , self.ZeroOrigi
-00086db0: 6e43 6865 636b 426f 782e 6973 4368 6563  nCheckBox.isChec
-00086dc0: 6b65 6428 292c 7365 6c66 2e53 7175 6172  ked(),self.Squar
-00086dd0: 6550 7843 6865 636b 426f 782e 6973 4368  ePxCheckBox.isCh
-00086de0: 6563 6b65 6428 2929 290d 0a20 2020 2020  ecked()))..     
-00086df0: 2020 2073 656c 662e 5371 7561 7265 5078     self.SquarePx
-00086e00: 4368 6563 6b42 6f78 2e74 6f67 676c 6564  CheckBox.toggled
-00086e10: 2e63 6f6e 6e65 6374 286c 616d 6264 613a  .connect(lambda:
-00086e20: 2073 656c 662e 4f6e 4d65 7472 6963 5363   self.OnMetricSc
-00086e30: 616c 6528 7365 6c66 2e4d 6574 7269 6343  ale(self.MetricC
-00086e40: 6865 636b 426f 782e 6973 4368 6563 6b65  heckBox.isChecke
-00086e50: 6428 292c 2073 656c 662e 5a65 726f 4f72  d(), self.ZeroOr
-00086e60: 6967 696e 4368 6563 6b42 6f78 2e69 7343  iginCheckBox.isC
-00086e70: 6865 636b 6564 2829 2c73 656c 662e 5371  hecked(),self.Sq
-00086e80: 7561 7265 5078 4368 6563 6b42 6f78 2e69  uarePxCheckBox.i
-00086e90: 7343 6865 636b 6564 2829 2929 0d0a 2020  sChecked()))..  
-00086ea0: 2020 2020 2020 7365 6c66 2e53 7175 6172        self.Squar
-00086eb0: 6550 7843 6865 636b 426f 782e 7365 7456  ePxCheckBox.setV
-00086ec0: 6973 6962 6c65 2846 616c 7365 290d 0a20  isible(False).. 
-00086ed0: 2020 2020 2020 2073 656c 662e 4372 6f70         self.Crop
-00086ee0: 4368 6563 6b42 6f78 2e74 6f67 676c 6564  CheckBox.toggled
-00086ef0: 2e63 6f6e 6e65 6374 286c 616d 6264 613a  .connect(lambda:
-00086f00: 2073 656c 662e 4f6e 4372 6f70 4342 2873   self.OnCropCB(s
-00086f10: 656c 662e 4372 6f70 4368 6563 6b42 6f78  elf.CropCheckBox
-00086f20: 2e69 7343 6865 636b 6564 2829 2929 0d0a  .isChecked()))..
-00086f30: 2020 2020 2020 2020 7365 6c66 2e63 726f          self.cro
-00086f40: 7066 6c61 6720 3d20 5472 7565 0d0a 2020  pflag = True..  
-00086f50: 2020 2020 2020 2373 656c 662e 5368 6966        #self.Shif
-00086f60: 744c 6162 656c 2e73 6574 5465 7874 2822  tLabel.setText("
-00086f70: 7820 3d20 2530 2e31 6620 5c6e 7920 3d20  x = %0.1f \ny = 
-00086f80: 2530 2e31 6622 2025 2028 302c 2030 2929  %0.1f" % (0, 0))
-00086f90: 0d0a 2020 2020 2020 2020 7365 6c66 2e4f  ..        self.O
-00086fa0: 4448 6967 6853 7069 6e42 6f78 2e76 616c  DHighSpinBox.val
-00086fb0: 7565 4368 616e 6765 642e 636f 6e6e 6563  ueChanged.connec
-00086fc0: 7428 6c61 6d62 6461 3a20 7365 6c66 2e73  t(lambda: self.s
-00086fd0: 6574 4f44 6c69 6d69 7473 2873 656c 662e  etODlimits(self.
-00086fe0: 4f44 4c6f 7753 7069 6e42 6f78 2e76 616c  ODLowSpinBox.val
-00086ff0: 7565 2829 2c73 656c 662e 4f44 4869 6768  ue(),self.ODHigh
-00087000: 5370 696e 426f 782e 7661 6c75 6528 2929  SpinBox.value())
-00087010: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00087020: 4f44 4c6f 7753 7069 6e42 6f78 2e76 616c  ODLowSpinBox.val
-00087030: 7565 4368 616e 6765 642e 636f 6e6e 6563  ueChanged.connec
-00087040: 7428 6c61 6d62 6461 3a20 7365 6c66 2e73  t(lambda: self.s
-00087050: 6574 4f44 6c69 6d69 7473 2873 656c 662e  etODlimits(self.
-00087060: 4f44 4c6f 7753 7069 6e42 6f78 2e76 616c  ODLowSpinBox.val
-00087070: 7565 2829 2c73 656c 662e 4f44 4869 6768  ue(),self.ODHigh
-00087080: 5370 696e 426f 782e 7661 6c75 6528 2929  SpinBox.value())
-00087090: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000870a0: 7062 5253 544f 442e 636c 6963 6b65 642e  pbRSTOD.clicked.
-000870b0: 636f 6e6e 6563 7428 6c61 6d62 6461 3a20  connect(lambda: 
-000870c0: 7365 6c66 2e53 686f 774d 6170 2873 656c  self.ShowMap(sel
-000870d0: 662e 7072 656c 7374 2c20 7365 6c66 2e70  f.prelst, self.p
-000870e0: 6f73 746c 7374 2929 0d0a 2020 2020 2020  ostlst))..      
-000870f0: 2020 7365 6c66 2e70 6243 6c72 5368 6966    self.pbClrShif
-00087100: 7473 2e63 6c69 636b 6564 2e63 6f6e 6e65  ts.clicked.conne
-00087110: 6374 2873 656c 662e 4f6e 436c 7253 6869  ct(self.OnClrShi
-00087120: 6674 7329 0d0a 2020 2020 2020 2020 7365  fts)..        se
-00087130: 6c66 2e70 6243 6c72 5365 6c2e 636c 6963  lf.pbClrSel.clic
-00087140: 6b65 642e 636f 6e6e 6563 7428 7365 6c66  ked.connect(self
-00087150: 2e4f 6e43 6c72 5365 6c65 6374 696f 6e29  .OnClrSelection)
-00087160: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00087170: 2e43 4d43 6174 426f 782e 6164 6449 7465  .CMCatBox.addIte
-00087180: 6d73 285b 7365 6c66 2e63 6d61 7073 5b30  ms([self.cmaps[0
-00087190: 5d5b 305d 2c73 656c 662e 636d 6170 735b  ][0],self.cmaps[
-000871a0: 315d 5b30 5d2c 7365 6c66 2e63 6d61 7073  1][0],self.cmaps
-000871b0: 5b32 5d5b 305d 2c73 656c 662e 636d 6170  [2][0],self.cmap
-000871c0: 735b 335d 5b30 5d2c 7365 6c66 2e63 6d61  s[3][0],self.cma
-000871d0: 7073 5b34 5d5b 305d 2c73 656c 662e 636d  ps[4][0],self.cm
-000871e0: 6170 735b 355d 5b30 5d5d 290d 0a20 2020  aps[5][0]])..   
-000871f0: 2020 2020 2073 656c 662e 434d 4d61 7042       self.CMMapB
-00087200: 6f78 2e61 6464 4974 656d 7328 7365 6c66  ox.addItems(self
-00087210: 2e63 6d61 7073 5b32 5d5b 315d 290d 0a20  .cmaps[2][1]).. 
-00087220: 2020 2020 2020 2073 656c 662e 434d 4361         self.CMCa
-00087230: 7442 6f78 2e73 6574 4375 7272 656e 7449  tBox.setCurrentI
-00087240: 6e64 6578 2832 290d 0a20 2020 2020 2020  ndex(2)..       
-00087250: 2073 656c 662e 434d 4d61 7042 6f78 2e73   self.CMMapBox.s
-00087260: 6574 4375 7272 656e 7449 6e64 6578 2831  etCurrentIndex(1
-00087270: 3429 0d0a 2020 2020 2020 2020 7365 6c66  4)..        self
-00087280: 2e43 4d43 6174 426f 782e 6375 7272 656e  .CMCatBox.curren
-00087290: 7449 6e64 6578 4368 616e 6765 642e 636f  tIndexChanged.co
-000872a0: 6e6e 6563 7428 7365 6c66 2e4f 6e43 6174  nnect(self.OnCat
-000872b0: 4368 616e 6765 6429 0d0a 2020 2020 2020  Changed)..      
-000872c0: 2020 7365 6c66 2e43 4d4d 6170 426f 782e    self.CMMapBox.
-000872d0: 6375 7272 656e 7449 6e64 6578 4368 616e  currentIndexChan
-000872e0: 6765 642e 636f 6e6e 6563 7428 6c61 6d62  ged.connect(lamb
-000872f0: 6461 3a20 7365 6c66 2e4f 6e43 6f6c 6f72  da: self.OnColor
-00087300: 6d61 7028 6d61 703d 7365 6c66 2e43 4d4d  map(map=self.CMM
-00087310: 6170 426f 782e 6375 7272 656e 7454 6578  apBox.currentTex
-00087320: 7428 292c 636f 6c6f 7273 3d73 656c 662e  t(),colors=self.
-00087330: 5374 6570 5370 696e 2e76 616c 7565 2829  StepSpin.value()
-00087340: 2929 0d0a 2020 2020 2020 2020 7365 6c66  ))..        self
-00087350: 2e53 7465 7053 7069 6e2e 7661 6c75 6543  .StepSpin.valueC
-00087360: 6861 6e67 6564 2e63 6f6e 6e65 6374 286c  hanged.connect(l
-00087370: 616d 6264 613a 2073 656c 662e 4f6e 436f  ambda: self.OnCo
-00087380: 6c6f 726d 6170 286d 6170 3d73 656c 662e  lormap(map=self.
-00087390: 434d 4d61 7042 6f78 2e63 7572 7265 6e74  CMMapBox.current
-000873a0: 5465 7874 2829 2c63 6f6c 6f72 733d 7365  Text(),colors=se
-000873b0: 6c66 2e53 7465 7053 7069 6e2e 7661 6c75  lf.StepSpin.valu
-000873c0: 6528 2929 290d 0a20 2020 2020 2020 2073  e()))..        s
-000873d0: 656c 662e 6669 6c74 6572 5370 696e 426f  elf.filterSpinBo
-000873e0: 782e 7661 6c75 6543 6861 6e67 6564 2e63  x.valueChanged.c
-000873f0: 6f6e 6e65 6374 286c 616d 6264 613a 2073  onnect(lambda: s
-00087400: 656c 662e 5368 6f77 4d61 7028 7365 6c66  elf.ShowMap(self
-00087410: 2e70 7265 6c73 742c 2073 656c 662e 706f  .prelst, self.po
-00087420: 7374 6c73 7429 290d 0a20 2020 2020 2020  stlst))..       
-00087430: 2073 656c 662e 6669 6c74 6572 5370 696e   self.filterSpin
-00087440: 426f 782e 7365 7445 6e61 626c 6564 2846  Box.setEnabled(F
-00087450: 616c 7365 290d 0a20 2020 2020 2020 2073  alse)..        s
-00087460: 656c 662e 4d61 7053 656c 6563 7457 6964  elf.MapSelectWid
-00087470: 6765 7431 2e6d 6f75 7365 5072 6573 7345  get1.mousePressE
-00087480: 7665 6e74 203d 2073 656c 662e 6d6f 7573  vent = self.mous
-00087490: 6545 7665 6e74 4f6e 514c 6973 740d 0a20  eEventOnQList.. 
-000874a0: 2020 2020 2020 2073 656c 662e 4d61 7053         self.MapS
-000874b0: 656c 6563 7457 6964 6765 7431 2e6d 6f75  electWidget1.mou
-000874c0: 7365 4d6f 7665 4576 656e 7420 3d20 7365  seMoveEvent = se
-000874d0: 6c66 2e6d 6f75 7365 4576 656e 744f 6e51  lf.mouseEventOnQ
-000874e0: 4c69 7374 0d0a 2020 2020 2020 2020 7365  List..        se
-000874f0: 6c66 2e64 6174 615f 7374 7275 6374 203d  lf.data_struct =
-00087500: 2064 6174 615f 7374 7275 6374 0d0a 2020   data_struct..  
-00087510: 2020 2020 2020 7365 6c66 2e73 746b 203d        self.stk =
-00087520: 2073 7461 636b 0d0a 2020 2020 2020 2020   stack..        
-00087530: 7365 6c66 2e63 6f6d 203d 2063 6f6d 6d6f  self.com = commo
-00087540: 6e0d 0a20 2020 2020 2020 2073 656c 662e  n..        self.
-00087550: 6965 7620 3d20 300d 0a20 2020 2020 2020  iev = 0..       
-00087560: 2073 656c 662e 6c61 7465 7374 5f72 6f77   self.latest_row
-00087570: 203d 202d 310d 0a0d 0a20 2020 2020 2020   = -1....       
-00087580: 2073 656c 662e 7067 6c61 796f 7574 203d   self.pglayout =
-00087590: 2070 672e 4772 6170 6869 6373 4c61 796f   pg.GraphicsLayo
-000875a0: 7574 2862 6f72 6465 723d 4e6f 6e65 290d  ut(border=None).
-000875b0: 0a20 2020 2020 2020 2073 656c 662e 6361  .        self.ca
-000875c0: 6e76 6173 2e73 6574 4261 636b 6772 6f75  nvas.setBackgrou
-000875d0: 6e64 2822 7722 2920 2320 6361 6e76 6173  nd("w") # canvas
-000875e0: 2069 7320 6120 7067 2e47 7261 7068 6963   is a pg.Graphic
-000875f0: 7356 6965 7720 7769 6467 6574 0d0a 2020  sView widget..  
-00087600: 2020 2020 2020 7365 6c66 2e63 616e 7661        self.canva
-00087610: 732e 7365 7443 656e 7472 616c 5769 6467  s.setCentralWidg
-00087620: 6574 2873 656c 662e 7067 6c61 796f 7574  et(self.pglayout
-00087630: 290d 0a20 2020 2020 2020 2023 7365 6c66  )..        #self
-00087640: 2e70 676c 6179 6f75 742e 6164 6449 7465  .pglayout.addIte
-00087650: 6d28 7067 2e41 7869 7349 7465 6d28 276c  m(pg.AxisItem('l
-00087660: 6566 7427 2c76 506f 6c69 6379 203d 5174  eft',vPolicy =Qt
-00087670: 5769 6467 6574 732e 5153 697a 6550 6f6c  Widgets.QSizePol
-00087680: 6963 792e 4d61 7869 6d75 6d29 2c20 726f  icy.Maximum), ro
-00087690: 773d 312c 2063 6f6c 3d30 2c20 726f 7773  w=1, col=0, rows
-000876a0: 7061 6e3d 312c 2063 6f6c 7370 616e 3d33  pan=1, colspan=3
-000876b0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000876c0: 7031 203d 2073 656c 662e 7067 6c61 796f  p1 = self.pglayo
-000876d0: 7574 2e61 6464 506c 6f74 2872 6f77 3d30  ut.addPlot(row=0
-000876e0: 2c20 636f 6c3d 302c 2072 6f77 7370 616e  , col=0, rowspan
-000876f0: 3d31 2c20 636f 6c73 7061 6e3d 3129 0d0a  =1, colspan=1)..
-00087700: 2020 2020 2020 2020 7365 6c66 2e70 312e          self.p1.
-00087710: 7365 744d 6f75 7365 456e 6162 6c65 6428  setMouseEnabled(
-00087720: 783d 4661 6c73 652c 2079 3d46 616c 7365  x=False, y=False
-00087730: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00087740: 695f 6974 656d 203d 2070 672e 496d 6167  i_item = pg.Imag
-00087750: 6549 7465 6d28 626f 7264 6572 3d22 6b22  eItem(border="k"
-00087760: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00087770: 7031 2e73 6574 4173 7065 6374 4c6f 636b  p1.setAspectLock
-00087780: 6564 286c 6f63 6b3d 5472 7565 2c20 7261  ed(lock=True, ra
-00087790: 7469 6f3d 3129 0d0a 2020 2020 2020 2020  tio=1)..        
-000877a0: 7365 6c66 2e70 312e 7368 6f77 4178 6973  self.p1.showAxis
-000877b0: 2822 746f 7022 2c20 7368 6f77 3d54 7275  ("top", show=Tru
-000877c0: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-000877d0: 2e70 312e 7368 6f77 4178 6973 2822 626f  .p1.showAxis("bo
-000877e0: 7474 6f6d 222c 2073 686f 773d 5472 7565  ttom", show=True
-000877f0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00087800: 7031 2e73 686f 7741 7869 7328 226c 6566  p1.showAxis("lef
-00087810: 7422 2c20 7368 6f77 3d54 7275 6529 0d0a  t", show=True)..
-00087820: 2020 2020 2020 2020 7365 6c66 2e70 312e          self.p1.
-00087830: 7368 6f77 4178 6973 2822 7269 6768 7422  showAxis("right"
-00087840: 2c20 7368 6f77 3d54 7275 6529 0d0a 2020  , show=True)..  
-00087850: 2020 2020 2020 7365 6c66 2e61 7931 203d        self.ay1 =
-00087860: 2073 656c 662e 7031 2e67 6574 4178 6973   self.p1.getAxis
-00087870: 2822 6c65 6674 2229 0d0a 2020 2020 2020  ("left")..      
-00087880: 2020 6279 3120 3d20 7365 6c66 2e70 312e    by1 = self.p1.
-00087890: 6765 7441 7869 7328 2272 6967 6874 2229  getAxis("right")
-000878a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-000878b0: 7831 203d 2073 656c 662e 7031 2e67 6574  x1 = self.p1.get
-000878c0: 4178 6973 2822 626f 7474 6f6d 2229 0d0a  Axis("bottom")..
-000878d0: 2020 2020 2020 2020 6278 3120 3d20 7365          bx1 = se
-000878e0: 6c66 2e70 312e 6765 7441 7869 7328 2274  lf.p1.getAxis("t
-000878f0: 6f70 2229 0d0a 2020 2020 2020 2020 7365  op")..        se
-00087900: 6c66 2e61 7931 2e73 6574 4c61 6265 6c28  lf.ay1.setLabel(
-00087910: 7465 7874 3d22 7922 2c75 6e69 7473 3d22  text="y",units="
-00087920: 7078 2229 0d0a 2020 2020 2020 2020 7365  px")..        se
-00087930: 6c66 2e61 7931 2e65 6e61 626c 6541 7574  lf.ay1.enableAut
-00087940: 6f53 4950 7265 6669 7828 656e 6162 6c65  oSIPrefix(enable
-00087950: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-00087960: 7365 6c66 2e61 7831 2e73 6574 4c61 6265  self.ax1.setLabe
-00087970: 6c28 7465 7874 3d22 7822 2c75 6e69 7473  l(text="x",units
-00087980: 3d22 7078 2229 0d0a 2020 2020 2020 2020  ="px")..        
-00087990: 7365 6c66 2e61 7831 2e65 6e61 626c 6541  self.ax1.enableA
-000879a0: 7574 6f53 4950 7265 6669 7828 656e 6162  utoSIPrefix(enab
-000879b0: 6c65 3d54 7275 6529 0d0a 2020 2020 2020  le=True)..      
-000879c0: 2020 7365 6c66 2e61 7931 2e73 6574 5374    self.ay1.setSt
-000879d0: 796c 6528 7469 636b 4c65 6e67 7468 3d38  yle(tickLength=8
-000879e0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000879f0: 6178 312e 7365 7453 7479 6c65 2874 6963  ax1.setStyle(tic
-00087a00: 6b4c 656e 6774 683d 3829 0d0a 2020 2020  kLength=8)..    
-00087a10: 2020 2020 6279 312e 7365 7453 7479 6c65      by1.setStyle
-00087a20: 2873 686f 7756 616c 7565 733d 4661 6c73  (showValues=Fals
-00087a30: 652c 7469 636b 4c65 6e67 7468 3d30 290d  e,tickLength=0).
-00087a40: 0a20 2020 2020 2020 2062 7831 2e73 6574  .        bx1.set
-00087a50: 5374 796c 6528 7368 6f77 5661 6c75 6573  Style(showValues
-00087a60: 3d46 616c 7365 2c74 6963 6b4c 656e 6774  =False,tickLengt
-00087a70: 683d 3029 0d0a 0d0a 2020 2020 2020 2020  h=0)....        
-00087a80: 7365 6c66 2e70 3220 3d20 7365 6c66 2e70  self.p2 = self.p
-00087a90: 676c 6179 6f75 742e 6164 6450 6c6f 7428  glayout.addPlot(
-00087aa0: 726f 773d 302c 2063 6f6c 3d31 2c20 726f  row=0, col=1, ro
-00087ab0: 7773 7061 6e3d 312c 2063 6f6c 7370 616e  wspan=1, colspan
-00087ac0: 3d31 290d 0a20 2020 2020 2020 2073 656c  =1)..        sel
-00087ad0: 662e 7032 2e73 6574 4d6f 7573 6545 6e61  f.p2.setMouseEna
-00087ae0: 626c 6564 2878 3d46 616c 7365 2c20 793d  bled(x=False, y=
-00087af0: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-00087b00: 7365 6c66 2e6d 5f69 7465 6d20 3d20 7067  self.m_item = pg
-00087b10: 2e49 6d61 6765 4974 656d 2862 6f72 6465  .ImageItem(borde
-00087b20: 723d 226b 2229 0d0a 2020 2020 2020 2020  r="k")..        
-00087b30: 7365 6c66 2e6d 5f69 7465 6d2e 7365 745a  self.m_item.setZ
-00087b40: 5661 6c75 6528 3130 3030 290d 0a20 2020  Value(1000)..   
-00087b50: 2020 2020 2073 656c 662e 7032 2e73 6574       self.p2.set
-00087b60: 4173 7065 6374 4c6f 636b 6564 286c 6f63  AspectLocked(loc
-00087b70: 6b3d 5472 7565 2c20 7261 7469 6f3d 3129  k=True, ratio=1)
-00087b80: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-00087b90: 322e 7368 6f77 4178 6973 2822 746f 7022  2.showAxis("top"
-00087ba0: 2c20 7368 6f77 3d54 7275 6529 0d0a 2020  , show=True)..  
-00087bb0: 2020 2020 2020 7365 6c66 2e70 322e 7368        self.p2.sh
-00087bc0: 6f77 4178 6973 2822 626f 7474 6f6d 222c  owAxis("bottom",
-00087bd0: 2073 686f 773d 5472 7565 290d 0a20 2020   show=True)..   
-00087be0: 2020 2020 2073 656c 662e 7032 2e73 686f       self.p2.sho
-00087bf0: 7741 7869 7328 226c 6566 7422 2c20 7368  wAxis("left", sh
-00087c00: 6f77 3d54 7275 6529 0d0a 2020 2020 2020  ow=True)..      
-00087c10: 2020 7365 6c66 2e70 322e 7368 6f77 4178    self.p2.showAx
-00087c20: 6973 2822 7269 6768 7422 2c20 7368 6f77  is("right", show
-00087c30: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-00087c40: 7365 6c66 2e61 7932 203d 2073 656c 662e  self.ay2 = self.
-00087c50: 7032 2e67 6574 4178 6973 2822 6c65 6674  p2.getAxis("left
-00087c60: 2229 0d0a 2020 2020 2020 2020 7365 6c66  ")..        self
-00087c70: 2e61 7932 2e73 6574 5a56 616c 7565 2831  .ay2.setZValue(1
-00087c80: 3030 3029 0d0a 2020 2020 2020 2020 6279  000)..        by
-00087c90: 3220 3d20 7365 6c66 2e70 322e 6765 7441  2 = self.p2.getA
-00087ca0: 7869 7328 2272 6967 6874 2229 0d0a 2020  xis("right")..  
-00087cb0: 2020 2020 2020 6279 322e 7365 745a 5661        by2.setZVa
-00087cc0: 6c75 6528 3130 3030 290d 0a20 2020 2020  lue(1000)..     
-00087cd0: 2020 2073 656c 662e 6178 3220 3d20 7365     self.ax2 = se
-00087ce0: 6c66 2e70 322e 6765 7441 7869 7328 2262  lf.p2.getAxis("b
-00087cf0: 6f74 746f 6d22 290d 0a20 2020 2020 2020  ottom")..       
-00087d00: 2073 656c 662e 6178 322e 7365 745a 5661   self.ax2.setZVa
-00087d10: 6c75 6528 3130 3030 290d 0a20 2020 2020  lue(1000)..     
-00087d20: 2020 2062 7832 203d 2073 656c 662e 7032     bx2 = self.p2
-00087d30: 2e67 6574 4178 6973 2822 746f 7022 290d  .getAxis("top").
-00087d40: 0a20 2020 2020 2020 2062 7832 2e73 6574  .        bx2.set
-00087d50: 5a56 616c 7565 2831 3030 3029 0d0a 2020  ZValue(1000)..  
-00087d60: 2020 2020 2020 7365 6c66 2e61 7932 2e73        self.ay2.s
-00087d70: 6574 4c61 6265 6c28 7465 7874 3d22 7922  etLabel(text="y"
-00087d80: 2c75 6e69 7473 3d22 7078 2229 0d0a 2020  ,units="px")..  
-00087d90: 2020 2020 2020 7365 6c66 2e73 695f 7072        self.si_pr
-00087da0: 6566 6978 203d 2073 656c 662e 6179 322e  efix = self.ay2.
-00087db0: 656e 6162 6c65 4175 746f 5349 5072 6566  enableAutoSIPref
-00087dc0: 6978 2865 6e61 626c 653d 5472 7565 290d  ix(enable=True).
-00087dd0: 0a20 2020 2020 2020 2073 656c 662e 6178  .        self.ax
-00087de0: 322e 7365 744c 6162 656c 2874 6578 743d  2.setLabel(text=
-00087df0: 2278 222c 756e 6974 733d 2270 7822 290d  "x",units="px").
-00087e00: 0a20 2020 2020 2020 2073 656c 662e 6178  .        self.ax
-00087e10: 322e 656e 6162 6c65 4175 746f 5349 5072  2.enableAutoSIPr
-00087e20: 6566 6978 2865 6e61 626c 653d 5472 7565  efix(enable=True
-00087e30: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00087e40: 6179 322e 7365 7453 7479 6c65 2874 6963  ay2.setStyle(tic
-00087e50: 6b4c 656e 6774 683d 3829 0d0a 2020 2020  kLength=8)..    
-00087e60: 2020 2020 7365 6c66 2e61 7832 2e73 6574      self.ax2.set
-00087e70: 5374 796c 6528 7469 636b 4c65 6e67 7468  Style(tickLength
-00087e80: 3d38 290d 0a20 2020 2020 2020 2062 7932  =8)..        by2
-00087e90: 2e73 6574 5374 796c 6528 7368 6f77 5661  .setStyle(showVa
-00087ea0: 6c75 6573 3d46 616c 7365 2c74 6963 6b4c  lues=False,tickL
-00087eb0: 656e 6774 683d 3029 0d0a 2020 2020 2020  ength=0)..      
-00087ec0: 2020 6278 322e 7365 7453 7479 6c65 2873    bx2.setStyle(s
-00087ed0: 686f 7756 616c 7565 733d 4661 6c73 652c  howValues=False,
-00087ee0: 7469 636b 4c65 6e67 7468 3d30 290d 0a20  tickLength=0).. 
-00087ef0: 2020 2020 2020 2073 656c 662e 7031 2e73         self.p1.s
-00087f00: 6574 5469 746c 6528 2222 290d 0a20 2020  etTitle("")..   
-00087f10: 2020 2020 2073 656c 662e 7031 2e74 6974       self.p1.tit
-00087f20: 6c65 4c61 6265 6c2e 7365 7454 6578 7428  leLabel.setText(
-00087f30: 223c 6365 6e74 6572 3e4e 6f20 696d 6167  "<center>No imag
-00087f40: 6573 206c 6f61 6465 643c 2f63 656e 7465  es loaded</cente
-00087f50: 723e 222c 2073 697a 653d 2731 3070 7427  r>", size='10pt'
-00087f60: 290d 0a0d 0a0d 0a20 2020 2020 2020 2073  )......        s
-00087f70: 656c 662e 7032 2e73 6574 5469 746c 6528  elf.p2.setTitle(
-00087f80: 2222 290d 0a20 2020 2020 2020 2073 656c  "")..        sel
-00087f90: 662e 7032 2e74 6974 6c65 4c61 6265 6c2e  f.p2.titleLabel.
-00087fa0: 7365 7454 6578 7428 223c 6365 6e74 6572  setText("<center
-00087fb0: 3e4e 6f20 6d61 7020 6176 6169 6c61 626c  >No map availabl
-00087fc0: 653c 2f63 656e 7465 723e 222c 2073 697a  e</center>", siz
-00087fd0: 653d 2731 3070 7427 290d 0a20 2020 2020  e='10pt')..     
-00087fe0: 2020 2023 7365 6c66 2e70 312e 7469 746c     #self.p1.titl
-00087ff0: 654c 6162 656c 2e69 7465 6d2e 7365 7454  eLabel.item.setT
-00088000: 6578 7457 6964 7468 2873 656c 662e 7031  extWidth(self.p1
-00088010: 2e77 6964 7468 2829 202a 2030 2e37 290d  .width() * 0.7).
-00088020: 0a20 2020 2020 2020 2023 7365 6c66 2e70  .        #self.p
-00088030: 322e 7469 746c 654c 6162 656c 2e69 7465  2.titleLabel.ite
-00088040: 6d2e 7365 7454 6578 7457 6964 7468 2873  m.setTextWidth(s
-00088050: 656c 662e 7032 2e77 6964 7468 2829 202a  elf.p2.width() *
-00088060: 2030 2e37 290d 0a20 2020 2020 2020 2073   0.7)..        s
-00088070: 656c 662e 636d 696d 6720 3d20 7067 2e49  elf.cmimg = pg.I
-00088080: 6d61 6765 4974 656d 2862 6f72 6465 723d  mageItem(border=
-00088090: 4e6f 6e65 290d 0a20 2020 2020 2020 2073  None)..        s
-000880a0: 656c 662e 636d 203d 2073 656c 662e 7067  elf.cm = self.pg
-000880b0: 6c61 796f 7574 2e61 6464 506c 6f74 2872  layout.addPlot(r
-000880c0: 6f77 3d30 2c20 636f 6c3d 322c 2072 6f77  ow=0, col=2, row
-000880d0: 7370 616e 3d31 2c20 636f 6c73 7061 6e3d  span=1, colspan=
-000880e0: 3129 0d0a 2020 2020 2020 2020 7365 6c66  1)..        self
-000880f0: 2e63 6d2e 6164 6449 7465 6d28 7365 6c66  .cm.addItem(self
-00088100: 2e63 6d69 6d67 290d 0a20 2020 2020 2020  .cmimg)..       
-00088110: 2073 656c 662e 636d 2e73 6574 4d6f 7573   self.cm.setMous
-00088120: 6545 6e61 626c 6564 2878 3d46 616c 7365  eEnabled(x=False
-00088130: 2c20 793d 4661 6c73 6529 0d0a 2020 2020  , y=False)..    
-00088140: 2020 2020 7365 6c66 2e63 6d2e 6765 7456      self.cm.getV
-00088150: 6965 7742 6f78 2829 2e61 7574 6f52 616e  iewBox().autoRan
-00088160: 6765 2870 6164 6469 6e67 3d30 290d 0a20  ge(padding=0).. 
-00088170: 2020 2020 2020 2073 656c 662e 636d 2e73         self.cm.s
-00088180: 686f 7741 7869 7328 2274 6f70 222c 2073  howAxis("top", s
-00088190: 686f 773d 5472 7565 290d 0a20 2020 2020  how=True)..     
-000881a0: 2020 2073 656c 662e 636d 2e73 686f 7741     self.cm.showA
-000881b0: 7869 7328 2262 6f74 746f 6d22 2c20 7368  xis("bottom", sh
-000881c0: 6f77 3d54 7275 6529 0d0a 2020 2020 2020  ow=True)..      
-000881d0: 2020 7365 6c66 2e63 6d2e 7368 6f77 4178    self.cm.showAx
-000881e0: 6973 2822 6c65 6674 222c 2073 686f 773d  is("left", show=
-000881f0: 5472 7565 290d 0a20 2020 2020 2020 2073  True)..        s
-00088200: 656c 662e 636d 2e73 686f 7741 7869 7328  elf.cm.showAxis(
-00088210: 2272 6967 6874 222c 2073 686f 773d 5472  "right", show=Tr
-00088220: 7565 290d 0a20 2020 2020 2020 2073 656c  ue)..        sel
-00088230: 662e 636d 2e73 6574 5469 746c 6528 2222  f.cm.setTitle(""
-00088240: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00088250: 636d 2e74 6974 6c65 4c61 6265 6c2e 7365  cm.titleLabel.se
-00088260: 7454 6578 7428 2222 2c20 7369 7a65 3d27  tText("", size='
-00088270: 3130 7074 2729 0d0a 2020 2020 2020 2020  10pt')..        
-00088280: 6179 3320 3d20 7365 6c66 2e63 6d2e 6765  ay3 = self.cm.ge
-00088290: 7441 7869 7328 226c 6566 7422 290d 0a20  tAxis("left").. 
-000882a0: 2020 2020 2020 2061 7933 2e73 6574 5a56         ay3.setZV
-000882b0: 616c 7565 2831 3030 3029 0d0a 2020 2020  alue(1000)..    
-000882c0: 2020 2020 6279 3320 3d20 7365 6c66 2e63      by3 = self.c
-000882d0: 6d2e 6765 7441 7869 7328 2272 6967 6874  m.getAxis("right
-000882e0: 2229 0d0a 2020 2020 2020 2020 6279 332e  ")..        by3.
-000882f0: 7365 745a 5661 6c75 6528 3130 3030 290d  setZValue(1000).
-00088300: 0a20 2020 2020 2020 2062 7833 203d 2073  .        bx3 = s
-00088310: 656c 662e 636d 2e67 6574 4178 6973 2822  elf.cm.getAxis("
-00088320: 746f 7022 290d 0a20 2020 2020 2020 2062  top")..        b
-00088330: 7833 2e73 6574 5a56 616c 7565 2831 3030  x3.setZValue(100
-00088340: 3029 0d0a 2020 2020 2020 2020 6178 3320  0)..        ax3 
-00088350: 3d20 7365 6c66 2e63 6d2e 6765 7441 7869  = self.cm.getAxi
-00088360: 7328 2262 6f74 746f 6d22 290d 0a20 2020  s("bottom")..   
-00088370: 2020 2020 2061 7833 2e73 6574 5a56 616c       ax3.setZVal
-00088380: 7565 2831 3030 3029 0d0a 2020 2020 2020  ue(1000)..      
-00088390: 2020 6178 332e 7365 7454 6963 6b73 285b    ax3.setTicks([
-000883a0: 5d29 0d0a 2020 2020 2020 2020 6178 332e  ])..        ax3.
-000883b0: 7365 744c 6162 656c 2874 6578 743d 2222  setLabel(text=""
-000883c0: 2c20 756e 6974 733d 2222 290d 0a20 2020  , units="")..   
-000883d0: 2020 2020 2061 7833 2e73 6574 5374 796c       ax3.setStyl
-000883e0: 6528 7469 636b 4c65 6e67 7468 3d38 290d  e(tickLength=8).
-000883f0: 0a20 2020 2020 2020 2062 7933 203d 2073  .        by3 = s
-00088400: 656c 662e 636d 2e67 6574 4178 6973 2822  elf.cm.getAxis("
-00088410: 7269 6768 7422 290d 0a20 2020 2020 2020  right")..       
-00088420: 2062 7933 2e73 6574 4c61 6265 6c28 7465   by3.setLabel(te
-00088430: 7874 3d22 4f44 222c 2075 6e69 7473 3d22  xt="OD", units="
-00088440: 2229 0d0a 2020 2020 2020 2020 6279 332e  ")..        by3.
-00088450: 7365 7453 7479 6c65 2874 6963 6b4c 656e  setStyle(tickLen
-00088460: 6774 683d 3829 0d0a 2020 2020 2020 2020  gth=8)..        
-00088470: 2362 7933 2e74 6578 7457 6964 7468 2829  #by3.textWidth()
-00088480: 0d0a 2020 2020 2020 2020 6179 332e 7365  ..        ay3.se
-00088490: 7453 7479 6c65 2873 686f 7756 616c 7565  tStyle(showValue
-000884a0: 733d 4661 6c73 652c 7469 636b 4c65 6e67  s=False,tickLeng
-000884b0: 7468 3d30 290d 0a20 2020 2020 2020 2062  th=0)..        b
-000884c0: 7833 2e73 6574 5374 796c 6528 7368 6f77  x3.setStyle(show
-000884d0: 5661 6c75 6573 3d46 616c 7365 2c74 6963  Values=False,tic
-000884e0: 6b4c 656e 6774 683d 3029 0d0a 2020 2020  kLength=0)..    
-000884f0: 2020 2020 6178 332e 7365 7448 6569 6768      ax3.setHeigh
-00088500: 7428 683d 3436 2e32 2920 2023 2077 6f72  t(h=46.2)  # wor
-00088510: 6b61 726f 756e 6420 666f 7220 6f76 6572  karound for over
-00088520: 6c79 206c 6f6e 6720 636f 6c6f 7262 6172  ly long colorbar
-00088530: 0d0a 2020 2020 2020 2020 6279 332e 7365  ..        by3.se
-00088540: 7457 6964 7468 2877 3d36 3029 0d0a 2020  tWidth(w=60)..  
-00088550: 2020 2020 2020 7365 6c66 2e70 676c 6179        self.pglay
-00088560: 6f75 742e 6c61 796f 7574 2e73 6574 436f  out.layout.setCo
-00088570: 6c75 6d6e 4d69 6e69 6d75 6d57 6964 7468  lumnMinimumWidth
-00088580: 2832 2c20 3830 290d 0a20 2020 2020 2020  (2, 80)..       
-00088590: 2073 656c 662e 7067 6c61 796f 7574 2e6c   self.pglayout.l
-000885a0: 6179 6f75 742e 7365 7443 6f6c 756d 6e4d  ayout.setColumnM
-000885b0: 6178 696d 756d 5769 6474 6828 322c 2038  aximumWidth(2, 8
-000885c0: 3029 0d0a 2020 2020 2020 2020 2373 656c  0)..        #sel
-000885d0: 662e 7067 6c61 796f 7574 2e6c 6179 6f75  f.pglayout.layou
-000885e0: 742e 7365 7443 6f6c 756d 6e4d 696e 696d  t.setColumnMinim
-000885f0: 756d 5769 6474 6828 312c 2069 6e74 2828  umWidth(1, int((
-00088600: 7365 6c66 2e70 312e 7769 6474 6828 2920  self.p1.width() 
-00088610: 2b20 7365 6c66 2e70 322e 7769 6474 6828  + self.p2.width(
-00088620: 2929 202f 2032 2929 0d0a 2020 2020 2020  )) / 2))..      
-00088630: 2020 2373 656c 662e 7067 6c61 796f 7574    #self.pglayout
-00088640: 2e6c 6179 6f75 742e 7365 7443 6f6c 756d  .layout.setColum
-00088650: 6e4d 696e 696d 756d 5769 6474 6828 302c  nMinimumWidth(0,
-00088660: 2069 6e74 2828 7365 6c66 2e70 312e 7769   int((self.p1.wi
-00088670: 6474 6828 2920 2b20 7365 6c66 2e70 322e  dth() + self.p2.
-00088680: 7769 6474 6828 2929 202f 2032 2929 0d0a  width()) / 2))..
-00088690: 2020 2020 2020 2020 7365 6c66 2e70 312e          self.p1.
-000886a0: 7365 7453 697a 6550 6f6c 6963 7928 5174  setSizePolicy(Qt
-000886b0: 5769 6467 6574 732e 5153 697a 6550 6f6c  Widgets.QSizePol
-000886c0: 6963 792e 4578 7061 6e64 696e 672c 2051  icy.Expanding, Q
-000886d0: 7457 6964 6765 7473 2e51 5369 7a65 506f  tWidgets.QSizePo
-000886e0: 6c69 6379 2e50 7265 6665 7272 6564 290d  licy.Preferred).
-000886f0: 0a20 2020 2020 2020 2073 656c 662e 7032  .        self.p2
-00088700: 2e73 6574 5369 7a65 506f 6c69 6379 2851  .setSizePolicy(Q
-00088710: 7457 6964 6765 7473 2e51 5369 7a65 506f  tWidgets.QSizePo
-00088720: 6c69 6379 2e45 7870 616e 6469 6e67 2c20  licy.Expanding, 
-00088730: 5174 5769 6467 6574 732e 5153 697a 6550  QtWidgets.QSizeP
-00088740: 6f6c 6963 792e 5072 6566 6572 7265 6429  olicy.Preferred)
-00088750: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00088760: 6d2e 7365 7453 697a 6550 6f6c 6963 7928  m.setSizePolicy(
-00088770: 5174 5769 6467 6574 732e 5153 697a 6550  QtWidgets.QSizeP
-00088780: 6f6c 6963 792e 4d61 7869 6d75 6d2c 2051  olicy.Maximum, Q
-00088790: 7457 6964 6765 7473 2e51 5369 7a65 506f  tWidgets.QSizePo
-000887a0: 6c69 6379 2e50 7265 6665 7272 6564 290d  licy.Preferred).
-000887b0: 0a20 2020 2064 6566 206d 6f75 7365 4576  .    def mouseEv
-000887c0: 656e 744f 6e51 4c69 7374 2873 656c 662c  entOnQList(self,
-000887d0: 2065 293a 0d0a 2020 2020 2020 2020 6966   e):..        if
-000887e0: 2065 2e74 7970 6528 2920 3d3d 2051 7443   e.type() == QtC
-000887f0: 6f72 652e 5145 7665 6e74 2e4d 6f75 7365  ore.QEvent.Mouse
-00088800: 4d6f 7665 206f 7220 652e 7479 7065 2829  Move or e.type()
-00088810: 203d 3d20 5174 436f 7265 2e51 4576 656e   == QtCore.QEven
-00088820: 742e 4d6f 7573 6542 7574 746f 6e50 7265  t.MouseButtonPre
-00088830: 7373 3a0d 0a20 2020 2020 2020 2020 2020  ss:..           
-00088840: 2071 6c69 7374 203d 2073 656c 662e 4d61   qlist = self.Ma
-00088850: 7053 656c 6563 7457 6964 6765 7431 0d0a  pSelectWidget1..
-00088860: 2020 2020 2020 2020 2020 2020 706f 7320              pos 
-00088870: 3d20 716c 6973 742e 6d61 7046 726f 6d47  = qlist.mapFromG
-00088880: 6c6f 6261 6c28 5174 4775 692e 5143 7572  lobal(QtGui.QCur
-00088890: 736f 722e 706f 7328 2929 0d0a 2020 2020  sor.pos())..    
-000888a0: 2020 2020 2020 2020 726f 7720 3d20 716c          row = ql
-000888b0: 6973 742e 696e 6465 7841 7428 706f 7329  ist.indexAt(pos)
-000888c0: 2e72 6f77 2829 0d0a 2020 2020 2020 2020  .row()..        
-000888d0: 2020 2020 2370 7269 6e74 2872 6f77 2c73      #print(row,s
-000888e0: 656c 662e 6c61 7465 7374 5f72 6f77 290d  elf.latest_row).
-000888f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00088900: 7365 6c66 2e73 746b 2e73 6869 6674 733a  self.stk.shifts:
-00088910: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00088920: 2020 7061 7261 6d73 203d 205b 7365 6c66    params = [self
-00088930: 2e73 746b 2e73 6869 6674 735b 726f 775d  .stk.shifts[row]
-00088940: 5b30 5d2c 7365 6c66 2e73 746b 2e73 6869  [0],self.stk.shi
-00088950: 6674 735b 726f 775d 5b31 5d2c 7365 6c66  fts[row][1],self
-00088960: 2e73 746b 2e73 6869 6674 735b 726f 775d  .stk.shifts[row]
-00088970: 5b32 5d5d 0d0a 2020 2020 2020 2020 2020  [2]]..          
-00088980: 2020 2020 2020 6966 2072 6f77 203e 3d20        if row >= 
-00088990: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-000889a0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-000889b0: 2e74 7970 6528 2920 213d 2051 7443 6f72  .type() != QtCor
-000889c0: 652e 5145 7665 6e74 2e4d 6f75 7365 4d6f  e.QEvent.MouseMo
-000889d0: 7665 206f 7220 726f 7720 213d 2073 656c  ve or row != sel
-000889e0: 662e 6c61 7465 7374 5f72 6f77 3a0d 0a20  f.latest_row:.. 
-000889f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00088a00: 2020 2020 2020 2020 2020 2069 6620 652e             if e.
-00088a10: 6275 7474 6f6e 7328 2920 3d3d 2051 7443  buttons() == QtC
-00088a20: 6f72 652e 5174 2e52 6967 6874 4275 7474  ore.Qt.RightButt
-00088a30: 6f6e 3a0d 0a20 2020 2020 2020 2020 2020  on:..           
-00088a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00088a50: 2020 2020 2071 6c69 7374 2e73 6574 4375       qlist.setCu
-00088a60: 7272 656e 7452 6f77 2872 6f77 290d 0a20  rrentRow(row).. 
-00088a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00088a80: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00088a90: 6172 616d 735b 315d 203d 2031 0d0a 2020  arams[1] = 1..  
-00088aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00088ab0: 2020 2020 2020 2020 2020 656c 6966 2065            elif e
-00088ac0: 2e62 7574 746f 6e73 2829 203d 3d20 5174  .buttons() == Qt
-00088ad0: 436f 7265 2e51 742e 4c65 6674 4275 7474  Core.Qt.LeftButt
-00088ae0: 6f6e 3a0d 0a20 2020 2020 2020 2020 2020  on:..           
-00088af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00088b00: 2020 2020 2071 6c69 7374 2e73 6574 4375       qlist.setCu
-00088b10: 7272 656e 7452 6f77 2872 6f77 290d 0a20  rrentRow(row).. 
-00088b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00088b30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00088b40: 6172 616d 735b 315d 203d 202d 310d 0a20  arams[1] = -1.. 
-00088b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00088b60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00088b70: 716c 6973 7463 6861 6e67 6564 2e65 6d69  qlistchanged.emi
-00088b80: 7428 2872 6f77 2c70 6172 616d 7329 290d  t((row,params)).
-00088b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00088ba0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00088bb0: 662e 6c61 7465 7374 5f72 6f77 203d 2072  f.latest_row = r
-00088bc0: 6f77 0d0a 2020 2020 2020 2020 7265 7475  ow..        retu
-00088bd0: 726e 0d0a 2020 2020 6465 6620 714c 6973  rn..    def qLis
-00088be0: 7443 6861 6e67 6548 616e 646c 6572 2873  tChangeHandler(s
-00088bf0: 656c 662c 7061 7261 6d74 7570 293a 0d0a  elf,paramtup):..
-00088c00: 2020 2020 2020 2020 716c 6973 7420 3d20          qlist = 
-00088c10: 7365 6c66 2e4d 6170 5365 6c65 6374 5769  self.MapSelectWi
-00088c20: 6467 6574 310d 0a20 2020 2020 2020 2072  dget1..        r
-00088c30: 6f77 2c20 7061 7261 6d73 203d 2070 6172  ow, params = par
-00088c40: 616d 7475 700d 0a20 2020 2020 2020 2069  amtup..        i
-00088c50: 6620 7365 6c66 2e73 746b 2e73 6869 6674  f self.stk.shift
-00088c60: 735b 726f 775d 5b31 5d20 3d3d 2070 6172  s[row][1] == par
-00088c70: 616d 735b 315d 3a0d 0a20 2020 2020 2020  ams[1]:..       
-00088c80: 2020 2020 2023 7072 696e 7428 2264 6573       #print("des
-00088c90: 656c 6563 7420 6974 2122 290d 0a20 2020  elect it!")..   
-00088ca0: 2020 2020 2020 2020 2071 6c69 7374 2e69           qlist.i
-00088cb0: 7465 6d28 726f 7729 2e73 6574 4261 636b  tem(row).setBack
-00088cc0: 6772 6f75 6e64 2851 7447 7569 2e51 436f  ground(QtGui.QCo
-00088cd0: 6c6f 7228 302c 2030 2c20 302c 2030 2929  lor(0, 0, 0, 0))
-00088ce0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00088cf0: 6c66 2e73 746b 2e73 6869 6674 735b 726f  lf.stk.shifts[ro
-00088d00: 775d 5b31 5d20 3d20 300d 0a20 2020 2020  w][1] = 0..     
-00088d10: 2020 2065 6c69 6620 7365 6c66 2e73 746b     elif self.stk
-00088d20: 2e73 6869 6674 735b 726f 775d 5b31 5d20  .shifts[row][1] 
-00088d30: 213d 2070 6172 616d 735b 315d 2061 6e64  != params[1] and
-00088d40: 2070 6172 616d 735b 315d 203d 3d20 313a   params[1] == 1:
-00088d50: 2023 2073 656c 6563 7420 7269 6768 740d   # select right.
-00088d60: 0a20 2020 2020 2020 2020 2020 2023 7072  .            #pr
-00088d70: 696e 7428 2273 656c 6563 7420 7269 6768  int("select righ
-00088d80: 7421 2229 0d0a 2020 2020 2020 2020 2020  t!")..          
-00088d90: 2020 716c 6973 742e 6974 656d 2872 6f77    qlist.item(row
-00088da0: 292e 7365 7442 6163 6b67 726f 756e 6428  ).setBackground(
-00088db0: 5174 4775 692e 5143 6f6c 6f72 2827 2337  QtGui.QColor('#7
-00088dc0: 6663 3937 6627 2929 0d0a 2020 2020 2020  fc97f'))..      
-00088dd0: 2020 2020 2020 7365 6c66 2e73 746b 2e73        self.stk.s
-00088de0: 6869 6674 735b 726f 775d 5b31 5d20 3d20  hifts[row][1] = 
-00088df0: 310d 0a20 2020 2020 2020 2065 6c69 6620  1..        elif 
-00088e00: 7365 6c66 2e73 746b 2e73 6869 6674 735b  self.stk.shifts[
-00088e10: 726f 775d 5b31 5d20 213d 2070 6172 616d  row][1] != param
-00088e20: 735b 315d 2061 6e64 2070 6172 616d 735b  s[1] and params[
-00088e30: 315d 203d 3d20 2d31 3a20 2320 7365 6c65  1] == -1: # sele
-00088e40: 6374 206c 6566 740d 0a20 2020 2020 2020  ct left..       
-00088e50: 2020 2020 2023 7072 696e 7428 2273 656c       #print("sel
-00088e60: 6563 7420 6c65 6674 2122 290d 0a20 2020  ect left!")..   
-00088e70: 2020 2020 2020 2020 2071 6c69 7374 2e69           qlist.i
-00088e80: 7465 6d28 726f 7729 2e73 6574 4261 636b  tem(row).setBack
-00088e90: 6772 6f75 6e64 2851 7447 7569 2e51 436f  ground(QtGui.QCo
-00088ea0: 6c6f 7228 2723 6265 6165 6434 2729 290d  lor('#beaed4')).
-00088eb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00088ec0: 662e 7374 6b2e 7368 6966 7473 5b72 6f77  f.stk.shifts[row
-00088ed0: 5d5b 315d 203d 202d 310d 0a20 2020 2020  ][1] = -1..     
-00088ee0: 2020 2073 656c 662e 4f6e 5365 6c65 6374     self.OnSelect
-00088ef0: 696f 6e43 6861 6e67 6564 2829 0d0a 2020  ionChanged()..  
-00088f00: 2020 2020 2020 2370 7269 6e74 2872 6f77        #print(row
-00088f10: 2c20 7061 7261 6d73 290d 0a20 2020 2064  , params)..    d
-00088f20: 6566 204f 6e53 656c 6563 7469 6f6e 4368  ef OnSelectionCh
-00088f30: 616e 6765 6428 7365 6c66 293a 0d0a 2020  anged(self):..  
-00088f40: 2020 2020 2020 7365 6c66 2e70 7265 6c73        self.prels
-00088f50: 7420 3d20 5b69 6e64 6578 2066 6f72 2069  t = [index for i
-00088f60: 6e64 6578 2c20 7661 6c75 6520 696e 2065  ndex, value in e
-00088f70: 6e75 6d65 7261 7465 285b 785b 315d 2066  numerate([x[1] f
-00088f80: 6f72 2078 2069 6e20 2073 656c 662e 7374  or x in  self.st
-00088f90: 6b2e 7368 6966 7473 5d29 2069 6620 7661  k.shifts]) if va
-00088fa0: 6c75 6520 3d3d 202d 315d 0d0a 2020 2020  lue == -1]..    
-00088fb0: 2020 2020 7365 6c66 2e70 6f73 746c 7374      self.postlst
-00088fc0: 203d 205b 696e 6465 7820 666f 7220 696e   = [index for in
-00088fd0: 6465 782c 2076 616c 7565 2069 6e20 656e  dex, value in en
-00088fe0: 756d 6572 6174 6528 5b78 5b31 5d20 666f  umerate([x[1] fo
-00088ff0: 7220 7820 696e 2020 7365 6c66 2e73 746b  r x in  self.stk
-00089000: 2e73 6869 6674 735d 2920 6966 2076 616c  .shifts]) if val
-00089010: 7565 203d 3d20 315d 0d0a 2020 2020 2020  ue == 1]..      
-00089020: 2020 2370 7269 6e74 2873 656c 662e 7072    #print(self.pr
-00089030: 656c 7374 2c73 656c 662e 706f 7374 6c73  elst,self.postls
-00089040: 7429 0d0a 2020 2020 2020 2020 7365 6c66  t)..        self
-00089050: 2e4f 6e53 6372 6f6c 6c45 6e67 2873 656c  .OnScrollEng(sel
-00089060: 662e 4d61 7053 656c 6563 7457 6964 6765  f.MapSelectWidge
-00089070: 7431 2e63 7572 7265 6e74 526f 7728 2929  t1.currentRow())
-00089080: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-00089090: 2873 656c 662e 7072 656c 7374 2920 3d3d  (self.prelst) ==
-000890a0: 2030 206f 7220 6c65 6e28 7365 6c66 2e70   0 or len(self.p
-000890b0: 6f73 746c 7374 2920 3d3d 2030 3a0d 0a20  ostlst) == 0:.. 
-000890c0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-000890d0: 6e28 7365 6c66 2e70 7265 6c73 7420 2b20  n(self.prelst + 
-000890e0: 7365 6c66 2e70 6f73 746c 7374 2920 3d3d  self.postlst) ==
-000890f0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-00089100: 2020 2020 2073 656c 662e 7062 436c 7253       self.pbClrS
-00089110: 656c 2e73 6574 456e 6162 6c65 6428 4661  el.setEnabled(Fa
-00089120: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
-00089130: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00089140: 2020 2020 2020 2020 2073 656c 662e 7062           self.pb
-00089150: 436c 7253 656c 2e73 6574 456e 6162 6c65  ClrSel.setEnable
-00089160: 6428 5472 7565 290d 0a20 2020 2020 2020  d(True)..       
-00089170: 2020 2020 2073 656c 662e 7032 2e63 6c65       self.p2.cle
-00089180: 6172 2829 0d0a 2020 2020 2020 2020 2020  ar()..          
-00089190: 2020 7365 6c66 2e63 6d2e 636c 6561 7228    self.cm.clear(
-000891a0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-000891b0: 656c 662e 7032 2e74 6974 6c65 4c61 6265  elf.p2.titleLabe
-000891c0: 6c2e 7365 7454 6578 7428 223c 6365 6e74  l.setText("<cent
-000891d0: 6572 3e53 656c 6563 7420 6174 206c 6561  er>Select at lea
-000891e0: 7374 206f 6e65 2070 7265 2d20 616e 6420  st one pre- and 
-000891f0: 706f 7374 2d65 6467 6520 696d 6167 6521  post-edge image!
-00089200: 3c2f 6365 6e74 6572 3e22 2c73 697a 653d  </center>",size=
-00089210: 2731 3070 7427 290d 0a0d 0a20 2020 2020  '10pt')....     
-00089220: 2020 2020 2020 2073 656c 662e 4f44 4869         self.ODHi
-00089230: 6768 5370 696e 426f 782e 7365 7445 6e61  ghSpinBox.setEna
-00089240: 626c 6564 2846 616c 7365 290d 0a20 2020  bled(False)..   
-00089250: 2020 2020 2020 2020 2073 656c 662e 4f44           self.OD
-00089260: 4c6f 7753 7069 6e42 6f78 2e73 6574 456e  LowSpinBox.setEn
-00089270: 6162 6c65 6428 4661 6c73 6529 0d0a 2020  abled(False)..  
-00089280: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00089290: 6252 5354 4f44 2e73 6574 456e 6162 6c65  bRSTOD.setEnable
-000892a0: 6428 4661 6c73 6529 0d0a 2020 2020 2020  d(False)..      
-000892b0: 2020 2020 2020 7365 6c66 2e66 696c 7465        self.filte
-000892c0: 7253 7069 6e42 6f78 2e73 6574 456e 6162  rSpinBox.setEnab
-000892d0: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
-000892e0: 2020 2020 2020 2020 7365 6c66 2e70 6245          self.pbE
-000892f0: 7870 4461 7461 2e73 6574 456e 6162 6c65  xpData.setEnable
-00089300: 6428 4661 6c73 6529 0d0a 2020 2020 2020  d(False)..      
-00089310: 2020 2020 2020 7365 6c66 2e70 6245 7870        self.pbExp
-00089320: 496d 672e 7365 7445 6e61 626c 6564 2846  Img.setEnabled(F
-00089330: 616c 7365 290d 0a0d 0a20 2020 2020 2020  alse)....       
-00089340: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00089350: 2020 2020 7365 6c66 2e70 6243 6c72 5365      self.pbClrSe
-00089360: 6c2e 7365 7445 6e61 626c 6564 2854 7275  l.setEnabled(Tru
-00089370: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00089380: 2373 656c 662e 496e 6657 6172 6e69 6e67  #self.InfWarning
-00089390: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-000893a0: 2020 2020 2020 7365 6c66 2e53 686f 774d        self.ShowM
-000893b0: 6170 2873 656c 662e 7072 656c 7374 2c73  ap(self.prelst,s
-000893c0: 656c 662e 706f 7374 6c73 7429 0d0a 2020  elf.postlst)..  
-000893d0: 2020 2020 2020 2020 2020 2320 7365 6c66            # self
-000893e0: 2e4f 6e53 6372 6f6c 6c45 6e67 2873 656c  .OnScrollEng(sel
-000893f0: 662e 4d61 7053 656c 6563 7457 6964 6765  f.MapSelectWidge
-00089400: 7431 2e63 7572 7265 6e74 526f 7728 2929  t1.currentRow())
-00089410: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00089420: 6c66 2e4f 6e4d 6574 7269 6353 6361 6c65  lf.OnMetricScale
-00089430: 2873 656c 662e 4d65 7472 6963 4368 6563  (self.MetricChec
-00089440: 6b42 6f78 2e69 7343 6865 636b 6564 2829  kBox.isChecked()
-00089450: 2c20 7365 6c66 2e5a 6572 6f4f 7269 6769  , self.ZeroOrigi
-00089460: 6e43 6865 636b 426f 782e 6973 4368 6563  nCheckBox.isChec
-00089470: 6b65 6428 292c 0d0a 2020 2020 2020 2020  ked(),..        
-00089480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00089490: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000894a0: 2e53 7175 6172 6550 7843 6865 636b 426f  .SquarePxCheckBo
-000894b0: 782e 6973 4368 6563 6b65 6428 2929 0d0a  x.isChecked())..
-000894c0: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
-000894d0: 2020 2020 2320 2d2d 2d2d 2d2d 2d2d 2d2d      # ----------
-000894e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000894f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00089500: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00089510: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020  ------------..  
-00089520: 2020 6465 6620 4f6e 5361 7665 4461 7461    def OnSaveData
-00089530: 2873 656c 662c 6576 656e 7429 3a0d 0a20  (self,event):.. 
-00089540: 2020 2020 2020 2023 5361 7665 2044 6174         #Save Dat
-00089550: 610d 0a20 2020 2020 2020 2077 696c 6463  a..        wildc
-00089560: 6172 6420 3d20 2246 6c6f 6174 3332 2054  ard = "Float32 T
-00089570: 4946 4620 4669 6c65 2028 2a2e 7469 6629  IFF File (*.tif)
-00089580: 3b3b 5465 7874 496d 6167 6520 282a 2e74  ;;TextImage (*.t
-00089590: 7874 293b 3b22 0d0a 0d0a 2020 2020 2020  xt);;"....      
-000895a0: 2020 6669 6c65 4e61 6d65 2c20 5f66 696c    fileName, _fil
-000895b0: 7465 7220 3d20 5174 5769 6467 6574 732e  ter = QtWidgets.
-000895c0: 5146 696c 6544 6961 6c6f 672e 6765 7453  QFileDialog.getS
-000895d0: 6176 6546 696c 654e 616d 6528 7365 6c66  aveFileName(self
-000895e0: 2c20 2753 6176 6520 4f44 204d 6170 272c  , 'Save OD Map',
-000895f0: 2027 272c 2077 696c 6463 6172 6429 0d0a   '', wildcard)..
-00089600: 0d0a 2020 2020 2020 2020 6669 6c65 4e61  ..        fileNa
-00089610: 6d65 203d 2073 7472 2866 696c 654e 616d  me = str(fileNam
-00089620: 6529 0d0a 2020 2020 2020 2020 6966 2066  e)..        if f
-00089630: 696c 654e 616d 6520 3d3d 2027 273a 0d0a  ileName == '':..
-00089640: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00089650: 726e 0d0a 0d0a 2020 2020 2020 2020 7061  rn....        pa
-00089660: 7468 2c20 6578 7420 3d20 6f73 2e70 6174  th, ext = os.pat
-00089670: 682e 7370 6c69 7465 7874 2866 696c 654e  h.splitext(fileN
-00089680: 616d 6529 0d0a 2020 2020 2020 2020 6578  ame)..        ex
-00089690: 7420 3d20 6578 745b 313a 5d2e 6c6f 7765  t = ext[1:].lowe
-000896a0: 7228 290d 0a0d 0a20 2020 2020 2020 2069  r()....        i
-000896b0: 6620 6578 7420 213d 2027 7469 6627 2061  f ext != 'tif' a
-000896c0: 6e64 2065 7874 2021 3d20 2774 7874 273a  nd ext != 'txt':
-000896d0: 0d0a 2020 2020 2020 2020 2020 2020 6572  ..            er
-000896e0: 726f 725f 6d65 7373 6167 6520 3d20 280d  ror_message = (.
-000896f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00089700: 2020 2027 4f6e 6c79 2074 6865 2054 4946     'Only the TIF
-00089710: 2061 6e64 2054 5854 2064 6174 6120 666f   and TXT data fo
-00089720: 726d 6174 7320 6172 6520 7375 7070 6f72  rmats are suppor
-00089730: 7465 642e 5c6e 270d 0a20 2020 2020 2020  ted.\n'..       
-00089740: 2020 2020 2020 2020 2020 2741 2066 696c            'A fil
-00089750: 6520 6578 7465 6e73 696f 6e20 6f66 2060  e extension of `
-00089760: 7469 665c 2720 6f72 2060 7478 745c 2720  tif\' or `txt\' 
-00089770: 6d75 7374 2062 6520 7573 6564 2e27 290d  must be used.').
-00089780: 0a20 2020 2020 2020 2020 2020 2051 7457  .            QtW
-00089790: 6964 6765 7473 2e51 4d65 7373 6167 6542  idgets.QMessageB
-000897a0: 6f78 2e77 6172 6e69 6e67 2873 656c 662c  ox.warning(self,
-000897b0: 2027 4572 726f 7227 2c20 2745 7272 6f72   'Error', 'Error
-000897c0: 202d 2043 6f75 6c64 206e 6f74 2073 6176   - Could not sav
-000897d0: 6520 6669 6c65 2e27 290d 0a20 2020 2020  e file.')..     
-000897e0: 2020 2020 2020 2072 6574 7572 6e0d 0a0d         return...
-000897f0: 0a20 2020 2020 2020 2069 6620 6578 7420  .        if ext 
-00089800: 3d3d 2027 7469 6627 3a0d 0a20 2020 2020  == 'tif':..     
-00089810: 2020 2020 2020 2066 726f 6d20 5049 4c20         from PIL 
-00089820: 696d 706f 7274 2049 6d61 6765 0d0a 2020  import Image..  
-00089830: 2020 2020 2020 2020 2020 696d 6731 203d            img1 =
-00089840: 2049 6d61 6765 2e66 726f 6d61 7272 6179   Image.fromarray
-00089850: 286e 702e 726f 7439 3028 7365 6c66 2e4f  (np.rot90(self.O
-00089860: 4429 290d 0a20 2020 2020 2020 2020 2020  D))..           
-00089870: 2069 6d67 312e 7361 7665 2866 696c 654e   img1.save(fileN
-00089880: 616d 6529 0d0a 2020 2020 2020 2020 6966  ame)..        if
-00089890: 2065 7874 203d 3d20 2774 7874 273a 0d0a   ext == 'txt':..
-000898a0: 2020 2020 2020 2020 2020 2020 6e70 2e73              np.s
-000898b0: 6176 6574 7874 2866 696c 654e 616d 652c  avetxt(fileName,
-000898c0: 206e 702e 726f 7439 3028 7365 6c66 2e4f   np.rot90(self.O
-000898d0: 4429 2c20 6465 6c69 6d69 7465 723d 275c  D), delimiter='\
-000898e0: 7427 2c20 6e65 776c 696e 653d 275c 6e27  t', newline='\n'
-000898f0: 2c66 6d74 3d27 252e 3566 2729 0d0a 2020  ,fmt='%.5f')..  
-00089900: 2020 6465 6620 4f6e 436f 7079 2873 656c    def OnCopy(sel
-00089910: 6629 3a0d 0a20 2020 2020 2020 2073 656c  f):..        sel
-00089920: 662e 6578 7020 3d20 7067 2e65 7870 6f72  f.exp = pg.expor
-00089930: 7465 7273 2e49 6d61 6765 4578 706f 7274  ters.ImageExport
-00089940: 6572 2873 656c 662e 7067 6c61 796f 7574  er(self.pglayout
-00089950: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00089960: 6578 702e 6578 706f 7274 2863 6f70 793d  exp.export(copy=
-00089970: 5472 7565 290d 0a20 2020 2020 2020 2072  True)..        r
-00089980: 6574 7572 6e0d 0a20 2020 2064 6566 204f  eturn..    def O
-00089990: 6e53 6176 6549 6d61 6765 2873 656c 662c  nSaveImage(self,
-000899a0: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
-000899b0: 2020 2320 5361 7665 2049 6d61 6765 0d0a    # Save Image..
-000899c0: 2020 2020 2020 2020 7769 6c64 6361 7264          wildcard
-000899d0: 203d 2022 5449 4646 2028 2a2e 7469 6629   = "TIFF (*.tif)
-000899e0: 3b3b 504e 4720 282a 2e70 6e67 293b 3b4a  ;;PNG (*.png);;J
-000899f0: 5047 2028 2a2e 6a70 6729 3b3b 5356 4720  PG (*.jpg);;SVG 
-00089a00: 282a 2e73 7667 293b 3b22 0d0a 0d0a 2020  (*.svg);;"....  
-00089a10: 2020 2020 2020 6669 6c65 4e61 6d65 2c20        fileName, 
-00089a20: 5f66 696c 7465 7220 3d20 5174 5769 6467  _filter = QtWidg
-00089a30: 6574 732e 5146 696c 6544 6961 6c6f 672e  ets.QFileDialog.
-00089a40: 6765 7453 6176 6546 696c 654e 616d 6528  getSaveFileName(
-00089a50: 7365 6c66 2c20 2753 6176 6520 4f44 204d  self, 'Save OD M
-00089a60: 6170 272c 2027 272c 2077 696c 6463 6172  ap', '', wildcar
-00089a70: 6429 0d0a 0d0a 2020 2020 2020 2020 6669  d)....        fi
-00089a80: 6c65 4e61 6d65 203d 2073 7472 2866 696c  leName = str(fil
-00089a90: 654e 616d 6529 0d0a 2020 2020 2020 2020  eName)..        
-00089aa0: 6966 2066 696c 654e 616d 6520 3d3d 2027  if fileName == '
-00089ab0: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-00089ac0: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
-00089ad0: 2020 7061 7468 2c20 6578 7420 3d20 6f73    path, ext = os
-00089ae0: 2e70 6174 682e 7370 6c69 7465 7874 2866  .path.splitext(f
-00089af0: 696c 654e 616d 6529 0d0a 2020 2020 2020  ileName)..      
-00089b00: 2020 6578 7420 3d20 6578 745b 313a 5d2e    ext = ext[1:].
-00089b10: 6c6f 7765 7228 290d 0a0d 0a20 2020 2020  lower()....     
-00089b20: 2020 2070 6164 6469 6e67 203d 2031 3020     padding = 10 
-00089b30: 2023 2063 6c65 6172 616e 6365 2062 6574   # clearance bet
-00089b40: 7765 656e 204f 4420 636f 6c6f 7220 6261  ween OD color ba
-00089b50: 7220 616e 6420 7032 2069 6e20 7078 2075  r and p2 in px u
-00089b60: 6e69 7473 0d0a 2020 2020 2020 2020 7769  nits..        wi
-00089b70: 6474 6820 3d20 7365 6c66 2e70 322e 7369  dth = self.p2.si
-00089b80: 7a65 2829 2e77 6964 7468 2829 202b 2073  ze().width() + s
-00089b90: 656c 662e 636d 2e73 697a 6528 292e 7769  elf.cm.size().wi
-00089ba0: 6474 6828 290d 0a20 2020 2020 2020 2068  dth()..        h
-00089bb0: 6569 6768 7420 3d20 7365 6c66 2e70 322e  eight = self.p2.
-00089bc0: 7369 7a65 2829 2e68 6569 6768 7428 290d  size().height().
-00089bd0: 0a20 2020 2020 2020 2069 6620 6578 7420  .        if ext 
-00089be0: 3d3d 2027 7376 6727 3a0d 0a20 2020 2020  == 'svg':..     
-00089bf0: 2020 2020 2020 2070 3265 7870 203d 2070         p2exp = p
-00089c00: 672e 6578 706f 7274 6572 732e 5356 4745  g.exporters.SVGE
-00089c10: 7870 6f72 7465 7228 7365 6c66 2e70 3229  xporter(self.p2)
-00089c20: 0d0a 2020 2020 2020 2020 2020 2020 636d  ..            cm
-00089c30: 6578 7020 3d20 7067 2e65 7870 6f72 7465  exp = pg.exporte
-00089c40: 7273 2e53 5647 4578 706f 7274 6572 2873  rs.SVGExporter(s
-00089c50: 656c 662e 636d 290d 0a20 2020 2020 2020  elf.cm)..       
-00089c60: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00089c70: 2020 2020 7032 6578 7020 3d20 7067 2e65      p2exp = pg.e
-00089c80: 7870 6f72 7465 7273 2e49 6d61 6765 4578  xporters.ImageEx
-00089c90: 706f 7274 6572 2873 656c 662e 7032 290d  porter(self.p2).
-00089ca0: 0a20 2020 2020 2020 2020 2020 2063 6d65  .            cme
-00089cb0: 7870 203d 2070 672e 6578 706f 7274 6572  xp = pg.exporter
-00089cc0: 732e 496d 6167 6545 7870 6f72 7465 7228  s.ImageExporter(
-00089cd0: 7365 6c66 2e63 6d29 0d0a 2020 2020 2020  self.cm)..      
-00089ce0: 2020 7032 6578 7020 3d20 7032 6578 702e    p2exp = p2exp.
-00089cf0: 6578 706f 7274 2874 6f42 7974 6573 3d54  export(toBytes=T
-00089d00: 7275 6529 0d0a 2020 2020 2020 2020 636d  rue)..        cm
-00089d10: 6578 7020 3d20 636d 6578 702e 6578 706f  exp = cmexp.expo
-00089d20: 7274 2874 6f42 7974 6573 3d54 7275 6529  rt(toBytes=True)
-00089d30: 0d0a 2020 2020 2020 2020 6966 2065 7874  ..        if ext
-00089d40: 203d 3d20 2774 6966 2720 6f72 2065 7874   == 'tif' or ext
-00089d50: 203d 3d20 2770 6e67 2720 6f72 2065 7874   == 'png' or ext
-00089d60: 203d 3d20 276a 7067 273a 0d0a 2020 2020   == 'jpg':..    
-00089d70: 2020 2020 2020 2020 2320 5468 6520 7375          # The su
-00089d80: 6273 6571 7565 6e74 2063 6f64 6520 7761  bsequent code wa
-00089d90: 7320 7465 7374 6564 2077 6974 6820 7079  s tested with py
-00089da0: 7174 6772 6170 6820 302e 3131 2e30 6465  qtgraph 0.11.0de
-00089db0: 7630 203b 2070 7971 7467 7261 7068 203c  v0 ; pyqtgraph <
-00089dc0: 2030 2e31 312e 3020 7368 6f77 7320 6120   0.11.0 shows a 
-00089dd0: 5479 7065 4572 726f 723a 2027 666c 6f61  TypeError: 'floa
-00089de0: 7427 2e2e 2e0d 0a20 2020 2020 2020 2020  t'.....         
-00089df0: 2020 2023 2054 6f20 636f 6d62 696e 6520     # To combine 
-00089e00: 7365 6c66 2e70 3220 616e 6420 7365 6c66  self.p2 and self
-00089e10: 2e63 6d20 284f 4420 6261 7229 2069 6e20  .cm (OD bar) in 
-00089e20: 6120 7369 6e67 6c65 2069 6d61 6765 2c20  a single image, 
-00089e30: 7468 6520 7477 6f20 5149 6d61 6765 206f  the two QImage o
-00089e40: 626a 6563 7473 2061 7265 2072 6564 7261  bjects are redra
-00089e50: 776e 2075 7369 6e67 2061 2051 5061 696e  wn using a QPain
-00089e60: 7465 7220 6f62 6a65 6374 2e0d 0a20 2020  ter object...   
-00089e70: 2020 2020 2020 2020 2023 2049 6620 7365           # If se
-00089e80: 6c66 2e63 6d20 6973 206e 6f74 206e 6565  lf.cm is not nee
-00089e90: 6465 642c 2074 6865 2066 6f6c 6c6f 7769  ded, the followi
-00089ea0: 6e67 2074 776f 206c 696e 6573 2061 7265  ng two lines are
-00089eb0: 2073 7566 6669 6369 656e 743a 0d0a 2020   sufficient:..  
-00089ec0: 2020 2020 2020 2020 2020 2320 2020 7032            #   p2
-00089ed0: 6578 7020 3d20 7067 2e65 7870 6f72 7465  exp = pg.exporte
-00089ee0: 7273 2e49 6d61 6765 4578 706f 7274 6572  rs.ImageExporter
-00089ef0: 2873 656c 662e 7032 290d 0a20 2020 2020  (self.p2)..     
-00089f00: 2020 2020 2020 2023 2020 2070 3265 7870         #   p2exp
-00089f10: 2e65 7870 6f72 7428 4669 6c65 4e61 6d65  .export(FileName
-00089f20: 290d 0a20 2020 2020 2020 2020 2020 2071  )..            q
-00089f30: 696d 6720 3d20 5174 4775 692e 5149 6d61  img = QtGui.QIma
-00089f40: 6765 2877 6964 7468 202b 2070 6164 6469  ge(width + paddi
-00089f50: 6e67 2c20 6865 6967 6874 2c20 5174 4775  ng, height, QtGu
-00089f60: 692e 5149 6d61 6765 2e46 6f72 6d61 745f  i.QImage.Format_
-00089f70: 4152 4742 3332 290d 0a20 2020 2020 2020  ARGB32)..       
-00089f80: 2020 2020 2069 6620 6578 7420 3d3d 2027       if ext == '
-00089f90: 6a70 6727 3a0d 0a20 2020 2020 2020 2020  jpg':..         
-00089fa0: 2020 2020 2020 2071 696d 672e 6669 6c6c         qimg.fill
-00089fb0: 2851 7447 7569 2e51 436f 6c6f 7228 3235  (QtGui.QColor(25
-00089fc0: 352c 2032 3535 2c20 3235 352c 2032 3535  5, 255, 255, 255
-00089fd0: 2929 3b20 2320 4247 2077 6869 7465 2069  )); # BG white i
-00089fe0: 6620 6578 706f 7274 2061 7320 6a70 670d  f export as jpg.
-00089ff0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0008a000: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0008a010: 2020 2020 7169 6d67 2e66 696c 6c28 5174      qimg.fill(Qt
-0008a020: 4775 692e 5143 6f6c 6f72 2830 2c20 302c  Gui.QColor(0, 0,
-0008a030: 2030 2c20 3029 293b 0d0a 2020 2020 2020   0, 0));..      
-0008a040: 2020 2020 2020 7061 696e 7465 7220 3d20        painter = 
-0008a050: 5174 4775 692e 5150 6169 6e74 6572 2829  QtGui.QPainter()
-0008a060: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
-0008a070: 696e 7465 722e 6265 6769 6e28 7169 6d67  inter.begin(qimg
-0008a080: 290d 0a20 2020 2020 2020 2020 2020 2070  )..            p
-0008a090: 6169 6e74 6572 2e64 7261 7749 6d61 6765  ainter.drawImage
-0008a0a0: 2830 2c20 302c 2070 3265 7870 290d 0a20  (0, 0, p2exp).. 
-0008a0b0: 2020 2020 2020 2020 2020 2070 6169 6e74             paint
-0008a0c0: 6572 2e64 7261 7749 6d61 6765 2870 3265  er.drawImage(p2e
-0008a0d0: 7870 2e73 697a 6528 292e 7769 6474 6828  xp.size().width(
-0008a0e0: 2920 2b20 7061 6464 696e 672c 2030 2c20  ) + padding, 0, 
-0008a0f0: 636d 6578 7029 0d0a 2020 2020 2020 2020  cmexp)..        
-0008a100: 2020 2020 7061 696e 7465 722e 656e 6428      painter.end(
-0008a110: 290d 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0008a120: 7069 786d 6170 203d 2051 5069 786d 6170  pixmap = QPixmap
-0008a130: 2e66 726f 6d49 6d61 6765 2874 696c 6529  .fromImage(tile)
-0008a140: 0d0a 2020 2020 2020 2020 2020 2020 2351  ..            #Q
-0008a150: 436f 7265 4170 706c 6963 6174 696f 6e2e  CoreApplication.
-0008a160: 696e 7374 616e 6365 2829 2e63 6c69 7062  instance().clipb
-0008a170: 6f61 7264 2829 2e73 6574 496d 6167 6528  oard().setImage(
-0008a180: 7169 6d67 290d 0a20 2020 2020 2020 2020  qimg)..         
-0008a190: 2020 2071 696d 672e 7361 7665 2866 696c     qimg.save(fil
-0008a1a0: 654e 616d 652c 7175 616c 6974 793d 3130  eName,quality=10
-0008a1b0: 3029 0d0a 2020 2020 2020 2020 656c 6966  0)..        elif
-0008a1c0: 2065 7874 203d 3d20 2773 7667 273a 0d0a   ext == 'svg':..
-0008a1d0: 2020 2020 2020 2020 2020 2020 6669 6731              fig1
-0008a1e0: 203d 2073 656c 662e 5356 4743 6c69 7050   = self.SVGClipP
-0008a1f0: 6174 6852 656d 6f76 6572 2865 7472 6565  athRemover(etree
-0008a200: 2e66 726f 6d73 7472 696e 6728 7032 6578  .fromstring(p2ex
-0008a210: 7029 290d 0a20 2020 2020 2020 2020 2020  p))..           
-0008a220: 2066 6967 3220 3d20 7365 6c66 2e53 5647   fig2 = self.SVG
-0008a230: 436c 6970 5061 7468 5265 6d6f 7665 7228  ClipPathRemover(
-0008a240: 6574 7265 652e 6672 6f6d 7374 7269 6e67  etree.fromstring
-0008a250: 2863 6d65 7870 2929 0d0a 2020 2020 2020  (cmexp))..      
-0008a260: 2020 2020 2020 6d65 7267 6564 6669 6720        mergedfig 
-0008a270: 3d20 7365 6c66 2e53 5647 4d65 7267 6572  = self.SVGMerger
-0008a280: 2866 6967 312c 6669 6732 2c73 656c 662e  (fig1,fig2,self.
-0008a290: 7032 2e73 697a 6528 292e 7769 6474 6828  p2.size().width(
-0008a2a0: 292c 2073 656c 662e 636d 2e73 697a 6528  ), self.cm.size(
-0008a2b0: 292e 7769 6474 6828 292c 6865 6967 6874  ).width(),height
-0008a2c0: 2c70 6164 6469 6e67 290d 0a20 2020 2020  ,padding)..     
-0008a2d0: 2020 2020 2020 206f 7574 203d 2065 7472         out = etr
-0008a2e0: 6565 2e74 6f73 7472 696e 6728 6d65 7267  ee.tostring(merg
-0008a2f0: 6564 6669 672c 2078 6d6c 5f64 6563 6c61  edfig, xml_decla
-0008a300: 7261 7469 6f6e 3d54 7275 652c 0d0a 2020  ration=True,..  
-0008a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008a320: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0008a330: 7461 6e64 616c 6f6e 653d 5472 7565 2c0d  tandalone=True,.
-0008a340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008a350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008a360: 2020 7072 6574 7479 5f70 7269 6e74 3d54    pretty_print=T
-0008a370: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
-0008a380: 2020 7769 7468 206f 7065 6e28 6669 6c65    with open(file
-0008a390: 4e61 6d65 2c20 2777 6227 2920 6173 2073  Name, 'wb') as s
-0008a3a0: 7667 3a0d 0a20 2020 2020 2020 2020 2020  vg:..           
-0008a3b0: 2020 2020 2073 7667 2e77 7269 7465 286f       svg.write(o
-0008a3c0: 7574 290d 0a20 2020 2064 6566 2053 5647  ut)..    def SVG
-0008a3d0: 4d65 7267 6572 2873 656c 662c 2073 7667  Merger(self, svg
-0008a3e0: 312c 2073 7667 322c 2077 6964 7468 312c  1, svg2, width1,
-0008a3f0: 7769 6474 6832 2c20 6865 6967 6874 2c20  width2, height, 
-0008a400: 7061 6464 696e 673d 3029 3a20 236d 6572  padding=0): #mer
-0008a410: 6765 7320 7477 6f20 6c78 6d6c 2e65 7472  ges two lxml.etr
-0008a420: 6565 2065 6c65 6d65 6e74 7320 686f 7269  ee elements hori
-0008a430: 7a6f 6e74 616c 6c79 2077 6974 6820 7061  zontally with pa
-0008a440: 6464 696e 670d 0a20 2020 2020 2020 206e  dding..        n
-0008a450: 7320 3d20 7b27 273a 2073 7667 312e 7461  s = {'': svg1.ta
-0008a460: 672e 7370 6c69 7428 277d 2729 5b30 5d2e  g.split('}')[0].
-0008a470: 7374 7269 7028 277b 2729 7d0d 0a20 2020  strip('{')}..   
-0008a480: 2020 2020 2073 7667 203d 2065 7472 6565       svg = etree
-0008a490: 2e45 6c65 6d65 6e74 2873 7667 312e 7461  .Element(svg1.ta
-0008a4a0: 672c 206e 736d 6170 3d7b 4e6f 6e65 3a20  g, nsmap={None: 
-0008a4b0: 2768 7474 703a 2f2f 7777 772e 7733 2e6f  'http://www.w3.o
-0008a4c0: 7267 2f32 3030 302f 7376 6727 2c20 2778  rg/2000/svg', 'x
-0008a4d0: 6c69 6e6b 273a 2027 6874 7470 3a2f 2f77  link': 'http://w
-0008a4e0: 7777 2e77 332e 6f72 672f 3139 3939 2f78  ww.w3.org/1999/x
-0008a4f0: 6c69 6e6b 277d 290d 0a20 2020 2020 2020  link'})..       
-0008a500: 2073 7667 2e73 6574 2822 7665 7273 696f   svg.set("versio
-0008a510: 6e22 2c20 2231 2e32 2229 0d0a 2020 2020  n", "1.2")..    
-0008a520: 2020 2020 7376 672e 7365 7428 2777 6964      svg.set('wid
-0008a530: 7468 272c 2073 7472 2877 6964 7468 3120  th', str(width1 
-0008a540: 2b20 7769 6474 6832 202b 2070 6164 6469  + width2 + paddi
-0008a550: 6e67 292b 2270 7822 2920 2374 6172 6765  ng)+"px") #targe
-0008a560: 7420 7769 6474 680d 0a20 2020 2020 2020  t width..       
-0008a570: 2073 7667 2e73 6574 2827 6865 6967 6874   svg.set('height
-0008a580: 272c 2073 7472 2868 6569 6768 7429 2b22  ', str(height)+"
-0008a590: 7078 2229 2023 7461 7267 6574 2068 6569  px") #target hei
-0008a5a0: 6768 740d 0a20 2020 2020 2020 2073 7667  ght..        svg
-0008a5b0: 2e73 6574 2822 7669 6577 426f 7822 2c20  .set("viewBox", 
-0008a5c0: 2230 2030 2025 7320 2573 2220 2520 2873  "0 0 %s %s" % (s
-0008a5d0: 7472 2877 6964 7468 3120 2b20 7769 6474  tr(width1 + widt
-0008a5e0: 6832 202b 7061 6464 696e 6729 2b22 7078  h2 +padding)+"px
-0008a5f0: 222c 2073 7472 2868 6569 6768 7429 2b22  ", str(height)+"
-0008a600: 7078 2229 290d 0a20 2020 2020 2020 2067  px"))..        g
-0008a610: 3120 3d20 6574 7265 652e 5375 6245 6c65  1 = etree.SubEle
-0008a620: 6d65 6e74 2873 7667 2c20 2767 2729 0d0a  ment(svg, 'g')..
-0008a630: 2020 2020 2020 2020 6731 2e61 7070 656e          g1.appen
-0008a640: 6428 7376 6731 2e66 696e 6428 272e 2f67  d(svg1.find('./g
-0008a650: 272c 206e 7329 290d 0a20 2020 2020 2020  ', ns))..       
-0008a660: 2067 203d 2065 7472 6565 2e53 7562 456c   g = etree.SubEl
-0008a670: 656d 656e 7428 6731 2c20 2767 2729 0d0a  ement(g1, 'g')..
-0008a680: 2020 2020 2020 2020 672e 7365 7428 2774          g.set('t
-0008a690: 7261 6e73 666f 726d 272c 2774 7261 6e73  ransform','trans
-0008a6a0: 6c61 7465 2827 2b73 7472 2877 6964 7468  late('+str(width
-0008a6b0: 3120 2b20 7061 6464 696e 6729 2b27 2c20  1 + padding)+', 
-0008a6c0: 3029 2073 6361 6c65 2831 2927 290d 0a20  0) scale(1)').. 
-0008a6d0: 2020 2020 2020 2067 2e61 7070 656e 6428         g.append(
-0008a6e0: 7376 6732 2e66 696e 6428 272e 2f67 272c  svg2.find('./g',
-0008a6f0: 206e 7329 290d 0a20 2020 2020 2020 2072   ns))..        r
-0008a700: 6574 7572 6e20 7376 670d 0a20 2020 2064  eturn svg..    d
-0008a710: 6566 2053 5647 436c 6970 5061 7468 5265  ef SVGClipPathRe
-0008a720: 6d6f 7665 7228 7365 6c66 2c20 656c 656d  mover(self, elem
-0008a730: 293a 2023 7461 6b65 7320 6574 7265 6520  ): #takes etree 
-0008a740: 656c 656d 656e 7473 2061 6e64 2072 656d  elements and rem
-0008a750: 6f76 6573 2063 6c69 702d 7061 7468 2074  oves clip-path t
-0008a760: 6167 7320 616e 6420 6b65 7973 2069 6e73  ags and keys ins
-0008a770: 6964 6520 6720 7461 6773 2069 6620 7072  ide g tags if pr
-0008a780: 6573 656e 742e 0d0a 2020 2020 2020 2020  esent...        
-0008a790: 6e73 203d 207b 2727 3a20 656c 656d 2e74  ns = {'': elem.t
-0008a7a0: 6167 2e73 706c 6974 2827 7d27 295b 305d  ag.split('}')[0]
-0008a7b0: 2e73 7472 6970 2827 7b27 297d 0d0a 2020  .strip('{')}..  
-0008a7c0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-0008a7d0: 2020 2020 2020 2020 666f 7220 636c 6970          for clip
-0008a7e0: 7061 7468 2069 6e20 656c 656d 2e66 696e  path in elem.fin
-0008a7f0: 6461 6c6c 2822 2e2f 2f63 6c69 7050 6174  dall(".//clipPat
-0008a800: 6822 2c20 6e73 293a 0d0a 2020 2020 2020  h", ns):..      
-0008a810: 2020 2020 2020 2020 2020 636c 6970 7061            clippa
-0008a820: 7468 2e67 6574 7061 7265 6e74 2829 2e72  th.getparent().r
-0008a830: 656d 6f76 6528 636c 6970 7061 7468 290d  emove(clippath).
-0008a840: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
-0008a850: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
-0008a860: 7373 0d0a 2020 2020 2020 2020 7472 793a  ss..        try:
-0008a870: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-0008a880: 7220 6720 696e 2065 6c65 6d2e 6669 6e64  r g in elem.find
-0008a890: 616c 6c28 222e 2f2f 6722 2c20 6e73 293a  all(".//g", ns):
-0008a8a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0008a8b0: 2020 6966 2067 2e6b 6579 7328 295b 305d    if g.keys()[0]
-0008a8c0: 203d 3d20 2263 6c69 702d 7061 7468 223a   == "clip-path":
-0008a8d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0008a8e0: 2020 2020 2020 6465 6c20 672e 6174 7472        del g.attr
-0008a8f0: 6962 5b27 636c 6970 2d70 6174 6827 5d0d  ib['clip-path'].
-0008a900: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
-0008a910: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
-0008a920: 7373 0d0a 2020 2020 2020 2020 7265 7475  ss..        retu
-0008a930: 726e 2065 6c65 6d0d 0a0d 0a20 2020 2064  rn elem....    d
-0008a940: 6566 204f 6e43 6174 4368 616e 6765 6428  ef OnCatChanged(
-0008a950: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-0008a960: 7365 6c66 2e43 4d4d 6170 426f 782e 626c  self.CMMapBox.bl
-0008a970: 6f63 6b53 6967 6e61 6c73 2854 7275 6529  ockSignals(True)
-0008a980: 0d0a 2020 2020 2020 2020 7365 6c66 2e43  ..        self.C
-0008a990: 4d4d 6170 426f 782e 636c 6561 7228 290d  MMapBox.clear().
-0008a9a0: 0a20 2020 2020 2020 2073 656c 662e 434d  .        self.CM
-0008a9b0: 4d61 7042 6f78 2e62 6c6f 636b 5369 676e  MapBox.blockSign
-0008a9c0: 616c 7328 4661 6c73 6529 0d0a 2020 2020  als(False)..    
-0008a9d0: 2020 2020 7365 6c66 2e43 4d4d 6170 426f      self.CMMapBo
-0008a9e0: 782e 6164 6449 7465 6d73 2873 656c 662e  x.addItems(self.
-0008a9f0: 636d 6170 735b 7365 6c66 2e43 4d43 6174  cmaps[self.CMCat
-0008aa00: 426f 782e 6375 7272 656e 7449 6e64 6578  Box.currentIndex
-0008aa10: 2829 5d5b 315d 290d 0a0d 0a20 2020 2064  ()][1])....    d
-0008aa20: 6566 2073 6574 4f44 6c69 6d69 7473 2873  ef setODlimits(s
-0008aa30: 656c 662c 6c6f 772c 2068 6967 6829 3a0d  elf,low, high):.
-0008aa40: 0a20 2020 2020 2020 2073 656c 662e 4f44  .        self.OD
-0008aa50: 4869 6768 5370 696e 426f 782e 7365 744d  HighSpinBox.setM
-0008aa60: 6178 696d 756d 2873 656c 662e 4f44 6d61  aximum(self.ODma
-0008aa70: 7829 0d0a 2020 2020 2020 2020 7365 6c66  x)..        self
-0008aa80: 2e4f 4448 6967 6853 7069 6e42 6f78 2e73  .ODHighSpinBox.s
-0008aa90: 6574 4d69 6e69 6d75 6d28 6c6f 7729 0d0a  etMinimum(low)..
-0008aaa0: 2020 2020 2020 2020 7365 6c66 2e4f 444c          self.ODL
-0008aab0: 6f77 5370 696e 426f 782e 7365 744d 6178  owSpinBox.setMax
-0008aac0: 696d 756d 2868 6967 6829 0d0a 2020 2020  imum(high)..    
-0008aad0: 2020 2020 7365 6c66 2e4f 444c 6f77 5370      self.ODLowSp
-0008aae0: 696e 426f 782e 7365 744d 696e 696d 756d  inBox.setMinimum
-0008aaf0: 2873 656c 662e 4f44 6d69 6e29 0d0a 2020  (self.ODmin)..  
-0008ab00: 2020 2020 2020 4f44 203d 206e 702e 636c        OD = np.cl
-0008ab10: 6970 2873 656c 662e 4f44 2c6c 6f77 2c68  ip(self.OD,low,h
-0008ab20: 6967 6829 0d0a 2020 2020 2020 2020 7365  igh)..        se
-0008ab30: 6c66 2e4f 6e43 6f6c 6f72 6d61 7028 6d61  lf.OnColormap(ma
-0008ab40: 703d 7365 6c66 2e43 4d4d 6170 426f 782e  p=self.CMMapBox.
-0008ab50: 6375 7272 656e 7454 6578 7428 292c 2063  currentText(), c
-0008ab60: 6f6c 6f72 733d 7365 6c66 2e53 7465 7053  olors=self.StepS
-0008ab70: 7069 6e2e 7661 6c75 6528 2929 0d0a 2020  pin.value())..  
-0008ab80: 2020 2020 2020 7365 6c66 2e73 6574 4f44        self.setOD
-0008ab90: 6261 7228 6c6f 772c 2068 6967 6829 0d0a  bar(low, high)..
-0008aba0: 2020 2020 2020 2020 7365 6c66 2e6d 5f69          self.m_i
-0008abb0: 7465 6d2e 7365 7449 6d61 6765 284f 4429  tem.setImage(OD)
-0008abc0: 0d0a 2020 2020 6465 6620 7365 7443 726f  ..    def setCro
-0008abd0: 7373 6861 6972 2873 656c 6629 3a0d 0a20  sshair(self):.. 
-0008abe0: 2020 2020 2020 2069 6620 6861 7361 7474         if hasatt
-0008abf0: 7228 7365 6c66 2c20 2776 4c69 6e65 2729  r(self, 'vLine')
-0008ac00: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0008ac10: 656c 662e 7032 2e72 656d 6f76 6549 7465  elf.p2.removeIte
-0008ac20: 6d28 7365 6c66 2e76 4c69 6e65 290d 0a20  m(self.vLine).. 
-0008ac30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0008ac40: 7032 2e72 656d 6f76 6549 7465 6d28 7365  p2.removeItem(se
-0008ac50: 6c66 2e76 4c69 6e65 290d 0a20 2020 2020  lf.vLine)..     
-0008ac60: 2020 2020 2020 2073 656c 662e 6361 6e76         self.canv
-0008ac70: 6173 2e72 656d 6f76 6549 7465 6d28 7365  as.removeItem(se
-0008ac80: 6c66 2e4f 446c 6162 656c 290d 0a0d 0a20  lf.ODlabel).... 
-0008ac90: 2020 2020 2020 2073 656c 662e 764c 696e         self.vLin
-0008aca0: 6520 3d20 7067 2e49 6e66 696e 6974 654c  e = pg.InfiniteL
-0008acb0: 696e 6528 616e 676c 653d 3930 2c20 6d6f  ine(angle=90, mo
-0008acc0: 7661 626c 653d 4661 6c73 652c 2070 656e  vable=False, pen
-0008acd0: 3d22 3030 3030 2229 0d0a 2020 2020 2020  ="0000")..      
-0008ace0: 2020 7365 6c66 2e68 4c69 6e65 203d 2070    self.hLine = p
-0008acf0: 672e 496e 6669 6e69 7465 4c69 6e65 2861  g.InfiniteLine(a
-0008ad00: 6e67 6c65 3d30 2c20 6d6f 7661 626c 653d  ngle=0, movable=
-0008ad10: 4661 6c73 652c 7065 6e3d 2230 3030 3022  False,pen="0000"
-0008ad20: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0008ad30: 4f44 6c61 6265 6c20 3d20 7067 2e4c 6162  ODlabel = pg.Lab
-0008ad40: 656c 4974 656d 286a 7573 7469 6679 3d22  elItem(justify="
-0008ad50: 6c65 6674 2229 0d0a 2020 2020 2020 2020  left")..        
-0008ad60: 7365 6c66 2e63 616e 7661 732e 6164 6449  self.canvas.addI
-0008ad70: 7465 6d28 7365 6c66 2e4f 446c 6162 656c  tem(self.ODlabel
-0008ad80: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0008ad90: 7032 2e61 6464 4974 656d 2873 656c 662e  p2.addItem(self.
-0008ada0: 764c 696e 652c 2069 676e 6f72 6542 6f75  vLine, ignoreBou
-0008adb0: 6e64 733d 5472 7565 290d 0a20 2020 2020  nds=True)..     
-0008adc0: 2020 2073 656c 662e 7032 2e61 6464 4974     self.p2.addIt
-0008add0: 656d 2873 656c 662e 684c 696e 652c 2069  em(self.hLine, i
-0008ade0: 676e 6f72 6542 6f75 6e64 733d 5472 7565  gnoreBounds=True
-0008adf0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0008ae00: 7072 6f78 7920 3d20 7067 2e53 6967 6e61  proxy = pg.Signa
-0008ae10: 6c50 726f 7879 2873 656c 662e 7032 2e73  lProxy(self.p2.s
-0008ae20: 6365 6e65 2829 2e73 6967 4d6f 7573 654d  cene().sigMouseM
-0008ae30: 6f76 6564 2c20 7261 7465 4c69 6d69 743d  oved, rateLimit=
-0008ae40: 3330 2c20 736c 6f74 3d73 656c 662e 4f6e  30, slot=self.On
-0008ae50: 4d6f 7573 6548 6f76 6572 290d 0a0d 0a20  MouseHover).... 
-0008ae60: 2020 2064 6566 204f 6e4d 6f75 7365 486f     def OnMouseHo
-0008ae70: 7665 7228 7365 6c66 2c65 7674 293a 0d0a  ver(self,evt):..
-0008ae80: 2020 2020 2020 2020 706f 7320 3d20 6576          pos = ev
-0008ae90: 745b 305d 0d0a 2020 2020 2020 2020 2370  t[0]..        #p
-0008aea0: 7269 6e74 2870 6f73 290d 0a20 2020 2020  rint(pos)..     
-0008aeb0: 2020 2069 6620 6861 7361 7474 7228 7365     if hasattr(se
-0008aec0: 6c66 2c20 274f 4427 293a 0d0a 2020 2020  lf, 'OD'):..    
-0008aed0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0008aee0: 7032 2e67 6574 5669 6577 426f 7828 292e  p2.getViewBox().
-0008aef0: 6974 656d 426f 756e 6469 6e67 5265 6374  itemBoundingRect
-0008af00: 2873 656c 662e 6d5f 6974 656d 292e 636f  (self.m_item).co
-0008af10: 6e74 6169 6e73 2873 656c 662e 7032 2e67  ntains(self.p2.g
-0008af20: 6574 5669 6577 426f 7828 292e 6d61 7053  etViewBox().mapS
-0008af30: 6365 6e65 546f 5669 6577 2870 6f73 2929  ceneToView(pos))
-0008af40: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0008af50: 2020 2073 656c 662e 764c 696e 652e 7365     self.vLine.se
-0008af60: 7450 656e 2822 7222 290d 0a20 2020 2020  tPen("r")..     
-0008af70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0008af80: 684c 696e 652e 7365 7450 656e 2822 7222  hLine.setPen("r"
-0008af90: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0008afa0: 2020 2073 656c 662e 764c 696e 652e 7365     self.vLine.se
-0008afb0: 745a 5661 6c75 6528 3130 3030 290d 0a20  tZValue(1000).. 
-0008afc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0008afd0: 656c 662e 684c 696e 652e 7365 745a 5661  elf.hLine.setZVa
-0008afe0: 6c75 6528 3130 3030 290d 0a20 2020 2020  lue(1000)..     
-0008aff0: 2020 2020 2020 2020 2020 206d 6f75 7365             mouse
-0008b000: 506f 696e 7420 3d20 7365 6c66 2e70 322e  Point = self.p2.
-0008b010: 6765 7456 6965 7742 6f78 2829 2e6d 6170  getViewBox().map
-0008b020: 5363 656e 6554 6f56 6965 7728 706f 7329  SceneToView(pos)
+00086570: 2020 2020 2020 2020 2020 2027 5061 7374             'Past
+00086580: 656c 3127 2c20 2750 6173 7465 6c32 272c  el1', 'Pastel2',
+00086590: 2027 5061 6972 6564 272c 2027 4163 6365   'Paired', 'Acce
+000865a0: 6e74 272c 0d0a 2020 2020 2020 2020 2020  nt',..          
+000865b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000865c0: 2744 6172 6b32 272c 2027 5365 7431 272c  'Dark2', 'Set1',
+000865d0: 2027 5365 7432 272c 2027 5365 7433 272c   'Set2', 'Set3',
+000865e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000865f0: 2020 2020 2020 2020 2020 2020 2774 6162              'tab
+00086600: 3130 272c 2027 7461 6232 3027 2c20 2774  10', 'tab20', 't
+00086610: 6162 3230 6227 2c20 2774 6162 3230 6327  ab20b', 'tab20c'
+00086620: 5d29 2c0d 0a20 2020 2020 2020 2020 2020  ]),..           
+00086630: 2020 2020 2020 2020 2020 2028 274d 6973             ('Mis
+00086640: 6365 6c6c 616e 656f 7573 272c 205b 0d0a  cellaneous', [..
+00086650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00086660: 2020 2020 2020 2020 2020 2766 6c61 6727            'flag'
+00086670: 2c20 2770 7269 736d 272c 2027 6f63 6561  , 'prism', 'ocea
+00086680: 6e27 2c20 2767 6973 745f 6561 7274 6827  n', 'gist_earth'
+00086690: 2c20 2774 6572 7261 696e 272c 2027 6769  , 'terrain', 'gi
+000866a0: 7374 5f73 7465 726e 272c 0d0a 2020 2020  st_stern',..    
+000866b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000866c0: 2020 2020 2020 2767 6e75 706c 6f74 272c        'gnuplot',
+000866d0: 2027 676e 7570 6c6f 7432 272c 2027 434d   'gnuplot2', 'CM
+000866e0: 526d 6170 272c 2027 6375 6265 6865 6c69  Rmap', 'cubeheli
+000866f0: 7827 2c20 2762 7267 272c 2027 6873 7627  x', 'brg', 'hsv'
+00086700: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00086710: 2020 2020 2020 2020 2020 2020 2027 6769               'gi
+00086720: 7374 5f72 6169 6e62 6f77 272c 2027 7261  st_rainbow', 'ra
+00086730: 696e 626f 7727 2c20 276a 6574 272c 2027  inbow', 'jet', '
+00086740: 6e69 7079 5f73 7065 6374 7261 6c27 2c20  nipy_spectral', 
+00086750: 2767 6973 745f 6e63 6172 275d 295d 0d0a  'gist_ncar'])]..
+00086760: 2020 2020 2020 2020 7365 6c66 2e69 6e69          self.ini
+00086770: 7455 4928 636f 6d6d 6f6e 2c20 6461 7461  tUI(common, data
+00086780: 5f73 7472 7563 742c 2073 7461 636b 290d  _struct, stack).
+00086790: 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ...#------------
+000867a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000867b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000867c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000867d0: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
+000867e0: 6465 6620 696e 6974 5549 2873 656c 662c  def initUI(self,
+000867f0: 2063 6f6d 6d6f 6e2c 2064 6174 615f 7374   common, data_st
+00086800: 7275 6374 2c20 7374 6163 6b29 3a0d 0a20  ruct, stack):.. 
+00086810: 2020 2020 2020 2073 656c 662e 786f 6666         self.xoff
+00086820: 7365 7420 3d20 300d 0a20 2020 2020 2020  set = 0..       
+00086830: 2073 656c 662e 796f 6666 7365 7420 3d20   self.yoffset = 
+00086840: 300d 0a20 2020 2020 2020 2073 656c 662e  0..        self.
+00086850: 7363 616c 6520 3d20 302e 3030 3030 3031  scale = 0.000001
+00086860: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00086870: 6252 5354 2e63 6c69 636b 6564 2e63 6f6e  bRST.clicked.con
+00086880: 6e65 6374 286c 616d 6264 613a 2073 656c  nect(lambda: sel
+00086890: 662e 7365 7453 6869 6674 7328 302c 2030  f.setShifts(0, 0
+000868a0: 2929 0d0a 2020 2020 2020 2020 7365 6c66  ))..        self
+000868b0: 2e70 624c 2e63 6c69 636b 6564 2e63 6f6e  .pbL.clicked.con
+000868c0: 6e65 6374 286c 616d 6264 613a 2073 656c  nect(lambda: sel
+000868d0: 662e 7365 7453 6869 6674 7328 2d30 2e32  f.setShifts(-0.2
+000868e0: 2c30 2929 0d0a 2020 2020 2020 2020 7365  ,0))..        se
+000868f0: 6c66 2e70 6252 2e63 6c69 636b 6564 2e63  lf.pbR.clicked.c
+00086900: 6f6e 6e65 6374 286c 616d 6264 613a 2073  onnect(lambda: s
+00086910: 656c 662e 7365 7453 6869 6674 7328 302e  elf.setShifts(0.
+00086920: 322c 3029 290d 0a20 2020 2020 2020 2073  2,0))..        s
+00086930: 656c 662e 7062 552e 636c 6963 6b65 642e  elf.pbU.clicked.
+00086940: 636f 6e6e 6563 7428 6c61 6d62 6461 3a20  connect(lambda: 
+00086950: 7365 6c66 2e73 6574 5368 6966 7473 2830  self.setShifts(0
+00086960: 2c30 2e32 2929 0d0a 2020 2020 2020 2020  ,0.2))..        
+00086970: 7365 6c66 2e70 6244 2e63 6c69 636b 6564  self.pbD.clicked
+00086980: 2e63 6f6e 6e65 6374 286c 616d 6264 613a  .connect(lambda:
+00086990: 2073 656c 662e 7365 7453 6869 6674 7328   self.setShifts(
+000869a0: 302c 2d30 2e32 2929 0d0a 2020 2020 2020  0,-0.2))..      
+000869b0: 2020 7365 6c66 2e70 6252 442e 636c 6963    self.pbRD.clic
+000869c0: 6b65 642e 636f 6e6e 6563 7428 6c61 6d62  ked.connect(lamb
+000869d0: 6461 3a20 7365 6c66 2e73 6574 5368 6966  da: self.setShif
+000869e0: 7473 2830 2e32 2c2d 302e 3229 290d 0a20  ts(0.2,-0.2)).. 
+000869f0: 2020 2020 2020 2073 656c 662e 7062 5255         self.pbRU
+00086a00: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
+00086a10: 286c 616d 6264 613a 2073 656c 662e 7365  (lambda: self.se
+00086a20: 7453 6869 6674 7328 302e 322c 302e 3229  tShifts(0.2,0.2)
+00086a30: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00086a40: 7062 4c44 2e63 6c69 636b 6564 2e63 6f6e  pbLD.clicked.con
+00086a50: 6e65 6374 286c 616d 6264 613a 2073 656c  nect(lambda: sel
+00086a60: 662e 7365 7453 6869 6674 7328 2d30 2e32  f.setShifts(-0.2
+00086a70: 2c2d 302e 3229 290d 0a20 2020 2020 2020  ,-0.2))..       
+00086a80: 2073 656c 662e 7062 4c55 2e63 6c69 636b   self.pbLU.click
+00086a90: 6564 2e63 6f6e 6e65 6374 286c 616d 6264  ed.connect(lambd
+00086aa0: 613a 2073 656c 662e 7365 7453 6869 6674  a: self.setShift
+00086ab0: 7328 2d30 2e32 2c30 2e32 2929 0d0a 2020  s(-0.2,0.2))..  
+00086ac0: 2020 2020 2020 7365 6c66 2e70 624c 4c2e        self.pbLL.
+00086ad0: 636c 6963 6b65 642e 636f 6e6e 6563 7428  clicked.connect(
+00086ae0: 6c61 6d62 6461 3a20 7365 6c66 2e73 6574  lambda: self.set
+00086af0: 5368 6966 7473 282d 312c 3029 290d 0a20  Shifts(-1,0)).. 
+00086b00: 2020 2020 2020 2073 656c 662e 7062 5252         self.pbRR
+00086b10: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
+00086b20: 286c 616d 6264 613a 2073 656c 662e 7365  (lambda: self.se
+00086b30: 7453 6869 6674 7328 312c 3029 290d 0a20  tShifts(1,0)).. 
+00086b40: 2020 2020 2020 2073 656c 662e 7062 5555         self.pbUU
+00086b50: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
+00086b60: 286c 616d 6264 613a 2073 656c 662e 7365  (lambda: self.se
+00086b70: 7453 6869 6674 7328 302c 3129 290d 0a20  tShifts(0,1)).. 
+00086b80: 2020 2020 2020 2073 656c 662e 7062 4444         self.pbDD
+00086b90: 2e63 6c69 636b 6564 2e63 6f6e 6e65 6374  .clicked.connect
+00086ba0: 286c 616d 6264 613a 2073 656c 662e 7365  (lambda: self.se
+00086bb0: 7453 6869 6674 7328 302c 2d31 2929 0d0a  tShifts(0,-1))..
+00086bc0: 2020 2020 2020 2020 7365 6c66 2e70 624c          self.pbL
+00086bd0: 4c44 442e 636c 6963 6b65 642e 636f 6e6e  LDD.clicked.conn
+00086be0: 6563 7428 6c61 6d62 6461 3a20 7365 6c66  ect(lambda: self
+00086bf0: 2e73 6574 5368 6966 7473 282d 312c 2d31  .setShifts(-1,-1
+00086c00: 2929 0d0a 2020 2020 2020 2020 7365 6c66  ))..        self
+00086c10: 2e70 6252 5255 552e 636c 6963 6b65 642e  .pbRRUU.clicked.
+00086c20: 636f 6e6e 6563 7428 6c61 6d62 6461 3a20  connect(lambda: 
+00086c30: 7365 6c66 2e73 6574 5368 6966 7473 2831  self.setShifts(1
+00086c40: 2c31 2929 0d0a 2020 2020 2020 2020 7365  ,1))..        se
+00086c50: 6c66 2e70 624c 4c55 552e 636c 6963 6b65  lf.pbLLUU.clicke
+00086c60: 642e 636f 6e6e 6563 7428 6c61 6d62 6461  d.connect(lambda
+00086c70: 3a20 7365 6c66 2e73 6574 5368 6966 7473  : self.setShifts
+00086c80: 282d 312c 3129 290d 0a20 2020 2020 2020  (-1,1))..       
+00086c90: 2073 656c 662e 7062 5252 4444 2e63 6c69   self.pbRRDD.cli
+00086ca0: 636b 6564 2e63 6f6e 6e65 6374 286c 616d  cked.connect(lam
+00086cb0: 6264 613a 2073 656c 662e 7365 7453 6869  bda: self.setShi
+00086cc0: 6674 7328 312c 2d31 2929 0d0a 0d0a 2020  fts(1,-1))....  
+00086cd0: 2020 2020 2020 7365 6c66 2e70 6245 7870        self.pbExp
+00086ce0: 4461 7461 2e63 6c69 636b 6564 2e63 6f6e  Data.clicked.con
+00086cf0: 6e65 6374 2873 656c 662e 4f6e 5361 7665  nect(self.OnSave
+00086d00: 4461 7461 290d 0a20 2020 2020 2020 2073  Data)..        s
+00086d10: 656c 662e 7062 4578 7049 6d67 2e63 6c69  elf.pbExpImg.cli
+00086d20: 636b 6564 2e63 6f6e 6e65 6374 2873 656c  cked.connect(sel
+00086d30: 662e 4f6e 5361 7665 496d 6167 6529 0d0a  f.OnSaveImage)..
+00086d40: 2020 2020 2020 2020 7365 6c66 2e70 6243          self.pbC
+00086d50: 6f70 792e 636c 6963 6b65 642e 636f 6e6e  opy.clicked.conn
+00086d60: 6563 7428 7365 6c66 2e4f 6e43 6f70 7929  ect(self.OnCopy)
+00086d70: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00086d80: 2e4d 6574 7269 6343 6865 636b 426f 782e  .MetricCheckBox.
+00086d90: 746f 6767 6c65 642e 636f 6e6e 6563 7428  toggled.connect(
+00086da0: 6c61 6d62 6461 3a20 7365 6c66 2e4f 6e4d  lambda: self.OnM
+00086db0: 6574 7269 6353 6361 6c65 2873 656c 662e  etricScale(self.
+00086dc0: 4d65 7472 6963 4368 6563 6b42 6f78 2e69  MetricCheckBox.i
+00086dd0: 7343 6865 636b 6564 2829 2c20 7365 6c66  sChecked(), self
+00086de0: 2e5a 6572 6f4f 7269 6769 6e43 6865 636b  .ZeroOriginCheck
+00086df0: 426f 782e 6973 4368 6563 6b65 6428 292c  Box.isChecked(),
+00086e00: 7365 6c66 2e53 7175 6172 6550 7843 6865  self.SquarePxChe
+00086e10: 636b 426f 782e 6973 4368 6563 6b65 6428  ckBox.isChecked(
+00086e20: 2929 290d 0a20 2020 2020 2020 2073 656c  )))..        sel
+00086e30: 662e 5a65 726f 4f72 6967 696e 4368 6563  f.ZeroOriginChec
+00086e40: 6b42 6f78 2e74 6f67 676c 6564 2e63 6f6e  kBox.toggled.con
+00086e50: 6e65 6374 286c 616d 6264 613a 2073 656c  nect(lambda: sel
+00086e60: 662e 4f6e 4d65 7472 6963 5363 616c 6528  f.OnMetricScale(
+00086e70: 7365 6c66 2e4d 6574 7269 6343 6865 636b  self.MetricCheck
+00086e80: 426f 782e 6973 4368 6563 6b65 6428 292c  Box.isChecked(),
+00086e90: 2073 656c 662e 5a65 726f 4f72 6967 696e   self.ZeroOrigin
+00086ea0: 4368 6563 6b42 6f78 2e69 7343 6865 636b  CheckBox.isCheck
+00086eb0: 6564 2829 2c73 656c 662e 5371 7561 7265  ed(),self.Square
+00086ec0: 5078 4368 6563 6b42 6f78 2e69 7343 6865  PxCheckBox.isChe
+00086ed0: 636b 6564 2829 2929 0d0a 2020 2020 2020  cked()))..      
+00086ee0: 2020 7365 6c66 2e53 7175 6172 6550 7843    self.SquarePxC
+00086ef0: 6865 636b 426f 782e 746f 6767 6c65 642e  heckBox.toggled.
+00086f00: 636f 6e6e 6563 7428 6c61 6d62 6461 3a20  connect(lambda: 
+00086f10: 7365 6c66 2e4f 6e4d 6574 7269 6353 6361  self.OnMetricSca
+00086f20: 6c65 2873 656c 662e 4d65 7472 6963 4368  le(self.MetricCh
+00086f30: 6563 6b42 6f78 2e69 7343 6865 636b 6564  eckBox.isChecked
+00086f40: 2829 2c20 7365 6c66 2e5a 6572 6f4f 7269  (), self.ZeroOri
+00086f50: 6769 6e43 6865 636b 426f 782e 6973 4368  ginCheckBox.isCh
+00086f60: 6563 6b65 6428 292c 7365 6c66 2e53 7175  ecked(),self.Squ
+00086f70: 6172 6550 7843 6865 636b 426f 782e 6973  arePxCheckBox.is
+00086f80: 4368 6563 6b65 6428 2929 290d 0a20 2020  Checked()))..   
+00086f90: 2020 2020 2073 656c 662e 5371 7561 7265       self.Square
+00086fa0: 5078 4368 6563 6b42 6f78 2e73 6574 5669  PxCheckBox.setVi
+00086fb0: 7369 626c 6528 4661 6c73 6529 0d0a 2020  sible(False)..  
+00086fc0: 2020 2020 2020 7365 6c66 2e43 726f 7043        self.CropC
+00086fd0: 6865 636b 426f 782e 746f 6767 6c65 642e  heckBox.toggled.
+00086fe0: 636f 6e6e 6563 7428 6c61 6d62 6461 3a20  connect(lambda: 
+00086ff0: 7365 6c66 2e4f 6e43 726f 7043 4228 7365  self.OnCropCB(se
+00087000: 6c66 2e43 726f 7043 6865 636b 426f 782e  lf.CropCheckBox.
+00087010: 6973 4368 6563 6b65 6428 2929 290d 0a20  isChecked())).. 
+00087020: 2020 2020 2020 2073 656c 662e 6372 6f70         self.crop
+00087030: 666c 6167 203d 2054 7275 650d 0a20 2020  flag = True..   
+00087040: 2020 2020 2023 7365 6c66 2e53 6869 6674       #self.Shift
+00087050: 4c61 6265 6c2e 7365 7454 6578 7428 2278  Label.setText("x
+00087060: 203d 2025 302e 3166 205c 6e79 203d 2025   = %0.1f \ny = %
+00087070: 302e 3166 2220 2520 2830 2c20 3029 290d  0.1f" % (0, 0)).
+00087080: 0a20 2020 2020 2020 2073 656c 662e 4f44  .        self.OD
+00087090: 4869 6768 5370 696e 426f 782e 7661 6c75  HighSpinBox.valu
+000870a0: 6543 6861 6e67 6564 2e63 6f6e 6e65 6374  eChanged.connect
+000870b0: 286c 616d 6264 613a 2073 656c 662e 7365  (lambda: self.se
+000870c0: 744f 446c 696d 6974 7328 7365 6c66 2e4f  tODlimits(self.O
+000870d0: 444c 6f77 5370 696e 426f 782e 7661 6c75  DLowSpinBox.valu
+000870e0: 6528 292c 7365 6c66 2e4f 4448 6967 6853  e(),self.ODHighS
+000870f0: 7069 6e42 6f78 2e76 616c 7565 2829 2929  pinBox.value()))
+00087100: 0d0a 2020 2020 2020 2020 7365 6c66 2e4f  ..        self.O
+00087110: 444c 6f77 5370 696e 426f 782e 7661 6c75  DLowSpinBox.valu
+00087120: 6543 6861 6e67 6564 2e63 6f6e 6e65 6374  eChanged.connect
+00087130: 286c 616d 6264 613a 2073 656c 662e 7365  (lambda: self.se
+00087140: 744f 446c 696d 6974 7328 7365 6c66 2e4f  tODlimits(self.O
+00087150: 444c 6f77 5370 696e 426f 782e 7661 6c75  DLowSpinBox.valu
+00087160: 6528 292c 7365 6c66 2e4f 4448 6967 6853  e(),self.ODHighS
+00087170: 7069 6e42 6f78 2e76 616c 7565 2829 2929  pinBox.value()))
+00087180: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00087190: 6252 5354 4f44 2e63 6c69 636b 6564 2e63  bRSTOD.clicked.c
+000871a0: 6f6e 6e65 6374 286c 616d 6264 613a 2073  onnect(lambda: s
+000871b0: 656c 662e 5368 6f77 4d61 7028 7365 6c66  elf.ShowMap(self
+000871c0: 2e70 7265 6c73 742c 2073 656c 662e 706f  .prelst, self.po
+000871d0: 7374 6c73 7429 290d 0a20 2020 2020 2020  stlst))..       
+000871e0: 2073 656c 662e 7062 436c 7253 6869 6674   self.pbClrShift
+000871f0: 732e 636c 6963 6b65 642e 636f 6e6e 6563  s.clicked.connec
+00087200: 7428 7365 6c66 2e4f 6e43 6c72 5368 6966  t(self.OnClrShif
+00087210: 7473 290d 0a20 2020 2020 2020 2073 656c  ts)..        sel
+00087220: 662e 7062 436c 7253 656c 2e63 6c69 636b  f.pbClrSel.click
+00087230: 6564 2e63 6f6e 6e65 6374 2873 656c 662e  ed.connect(self.
+00087240: 4f6e 436c 7253 656c 6563 7469 6f6e 290d  OnClrSelection).
+00087250: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00087260: 434d 4361 7442 6f78 2e61 6464 4974 656d  CMCatBox.addItem
+00087270: 7328 5b73 656c 662e 636d 6170 735b 305d  s([self.cmaps[0]
+00087280: 5b30 5d2c 7365 6c66 2e63 6d61 7073 5b31  [0],self.cmaps[1
+00087290: 5d5b 305d 2c73 656c 662e 636d 6170 735b  ][0],self.cmaps[
+000872a0: 325d 5b30 5d2c 7365 6c66 2e63 6d61 7073  2][0],self.cmaps
+000872b0: 5b33 5d5b 305d 2c73 656c 662e 636d 6170  [3][0],self.cmap
+000872c0: 735b 345d 5b30 5d2c 7365 6c66 2e63 6d61  s[4][0],self.cma
+000872d0: 7073 5b35 5d5b 305d 5d29 0d0a 2020 2020  ps[5][0]])..    
+000872e0: 2020 2020 7365 6c66 2e43 4d4d 6170 426f      self.CMMapBo
+000872f0: 782e 6164 6449 7465 6d73 2873 656c 662e  x.addItems(self.
+00087300: 636d 6170 735b 325d 5b31 5d29 0d0a 2020  cmaps[2][1])..  
+00087310: 2020 2020 2020 7365 6c66 2e43 4d43 6174        self.CMCat
+00087320: 426f 782e 7365 7443 7572 7265 6e74 496e  Box.setCurrentIn
+00087330: 6465 7828 3229 0d0a 2020 2020 2020 2020  dex(2)..        
+00087340: 7365 6c66 2e43 4d4d 6170 426f 782e 7365  self.CMMapBox.se
+00087350: 7443 7572 7265 6e74 496e 6465 7828 3134  tCurrentIndex(14
+00087360: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00087370: 434d 4361 7442 6f78 2e63 7572 7265 6e74  CMCatBox.current
+00087380: 496e 6465 7843 6861 6e67 6564 2e63 6f6e  IndexChanged.con
+00087390: 6e65 6374 2873 656c 662e 4f6e 4361 7443  nect(self.OnCatC
+000873a0: 6861 6e67 6564 290d 0a20 2020 2020 2020  hanged)..       
+000873b0: 2073 656c 662e 434d 4d61 7042 6f78 2e63   self.CMMapBox.c
+000873c0: 7572 7265 6e74 496e 6465 7843 6861 6e67  urrentIndexChang
+000873d0: 6564 2e63 6f6e 6e65 6374 286c 616d 6264  ed.connect(lambd
+000873e0: 613a 2073 656c 662e 4f6e 436f 6c6f 726d  a: self.OnColorm
+000873f0: 6170 286d 6170 3d73 656c 662e 434d 4d61  ap(map=self.CMMa
+00087400: 7042 6f78 2e63 7572 7265 6e74 5465 7874  pBox.currentText
+00087410: 2829 2c63 6f6c 6f72 733d 7365 6c66 2e53  (),colors=self.S
+00087420: 7465 7053 7069 6e2e 7661 6c75 6528 2929  tepSpin.value())
+00087430: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00087440: 5374 6570 5370 696e 2e76 616c 7565 4368  StepSpin.valueCh
+00087450: 616e 6765 642e 636f 6e6e 6563 7428 6c61  anged.connect(la
+00087460: 6d62 6461 3a20 7365 6c66 2e4f 6e43 6f6c  mbda: self.OnCol
+00087470: 6f72 6d61 7028 6d61 703d 7365 6c66 2e43  ormap(map=self.C
+00087480: 4d4d 6170 426f 782e 6375 7272 656e 7454  MMapBox.currentT
+00087490: 6578 7428 292c 636f 6c6f 7273 3d73 656c  ext(),colors=sel
+000874a0: 662e 5374 6570 5370 696e 2e76 616c 7565  f.StepSpin.value
+000874b0: 2829 2929 0d0a 2020 2020 2020 2020 7365  ()))..        se
+000874c0: 6c66 2e66 696c 7465 7253 7069 6e42 6f78  lf.filterSpinBox
+000874d0: 2e76 616c 7565 4368 616e 6765 642e 636f  .valueChanged.co
+000874e0: 6e6e 6563 7428 6c61 6d62 6461 3a20 7365  nnect(lambda: se
+000874f0: 6c66 2e53 686f 774d 6170 2873 656c 662e  lf.ShowMap(self.
+00087500: 7072 656c 7374 2c20 7365 6c66 2e70 6f73  prelst, self.pos
+00087510: 746c 7374 2929 0d0a 2020 2020 2020 2020  tlst))..        
+00087520: 7365 6c66 2e66 696c 7465 7253 7069 6e42  self.filterSpinB
+00087530: 6f78 2e73 6574 456e 6162 6c65 6428 4661  ox.setEnabled(Fa
+00087540: 6c73 6529 0d0a 2020 2020 2020 2020 7365  lse)..        se
+00087550: 6c66 2e4d 6170 5365 6c65 6374 5769 6467  lf.MapSelectWidg
+00087560: 6574 312e 6d6f 7573 6550 7265 7373 4576  et1.mousePressEv
+00087570: 656e 7420 3d20 7365 6c66 2e6d 6f75 7365  ent = self.mouse
+00087580: 4576 656e 744f 6e51 4c69 7374 0d0a 2020  EventOnQList..  
+00087590: 2020 2020 2020 7365 6c66 2e4d 6170 5365        self.MapSe
+000875a0: 6c65 6374 5769 6467 6574 312e 6d6f 7573  lectWidget1.mous
+000875b0: 654d 6f76 6545 7665 6e74 203d 2073 656c  eMoveEvent = sel
+000875c0: 662e 6d6f 7573 6545 7665 6e74 4f6e 514c  f.mouseEventOnQL
+000875d0: 6973 740d 0a20 2020 2020 2020 2073 656c  ist..        sel
+000875e0: 662e 6461 7461 5f73 7472 7563 7420 3d20  f.data_struct = 
+000875f0: 6461 7461 5f73 7472 7563 740d 0a20 2020  data_struct..   
+00087600: 2020 2020 2073 656c 662e 7374 6b20 3d20       self.stk = 
+00087610: 7374 6163 6b0d 0a20 2020 2020 2020 2073  stack..        s
+00087620: 656c 662e 636f 6d20 3d20 636f 6d6d 6f6e  elf.com = common
+00087630: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
+00087640: 6576 203d 2030 0d0a 2020 2020 2020 2020  ev = 0..        
+00087650: 7365 6c66 2e6c 6174 6573 745f 726f 7720  self.latest_row 
+00087660: 3d20 2d31 0d0a 0d0a 2020 2020 2020 2020  = -1....        
+00087670: 7365 6c66 2e70 676c 6179 6f75 7420 3d20  self.pglayout = 
+00087680: 7067 2e47 7261 7068 6963 734c 6179 6f75  pg.GraphicsLayou
+00087690: 7428 626f 7264 6572 3d4e 6f6e 6529 0d0a  t(border=None)..
+000876a0: 2020 2020 2020 2020 7365 6c66 2e63 616e          self.can
+000876b0: 7661 732e 7365 7442 6163 6b67 726f 756e  vas.setBackgroun
+000876c0: 6428 2277 2229 2023 2063 616e 7661 7320  d("w") # canvas 
+000876d0: 6973 2061 2070 672e 4772 6170 6869 6373  is a pg.Graphics
+000876e0: 5669 6577 2077 6964 6765 740d 0a20 2020  View widget..   
+000876f0: 2020 2020 2073 656c 662e 6361 6e76 6173       self.canvas
+00087700: 2e73 6574 4365 6e74 7261 6c57 6964 6765  .setCentralWidge
+00087710: 7428 7365 6c66 2e70 676c 6179 6f75 7429  t(self.pglayout)
+00087720: 0d0a 2020 2020 2020 2020 2373 656c 662e  ..        #self.
+00087730: 7067 6c61 796f 7574 2e61 6464 4974 656d  pglayout.addItem
+00087740: 2870 672e 4178 6973 4974 656d 2827 6c65  (pg.AxisItem('le
+00087750: 6674 272c 7650 6f6c 6963 7920 3d51 7457  ft',vPolicy =QtW
+00087760: 6964 6765 7473 2e51 5369 7a65 506f 6c69  idgets.QSizePoli
+00087770: 6379 2e4d 6178 696d 756d 292c 2072 6f77  cy.Maximum), row
+00087780: 3d31 2c20 636f 6c3d 302c 2072 6f77 7370  =1, col=0, rowsp
+00087790: 616e 3d31 2c20 636f 6c73 7061 6e3d 3329  an=1, colspan=3)
+000877a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+000877b0: 3120 3d20 7365 6c66 2e70 676c 6179 6f75  1 = self.pglayou
+000877c0: 742e 6164 6450 6c6f 7428 726f 773d 302c  t.addPlot(row=0,
+000877d0: 2063 6f6c 3d30 2c20 726f 7773 7061 6e3d   col=0, rowspan=
+000877e0: 312c 2063 6f6c 7370 616e 3d31 290d 0a20  1, colspan=1).. 
+000877f0: 2020 2020 2020 2073 656c 662e 7031 2e73         self.p1.s
+00087800: 6574 4d6f 7573 6545 6e61 626c 6564 2878  etMouseEnabled(x
+00087810: 3d46 616c 7365 2c20 793d 4661 6c73 6529  =False, y=False)
+00087820: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
+00087830: 5f69 7465 6d20 3d20 7067 2e49 6d61 6765  _item = pg.Image
+00087840: 4974 656d 2862 6f72 6465 723d 226b 2229  Item(border="k")
+00087850: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00087860: 312e 7365 7441 7370 6563 744c 6f63 6b65  1.setAspectLocke
+00087870: 6428 6c6f 636b 3d54 7275 652c 2072 6174  d(lock=True, rat
+00087880: 696f 3d31 290d 0a20 2020 2020 2020 2073  io=1)..        s
+00087890: 656c 662e 7031 2e73 686f 7741 7869 7328  elf.p1.showAxis(
+000878a0: 2274 6f70 222c 2073 686f 773d 5472 7565  "top", show=True
+000878b0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000878c0: 7031 2e73 686f 7741 7869 7328 2262 6f74  p1.showAxis("bot
+000878d0: 746f 6d22 2c20 7368 6f77 3d54 7275 6529  tom", show=True)
+000878e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+000878f0: 312e 7368 6f77 4178 6973 2822 6c65 6674  1.showAxis("left
+00087900: 222c 2073 686f 773d 5472 7565 290d 0a20  ", show=True).. 
+00087910: 2020 2020 2020 2073 656c 662e 7031 2e73         self.p1.s
+00087920: 686f 7741 7869 7328 2272 6967 6874 222c  howAxis("right",
+00087930: 2073 686f 773d 5472 7565 290d 0a20 2020   show=True)..   
+00087940: 2020 2020 2073 656c 662e 6179 3120 3d20       self.ay1 = 
+00087950: 7365 6c66 2e70 312e 6765 7441 7869 7328  self.p1.getAxis(
+00087960: 226c 6566 7422 290d 0a20 2020 2020 2020  "left")..       
+00087970: 2062 7931 203d 2073 656c 662e 7031 2e67   by1 = self.p1.g
+00087980: 6574 4178 6973 2822 7269 6768 7422 290d  etAxis("right").
+00087990: 0a20 2020 2020 2020 2073 656c 662e 6178  .        self.ax
+000879a0: 3120 3d20 7365 6c66 2e70 312e 6765 7441  1 = self.p1.getA
+000879b0: 7869 7328 2262 6f74 746f 6d22 290d 0a20  xis("bottom").. 
+000879c0: 2020 2020 2020 2062 7831 203d 2073 656c         bx1 = sel
+000879d0: 662e 7031 2e67 6574 4178 6973 2822 746f  f.p1.getAxis("to
+000879e0: 7022 290d 0a20 2020 2020 2020 2073 656c  p")..        sel
+000879f0: 662e 6179 312e 7365 744c 6162 656c 2874  f.ay1.setLabel(t
+00087a00: 6578 743d 2279 222c 756e 6974 733d 2270  ext="y",units="p
+00087a10: 7822 290d 0a20 2020 2020 2020 2073 656c  x")..        sel
+00087a20: 662e 6179 312e 656e 6162 6c65 4175 746f  f.ay1.enableAuto
+00087a30: 5349 5072 6566 6978 2865 6e61 626c 653d  SIPrefix(enable=
+00087a40: 5472 7565 290d 0a20 2020 2020 2020 2073  True)..        s
+00087a50: 656c 662e 6178 312e 7365 744c 6162 656c  elf.ax1.setLabel
+00087a60: 2874 6578 743d 2278 222c 756e 6974 733d  (text="x",units=
+00087a70: 2270 7822 290d 0a20 2020 2020 2020 2073  "px")..        s
+00087a80: 656c 662e 6178 312e 656e 6162 6c65 4175  elf.ax1.enableAu
+00087a90: 746f 5349 5072 6566 6978 2865 6e61 626c  toSIPrefix(enabl
+00087aa0: 653d 5472 7565 290d 0a20 2020 2020 2020  e=True)..       
+00087ab0: 2073 656c 662e 6179 312e 7365 7453 7479   self.ay1.setSty
+00087ac0: 6c65 2874 6963 6b4c 656e 6774 683d 3829  le(tickLength=8)
+00087ad0: 0d0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
+00087ae0: 7831 2e73 6574 5374 796c 6528 7469 636b  x1.setStyle(tick
+00087af0: 4c65 6e67 7468 3d38 290d 0a20 2020 2020  Length=8)..     
+00087b00: 2020 2062 7931 2e73 6574 5374 796c 6528     by1.setStyle(
+00087b10: 7368 6f77 5661 6c75 6573 3d46 616c 7365  showValues=False
+00087b20: 2c74 6963 6b4c 656e 6774 683d 3029 0d0a  ,tickLength=0)..
+00087b30: 2020 2020 2020 2020 6278 312e 7365 7453          bx1.setS
+00087b40: 7479 6c65 2873 686f 7756 616c 7565 733d  tyle(showValues=
+00087b50: 4661 6c73 652c 7469 636b 4c65 6e67 7468  False,tickLength
+00087b60: 3d30 290d 0a0d 0a20 2020 2020 2020 2073  =0)....        s
+00087b70: 656c 662e 7032 203d 2073 656c 662e 7067  elf.p2 = self.pg
+00087b80: 6c61 796f 7574 2e61 6464 506c 6f74 2872  layout.addPlot(r
+00087b90: 6f77 3d30 2c20 636f 6c3d 312c 2072 6f77  ow=0, col=1, row
+00087ba0: 7370 616e 3d31 2c20 636f 6c73 7061 6e3d  span=1, colspan=
+00087bb0: 3129 0d0a 2020 2020 2020 2020 7365 6c66  1)..        self
+00087bc0: 2e70 322e 7365 744d 6f75 7365 456e 6162  .p2.setMouseEnab
+00087bd0: 6c65 6428 783d 4661 6c73 652c 2079 3d46  led(x=False, y=F
+00087be0: 616c 7365 290d 0a20 2020 2020 2020 2073  alse)..        s
+00087bf0: 656c 662e 6d5f 6974 656d 203d 2070 672e  elf.m_item = pg.
+00087c00: 496d 6167 6549 7465 6d28 626f 7264 6572  ImageItem(border
+00087c10: 3d22 6b22 290d 0a20 2020 2020 2020 2073  ="k")..        s
+00087c20: 656c 662e 6d5f 6974 656d 2e73 6574 5a56  elf.m_item.setZV
+00087c30: 616c 7565 2831 3030 3029 0d0a 2020 2020  alue(1000)..    
+00087c40: 2020 2020 7365 6c66 2e70 322e 7365 7441      self.p2.setA
+00087c50: 7370 6563 744c 6f63 6b65 6428 6c6f 636b  spectLocked(lock
+00087c60: 3d54 7275 652c 2072 6174 696f 3d31 290d  =True, ratio=1).
+00087c70: 0a20 2020 2020 2020 2073 656c 662e 7032  .        self.p2
+00087c80: 2e73 686f 7741 7869 7328 2274 6f70 222c  .showAxis("top",
+00087c90: 2073 686f 773d 5472 7565 290d 0a20 2020   show=True)..   
+00087ca0: 2020 2020 2073 656c 662e 7032 2e73 686f       self.p2.sho
+00087cb0: 7741 7869 7328 2262 6f74 746f 6d22 2c20  wAxis("bottom", 
+00087cc0: 7368 6f77 3d54 7275 6529 0d0a 2020 2020  show=True)..    
+00087cd0: 2020 2020 7365 6c66 2e70 322e 7368 6f77      self.p2.show
+00087ce0: 4178 6973 2822 6c65 6674 222c 2073 686f  Axis("left", sho
+00087cf0: 773d 5472 7565 290d 0a20 2020 2020 2020  w=True)..       
+00087d00: 2073 656c 662e 7032 2e73 686f 7741 7869   self.p2.showAxi
+00087d10: 7328 2272 6967 6874 222c 2073 686f 773d  s("right", show=
+00087d20: 5472 7565 290d 0a20 2020 2020 2020 2073  True)..        s
+00087d30: 656c 662e 6179 3220 3d20 7365 6c66 2e70  elf.ay2 = self.p
+00087d40: 322e 6765 7441 7869 7328 226c 6566 7422  2.getAxis("left"
+00087d50: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00087d60: 6179 322e 7365 745a 5661 6c75 6528 3130  ay2.setZValue(10
+00087d70: 3030 290d 0a20 2020 2020 2020 2062 7932  00)..        by2
+00087d80: 203d 2073 656c 662e 7032 2e67 6574 4178   = self.p2.getAx
+00087d90: 6973 2822 7269 6768 7422 290d 0a20 2020  is("right")..   
+00087da0: 2020 2020 2062 7932 2e73 6574 5a56 616c       by2.setZVal
+00087db0: 7565 2831 3030 3029 0d0a 2020 2020 2020  ue(1000)..      
+00087dc0: 2020 7365 6c66 2e61 7832 203d 2073 656c    self.ax2 = sel
+00087dd0: 662e 7032 2e67 6574 4178 6973 2822 626f  f.p2.getAxis("bo
+00087de0: 7474 6f6d 2229 0d0a 2020 2020 2020 2020  ttom")..        
+00087df0: 7365 6c66 2e61 7832 2e73 6574 5a56 616c  self.ax2.setZVal
+00087e00: 7565 2831 3030 3029 0d0a 2020 2020 2020  ue(1000)..      
+00087e10: 2020 6278 3220 3d20 7365 6c66 2e70 322e    bx2 = self.p2.
+00087e20: 6765 7441 7869 7328 2274 6f70 2229 0d0a  getAxis("top")..
+00087e30: 2020 2020 2020 2020 6278 322e 7365 745a          bx2.setZ
+00087e40: 5661 6c75 6528 3130 3030 290d 0a20 2020  Value(1000)..   
+00087e50: 2020 2020 2073 656c 662e 6179 322e 7365       self.ay2.se
+00087e60: 744c 6162 656c 2874 6578 743d 2279 222c  tLabel(text="y",
+00087e70: 756e 6974 733d 2270 7822 290d 0a20 2020  units="px")..   
+00087e80: 2020 2020 2073 656c 662e 7369 5f70 7265       self.si_pre
+00087e90: 6669 7820 3d20 7365 6c66 2e61 7932 2e65  fix = self.ay2.e
+00087ea0: 6e61 626c 6541 7574 6f53 4950 7265 6669  nableAutoSIPrefi
+00087eb0: 7828 656e 6162 6c65 3d54 7275 6529 0d0a  x(enable=True)..
+00087ec0: 2020 2020 2020 2020 7365 6c66 2e61 7832          self.ax2
+00087ed0: 2e73 6574 4c61 6265 6c28 7465 7874 3d22  .setLabel(text="
+00087ee0: 7822 2c75 6e69 7473 3d22 7078 2229 0d0a  x",units="px")..
+00087ef0: 2020 2020 2020 2020 7365 6c66 2e61 7832          self.ax2
+00087f00: 2e65 6e61 626c 6541 7574 6f53 4950 7265  .enableAutoSIPre
+00087f10: 6669 7828 656e 6162 6c65 3d54 7275 6529  fix(enable=True)
+00087f20: 0d0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
+00087f30: 7932 2e73 6574 5374 796c 6528 7469 636b  y2.setStyle(tick
+00087f40: 4c65 6e67 7468 3d38 290d 0a20 2020 2020  Length=8)..     
+00087f50: 2020 2073 656c 662e 6178 322e 7365 7453     self.ax2.setS
+00087f60: 7479 6c65 2874 6963 6b4c 656e 6774 683d  tyle(tickLength=
+00087f70: 3829 0d0a 2020 2020 2020 2020 6279 322e  8)..        by2.
+00087f80: 7365 7453 7479 6c65 2873 686f 7756 616c  setStyle(showVal
+00087f90: 7565 733d 4661 6c73 652c 7469 636b 4c65  ues=False,tickLe
+00087fa0: 6e67 7468 3d30 290d 0a20 2020 2020 2020  ngth=0)..       
+00087fb0: 2062 7832 2e73 6574 5374 796c 6528 7368   bx2.setStyle(sh
+00087fc0: 6f77 5661 6c75 6573 3d46 616c 7365 2c74  owValues=False,t
+00087fd0: 6963 6b4c 656e 6774 683d 3029 0d0a 2020  ickLength=0)..  
+00087fe0: 2020 2020 2020 7365 6c66 2e70 312e 7365        self.p1.se
+00087ff0: 7454 6974 6c65 2822 2229 0d0a 2020 2020  tTitle("")..    
+00088000: 2020 2020 7365 6c66 2e70 312e 7469 746c      self.p1.titl
+00088010: 654c 6162 656c 2e73 6574 5465 7874 2822  eLabel.setText("
+00088020: 3c63 656e 7465 723e 4e6f 2069 6d61 6765  <center>No image
+00088030: 7320 6c6f 6164 6564 3c2f 6365 6e74 6572  s loaded</center
+00088040: 3e22 2c20 7369 7a65 3d27 3130 7074 2729  >", size='10pt')
+00088050: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7365  ......        se
+00088060: 6c66 2e70 322e 7365 7454 6974 6c65 2822  lf.p2.setTitle("
+00088070: 2229 0d0a 2020 2020 2020 2020 7365 6c66  ")..        self
+00088080: 2e70 322e 7469 746c 654c 6162 656c 2e73  .p2.titleLabel.s
+00088090: 6574 5465 7874 2822 3c63 656e 7465 723e  etText("<center>
+000880a0: 4e6f 206d 6170 2061 7661 696c 6162 6c65  No map available
+000880b0: 3c2f 6365 6e74 6572 3e22 2c20 7369 7a65  </center>", size
+000880c0: 3d27 3130 7074 2729 0d0a 2020 2020 2020  ='10pt')..      
+000880d0: 2020 2373 656c 662e 7031 2e74 6974 6c65    #self.p1.title
+000880e0: 4c61 6265 6c2e 6974 656d 2e73 6574 5465  Label.item.setTe
+000880f0: 7874 5769 6474 6828 7365 6c66 2e70 312e  xtWidth(self.p1.
+00088100: 7769 6474 6828 2920 2a20 302e 3729 0d0a  width() * 0.7)..
+00088110: 2020 2020 2020 2020 2373 656c 662e 7032          #self.p2
+00088120: 2e74 6974 6c65 4c61 6265 6c2e 6974 656d  .titleLabel.item
+00088130: 2e73 6574 5465 7874 5769 6474 6828 7365  .setTextWidth(se
+00088140: 6c66 2e70 322e 7769 6474 6828 2920 2a20  lf.p2.width() * 
+00088150: 302e 3729 0d0a 2020 2020 2020 2020 7365  0.7)..        se
+00088160: 6c66 2e63 6d69 6d67 203d 2070 672e 496d  lf.cmimg = pg.Im
+00088170: 6167 6549 7465 6d28 626f 7264 6572 3d4e  ageItem(border=N
+00088180: 6f6e 6529 0d0a 2020 2020 2020 2020 7365  one)..        se
+00088190: 6c66 2e63 6d20 3d20 7365 6c66 2e70 676c  lf.cm = self.pgl
+000881a0: 6179 6f75 742e 6164 6450 6c6f 7428 726f  ayout.addPlot(ro
+000881b0: 773d 302c 2063 6f6c 3d32 2c20 726f 7773  w=0, col=2, rows
+000881c0: 7061 6e3d 312c 2063 6f6c 7370 616e 3d31  pan=1, colspan=1
+000881d0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000881e0: 636d 2e61 6464 4974 656d 2873 656c 662e  cm.addItem(self.
+000881f0: 636d 696d 6729 0d0a 2020 2020 2020 2020  cmimg)..        
+00088200: 7365 6c66 2e63 6d2e 7365 744d 6f75 7365  self.cm.setMouse
+00088210: 456e 6162 6c65 6428 783d 4661 6c73 652c  Enabled(x=False,
+00088220: 2079 3d46 616c 7365 290d 0a20 2020 2020   y=False)..     
+00088230: 2020 2073 656c 662e 636d 2e67 6574 5669     self.cm.getVi
+00088240: 6577 426f 7828 292e 6175 746f 5261 6e67  ewBox().autoRang
+00088250: 6528 7061 6464 696e 673d 3029 0d0a 2020  e(padding=0)..  
+00088260: 2020 2020 2020 7365 6c66 2e63 6d2e 7368        self.cm.sh
+00088270: 6f77 4178 6973 2822 746f 7022 2c20 7368  owAxis("top", sh
+00088280: 6f77 3d54 7275 6529 0d0a 2020 2020 2020  ow=True)..      
+00088290: 2020 7365 6c66 2e63 6d2e 7368 6f77 4178    self.cm.showAx
+000882a0: 6973 2822 626f 7474 6f6d 222c 2073 686f  is("bottom", sho
+000882b0: 773d 5472 7565 290d 0a20 2020 2020 2020  w=True)..       
+000882c0: 2073 656c 662e 636d 2e73 686f 7741 7869   self.cm.showAxi
+000882d0: 7328 226c 6566 7422 2c20 7368 6f77 3d54  s("left", show=T
+000882e0: 7275 6529 0d0a 2020 2020 2020 2020 7365  rue)..        se
+000882f0: 6c66 2e63 6d2e 7368 6f77 4178 6973 2822  lf.cm.showAxis("
+00088300: 7269 6768 7422 2c20 7368 6f77 3d54 7275  right", show=Tru
+00088310: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
+00088320: 2e63 6d2e 7365 7454 6974 6c65 2822 2229  .cm.setTitle("")
+00088330: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+00088340: 6d2e 7469 746c 654c 6162 656c 2e73 6574  m.titleLabel.set
+00088350: 5465 7874 2822 222c 2073 697a 653d 2731  Text("", size='1
+00088360: 3070 7427 290d 0a20 2020 2020 2020 2061  0pt')..        a
+00088370: 7933 203d 2073 656c 662e 636d 2e67 6574  y3 = self.cm.get
+00088380: 4178 6973 2822 6c65 6674 2229 0d0a 2020  Axis("left")..  
+00088390: 2020 2020 2020 6179 332e 7365 745a 5661        ay3.setZVa
+000883a0: 6c75 6528 3130 3030 290d 0a20 2020 2020  lue(1000)..     
+000883b0: 2020 2062 7933 203d 2073 656c 662e 636d     by3 = self.cm
+000883c0: 2e67 6574 4178 6973 2822 7269 6768 7422  .getAxis("right"
+000883d0: 290d 0a20 2020 2020 2020 2062 7933 2e73  )..        by3.s
+000883e0: 6574 5a56 616c 7565 2831 3030 3029 0d0a  etZValue(1000)..
+000883f0: 2020 2020 2020 2020 6278 3320 3d20 7365          bx3 = se
+00088400: 6c66 2e63 6d2e 6765 7441 7869 7328 2274  lf.cm.getAxis("t
+00088410: 6f70 2229 0d0a 2020 2020 2020 2020 6278  op")..        bx
+00088420: 332e 7365 745a 5661 6c75 6528 3130 3030  3.setZValue(1000
+00088430: 290d 0a20 2020 2020 2020 2061 7833 203d  )..        ax3 =
+00088440: 2073 656c 662e 636d 2e67 6574 4178 6973   self.cm.getAxis
+00088450: 2822 626f 7474 6f6d 2229 0d0a 2020 2020  ("bottom")..    
+00088460: 2020 2020 6178 332e 7365 745a 5661 6c75      ax3.setZValu
+00088470: 6528 3130 3030 290d 0a20 2020 2020 2020  e(1000)..       
+00088480: 2061 7833 2e73 6574 5469 636b 7328 5b5d   ax3.setTicks([]
+00088490: 290d 0a20 2020 2020 2020 2061 7833 2e73  )..        ax3.s
+000884a0: 6574 4c61 6265 6c28 7465 7874 3d22 222c  etLabel(text="",
+000884b0: 2075 6e69 7473 3d22 2229 0d0a 2020 2020   units="")..    
+000884c0: 2020 2020 6178 332e 7365 7453 7479 6c65      ax3.setStyle
+000884d0: 2874 6963 6b4c 656e 6774 683d 3829 0d0a  (tickLength=8)..
+000884e0: 2020 2020 2020 2020 6279 3320 3d20 7365          by3 = se
+000884f0: 6c66 2e63 6d2e 6765 7441 7869 7328 2272  lf.cm.getAxis("r
+00088500: 6967 6874 2229 0d0a 2020 2020 2020 2020  ight")..        
+00088510: 6279 332e 7365 744c 6162 656c 2874 6578  by3.setLabel(tex
+00088520: 743d 224f 4422 2c20 756e 6974 733d 2222  t="OD", units=""
+00088530: 290d 0a20 2020 2020 2020 2062 7933 2e73  )..        by3.s
+00088540: 6574 5374 796c 6528 7469 636b 4c65 6e67  etStyle(tickLeng
+00088550: 7468 3d38 290d 0a20 2020 2020 2020 2023  th=8)..        #
+00088560: 6279 332e 7465 7874 5769 6474 6828 290d  by3.textWidth().
+00088570: 0a20 2020 2020 2020 2061 7933 2e73 6574  .        ay3.set
+00088580: 5374 796c 6528 7368 6f77 5661 6c75 6573  Style(showValues
+00088590: 3d46 616c 7365 2c74 6963 6b4c 656e 6774  =False,tickLengt
+000885a0: 683d 3029 0d0a 2020 2020 2020 2020 6278  h=0)..        bx
+000885b0: 332e 7365 7453 7479 6c65 2873 686f 7756  3.setStyle(showV
+000885c0: 616c 7565 733d 4661 6c73 652c 7469 636b  alues=False,tick
+000885d0: 4c65 6e67 7468 3d30 290d 0a20 2020 2020  Length=0)..     
+000885e0: 2020 2061 7833 2e73 6574 4865 6967 6874     ax3.setHeight
+000885f0: 2868 3d34 362e 3229 2020 2320 776f 726b  (h=46.2)  # work
+00088600: 6172 6f75 6e64 2066 6f72 206f 7665 726c  around for overl
+00088610: 7920 6c6f 6e67 2063 6f6c 6f72 6261 720d  y long colorbar.
+00088620: 0a20 2020 2020 2020 2062 7933 2e73 6574  .        by3.set
+00088630: 5769 6474 6828 773d 3630 290d 0a20 2020  Width(w=60)..   
+00088640: 2020 2020 2073 656c 662e 7067 6c61 796f       self.pglayo
+00088650: 7574 2e6c 6179 6f75 742e 7365 7443 6f6c  ut.layout.setCol
+00088660: 756d 6e4d 696e 696d 756d 5769 6474 6828  umnMinimumWidth(
+00088670: 322c 2038 3029 0d0a 2020 2020 2020 2020  2, 80)..        
+00088680: 7365 6c66 2e70 676c 6179 6f75 742e 6c61  self.pglayout.la
+00088690: 796f 7574 2e73 6574 436f 6c75 6d6e 4d61  yout.setColumnMa
+000886a0: 7869 6d75 6d57 6964 7468 2832 2c20 3830  ximumWidth(2, 80
+000886b0: 290d 0a20 2020 2020 2020 2023 7365 6c66  )..        #self
+000886c0: 2e70 676c 6179 6f75 742e 6c61 796f 7574  .pglayout.layout
+000886d0: 2e73 6574 436f 6c75 6d6e 4d69 6e69 6d75  .setColumnMinimu
+000886e0: 6d57 6964 7468 2831 2c20 696e 7428 2873  mWidth(1, int((s
+000886f0: 656c 662e 7031 2e77 6964 7468 2829 202b  elf.p1.width() +
+00088700: 2073 656c 662e 7032 2e77 6964 7468 2829   self.p2.width()
+00088710: 2920 2f20 3229 290d 0a20 2020 2020 2020  ) / 2))..       
+00088720: 2023 7365 6c66 2e70 676c 6179 6f75 742e   #self.pglayout.
+00088730: 6c61 796f 7574 2e73 6574 436f 6c75 6d6e  layout.setColumn
+00088740: 4d69 6e69 6d75 6d57 6964 7468 2830 2c20  MinimumWidth(0, 
+00088750: 696e 7428 2873 656c 662e 7031 2e77 6964  int((self.p1.wid
+00088760: 7468 2829 202b 2073 656c 662e 7032 2e77  th() + self.p2.w
+00088770: 6964 7468 2829 2920 2f20 3229 290d 0a20  idth()) / 2)).. 
+00088780: 2020 2020 2020 2073 656c 662e 7031 2e73         self.p1.s
+00088790: 6574 5369 7a65 506f 6c69 6379 2851 7457  etSizePolicy(QtW
+000887a0: 6964 6765 7473 2e51 5369 7a65 506f 6c69  idgets.QSizePoli
+000887b0: 6379 2e45 7870 616e 6469 6e67 2c20 5174  cy.Expanding, Qt
+000887c0: 5769 6467 6574 732e 5153 697a 6550 6f6c  Widgets.QSizePol
+000887d0: 6963 792e 5072 6566 6572 7265 6429 0d0a  icy.Preferred)..
+000887e0: 2020 2020 2020 2020 7365 6c66 2e70 322e          self.p2.
+000887f0: 7365 7453 697a 6550 6f6c 6963 7928 5174  setSizePolicy(Qt
+00088800: 5769 6467 6574 732e 5153 697a 6550 6f6c  Widgets.QSizePol
+00088810: 6963 792e 4578 7061 6e64 696e 672c 2051  icy.Expanding, Q
+00088820: 7457 6964 6765 7473 2e51 5369 7a65 506f  tWidgets.QSizePo
+00088830: 6c69 6379 2e50 7265 6665 7272 6564 290d  licy.Preferred).
+00088840: 0a20 2020 2020 2020 2073 656c 662e 636d  .        self.cm
+00088850: 2e73 6574 5369 7a65 506f 6c69 6379 2851  .setSizePolicy(Q
+00088860: 7457 6964 6765 7473 2e51 5369 7a65 506f  tWidgets.QSizePo
+00088870: 6c69 6379 2e4d 6178 696d 756d 2c20 5174  licy.Maximum, Qt
+00088880: 5769 6467 6574 732e 5153 697a 6550 6f6c  Widgets.QSizePol
+00088890: 6963 792e 5072 6566 6572 7265 6429 0d0a  icy.Preferred)..
+000888a0: 2020 2020 6465 6620 6d6f 7573 6545 7665      def mouseEve
+000888b0: 6e74 4f6e 514c 6973 7428 7365 6c66 2c20  ntOnQList(self, 
+000888c0: 6529 3a0d 0a20 2020 2020 2020 2069 6620  e):..        if 
+000888d0: 652e 7479 7065 2829 203d 3d20 5174 436f  e.type() == QtCo
+000888e0: 7265 2e51 4576 656e 742e 4d6f 7573 654d  re.QEvent.MouseM
+000888f0: 6f76 6520 6f72 2065 2e74 7970 6528 2920  ove or e.type() 
+00088900: 3d3d 2051 7443 6f72 652e 5145 7665 6e74  == QtCore.QEvent
+00088910: 2e4d 6f75 7365 4275 7474 6f6e 5072 6573  .MouseButtonPres
+00088920: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00088930: 716c 6973 7420 3d20 7365 6c66 2e4d 6170  qlist = self.Map
+00088940: 5365 6c65 6374 5769 6467 6574 310d 0a20  SelectWidget1.. 
+00088950: 2020 2020 2020 2020 2020 2070 6f73 203d             pos =
+00088960: 2071 6c69 7374 2e6d 6170 4672 6f6d 476c   qlist.mapFromGl
+00088970: 6f62 616c 2851 7447 7569 2e51 4375 7273  obal(QtGui.QCurs
+00088980: 6f72 2e70 6f73 2829 290d 0a20 2020 2020  or.pos())..     
+00088990: 2020 2020 2020 2072 6f77 203d 2071 6c69         row = qli
+000889a0: 7374 2e69 6e64 6578 4174 2870 6f73 292e  st.indexAt(pos).
+000889b0: 726f 7728 290d 0a20 2020 2020 2020 2020  row()..         
+000889c0: 2020 2023 7072 696e 7428 726f 772c 7365     #print(row,se
+000889d0: 6c66 2e6c 6174 6573 745f 726f 7729 0d0a  lf.latest_row)..
+000889e0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000889f0: 656c 662e 7374 6b2e 7368 6966 7473 3a0d  elf.stk.shifts:.
+00088a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00088a10: 2070 6172 616d 7320 3d20 5b73 656c 662e   params = [self.
+00088a20: 7374 6b2e 7368 6966 7473 5b72 6f77 5d5b  stk.shifts[row][
+00088a30: 305d 2c73 656c 662e 7374 6b2e 7368 6966  0],self.stk.shif
+00088a40: 7473 5b72 6f77 5d5b 315d 2c73 656c 662e  ts[row][1],self.
+00088a50: 7374 6b2e 7368 6966 7473 5b72 6f77 5d5b  stk.shifts[row][
+00088a60: 325d 5d0d 0a20 2020 2020 2020 2020 2020  2]]..           
+00088a70: 2020 2020 2069 6620 726f 7720 3e3d 2030       if row >= 0
+00088a80: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00088a90: 2020 2020 2020 2020 2020 2069 6620 652e             if e.
+00088aa0: 7479 7065 2829 2021 3d20 5174 436f 7265  type() != QtCore
+00088ab0: 2e51 4576 656e 742e 4d6f 7573 654d 6f76  .QEvent.MouseMov
+00088ac0: 6520 6f72 2072 6f77 2021 3d20 7365 6c66  e or row != self
+00088ad0: 2e6c 6174 6573 745f 726f 773a 0d0a 2020  .latest_row:..  
+00088ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00088af0: 2020 2020 2020 2020 2020 6966 2065 2e62            if e.b
+00088b00: 7574 746f 6e73 2829 203d 3d20 5174 436f  uttons() == QtCo
+00088b10: 7265 2e51 742e 5269 6768 7442 7574 746f  re.Qt.RightButto
+00088b20: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
+00088b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00088b40: 2020 2020 716c 6973 742e 7365 7443 7572      qlist.setCur
+00088b50: 7265 6e74 526f 7728 726f 7729 0d0a 2020  rentRow(row)..  
+00088b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00088b70: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00088b80: 7261 6d73 5b31 5d20 3d20 310d 0a20 2020  rams[1] = 1..   
+00088b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00088ba0: 2020 2020 2020 2020 2065 6c69 6620 652e           elif e.
+00088bb0: 6275 7474 6f6e 7328 2920 3d3d 2051 7443  buttons() == QtC
+00088bc0: 6f72 652e 5174 2e4c 6566 7442 7574 746f  ore.Qt.LeftButto
+00088bd0: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
+00088be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00088bf0: 2020 2020 716c 6973 742e 7365 7443 7572      qlist.setCur
+00088c00: 7265 6e74 526f 7728 726f 7729 0d0a 2020  rentRow(row)..  
+00088c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00088c20: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00088c30: 7261 6d73 5b31 5d20 3d20 2d31 0d0a 2020  rams[1] = -1..  
+00088c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00088c50: 2020 2020 2020 2020 2020 7365 6c66 2e71            self.q
+00088c60: 6c69 7374 6368 616e 6765 642e 656d 6974  listchanged.emit
+00088c70: 2828 726f 772c 7061 7261 6d73 2929 0d0a  ((row,params))..
+00088c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00088c90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00088ca0: 2e6c 6174 6573 745f 726f 7720 3d20 726f  .latest_row = ro
+00088cb0: 770d 0a20 2020 2020 2020 2072 6574 7572  w..        retur
+00088cc0: 6e0d 0a20 2020 2064 6566 2071 4c69 7374  n..    def qList
+00088cd0: 4368 616e 6765 4861 6e64 6c65 7228 7365  ChangeHandler(se
+00088ce0: 6c66 2c70 6172 616d 7475 7029 3a0d 0a20  lf,paramtup):.. 
+00088cf0: 2020 2020 2020 2071 6c69 7374 203d 2073         qlist = s
+00088d00: 656c 662e 4d61 7053 656c 6563 7457 6964  elf.MapSelectWid
+00088d10: 6765 7431 0d0a 2020 2020 2020 2020 726f  get1..        ro
+00088d20: 772c 2070 6172 616d 7320 3d20 7061 7261  w, params = para
+00088d30: 6d74 7570 0d0a 2020 2020 2020 2020 6966  mtup..        if
+00088d40: 2073 656c 662e 7374 6b2e 7368 6966 7473   self.stk.shifts
+00088d50: 5b72 6f77 5d5b 315d 203d 3d20 7061 7261  [row][1] == para
+00088d60: 6d73 5b31 5d3a 0d0a 2020 2020 2020 2020  ms[1]:..        
+00088d70: 2020 2020 2370 7269 6e74 2822 6465 7365      #print("dese
+00088d80: 6c65 6374 2069 7421 2229 0d0a 2020 2020  lect it!")..    
+00088d90: 2020 2020 2020 2020 716c 6973 742e 6974          qlist.it
+00088da0: 656d 2872 6f77 292e 7365 7442 6163 6b67  em(row).setBackg
+00088db0: 726f 756e 6428 5174 4775 692e 5143 6f6c  round(QtGui.QCol
+00088dc0: 6f72 2830 2c20 302c 2030 2c20 3029 290d  or(0, 0, 0, 0)).
+00088dd0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00088de0: 662e 7374 6b2e 7368 6966 7473 5b72 6f77  f.stk.shifts[row
+00088df0: 5d5b 315d 203d 2030 0d0a 2020 2020 2020  ][1] = 0..      
+00088e00: 2020 656c 6966 2073 656c 662e 7374 6b2e    elif self.stk.
+00088e10: 7368 6966 7473 5b72 6f77 5d5b 315d 2021  shifts[row][1] !
+00088e20: 3d20 7061 7261 6d73 5b31 5d20 616e 6420  = params[1] and 
+00088e30: 7061 7261 6d73 5b31 5d20 3d3d 2031 3a20  params[1] == 1: 
+00088e40: 2320 7365 6c65 6374 2072 6967 6874 0d0a  # select right..
+00088e50: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
+00088e60: 6e74 2822 7365 6c65 6374 2072 6967 6874  nt("select right
+00088e70: 2122 290d 0a20 2020 2020 2020 2020 2020  !")..           
+00088e80: 2071 6c69 7374 2e69 7465 6d28 726f 7729   qlist.item(row)
+00088e90: 2e73 6574 4261 636b 6772 6f75 6e64 2851  .setBackground(Q
+00088ea0: 7447 7569 2e51 436f 6c6f 7228 2723 3766  tGui.QColor('#7f
+00088eb0: 6339 3766 2729 290d 0a20 2020 2020 2020  c97f'))..       
+00088ec0: 2020 2020 2073 656c 662e 7374 6b2e 7368       self.stk.sh
+00088ed0: 6966 7473 5b72 6f77 5d5b 315d 203d 2031  ifts[row][1] = 1
+00088ee0: 0d0a 2020 2020 2020 2020 656c 6966 2073  ..        elif s
+00088ef0: 656c 662e 7374 6b2e 7368 6966 7473 5b72  elf.stk.shifts[r
+00088f00: 6f77 5d5b 315d 2021 3d20 7061 7261 6d73  ow][1] != params
+00088f10: 5b31 5d20 616e 6420 7061 7261 6d73 5b31  [1] and params[1
+00088f20: 5d20 3d3d 202d 313a 2023 2073 656c 6563  ] == -1: # selec
+00088f30: 7420 6c65 6674 0d0a 2020 2020 2020 2020  t left..        
+00088f40: 2020 2020 2370 7269 6e74 2822 7365 6c65      #print("sele
+00088f50: 6374 206c 6566 7421 2229 0d0a 2020 2020  ct left!")..    
+00088f60: 2020 2020 2020 2020 716c 6973 742e 6974          qlist.it
+00088f70: 656d 2872 6f77 292e 7365 7442 6163 6b67  em(row).setBackg
+00088f80: 726f 756e 6428 5174 4775 692e 5143 6f6c  round(QtGui.QCol
+00088f90: 6f72 2827 2362 6561 6564 3427 2929 0d0a  or('#beaed4'))..
+00088fa0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00088fb0: 2e73 746b 2e73 6869 6674 735b 726f 775d  .stk.shifts[row]
+00088fc0: 5b31 5d20 3d20 2d31 0d0a 2020 2020 2020  [1] = -1..      
+00088fd0: 2020 7365 6c66 2e4f 6e53 656c 6563 7469    self.OnSelecti
+00088fe0: 6f6e 4368 616e 6765 6428 290d 0a20 2020  onChanged()..   
+00088ff0: 2020 2020 2023 7072 696e 7428 726f 772c       #print(row,
+00089000: 2070 6172 616d 7329 0d0a 2020 2020 6465   params)..    de
+00089010: 6620 4f6e 5365 6c65 6374 696f 6e43 6861  f OnSelectionCha
+00089020: 6e67 6564 2873 656c 6629 3a0d 0a20 2020  nged(self):..   
+00089030: 2020 2020 2073 656c 662e 7072 656c 7374       self.prelst
+00089040: 203d 205b 696e 6465 7820 666f 7220 696e   = [index for in
+00089050: 6465 782c 2076 616c 7565 2069 6e20 656e  dex, value in en
+00089060: 756d 6572 6174 6528 5b78 5b31 5d20 666f  umerate([x[1] fo
+00089070: 7220 7820 696e 2020 7365 6c66 2e73 746b  r x in  self.stk
+00089080: 2e73 6869 6674 735d 2920 6966 2076 616c  .shifts]) if val
+00089090: 7565 203d 3d20 2d31 5d0d 0a20 2020 2020  ue == -1]..     
+000890a0: 2020 2073 656c 662e 706f 7374 6c73 7420     self.postlst 
+000890b0: 3d20 5b69 6e64 6578 2066 6f72 2069 6e64  = [index for ind
+000890c0: 6578 2c20 7661 6c75 6520 696e 2065 6e75  ex, value in enu
+000890d0: 6d65 7261 7465 285b 785b 315d 2066 6f72  merate([x[1] for
+000890e0: 2078 2069 6e20 2073 656c 662e 7374 6b2e   x in  self.stk.
+000890f0: 7368 6966 7473 5d29 2069 6620 7661 6c75  shifts]) if valu
+00089100: 6520 3d3d 2031 5d0d 0a20 2020 2020 2020  e == 1]..       
+00089110: 2023 7072 696e 7428 7365 6c66 2e70 7265   #print(self.pre
+00089120: 6c73 742c 7365 6c66 2e70 6f73 746c 7374  lst,self.postlst
+00089130: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00089140: 4f6e 5363 726f 6c6c 456e 6728 7365 6c66  OnScrollEng(self
+00089150: 2e4d 6170 5365 6c65 6374 5769 6467 6574  .MapSelectWidget
+00089160: 312e 6375 7272 656e 7452 6f77 2829 290d  1.currentRow()).
+00089170: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+00089180: 7365 6c66 2e70 7265 6c73 7429 203d 3d20  self.prelst) == 
+00089190: 3020 6f72 206c 656e 2873 656c 662e 706f  0 or len(self.po
+000891a0: 7374 6c73 7429 203d 3d20 303a 0d0a 2020  stlst) == 0:..  
+000891b0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+000891c0: 2873 656c 662e 7072 656c 7374 202b 2073  (self.prelst + s
+000891d0: 656c 662e 706f 7374 6c73 7429 203d 3d20  elf.postlst) == 
+000891e0: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
+000891f0: 2020 2020 7365 6c66 2e70 6243 6c72 5365      self.pbClrSe
+00089200: 6c2e 7365 7445 6e61 626c 6564 2846 616c  l.setEnabled(Fal
+00089210: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
+00089220: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00089230: 2020 2020 2020 2020 7365 6c66 2e70 6243          self.pbC
+00089240: 6c72 5365 6c2e 7365 7445 6e61 626c 6564  lrSel.setEnabled
+00089250: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
+00089260: 2020 2020 7365 6c66 2e70 322e 636c 6561      self.p2.clea
+00089270: 7228 290d 0a20 2020 2020 2020 2020 2020  r()..           
+00089280: 2073 656c 662e 636d 2e63 6c65 6172 2829   self.cm.clear()
+00089290: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000892a0: 6c66 2e70 322e 7469 746c 654c 6162 656c  lf.p2.titleLabel
+000892b0: 2e73 6574 5465 7874 2822 3c63 656e 7465  .setText("<cente
+000892c0: 723e 5365 6c65 6374 2061 7420 6c65 6173  r>Select at leas
+000892d0: 7420 6f6e 6520 7072 652d 2061 6e64 2070  t one pre- and p
+000892e0: 6f73 742d 6564 6765 2069 6d61 6765 213c  ost-edge image!<
+000892f0: 2f63 656e 7465 723e 222c 7369 7a65 3d27  /center>",size='
+00089300: 3130 7074 2729 0d0a 0d0a 2020 2020 2020  10pt')....      
+00089310: 2020 2020 2020 7365 6c66 2e4f 4448 6967        self.ODHig
+00089320: 6853 7069 6e42 6f78 2e73 6574 456e 6162  hSpinBox.setEnab
+00089330: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
+00089340: 2020 2020 2020 2020 7365 6c66 2e4f 444c          self.ODL
+00089350: 6f77 5370 696e 426f 782e 7365 7445 6e61  owSpinBox.setEna
+00089360: 626c 6564 2846 616c 7365 290d 0a20 2020  bled(False)..   
+00089370: 2020 2020 2020 2020 2073 656c 662e 7062           self.pb
+00089380: 5253 544f 442e 7365 7445 6e61 626c 6564  RSTOD.setEnabled
+00089390: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
+000893a0: 2020 2020 2073 656c 662e 6669 6c74 6572       self.filter
+000893b0: 5370 696e 426f 782e 7365 7445 6e61 626c  SpinBox.setEnabl
+000893c0: 6564 2846 616c 7365 290d 0a20 2020 2020  ed(False)..     
+000893d0: 2020 2020 2020 2073 656c 662e 7062 4578         self.pbEx
+000893e0: 7044 6174 612e 7365 7445 6e61 626c 6564  pData.setEnabled
+000893f0: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
+00089400: 2020 2020 2073 656c 662e 7062 4578 7049       self.pbExpI
+00089410: 6d67 2e73 6574 456e 6162 6c65 6428 4661  mg.setEnabled(Fa
+00089420: 6c73 6529 0d0a 0d0a 2020 2020 2020 2020  lse)....        
+00089430: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00089440: 2020 2073 656c 662e 7062 436c 7253 656c     self.pbClrSel
+00089450: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
+00089460: 290d 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00089470: 7365 6c66 2e49 6e66 5761 726e 696e 6720  self.InfWarning 
+00089480: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+00089490: 2020 2020 2073 656c 662e 5368 6f77 4d61       self.ShowMa
+000894a0: 7028 7365 6c66 2e70 7265 6c73 742c 7365  p(self.prelst,se
+000894b0: 6c66 2e70 6f73 746c 7374 290d 0a20 2020  lf.postlst)..   
+000894c0: 2020 2020 2020 2020 2023 2073 656c 662e           # self.
+000894d0: 4f6e 5363 726f 6c6c 456e 6728 7365 6c66  OnScrollEng(self
+000894e0: 2e4d 6170 5365 6c65 6374 5769 6467 6574  .MapSelectWidget
+000894f0: 312e 6375 7272 656e 7452 6f77 2829 290d  1.currentRow()).
+00089500: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00089510: 662e 4f6e 4d65 7472 6963 5363 616c 6528  f.OnMetricScale(
+00089520: 7365 6c66 2e4d 6574 7269 6343 6865 636b  self.MetricCheck
+00089530: 426f 782e 6973 4368 6563 6b65 6428 292c  Box.isChecked(),
+00089540: 2073 656c 662e 5a65 726f 4f72 6967 696e   self.ZeroOrigin
+00089550: 4368 6563 6b42 6f78 2e69 7343 6865 636b  CheckBox.isCheck
+00089560: 6564 2829 2c0d 0a20 2020 2020 2020 2020  ed(),..         
+00089570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00089580: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00089590: 5371 7561 7265 5078 4368 6563 6b42 6f78  SquarePxCheckBox
+000895a0: 2e69 7343 6865 636b 6564 2829 290d 0a20  .isChecked()).. 
+000895b0: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
+000895c0: 2020 2023 202d 2d2d 2d2d 2d2d 2d2d 2d2d     # -----------
+000895d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000895e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000895f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00089600: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020  -----------..   
+00089610: 2064 6566 204f 6e53 6176 6544 6174 6128   def OnSaveData(
+00089620: 7365 6c66 2c65 7665 6e74 293a 0d0a 2020  self,event):..  
+00089630: 2020 2020 2020 2353 6176 6520 4461 7461        #Save Data
+00089640: 0d0a 2020 2020 2020 2020 7769 6c64 6361  ..        wildca
+00089650: 7264 203d 2022 466c 6f61 7433 3220 5449  rd = "Float32 TI
+00089660: 4646 2046 696c 6520 282a 2e74 6966 293b  FF File (*.tif);
+00089670: 3b54 6578 7449 6d61 6765 2028 2a2e 7478  ;TextImage (*.tx
+00089680: 7429 3b3b 220d 0a0d 0a20 2020 2020 2020  t);;"....       
+00089690: 2066 696c 654e 616d 652c 205f 6669 6c74   fileName, _filt
+000896a0: 6572 203d 2051 7457 6964 6765 7473 2e51  er = QtWidgets.Q
+000896b0: 4669 6c65 4469 616c 6f67 2e67 6574 5361  FileDialog.getSa
+000896c0: 7665 4669 6c65 4e61 6d65 2873 656c 662c  veFileName(self,
+000896d0: 2027 5361 7665 204f 4420 4d61 7027 2c20   'Save OD Map', 
+000896e0: 2727 2c20 7769 6c64 6361 7264 290d 0a0d  '', wildcard)...
+000896f0: 0a20 2020 2020 2020 2066 696c 654e 616d  .        fileNam
+00089700: 6520 3d20 7374 7228 6669 6c65 4e61 6d65  e = str(fileName
+00089710: 290d 0a20 2020 2020 2020 2069 6620 6669  )..        if fi
+00089720: 6c65 4e61 6d65 203d 3d20 2727 3a0d 0a20  leName == '':.. 
+00089730: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00089740: 6e0d 0a0d 0a20 2020 2020 2020 2070 6174  n....        pat
+00089750: 682c 2065 7874 203d 206f 732e 7061 7468  h, ext = os.path
+00089760: 2e73 706c 6974 6578 7428 6669 6c65 4e61  .splitext(fileNa
+00089770: 6d65 290d 0a20 2020 2020 2020 2065 7874  me)..        ext
+00089780: 203d 2065 7874 5b31 3a5d 2e6c 6f77 6572   = ext[1:].lower
+00089790: 2829 0d0a 0d0a 2020 2020 2020 2020 6966  ()....        if
+000897a0: 2065 7874 2021 3d20 2774 6966 2720 616e   ext != 'tif' an
+000897b0: 6420 6578 7420 213d 2027 7478 7427 3a0d  d ext != 'txt':.
+000897c0: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
+000897d0: 6f72 5f6d 6573 7361 6765 203d 2028 0d0a  or_message = (..
+000897e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000897f0: 2020 274f 6e6c 7920 7468 6520 5449 4620    'Only the TIF 
+00089800: 616e 6420 5458 5420 6461 7461 2066 6f72  and TXT data for
+00089810: 6d61 7473 2061 7265 2073 7570 706f 7274  mats are support
+00089820: 6564 2e5c 6e27 0d0a 2020 2020 2020 2020  ed.\n'..        
+00089830: 2020 2020 2020 2020 2027 4120 6669 6c65           'A file
+00089840: 2065 7874 656e 7369 6f6e 206f 6620 6074   extension of `t
+00089850: 6966 5c27 206f 7220 6074 7874 5c27 206d  if\' or `txt\' m
+00089860: 7573 7420 6265 2075 7365 642e 2729 0d0a  ust be used.')..
+00089870: 2020 2020 2020 2020 2020 2020 5174 5769              QtWi
+00089880: 6467 6574 732e 514d 6573 7361 6765 426f  dgets.QMessageBo
+00089890: 782e 7761 726e 696e 6728 7365 6c66 2c20  x.warning(self, 
+000898a0: 2745 7272 6f72 272c 2027 4572 726f 7220  'Error', 'Error 
+000898b0: 2d20 436f 756c 6420 6e6f 7420 7361 7665  - Could not save
+000898c0: 2066 696c 652e 2729 0d0a 2020 2020 2020   file.')..      
+000898d0: 2020 2020 2020 7265 7475 726e 0d0a 0d0a        return....
+000898e0: 2020 2020 2020 2020 6966 2065 7874 203d          if ext =
+000898f0: 3d20 2774 6966 273a 0d0a 2020 2020 2020  = 'tif':..      
+00089900: 2020 2020 2020 6672 6f6d 2050 494c 2069        from PIL i
+00089910: 6d70 6f72 7420 496d 6167 650d 0a20 2020  mport Image..   
+00089920: 2020 2020 2020 2020 2069 6d67 3120 3d20           img1 = 
+00089930: 496d 6167 652e 6672 6f6d 6172 7261 7928  Image.fromarray(
+00089940: 6e70 2e72 6f74 3930 2873 656c 662e 4f44  np.rot90(self.OD
+00089950: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00089960: 696d 6731 2e73 6176 6528 6669 6c65 4e61  img1.save(fileNa
+00089970: 6d65 290d 0a20 2020 2020 2020 2069 6620  me)..        if 
+00089980: 6578 7420 3d3d 2027 7478 7427 3a0d 0a20  ext == 'txt':.. 
+00089990: 2020 2020 2020 2020 2020 206e 702e 7361             np.sa
+000899a0: 7665 7478 7428 6669 6c65 4e61 6d65 2c20  vetxt(fileName, 
+000899b0: 6e70 2e72 6f74 3930 2873 656c 662e 4f44  np.rot90(self.OD
+000899c0: 292c 2064 656c 696d 6974 6572 3d27 5c74  ), delimiter='\t
+000899d0: 272c 206e 6577 6c69 6e65 3d27 5c6e 272c  ', newline='\n',
+000899e0: 666d 743d 2725 2e35 6627 290d 0a20 2020  fmt='%.5f')..   
+000899f0: 2064 6566 204f 6e43 6f70 7928 7365 6c66   def OnCopy(self
+00089a00: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+00089a10: 2e65 7870 203d 2070 672e 6578 706f 7274  .exp = pg.export
+00089a20: 6572 732e 496d 6167 6545 7870 6f72 7465  ers.ImageExporte
+00089a30: 7228 7365 6c66 2e70 676c 6179 6f75 7429  r(self.pglayout)
+00089a40: 0d0a 2020 2020 2020 2020 7365 6c66 2e65  ..        self.e
+00089a50: 7870 2e65 7870 6f72 7428 636f 7079 3d54  xp.export(copy=T
+00089a60: 7275 6529 0d0a 2020 2020 2020 2020 7265  rue)..        re
+00089a70: 7475 726e 0d0a 2020 2020 6465 6620 4f6e  turn..    def On
+00089a80: 5361 7665 496d 6167 6528 7365 6c66 2c20  SaveImage(self, 
+00089a90: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
+00089aa0: 2023 2053 6176 6520 496d 6167 650d 0a20   # Save Image.. 
+00089ab0: 2020 2020 2020 2077 696c 6463 6172 6420         wildcard 
+00089ac0: 3d20 2254 4946 4620 282a 2e74 6966 293b  = "TIFF (*.tif);
+00089ad0: 3b50 4e47 2028 2a2e 706e 6729 3b3b 4a50  ;PNG (*.png);;JP
+00089ae0: 4720 282a 2e6a 7067 293b 3b53 5647 2028  G (*.jpg);;SVG (
+00089af0: 2a2e 7376 6729 3b3b 220d 0a0d 0a20 2020  *.svg);;"....   
+00089b00: 2020 2020 2066 696c 654e 616d 652c 205f       fileName, _
+00089b10: 6669 6c74 6572 203d 2051 7457 6964 6765  filter = QtWidge
+00089b20: 7473 2e51 4669 6c65 4469 616c 6f67 2e67  ts.QFileDialog.g
+00089b30: 6574 5361 7665 4669 6c65 4e61 6d65 2873  etSaveFileName(s
+00089b40: 656c 662c 2027 5361 7665 204f 4420 4d61  elf, 'Save OD Ma
+00089b50: 7027 2c20 2727 2c20 7769 6c64 6361 7264  p', '', wildcard
+00089b60: 290d 0a0d 0a20 2020 2020 2020 2066 696c  )....        fil
+00089b70: 654e 616d 6520 3d20 7374 7228 6669 6c65  eName = str(file
+00089b80: 4e61 6d65 290d 0a20 2020 2020 2020 2069  Name)..        i
+00089b90: 6620 6669 6c65 4e61 6d65 203d 3d20 2727  f fileName == ''
+00089ba0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00089bb0: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
+00089bc0: 2070 6174 682c 2065 7874 203d 206f 732e   path, ext = os.
+00089bd0: 7061 7468 2e73 706c 6974 6578 7428 6669  path.splitext(fi
+00089be0: 6c65 4e61 6d65 290d 0a20 2020 2020 2020  leName)..       
+00089bf0: 2065 7874 203d 2065 7874 5b31 3a5d 2e6c   ext = ext[1:].l
+00089c00: 6f77 6572 2829 0d0a 0d0a 2020 2020 2020  ower()....      
+00089c10: 2020 7061 6464 696e 6720 3d20 3130 2020    padding = 10  
+00089c20: 2320 636c 6561 7261 6e63 6520 6265 7477  # clearance betw
+00089c30: 6565 6e20 4f44 2063 6f6c 6f72 2062 6172  een OD color bar
+00089c40: 2061 6e64 2070 3220 696e 2070 7820 756e   and p2 in px un
+00089c50: 6974 730d 0a20 2020 2020 2020 2077 6964  its..        wid
+00089c60: 7468 203d 2073 656c 662e 7032 2e73 697a  th = self.p2.siz
+00089c70: 6528 292e 7769 6474 6828 2920 2b20 7365  e().width() + se
+00089c80: 6c66 2e63 6d2e 7369 7a65 2829 2e77 6964  lf.cm.size().wid
+00089c90: 7468 2829 0d0a 2020 2020 2020 2020 6865  th()..        he
+00089ca0: 6967 6874 203d 2073 656c 662e 7032 2e73  ight = self.p2.s
+00089cb0: 697a 6528 292e 6865 6967 6874 2829 0d0a  ize().height()..
+00089cc0: 2020 2020 2020 2020 6966 2065 7874 203d          if ext =
+00089cd0: 3d20 2773 7667 273a 0d0a 2020 2020 2020  = 'svg':..      
+00089ce0: 2020 2020 2020 7032 6578 7020 3d20 7067        p2exp = pg
+00089cf0: 2e65 7870 6f72 7465 7273 2e53 5647 4578  .exporters.SVGEx
+00089d00: 706f 7274 6572 2873 656c 662e 7032 290d  porter(self.p2).
+00089d10: 0a20 2020 2020 2020 2020 2020 2063 6d65  .            cme
+00089d20: 7870 203d 2070 672e 6578 706f 7274 6572  xp = pg.exporter
+00089d30: 732e 5356 4745 7870 6f72 7465 7228 7365  s.SVGExporter(se
+00089d40: 6c66 2e63 6d29 0d0a 2020 2020 2020 2020  lf.cm)..        
+00089d50: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00089d60: 2020 2070 3265 7870 203d 2070 672e 6578     p2exp = pg.ex
+00089d70: 706f 7274 6572 732e 496d 6167 6545 7870  porters.ImageExp
+00089d80: 6f72 7465 7228 7365 6c66 2e70 3229 0d0a  orter(self.p2)..
+00089d90: 2020 2020 2020 2020 2020 2020 636d 6578              cmex
+00089da0: 7020 3d20 7067 2e65 7870 6f72 7465 7273  p = pg.exporters
+00089db0: 2e49 6d61 6765 4578 706f 7274 6572 2873  .ImageExporter(s
+00089dc0: 656c 662e 636d 290d 0a20 2020 2020 2020  elf.cm)..       
+00089dd0: 2070 3265 7870 203d 2070 3265 7870 2e65   p2exp = p2exp.e
+00089de0: 7870 6f72 7428 746f 4279 7465 733d 5472  xport(toBytes=Tr
+00089df0: 7565 290d 0a20 2020 2020 2020 2063 6d65  ue)..        cme
+00089e00: 7870 203d 2063 6d65 7870 2e65 7870 6f72  xp = cmexp.expor
+00089e10: 7428 746f 4279 7465 733d 5472 7565 290d  t(toBytes=True).
+00089e20: 0a20 2020 2020 2020 2069 6620 6578 7420  .        if ext 
+00089e30: 3d3d 2027 7469 6627 206f 7220 6578 7420  == 'tif' or ext 
+00089e40: 3d3d 2027 706e 6727 206f 7220 6578 7420  == 'png' or ext 
+00089e50: 3d3d 2027 6a70 6727 3a0d 0a20 2020 2020  == 'jpg':..     
+00089e60: 2020 2020 2020 2023 2054 6865 2073 7562         # The sub
+00089e70: 7365 7175 656e 7420 636f 6465 2077 6173  sequent code was
+00089e80: 2074 6573 7465 6420 7769 7468 2070 7971   tested with pyq
+00089e90: 7467 7261 7068 2030 2e31 312e 3064 6576  tgraph 0.11.0dev
+00089ea0: 3020 3b20 7079 7174 6772 6170 6820 3c20  0 ; pyqtgraph < 
+00089eb0: 302e 3131 2e30 2073 686f 7773 2061 2054  0.11.0 shows a T
+00089ec0: 7970 6545 7272 6f72 3a20 2766 6c6f 6174  ypeError: 'float
+00089ed0: 272e 2e2e 0d0a 2020 2020 2020 2020 2020  '.....          
+00089ee0: 2020 2320 546f 2063 6f6d 6269 6e65 2073    # To combine s
+00089ef0: 656c 662e 7032 2061 6e64 2073 656c 662e  elf.p2 and self.
+00089f00: 636d 2028 4f44 2062 6172 2920 696e 2061  cm (OD bar) in a
+00089f10: 2073 696e 676c 6520 696d 6167 652c 2074   single image, t
+00089f20: 6865 2074 776f 2051 496d 6167 6520 6f62  he two QImage ob
+00089f30: 6a65 6374 7320 6172 6520 7265 6472 6177  jects are redraw
+00089f40: 6e20 7573 696e 6720 6120 5150 6169 6e74  n using a QPaint
+00089f50: 6572 206f 626a 6563 742e 0d0a 2020 2020  er object...    
+00089f60: 2020 2020 2020 2020 2320 4966 2073 656c          # If sel
+00089f70: 662e 636d 2069 7320 6e6f 7420 6e65 6564  f.cm is not need
+00089f80: 6564 2c20 7468 6520 666f 6c6c 6f77 696e  ed, the followin
+00089f90: 6720 7477 6f20 6c69 6e65 7320 6172 6520  g two lines are 
+00089fa0: 7375 6666 6963 6965 6e74 3a0d 0a20 2020  sufficient:..   
+00089fb0: 2020 2020 2020 2020 2023 2020 2070 3265           #   p2e
+00089fc0: 7870 203d 2070 672e 6578 706f 7274 6572  xp = pg.exporter
+00089fd0: 732e 496d 6167 6545 7870 6f72 7465 7228  s.ImageExporter(
+00089fe0: 7365 6c66 2e70 3229 0d0a 2020 2020 2020  self.p2)..      
+00089ff0: 2020 2020 2020 2320 2020 7032 6578 702e        #   p2exp.
+0008a000: 6578 706f 7274 2846 696c 654e 616d 6529  export(FileName)
+0008a010: 0d0a 2020 2020 2020 2020 2020 2020 7169  ..            qi
+0008a020: 6d67 203d 2051 7447 7569 2e51 496d 6167  mg = QtGui.QImag
+0008a030: 6528 7769 6474 6820 2b20 7061 6464 696e  e(width + paddin
+0008a040: 672c 2068 6569 6768 742c 2051 7447 7569  g, height, QtGui
+0008a050: 2e51 496d 6167 652e 466f 726d 6174 5f41  .QImage.Format_A
+0008a060: 5247 4233 3229 0d0a 2020 2020 2020 2020  RGB32)..        
+0008a070: 2020 2020 6966 2065 7874 203d 3d20 276a      if ext == 'j
+0008a080: 7067 273a 0d0a 2020 2020 2020 2020 2020  pg':..          
+0008a090: 2020 2020 2020 7169 6d67 2e66 696c 6c28        qimg.fill(
+0008a0a0: 5174 4775 692e 5143 6f6c 6f72 2832 3535  QtGui.QColor(255
+0008a0b0: 2c20 3235 352c 2032 3535 2c20 3235 3529  , 255, 255, 255)
+0008a0c0: 293b 2023 2042 4720 7768 6974 6520 6966  ); # BG white if
+0008a0d0: 2065 7870 6f72 7420 6173 206a 7067 0d0a   export as jpg..
+0008a0e0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0008a0f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0008a100: 2020 2071 696d 672e 6669 6c6c 2851 7447     qimg.fill(QtG
+0008a110: 7569 2e51 436f 6c6f 7228 302c 2030 2c20  ui.QColor(0, 0, 
+0008a120: 302c 2030 2929 3b0d 0a20 2020 2020 2020  0, 0));..       
+0008a130: 2020 2020 2070 6169 6e74 6572 203d 2051       painter = Q
+0008a140: 7447 7569 2e51 5061 696e 7465 7228 290d  tGui.QPainter().
+0008a150: 0a20 2020 2020 2020 2020 2020 2070 6169  .            pai
+0008a160: 6e74 6572 2e62 6567 696e 2871 696d 6729  nter.begin(qimg)
+0008a170: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
+0008a180: 696e 7465 722e 6472 6177 496d 6167 6528  inter.drawImage(
+0008a190: 302c 2030 2c20 7032 6578 7029 0d0a 2020  0, 0, p2exp)..  
+0008a1a0: 2020 2020 2020 2020 2020 7061 696e 7465            painte
+0008a1b0: 722e 6472 6177 496d 6167 6528 7032 6578  r.drawImage(p2ex
+0008a1c0: 702e 7369 7a65 2829 2e77 6964 7468 2829  p.size().width()
+0008a1d0: 202b 2070 6164 6469 6e67 2c20 302c 2063   + padding, 0, c
+0008a1e0: 6d65 7870 290d 0a20 2020 2020 2020 2020  mexp)..         
+0008a1f0: 2020 2070 6169 6e74 6572 2e65 6e64 2829     painter.end()
+0008a200: 0d0a 2020 2020 2020 2020 2020 2020 2370  ..            #p
+0008a210: 6978 6d61 7020 3d20 5150 6978 6d61 702e  ixmap = QPixmap.
+0008a220: 6672 6f6d 496d 6167 6528 7469 6c65 290d  fromImage(tile).
+0008a230: 0a20 2020 2020 2020 2020 2020 2023 5143  .            #QC
+0008a240: 6f72 6541 7070 6c69 6361 7469 6f6e 2e69  oreApplication.i
+0008a250: 6e73 7461 6e63 6528 292e 636c 6970 626f  nstance().clipbo
+0008a260: 6172 6428 292e 7365 7449 6d61 6765 2871  ard().setImage(q
+0008a270: 696d 6729 0d0a 2020 2020 2020 2020 2020  img)..          
+0008a280: 2020 7169 6d67 2e73 6176 6528 6669 6c65    qimg.save(file
+0008a290: 4e61 6d65 2c71 7561 6c69 7479 3d31 3030  Name,quality=100
+0008a2a0: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
+0008a2b0: 6578 7420 3d3d 2027 7376 6727 3a0d 0a20  ext == 'svg':.. 
+0008a2c0: 2020 2020 2020 2020 2020 2066 6967 3120             fig1 
+0008a2d0: 3d20 7365 6c66 2e53 5647 436c 6970 5061  = self.SVGClipPa
+0008a2e0: 7468 5265 6d6f 7665 7228 6574 7265 652e  thRemover(etree.
+0008a2f0: 6672 6f6d 7374 7269 6e67 2870 3265 7870  fromstring(p2exp
+0008a300: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+0008a310: 6669 6732 203d 2073 656c 662e 5356 4743  fig2 = self.SVGC
+0008a320: 6c69 7050 6174 6852 656d 6f76 6572 2865  lipPathRemover(e
+0008a330: 7472 6565 2e66 726f 6d73 7472 696e 6728  tree.fromstring(
+0008a340: 636d 6578 7029 290d 0a20 2020 2020 2020  cmexp))..       
+0008a350: 2020 2020 206d 6572 6765 6466 6967 203d       mergedfig =
+0008a360: 2073 656c 662e 5356 474d 6572 6765 7228   self.SVGMerger(
+0008a370: 6669 6731 2c66 6967 322c 7365 6c66 2e70  fig1,fig2,self.p
+0008a380: 322e 7369 7a65 2829 2e77 6964 7468 2829  2.size().width()
+0008a390: 2c20 7365 6c66 2e63 6d2e 7369 7a65 2829  , self.cm.size()
+0008a3a0: 2e77 6964 7468 2829 2c68 6569 6768 742c  .width(),height,
+0008a3b0: 7061 6464 696e 6729 0d0a 2020 2020 2020  padding)..      
+0008a3c0: 2020 2020 2020 6f75 7420 3d20 6574 7265        out = etre
+0008a3d0: 652e 746f 7374 7269 6e67 286d 6572 6765  e.tostring(merge
+0008a3e0: 6466 6967 2c20 786d 6c5f 6465 636c 6172  dfig, xml_declar
+0008a3f0: 6174 696f 6e3d 5472 7565 2c0d 0a20 2020  ation=True,..   
+0008a400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008a410: 2020 2020 2020 2020 2020 2020 2020 7374                st
+0008a420: 616e 6461 6c6f 6e65 3d54 7275 652c 0d0a  andalone=True,..
+0008a430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008a450: 2070 7265 7474 795f 7072 696e 743d 5472   pretty_print=Tr
+0008a460: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
+0008a470: 2077 6974 6820 6f70 656e 2866 696c 654e   with open(fileN
+0008a480: 616d 652c 2027 7762 2729 2061 7320 7376  ame, 'wb') as sv
+0008a490: 673a 0d0a 2020 2020 2020 2020 2020 2020  g:..            
+0008a4a0: 2020 2020 7376 672e 7772 6974 6528 6f75      svg.write(ou
+0008a4b0: 7429 0d0a 2020 2020 6465 6620 5356 474d  t)..    def SVGM
+0008a4c0: 6572 6765 7228 7365 6c66 2c20 7376 6731  erger(self, svg1
+0008a4d0: 2c20 7376 6732 2c20 7769 6474 6831 2c77  , svg2, width1,w
+0008a4e0: 6964 7468 322c 2068 6569 6768 742c 2070  idth2, height, p
+0008a4f0: 6164 6469 6e67 3d30 293a 2023 6d65 7267  adding=0): #merg
+0008a500: 6573 2074 776f 206c 786d 6c2e 6574 7265  es two lxml.etre
+0008a510: 6520 656c 656d 656e 7473 2068 6f72 697a  e elements horiz
+0008a520: 6f6e 7461 6c6c 7920 7769 7468 2070 6164  ontally with pad
+0008a530: 6469 6e67 0d0a 2020 2020 2020 2020 6e73  ding..        ns
+0008a540: 203d 207b 2727 3a20 7376 6731 2e74 6167   = {'': svg1.tag
+0008a550: 2e73 706c 6974 2827 7d27 295b 305d 2e73  .split('}')[0].s
+0008a560: 7472 6970 2827 7b27 297d 0d0a 2020 2020  trip('{')}..    
+0008a570: 2020 2020 7376 6720 3d20 6574 7265 652e      svg = etree.
+0008a580: 456c 656d 656e 7428 7376 6731 2e74 6167  Element(svg1.tag
+0008a590: 2c20 6e73 6d61 703d 7b4e 6f6e 653a 2027  , nsmap={None: '
+0008a5a0: 6874 7470 3a2f 2f77 7777 2e77 332e 6f72  http://www.w3.or
+0008a5b0: 672f 3230 3030 2f73 7667 272c 2027 786c  g/2000/svg', 'xl
+0008a5c0: 696e 6b27 3a20 2768 7474 703a 2f2f 7777  ink': 'http://ww
+0008a5d0: 772e 7733 2e6f 7267 2f31 3939 392f 786c  w.w3.org/1999/xl
+0008a5e0: 696e 6b27 7d29 0d0a 2020 2020 2020 2020  ink'})..        
+0008a5f0: 7376 672e 7365 7428 2276 6572 7369 6f6e  svg.set("version
+0008a600: 222c 2022 312e 3222 290d 0a20 2020 2020  ", "1.2")..     
+0008a610: 2020 2073 7667 2e73 6574 2827 7769 6474     svg.set('widt
+0008a620: 6827 2c20 7374 7228 7769 6474 6831 202b  h', str(width1 +
+0008a630: 2077 6964 7468 3220 2b20 7061 6464 696e   width2 + paddin
+0008a640: 6729 2b22 7078 2229 2023 7461 7267 6574  g)+"px") #target
+0008a650: 2077 6964 7468 0d0a 2020 2020 2020 2020   width..        
+0008a660: 7376 672e 7365 7428 2768 6569 6768 7427  svg.set('height'
+0008a670: 2c20 7374 7228 6865 6967 6874 292b 2270  , str(height)+"p
+0008a680: 7822 2920 2374 6172 6765 7420 6865 6967  x") #target heig
+0008a690: 6874 0d0a 2020 2020 2020 2020 7376 672e  ht..        svg.
+0008a6a0: 7365 7428 2276 6965 7742 6f78 222c 2022  set("viewBox", "
+0008a6b0: 3020 3020 2573 2025 7322 2025 2028 7374  0 0 %s %s" % (st
+0008a6c0: 7228 7769 6474 6831 202b 2077 6964 7468  r(width1 + width
+0008a6d0: 3220 2b70 6164 6469 6e67 292b 2270 7822  2 +padding)+"px"
+0008a6e0: 2c20 7374 7228 6865 6967 6874 292b 2270  , str(height)+"p
+0008a6f0: 7822 2929 0d0a 2020 2020 2020 2020 6731  x"))..        g1
+0008a700: 203d 2065 7472 6565 2e53 7562 456c 656d   = etree.SubElem
+0008a710: 656e 7428 7376 672c 2027 6727 290d 0a20  ent(svg, 'g').. 
+0008a720: 2020 2020 2020 2067 312e 6170 7065 6e64         g1.append
+0008a730: 2873 7667 312e 6669 6e64 2827 2e2f 6727  (svg1.find('./g'
+0008a740: 2c20 6e73 2929 0d0a 2020 2020 2020 2020  , ns))..        
+0008a750: 6720 3d20 6574 7265 652e 5375 6245 6c65  g = etree.SubEle
+0008a760: 6d65 6e74 2867 312c 2027 6727 290d 0a20  ment(g1, 'g').. 
+0008a770: 2020 2020 2020 2067 2e73 6574 2827 7472         g.set('tr
+0008a780: 616e 7366 6f72 6d27 2c27 7472 616e 736c  ansform','transl
+0008a790: 6174 6528 272b 7374 7228 7769 6474 6831  ate('+str(width1
+0008a7a0: 202b 2070 6164 6469 6e67 292b 272c 2030   + padding)+', 0
+0008a7b0: 2920 7363 616c 6528 3129 2729 0d0a 2020  ) scale(1)')..  
+0008a7c0: 2020 2020 2020 672e 6170 7065 6e64 2873        g.append(s
+0008a7d0: 7667 322e 6669 6e64 2827 2e2f 6727 2c20  vg2.find('./g', 
+0008a7e0: 6e73 2929 0d0a 2020 2020 2020 2020 7265  ns))..        re
+0008a7f0: 7475 726e 2073 7667 0d0a 2020 2020 6465  turn svg..    de
+0008a800: 6620 5356 4743 6c69 7050 6174 6852 656d  f SVGClipPathRem
+0008a810: 6f76 6572 2873 656c 662c 2065 6c65 6d29  over(self, elem)
+0008a820: 3a20 2374 616b 6573 2065 7472 6565 2065  : #takes etree e
+0008a830: 6c65 6d65 6e74 7320 616e 6420 7265 6d6f  lements and remo
+0008a840: 7665 7320 636c 6970 2d70 6174 6820 7461  ves clip-path ta
+0008a850: 6773 2061 6e64 206b 6579 7320 696e 7369  gs and keys insi
+0008a860: 6465 2067 2074 6167 7320 6966 2070 7265  de g tags if pre
+0008a870: 7365 6e74 2e0d 0a20 2020 2020 2020 206e  sent...        n
+0008a880: 7320 3d20 7b27 273a 2065 6c65 6d2e 7461  s = {'': elem.ta
+0008a890: 672e 7370 6c69 7428 277d 2729 5b30 5d2e  g.split('}')[0].
+0008a8a0: 7374 7269 7028 277b 2729 7d0d 0a20 2020  strip('{')}..   
+0008a8b0: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+0008a8c0: 2020 2020 2020 2066 6f72 2063 6c69 7070         for clipp
+0008a8d0: 6174 6820 696e 2065 6c65 6d2e 6669 6e64  ath in elem.find
+0008a8e0: 616c 6c28 222e 2f2f 636c 6970 5061 7468  all(".//clipPath
+0008a8f0: 222c 206e 7329 3a0d 0a20 2020 2020 2020  ", ns):..       
+0008a900: 2020 2020 2020 2020 2063 6c69 7070 6174           clippat
+0008a910: 682e 6765 7470 6172 656e 7428 292e 7265  h.getparent().re
+0008a920: 6d6f 7665 2863 6c69 7070 6174 6829 0d0a  move(clippath)..
+0008a930: 2020 2020 2020 2020 6578 6365 7074 3a0d          except:.
+0008a940: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+0008a950: 730d 0a20 2020 2020 2020 2074 7279 3a0d  s..        try:.
+0008a960: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0008a970: 2067 2069 6e20 656c 656d 2e66 696e 6461   g in elem.finda
+0008a980: 6c6c 2822 2e2f 2f67 222c 206e 7329 3a0d  ll(".//g", ns):.
+0008a990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008a9a0: 2069 6620 672e 6b65 7973 2829 5b30 5d20   if g.keys()[0] 
+0008a9b0: 3d3d 2022 636c 6970 2d70 6174 6822 3a0d  == "clip-path":.
+0008a9c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008a9d0: 2020 2020 2064 656c 2067 2e61 7474 7269       del g.attri
+0008a9e0: 625b 2763 6c69 702d 7061 7468 275d 0d0a  b['clip-path']..
+0008a9f0: 2020 2020 2020 2020 6578 6365 7074 3a0d          except:.
+0008aa00: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+0008aa10: 730d 0a20 2020 2020 2020 2072 6574 7572  s..        retur
+0008aa20: 6e20 656c 656d 0d0a 0d0a 2020 2020 6465  n elem....    de
+0008aa30: 6620 4f6e 4361 7443 6861 6e67 6564 2873  f OnCatChanged(s
+0008aa40: 656c 6629 3a0d 0a20 2020 2020 2020 2073  elf):..        s
+0008aa50: 656c 662e 434d 4d61 7042 6f78 2e62 6c6f  elf.CMMapBox.blo
+0008aa60: 636b 5369 676e 616c 7328 5472 7565 290d  ckSignals(True).
+0008aa70: 0a20 2020 2020 2020 2073 656c 662e 434d  .        self.CM
+0008aa80: 4d61 7042 6f78 2e63 6c65 6172 2829 0d0a  MapBox.clear()..
+0008aa90: 2020 2020 2020 2020 7365 6c66 2e43 4d4d          self.CMM
+0008aaa0: 6170 426f 782e 626c 6f63 6b53 6967 6e61  apBox.blockSigna
+0008aab0: 6c73 2846 616c 7365 290d 0a20 2020 2020  ls(False)..     
+0008aac0: 2020 2073 656c 662e 434d 4d61 7042 6f78     self.CMMapBox
+0008aad0: 2e61 6464 4974 656d 7328 7365 6c66 2e63  .addItems(self.c
+0008aae0: 6d61 7073 5b73 656c 662e 434d 4361 7442  maps[self.CMCatB
+0008aaf0: 6f78 2e63 7572 7265 6e74 496e 6465 7828  ox.currentIndex(
+0008ab00: 295d 5b31 5d29 0d0a 0d0a 2020 2020 6465  )][1])....    de
+0008ab10: 6620 7365 744f 446c 696d 6974 7328 7365  f setODlimits(se
+0008ab20: 6c66 2c6c 6f77 2c20 6869 6768 293a 0d0a  lf,low, high):..
+0008ab30: 2020 2020 2020 2020 7365 6c66 2e4f 4448          self.ODH
+0008ab40: 6967 6853 7069 6e42 6f78 2e73 6574 4d61  ighSpinBox.setMa
+0008ab50: 7869 6d75 6d28 7365 6c66 2e4f 446d 6178  ximum(self.ODmax
+0008ab60: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0008ab70: 4f44 4869 6768 5370 696e 426f 782e 7365  ODHighSpinBox.se
+0008ab80: 744d 696e 696d 756d 286c 6f77 290d 0a20  tMinimum(low).. 
+0008ab90: 2020 2020 2020 2073 656c 662e 4f44 4c6f         self.ODLo
+0008aba0: 7753 7069 6e42 6f78 2e73 6574 4d61 7869  wSpinBox.setMaxi
+0008abb0: 6d75 6d28 6869 6768 290d 0a20 2020 2020  mum(high)..     
+0008abc0: 2020 2073 656c 662e 4f44 4c6f 7753 7069     self.ODLowSpi
+0008abd0: 6e42 6f78 2e73 6574 4d69 6e69 6d75 6d28  nBox.setMinimum(
+0008abe0: 7365 6c66 2e4f 446d 696e 290d 0a20 2020  self.ODmin)..   
+0008abf0: 2020 2020 204f 4420 3d20 6e70 2e63 6c69       OD = np.cli
+0008ac00: 7028 7365 6c66 2e4f 442c 6c6f 772c 6869  p(self.OD,low,hi
+0008ac10: 6768 290d 0a20 2020 2020 2020 2073 656c  gh)..        sel
+0008ac20: 662e 4f6e 436f 6c6f 726d 6170 286d 6170  f.OnColormap(map
+0008ac30: 3d73 656c 662e 434d 4d61 7042 6f78 2e63  =self.CMMapBox.c
+0008ac40: 7572 7265 6e74 5465 7874 2829 2c20 636f  urrentText(), co
+0008ac50: 6c6f 7273 3d73 656c 662e 5374 6570 5370  lors=self.StepSp
+0008ac60: 696e 2e76 616c 7565 2829 290d 0a20 2020  in.value())..   
+0008ac70: 2020 2020 2073 656c 662e 7365 744f 4462       self.setODb
+0008ac80: 6172 286c 6f77 2c20 6869 6768 290d 0a20  ar(low, high).. 
+0008ac90: 2020 2020 2020 2073 656c 662e 6d5f 6974         self.m_it
+0008aca0: 656d 2e73 6574 496d 6167 6528 4f44 290d  em.setImage(OD).
+0008acb0: 0a20 2020 2064 6566 2073 6574 4372 6f73  .    def setCros
+0008acc0: 7368 6169 7228 7365 6c66 293a 0d0a 2020  shair(self):..  
+0008acd0: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
+0008ace0: 2873 656c 662c 2027 764c 696e 6527 293a  (self, 'vLine'):
+0008acf0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0008ad00: 6c66 2e70 322e 7265 6d6f 7665 4974 656d  lf.p2.removeItem
+0008ad10: 2873 656c 662e 764c 696e 6529 0d0a 2020  (self.vLine)..  
+0008ad20: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0008ad30: 322e 7265 6d6f 7665 4974 656d 2873 656c  2.removeItem(sel
+0008ad40: 662e 764c 696e 6529 0d0a 2020 2020 2020  f.vLine)..      
+0008ad50: 2020 2020 2020 7365 6c66 2e63 616e 7661        self.canva
+0008ad60: 732e 7265 6d6f 7665 4974 656d 2873 656c  s.removeItem(sel
+0008ad70: 662e 4f44 6c61 6265 6c29 0d0a 0d0a 2020  f.ODlabel)....  
+0008ad80: 2020 2020 2020 7365 6c66 2e76 4c69 6e65        self.vLine
+0008ad90: 203d 2070 672e 496e 6669 6e69 7465 4c69   = pg.InfiniteLi
+0008ada0: 6e65 2861 6e67 6c65 3d39 302c 206d 6f76  ne(angle=90, mov
+0008adb0: 6162 6c65 3d46 616c 7365 2c20 7065 6e3d  able=False, pen=
+0008adc0: 2230 3030 3022 290d 0a20 2020 2020 2020  "0000")..       
+0008add0: 2073 656c 662e 684c 696e 6520 3d20 7067   self.hLine = pg
+0008ade0: 2e49 6e66 696e 6974 654c 696e 6528 616e  .InfiniteLine(an
+0008adf0: 676c 653d 302c 206d 6f76 6162 6c65 3d46  gle=0, movable=F
+0008ae00: 616c 7365 2c70 656e 3d22 3030 3030 2229  alse,pen="0000")
+0008ae10: 0d0a 2020 2020 2020 2020 7365 6c66 2e4f  ..        self.O
+0008ae20: 446c 6162 656c 203d 2070 672e 4c61 6265  Dlabel = pg.Labe
+0008ae30: 6c49 7465 6d28 6a75 7374 6966 793d 226c  lItem(justify="l
+0008ae40: 6566 7422 290d 0a20 2020 2020 2020 2073  eft")..        s
+0008ae50: 656c 662e 6361 6e76 6173 2e61 6464 4974  elf.canvas.addIt
+0008ae60: 656d 2873 656c 662e 4f44 6c61 6265 6c29  em(self.ODlabel)
+0008ae70: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+0008ae80: 322e 6164 6449 7465 6d28 7365 6c66 2e76  2.addItem(self.v
+0008ae90: 4c69 6e65 2c20 6967 6e6f 7265 426f 756e  Line, ignoreBoun
+0008aea0: 6473 3d54 7275 6529 0d0a 2020 2020 2020  ds=True)..      
+0008aeb0: 2020 7365 6c66 2e70 322e 6164 6449 7465    self.p2.addIte
+0008aec0: 6d28 7365 6c66 2e68 4c69 6e65 2c20 6967  m(self.hLine, ig
+0008aed0: 6e6f 7265 426f 756e 6473 3d54 7275 6529  noreBounds=True)
+0008aee0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+0008aef0: 726f 7879 203d 2070 672e 5369 676e 616c  roxy = pg.Signal
+0008af00: 5072 6f78 7928 7365 6c66 2e70 322e 7363  Proxy(self.p2.sc
+0008af10: 656e 6528 292e 7369 674d 6f75 7365 4d6f  ene().sigMouseMo
+0008af20: 7665 642c 2072 6174 654c 696d 6974 3d33  ved, rateLimit=3
+0008af30: 302c 2073 6c6f 743d 7365 6c66 2e4f 6e4d  0, slot=self.OnM
+0008af40: 6f75 7365 486f 7665 7229 0d0a 0d0a 2020  ouseHover)....  
+0008af50: 2020 6465 6620 4f6e 4d6f 7573 6548 6f76    def OnMouseHov
+0008af60: 6572 2873 656c 662c 6576 7429 3a0d 0a20  er(self,evt):.. 
+0008af70: 2020 2020 2020 2070 6f73 203d 2065 7674         pos = evt
+0008af80: 5b30 5d0d 0a20 2020 2020 2020 2023 7072  [0]..        #pr
+0008af90: 696e 7428 706f 7329 0d0a 2020 2020 2020  int(pos)..      
+0008afa0: 2020 6966 2068 6173 6174 7472 2873 656c    if hasattr(sel
+0008afb0: 662c 2027 4f44 2729 3a0d 0a20 2020 2020  f, 'OD'):..     
+0008afc0: 2020 2020 2020 2069 6620 7365 6c66 2e70         if self.p
+0008afd0: 322e 6765 7456 6965 7742 6f78 2829 2e69  2.getViewBox().i
+0008afe0: 7465 6d42 6f75 6e64 696e 6752 6563 7428  temBoundingRect(
+0008aff0: 7365 6c66 2e6d 5f69 7465 6d29 2e63 6f6e  self.m_item).con
+0008b000: 7461 696e 7328 7365 6c66 2e70 322e 6765  tains(self.p2.ge
+0008b010: 7456 6965 7742 6f78 2829 2e6d 6170 5363  tViewBox().mapSc
+0008b020: 656e 6554 6f56 6965 7728 706f 7329 293a  eneToView(pos)):
 0008b030: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0008b040: 2020 6966 2073 656c 662e 4d65 7472 6963    if self.Metric
-0008b050: 4368 6563 6b42 6f78 2e69 7343 6865 636b  CheckBox.isCheck
-0008b060: 6564 2829 3a0d 0a20 2020 2020 2020 2020  ed():..         
-0008b070: 2020 2020 2020 2020 2020 2078 5f6d 696e             x_min
-0008b080: 203d 2028 7365 6c66 2e70 322e 6765 7456   = (self.p2.getV
-0008b090: 6965 7742 6f78 2829 2e69 7465 6d42 6f75  iewBox().itemBou
-0008b0a0: 6e64 696e 6752 6563 7428 7365 6c66 2e6d  ndingRect(self.m
-0008b0b0: 5f69 7465 6d29 2e78 2829 202f 2028 7365  _item).x() / (se
-0008b0c0: 6c66 2e73 6361 6c65 202a 2073 656c 662e  lf.scale * self.
-0008b0d0: 7374 6b2e 785f 7078 7369 7a65 2929 2023  stk.x_pxsize)) #
-0008b0e0: 206d 696e 696d 756d 2078 2076 616c 7565   minimum x value
-0008b0f0: 2069 6e20 7078 0d0a 2020 2020 2020 2020   in px..        
-0008b100: 2020 2020 2020 2020 2020 2020 795f 6d69              y_mi
-0008b110: 6e20 3d20 2873 656c 662e 7032 2e67 6574  n = (self.p2.get
-0008b120: 5669 6577 426f 7828 292e 6974 656d 426f  ViewBox().itemBo
-0008b130: 756e 6469 6e67 5265 6374 2873 656c 662e  undingRect(self.
-0008b140: 6d5f 6974 656d 292e 7928 2920 2f20 2873  m_item).y() / (s
-0008b150: 656c 662e 7363 616c 6520 2a20 7365 6c66  elf.scale * self
-0008b160: 2e73 746b 2e79 5f70 7873 697a 6529 2920  .stk.y_pxsize)) 
-0008b170: 2320 6d69 6e69 6d75 6d20 7920 7661 6c75  # minimum y valu
-0008b180: 6520 696e 2070 780d 0a20 2020 2020 2020  e in px..       
-0008b190: 2020 2020 2020 2020 2020 2020 2078 5f6f               x_o
-0008b1a0: 6666 203d 2078 5f6d 696e 202d 2069 6e74  ff = x_min - int
-0008b1b0: 2878 5f6d 696e 290d 0a20 2020 2020 2020  (x_min)..       
-0008b1c0: 2020 2020 2020 2020 2020 2020 2079 5f6f               y_o
-0008b1d0: 6666 203d 2079 5f6d 696e 202d 2069 6e74  ff = y_min - int
-0008b1e0: 2879 5f6d 696e 290d 0a20 2020 2020 2020  (y_min)..       
-0008b1f0: 2020 2020 2020 2020 2020 2020 2078 5f70               x_p
-0008b200: 6f73 203d 206d 6f75 7365 506f 696e 742e  os = mousePoint.
-0008b210: 7828 2920 2f20 2873 656c 662e 7363 616c  x() / (self.scal
-0008b220: 6520 2a20 7365 6c66 2e73 746b 2e78 5f70  e * self.stk.x_p
-0008b230: 7873 697a 6529 202b 3120 2378 206d 6f75  xsize) +1 #x mou
-0008b240: 7365 706f 7320 696e 206e 756d 6265 7220  sepos in number 
-0008b250: 6f66 2072 6f77 730d 0a20 2020 2020 2020  of rows..       
-0008b260: 2020 2020 2020 2020 2020 2020 2079 5f70               y_p
-0008b270: 6f73 203d 206d 6f75 7365 506f 696e 742e  os = mousePoint.
-0008b280: 7928 2920 2f20 2873 656c 662e 7363 616c  y() / (self.scal
-0008b290: 6520 2a20 7365 6c66 2e73 746b 2e79 5f70  e * self.stk.y_p
-0008b2a0: 7873 697a 6529 202b 3120 2379 206d 6f75  xsize) +1 #y mou
-0008b2b0: 7365 706f 7320 696e 206e 756d 6265 7220  sepos in number 
-0008b2c0: 6f66 2072 6f77 730d 0a0d 0a20 2020 2020  of rows....     
-0008b2d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0008b2e0: 6620 6d6f 7573 6550 6f69 6e74 2e78 2829  f mousePoint.x()
-0008b2f0: 203c 2030 3a0d 0a20 2020 2020 2020 2020   < 0:..         
-0008b300: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-0008b310: 6920 3d20 696e 7428 785f 706f 7320 2d20  i = int(x_pos - 
-0008b320: 785f 6f66 662d 3129 0d0a 2020 2020 2020  x_off-1)..      
-0008b330: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0008b340: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-0008b350: 2020 2020 2020 2020 2020 2020 2078 6920               xi 
-0008b360: 3d20 696e 7428 785f 706f 7320 2d20 785f  = int(x_pos - x_
-0008b370: 6f66 6629 0d0a 2020 2020 2020 2020 2020  off)..          
-0008b380: 2020 2020 2020 2020 2020 6966 206d 6f75            if mou
-0008b390: 7365 506f 696e 742e 7928 2920 3c20 303a  sePoint.y() < 0:
-0008b3a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0008b3b0: 2020 2020 2020 2020 2020 7969 203d 2069            yi = i
-0008b3c0: 6e74 2879 5f70 6f73 202d 2079 5f6f 6666  nt(y_pos - y_off
-0008b3d0: 202d 3129 0d0a 2020 2020 2020 2020 2020   -1)..          
-0008b3e0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0008b3f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008b400: 2020 2020 2020 2020 2079 6920 3d20 696e           yi = in
-0008b410: 7428 795f 706f 7320 2d20 795f 6f66 6629  t(y_pos - y_off)
-0008b420: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0008b430: 2020 2020 2020 2020 7820 3d20 2878 6920          x = (xi 
-0008b440: 2d20 302e 3520 2b20 785f 6f66 6629 202a  - 0.5 + x_off) *
-0008b450: 2073 656c 662e 7363 616c 6520 2a20 7365   self.scale * se
-0008b460: 6c66 2e73 746b 2e78 5f70 7873 697a 650d  lf.stk.x_pxsize.
-0008b470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008b480: 2020 2020 2079 203d 2028 7969 202d 2030       y = (yi - 0
-0008b490: 2e35 202b 2079 5f6f 6666 2920 2a20 7365  .5 + y_off) * se
-0008b4a0: 6c66 2e73 6361 6c65 202a 2073 656c 662e  lf.scale * self.
-0008b4b0: 7374 6b2e 795f 7078 7369 7a65 0d0a 2020  stk.y_pxsize..  
-0008b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008b4d0: 2020 7074 203d 2051 7443 6f72 652e 5150    pt = QtCore.QP
-0008b4e0: 6f69 6e74 4628 782c 7929 0d0a 2020 2020  ointF(x,y)..    
-0008b4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008b500: 7365 6c66 2e4f 446c 6162 656c 2e73 6574  self.ODlabel.set
-0008b510: 5465 7874 2822 3c73 7061 6e20 7374 796c  Text("<span styl
-0008b520: 653d 2766 6f6e 742d 7369 7a65 3a20 3130  e='font-size: 10
-0008b530: 7074 3b20 636f 6c6f 723a 2072 6564 273e  pt; color: red'>
-0008b540: 2078 203d 2025 302e 3366 2020 c2b5 6d2c   x = %0.3f  ..m,
-0008b550: 203c 7370 616e 2073 7479 6c65 3d27 636f   <span style='co
-0008b560: 6c6f 723a 2072 6564 273e 2079 203d 2025  lor: red'> y = %
-0008b570: 302e 3366 20c2 b56d 3c2f 7370 616e 3e2c  0.3f ..m</span>,
-0008b580: 203c 7370 616e 2073 7479 6c65 3d27 636f   <span style='co
-0008b590: 6c6f 723a 2072 6564 273e 204f 4420 3d20  lor: red'> OD = 
-0008b5a0: 2530 2e32 663c 2f73 7061 6e3e 2220 2520  %0.2f</span>" % 
-0008b5b0: 2878 2f73 656c 662e 7363 616c 6520 2d20  (x/self.scale - 
-0008b5c0: 302e 3520 2a20 7365 6c66 2e73 746b 2e78  0.5 * self.stk.x
-0008b5d0: 5f70 7873 697a 652c 2079 2f73 656c 662e  _pxsize, y/self.
-0008b5e0: 7363 616c 6520 2d20 302e 3520 2a20 7365  scale - 0.5 * se
-0008b5f0: 6c66 2e73 746b 2e79 5f70 7873 697a 652c  lf.stk.y_pxsize,
-0008b600: 2073 656c 662e 4f44 5b78 692d 312d 696e   self.OD[xi-1-in
-0008b610: 7428 785f 6d69 6e29 2c79 692d 312d 696e  t(x_min),yi-1-in
-0008b620: 7428 795f 6d69 6e29 5d29 290d 0a20 2020  t(y_min)]))..   
-0008b630: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0008b640: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0008b650: 2020 2020 2020 2020 7820 3d20 696e 7428          x = int(
-0008b660: 6d6f 7573 6550 6f69 6e74 2e78 2829 2920  mousePoint.x()) 
-0008b670: 2b20 302e 350d 0a20 2020 2020 2020 2020  + 0.5..         
-0008b680: 2020 2020 2020 2020 2020 2079 203d 2069             y = i
-0008b690: 6e74 286d 6f75 7365 506f 696e 742e 7928  nt(mousePoint.y(
-0008b6a0: 2929 202b 2030 2e35 0d0a 2020 2020 2020  )) + 0.5..      
-0008b6b0: 2020 2020 2020 2020 2020 2020 2020 7074                pt
-0008b6c0: 203d 2051 7443 6f72 652e 5150 6f69 6e74   = QtCore.QPoint
-0008b6d0: 4628 782c 7929 0d0a 2020 2020 2020 2020  F(x,y)..        
-0008b6e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0008b6f0: 2e4f 446c 6162 656c 2e73 6574 5465 7874  .ODlabel.setText
-0008b700: 2822 3c73 7061 6e20 7374 796c 653d 2766  ("<span style='f
-0008b710: 6f6e 742d 7369 7a65 3a20 3130 7074 3b20  ont-size: 10pt; 
-0008b720: 636f 6c6f 723a 2072 6564 273e 2078 203d  color: red'> x =
-0008b730: 2025 302e 3066 2c20 3c73 7061 6e20 7374   %0.0f, <span st
-0008b740: 796c 653d 2763 6f6c 6f72 3a20 7265 6427  yle='color: red'
-0008b750: 3e20 7920 3d20 2530 2e30 663c 2f73 7061  > y = %0.0f</spa
-0008b760: 6e3e 2c20 3c73 7061 6e20 7374 796c 653d  n>, <span style=
-0008b770: 2763 6f6c 6f72 3a20 7265 6427 3e20 4f44  'color: red'> OD
-0008b780: 203d 2025 302e 3266 3c2f 7370 616e 3e22   = %0.2f</span>"
-0008b790: 2025 2028 782c 2079 2c73 656c 662e 4f44   % (x, y,self.OD
-0008b7a0: 5b69 6e74 2878 292c 696e 7428 7929 5d29  [int(x),int(y)])
-0008b7b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0008b7c0: 2020 2023 7072 696e 7428 782c 7929 0d0a     #print(x,y)..
-0008b7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008b7e0: 7365 6c66 2e76 4c69 6e65 2e73 6574 506f  self.vLine.setPo
-0008b7f0: 7328 7829 0d0a 2020 2020 2020 2020 2020  s(x)..          
-0008b800: 2020 2020 2020 7365 6c66 2e68 4c69 6e65        self.hLine
-0008b810: 2e73 6574 506f 7328 7929 0d0a 2020 2020  .setPos(y)..    
-0008b820: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0008b830: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0008b840: 656c 662e 4f44 6c61 6265 6c2e 7365 7454  elf.ODlabel.setT
-0008b850: 6578 7428 2222 290d 0a20 2020 2020 2020  ext("")..       
-0008b860: 2020 2020 2020 2020 2073 656c 662e 764c           self.vL
-0008b870: 696e 652e 7365 745a 5661 6c75 6528 2d31  ine.setZValue(-1
-0008b880: 3030 3029 0d0a 2020 2020 2020 2020 2020  000)..          
-0008b890: 2020 2020 2020 7365 6c66 2e68 4c69 6e65        self.hLine
-0008b8a0: 2e73 6574 5a56 616c 7565 282d 3130 3030  .setZValue(-1000
-0008b8b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0008b8c0: 2020 2073 656c 662e 764c 696e 652e 7365     self.vLine.se
-0008b8d0: 7450 656e 2822 3030 3030 2229 0d0a 2020  tPen("0000")..  
-0008b8e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0008b8f0: 6c66 2e68 4c69 6e65 2e73 6574 5065 6e28  lf.hLine.setPen(
-0008b900: 2230 3030 3022 290d 0a0d 0a20 2020 2064  "0000")....    d
-0008b910: 6566 2073 6574 4f44 6261 7228 7365 6c66  ef setODbar(self
-0008b920: 2c6d 696e 3d4e 6f6e 652c 6d61 783d 4e6f  ,min=None,max=No
-0008b930: 6e65 293a 0d0a 2020 2020 2020 2020 7365  ne):..        se
-0008b940: 6c66 2e63 6d2e 7365 7452 616e 6765 2878  lf.cm.setRange(x
-0008b950: 5261 6e67 653d 5b30 2c31 5d2c 2079 5261  Range=[0,1], yRa
-0008b960: 6e67 653d 5b6d 696e 2c6d 6178 5d2c 2075  nge=[min,max], u
-0008b970: 7064 6174 653d 4661 6c73 652c 2064 6973  pdate=False, dis
-0008b980: 6162 6c65 4175 746f 5261 6e67 653d 5472  ableAutoRange=Tr
-0008b990: 7565 2c70 6164 6469 6e67 3d30 290d 0a20  ue,padding=0).. 
-0008b9a0: 2020 2020 2020 2073 656c 662e 636d 696d         self.cmim
-0008b9b0: 672e 7365 7452 6563 7428 5174 436f 7265  g.setRect(QtCore
-0008b9c0: 2e51 5265 6374 4628 302c 6d69 6e2c 312c  .QRectF(0,min,1,
-0008b9d0: 6d61 782d 6d69 6e29 290d 0a0d 0a20 2020  max-min))....   
-0008b9e0: 2064 6566 206b 6579 5072 6573 7345 7665   def keyPressEve
-0008b9f0: 6e74 2873 656c 662c 2065 293a 0d0a 2020  nt(self, e):..  
-0008ba00: 2020 2020 2020 6d6f 6469 6669 6572 7320        modifiers 
-0008ba10: 3d20 5174 5769 6467 6574 732e 5141 7070  = QtWidgets.QApp
-0008ba20: 6c69 6361 7469 6f6e 2e6b 6579 626f 6172  lication.keyboar
-0008ba30: 644d 6f64 6966 6965 7273 2829 0d0a 2020  dModifiers()..  
-0008ba40: 2020 2020 2020 6966 206d 6f64 6966 6965        if modifie
-0008ba50: 7273 203d 3d20 5174 436f 7265 2e51 742e  rs == QtCore.Qt.
-0008ba60: 5368 6966 744d 6f64 6966 6965 723a 0d0a  ShiftModifier:..
-0008ba70: 2020 2020 2020 2020 2020 2020 6e6f 7368              nosh
-0008ba80: 6966 7420 3d20 4661 6c73 650d 0a20 2020  ift = False..   
-0008ba90: 2020 2020 2065 6c69 6620 6d6f 6469 6669       elif modifi
-0008baa0: 6572 7320 3d3d 2051 7443 6f72 652e 5174  ers == QtCore.Qt
-0008bab0: 2e4b 6579 7061 644d 6f64 6966 6965 723a  .KeypadModifier:
-0008bac0: 0d0a 2020 2020 2020 2020 2020 2020 6e6f  ..            no
-0008bad0: 7368 6966 7420 3d20 5472 7565 0d0a 2020  shift = True..  
-0008bae0: 2020 2020 2020 656c 6966 206d 6f64 6966        elif modif
-0008baf0: 6965 7273 203d 3d20 2851 7443 6f72 652e  iers == (QtCore.
-0008bb00: 5174 2e4b 6579 7061 644d 6f64 6966 6965  Qt.KeypadModifie
-0008bb10: 7220 7c0d 0a20 2020 2020 2020 2020 2020  r |..           
-0008bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008bb30: 5174 436f 7265 2e51 742e 5368 6966 744d  QtCore.Qt.ShiftM
-0008bb40: 6f64 6966 6965 7229 3a0d 0a20 2020 2020  odifier):..     
-0008bb50: 2020 2020 2020 206e 6f73 6869 6674 203d         noshift =
-0008bb60: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-0008bb70: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0008bb80: 2020 206e 6f73 6869 6674 203d 2054 7275     noshift = Tru
-0008bb90: 650d 0a20 2020 2020 2020 2069 6620 652e  e..        if e.
-0008bba0: 6b65 7928 2920 3d3d 2036 3720 616e 6420  key() == 67 and 
-0008bbb0: 2865 2e6d 6f64 6966 6965 7273 2829 2026  (e.modifiers() &
-0008bbc0: 2051 7443 6f72 652e 5174 2e43 6f6e 7472   QtCore.Qt.Contr
-0008bbd0: 6f6c 4d6f 6469 6669 6572 293a 0d0a 2020  olModifier):..  
-0008bbe0: 2020 2020 2020 2020 2020 7365 6c66 2e4f            self.O
-0008bbf0: 6e43 6f70 7928 290d 0a20 2020 2020 2020  nCopy()..       
-0008bc00: 2069 6620 652e 6b65 7928 2920 3d3d 2051   if e.key() == Q
-0008bc10: 742e 4b65 795f 5570 206f 7220 2865 2e6b  t.Key_Up or (e.k
-0008bc20: 6579 2829 203d 3d20 5174 436f 7265 2e51  ey() == QtCore.Q
-0008bc30: 742e 4b65 795f 3829 3a0d 0a20 2020 2020  t.Key_8):..     
-0008bc40: 2020 2020 2020 2069 6620 6e6f 7368 6966         if noshif
-0008bc50: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-0008bc60: 2020 2020 7365 6c66 2e70 6255 552e 636c      self.pbUU.cl
-0008bc70: 6963 6b28 290d 0a20 2020 2020 2020 2020  ick()..         
-0008bc80: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0008bc90: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0008bca0: 6255 2e63 6c69 636b 2829 0d0a 2020 2020  bU.click()..    
-0008bcb0: 2020 2020 656c 6966 2065 2e6b 6579 2829      elif e.key()
-0008bcc0: 203d 3d20 5174 2e4b 6579 5f44 6f77 6e20   == Qt.Key_Down 
-0008bcd0: 6f72 2028 652e 6b65 7928 2920 3d3d 2051  or (e.key() == Q
-0008bce0: 7443 6f72 652e 5174 2e4b 6579 5f32 293a  tCore.Qt.Key_2):
-0008bcf0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0008bd00: 206e 6f73 6869 6674 3a0d 0a20 2020 2020   noshift:..     
-0008bd10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0008bd20: 7062 4444 2e63 6c69 636b 2829 0d0a 2020  pbDD.click()..  
-0008bd30: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0008bd40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008bd50: 2073 656c 662e 7062 442e 636c 6963 6b28   self.pbD.click(
-0008bd60: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-0008bd70: 652e 6b65 7928 2920 3d3d 2051 742e 4b65  e.key() == Qt.Ke
-0008bd80: 795f 4c65 6674 206f 7220 2865 2e6b 6579  y_Left or (e.key
-0008bd90: 2829 203d 3d20 5174 436f 7265 2e51 742e  () == QtCore.Qt.
-0008bda0: 4b65 795f 3429 3a0d 0a20 2020 2020 2020  Key_4):..       
-0008bdb0: 2020 2020 2069 6620 6e6f 7368 6966 743a       if noshift:
-0008bdc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0008bdd0: 2020 7365 6c66 2e70 624c 4c2e 636c 6963    self.pbLL.clic
-0008bde0: 6b28 290d 0a20 2020 2020 2020 2020 2020  k()..           
-0008bdf0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0008be00: 2020 2020 2020 2020 7365 6c66 2e70 624c          self.pbL
-0008be10: 2e63 6c69 636b 2829 0d0a 2020 2020 2020  .click()..      
-0008be20: 2020 656c 6966 2065 2e6b 6579 2829 203d    elif e.key() =
-0008be30: 3d20 5174 2e4b 6579 5f52 6967 6874 206f  = Qt.Key_Right o
-0008be40: 7220 2865 2e6b 6579 2829 203d 3d20 5174  r (e.key() == Qt
-0008be50: 436f 7265 2e51 742e 4b65 795f 3629 3a0d  Core.Qt.Key_6):.
-0008be60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0008be70: 6e6f 7368 6966 743a 0d0a 2020 2020 2020  noshift:..      
-0008be80: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0008be90: 6252 522e 636c 6963 6b28 290d 0a20 2020  bRR.click()..   
-0008bea0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-0008beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008bec0: 7365 6c66 2e70 6252 2e63 6c69 636b 2829  self.pbR.click()
-0008bed0: 0d0a 2020 2020 2020 2020 656c 6966 2065  ..        elif e
-0008bee0: 2e6b 6579 2829 203d 3d20 5174 436f 7265  .key() == QtCore
-0008bef0: 2e51 742e 4b65 795f 486f 6d65 3a0d 0a20  .Qt.Key_Home:.. 
-0008bf00: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0008bf10: 7368 6966 743a 0d0a 2020 2020 2020 2020  shift:..        
-0008bf20: 2020 2020 2020 2020 7365 6c66 2e70 624c          self.pbL
-0008bf30: 4c55 552e 636c 6963 6b28 290d 0a20 2020  LUU.click()..   
-0008bf40: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-0008bf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008bf60: 7365 6c66 2e70 624c 552e 636c 6963 6b28  self.pbLU.click(
-0008bf70: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-0008bf80: 652e 6b65 7928 2920 3d3d 2051 7443 6f72  e.key() == QtCor
-0008bf90: 652e 5174 2e4b 6579 5f50 6167 6555 703a  e.Qt.Key_PageUp:
-0008bfa0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0008bfb0: 206e 6f73 6869 6674 3a0d 0a20 2020 2020   noshift:..     
-0008bfc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0008bfd0: 7062 5252 5555 2e63 6c69 636b 2829 0d0a  pbRRUU.click()..
-0008bfe0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0008bff0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0008c000: 2020 2073 656c 662e 7062 5255 2e63 6c69     self.pbRU.cli
-0008c010: 636b 2829 0d0a 2020 2020 2020 2020 656c  ck()..        el
-0008c020: 6966 2065 2e6b 6579 2829 203d 3d20 5174  if e.key() == Qt
-0008c030: 436f 7265 2e51 742e 4b65 795f 456e 643a  Core.Qt.Key_End:
-0008c040: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0008c050: 206e 6f73 6869 6674 3a0d 0a20 2020 2020   noshift:..     
-0008c060: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0008c070: 7062 4c4c 4444 2e63 6c69 636b 2829 0d0a  pbLLDD.click()..
-0008c080: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0008c090: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0008c0a0: 2020 2073 656c 662e 7062 4c44 2e63 6c69     self.pbLD.cli
-0008c0b0: 636b 2829 0d0a 2020 2020 2020 2020 656c  ck()..        el
-0008c0c0: 6966 2065 2e6b 6579 2829 203d 3d20 5174  if e.key() == Qt
-0008c0d0: 436f 7265 2e51 742e 4b65 795f 5061 6765  Core.Qt.Key_Page
-0008c0e0: 446f 776e 3a0d 0a20 2020 2020 2020 2020  Down:..         
-0008c0f0: 2020 2069 6620 6e6f 7368 6966 743a 0d0a     if noshift:..
-0008c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008c110: 7365 6c66 2e70 6252 5244 442e 636c 6963  self.pbRRDD.clic
-0008c120: 6b28 290d 0a20 2020 2020 2020 2020 2020  k()..           
-0008c130: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0008c140: 2020 2020 2020 2020 7365 6c66 2e70 6252          self.pbR
-0008c150: 442e 636c 6963 6b28 290d 0a20 2020 2020  D.click()..     
-0008c160: 2020 2065 6c69 6620 652e 6b65 7928 2920     elif e.key() 
-0008c170: 3d3d 2051 7443 6f72 652e 5174 2e4b 6579  == QtCore.Qt.Key
-0008c180: 5f43 6c65 6172 3a0d 0a20 2020 2020 2020  _Clear:..       
-0008c190: 2020 2020 2020 2020 2073 656c 662e 7062           self.pb
-0008c1a0: 5253 542e 636c 6963 6b28 290d 0a0d 0a20  RST.click().... 
-0008c1b0: 2020 2064 6566 2043 6c65 6172 2873 656c     def Clear(sel
-0008c1c0: 6629 3a0d 0a20 2020 2020 2020 2074 7279  f):..        try
-0008c1d0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0008c1e0: 656c 662e 736c 6964 6572 5f65 6e67 2e76  elf.slider_eng.v
-0008c1f0: 616c 7565 4368 616e 6765 642e 6469 7363  alueChanged.disc
-0008c200: 6f6e 6e65 6374 2829 0d0a 2020 2020 2020  onnect()..      
-0008c210: 2020 2020 2020 7365 6c66 2e71 6c69 7374        self.qlist
-0008c220: 6368 616e 6765 642e 6469 7363 6f6e 6e65  changed.disconne
-0008c230: 6374 2829 0d0a 2020 2020 2020 2020 6578  ct()..        ex
-0008c240: 6365 7074 3a0d 0a20 2020 2020 2020 2020  cept:..         
-0008c250: 2020 2070 6173 730d 0a20 2020 2020 2020     pass..       
-0008c260: 2073 656c 662e 7072 656c 7374 203d 205b   self.prelst = [
-0008c270: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
-0008c280: 706f 7374 6c73 7420 3d5b 5d0d 0a20 2020  postlst =[]..   
-0008c290: 2020 2020 2073 656c 662e 7374 6b2e 7368       self.stk.sh
-0008c2a0: 6966 7473 203d 205b 5d0d 0a20 2020 2020  ifts = []..     
-0008c2b0: 2020 2073 656c 662e 7374 6b2e 6162 7364     self.stk.absd
-0008c2c0: 6174 615f 7368 6966 7465 643d 205b 5d0d  ata_shifted= [].
-0008c2d0: 0a20 2020 2020 2020 2073 656c 662e 7031  .        self.p1
-0008c2e0: 2e63 6c65 6172 2829 0d0a 2020 2020 2020  .clear()..      
-0008c2f0: 2020 7365 6c66 2e70 322e 636c 6561 7228    self.p2.clear(
-0008c300: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0008c310: 636d 2e63 6c65 6172 2829 0d0a 2020 2020  cm.clear()..    
-0008c320: 2020 2020 7365 6c66 2e4d 6170 5365 6c65      self.MapSele
-0008c330: 6374 5769 6467 6574 312e 636c 6561 7228  ctWidget1.clear(
-0008c340: 290d 0a0d 0a20 2020 2064 6566 204c 6f61  )....    def Loa
-0008c350: 6445 6e74 7269 6573 2873 656c 6629 3a20  dEntries(self): 
-0008c360: 2320 4361 6c6c 6564 2077 6865 6e20 6672  # Called when fr
-0008c370: 6573 6820 6461 7461 2061 7265 206c 6f61  esh data are loa
-0008c380: 6465 642e 0d0a 2020 2020 2020 2020 7365  ded...        se
-0008c390: 6c66 2e4f 4448 6967 6853 7069 6e42 6f78  lf.ODHighSpinBox
-0008c3a0: 2e73 6574 456e 6162 6c65 6428 4661 6c73  .setEnabled(Fals
-0008c3b0: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-0008c3c0: 2e4f 444c 6f77 5370 696e 426f 782e 7365  .ODLowSpinBox.se
-0008c3d0: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
-0008c3e0: 0a20 2020 2020 2020 2073 656c 662e 7062  .        self.pb
-0008c3f0: 5253 544f 442e 7365 7445 6e61 626c 6564  RSTOD.setEnabled
-0008c400: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
-0008c410: 2073 656c 662e 6669 6c74 6572 5370 696e   self.filterSpin
-0008c420: 426f 782e 7365 7445 6e61 626c 6564 2846  Box.setEnabled(F
-0008c430: 616c 7365 290d 0a20 2020 2020 2020 2073  alse)..        s
-0008c440: 656c 662e 7062 4578 7044 6174 612e 7365  elf.pbExpData.se
-0008c450: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
-0008c460: 0a20 2020 2020 2020 2073 656c 662e 7062  .        self.pb
-0008c470: 4578 7049 6d67 2e73 6574 456e 6162 6c65  ExpImg.setEnable
-0008c480: 6428 4661 6c73 6529 0d0a 2020 2020 2020  d(False)..      
-0008c490: 2020 7365 6c66 2e70 6243 6c72 5365 6c2e    self.pbClrSel.
-0008c4a0: 7365 7445 6e61 626c 6564 2846 616c 7365  setEnabled(False
-0008c4b0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0008c4c0: 7374 6b2e 6162 7364 6174 615f 7368 6966  stk.absdata_shif
-0008c4d0: 7465 6420 3d20 7365 6c66 2e73 746b 2e61  ted = self.stk.a
-0008c4e0: 6273 6461 7461 2e63 6f70 7928 290d 0a20  bsdata.copy().. 
-0008c4f0: 2020 2020 2020 2073 656c 662e 7031 2e61         self.p1.a
-0008c500: 6464 4974 656d 2873 656c 662e 695f 6974  ddItem(self.i_it
-0008c510: 656d 290d 0a20 2020 2020 2020 2066 6f72  em)..        for
-0008c520: 2069 2c65 2069 6e20 656e 756d 6572 6174   i,e in enumerat
-0008c530: 6528 7365 6c66 2e73 746b 2e65 7629 3a20  e(self.stk.ev): 
-0008c540: 2320 4669 6c6c 2051 4c69 7374 2077 6974  # Fill QList wit
-0008c550: 6820 656e 6572 6769 6573 0d0a 2020 2020  h energies..    
-0008c560: 2020 2020 2020 2020 7365 6c66 2e73 746b          self.stk
-0008c570: 2e73 6869 6674 732e 6170 7065 6e64 285b  .shifts.append([
-0008c580: 312c 302c 2830 2e30 2c30 2e30 295d 2920  1,0,(0.0,0.0)]) 
-0008c590: 2363 6865 636b 6564 205b 302c 315d 3b20  #checked [0,1]; 
-0008c5a0: 7072 652c 2070 6f73 742c 2075 6e64 6566  pre, post, undef
-0008c5b0: 696e 6564 2073 7461 7465 2066 6f72 206d  ined state for m
-0008c5c0: 6170 205b 2d31 2c31 2c30 5d2c 2878 7368  ap [-1,1,0],(xsh
-0008c5d0: 6966 7420 5b66 6c6f 6174 5d2c 7973 6869  ift [float],yshi
-0008c5e0: 6674 205b 666c 6f61 745d 290d 0a20 2020  ft [float])..   
-0008c5f0: 2020 2020 2020 2020 2069 7465 6d20 3d20           item = 
-0008c600: 5174 5769 6467 6574 732e 514c 6973 7457  QtWidgets.QListW
-0008c610: 6964 6765 7449 7465 6d28 7374 7228 696e  idgetItem(str(in
-0008c620: 7428 6929 292e 7a66 696c 6c28 3329 2b22  t(i)).zfill(3)+"
-0008c630: 2020 2020 2061 7420 2020 2020 2220 2b20       at     " + 
-0008c640: 666f 726d 6174 2865 2c20 272e 3266 2729  format(e, '.2f')
-0008c650: 202b 2022 2065 5620 2020 2020 222b 222b   + " eV     "+"+
-0008c660: 302e 3022 2b22 2020 2020 2b30 2e30 2229  0.0"+"    +0.0")
-0008c670: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0008c680: 6c66 2e4d 6170 5365 6c65 6374 5769 6467  lf.MapSelectWidg
-0008c690: 6574 312e 6164 6449 7465 6d28 6974 656d  et1.addItem(item
-0008c6a0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0008c6b0: 736c 6964 6572 5f65 6e67 2e76 616c 7565  slider_eng.value
-0008c6c0: 4368 616e 6765 645b 696e 745d 2e63 6f6e  Changed[int].con
-0008c6d0: 6e65 6374 2873 656c 662e 4f6e 5363 726f  nect(self.OnScro
-0008c6e0: 6c6c 456e 6729 0d0a 2020 2020 2020 2020  llEng)..        
-0008c6f0: 7365 6c66 2e71 6c69 7374 6368 616e 6765  self.qlistchange
-0008c700: 642e 636f 6e6e 6563 7428 7365 6c66 2e71  d.connect(self.q
-0008c710: 4c69 7374 4368 616e 6765 4861 6e64 6c65  ListChangeHandle
-0008c720: 7229 0d0a 2020 2020 2020 2020 7365 6c66  r)..        self
-0008c730: 2e4f 6e53 6372 6f6c 6c45 6e67 2830 2920  .OnScrollEng(0) 
-0008c740: 2320 506c 6f74 2066 6972 7374 2069 6d61  # Plot first ima
-0008c750: 6765 2026 2073 6574 2053 6372 6f6c 6c62  ge & set Scrollb
-0008c760: 6172 0d0a 2020 2020 2020 2020 7365 6c66  ar..        self
-0008c770: 2e4f 6e4d 6574 7269 6353 6361 6c65 2873  .OnMetricScale(s
-0008c780: 656c 662e 4d65 7472 6963 4368 6563 6b42  elf.MetricCheckB
-0008c790: 6f78 2e69 7343 6865 636b 6564 2829 2c20  ox.isChecked(), 
-0008c7a0: 5472 7565 2c20 4661 6c73 6529 0d0a 2020  True, False)..  
-0008c7b0: 2020 2020 2020 7365 6c66 2e70 6253 656c        self.pbSel
-0008c7c0: 6672 6f6d 5370 6563 2e73 6574 456e 6162  fromSpec.setEnab
-0008c7d0: 6c65 6428 5472 7565 290d 0a20 2020 2020  led(True)..     
-0008c7e0: 2020 2073 656c 662e 7062 5365 6c66 726f     self.pbSelfro
-0008c7f0: 6d53 7065 632e 636c 6963 6b65 642e 636f  mSpec.clicked.co
-0008c800: 6e6e 6563 7428 7365 6c66 2e4f 6e53 656c  nnect(self.OnSel
-0008c810: 6672 6f6d 5370 6563 290d 0a20 2020 2064  fromSpec)..    d
-0008c820: 6566 2055 7064 6174 6545 6e74 7279 2873  ef UpdateEntry(s
-0008c830: 656c 662c 726f 7729 3a0d 0a20 2020 2020  elf,row):..     
-0008c840: 2020 2073 656c 662e 4d61 7053 656c 6563     self.MapSelec
-0008c850: 7457 6964 6765 7431 2e69 7465 6d28 726f  tWidget1.item(ro
-0008c860: 7729 2e73 6574 5465 7874 2873 7472 2869  w).setText(str(i
-0008c870: 6e74 2872 6f77 2929 2e7a 6669 6c6c 2833  nt(row)).zfill(3
-0008c880: 292b 2220 2020 2020 6174 2020 2020 2022  )+"     at     "
-0008c890: 202b 2066 6f72 6d61 7428 7365 6c66 2e73   + format(self.s
-0008c8a0: 746b 2e65 765b 726f 775d 2c20 272e 3266  tk.ev[row], '.2f
-0008c8b0: 2729 202b 2022 2065 5620 2020 2020 222b  ') + " eV     "+
-0008c8c0: 666f 726d 6174 2873 656c 662e 7374 6b2e  format(self.stk.
-0008c8d0: 7368 6966 7473 5b72 6f77 5d5b 325d 5b30  shifts[row][2][0
-0008c8e0: 5d2c 2027 2b2e 3166 2729 2b22 2020 2020  ], '+.1f')+"    
-0008c8f0: 222b 666f 726d 6174 2873 656c 662e 7374  "+format(self.st
-0008c900: 6b2e 7368 6966 7473 5b72 6f77 5d5b 325d  k.shifts[row][2]
-0008c910: 5b31 5d2c 2027 2b2e 3166 2729 290d 0a20  [1], '+.1f')).. 
-0008c920: 2020 2020 2020 2023 7365 6c66 2e4d 6170         #self.Map
-0008c930: 5365 6c65 6374 5769 6467 6574 312e 6164  SelectWidget1.ad
-0008c940: 6449 7465 6d28 7365 6c66 2e4d 6170 5365  dItem(self.MapSe
-0008c950: 6c65 6374 5769 6467 6574 312e 6974 656d  lectWidget1.item
-0008c960: 2872 6f77 2929 0d0a 2020 2020 2020 2020  (row))..        
-0008c970: 7365 6c66 2e69 5f69 7465 6d2e 7365 7449  self.i_item.setI
-0008c980: 6d61 6765 2873 656c 662e 5368 6966 7428  mage(self.Shift(
-0008c990: 726f 7729 290d 0a20 2020 2064 6566 2052  row))..    def R
-0008c9a0: 6573 6574 416c 6c49 7465 6d73 2873 656c  esetAllItems(sel
-0008c9b0: 662c 7769 6467 6574 293a 0d0a 2020 2020  f,widget):..    
-0008c9c0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-0008c9d0: 6765 2877 6964 6765 742e 636f 756e 7428  ge(widget.count(
-0008c9e0: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
-0008c9f0: 2077 6964 6765 742e 6974 656d 2869 292e   widget.item(i).
-0008ca00: 7365 7446 6f72 6567 726f 756e 6428 5174  setForeground(Qt
-0008ca10: 4775 692e 5143 6f6c 6f72 2830 2c20 302c  Gui.QColor(0, 0,
-0008ca20: 2030 2c20 3132 3829 290d 0a20 2020 2064   0, 128))..    d
-0008ca30: 6566 204f 6e53 6372 6f6c 6c45 6e67 2873  ef OnScrollEng(s
-0008ca40: 656c 662c 2076 616c 7565 293a 0d0a 2020  elf, value):..  
-0008ca50: 2020 2020 2020 7365 6c66 2e73 6c69 6465        self.slide
-0008ca60: 725f 656e 672e 626c 6f63 6b53 6967 6e61  r_eng.blockSigna
-0008ca70: 6c73 2854 7275 6529 0d0a 2020 2020 2020  ls(True)..      
-0008ca80: 2020 7365 6c66 2e73 6c69 6465 725f 656e    self.slider_en
-0008ca90: 672e 7365 7456 616c 7565 2876 616c 7565  g.setValue(value
-0008caa0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0008cab0: 736c 6964 6572 5f65 6e67 2e62 6c6f 636b  slider_eng.block
-0008cac0: 5369 676e 616c 7328 4661 6c73 6529 0d0a  Signals(False)..
-0008cad0: 2020 2020 2020 2020 7365 6c66 2e4d 6170          self.Map
-0008cae0: 5365 6c65 6374 5769 6467 6574 312e 7365  SelectWidget1.se
-0008caf0: 7443 7572 7265 6e74 526f 7728 7661 6c75  tCurrentRow(valu
-0008cb00: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-0008cb10: 2e52 6573 6574 416c 6c49 7465 6d73 2873  .ResetAllItems(s
-0008cb20: 656c 662e 4d61 7053 656c 6563 7457 6964  elf.MapSelectWid
-0008cb30: 6765 7431 290d 0a20 2020 2020 2020 2073  get1)..        s
-0008cb40: 656c 662e 6965 7620 3d20 7661 6c75 650d  elf.iev = value.
-0008cb50: 0a20 2020 2020 2020 2073 656c 662e 7031  .        self.p1
-0008cb60: 2e74 6974 6c65 4c61 6265 6c2e 6974 656d  .titleLabel.item
-0008cb70: 2e73 6574 5465 7874 5769 6474 6828 7365  .setTextWidth(se
-0008cb80: 6c66 2e70 312e 7769 6474 6828 2920 2a20  lf.p1.width() * 
-0008cb90: 302e 3729 0d0a 2020 2020 2020 2020 7365  0.7)..        se
-0008cba0: 6c66 2e70 322e 7469 746c 654c 6162 656c  lf.p2.titleLabel
-0008cbb0: 2e69 7465 6d2e 7365 7454 6578 7457 6964  .item.setTextWid
-0008cbc0: 7468 2873 656c 662e 7032 2e77 6964 7468  th(self.p2.width
-0008cbd0: 2829 202a 2030 2e37 290d 0a20 2020 2020  () * 0.7)..     
-0008cbe0: 2020 2023 7365 6c66 2e63 616e 7661 732e     #self.canvas.
-0008cbf0: 7265 7369 7a65 4576 656e 7428 4e6f 6e65  resizeEvent(None
-0008cc00: 290d 0a20 2020 2020 2020 2069 6620 7365  )..        if se
-0008cc10: 6c66 2e63 6f6d 2e73 7461 636b 5f6c 6f61  lf.com.stack_loa
-0008cc20: 6465 6420 3d3d 2031 3a0d 0a20 2020 2020  ded == 1:..     
-0008cc30: 2020 2020 2020 2073 656c 662e 7031 2e74         self.p1.t
-0008cc40: 6974 6c65 4c61 6265 6c2e 7365 7454 6578  itleLabel.setTex
-0008cc50: 7428 223c 6365 6e74 6572 3e49 6d61 6765  t("<center>Image
-0008cc60: 2061 7420 656e 6572 6779 207b 303a 352e   at energy {0:5.
-0008cc70: 3266 7d20 6556 3c2f 6365 6e74 6572 3e22  2f} eV</center>"
-0008cc80: 2e66 6f72 6d61 7428 666c 6f61 7428 7365  .format(float(se
-0008cc90: 6c66 2e73 746b 2e65 765b 7365 6c66 2e69  lf.stk.ev[self.i
-0008cca0: 6576 5d29 292c 7369 7a65 3d27 3130 7074  ev])),size='10pt
-0008ccb0: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
-0008ccc0: 7365 6c66 2e69 5f69 7465 6d2e 7365 7449  self.i_item.setI
-0008ccd0: 6d61 6765 2873 656c 662e 5368 6966 7428  mage(self.Shift(
-0008cce0: 696e 7428 7365 6c66 2e69 6576 2929 290d  int(self.iev))).
-0008ccf0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0008cd00: 662e 4d61 7053 656c 6563 7457 6964 6765  f.MapSelectWidge
-0008cd10: 7431 2e69 7465 6d28 7661 6c75 6529 2e73  t1.item(value).s
-0008cd20: 6574 466f 7265 6772 6f75 6e64 2851 7447  etForeground(QtG
-0008cd30: 7569 2e51 436f 6c6f 7228 302c 2030 2c20  ui.QColor(0, 0, 
-0008cd40: 302c 2032 3535 2929 0d0a 0d0a 2020 2020  0, 255))....    
-0008cd50: 6465 6620 4f6e 4372 6f70 4342 2873 656c  def OnCropCB(sel
-0008cd60: 662c 2076 616c 7565 3d54 7275 6529 3a0d  f, value=True):.
-0008cd70: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0008cd80: 2e63 6f6d 2e73 7461 636b 5f6c 6f61 6465  .com.stack_loade
-0008cd90: 6420 3d3d 2031 3a0d 0a20 2020 2020 2020  d == 1:..       
-0008cda0: 2020 2020 2069 6620 7661 6c75 6520 3d3d       if value ==
-0008cdb0: 2054 7275 653a 0d0a 2020 2020 2020 2020   True:..        
-0008cdc0: 2020 2020 2020 2020 7365 6c66 2e63 726f          self.cro
-0008cdd0: 7066 6c61 6720 3d20 5472 7565 0d0a 2020  pflag = True..  
-0008cde0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0008cdf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008ce00: 2073 656c 662e 6372 6f70 666c 6167 203d   self.cropflag =
-0008ce10: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-0008ce20: 2020 2020 7365 6c66 2e53 686f 774d 6170      self.ShowMap
-0008ce30: 2873 656c 662e 7072 656c 7374 2c20 7365  (self.prelst, se
-0008ce40: 6c66 2e70 6f73 746c 7374 290d 0a0d 0a0d  lf.postlst).....
-0008ce50: 0a20 2020 2064 6566 204f 6e4d 6574 7269  .    def OnMetri
-0008ce60: 6353 6361 6c65 2873 656c 662c 2073 6574  cScale(self, set
-0008ce70: 6d65 7472 6963 3d20 5472 7565 2c20 7a65  metric= True, ze
-0008ce80: 726f 6f72 6967 696e 3d20 5472 7565 2c20  roorigin= True, 
-0008ce90: 7371 7561 7265 3d20 4661 6c73 6529 3a0d  square= False):.
-0008cea0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0008ceb0: 2e63 6f6d 2e73 7461 636b 5f6c 6f61 6465  .com.stack_loade
-0008cec0: 6420 3d3d 2031 3a0d 0a20 2020 2020 2020  d == 1:..       
-0008ced0: 2020 2020 2069 6620 7365 746d 6574 7269       if setmetri
-0008cee0: 633d 3d54 7275 653a 0d0a 2020 2020 2020  c==True:..      
-0008cef0: 2020 2020 2020 2020 2020 7365 6c66 2e53            self.S
-0008cf00: 7175 6172 6550 7843 6865 636b 426f 782e  quarePxCheckBox.
-0008cf10: 7365 7456 6973 6962 6c65 2846 616c 7365  setVisible(False
-0008cf20: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0008cf30: 2020 2073 656c 662e 5a65 726f 4f72 6967     self.ZeroOrig
-0008cf40: 696e 4368 6563 6b42 6f78 2e73 6574 5669  inCheckBox.setVi
-0008cf50: 7369 626c 6528 5472 7565 290d 0a20 2020  sible(True)..   
-0008cf60: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0008cf70: 662e 7031 2e73 6574 4173 7065 6374 4c6f  f.p1.setAspectLo
-0008cf80: 636b 6564 286c 6f63 6b3d 5472 7565 2c20  cked(lock=True, 
-0008cf90: 7261 7469 6f3d 3129 0d0a 2020 2020 2020  ratio=1)..      
-0008cfa0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0008cfb0: 322e 7365 7441 7370 6563 744c 6f63 6b65  2.setAspectLocke
-0008cfc0: 6428 6c6f 636b 3d54 7275 652c 2072 6174  d(lock=True, rat
-0008cfd0: 696f 3d31 290d 0a20 2020 2020 2020 2020  io=1)..         
-0008cfe0: 2020 2020 2020 2069 6620 6e6f 7420 7a65         if not ze
-0008cff0: 726f 6f72 6967 696e 3a0d 0a20 2020 2020  roorigin:..     
-0008d000: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-0008d010: 5f73 7461 7274 203d 2073 656c 662e 7374  _start = self.st
-0008d020: 6b2e 785f 7374 6172 742a 7365 6c66 2e73  k.x_start*self.s
-0008d030: 6361 6c65 0d0a 2020 2020 2020 2020 2020  cale..          
-0008d040: 2020 2020 2020 2020 2020 795f 7374 6172            y_star
-0008d050: 7420 3d20 7365 6c66 2e73 746b 2e79 5f73  t = self.stk.y_s
-0008d060: 7461 7274 2a73 656c 662e 7363 616c 650d  tart*self.scale.
-0008d070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008d080: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0008d090: 2020 2020 2020 2020 2020 2020 785f 7374              x_st
-0008d0a0: 6172 7420 3d20 300d 0a20 2020 2020 2020  art = 0..       
-0008d0b0: 2020 2020 2020 2020 2020 2020 2079 5f73               y_s
-0008d0c0: 7461 7274 203d 2030 0d0a 2020 2020 2020  tart = 0..      
-0008d0d0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0008d0e0: 7931 2e73 6574 4c61 6265 6c28 7465 7874  y1.setLabel(text
-0008d0f0: 3d22 7922 2c20 756e 6974 733d 226d 2229  ="y", units="m")
-0008d100: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0008d110: 2020 7365 6c66 2e61 7831 2e73 6574 4c61    self.ax1.setLa
-0008d120: 6265 6c28 7465 7874 3d22 7822 2c20 756e  bel(text="x", un
-0008d130: 6974 733d 226d 2229 0d0a 2020 2020 2020  its="m")..      
-0008d140: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0008d150: 7932 2e73 6574 4c61 6265 6c28 7465 7874  y2.setLabel(text
-0008d160: 3d22 7922 2c20 756e 6974 733d 226d 2229  ="y", units="m")
-0008d170: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0008d180: 2020 7365 6c66 2e61 7832 2e73 6574 4c61    self.ax2.setLa
-0008d190: 6265 6c28 7465 7874 3d22 7822 2c20 756e  bel(text="x", un
-0008d1a0: 6974 733d 226d 2229 0d0a 0d0a 2020 2020  its="m")....    
-0008d1b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0008d1c0: 2e69 5f69 7465 6d2e 7365 7452 6563 7428  .i_item.setRect(
-0008d1d0: 5174 436f 7265 2e51 5265 6374 4628 785f  QtCore.QRectF(x_
-0008d1e0: 7374 6172 742c 2079 5f73 7461 7274 2c20  start, y_start, 
-0008d1f0: 7365 6c66 2e73 6361 6c65 2a73 656c 662e  self.scale*self.
-0008d200: 7374 6b2e 6e5f 636f 6c73 2a73 656c 662e  stk.n_cols*self.
-0008d210: 7374 6b2e 785f 7078 7369 7a65 2c20 7365  stk.x_pxsize, se
-0008d220: 6c66 2e73 6361 6c65 2a73 656c 662e 7374  lf.scale*self.st
-0008d230: 6b2e 6e5f 726f 7773 2a73 656c 662e 7374  k.n_rows*self.st
-0008d240: 6b2e 795f 7078 7369 7a65 2929 0d0a 2020  k.y_pxsize))..  
-0008d250: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0008d260: 2068 6173 6174 7472 2873 656c 662c 2022   hasattr(self, "
-0008d270: 4f44 2229 3a0d 0a20 2020 2020 2020 2020  OD"):..         
-0008d280: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0008d290: 6d5f 6974 656d 2e73 6574 5265 6374 2851  m_item.setRect(Q
-0008d2a0: 7443 6f72 652e 5152 6563 7446 2878 5f73  tCore.QRectF(x_s
-0008d2b0: 7461 7274 2c20 795f 7374 6172 742c 2073  tart, y_start, s
-0008d2c0: 656c 662e 7363 616c 652a 6e70 2e73 6861  elf.scale*np.sha
-0008d2d0: 7065 2873 656c 662e 4f44 295b 305d 2a73  pe(self.OD)[0]*s
-0008d2e0: 656c 662e 7374 6b2e 785f 7078 7369 7a65  elf.stk.x_pxsize
-0008d2f0: 2c20 7365 6c66 2e73 6361 6c65 2a6e 702e  , self.scale*np.
-0008d300: 7368 6170 6528 7365 6c66 2e4f 4429 5b31  shape(self.OD)[1
-0008d310: 5d2a 7365 6c66 2e73 746b 2e79 5f70 7873  ]*self.stk.y_pxs
-0008d320: 697a 6529 290d 0a20 2020 2020 2020 2020  ize))..         
-0008d330: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0008d340: 7365 7443 726f 7373 6861 6972 2829 0d0a  setCrosshair()..
-0008d350: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0008d360: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0008d370: 2020 2073 656c 662e 5a65 726f 4f72 6967     self.ZeroOrig
-0008d380: 696e 4368 6563 6b42 6f78 2e73 6574 5669  inCheckBox.setVi
-0008d390: 7369 626c 6528 4661 6c73 6529 0d0a 2020  sible(False)..  
-0008d3a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0008d3b0: 6c66 2e53 7175 6172 6550 7843 6865 636b  lf.SquarePxCheck
-0008d3c0: 426f 782e 7365 7456 6973 6962 6c65 2854  Box.setVisible(T
-0008d3d0: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
-0008d3e0: 2020 2020 2020 6966 2073 7175 6172 6520        if square 
-0008d3f0: 3d3d 2054 7275 653a 0d0a 2020 2020 2020  == True:..      
-0008d400: 2020 2020 2020 2020 2020 2020 2020 6173                as
-0008d410: 7065 6374 203d 2031 0d0a 2020 2020 2020  pect = 1..      
-0008d420: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0008d430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008d440: 2020 2020 2061 7370 6563 7420 3d20 7365       aspect = se
-0008d450: 6c66 2e73 746b 2e78 5f70 7873 697a 652f  lf.stk.x_pxsize/
-0008d460: 7365 6c66 2e73 746b 2e79 5f70 7873 697a  self.stk.y_pxsiz
-0008d470: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-0008d480: 2020 2020 2020 2023 7072 696e 7428 6173         #print(as
-0008d490: 7065 6374 290d 0a20 2020 2020 2020 2020  pect)..         
-0008d4a0: 2020 2020 2020 2073 656c 662e 7031 2e73         self.p1.s
-0008d4b0: 6574 4173 7065 6374 4c6f 636b 6564 286c  etAspectLocked(l
-0008d4c0: 6f63 6b3d 5472 7565 2c20 7261 7469 6f3d  ock=True, ratio=
-0008d4d0: 6173 7065 6374 290d 0a20 2020 2020 2020  aspect)..       
-0008d4e0: 2020 2020 2020 2020 2073 656c 662e 6179           self.ay
-0008d4f0: 312e 7365 744c 6162 656c 2874 6578 743d  1.setLabel(text=
-0008d500: 2279 222c 2075 6e69 7473 3d22 7078 2229  "y", units="px")
-0008d510: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0008d520: 2020 7365 6c66 2e61 7831 2e73 6574 4c61    self.ax1.setLa
-0008d530: 6265 6c28 7465 7874 3d22 7822 2c20 756e  bel(text="x", un
-0008d540: 6974 733d 2270 7822 290d 0a20 2020 2020  its="px")..     
-0008d550: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0008d560: 695f 6974 656d 2e73 6574 5265 6374 2851  i_item.setRect(Q
-0008d570: 7443 6f72 652e 5152 6563 7446 2830 2c20  tCore.QRectF(0, 
-0008d580: 302c 2073 656c 662e 7374 6b2e 6e5f 636f  0, self.stk.n_co
-0008d590: 6c73 2c20 7365 6c66 2e73 746b 2e6e 5f72  ls, self.stk.n_r
-0008d5a0: 6f77 7329 290d 0a20 2020 2020 2020 2020  ows))..         
-0008d5b0: 2020 2020 2020 2069 6620 6861 7361 7474         if hasatt
-0008d5c0: 7228 7365 6c66 2c20 224f 4422 293a 0d0a  r(self, "OD"):..
-0008d5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008d5e0: 2020 2020 7365 6c66 2e61 7932 2e73 6574      self.ay2.set
-0008d5f0: 4c61 6265 6c28 7465 7874 3d22 7922 2c20  Label(text="y", 
-0008d600: 756e 6974 733d 2270 7822 290d 0a20 2020  units="px")..   
-0008d610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008d620: 2073 656c 662e 6178 322e 7365 744c 6162   self.ax2.setLab
-0008d630: 656c 2874 6578 743d 2278 222c 2075 6e69  el(text="x", uni
-0008d640: 7473 3d22 7078 2229 0d0a 2020 2020 2020  ts="px")..      
-0008d650: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0008d660: 6c66 2e70 322e 7365 7441 7370 6563 744c  lf.p2.setAspectL
-0008d670: 6f63 6b65 6428 6c6f 636b 3d54 7275 652c  ocked(lock=True,
-0008d680: 2072 6174 696f 3d61 7370 6563 7429 0d0a   ratio=aspect)..
-0008d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008d6a0: 2020 2020 7365 6c66 2e6d 5f69 7465 6d2e      self.m_item.
-0008d6b0: 7365 7452 6563 7428 5174 436f 7265 2e51  setRect(QtCore.Q
-0008d6c0: 5265 6374 4628 302c 2030 2c20 6e70 2e73  RectF(0, 0, np.s
-0008d6d0: 6861 7065 2873 656c 662e 4f44 295b 305d  hape(self.OD)[0]
-0008d6e0: 2c20 6e70 2e73 6861 7065 2873 656c 662e  , np.shape(self.
-0008d6f0: 4f44 295b 315d 2929 0d0a 2020 2020 6465  OD)[1]))..    de
-0008d700: 6620 4f6e 436c 7253 656c 6563 7469 6f6e  f OnClrSelection
-0008d710: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-0008d720: 2066 6f72 2072 6f77 2069 6e20 7365 6c66   for row in self
-0008d730: 2e70 7265 6c73 7420 2b20 7365 6c66 2e70  .prelst + self.p
-0008d740: 6f73 746c 7374 3a0d 0a20 2020 2020 2020  ostlst:..       
-0008d750: 2020 2020 2073 656c 662e 4d61 7053 656c       self.MapSel
-0008d760: 6563 7457 6964 6765 7431 2e69 7465 6d28  ectWidget1.item(
-0008d770: 726f 7729 2e73 6574 4261 636b 6772 6f75  row).setBackgrou
-0008d780: 6e64 2851 7447 7569 2e51 436f 6c6f 7228  nd(QtGui.QColor(
-0008d790: 302c 2030 2c20 302c 2030 2929 0d0a 2020  0, 0, 0, 0))..  
-0008d7a0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-0008d7b0: 746b 2e73 6869 6674 735b 726f 775d 5b31  tk.shifts[row][1
-0008d7c0: 5d20 3d20 300d 0a20 2020 2020 2020 2020  ] = 0..         
-0008d7d0: 2020 2073 656c 662e 4f6e 5365 6c65 6374     self.OnSelect
-0008d7e0: 696f 6e43 6861 6e67 6564 2829 0d0a 0d0a  ionChanged()....
-0008d7f0: 2020 2020 6465 6620 4f6e 5365 6c66 726f      def OnSelfro
-0008d800: 6d53 7065 6328 7365 6c66 2c65 7674 293a  mSpec(self,evt):
-0008d810: 0d0a 2020 2020 2020 2020 7370 6563 7472  ..        spectr
-0008d820: 616c 696d 676d 6170 203d 2053 7065 6374  alimgmap = Spect
-0008d830: 7261 6c49 6d61 6765 4d61 7028 7365 6c66  ralImageMap(self
-0008d840: 2c20 7365 6c66 2e63 6f6d 2c20 7365 6c66  , self.com, self
-0008d850: 2e73 746b 290d 0a20 2020 2020 2020 2073  .stk)..        s
-0008d860: 7065 6374 7261 6c69 6d67 6d61 702e 7368  pectralimgmap.sh
-0008d870: 6f77 2829 0d0a 0d0a 2020 2020 6465 6620  ow()....    def 
-0008d880: 4f6e 436c 7253 6869 6674 7328 7365 6c66  OnClrShifts(self
-0008d890: 293a 0d0a 2020 2020 2020 2020 666f 7220  ):..        for 
-0008d8a0: 726f 7720 696e 205b 696e 6465 7820 666f  row in [index fo
-0008d8b0: 7220 696e 6465 782c 2076 616c 7565 2069  r index, value i
-0008d8c0: 6e20 656e 756d 6572 6174 6528 5b78 5b32  n enumerate([x[2
-0008d8d0: 5d20 666f 7220 7820 696e 2020 7365 6c66  ] for x in  self
-0008d8e0: 2e73 746b 2e73 6869 6674 735d 2920 6966  .stk.shifts]) if
-0008d8f0: 2076 616c 7565 2021 3d20 2830 2e30 2c30   value != (0.0,0
-0008d900: 2e30 295d 3a0d 0a20 2020 2020 2020 2020  .0)]:..         
-0008d910: 2020 2073 656c 662e 7374 6b2e 7368 6966     self.stk.shif
-0008d920: 7473 5b72 6f77 5d2e 706f 7028 3229 2020  ts[row].pop(2)  
-0008d930: 2320 7265 6d6f 7665 2074 7570 6c65 0d0a  # remove tuple..
-0008d940: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0008d950: 2e73 746b 2e73 6869 6674 735b 726f 775d  .stk.shifts[row]
-0008d960: 2e69 6e73 6572 7428 322c 2028 302e 302c  .insert(2, (0.0,
-0008d970: 2030 2e30 2929 0d0a 2020 2020 2020 2020   0.0))..        
-0008d980: 2020 2020 7365 6c66 2e73 746b 2e61 6273      self.stk.abs
-0008d990: 6461 7461 5f73 6869 6674 6564 5b3a 2c20  data_shifted[:, 
-0008d9a0: 3a2c 2072 6f77 5d20 3d20 7365 6c66 2e73  :, row] = self.s
-0008d9b0: 746b 2e61 6273 6461 7461 5b3a 2c20 3a2c  tk.absdata[:, :,
-0008d9c0: 2072 6f77 5d0d 0a20 2020 2020 2020 2020   row]..         
-0008d9d0: 2020 2073 656c 662e 4d61 7053 656c 6563     self.MapSelec
-0008d9e0: 7457 6964 6765 7431 2e69 7465 6d28 726f  tWidget1.item(ro
-0008d9f0: 7729 2e73 6574 5465 7874 280d 0a20 2020  w).setText(..   
-0008da00: 2020 2020 2020 2020 2020 2020 2073 7472               str
-0008da10: 2869 6e74 2872 6f77 2929 2e7a 6669 6c6c  (int(row)).zfill
-0008da20: 2833 2920 2b20 2220 2020 2020 6174 2020  (3) + "     at  
-0008da30: 2020 2022 202b 2066 6f72 6d61 7428 7365     " + format(se
-0008da40: 6c66 2e73 746b 2e65 765b 726f 775d 2c20  lf.stk.ev[row], 
-0008da50: 272e 3266 2729 202b 2022 2065 5620 2020  '.2f') + " eV   
-0008da60: 2020 2220 2b20 666f 726d 6174 280d 0a20    " + format(.. 
-0008da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008da80: 2020 2073 656c 662e 7374 6b2e 7368 6966     self.stk.shif
-0008da90: 7473 5b72 6f77 5d5b 325d 5b30 5d2c 2027  ts[row][2][0], '
-0008daa0: 2b2e 3166 2729 202b 2022 2020 2020 2220  +.1f') + "    " 
-0008dab0: 2b20 666f 726d 6174 2873 656c 662e 7374  + format(self.st
-0008dac0: 6b2e 7368 6966 7473 5b72 6f77 5d5b 325d  k.shifts[row][2]
-0008dad0: 5b31 5d2c 2027 2b2e 3166 2729 290d 0a20  [1], '+.1f')).. 
-0008dae0: 2020 2020 2020 2069 6620 6861 7361 7474         if hasatt
-0008daf0: 7228 7365 6c66 2c20 2770 7265 6c73 7427  r(self, 'prelst'
-0008db00: 2920 616e 6420 6861 7361 7474 7228 7365  ) and hasattr(se
-0008db10: 6c66 2c20 2770 6f73 746c 7374 2729 3a0d  lf, 'postlst'):.
-0008db20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0008db30: 6c65 6e28 7365 6c66 2e70 7265 6c73 7429  len(self.prelst)
-0008db40: 2021 3d20 3020 616e 6420 6c65 6e28 7365   != 0 and len(se
-0008db50: 6c66 2e70 6f73 746c 7374 2920 213d 2030  lf.postlst) != 0
-0008db60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0008db70: 2020 2073 656c 662e 5368 6f77 4d61 7028     self.ShowMap(
-0008db80: 7365 6c66 2e70 7265 6c73 742c 7365 6c66  self.prelst,self
-0008db90: 2e70 6f73 746c 7374 290d 0a20 2020 2020  .postlst)..     
-0008dba0: 2020 2069 6620 7365 6c66 2e73 746b 2e73     if self.stk.s
-0008dbb0: 6869 6674 733a 0d0a 2020 2020 2020 2020  hifts:..        
-0008dbc0: 2020 2020 7365 6c66 2e55 7064 6174 6545      self.UpdateE
-0008dbd0: 6e74 7279 2873 656c 662e 4d61 7053 656c  ntry(self.MapSel
-0008dbe0: 6563 7457 6964 6765 7431 2e63 7572 7265  ectWidget1.curre
-0008dbf0: 6e74 526f 7728 2929 0d0a 0d0a 2020 2020  ntRow())....    
-0008dc00: 6465 6620 7365 7453 6869 6674 7328 7365  def setShifts(se
-0008dc10: 6c66 2c73 6869 6674 5f78 2c20 7368 6966  lf,shift_x, shif
-0008dc20: 745f 7929 3a0d 0a20 2020 2020 2020 2023  t_y):..        #
-0008dc30: 7072 696e 7428 2273 6574 7368 6966 7473  print("setshifts
-0008dc40: 2063 616c 6c65 6422 290d 0a20 2020 2020   called")..     
-0008dc50: 2020 2023 2069 6620 6861 7361 7474 7228     # if hasattr(
-0008dc60: 7365 6c66 2c20 224f 4422 293a 0d0a 2020  self, "OD"):..  
-0008dc70: 2020 2020 2020 6966 2073 656c 662e 7374        if self.st
-0008dc80: 6b2e 7368 6966 7473 3a0d 0a20 2020 2020  k.shifts:..     
-0008dc90: 2020 2020 2020 2072 6f77 203d 2073 656c         row = sel
-0008dca0: 662e 4d61 7053 656c 6563 7457 6964 6765  f.MapSelectWidge
-0008dcb0: 7431 2e63 7572 7265 6e74 526f 7728 290d  t1.currentRow().
-0008dcc0: 0a20 2020 2020 2020 2020 2020 2078 6f66  .            xof
-0008dcd0: 6673 6574 2c20 796f 6666 7365 7420 3d20  fset, yoffset = 
-0008dce0: 7365 6c66 2e73 746b 2e73 6869 6674 735b  self.stk.shifts[
-0008dcf0: 726f 775d 5b32 5d20 2320 6375 7272 656e  row][2] # curren
-0008dd00: 7420 6f66 6673 6574 2073 746f 7265 6420  t offset stored 
-0008dd10: 6173 2074 7570 6c65 2069 6e20 7461 626c  as tuple in tabl
-0008dd20: 6520 7374 6b2e 7368 6966 7473 0d0a 2020  e stk.shifts..  
-0008dd30: 2020 2020 2020 2020 2020 2370 7269 6e74            #print
-0008dd40: 2873 656c 662e 7374 6b2e 7368 6966 7473  (self.stk.shifts
-0008dd50: 5b73 656c 662e 4d61 7053 656c 6563 7457  [self.MapSelectW
-0008dd60: 6964 6765 7431 2e63 7572 7265 6e74 526f  idget1.currentRo
-0008dd70: 7728 295d 290d 0a20 2020 2020 2020 2020  w()])..         
-0008dd80: 2020 2023 796f 6666 7365 7420 3d20 7365     #yoffset = se
-0008dd90: 6c66 2e73 746b 2e73 6869 6674 735b 7365  lf.stk.shifts[se
-0008dda0: 6c66 2e4d 6170 5365 6c65 6374 5769 6467  lf.MapSelectWidg
-0008ddb0: 6574 312e 6375 7272 656e 7452 6f77 2829  et1.currentRow()
-0008ddc0: 5d5b 325d 5b31 5d0d 0a20 2020 2020 2020  ][2][1]..       
-0008ddd0: 2020 2020 2069 6620 7368 6966 745f 7820       if shift_x 
-0008dde0: 3d3d 2030 2061 6e64 2073 6869 6674 5f79  == 0 and shift_y
-0008ddf0: 203d 3d20 303a 2023 2069 6620 7265 7365   == 0: # if rese
-0008de00: 7420 6275 7474 6f6e 2070 7265 7373 6564  t button pressed
-0008de10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0008de20: 2020 6966 2078 6f66 6673 6574 2021 3d20    if xoffset != 
-0008de30: 3020 6f72 2079 6f66 6673 6574 2021 3d20  0 or yoffset != 
-0008de40: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-0008de50: 2020 2020 2020 2020 7365 6c66 2e73 746b          self.stk
-0008de60: 2e73 6869 6674 735b 726f 775d 2e70 6f70  .shifts[row].pop
-0008de70: 2832 2920 2320 7265 6d6f 7665 2074 7570  (2) # remove tup
-0008de80: 6c65 0d0a 2020 2020 2020 2020 2020 2020  le..            
-0008de90: 2020 2020 2020 2020 7365 6c66 2e73 746b          self.stk
-0008dea0: 2e73 6869 6674 735b 726f 775d 2e69 6e73  .shifts[row].ins
-0008deb0: 6572 7428 322c 2830 2e30 2c30 2e30 2929  ert(2,(0.0,0.0))
-0008dec0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0008ded0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-0008dee0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0008def0: 6e74 2822 5265 7365 7420 6861 7320 6e6f  nt("Reset has no
-0008df00: 2065 6666 6563 7422 290d 0a20 2020 2020   effect")..     
-0008df10: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0008df20: 6574 7572 6e0d 0a20 2020 2020 2020 2020  eturn..         
-0008df30: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0008df40: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-0008df50: 746b 2e73 6869 6674 735b 726f 775d 2e70  tk.shifts[row].p
-0008df60: 6f70 2832 290d 0a20 2020 2020 2020 2020  op(2)..         
-0008df70: 2020 2020 2020 2078 6f66 6673 6574 203d         xoffset =
-0008df80: 2072 6f75 6e64 2878 6f66 6673 6574 202b   round(xoffset +
-0008df90: 2073 6869 6674 5f78 2c31 290d 0a20 2020   shift_x,1)..   
-0008dfa0: 2020 2020 2020 2020 2020 2020 2079 6f66               yof
-0008dfb0: 6673 6574 203d 2072 6f75 6e64 2879 6f66  fset = round(yof
-0008dfc0: 6673 6574 202b 2073 6869 6674 5f79 2c31  fset + shift_y,1
-0008dfd0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0008dfe0: 2020 2073 656c 662e 7374 6b2e 7368 6966     self.stk.shif
-0008dff0: 7473 5b72 6f77 5d2e 696e 7365 7274 2832  ts[row].insert(2
-0008e000: 2c28 786f 6666 7365 742c 2079 6f66 6673  ,(xoffset, yoffs
-0008e010: 6574 2929 0d0a 2020 2020 2020 2020 2020  et))..          
-0008e020: 2020 2363 7572 7265 6e74 5f69 6d67 203d    #current_img =
-0008e030: 2073 656c 662e 7374 6b2e 6162 7364 6174   self.stk.absdat
-0008e040: 615b 3a2c 203a 2c20 7365 6c66 2e4d 6170  a[:, :, self.Map
-0008e050: 5365 6c65 6374 5769 6467 6574 312e 6375  SelectWidget1.cu
-0008e060: 7272 656e 7452 6f77 2829 5d0d 0a20 2020  rrentRow()]..   
-0008e070: 2020 2020 2020 2020 2023 7072 696e 7428           #print(
-0008e080: 7479 7065 2873 656c 662e 7374 6b2e 6162  type(self.stk.ab
-0008e090: 7364 6174 6129 2c20 7365 6c66 2e73 746b  sdata), self.stk
-0008e0a0: 2e73 6869 6674 735b 7365 6c66 2e4d 6170  .shifts[self.Map
-0008e0b0: 5365 6c65 6374 5769 6467 6574 312e 6375  SelectWidget1.cu
-0008e0c0: 7272 656e 7452 6f77 2829 5d29 0d0a 2020  rrentRow()])..  
-0008e0d0: 2020 2020 2020 2020 2020 2373 656c 662e            #self.
-0008e0e0: 5368 6966 7428 726f 7729 0d0a 2020 2020  Shift(row)..    
-0008e0f0: 2020 2020 2020 2020 7365 6c66 2e55 7064          self.Upd
-0008e100: 6174 6545 6e74 7279 2872 6f77 290d 0a20  ateEntry(row).. 
-0008e110: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
-0008e120: 7361 7474 7228 7365 6c66 2c20 2770 7265  sattr(self, 'pre
-0008e130: 6c73 7427 2920 616e 6420 6861 7361 7474  lst') and hasatt
-0008e140: 7228 7365 6c66 2c20 2770 6f73 746c 7374  r(self, 'postlst
-0008e150: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
-0008e160: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
-0008e170: 2e70 7265 6c73 7429 2021 3d20 3020 616e  .prelst) != 0 an
-0008e180: 6420 6c65 6e28 7365 6c66 2e70 6f73 746c  d len(self.postl
-0008e190: 7374 2920 213d 2030 3a0d 0a20 2020 2020  st) != 0:..     
-0008e1a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0008e1b0: 656c 662e 5368 6f77 4d61 7028 7365 6c66  elf.ShowMap(self
-0008e1c0: 2e70 7265 6c73 742c 7365 6c66 2e70 6f73  .prelst,self.pos
-0008e1d0: 746c 7374 290d 0a20 2020 2064 6566 2053  tlst)..    def S
-0008e1e0: 6869 6674 2873 656c 662c 726f 7729 3a0d  hift(self,row):.
-0008e1f0: 0a20 2020 2020 2020 2023 6375 7272 656e  .        #curren
-0008e200: 745f 696d 6720 3d20 7365 6c66 2e73 746b  t_img = self.stk
-0008e210: 2e61 6273 6461 7461 5f73 6869 6674 6564  .absdata_shifted
-0008e220: 5b3a 2c20 3a2c 2072 6f77 5d0d 0a20 2020  [:, :, row]..   
-0008e230: 2020 2020 206f 7269 6769 6e61 6c5f 696d       original_im
-0008e240: 6720 3d20 7365 6c66 2e73 746b 2e61 6273  g = self.stk.abs
-0008e250: 6461 7461 5b3a 2c20 3a2c 2072 6f77 5d0d  data[:, :, row].
-0008e260: 0a20 2020 2020 2020 2078 6f66 6673 6574  .        xoffset
-0008e270: 2c20 796f 6666 7365 7420 3d20 7365 6c66  , yoffset = self
-0008e280: 2e73 746b 2e73 6869 6674 735b 726f 775d  .stk.shifts[row]
-0008e290: 5b32 5d20 2320 7820 616e 6420 7920 6f66  [2] # x and y of
-0008e2a0: 6673 6574 7320 6f66 2063 7572 7265 6e74  fsets of current
-0008e2b0: 2069 6d61 6765 0d0a 2020 2020 2020 2020   image..        
-0008e2c0: 6966 2078 6f66 6673 6574 203d 3d20 3020  if xoffset == 0 
-0008e2d0: 616e 6420 796f 6666 7365 7420 3d3d 2030  and yoffset == 0
-0008e2e0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0008e2f0: 656c 662e 7374 6b2e 6162 7364 6174 615f  elf.stk.absdata_
-0008e300: 7368 6966 7465 645b 3a2c 203a 2c20 726f  shifted[:, :, ro
-0008e310: 775d 203d 206f 7269 6769 6e61 6c5f 696d  w] = original_im
-0008e320: 6720 2320 7265 706c 6163 6520 7769 7468  g # replace with
-0008e330: 206f 7269 6769 6e61 6c20 6966 206e 6f20   original if no 
-0008e340: 7368 6966 7420 6973 2061 7070 6c69 6564  shift is applied
-0008e350: 0d0a 2020 2020 2020 2020 2020 2020 2373  ..            #s
-0008e360: 656c 662e 5368 6966 744c 6162 656c 2e73  elf.ShiftLabel.s
-0008e370: 6574 5465 7874 2822 7820 3d20 2530 2e31  etText("x = %0.1
-0008e380: 6620 5c6e 7920 3d20 2530 2e31 6622 2025  f \ny = %0.1f" %
-0008e390: 2028 7365 6c66 2e78 6f66 6673 6574 2c20   (self.xoffset, 
-0008e3a0: 7365 6c66 2e79 6f66 6673 6574 2929 0d0a  self.yoffset))..
-0008e3b0: 2020 2020 2020 2020 2020 2020 2372 6574              #ret
-0008e3c0: 7572 6e20 6f72 6967 696e 616c 5f69 6d67  urn original_img
-0008e3d0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-0008e3e0: 0a20 2020 2020 2020 2020 2020 2073 6869  .            shi
-0008e3f0: 6674 6564 203d 206e 6469 6d61 6765 2e66  fted = ndimage.f
-0008e400: 6f75 7269 6572 5f73 6869 6674 286e 702e  ourier_shift(np.
-0008e410: 6666 742e 6666 7432 286f 7269 6769 6e61  fft.fft2(origina
-0008e420: 6c5f 696d 6729 2c20 5b66 6c6f 6174 2878  l_img), [float(x
-0008e430: 6f66 6673 6574 292c 2066 6c6f 6174 2879  offset), float(y
-0008e440: 6f66 6673 6574 295d 290d 0a20 2020 2020  offset)])..     
-0008e450: 2020 2020 2020 2073 6869 6674 6564 203d         shifted =
-0008e460: 206e 702e 6666 742e 6966 6674 3228 7368   np.fft.ifft2(sh
-0008e470: 6966 7465 6429 0d0a 2020 2020 2020 2020  ifted)..        
-0008e480: 2020 2020 7368 6966 7465 645f 7265 616c      shifted_real
-0008e490: 203d 2073 6869 6674 6564 2e72 6561 6c0d   = shifted.real.
-0008e4a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0008e4b0: 662e 7374 6b2e 6162 7364 6174 615f 7368  f.stk.absdata_sh
-0008e4c0: 6966 7465 645b 3a2c 203a 2c20 726f 775d  ifted[:, :, row]
-0008e4d0: 203d 2073 6869 6674 6564 5f72 6561 6c0d   = shifted_real.
-0008e4e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0008e4f0: 7365 6c66 2e73 746b 2e61 6273 6461 7461  self.stk.absdata
-0008e500: 5f73 6869 6674 6564 5b3a 2c3a 2c20 726f  _shifted[:,:, ro
-0008e510: 775d 0d0a 0d0a 2020 2020 2020 2020 2020  w]....          
-0008e520: 2020 2373 656c 662e 5368 6966 744c 6162    #self.ShiftLab
-0008e530: 656c 2e73 6574 5465 7874 2822 7820 3d20  el.setText("x = 
-0008e540: 2530 2e31 6620 5c6e 7920 3d20 2530 2e31  %0.1f \ny = %0.1
-0008e550: 6622 2025 2028 786f 6666 7365 742c 2079  f" % (xoffset, y
-0008e560: 6f66 6673 6574 2929 0d0a 2020 2020 6465  offset))..    de
-0008e570: 6620 4361 6c63 4f44 4d61 7028 7365 6c66  f CalcODMap(self
-0008e580: 2c69 6d5f 6964 7831 2c69 6d5f 6964 7832  ,im_idx1,im_idx2
-0008e590: 293a 0d0a 2020 2020 2020 2020 6966 206c  ):..        if l
-0008e5a0: 656e 2869 6d5f 6964 7831 2920 3d3d 2031  en(im_idx1) == 1
-0008e5b0: 2061 6e64 206c 656e 2869 6d5f 6964 7832   and len(im_idx2
-0008e5c0: 2920 3d3d 2031 3a0d 0a20 2020 2020 2020  ) == 1:..       
-0008e5d0: 2020 2020 2069 6d31 203d 2073 656c 662e       im1 = self.
-0008e5e0: 7374 6b2e 6162 7364 6174 615f 7368 6966  stk.absdata_shif
-0008e5f0: 7465 645b 3a2c 203a 2c20 696e 7428 696d  ted[:, :, int(im
-0008e600: 5f69 6478 315b 305d 295d 0d0a 2020 2020  _idx1[0])]..    
-0008e610: 2020 2020 2020 2020 696d 3220 3d20 7365          im2 = se
-0008e620: 6c66 2e73 746b 2e61 6273 6461 7461 5f73  lf.stk.absdata_s
-0008e630: 6869 6674 6564 5b3a 2c20 3a2c 2069 6e74  hifted[:, :, int
-0008e640: 2869 6d5f 6964 7832 5b30 5d29 5d0d 0a20  (im_idx2[0])].. 
-0008e650: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0008e660: 2020 2020 2020 2020 2020 696d 3120 3d20            im1 = 
-0008e670: 6e70 2e6d 6561 6e28 5b73 656c 662e 7374  np.mean([self.st
-0008e680: 6b2e 6162 7364 6174 615f 7368 6966 7465  k.absdata_shifte
-0008e690: 645b 3a2c 203a 2c20 695d 2066 6f72 2069  d[:, :, i] for i
-0008e6a0: 2069 6e20 696d 5f69 6478 315d 2c20 6178   in im_idx1], ax
-0008e6b0: 6973 3d30 290d 0a20 2020 2020 2020 2020  is=0)..         
-0008e6c0: 2020 2069 6d32 203d 206e 702e 6d65 616e     im2 = np.mean
-0008e6d0: 285b 7365 6c66 2e73 746b 2e61 6273 6461  ([self.stk.absda
-0008e6e0: 7461 5f73 6869 6674 6564 5b3a 2c20 3a2c  ta_shifted[:, :,
-0008e6f0: 2069 5d20 666f 7220 6920 696e 2069 6d5f   i] for i in im_
-0008e700: 6964 7832 5d2c 2061 7869 733d 3029 0d0a  idx2], axis=0)..
-0008e710: 2020 2020 2020 2020 4f44 203d 206e 702e          OD = np.
-0008e720: 6c6f 6728 696d 312f 696d 3229 0d0a 2020  log(im1/im2)..  
-0008e730: 2020 2020 2020 6966 2073 656c 662e 6372        if self.cr
-0008e740: 6f70 666c 6167 3a0d 0a20 2020 2020 2020  opflag:..       
-0008e750: 2020 2020 2073 6869 6674 6c73 7420 3d20       shiftlst = 
-0008e760: 5b73 656c 662e 7374 6b2e 7368 6966 7473  [self.stk.shifts
-0008e770: 5b69 5d5b 325d 2066 6f72 2069 2069 6e20  [i][2] for i in 
-0008e780: 696d 5f69 6478 3120 2b20 696d 5f69 6478  im_idx1 + im_idx
-0008e790: 325d 0d0a 2020 2020 2020 2020 2020 2020  2]..            
-0008e7a0: 2370 7269 6e74 2873 6869 6674 6c73 7429  #print(shiftlst)
-0008e7b0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0008e7c0: 7072 696e 7428 6d61 7828 7368 6966 746c  print(max(shiftl
-0008e7d0: 7374 2c20 6b65 793d 6974 656d 6765 7474  st, key=itemgett
-0008e7e0: 6572 2830 2929 5b30 5d29 2023 2070 6f73  er(0))[0]) # pos
-0008e7f0: 7369 626c 6520 616c 7465 726e 6174 6976  sible alternativ
-0008e800: 6520 746f 206c 616d 6264 6120 6675 6e63  e to lambda func
-0008e810: 7469 6f6e 0d0a 2020 2020 2020 2020 2020  tion..          
-0008e820: 2020 2343 616c 6375 6c61 7465 2063 726f    #Calculate cro
-0008e830: 7073 0d0a 2020 2020 2020 2020 2020 2020  ps..            
-0008e840: 6c20 3d20 696e 7428 6e70 2e66 6c6f 6f72  l = int(np.floor
-0008e850: 286d 696e 2873 6869 6674 6c73 742c 206b  (min(shiftlst, k
-0008e860: 6579 3d6c 616d 6264 6120 6974 656d 3a20  ey=lambda item: 
-0008e870: 6974 656d 5b30 5d29 5b30 5d29 290d 0a20  item[0])[0])).. 
-0008e880: 2020 2020 2020 2020 2020 2063 6c20 3d20             cl = 
-0008e890: 6c20 6966 206c 203c 2030 2065 6c73 6520  l if l < 0 else 
-0008e8a0: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-0008e8b0: 2020 7220 3d20 696e 7428 6e70 2e63 6569    r = int(np.cei
-0008e8c0: 6c28 6d61 7828 7368 6966 746c 7374 2c20  l(max(shiftlst, 
-0008e8d0: 6b65 793d 6c61 6d62 6461 2069 7465 6d3a  key=lambda item:
-0008e8e0: 2069 7465 6d5b 305d 295b 305d 2929 0d0a   item[0])[0]))..
-0008e8f0: 2020 2020 2020 2020 2020 2020 7420 3d20              t = 
-0008e900: 696e 7428 6e70 2e63 6569 6c28 6d61 7828  int(np.ceil(max(
-0008e910: 7368 6966 746c 7374 2c20 6b65 793d 6c61  shiftlst, key=la
-0008e920: 6d62 6461 2069 7465 6d3a 2069 7465 6d5b  mbda item: item[
-0008e930: 315d 295b 315d 2929 0d0a 2020 2020 2020  1])[1]))..      
-0008e940: 2020 2020 2020 6220 3d20 696e 7428 6e70        b = int(np
-0008e950: 2e66 6c6f 6f72 286d 696e 2873 6869 6674  .floor(min(shift
-0008e960: 6c73 742c 206b 6579 3d6c 616d 6264 6120  lst, key=lambda 
-0008e970: 6974 656d 3a20 6974 656d 5b31 5d29 5b31  item: item[1])[1
-0008e980: 5d29 290d 0a20 2020 2020 2020 2020 2020  ]))..           
-0008e990: 2063 6220 3d20 6220 6966 2062 203c 2030   cb = b if b < 0
-0008e9a0: 2065 6c73 6520 4e6f 6e65 0d0a 2020 2020   else None..    
-0008e9b0: 2020 2020 2020 2020 2320 4372 6f70 206d          # Crop m
-0008e9c0: 6170 0d0a 2020 2020 2020 2020 2020 2020  ap..            
-0008e9d0: 4f44 203d 204f 445b 723a 636c 2c74 3a63  OD = OD[r:cl,t:c
-0008e9e0: 625d 0d0a 2020 2020 2020 2020 2020 2020  b]..            
-0008e9f0: 2370 7269 6e74 2872 2c63 6c2c 742c 6362  #print(r,cl,t,cb
-0008ea00: 290d 0a20 2020 2020 2020 2069 6e66 5f69  )..        inf_i
-0008ea10: 6478 203d 206e 702e 7768 6572 6528 6e70  dx = np.where(np
-0008ea20: 2e69 7369 6e66 284f 4429 290d 0a20 2020  .isinf(OD))..   
-0008ea30: 2020 2020 206e 616e 5f69 6478 203d 206e       nan_idx = n
-0008ea40: 702e 7768 6572 6528 6e70 2e69 736e 616e  p.where(np.isnan
-0008ea50: 284f 4429 290d 0a20 2020 2020 2020 2069  (OD))..        i
-0008ea60: 6620 6e70 2e61 6e79 2869 6e66 5f69 6478  f np.any(inf_idx
-0008ea70: 2920 6f72 206e 702e 616e 7928 6e61 6e5f  ) or np.any(nan_
-0008ea80: 6964 7829 3a0d 0a20 2020 2020 2020 2020  idx):..         
-0008ea90: 2020 2023 6966 206e 6f74 2073 656c 662e     #if not self.
-0008eaa0: 496e 6657 6172 6e69 6e67 3a0d 0a20 2020  InfWarning:..   
-0008eab0: 2020 2020 2020 2020 2023 2020 2020 7365           #    se
-0008eac0: 6c66 2e49 6e66 5761 726e 696e 6720 3d20  lf.InfWarning = 
-0008ead0: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
-0008eae0: 2020 2320 2020 2051 7447 7569 2e51 4d65    #    QtGui.QMe
-0008eaf0: 7373 6167 6542 6f78 2e77 6172 6e69 6e67  ssageBox.warning
-0008eb00: 2873 656c 662c 2027 5761 726e 696e 6721  (self, 'Warning!
-0008eb10: 272c 2022 5468 6520 4f44 206d 6170 2063  ', "The OD map c
-0008eb20: 6f6e 7461 696e 6564 2069 6e66 696e 6974  ontained infinit
-0008eb30: 6520 6f72 206e 616e 2076 616c 7565 732e  e or nan values.
-0008eb40: 2050 6c65 6173 6520 6e6f 7465 2074 6861   Please note tha
-0008eb50: 7420 7468 6579 2068 6176 6520 6265 656e  t they have been
-0008eb60: 207a 6572 6f65 642e 2229 0d0a 2020 2020   zeroed.")..    
-0008eb70: 2020 2020 2020 2020 4f44 5b69 6e66 5f69          OD[inf_i
-0008eb80: 6478 5d20 3d20 3020 2369 6e66 696e 6974  dx] = 0 #infinit
-0008eb90: 6520 7661 6c75 6573 2067 6574 2072 6570  e values get rep
-0008eba0: 6c61 6365 6420 6279 207a 6572 6f2e 2054  laced by zero. T
-0008ebb0: 6869 7320 6973 2061 6e20 7567 6c79 2077  his is an ugly w
-0008ebc0: 6f72 6b20 6172 6f75 6e64 2c20 6275 7420  ork around, but 
-0008ebd0: 7769 7468 206e 616e 7320 7468 6520 696d  with nans the im
-0008ebe0: 6167 6520 6973 206e 6f74 2064 6973 706c  age is not displ
-0008ebf0: 6179 6564 2063 6f72 7265 6374 6c79 2e0d  ayed correctly..
-0008ec00: 0a20 2020 2020 2020 2020 2020 204f 445b  .            OD[
-0008ec10: 6e61 6e5f 6964 785d 203d 2030 0d0a 2020  nan_idx] = 0..  
-0008ec20: 2020 2020 2020 7265 7475 726e 204f 440d        return OD.
-0008ec30: 0a0d 0a20 2020 2064 6566 2063 616c 6342  ...    def calcB
-0008ec40: 696e 5369 7a65 2873 656c 662c 692c 4e29  inSize(self,i,N)
-0008ec50: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-0008ec60: 6e20 696e 7428 726f 756e 6428 3235 362a  n int(round(256*
-0008ec70: 2869 2b31 292f 4e29 202d 2072 6f75 6e64  (i+1)/N) - round
-0008ec80: 2832 3536 2a69 2f4e 2929 0d0a 0d0a 2020  (256*i/N))....  
-0008ec90: 2020 6465 6620 4f6e 436f 6c6f 726d 6170    def OnColormap
-0008eca0: 2873 656c 662c 6d61 703d 2261 666d 686f  (self,map="afmho
-0008ecb0: 7422 2c20 636f 6c6f 7273 3d32 3536 293a  t", colors=256):
-0008ecc0: 0d0a 2020 2020 2020 2020 6966 2068 6173  ..        if has
-0008ecd0: 6174 7472 2873 656c 662c 2022 4f44 2229  attr(self, "OD")
-0008ece0: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
-0008ecf0: 6f6c 6f72 6d61 7020 3d20 636d 2e67 6574  olormap = cm.get
-0008ed00: 5f63 6d61 7028 6d61 702c 2063 6f6c 6f72  _cmap(map, color
-0008ed10: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-0008ed20: 636f 6c6f 726d 6170 203d 2063 6f6c 6f72  colormap = color
-0008ed30: 6d61 7028 6e70 2e61 7261 6e67 6528 636f  map(np.arange(co
-0008ed40: 6c6f 7273 2929 0d0a 2020 2020 2020 2020  lors))..        
-0008ed50: 2020 2020 636d 5f6c 7374 203d 205b 5b63      cm_lst = [[c
-0008ed60: 6f6c 6f72 6d61 705b 6964 785d 5b30 5d2c  olormap[idx][0],
-0008ed70: 2063 6f6c 6f72 6d61 705b 6964 785d 5b31   colormap[idx][1
-0008ed80: 5d2c 2063 6f6c 6f72 6d61 705b 6964 785d  ], colormap[idx]
-0008ed90: 5b32 5d2c 2063 6f6c 6f72 6d61 705b 6964  [2], colormap[id
-0008eda0: 785d 5b33 5d5d 2066 6f72 2069 6478 2069  x][3]] for idx i
-0008edb0: 6e20 7261 6e67 6528 6e70 2e73 6861 7065  n range(np.shape
-0008edc0: 2863 6f6c 6f72 6d61 7029 5b30 5d29 5d20  (colormap)[0])] 
-0008edd0: 2363 6f6e 7665 7274 2074 6f20 722c 672c  #convert to r,g,
-0008ede0: 622c 6120 6c69 7374 0d0a 2020 2020 2020  b,a list..      
-0008edf0: 2020 2020 2020 636d 5f6c 7374 203d 205b        cm_lst = [
-0008ee00: 6974 656d 2066 6f72 2073 7562 2069 6e20  item for sub in 
-0008ee10: 5b5b 636d 5f6c 7374 5b69 5d5d 2a73 656c  [[cm_lst[i]]*sel
-0008ee20: 662e 6361 6c63 4269 6e53 697a 6528 692c  f.calcBinSize(i,
-0008ee30: 636f 6c6f 7273 2920 666f 7220 6920 696e  colors) for i in
-0008ee40: 2072 616e 6765 2863 6f6c 6f72 7329 5d20   range(colors)] 
-0008ee50: 666f 7220 6974 656d 2069 6e20 7375 625d  for item in sub]
-0008ee60: 2023 6669 6c6c 7320 3235 3620 6269 6e73   #fills 256 bins
-0008ee70: 2061 7320 6571 7561 6c20 6173 2070 6f73   as equal as pos
-0008ee80: 7369 626c 6520 7769 7468 206e 2063 6f6c  sible with n col
-0008ee90: 6f72 730d 0a20 2020 2020 2020 2020 2020  ors..           
-0008eea0: 2063 6d5f 6172 7261 7920 3d20 6e70 2e61   cm_array = np.a
-0008eeb0: 7272 6179 285b 6e70 2e61 7361 7272 6179  rray([np.asarray
-0008eec0: 2863 6d5f 6c73 7429 5d29 2023 7665 7274  (cm_lst)]) #vert
-0008eed0: 6963 616c 2063 6f6c 6f72 6261 720d 0a20  ical colorbar.. 
-0008eee0: 2020 2020 2020 2020 2020 2063 6d5f 6c73             cm_ls
-0008eef0: 742e 6578 7465 6e64 2828 636d 5f6c 7374  t.extend((cm_lst
-0008ef00: 5b2d 315d 2c63 6d5f 6c73 745b 2d31 5d2c  [-1],cm_lst[-1],
-0008ef10: 636d 5f6c 7374 5b2d 315d 2929 0d0a 2020  cm_lst[-1]))..  
-0008ef20: 2020 2020 2020 2020 2020 6c75 7420 3d20            lut = 
-0008ef30: 6e70 2e61 7361 7272 6179 2863 6d5f 6c73  np.asarray(cm_ls
-0008ef40: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-0008ef50: 6c75 7420 3d20 286c 7574 202a 2032 3535  lut = (lut * 255
-0008ef60: 292e 7669 6577 286e 702e 6e64 6172 7261  ).view(np.ndarra
-0008ef70: 7929 2023 6c75 7420 666f 7220 4f44 206d  y) #lut for OD m
-0008ef80: 6170 0d0a 2020 2020 2020 2020 2020 2020  ap..            
-0008ef90: 7365 6c66 2e63 6d69 6d67 2e73 6574 496d  self.cmimg.setIm
-0008efa0: 6167 6528 636d 5f61 7272 6179 290d 0a20  age(cm_array).. 
-0008efb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0008efc0: 6d5f 6974 656d 2e73 6574 4c6f 6f6b 7570  m_item.setLookup
-0008efd0: 5461 626c 6528 6c75 7429 0d0a 2020 2020  Table(lut)..    
-0008efe0: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
-0008eff0: 7472 2873 656c 662c 2022 4f44 2229 3a0d  tr(self, "OD"):.
-0008f000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0008f010: 2073 656c 662e 7365 744f 4462 6172 2873   self.setODbar(s
-0008f020: 656c 662e 4f44 6d69 6e2c 2073 656c 662e  elf.ODmin, self.
-0008f030: 4f44 6d61 7829 0d0a 0d0a 2020 2020 6465  ODmax)....    de
-0008f040: 6620 5368 6f77 4d61 7028 7365 6c66 2c20  f ShowMap(self, 
-0008f050: 7072 6569 6478 2c20 706f 7374 6964 7829  preidx, postidx)
-0008f060: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-0008f070: 7032 2e63 6c65 6172 2829 0d0a 2020 2020  p2.clear()..    
-0008f080: 2020 2020 7365 6c66 2e70 322e 6164 6449      self.p2.addI
-0008f090: 7465 6d28 7365 6c66 2e6d 5f69 7465 6d29  tem(self.m_item)
-0008f0a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-0008f0b0: 6d2e 636c 6561 7228 290d 0a20 2020 2020  m.clear()..     
-0008f0c0: 2020 2073 656c 662e 636d 2e61 6464 4974     self.cm.addIt
-0008f0d0: 656d 2873 656c 662e 636d 696d 6729 0d0a  em(self.cmimg)..
-0008f0e0: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-0008f0f0: 4372 6f73 7368 6169 7228 290d 0a20 2020  Crosshair()..   
-0008f100: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-0008f110: 2020 2020 2020 2023 2320 4f70 7469 6f6e         ## Option
-0008f120: 616c 2073 6f72 7469 6e67 2073 7769 7463  al sorting switc
-0008f130: 6865 6420 6f66 6620 666f 7220 636f 6e76  hed off for conv
-0008f140: 656e 6965 6e63 652e 2041 6c6c 6f77 7320  enience. Allows 
-0008f150: 6d61 7073 2074 6f20 7261 6e67 6520 746f  maps to range to
-0008f160: 206e 6567 6174 6976 6520 4f44 0d0a 2020   negative OD..  
-0008f170: 2020 2020 2020 2020 2020 2373 656c 6563            #selec
-0008f180: 7469 6f6e 203d 2070 7265 6964 7820 2b20  tion = preidx + 
-0008f190: 706f 7374 6964 780d 0a20 2020 2020 2020  postidx..       
-0008f1a0: 2020 2020 2023 2073 656c 6563 7469 6f6e       # selection
-0008f1b0: 2e73 6f72 7428 290d 0a20 2020 2020 2020  .sort()..       
-0008f1c0: 2020 2020 2069 6620 6c65 6e28 7072 6569       if len(prei
-0008f1d0: 6478 202b 2070 6f73 7469 6478 2920 3d3d  dx + postidx) ==
-0008f1e0: 2032 3a0d 0a20 2020 2020 2020 2020 2020   2:..           
-0008f1f0: 2020 2020 2073 656c 662e 7032 2e74 6974       self.p2.tit
-0008f200: 6c65 4c61 6265 6c2e 7365 7454 6578 7428  leLabel.setText(
-0008f210: 223c 6365 6e74 6572 3e42 696e 6172 7920  "<center>Binary 
-0008f220: 6d61 7020 6672 6f6d 2065 6e65 7267 6965  map from energie
-0008f230: 7320 2220 2b20 7374 7228 726f 756e 6428  s " + str(round(
-0008f240: 7365 6c66 2e73 746b 2e65 765b 7072 6569  self.stk.ev[prei
-0008f250: 6478 5b30 5d5d 2c20 3229 2920 2b20 2220  dx[0]], 2)) + " 
-0008f260: 616e 6420 2220 2b20 7374 7228 0d0a 2020  and " + str(..  
-0008f270: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-0008f280: 756e 6428 7365 6c66 2e73 746b 2e65 765b  und(self.stk.ev[
-0008f290: 706f 7374 6964 785b 305d 5d2c 2032 2929  postidx[0]], 2))
-0008f2a0: 202b 2022 2065 563c 2f63 656e 7465 723e   + " eV</center>
-0008f2b0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-0008f2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008f2d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0008f2e0: 697a 653d 2731 3070 7427 290d 0a20 2020  ize='10pt')..   
-0008f2f0: 2020 2020 2020 2020 2065 6c69 6620 6c65           elif le
-0008f300: 6e28 7072 6569 6478 202b 2070 6f73 7469  n(preidx + posti
-0008f310: 6478 2920 3c3d 2036 3a0d 0a20 2020 2020  dx) <= 6:..     
-0008f320: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0008f330: 7032 2e74 6974 6c65 4c61 6265 6c2e 7365  p2.titleLabel.se
-0008f340: 7454 6578 7428 223c 6365 6e74 6572 3e4d  tText("<center>M
-0008f350: 6170 2066 726f 6d20 656e 6572 6769 6573  ap from energies
-0008f360: 2022 202b 2073 7472 285b 726f 756e 6428   " + str([round(
-0008f370: 7365 6c66 2e73 746b 2e65 765b 655d 2c20  self.stk.ev[e], 
-0008f380: 3229 2066 6f72 2065 2069 6e20 7072 6569  2) for e in prei
-0008f390: 6478 5d29 2e73 7472 6970 2827 5b5d 2729  dx]).strip('[]')
-0008f3a0: 202b 2022 2061 6e64 2022 202b 0d0a 2020   + " and " +..  
+0008b040: 2020 7365 6c66 2e76 4c69 6e65 2e73 6574    self.vLine.set
+0008b050: 5065 6e28 2272 2229 0d0a 2020 2020 2020  Pen("r")..      
+0008b060: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
+0008b070: 4c69 6e65 2e73 6574 5065 6e28 2272 2229  Line.setPen("r")
+0008b080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0008b090: 2020 7365 6c66 2e76 4c69 6e65 2e73 6574    self.vLine.set
+0008b0a0: 5a56 616c 7565 2831 3030 3029 0d0a 2020  ZValue(1000)..  
+0008b0b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0008b0c0: 6c66 2e68 4c69 6e65 2e73 6574 5a56 616c  lf.hLine.setZVal
+0008b0d0: 7565 2831 3030 3029 0d0a 2020 2020 2020  ue(1000)..      
+0008b0e0: 2020 2020 2020 2020 2020 6d6f 7573 6550            mouseP
+0008b0f0: 6f69 6e74 203d 2073 656c 662e 7032 2e67  oint = self.p2.g
+0008b100: 6574 5669 6577 426f 7828 292e 6d61 7053  etViewBox().mapS
+0008b110: 6365 6e65 546f 5669 6577 2870 6f73 290d  ceneToView(pos).
+0008b120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008b130: 2069 6620 7365 6c66 2e4d 6574 7269 6343   if self.MetricC
+0008b140: 6865 636b 426f 782e 6973 4368 6563 6b65  heckBox.isChecke
+0008b150: 6428 293a 0d0a 2020 2020 2020 2020 2020  d():..          
+0008b160: 2020 2020 2020 2020 2020 785f 6d69 6e20            x_min 
+0008b170: 3d20 2873 656c 662e 7032 2e67 6574 5669  = (self.p2.getVi
+0008b180: 6577 426f 7828 292e 6974 656d 426f 756e  ewBox().itemBoun
+0008b190: 6469 6e67 5265 6374 2873 656c 662e 6d5f  dingRect(self.m_
+0008b1a0: 6974 656d 292e 7828 2920 2f20 2873 656c  item).x() / (sel
+0008b1b0: 662e 7363 616c 6520 2a20 7365 6c66 2e73  f.scale * self.s
+0008b1c0: 746b 2e78 5f70 7873 697a 6529 2920 2320  tk.x_pxsize)) # 
+0008b1d0: 6d69 6e69 6d75 6d20 7820 7661 6c75 6520  minimum x value 
+0008b1e0: 696e 2070 780d 0a20 2020 2020 2020 2020  in px..         
+0008b1f0: 2020 2020 2020 2020 2020 2079 5f6d 696e             y_min
+0008b200: 203d 2028 7365 6c66 2e70 322e 6765 7456   = (self.p2.getV
+0008b210: 6965 7742 6f78 2829 2e69 7465 6d42 6f75  iewBox().itemBou
+0008b220: 6e64 696e 6752 6563 7428 7365 6c66 2e6d  ndingRect(self.m
+0008b230: 5f69 7465 6d29 2e79 2829 202f 2028 7365  _item).y() / (se
+0008b240: 6c66 2e73 6361 6c65 202a 2073 656c 662e  lf.scale * self.
+0008b250: 7374 6b2e 795f 7078 7369 7a65 2929 2023  stk.y_pxsize)) #
+0008b260: 206d 696e 696d 756d 2079 2076 616c 7565   minimum y value
+0008b270: 2069 6e20 7078 0d0a 2020 2020 2020 2020   in px..        
+0008b280: 2020 2020 2020 2020 2020 2020 785f 6f66              x_of
+0008b290: 6620 3d20 785f 6d69 6e20 2d20 696e 7428  f = x_min - int(
+0008b2a0: 785f 6d69 6e29 0d0a 2020 2020 2020 2020  x_min)..        
+0008b2b0: 2020 2020 2020 2020 2020 2020 795f 6f66              y_of
+0008b2c0: 6620 3d20 795f 6d69 6e20 2d20 696e 7428  f = y_min - int(
+0008b2d0: 795f 6d69 6e29 0d0a 2020 2020 2020 2020  y_min)..        
+0008b2e0: 2020 2020 2020 2020 2020 2020 785f 706f              x_po
+0008b2f0: 7320 3d20 6d6f 7573 6550 6f69 6e74 2e78  s = mousePoint.x
+0008b300: 2829 202f 2028 7365 6c66 2e73 6361 6c65  () / (self.scale
+0008b310: 202a 2073 656c 662e 7374 6b2e 785f 7078   * self.stk.x_px
+0008b320: 7369 7a65 2920 2b31 2023 7820 6d6f 7573  size) +1 #x mous
+0008b330: 6570 6f73 2069 6e20 6e75 6d62 6572 206f  epos in number o
+0008b340: 6620 726f 7773 0d0a 2020 2020 2020 2020  f rows..        
+0008b350: 2020 2020 2020 2020 2020 2020 795f 706f              y_po
+0008b360: 7320 3d20 6d6f 7573 6550 6f69 6e74 2e79  s = mousePoint.y
+0008b370: 2829 202f 2028 7365 6c66 2e73 6361 6c65  () / (self.scale
+0008b380: 202a 2073 656c 662e 7374 6b2e 795f 7078   * self.stk.y_px
+0008b390: 7369 7a65 2920 2b31 2023 7920 6d6f 7573  size) +1 #y mous
+0008b3a0: 6570 6f73 2069 6e20 6e75 6d62 6572 206f  epos in number o
+0008b3b0: 6620 726f 7773 0d0a 0d0a 2020 2020 2020  f rows....      
+0008b3c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0008b3d0: 206d 6f75 7365 506f 696e 742e 7828 2920   mousePoint.x() 
+0008b3e0: 3c20 303a 0d0a 2020 2020 2020 2020 2020  < 0:..          
+0008b3f0: 2020 2020 2020 2020 2020 2020 2020 7869                xi
+0008b400: 203d 2069 6e74 2878 5f70 6f73 202d 2078   = int(x_pos - x
+0008b410: 5f6f 6666 2d31 290d 0a20 2020 2020 2020  _off-1)..       
+0008b420: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0008b430: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0008b440: 2020 2020 2020 2020 2020 2020 7869 203d              xi =
+0008b450: 2069 6e74 2878 5f70 6f73 202d 2078 5f6f   int(x_pos - x_o
+0008b460: 6666 290d 0a20 2020 2020 2020 2020 2020  ff)..           
+0008b470: 2020 2020 2020 2020 2069 6620 6d6f 7573           if mous
+0008b480: 6550 6f69 6e74 2e79 2829 203c 2030 3a0d  ePoint.y() < 0:.
+0008b490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008b4a0: 2020 2020 2020 2020 2079 6920 3d20 696e           yi = in
+0008b4b0: 7428 795f 706f 7320 2d20 795f 6f66 6620  t(y_pos - y_off 
+0008b4c0: 2d31 290d 0a20 2020 2020 2020 2020 2020  -1)..           
+0008b4d0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0008b4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008b4f0: 2020 2020 2020 2020 7969 203d 2069 6e74          yi = int
+0008b500: 2879 5f70 6f73 202d 2079 5f6f 6666 290d  (y_pos - y_off).
+0008b510: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+0008b520: 2020 2020 2020 2078 203d 2028 7869 202d         x = (xi -
+0008b530: 2030 2e35 202b 2078 5f6f 6666 2920 2a20   0.5 + x_off) * 
+0008b540: 7365 6c66 2e73 6361 6c65 202a 2073 656c  self.scale * sel
+0008b550: 662e 7374 6b2e 785f 7078 7369 7a65 0d0a  f.stk.x_pxsize..
+0008b560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008b570: 2020 2020 7920 3d20 2879 6920 2d20 302e      y = (yi - 0.
+0008b580: 3520 2b20 795f 6f66 6629 202a 2073 656c  5 + y_off) * sel
+0008b590: 662e 7363 616c 6520 2a20 7365 6c66 2e73  f.scale * self.s
+0008b5a0: 746b 2e79 5f70 7873 697a 650d 0a20 2020  tk.y_pxsize..   
+0008b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008b5c0: 2070 7420 3d20 5174 436f 7265 2e51 506f   pt = QtCore.QPo
+0008b5d0: 696e 7446 2878 2c79 290d 0a20 2020 2020  intF(x,y)..     
+0008b5e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0008b5f0: 656c 662e 4f44 6c61 6265 6c2e 7365 7454  elf.ODlabel.setT
+0008b600: 6578 7428 223c 7370 616e 2073 7479 6c65  ext("<span style
+0008b610: 3d27 666f 6e74 2d73 697a 653a 2031 3070  ='font-size: 10p
+0008b620: 743b 2063 6f6c 6f72 3a20 7265 6427 3e20  t; color: red'> 
+0008b630: 7820 3d20 2530 2e33 6620 20c2 b56d 2c20  x = %0.3f  ..m, 
+0008b640: 3c73 7061 6e20 7374 796c 653d 2763 6f6c  <span style='col
+0008b650: 6f72 3a20 7265 6427 3e20 7920 3d20 2530  or: red'> y = %0
+0008b660: 2e33 6620 c2b5 6d3c 2f73 7061 6e3e 2c20  .3f ..m</span>, 
+0008b670: 3c73 7061 6e20 7374 796c 653d 2763 6f6c  <span style='col
+0008b680: 6f72 3a20 7265 6427 3e20 4f44 203d 2025  or: red'> OD = %
+0008b690: 302e 3266 3c2f 7370 616e 3e22 2025 2028  0.2f</span>" % (
+0008b6a0: 782f 7365 6c66 2e73 6361 6c65 202d 2030  x/self.scale - 0
+0008b6b0: 2e35 202a 2073 656c 662e 7374 6b2e 785f  .5 * self.stk.x_
+0008b6c0: 7078 7369 7a65 2c20 792f 7365 6c66 2e73  pxsize, y/self.s
+0008b6d0: 6361 6c65 202d 2030 2e35 202a 2073 656c  cale - 0.5 * sel
+0008b6e0: 662e 7374 6b2e 795f 7078 7369 7a65 2c20  f.stk.y_pxsize, 
+0008b6f0: 7365 6c66 2e4f 445b 7869 2d31 2d69 6e74  self.OD[xi-1-int
+0008b700: 2878 5f6d 696e 292c 7969 2d31 2d69 6e74  (x_min),yi-1-int
+0008b710: 2879 5f6d 696e 295d 2929 0d0a 2020 2020  (y_min)]))..    
+0008b720: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0008b730: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0008b740: 2020 2020 2020 2078 203d 2069 6e74 286d         x = int(m
+0008b750: 6f75 7365 506f 696e 742e 7828 2929 202b  ousePoint.x()) +
+0008b760: 2030 2e35 0d0a 2020 2020 2020 2020 2020   0.5..          
+0008b770: 2020 2020 2020 2020 2020 7920 3d20 696e            y = in
+0008b780: 7428 6d6f 7573 6550 6f69 6e74 2e79 2829  t(mousePoint.y()
+0008b790: 2920 2b20 302e 350d 0a20 2020 2020 2020  ) + 0.5..       
+0008b7a0: 2020 2020 2020 2020 2020 2020 2070 7420               pt 
+0008b7b0: 3d20 5174 436f 7265 2e51 506f 696e 7446  = QtCore.QPointF
+0008b7c0: 2878 2c79 290d 0a20 2020 2020 2020 2020  (x,y)..         
+0008b7d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0008b7e0: 4f44 6c61 6265 6c2e 7365 7454 6578 7428  ODlabel.setText(
+0008b7f0: 223c 7370 616e 2073 7479 6c65 3d27 666f  "<span style='fo
+0008b800: 6e74 2d73 697a 653a 2031 3070 743b 2063  nt-size: 10pt; c
+0008b810: 6f6c 6f72 3a20 7265 6427 3e20 7820 3d20  olor: red'> x = 
+0008b820: 2530 2e30 662c 203c 7370 616e 2073 7479  %0.0f, <span sty
+0008b830: 6c65 3d27 636f 6c6f 723a 2072 6564 273e  le='color: red'>
+0008b840: 2079 203d 2025 302e 3066 3c2f 7370 616e   y = %0.0f</span
+0008b850: 3e2c 203c 7370 616e 2073 7479 6c65 3d27  >, <span style='
+0008b860: 636f 6c6f 723a 2072 6564 273e 204f 4420  color: red'> OD 
+0008b870: 3d20 2530 2e32 663c 2f73 7061 6e3e 2220  = %0.2f</span>" 
+0008b880: 2520 2878 2c20 792c 7365 6c66 2e4f 445b  % (x, y,self.OD[
+0008b890: 696e 7428 7829 2c69 6e74 2879 295d 2929  int(x),int(y)]))
+0008b8a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0008b8b0: 2020 2370 7269 6e74 2878 2c79 290d 0a20    #print(x,y).. 
+0008b8c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0008b8d0: 656c 662e 764c 696e 652e 7365 7450 6f73  elf.vLine.setPos
+0008b8e0: 2878 290d 0a20 2020 2020 2020 2020 2020  (x)..           
+0008b8f0: 2020 2020 2073 656c 662e 684c 696e 652e       self.hLine.
+0008b900: 7365 7450 6f73 2879 290d 0a20 2020 2020  setPos(y)..     
+0008b910: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0008b920: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0008b930: 6c66 2e4f 446c 6162 656c 2e73 6574 5465  lf.ODlabel.setTe
+0008b940: 7874 2822 2229 0d0a 2020 2020 2020 2020  xt("")..        
+0008b950: 2020 2020 2020 2020 7365 6c66 2e76 4c69          self.vLi
+0008b960: 6e65 2e73 6574 5a56 616c 7565 282d 3130  ne.setZValue(-10
+0008b970: 3030 290d 0a20 2020 2020 2020 2020 2020  00)..           
+0008b980: 2020 2020 2073 656c 662e 684c 696e 652e       self.hLine.
+0008b990: 7365 745a 5661 6c75 6528 2d31 3030 3029  setZValue(-1000)
+0008b9a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0008b9b0: 2020 7365 6c66 2e76 4c69 6e65 2e73 6574    self.vLine.set
+0008b9c0: 5065 6e28 2230 3030 3022 290d 0a20 2020  Pen("0000")..   
+0008b9d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0008b9e0: 662e 684c 696e 652e 7365 7450 656e 2822  f.hLine.setPen("
+0008b9f0: 3030 3030 2229 0d0a 0d0a 2020 2020 6465  0000")....    de
+0008ba00: 6620 7365 744f 4462 6172 2873 656c 662c  f setODbar(self,
+0008ba10: 6d69 6e3d 4e6f 6e65 2c6d 6178 3d4e 6f6e  min=None,max=Non
+0008ba20: 6529 3a0d 0a20 2020 2020 2020 2073 656c  e):..        sel
+0008ba30: 662e 636d 2e73 6574 5261 6e67 6528 7852  f.cm.setRange(xR
+0008ba40: 616e 6765 3d5b 302c 315d 2c20 7952 616e  ange=[0,1], yRan
+0008ba50: 6765 3d5b 6d69 6e2c 6d61 785d 2c20 7570  ge=[min,max], up
+0008ba60: 6461 7465 3d46 616c 7365 2c20 6469 7361  date=False, disa
+0008ba70: 626c 6541 7574 6f52 616e 6765 3d54 7275  bleAutoRange=Tru
+0008ba80: 652c 7061 6464 696e 673d 3029 0d0a 2020  e,padding=0)..  
+0008ba90: 2020 2020 2020 7365 6c66 2e63 6d69 6d67        self.cmimg
+0008baa0: 2e73 6574 5265 6374 2851 7443 6f72 652e  .setRect(QtCore.
+0008bab0: 5152 6563 7446 2830 2c6d 696e 2c31 2c6d  QRectF(0,min,1,m
+0008bac0: 6178 2d6d 696e 2929 0d0a 0d0a 2020 2020  ax-min))....    
+0008bad0: 6465 6620 6b65 7950 7265 7373 4576 656e  def keyPressEven
+0008bae0: 7428 7365 6c66 2c20 6529 3a0d 0a20 2020  t(self, e):..   
+0008baf0: 2020 2020 206d 6f64 6966 6965 7273 203d       modifiers =
+0008bb00: 2051 7457 6964 6765 7473 2e51 4170 706c   QtWidgets.QAppl
+0008bb10: 6963 6174 696f 6e2e 6b65 7962 6f61 7264  ication.keyboard
+0008bb20: 4d6f 6469 6669 6572 7328 290d 0a20 2020  Modifiers()..   
+0008bb30: 2020 2020 2069 6620 6d6f 6469 6669 6572       if modifier
+0008bb40: 7320 3d3d 2051 7443 6f72 652e 5174 2e53  s == QtCore.Qt.S
+0008bb50: 6869 6674 4d6f 6469 6669 6572 3a0d 0a20  hiftModifier:.. 
+0008bb60: 2020 2020 2020 2020 2020 206e 6f73 6869             noshi
+0008bb70: 6674 203d 2046 616c 7365 0d0a 2020 2020  ft = False..    
+0008bb80: 2020 2020 656c 6966 206d 6f64 6966 6965      elif modifie
+0008bb90: 7273 203d 3d20 5174 436f 7265 2e51 742e  rs == QtCore.Qt.
+0008bba0: 4b65 7970 6164 4d6f 6469 6669 6572 3a0d  KeypadModifier:.
+0008bbb0: 0a20 2020 2020 2020 2020 2020 206e 6f73  .            nos
+0008bbc0: 6869 6674 203d 2054 7275 650d 0a20 2020  hift = True..   
+0008bbd0: 2020 2020 2065 6c69 6620 6d6f 6469 6669       elif modifi
+0008bbe0: 6572 7320 3d3d 2028 5174 436f 7265 2e51  ers == (QtCore.Q
+0008bbf0: 742e 4b65 7970 6164 4d6f 6469 6669 6572  t.KeypadModifier
+0008bc00: 207c 0d0a 2020 2020 2020 2020 2020 2020   |..            
+0008bc10: 2020 2020 2020 2020 2020 2020 2020 2051                 Q
+0008bc20: 7443 6f72 652e 5174 2e53 6869 6674 4d6f  tCore.Qt.ShiftMo
+0008bc30: 6469 6669 6572 293a 0d0a 2020 2020 2020  difier):..      
+0008bc40: 2020 2020 2020 6e6f 7368 6966 7420 3d20        noshift = 
+0008bc50: 4661 6c73 650d 0a20 2020 2020 2020 2065  False..        e
+0008bc60: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0008bc70: 2020 6e6f 7368 6966 7420 3d20 5472 7565    noshift = True
+0008bc80: 0d0a 2020 2020 2020 2020 6966 2065 2e6b  ..        if e.k
+0008bc90: 6579 2829 203d 3d20 3637 2061 6e64 2028  ey() == 67 and (
+0008bca0: 652e 6d6f 6469 6669 6572 7328 2920 2620  e.modifiers() & 
+0008bcb0: 5174 436f 7265 2e51 742e 436f 6e74 726f  QtCore.Qt.Contro
+0008bcc0: 6c4d 6f64 6966 6965 7229 3a0d 0a20 2020  lModifier):..   
+0008bcd0: 2020 2020 2020 2020 2073 656c 662e 4f6e           self.On
+0008bce0: 436f 7079 2829 0d0a 2020 2020 2020 2020  Copy()..        
+0008bcf0: 6966 2065 2e6b 6579 2829 203d 3d20 5174  if e.key() == Qt
+0008bd00: 2e4b 6579 5f55 7020 6f72 2028 652e 6b65  .Key_Up or (e.ke
+0008bd10: 7928 2920 3d3d 2051 7443 6f72 652e 5174  y() == QtCore.Qt
+0008bd20: 2e4b 6579 5f38 293a 0d0a 2020 2020 2020  .Key_8):..      
+0008bd30: 2020 2020 2020 6966 206e 6f73 6869 6674        if noshift
+0008bd40: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0008bd50: 2020 2073 656c 662e 7062 5555 2e63 6c69     self.pbUU.cli
+0008bd60: 636b 2829 0d0a 2020 2020 2020 2020 2020  ck()..          
+0008bd70: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0008bd80: 2020 2020 2020 2020 2073 656c 662e 7062           self.pb
+0008bd90: 552e 636c 6963 6b28 290d 0a20 2020 2020  U.click()..     
+0008bda0: 2020 2065 6c69 6620 652e 6b65 7928 2920     elif e.key() 
+0008bdb0: 3d3d 2051 742e 4b65 795f 446f 776e 206f  == Qt.Key_Down o
+0008bdc0: 7220 2865 2e6b 6579 2829 203d 3d20 5174  r (e.key() == Qt
+0008bdd0: 436f 7265 2e51 742e 4b65 795f 3229 3a0d  Core.Qt.Key_2):.
+0008bde0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0008bdf0: 6e6f 7368 6966 743a 0d0a 2020 2020 2020  noshift:..      
+0008be00: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0008be10: 6244 442e 636c 6963 6b28 290d 0a20 2020  bDD.click()..   
+0008be20: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0008be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008be40: 7365 6c66 2e70 6244 2e63 6c69 636b 2829  self.pbD.click()
+0008be50: 0d0a 2020 2020 2020 2020 656c 6966 2065  ..        elif e
+0008be60: 2e6b 6579 2829 203d 3d20 5174 2e4b 6579  .key() == Qt.Key
+0008be70: 5f4c 6566 7420 6f72 2028 652e 6b65 7928  _Left or (e.key(
+0008be80: 2920 3d3d 2051 7443 6f72 652e 5174 2e4b  ) == QtCore.Qt.K
+0008be90: 6579 5f34 293a 0d0a 2020 2020 2020 2020  ey_4):..        
+0008bea0: 2020 2020 6966 206e 6f73 6869 6674 3a0d      if noshift:.
+0008beb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008bec0: 2073 656c 662e 7062 4c4c 2e63 6c69 636b   self.pbLL.click
+0008bed0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0008bee0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0008bef0: 2020 2020 2020 2073 656c 662e 7062 4c2e         self.pbL.
+0008bf00: 636c 6963 6b28 290d 0a20 2020 2020 2020  click()..       
+0008bf10: 2065 6c69 6620 652e 6b65 7928 2920 3d3d   elif e.key() ==
+0008bf20: 2051 742e 4b65 795f 5269 6768 7420 6f72   Qt.Key_Right or
+0008bf30: 2028 652e 6b65 7928 2920 3d3d 2051 7443   (e.key() == QtC
+0008bf40: 6f72 652e 5174 2e4b 6579 5f36 293a 0d0a  ore.Qt.Key_6):..
+0008bf50: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0008bf60: 6f73 6869 6674 3a0d 0a20 2020 2020 2020  oshift:..       
+0008bf70: 2020 2020 2020 2020 2073 656c 662e 7062           self.pb
+0008bf80: 5252 2e63 6c69 636b 2829 0d0a 2020 2020  RR.click()..    
+0008bf90: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0008bfa0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0008bfb0: 656c 662e 7062 522e 636c 6963 6b28 290d  elf.pbR.click().
+0008bfc0: 0a20 2020 2020 2020 2065 6c69 6620 652e  .        elif e.
+0008bfd0: 6b65 7928 2920 3d3d 2051 7443 6f72 652e  key() == QtCore.
+0008bfe0: 5174 2e4b 6579 5f48 6f6d 653a 0d0a 2020  Qt.Key_Home:..  
+0008bff0: 2020 2020 2020 2020 2020 6966 206e 6f73            if nos
+0008c000: 6869 6674 3a0d 0a20 2020 2020 2020 2020  hift:..         
+0008c010: 2020 2020 2020 2073 656c 662e 7062 4c4c         self.pbLL
+0008c020: 5555 2e63 6c69 636b 2829 0d0a 2020 2020  UU.click()..    
+0008c030: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0008c040: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0008c050: 656c 662e 7062 4c55 2e63 6c69 636b 2829  elf.pbLU.click()
+0008c060: 0d0a 2020 2020 2020 2020 656c 6966 2065  ..        elif e
+0008c070: 2e6b 6579 2829 203d 3d20 5174 436f 7265  .key() == QtCore
+0008c080: 2e51 742e 4b65 795f 5061 6765 5570 3a0d  .Qt.Key_PageUp:.
+0008c090: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0008c0a0: 6e6f 7368 6966 743a 0d0a 2020 2020 2020  noshift:..      
+0008c0b0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0008c0c0: 6252 5255 552e 636c 6963 6b28 290d 0a20  bRRUU.click().. 
+0008c0d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0008c0e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0008c0f0: 2020 7365 6c66 2e70 6252 552e 636c 6963    self.pbRU.clic
+0008c100: 6b28 290d 0a20 2020 2020 2020 2065 6c69  k()..        eli
+0008c110: 6620 652e 6b65 7928 2920 3d3d 2051 7443  f e.key() == QtC
+0008c120: 6f72 652e 5174 2e4b 6579 5f45 6e64 3a0d  ore.Qt.Key_End:.
+0008c130: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0008c140: 6e6f 7368 6966 743a 0d0a 2020 2020 2020  noshift:..      
+0008c150: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0008c160: 624c 4c44 442e 636c 6963 6b28 290d 0a20  bLLDD.click().. 
+0008c170: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0008c180: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0008c190: 2020 7365 6c66 2e70 624c 442e 636c 6963    self.pbLD.clic
+0008c1a0: 6b28 290d 0a20 2020 2020 2020 2065 6c69  k()..        eli
+0008c1b0: 6620 652e 6b65 7928 2920 3d3d 2051 7443  f e.key() == QtC
+0008c1c0: 6f72 652e 5174 2e4b 6579 5f50 6167 6544  ore.Qt.Key_PageD
+0008c1d0: 6f77 6e3a 0d0a 2020 2020 2020 2020 2020  own:..          
+0008c1e0: 2020 6966 206e 6f73 6869 6674 3a0d 0a20    if noshift:.. 
+0008c1f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0008c200: 656c 662e 7062 5252 4444 2e63 6c69 636b  elf.pbRRDD.click
+0008c210: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0008c220: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0008c230: 2020 2020 2020 2073 656c 662e 7062 5244         self.pbRD
+0008c240: 2e63 6c69 636b 2829 0d0a 2020 2020 2020  .click()..      
+0008c250: 2020 656c 6966 2065 2e6b 6579 2829 203d    elif e.key() =
+0008c260: 3d20 5174 436f 7265 2e51 742e 4b65 795f  = QtCore.Qt.Key_
+0008c270: 436c 6561 723a 0d0a 2020 2020 2020 2020  Clear:..        
+0008c280: 2020 2020 2020 2020 7365 6c66 2e70 6252          self.pbR
+0008c290: 5354 2e63 6c69 636b 2829 0d0a 0d0a 2020  ST.click()....  
+0008c2a0: 2020 6465 6620 436c 6561 7228 7365 6c66    def Clear(self
+0008c2b0: 293a 0d0a 2020 2020 2020 2020 7472 793a  ):..        try:
+0008c2c0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0008c2d0: 6c66 2e73 6c69 6465 725f 656e 672e 7661  lf.slider_eng.va
+0008c2e0: 6c75 6543 6861 6e67 6564 2e64 6973 636f  lueChanged.disco
+0008c2f0: 6e6e 6563 7428 290d 0a20 2020 2020 2020  nnect()..       
+0008c300: 2020 2020 2073 656c 662e 716c 6973 7463       self.qlistc
+0008c310: 6861 6e67 6564 2e64 6973 636f 6e6e 6563  hanged.disconnec
+0008c320: 7428 290d 0a20 2020 2020 2020 2065 7863  t()..        exc
+0008c330: 6570 743a 0d0a 2020 2020 2020 2020 2020  ept:..          
+0008c340: 2020 7061 7373 0d0a 2020 2020 2020 2020    pass..        
+0008c350: 7365 6c66 2e70 7265 6c73 7420 3d20 5b5d  self.prelst = []
+0008c360: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+0008c370: 6f73 746c 7374 203d 5b5d 0d0a 2020 2020  ostlst =[]..    
+0008c380: 2020 2020 7365 6c66 2e73 746b 2e73 6869      self.stk.shi
+0008c390: 6674 7320 3d20 5b5d 0d0a 2020 2020 2020  fts = []..      
+0008c3a0: 2020 7365 6c66 2e73 746b 2e61 6273 6461    self.stk.absda
+0008c3b0: 7461 5f73 6869 6674 6564 3d20 5b5d 0d0a  ta_shifted= []..
+0008c3c0: 2020 2020 2020 2020 7365 6c66 2e70 312e          self.p1.
+0008c3d0: 636c 6561 7228 290d 0a20 2020 2020 2020  clear()..       
+0008c3e0: 2073 656c 662e 7032 2e63 6c65 6172 2829   self.p2.clear()
+0008c3f0: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+0008c400: 6d2e 636c 6561 7228 290d 0a20 2020 2020  m.clear()..     
+0008c410: 2020 2073 656c 662e 4d61 7053 656c 6563     self.MapSelec
+0008c420: 7457 6964 6765 7431 2e63 6c65 6172 2829  tWidget1.clear()
+0008c430: 0d0a 0d0a 2020 2020 6465 6620 4c6f 6164  ....    def Load
+0008c440: 456e 7472 6965 7328 7365 6c66 293a 2023  Entries(self): #
+0008c450: 2043 616c 6c65 6420 7768 656e 2066 7265   Called when fre
+0008c460: 7368 2064 6174 6120 6172 6520 6c6f 6164  sh data are load
+0008c470: 6564 2e0d 0a20 2020 2020 2020 2073 656c  ed...        sel
+0008c480: 662e 4f44 4869 6768 5370 696e 426f 782e  f.ODHighSpinBox.
+0008c490: 7365 7445 6e61 626c 6564 2846 616c 7365  setEnabled(False
+0008c4a0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0008c4b0: 4f44 4c6f 7753 7069 6e42 6f78 2e73 6574  ODLowSpinBox.set
+0008c4c0: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
+0008c4d0: 2020 2020 2020 2020 7365 6c66 2e70 6252          self.pbR
+0008c4e0: 5354 4f44 2e73 6574 456e 6162 6c65 6428  STOD.setEnabled(
+0008c4f0: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
+0008c500: 7365 6c66 2e66 696c 7465 7253 7069 6e42  self.filterSpinB
+0008c510: 6f78 2e73 6574 456e 6162 6c65 6428 4661  ox.setEnabled(Fa
+0008c520: 6c73 6529 0d0a 2020 2020 2020 2020 7365  lse)..        se
+0008c530: 6c66 2e70 6245 7870 4461 7461 2e73 6574  lf.pbExpData.set
+0008c540: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
+0008c550: 2020 2020 2020 2020 7365 6c66 2e70 6245          self.pbE
+0008c560: 7870 496d 672e 7365 7445 6e61 626c 6564  xpImg.setEnabled
+0008c570: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
+0008c580: 2073 656c 662e 7062 436c 7253 656c 2e73   self.pbClrSel.s
+0008c590: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
+0008c5a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+0008c5b0: 746b 2e61 6273 6461 7461 5f73 6869 6674  tk.absdata_shift
+0008c5c0: 6564 203d 2073 656c 662e 7374 6b2e 6162  ed = self.stk.ab
+0008c5d0: 7364 6174 612e 636f 7079 2829 0d0a 2020  sdata.copy()..  
+0008c5e0: 2020 2020 2020 7365 6c66 2e70 312e 6164        self.p1.ad
+0008c5f0: 6449 7465 6d28 7365 6c66 2e69 5f69 7465  dItem(self.i_ite
+0008c600: 6d29 0d0a 2020 2020 2020 2020 666f 7220  m)..        for 
+0008c610: 692c 6520 696e 2065 6e75 6d65 7261 7465  i,e in enumerate
+0008c620: 2873 656c 662e 7374 6b2e 6576 293a 2023  (self.stk.ev): #
+0008c630: 2046 696c 6c20 514c 6973 7420 7769 7468   Fill QList with
+0008c640: 2065 6e65 7267 6965 730d 0a20 2020 2020   energies..     
+0008c650: 2020 2020 2020 2073 656c 662e 7374 6b2e         self.stk.
+0008c660: 7368 6966 7473 2e61 7070 656e 6428 5b31  shifts.append([1
+0008c670: 2c30 2c28 302e 302c 302e 3029 5d29 2023  ,0,(0.0,0.0)]) #
+0008c680: 6368 6563 6b65 6420 5b30 2c31 5d3b 2070  checked [0,1]; p
+0008c690: 7265 2c20 706f 7374 2c20 756e 6465 6669  re, post, undefi
+0008c6a0: 6e65 6420 7374 6174 6520 666f 7220 6d61  ned state for ma
+0008c6b0: 7020 5b2d 312c 312c 305d 2c28 7873 6869  p [-1,1,0],(xshi
+0008c6c0: 6674 205b 666c 6f61 745d 2c79 7368 6966  ft [float],yshif
+0008c6d0: 7420 5b66 6c6f 6174 5d29 0d0a 2020 2020  t [float])..    
+0008c6e0: 2020 2020 2020 2020 6974 656d 203d 2051          item = Q
+0008c6f0: 7457 6964 6765 7473 2e51 4c69 7374 5769  tWidgets.QListWi
+0008c700: 6467 6574 4974 656d 2873 7472 2869 6e74  dgetItem(str(int
+0008c710: 2869 2929 2e7a 6669 6c6c 2833 292b 2220  (i)).zfill(3)+" 
+0008c720: 2020 2020 6174 2020 2020 2022 202b 2066      at     " + f
+0008c730: 6f72 6d61 7428 652c 2027 2e32 6627 2920  ormat(e, '.2f') 
+0008c740: 2b20 2220 6556 2020 2020 2022 2b22 2b30  + " eV     "+"+0
+0008c750: 2e30 222b 2220 2020 202b 302e 3022 290d  .0"+"    +0.0").
+0008c760: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0008c770: 662e 4d61 7053 656c 6563 7457 6964 6765  f.MapSelectWidge
+0008c780: 7431 2e61 6464 4974 656d 2869 7465 6d29  t1.addItem(item)
+0008c790: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+0008c7a0: 6c69 6465 725f 656e 672e 7661 6c75 6543  lider_eng.valueC
+0008c7b0: 6861 6e67 6564 5b69 6e74 5d2e 636f 6e6e  hanged[int].conn
+0008c7c0: 6563 7428 7365 6c66 2e4f 6e53 6372 6f6c  ect(self.OnScrol
+0008c7d0: 6c45 6e67 290d 0a20 2020 2020 2020 2073  lEng)..        s
+0008c7e0: 656c 662e 716c 6973 7463 6861 6e67 6564  elf.qlistchanged
+0008c7f0: 2e63 6f6e 6e65 6374 2873 656c 662e 714c  .connect(self.qL
+0008c800: 6973 7443 6861 6e67 6548 616e 646c 6572  istChangeHandler
+0008c810: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0008c820: 4f6e 5363 726f 6c6c 456e 6728 3029 2023  OnScrollEng(0) #
+0008c830: 2050 6c6f 7420 6669 7273 7420 696d 6167   Plot first imag
+0008c840: 6520 2620 7365 7420 5363 726f 6c6c 6261  e & set Scrollba
+0008c850: 720d 0a20 2020 2020 2020 2073 656c 662e  r..        self.
+0008c860: 4f6e 4d65 7472 6963 5363 616c 6528 7365  OnMetricScale(se
+0008c870: 6c66 2e4d 6574 7269 6343 6865 636b 426f  lf.MetricCheckBo
+0008c880: 782e 6973 4368 6563 6b65 6428 292c 2054  x.isChecked(), T
+0008c890: 7275 652c 2046 616c 7365 290d 0a20 2020  rue, False)..   
+0008c8a0: 2020 2020 2073 656c 662e 7062 5365 6c66       self.pbSelf
+0008c8b0: 726f 6d53 7065 632e 7365 7445 6e61 626c  romSpec.setEnabl
+0008c8c0: 6564 2854 7275 6529 0d0a 2020 2020 2020  ed(True)..      
+0008c8d0: 2020 7365 6c66 2e70 6253 656c 6672 6f6d    self.pbSelfrom
+0008c8e0: 5370 6563 2e63 6c69 636b 6564 2e63 6f6e  Spec.clicked.con
+0008c8f0: 6e65 6374 2873 656c 662e 4f6e 5365 6c66  nect(self.OnSelf
+0008c900: 726f 6d53 7065 6329 0d0a 2020 2020 6465  romSpec)..    de
+0008c910: 6620 5570 6461 7465 456e 7472 7928 7365  f UpdateEntry(se
+0008c920: 6c66 2c72 6f77 293a 0d0a 2020 2020 2020  lf,row):..      
+0008c930: 2020 7365 6c66 2e4d 6170 5365 6c65 6374    self.MapSelect
+0008c940: 5769 6467 6574 312e 6974 656d 2872 6f77  Widget1.item(row
+0008c950: 292e 7365 7454 6578 7428 7374 7228 696e  ).setText(str(in
+0008c960: 7428 726f 7729 292e 7a66 696c 6c28 3329  t(row)).zfill(3)
+0008c970: 2b22 2020 2020 2061 7420 2020 2020 2220  +"     at     " 
+0008c980: 2b20 666f 726d 6174 2873 656c 662e 7374  + format(self.st
+0008c990: 6b2e 6576 5b72 6f77 5d2c 2027 2e32 6627  k.ev[row], '.2f'
+0008c9a0: 2920 2b20 2220 6556 2020 2020 2022 2b66  ) + " eV     "+f
+0008c9b0: 6f72 6d61 7428 7365 6c66 2e73 746b 2e73  ormat(self.stk.s
+0008c9c0: 6869 6674 735b 726f 775d 5b32 5d5b 305d  hifts[row][2][0]
+0008c9d0: 2c20 272b 2e31 6627 292b 2220 2020 2022  , '+.1f')+"    "
+0008c9e0: 2b66 6f72 6d61 7428 7365 6c66 2e73 746b  +format(self.stk
+0008c9f0: 2e73 6869 6674 735b 726f 775d 5b32 5d5b  .shifts[row][2][
+0008ca00: 315d 2c20 272b 2e31 6627 2929 0d0a 2020  1], '+.1f'))..  
+0008ca10: 2020 2020 2020 2373 656c 662e 4d61 7053        #self.MapS
+0008ca20: 656c 6563 7457 6964 6765 7431 2e61 6464  electWidget1.add
+0008ca30: 4974 656d 2873 656c 662e 4d61 7053 656c  Item(self.MapSel
+0008ca40: 6563 7457 6964 6765 7431 2e69 7465 6d28  ectWidget1.item(
+0008ca50: 726f 7729 290d 0a20 2020 2020 2020 2073  row))..        s
+0008ca60: 656c 662e 695f 6974 656d 2e73 6574 496d  elf.i_item.setIm
+0008ca70: 6167 6528 7365 6c66 2e53 6869 6674 2872  age(self.Shift(r
+0008ca80: 6f77 2929 0d0a 2020 2020 6465 6620 5265  ow))..    def Re
+0008ca90: 7365 7441 6c6c 4974 656d 7328 7365 6c66  setAllItems(self
+0008caa0: 2c77 6964 6765 7429 3a0d 0a20 2020 2020  ,widget):..     
+0008cab0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+0008cac0: 6528 7769 6467 6574 2e63 6f75 6e74 2829  e(widget.count()
+0008cad0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0008cae0: 7769 6467 6574 2e69 7465 6d28 6929 2e73  widget.item(i).s
+0008caf0: 6574 466f 7265 6772 6f75 6e64 2851 7447  etForeground(QtG
+0008cb00: 7569 2e51 436f 6c6f 7228 302c 2030 2c20  ui.QColor(0, 0, 
+0008cb10: 302c 2031 3238 2929 0d0a 2020 2020 6465  0, 128))..    de
+0008cb20: 6620 4f6e 5363 726f 6c6c 456e 6728 7365  f OnScrollEng(se
+0008cb30: 6c66 2c20 7661 6c75 6529 3a0d 0a20 2020  lf, value):..   
+0008cb40: 2020 2020 2073 656c 662e 736c 6964 6572       self.slider
+0008cb50: 5f65 6e67 2e62 6c6f 636b 5369 676e 616c  _eng.blockSignal
+0008cb60: 7328 5472 7565 290d 0a20 2020 2020 2020  s(True)..       
+0008cb70: 2073 656c 662e 736c 6964 6572 5f65 6e67   self.slider_eng
+0008cb80: 2e73 6574 5661 6c75 6528 7661 6c75 6529  .setValue(value)
+0008cb90: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+0008cba0: 6c69 6465 725f 656e 672e 626c 6f63 6b53  lider_eng.blockS
+0008cbb0: 6967 6e61 6c73 2846 616c 7365 290d 0a20  ignals(False).. 
+0008cbc0: 2020 2020 2020 2073 656c 662e 4d61 7053         self.MapS
+0008cbd0: 656c 6563 7457 6964 6765 7431 2e73 6574  electWidget1.set
+0008cbe0: 4375 7272 656e 7452 6f77 2876 616c 7565  CurrentRow(value
+0008cbf0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0008cc00: 5265 7365 7441 6c6c 4974 656d 7328 7365  ResetAllItems(se
+0008cc10: 6c66 2e4d 6170 5365 6c65 6374 5769 6467  lf.MapSelectWidg
+0008cc20: 6574 3129 0d0a 2020 2020 2020 2020 7365  et1)..        se
+0008cc30: 6c66 2e69 6576 203d 2076 616c 7565 0d0a  lf.iev = value..
+0008cc40: 2020 2020 2020 2020 7365 6c66 2e70 312e          self.p1.
+0008cc50: 7469 746c 654c 6162 656c 2e69 7465 6d2e  titleLabel.item.
+0008cc60: 7365 7454 6578 7457 6964 7468 2873 656c  setTextWidth(sel
+0008cc70: 662e 7031 2e77 6964 7468 2829 202a 2030  f.p1.width() * 0
+0008cc80: 2e37 290d 0a20 2020 2020 2020 2073 656c  .7)..        sel
+0008cc90: 662e 7032 2e74 6974 6c65 4c61 6265 6c2e  f.p2.titleLabel.
+0008cca0: 6974 656d 2e73 6574 5465 7874 5769 6474  item.setTextWidt
+0008ccb0: 6828 7365 6c66 2e70 322e 7769 6474 6828  h(self.p2.width(
+0008ccc0: 2920 2a20 302e 3729 0d0a 2020 2020 2020  ) * 0.7)..      
+0008ccd0: 2020 2373 656c 662e 6361 6e76 6173 2e72    #self.canvas.r
+0008cce0: 6573 697a 6545 7665 6e74 284e 6f6e 6529  esizeEvent(None)
+0008ccf0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0008cd00: 662e 636f 6d2e 7374 6163 6b5f 6c6f 6164  f.com.stack_load
+0008cd10: 6564 203d 3d20 313a 0d0a 2020 2020 2020  ed == 1:..      
+0008cd20: 2020 2020 2020 7365 6c66 2e70 312e 7469        self.p1.ti
+0008cd30: 746c 654c 6162 656c 2e73 6574 5465 7874  tleLabel.setText
+0008cd40: 2822 3c63 656e 7465 723e 496d 6167 6520  ("<center>Image 
+0008cd50: 6174 2065 6e65 7267 7920 7b30 3a35 2e32  at energy {0:5.2
+0008cd60: 667d 2065 563c 2f63 656e 7465 723e 222e  f} eV</center>".
+0008cd70: 666f 726d 6174 2866 6c6f 6174 2873 656c  format(float(sel
+0008cd80: 662e 7374 6b2e 6576 5b73 656c 662e 6965  f.stk.ev[self.ie
+0008cd90: 765d 2929 2c73 697a 653d 2731 3070 7427  v])),size='10pt'
+0008cda0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0008cdb0: 656c 662e 695f 6974 656d 2e73 6574 496d  elf.i_item.setIm
+0008cdc0: 6167 6528 7365 6c66 2e53 6869 6674 2869  age(self.Shift(i
+0008cdd0: 6e74 2873 656c 662e 6965 7629 2929 0d0a  nt(self.iev)))..
+0008cde0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0008cdf0: 2e4d 6170 5365 6c65 6374 5769 6467 6574  .MapSelectWidget
+0008ce00: 312e 6974 656d 2876 616c 7565 292e 7365  1.item(value).se
+0008ce10: 7446 6f72 6567 726f 756e 6428 5174 4775  tForeground(QtGu
+0008ce20: 692e 5143 6f6c 6f72 2830 2c20 302c 2030  i.QColor(0, 0, 0
+0008ce30: 2c20 3235 3529 290d 0a0d 0a20 2020 2064  , 255))....    d
+0008ce40: 6566 204f 6e43 726f 7043 4228 7365 6c66  ef OnCropCB(self
+0008ce50: 2c20 7661 6c75 653d 5472 7565 293a 0d0a  , value=True):..
+0008ce60: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0008ce70: 636f 6d2e 7374 6163 6b5f 6c6f 6164 6564  com.stack_loaded
+0008ce80: 203d 3d20 313a 0d0a 2020 2020 2020 2020   == 1:..        
+0008ce90: 2020 2020 6966 2076 616c 7565 203d 3d20      if value == 
+0008cea0: 5472 7565 3a0d 0a20 2020 2020 2020 2020  True:..         
+0008ceb0: 2020 2020 2020 2073 656c 662e 6372 6f70         self.crop
+0008cec0: 666c 6167 203d 2054 7275 650d 0a20 2020  flag = True..   
+0008ced0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0008cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008cef0: 7365 6c66 2e63 726f 7066 6c61 6720 3d20  self.cropflag = 
+0008cf00: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+0008cf10: 2020 2073 656c 662e 5368 6f77 4d61 7028     self.ShowMap(
+0008cf20: 7365 6c66 2e70 7265 6c73 742c 2073 656c  self.prelst, sel
+0008cf30: 662e 706f 7374 6c73 7429 0d0a 0d0a 0d0a  f.postlst)......
+0008cf40: 2020 2020 6465 6620 4f6e 4d65 7472 6963      def OnMetric
+0008cf50: 5363 616c 6528 7365 6c66 2c20 7365 746d  Scale(self, setm
+0008cf60: 6574 7269 633d 2054 7275 652c 207a 6572  etric= True, zer
+0008cf70: 6f6f 7269 6769 6e3d 2054 7275 652c 2073  oorigin= True, s
+0008cf80: 7175 6172 653d 2046 616c 7365 293a 0d0a  quare= False):..
+0008cf90: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0008cfa0: 636f 6d2e 7374 6163 6b5f 6c6f 6164 6564  com.stack_loaded
+0008cfb0: 203d 3d20 313a 0d0a 2020 2020 2020 2020   == 1:..        
+0008cfc0: 2020 2020 6966 2073 6574 6d65 7472 6963      if setmetric
+0008cfd0: 3d3d 5472 7565 3a0d 0a20 2020 2020 2020  ==True:..       
+0008cfe0: 2020 2020 2020 2020 2073 656c 662e 5371           self.Sq
+0008cff0: 7561 7265 5078 4368 6563 6b42 6f78 2e73  uarePxCheckBox.s
+0008d000: 6574 5669 7369 626c 6528 4661 6c73 6529  etVisible(False)
+0008d010: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0008d020: 2020 7365 6c66 2e5a 6572 6f4f 7269 6769    self.ZeroOrigi
+0008d030: 6e43 6865 636b 426f 782e 7365 7456 6973  nCheckBox.setVis
+0008d040: 6962 6c65 2854 7275 6529 0d0a 2020 2020  ible(True)..    
+0008d050: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0008d060: 2e70 312e 7365 7441 7370 6563 744c 6f63  .p1.setAspectLoc
+0008d070: 6b65 6428 6c6f 636b 3d54 7275 652c 2072  ked(lock=True, r
+0008d080: 6174 696f 3d31 290d 0a20 2020 2020 2020  atio=1)..       
+0008d090: 2020 2020 2020 2020 2073 656c 662e 7032           self.p2
+0008d0a0: 2e73 6574 4173 7065 6374 4c6f 636b 6564  .setAspectLocked
+0008d0b0: 286c 6f63 6b3d 5472 7565 2c20 7261 7469  (lock=True, rati
+0008d0c0: 6f3d 3129 0d0a 2020 2020 2020 2020 2020  o=1)..          
+0008d0d0: 2020 2020 2020 6966 206e 6f74 207a 6572        if not zer
+0008d0e0: 6f6f 7269 6769 6e3a 0d0a 2020 2020 2020  oorigin:..      
+0008d0f0: 2020 2020 2020 2020 2020 2020 2020 785f                x_
+0008d100: 7374 6172 7420 3d20 7365 6c66 2e73 746b  start = self.stk
+0008d110: 2e78 5f73 7461 7274 2a73 656c 662e 7363  .x_start*self.sc
+0008d120: 616c 650d 0a20 2020 2020 2020 2020 2020  ale..           
+0008d130: 2020 2020 2020 2020 2079 5f73 7461 7274           y_start
+0008d140: 203d 2073 656c 662e 7374 6b2e 795f 7374   = self.stk.y_st
+0008d150: 6172 742a 7365 6c66 2e73 6361 6c65 0d0a  art*self.scale..
+0008d160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008d170: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0008d180: 2020 2020 2020 2020 2020 2078 5f73 7461             x_sta
+0008d190: 7274 203d 2030 0d0a 2020 2020 2020 2020  rt = 0..        
+0008d1a0: 2020 2020 2020 2020 2020 2020 795f 7374              y_st
+0008d1b0: 6172 7420 3d20 300d 0a20 2020 2020 2020  art = 0..       
+0008d1c0: 2020 2020 2020 2020 2073 656c 662e 6179           self.ay
+0008d1d0: 312e 7365 744c 6162 656c 2874 6578 743d  1.setLabel(text=
+0008d1e0: 2279 222c 2075 6e69 7473 3d22 6d22 290d  "y", units="m").
+0008d1f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008d200: 2073 656c 662e 6178 312e 7365 744c 6162   self.ax1.setLab
+0008d210: 656c 2874 6578 743d 2278 222c 2075 6e69  el(text="x", uni
+0008d220: 7473 3d22 6d22 290d 0a20 2020 2020 2020  ts="m")..       
+0008d230: 2020 2020 2020 2020 2073 656c 662e 6179           self.ay
+0008d240: 322e 7365 744c 6162 656c 2874 6578 743d  2.setLabel(text=
+0008d250: 2279 222c 2075 6e69 7473 3d22 6d22 290d  "y", units="m").
+0008d260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008d270: 2073 656c 662e 6178 322e 7365 744c 6162   self.ax2.setLab
+0008d280: 656c 2874 6578 743d 2278 222c 2075 6e69  el(text="x", uni
+0008d290: 7473 3d22 6d22 290d 0a0d 0a20 2020 2020  ts="m")....     
+0008d2a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0008d2b0: 695f 6974 656d 2e73 6574 5265 6374 2851  i_item.setRect(Q
+0008d2c0: 7443 6f72 652e 5152 6563 7446 2878 5f73  tCore.QRectF(x_s
+0008d2d0: 7461 7274 2c20 795f 7374 6172 742c 2073  tart, y_start, s
+0008d2e0: 656c 662e 7363 616c 652a 7365 6c66 2e73  elf.scale*self.s
+0008d2f0: 746b 2e6e 5f63 6f6c 732a 7365 6c66 2e73  tk.n_cols*self.s
+0008d300: 746b 2e78 5f70 7873 697a 652c 2073 656c  tk.x_pxsize, sel
+0008d310: 662e 7363 616c 652a 7365 6c66 2e73 746b  f.scale*self.stk
+0008d320: 2e6e 5f72 6f77 732a 7365 6c66 2e73 746b  .n_rows*self.stk
+0008d330: 2e79 5f70 7873 697a 6529 290d 0a20 2020  .y_pxsize))..   
+0008d340: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0008d350: 6861 7361 7474 7228 7365 6c66 2c20 224f  hasattr(self, "O
+0008d360: 4422 293a 0d0a 2020 2020 2020 2020 2020  D"):..          
+0008d370: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+0008d380: 5f69 7465 6d2e 7365 7452 6563 7428 5174  _item.setRect(Qt
+0008d390: 436f 7265 2e51 5265 6374 4628 785f 7374  Core.QRectF(x_st
+0008d3a0: 6172 742c 2079 5f73 7461 7274 2c20 7365  art, y_start, se
+0008d3b0: 6c66 2e73 6361 6c65 2a6e 702e 7368 6170  lf.scale*np.shap
+0008d3c0: 6528 7365 6c66 2e4f 4429 5b30 5d2a 7365  e(self.OD)[0]*se
+0008d3d0: 6c66 2e73 746b 2e78 5f70 7873 697a 652c  lf.stk.x_pxsize,
+0008d3e0: 2073 656c 662e 7363 616c 652a 6e70 2e73   self.scale*np.s
+0008d3f0: 6861 7065 2873 656c 662e 4f44 295b 315d  hape(self.OD)[1]
+0008d400: 2a73 656c 662e 7374 6b2e 795f 7078 7369  *self.stk.y_pxsi
+0008d410: 7a65 2929 0d0a 2020 2020 2020 2020 2020  ze))..          
+0008d420: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0008d430: 6574 4372 6f73 7368 6169 7228 290d 0a20  etCrosshair().. 
+0008d440: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0008d450: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0008d460: 2020 7365 6c66 2e5a 6572 6f4f 7269 6769    self.ZeroOrigi
+0008d470: 6e43 6865 636b 426f 782e 7365 7456 6973  nCheckBox.setVis
+0008d480: 6962 6c65 2846 616c 7365 290d 0a20 2020  ible(False)..   
+0008d490: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0008d4a0: 662e 5371 7561 7265 5078 4368 6563 6b42  f.SquarePxCheckB
+0008d4b0: 6f78 2e73 6574 5669 7369 626c 6528 5472  ox.setVisible(Tr
+0008d4c0: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
+0008d4d0: 2020 2020 2069 6620 7371 7561 7265 203d       if square =
+0008d4e0: 3d20 5472 7565 3a0d 0a20 2020 2020 2020  = True:..       
+0008d4f0: 2020 2020 2020 2020 2020 2020 2061 7370               asp
+0008d500: 6563 7420 3d20 310d 0a20 2020 2020 2020  ect = 1..       
+0008d510: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0008d520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008d530: 2020 2020 6173 7065 6374 203d 2073 656c      aspect = sel
+0008d540: 662e 7374 6b2e 785f 7078 7369 7a65 2f73  f.stk.x_pxsize/s
+0008d550: 656c 662e 7374 6b2e 795f 7078 7369 7a65  elf.stk.y_pxsize
+0008d560: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0008d570: 2020 2020 2020 2370 7269 6e74 2861 7370        #print(asp
+0008d580: 6563 7429 0d0a 2020 2020 2020 2020 2020  ect)..          
+0008d590: 2020 2020 2020 7365 6c66 2e70 312e 7365        self.p1.se
+0008d5a0: 7441 7370 6563 744c 6f63 6b65 6428 6c6f  tAspectLocked(lo
+0008d5b0: 636b 3d54 7275 652c 2072 6174 696f 3d61  ck=True, ratio=a
+0008d5c0: 7370 6563 7429 0d0a 2020 2020 2020 2020  spect)..        
+0008d5d0: 2020 2020 2020 2020 7365 6c66 2e61 7931          self.ay1
+0008d5e0: 2e73 6574 4c61 6265 6c28 7465 7874 3d22  .setLabel(text="
+0008d5f0: 7922 2c20 756e 6974 733d 2270 7822 290d  y", units="px").
+0008d600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008d610: 2073 656c 662e 6178 312e 7365 744c 6162   self.ax1.setLab
+0008d620: 656c 2874 6578 743d 2278 222c 2075 6e69  el(text="x", uni
+0008d630: 7473 3d22 7078 2229 0d0a 2020 2020 2020  ts="px")..      
+0008d640: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+0008d650: 5f69 7465 6d2e 7365 7452 6563 7428 5174  _item.setRect(Qt
+0008d660: 436f 7265 2e51 5265 6374 4628 302c 2030  Core.QRectF(0, 0
+0008d670: 2c20 7365 6c66 2e73 746b 2e6e 5f63 6f6c  , self.stk.n_col
+0008d680: 732c 2073 656c 662e 7374 6b2e 6e5f 726f  s, self.stk.n_ro
+0008d690: 7773 2929 0d0a 2020 2020 2020 2020 2020  ws))..          
+0008d6a0: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
+0008d6b0: 2873 656c 662c 2022 4f44 2229 3a0d 0a20  (self, "OD"):.. 
+0008d6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008d6d0: 2020 2073 656c 662e 6179 322e 7365 744c     self.ay2.setL
+0008d6e0: 6162 656c 2874 6578 743d 2279 222c 2075  abel(text="y", u
+0008d6f0: 6e69 7473 3d22 7078 2229 0d0a 2020 2020  nits="px")..    
+0008d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008d710: 7365 6c66 2e61 7832 2e73 6574 4c61 6265  self.ax2.setLabe
+0008d720: 6c28 7465 7874 3d22 7822 2c20 756e 6974  l(text="x", unit
+0008d730: 733d 2270 7822 290d 0a20 2020 2020 2020  s="px")..       
+0008d740: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0008d750: 662e 7032 2e73 6574 4173 7065 6374 4c6f  f.p2.setAspectLo
+0008d760: 636b 6564 286c 6f63 6b3d 5472 7565 2c20  cked(lock=True, 
+0008d770: 7261 7469 6f3d 6173 7065 6374 290d 0a20  ratio=aspect).. 
+0008d780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008d790: 2020 2073 656c 662e 6d5f 6974 656d 2e73     self.m_item.s
+0008d7a0: 6574 5265 6374 2851 7443 6f72 652e 5152  etRect(QtCore.QR
+0008d7b0: 6563 7446 2830 2c20 302c 206e 702e 7368  ectF(0, 0, np.sh
+0008d7c0: 6170 6528 7365 6c66 2e4f 4429 5b30 5d2c  ape(self.OD)[0],
+0008d7d0: 206e 702e 7368 6170 6528 7365 6c66 2e4f   np.shape(self.O
+0008d7e0: 4429 5b31 5d29 290d 0a20 2020 2064 6566  D)[1]))..    def
+0008d7f0: 204f 6e43 6c72 5365 6c65 6374 696f 6e28   OnClrSelection(
+0008d800: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+0008d810: 666f 7220 726f 7720 696e 2073 656c 662e  for row in self.
+0008d820: 7072 656c 7374 202b 2073 656c 662e 706f  prelst + self.po
+0008d830: 7374 6c73 743a 0d0a 2020 2020 2020 2020  stlst:..        
+0008d840: 2020 2020 7365 6c66 2e4d 6170 5365 6c65      self.MapSele
+0008d850: 6374 5769 6467 6574 312e 6974 656d 2872  ctWidget1.item(r
+0008d860: 6f77 292e 7365 7442 6163 6b67 726f 756e  ow).setBackgroun
+0008d870: 6428 5174 4775 692e 5143 6f6c 6f72 2830  d(QtGui.QColor(0
+0008d880: 2c20 302c 2030 2c20 3029 290d 0a20 2020  , 0, 0, 0))..   
+0008d890: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
+0008d8a0: 6b2e 7368 6966 7473 5b72 6f77 5d5b 315d  k.shifts[row][1]
+0008d8b0: 203d 2030 0d0a 2020 2020 2020 2020 2020   = 0..          
+0008d8c0: 2020 7365 6c66 2e4f 6e53 656c 6563 7469    self.OnSelecti
+0008d8d0: 6f6e 4368 616e 6765 6428 290d 0a0d 0a20  onChanged().... 
+0008d8e0: 2020 2064 6566 204f 6e53 656c 6672 6f6d     def OnSelfrom
+0008d8f0: 5370 6563 2873 656c 662c 6576 7429 3a0d  Spec(self,evt):.
+0008d900: 0a20 2020 2020 2020 2073 7065 6374 7261  .        spectra
+0008d910: 6c69 6d67 6d61 7020 3d20 5370 6563 7472  limgmap = Spectr
+0008d920: 616c 496d 6167 654d 6170 2873 656c 662c  alImageMap(self,
+0008d930: 2073 656c 662e 636f 6d2c 2073 656c 662e   self.com, self.
+0008d940: 7374 6b29 0d0a 2020 2020 2020 2020 7370  stk)..        sp
+0008d950: 6563 7472 616c 696d 676d 6170 2e73 686f  ectralimgmap.sho
+0008d960: 7728 290d 0a0d 0a20 2020 2064 6566 204f  w()....    def O
+0008d970: 6e43 6c72 5368 6966 7473 2873 656c 6629  nClrShifts(self)
+0008d980: 3a0d 0a20 2020 2020 2020 2066 6f72 2072  :..        for r
+0008d990: 6f77 2069 6e20 5b69 6e64 6578 2066 6f72  ow in [index for
+0008d9a0: 2069 6e64 6578 2c20 7661 6c75 6520 696e   index, value in
+0008d9b0: 2065 6e75 6d65 7261 7465 285b 785b 325d   enumerate([x[2]
+0008d9c0: 2066 6f72 2078 2069 6e20 2073 656c 662e   for x in  self.
+0008d9d0: 7374 6b2e 7368 6966 7473 5d29 2069 6620  stk.shifts]) if 
+0008d9e0: 7661 6c75 6520 213d 2028 302e 302c 302e  value != (0.0,0.
+0008d9f0: 3029 5d3a 0d0a 2020 2020 2020 2020 2020  0)]:..          
+0008da00: 2020 7365 6c66 2e73 746b 2e73 6869 6674    self.stk.shift
+0008da10: 735b 726f 775d 2e70 6f70 2832 2920 2023  s[row].pop(2)  #
+0008da20: 2072 656d 6f76 6520 7475 706c 650d 0a20   remove tuple.. 
+0008da30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0008da40: 7374 6b2e 7368 6966 7473 5b72 6f77 5d2e  stk.shifts[row].
+0008da50: 696e 7365 7274 2832 2c20 2830 2e30 2c20  insert(2, (0.0, 
+0008da60: 302e 3029 290d 0a20 2020 2020 2020 2020  0.0))..         
+0008da70: 2020 2073 656c 662e 7374 6b2e 6162 7364     self.stk.absd
+0008da80: 6174 615f 7368 6966 7465 645b 3a2c 203a  ata_shifted[:, :
+0008da90: 2c20 726f 775d 203d 2073 656c 662e 7374  , row] = self.st
+0008daa0: 6b2e 6162 7364 6174 615b 3a2c 203a 2c20  k.absdata[:, :, 
+0008dab0: 726f 775d 0d0a 2020 2020 2020 2020 2020  row]..          
+0008dac0: 2020 7365 6c66 2e4d 6170 5365 6c65 6374    self.MapSelect
+0008dad0: 5769 6467 6574 312e 6974 656d 2872 6f77  Widget1.item(row
+0008dae0: 292e 7365 7454 6578 7428 0d0a 2020 2020  ).setText(..    
+0008daf0: 2020 2020 2020 2020 2020 2020 7374 7228              str(
+0008db00: 696e 7428 726f 7729 292e 7a66 696c 6c28  int(row)).zfill(
+0008db10: 3329 202b 2022 2020 2020 2061 7420 2020  3) + "     at   
+0008db20: 2020 2220 2b20 666f 726d 6174 2873 656c    " + format(sel
+0008db30: 662e 7374 6b2e 6576 5b72 6f77 5d2c 2027  f.stk.ev[row], '
+0008db40: 2e32 6627 2920 2b20 2220 6556 2020 2020  .2f') + " eV    
+0008db50: 2022 202b 2066 6f72 6d61 7428 0d0a 2020   " + format(..  
+0008db60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008db70: 2020 7365 6c66 2e73 746b 2e73 6869 6674    self.stk.shift
+0008db80: 735b 726f 775d 5b32 5d5b 305d 2c20 272b  s[row][2][0], '+
+0008db90: 2e31 6627 2920 2b20 2220 2020 2022 202b  .1f') + "    " +
+0008dba0: 2066 6f72 6d61 7428 7365 6c66 2e73 746b   format(self.stk
+0008dbb0: 2e73 6869 6674 735b 726f 775d 5b32 5d5b  .shifts[row][2][
+0008dbc0: 315d 2c20 272b 2e31 6627 2929 0d0a 2020  1], '+.1f'))..  
+0008dbd0: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
+0008dbe0: 2873 656c 662c 2027 7072 656c 7374 2729  (self, 'prelst')
+0008dbf0: 2061 6e64 2068 6173 6174 7472 2873 656c   and hasattr(sel
+0008dc00: 662c 2027 706f 7374 6c73 7427 293a 0d0a  f, 'postlst'):..
+0008dc10: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0008dc20: 656e 2873 656c 662e 7072 656c 7374 2920  en(self.prelst) 
+0008dc30: 213d 2030 2061 6e64 206c 656e 2873 656c  != 0 and len(sel
+0008dc40: 662e 706f 7374 6c73 7429 2021 3d20 303a  f.postlst) != 0:
+0008dc50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0008dc60: 2020 7365 6c66 2e53 686f 774d 6170 2873    self.ShowMap(s
+0008dc70: 656c 662e 7072 656c 7374 2c73 656c 662e  elf.prelst,self.
+0008dc80: 706f 7374 6c73 7429 0d0a 2020 2020 2020  postlst)..      
+0008dc90: 2020 6966 2073 656c 662e 7374 6b2e 7368    if self.stk.sh
+0008dca0: 6966 7473 3a0d 0a20 2020 2020 2020 2020  ifts:..         
+0008dcb0: 2020 2073 656c 662e 5570 6461 7465 456e     self.UpdateEn
+0008dcc0: 7472 7928 7365 6c66 2e4d 6170 5365 6c65  try(self.MapSele
+0008dcd0: 6374 5769 6467 6574 312e 6375 7272 656e  ctWidget1.curren
+0008dce0: 7452 6f77 2829 290d 0a0d 0a20 2020 2064  tRow())....    d
+0008dcf0: 6566 2073 6574 5368 6966 7473 2873 656c  ef setShifts(sel
+0008dd00: 662c 7368 6966 745f 782c 2073 6869 6674  f,shift_x, shift
+0008dd10: 5f79 293a 0d0a 2020 2020 2020 2020 2370  _y):..        #p
+0008dd20: 7269 6e74 2822 7365 7473 6869 6674 7320  rint("setshifts 
+0008dd30: 6361 6c6c 6564 2229 0d0a 2020 2020 2020  called")..      
+0008dd40: 2020 2320 6966 2068 6173 6174 7472 2873    # if hasattr(s
+0008dd50: 656c 662c 2022 4f44 2229 3a0d 0a20 2020  elf, "OD"):..   
+0008dd60: 2020 2020 2069 6620 7365 6c66 2e73 746b       if self.stk
+0008dd70: 2e73 6869 6674 733a 0d0a 2020 2020 2020  .shifts:..      
+0008dd80: 2020 2020 2020 726f 7720 3d20 7365 6c66        row = self
+0008dd90: 2e4d 6170 5365 6c65 6374 5769 6467 6574  .MapSelectWidget
+0008dda0: 312e 6375 7272 656e 7452 6f77 2829 0d0a  1.currentRow()..
+0008ddb0: 2020 2020 2020 2020 2020 2020 786f 6666              xoff
+0008ddc0: 7365 742c 2079 6f66 6673 6574 203d 2073  set, yoffset = s
+0008ddd0: 656c 662e 7374 6b2e 7368 6966 7473 5b72  elf.stk.shifts[r
+0008dde0: 6f77 5d5b 325d 2023 2063 7572 7265 6e74  ow][2] # current
+0008ddf0: 206f 6666 7365 7420 7374 6f72 6564 2061   offset stored a
+0008de00: 7320 7475 706c 6520 696e 2074 6162 6c65  s tuple in table
+0008de10: 2073 746b 2e73 6869 6674 730d 0a20 2020   stk.shifts..   
+0008de20: 2020 2020 2020 2020 2023 7072 696e 7428           #print(
+0008de30: 7365 6c66 2e73 746b 2e73 6869 6674 735b  self.stk.shifts[
+0008de40: 7365 6c66 2e4d 6170 5365 6c65 6374 5769  self.MapSelectWi
+0008de50: 6467 6574 312e 6375 7272 656e 7452 6f77  dget1.currentRow
+0008de60: 2829 5d29 0d0a 2020 2020 2020 2020 2020  ()])..          
+0008de70: 2020 2379 6f66 6673 6574 203d 2073 656c    #yoffset = sel
+0008de80: 662e 7374 6b2e 7368 6966 7473 5b73 656c  f.stk.shifts[sel
+0008de90: 662e 4d61 7053 656c 6563 7457 6964 6765  f.MapSelectWidge
+0008dea0: 7431 2e63 7572 7265 6e74 526f 7728 295d  t1.currentRow()]
+0008deb0: 5b32 5d5b 315d 0d0a 2020 2020 2020 2020  [2][1]..        
+0008dec0: 2020 2020 6966 2073 6869 6674 5f78 203d      if shift_x =
+0008ded0: 3d20 3020 616e 6420 7368 6966 745f 7920  = 0 and shift_y 
+0008dee0: 3d3d 2030 3a20 2320 6966 2072 6573 6574  == 0: # if reset
+0008def0: 2062 7574 746f 6e20 7072 6573 7365 640d   button pressed.
+0008df00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008df10: 2069 6620 786f 6666 7365 7420 213d 2030   if xoffset != 0
+0008df20: 206f 7220 796f 6666 7365 7420 213d 2030   or yoffset != 0
+0008df30: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0008df40: 2020 2020 2020 2073 656c 662e 7374 6b2e         self.stk.
+0008df50: 7368 6966 7473 5b72 6f77 5d2e 706f 7028  shifts[row].pop(
+0008df60: 3229 2023 2072 656d 6f76 6520 7475 706c  2) # remove tupl
+0008df70: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0008df80: 2020 2020 2020 2073 656c 662e 7374 6b2e         self.stk.
+0008df90: 7368 6966 7473 5b72 6f77 5d2e 696e 7365  shifts[row].inse
+0008dfa0: 7274 2832 2c28 302e 302c 302e 3029 290d  rt(2,(0.0,0.0)).
+0008dfb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0008dfc0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0008dfd0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0008dfe0: 7428 2252 6573 6574 2068 6173 206e 6f20  t("Reset has no 
+0008dff0: 6566 6665 6374 2229 0d0a 2020 2020 2020  effect")..      
+0008e000: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0008e010: 7475 726e 0d0a 2020 2020 2020 2020 2020  turn..          
+0008e020: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0008e030: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
+0008e040: 6b2e 7368 6966 7473 5b72 6f77 5d2e 706f  k.shifts[row].po
+0008e050: 7028 3229 0d0a 2020 2020 2020 2020 2020  p(2)..          
+0008e060: 2020 2020 2020 786f 6666 7365 7420 3d20        xoffset = 
+0008e070: 726f 756e 6428 786f 6666 7365 7420 2b20  round(xoffset + 
+0008e080: 7368 6966 745f 782c 3129 0d0a 2020 2020  shift_x,1)..    
+0008e090: 2020 2020 2020 2020 2020 2020 796f 6666              yoff
+0008e0a0: 7365 7420 3d20 726f 756e 6428 796f 6666  set = round(yoff
+0008e0b0: 7365 7420 2b20 7368 6966 745f 792c 3129  set + shift_y,1)
+0008e0c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0008e0d0: 2020 7365 6c66 2e73 746b 2e73 6869 6674    self.stk.shift
+0008e0e0: 735b 726f 775d 2e69 6e73 6572 7428 322c  s[row].insert(2,
+0008e0f0: 2878 6f66 6673 6574 2c20 796f 6666 7365  (xoffset, yoffse
+0008e100: 7429 290d 0a20 2020 2020 2020 2020 2020  t))..           
+0008e110: 2023 6375 7272 656e 745f 696d 6720 3d20   #current_img = 
+0008e120: 7365 6c66 2e73 746b 2e61 6273 6461 7461  self.stk.absdata
+0008e130: 5b3a 2c20 3a2c 2073 656c 662e 4d61 7053  [:, :, self.MapS
+0008e140: 656c 6563 7457 6964 6765 7431 2e63 7572  electWidget1.cur
+0008e150: 7265 6e74 526f 7728 295d 0d0a 2020 2020  rentRow()]..    
+0008e160: 2020 2020 2020 2020 2370 7269 6e74 2874          #print(t
+0008e170: 7970 6528 7365 6c66 2e73 746b 2e61 6273  ype(self.stk.abs
+0008e180: 6461 7461 292c 2073 656c 662e 7374 6b2e  data), self.stk.
+0008e190: 7368 6966 7473 5b73 656c 662e 4d61 7053  shifts[self.MapS
+0008e1a0: 656c 6563 7457 6964 6765 7431 2e63 7572  electWidget1.cur
+0008e1b0: 7265 6e74 526f 7728 295d 290d 0a20 2020  rentRow()])..   
+0008e1c0: 2020 2020 2020 2020 2023 7365 6c66 2e53           #self.S
+0008e1d0: 6869 6674 2872 6f77 290d 0a20 2020 2020  hift(row)..     
+0008e1e0: 2020 2020 2020 2073 656c 662e 5570 6461         self.Upda
+0008e1f0: 7465 456e 7472 7928 726f 7729 0d0a 2020  teEntry(row)..  
+0008e200: 2020 2020 2020 2020 2020 6966 2068 6173            if has
+0008e210: 6174 7472 2873 656c 662c 2027 7072 656c  attr(self, 'prel
+0008e220: 7374 2729 2061 6e64 2068 6173 6174 7472  st') and hasattr
+0008e230: 2873 656c 662c 2027 706f 7374 6c73 7427  (self, 'postlst'
+0008e240: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0008e250: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
+0008e260: 7072 656c 7374 2920 213d 2030 2061 6e64  prelst) != 0 and
+0008e270: 206c 656e 2873 656c 662e 706f 7374 6c73   len(self.postls
+0008e280: 7429 2021 3d20 303a 0d0a 2020 2020 2020  t) != 0:..      
+0008e290: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0008e2a0: 6c66 2e53 686f 774d 6170 2873 656c 662e  lf.ShowMap(self.
+0008e2b0: 7072 656c 7374 2c73 656c 662e 706f 7374  prelst,self.post
+0008e2c0: 6c73 7429 0d0a 2020 2020 6465 6620 5368  lst)..    def Sh
+0008e2d0: 6966 7428 7365 6c66 2c72 6f77 293a 0d0a  ift(self,row):..
+0008e2e0: 2020 2020 2020 2020 2363 7572 7265 6e74          #current
+0008e2f0: 5f69 6d67 203d 2073 656c 662e 7374 6b2e  _img = self.stk.
+0008e300: 6162 7364 6174 615f 7368 6966 7465 645b  absdata_shifted[
+0008e310: 3a2c 203a 2c20 726f 775d 0d0a 2020 2020  :, :, row]..    
+0008e320: 2020 2020 6f72 6967 696e 616c 5f69 6d67      original_img
+0008e330: 203d 2073 656c 662e 7374 6b2e 6162 7364   = self.stk.absd
+0008e340: 6174 615b 3a2c 203a 2c20 726f 775d 0d0a  ata[:, :, row]..
+0008e350: 2020 2020 2020 2020 786f 6666 7365 742c          xoffset,
+0008e360: 2079 6f66 6673 6574 203d 2073 656c 662e   yoffset = self.
+0008e370: 7374 6b2e 7368 6966 7473 5b72 6f77 5d5b  stk.shifts[row][
+0008e380: 325d 2023 2078 2061 6e64 2079 206f 6666  2] # x and y off
+0008e390: 7365 7473 206f 6620 6375 7272 656e 7420  sets of current 
+0008e3a0: 696d 6167 650d 0a20 2020 2020 2020 2069  image..        i
+0008e3b0: 6620 786f 6666 7365 7420 3d3d 2030 2061  f xoffset == 0 a
+0008e3c0: 6e64 2079 6f66 6673 6574 203d 3d20 303a  nd yoffset == 0:
+0008e3d0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0008e3e0: 6c66 2e73 746b 2e61 6273 6461 7461 5f73  lf.stk.absdata_s
+0008e3f0: 6869 6674 6564 5b3a 2c20 3a2c 2072 6f77  hifted[:, :, row
+0008e400: 5d20 3d20 6f72 6967 696e 616c 5f69 6d67  ] = original_img
+0008e410: 2023 2072 6570 6c61 6365 2077 6974 6820   # replace with 
+0008e420: 6f72 6967 696e 616c 2069 6620 6e6f 2073  original if no s
+0008e430: 6869 6674 2069 7320 6170 706c 6965 640d  hift is applied.
+0008e440: 0a20 2020 2020 2020 2020 2020 2023 7365  .            #se
+0008e450: 6c66 2e53 6869 6674 4c61 6265 6c2e 7365  lf.ShiftLabel.se
+0008e460: 7454 6578 7428 2278 203d 2025 302e 3166  tText("x = %0.1f
+0008e470: 205c 6e79 203d 2025 302e 3166 2220 2520   \ny = %0.1f" % 
+0008e480: 2873 656c 662e 786f 6666 7365 742c 2073  (self.xoffset, s
+0008e490: 656c 662e 796f 6666 7365 7429 290d 0a20  elf.yoffset)).. 
+0008e4a0: 2020 2020 2020 2020 2020 2023 7265 7475             #retu
+0008e4b0: 726e 206f 7269 6769 6e61 6c5f 696d 670d  rn original_img.
+0008e4c0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+0008e4d0: 2020 2020 2020 2020 2020 2020 7368 6966              shif
+0008e4e0: 7465 6420 3d20 6e64 696d 6167 652e 666f  ted = ndimage.fo
+0008e4f0: 7572 6965 725f 7368 6966 7428 6e70 2e66  urier_shift(np.f
+0008e500: 6674 2e66 6674 3228 6f72 6967 696e 616c  ft.fft2(original
+0008e510: 5f69 6d67 292c 205b 666c 6f61 7428 786f  _img), [float(xo
+0008e520: 6666 7365 7429 2c20 666c 6f61 7428 796f  ffset), float(yo
+0008e530: 6666 7365 7429 5d29 0d0a 2020 2020 2020  ffset)])..      
+0008e540: 2020 2020 2020 7368 6966 7465 6420 3d20        shifted = 
+0008e550: 6e70 2e66 6674 2e69 6666 7432 2873 6869  np.fft.ifft2(shi
+0008e560: 6674 6564 290d 0a20 2020 2020 2020 2020  fted)..         
+0008e570: 2020 2073 6869 6674 6564 5f72 6561 6c20     shifted_real 
+0008e580: 3d20 7368 6966 7465 642e 7265 616c 0d0a  = shifted.real..
+0008e590: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0008e5a0: 2e73 746b 2e61 6273 6461 7461 5f73 6869  .stk.absdata_shi
+0008e5b0: 6674 6564 5b3a 2c20 3a2c 2072 6f77 5d20  fted[:, :, row] 
+0008e5c0: 3d20 7368 6966 7465 645f 7265 616c 0d0a  = shifted_real..
+0008e5d0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0008e5e0: 656c 662e 7374 6b2e 6162 7364 6174 615f  elf.stk.absdata_
+0008e5f0: 7368 6966 7465 645b 3a2c 3a2c 2072 6f77  shifted[:,:, row
+0008e600: 5d0d 0a0d 0a20 2020 2020 2020 2020 2020  ]....           
+0008e610: 2023 7365 6c66 2e53 6869 6674 4c61 6265   #self.ShiftLabe
+0008e620: 6c2e 7365 7454 6578 7428 2278 203d 2025  l.setText("x = %
+0008e630: 302e 3166 205c 6e79 203d 2025 302e 3166  0.1f \ny = %0.1f
+0008e640: 2220 2520 2878 6f66 6673 6574 2c20 796f  " % (xoffset, yo
+0008e650: 6666 7365 7429 290d 0a20 2020 2064 6566  ffset))..    def
+0008e660: 2043 616c 634f 444d 6170 2873 656c 662c   CalcODMap(self,
+0008e670: 696d 5f69 6478 312c 696d 5f69 6478 3229  im_idx1,im_idx2)
+0008e680: 3a0d 0a20 2020 2020 2020 2069 6620 6c65  :..        if le
+0008e690: 6e28 696d 5f69 6478 3129 203d 3d20 3120  n(im_idx1) == 1 
+0008e6a0: 616e 6420 6c65 6e28 696d 5f69 6478 3229  and len(im_idx2)
+0008e6b0: 203d 3d20 313a 0d0a 2020 2020 2020 2020   == 1:..        
+0008e6c0: 2020 2020 696d 3120 3d20 7365 6c66 2e73      im1 = self.s
+0008e6d0: 746b 2e61 6273 6461 7461 5f73 6869 6674  tk.absdata_shift
+0008e6e0: 6564 5b3a 2c20 3a2c 2069 6e74 2869 6d5f  ed[:, :, int(im_
+0008e6f0: 6964 7831 5b30 5d29 5d0d 0a20 2020 2020  idx1[0])]..     
+0008e700: 2020 2020 2020 2069 6d32 203d 2073 656c         im2 = sel
+0008e710: 662e 7374 6b2e 6162 7364 6174 615f 7368  f.stk.absdata_sh
+0008e720: 6966 7465 645b 3a2c 203a 2c20 696e 7428  ifted[:, :, int(
+0008e730: 696d 5f69 6478 325b 305d 295d 0d0a 2020  im_idx2[0])]..  
+0008e740: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0008e750: 2020 2020 2020 2020 2069 6d31 203d 206e           im1 = n
+0008e760: 702e 6d65 616e 285b 7365 6c66 2e73 746b  p.mean([self.stk
+0008e770: 2e61 6273 6461 7461 5f73 6869 6674 6564  .absdata_shifted
+0008e780: 5b3a 2c20 3a2c 2069 5d20 666f 7220 6920  [:, :, i] for i 
+0008e790: 696e 2069 6d5f 6964 7831 5d2c 2061 7869  in im_idx1], axi
+0008e7a0: 733d 3029 0d0a 2020 2020 2020 2020 2020  s=0)..          
+0008e7b0: 2020 696d 3220 3d20 6e70 2e6d 6561 6e28    im2 = np.mean(
+0008e7c0: 5b73 656c 662e 7374 6b2e 6162 7364 6174  [self.stk.absdat
+0008e7d0: 615f 7368 6966 7465 645b 3a2c 203a 2c20  a_shifted[:, :, 
+0008e7e0: 695d 2066 6f72 2069 2069 6e20 696d 5f69  i] for i in im_i
+0008e7f0: 6478 325d 2c20 6178 6973 3d30 290d 0a20  dx2], axis=0).. 
+0008e800: 2020 2020 2020 204f 4420 3d20 6e70 2e6c         OD = np.l
+0008e810: 6f67 2869 6d31 2f69 6d32 290d 0a20 2020  og(im1/im2)..   
+0008e820: 2020 2020 2069 6620 7365 6c66 2e63 726f       if self.cro
+0008e830: 7066 6c61 673a 0d0a 2020 2020 2020 2020  pflag:..        
+0008e840: 2020 2020 7368 6966 746c 7374 203d 205b      shiftlst = [
+0008e850: 7365 6c66 2e73 746b 2e73 6869 6674 735b  self.stk.shifts[
+0008e860: 695d 5b32 5d20 666f 7220 6920 696e 2069  i][2] for i in i
+0008e870: 6d5f 6964 7831 202b 2069 6d5f 6964 7832  m_idx1 + im_idx2
+0008e880: 5d0d 0a20 2020 2020 2020 2020 2020 2023  ]..            #
+0008e890: 7072 696e 7428 7368 6966 746c 7374 290d  print(shiftlst).
+0008e8a0: 0a20 2020 2020 2020 2020 2020 2023 2070  .            # p
+0008e8b0: 7269 6e74 286d 6178 2873 6869 6674 6c73  rint(max(shiftls
+0008e8c0: 742c 206b 6579 3d69 7465 6d67 6574 7465  t, key=itemgette
+0008e8d0: 7228 3029 295b 305d 2920 2320 706f 7373  r(0))[0]) # poss
+0008e8e0: 6962 6c65 2061 6c74 6572 6e61 7469 7665  ible alternative
+0008e8f0: 2074 6f20 6c61 6d62 6461 2066 756e 6374   to lambda funct
+0008e900: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
+0008e910: 2023 4361 6c63 756c 6174 6520 6372 6f70   #Calculate crop
+0008e920: 730d 0a20 2020 2020 2020 2020 2020 206c  s..            l
+0008e930: 203d 2069 6e74 286e 702e 666c 6f6f 7228   = int(np.floor(
+0008e940: 6d69 6e28 7368 6966 746c 7374 2c20 6b65  min(shiftlst, ke
+0008e950: 793d 6c61 6d62 6461 2069 7465 6d3a 2069  y=lambda item: i
+0008e960: 7465 6d5b 305d 295b 305d 2929 0d0a 2020  tem[0])[0]))..  
+0008e970: 2020 2020 2020 2020 2020 636c 203d 206c            cl = l
+0008e980: 2069 6620 6c20 3c20 3020 656c 7365 204e   if l < 0 else N
+0008e990: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+0008e9a0: 2072 203d 2069 6e74 286e 702e 6365 696c   r = int(np.ceil
+0008e9b0: 286d 6178 2873 6869 6674 6c73 742c 206b  (max(shiftlst, k
+0008e9c0: 6579 3d6c 616d 6264 6120 6974 656d 3a20  ey=lambda item: 
+0008e9d0: 6974 656d 5b30 5d29 5b30 5d29 290d 0a20  item[0])[0])).. 
+0008e9e0: 2020 2020 2020 2020 2020 2074 203d 2069             t = i
+0008e9f0: 6e74 286e 702e 6365 696c 286d 6178 2873  nt(np.ceil(max(s
+0008ea00: 6869 6674 6c73 742c 206b 6579 3d6c 616d  hiftlst, key=lam
+0008ea10: 6264 6120 6974 656d 3a20 6974 656d 5b31  bda item: item[1
+0008ea20: 5d29 5b31 5d29 290d 0a20 2020 2020 2020  ])[1]))..       
+0008ea30: 2020 2020 2062 203d 2069 6e74 286e 702e       b = int(np.
+0008ea40: 666c 6f6f 7228 6d69 6e28 7368 6966 746c  floor(min(shiftl
+0008ea50: 7374 2c20 6b65 793d 6c61 6d62 6461 2069  st, key=lambda i
+0008ea60: 7465 6d3a 2069 7465 6d5b 315d 295b 315d  tem: item[1])[1]
+0008ea70: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+0008ea80: 6362 203d 2062 2069 6620 6220 3c20 3020  cb = b if b < 0 
+0008ea90: 656c 7365 204e 6f6e 650d 0a20 2020 2020  else None..     
+0008eaa0: 2020 2020 2020 2023 2043 726f 7020 6d61         # Crop ma
+0008eab0: 700d 0a20 2020 2020 2020 2020 2020 204f  p..            O
+0008eac0: 4420 3d20 4f44 5b72 3a63 6c2c 743a 6362  D = OD[r:cl,t:cb
+0008ead0: 5d0d 0a20 2020 2020 2020 2020 2020 2023  ]..            #
+0008eae0: 7072 696e 7428 722c 636c 2c74 2c63 6229  print(r,cl,t,cb)
+0008eaf0: 0d0a 2020 2020 2020 2020 696e 665f 6964  ..        inf_id
+0008eb00: 7820 3d20 6e70 2e77 6865 7265 286e 702e  x = np.where(np.
+0008eb10: 6973 696e 6628 4f44 2929 0d0a 2020 2020  isinf(OD))..    
+0008eb20: 2020 2020 6e61 6e5f 6964 7820 3d20 6e70      nan_idx = np
+0008eb30: 2e77 6865 7265 286e 702e 6973 6e61 6e28  .where(np.isnan(
+0008eb40: 4f44 2929 0d0a 2020 2020 2020 2020 6966  OD))..        if
+0008eb50: 206e 702e 616e 7928 696e 665f 6964 7829   np.any(inf_idx)
+0008eb60: 206f 7220 6e70 2e61 6e79 286e 616e 5f69   or np.any(nan_i
+0008eb70: 6478 293a 0d0a 2020 2020 2020 2020 2020  dx):..          
+0008eb80: 2020 2369 6620 6e6f 7420 7365 6c66 2e49    #if not self.I
+0008eb90: 6e66 5761 726e 696e 673a 0d0a 2020 2020  nfWarning:..    
+0008eba0: 2020 2020 2020 2020 2320 2020 2073 656c          #    sel
+0008ebb0: 662e 496e 6657 6172 6e69 6e67 203d 2054  f.InfWarning = T
+0008ebc0: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
+0008ebd0: 2023 2020 2020 5174 4775 692e 514d 6573   #    QtGui.QMes
+0008ebe0: 7361 6765 426f 782e 7761 726e 696e 6728  sageBox.warning(
+0008ebf0: 7365 6c66 2c20 2757 6172 6e69 6e67 2127  self, 'Warning!'
+0008ec00: 2c20 2254 6865 204f 4420 6d61 7020 636f  , "The OD map co
+0008ec10: 6e74 6169 6e65 6420 696e 6669 6e69 7465  ntained infinite
+0008ec20: 206f 7220 6e61 6e20 7661 6c75 6573 2e20   or nan values. 
+0008ec30: 506c 6561 7365 206e 6f74 6520 7468 6174  Please note that
+0008ec40: 2074 6865 7920 6861 7665 2062 6565 6e20   they have been 
+0008ec50: 7a65 726f 6564 2e22 290d 0a20 2020 2020  zeroed.")..     
+0008ec60: 2020 2020 2020 204f 445b 696e 665f 6964         OD[inf_id
+0008ec70: 785d 203d 2030 2023 696e 6669 6e69 7465  x] = 0 #infinite
+0008ec80: 2076 616c 7565 7320 6765 7420 7265 706c   values get repl
+0008ec90: 6163 6564 2062 7920 7a65 726f 2e20 5468  aced by zero. Th
+0008eca0: 6973 2069 7320 616e 2075 676c 7920 776f  is is an ugly wo
+0008ecb0: 726b 2061 726f 756e 642c 2062 7574 2077  rk around, but w
+0008ecc0: 6974 6820 6e61 6e73 2074 6865 2069 6d61  ith nans the ima
+0008ecd0: 6765 2069 7320 6e6f 7420 6469 7370 6c61  ge is not displa
+0008ece0: 7965 6420 636f 7272 6563 746c 792e 0d0a  yed correctly...
+0008ecf0: 2020 2020 2020 2020 2020 2020 4f44 5b6e              OD[n
+0008ed00: 616e 5f69 6478 5d20 3d20 300d 0a20 2020  an_idx] = 0..   
+0008ed10: 2020 2020 2072 6574 7572 6e20 4f44 0d0a       return OD..
+0008ed20: 0d0a 2020 2020 6465 6620 6361 6c63 4269  ..    def calcBi
+0008ed30: 6e53 697a 6528 7365 6c66 2c69 2c4e 293a  nSize(self,i,N):
+0008ed40: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0008ed50: 2069 6e74 2872 6f75 6e64 2832 3536 2a28   int(round(256*(
+0008ed60: 692b 3129 2f4e 2920 2d20 726f 756e 6428  i+1)/N) - round(
+0008ed70: 3235 362a 692f 4e29 290d 0a0d 0a20 2020  256*i/N))....   
+0008ed80: 2064 6566 204f 6e43 6f6c 6f72 6d61 7028   def OnColormap(
+0008ed90: 7365 6c66 2c6d 6170 3d22 6166 6d68 6f74  self,map="afmhot
+0008eda0: 222c 2063 6f6c 6f72 733d 3235 3629 3a0d  ", colors=256):.
+0008edb0: 0a20 2020 2020 2020 2069 6620 6861 7361  .        if hasa
+0008edc0: 7474 7228 7365 6c66 2c20 224f 4422 293a  ttr(self, "OD"):
+0008edd0: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+0008ede0: 6c6f 726d 6170 203d 2063 6d2e 6765 745f  lormap = cm.get_
+0008edf0: 636d 6170 286d 6170 2c20 636f 6c6f 7273  cmap(map, colors
+0008ee00: 290d 0a20 2020 2020 2020 2020 2020 2063  )..            c
+0008ee10: 6f6c 6f72 6d61 7020 3d20 636f 6c6f 726d  olormap = colorm
+0008ee20: 6170 286e 702e 6172 616e 6765 2863 6f6c  ap(np.arange(col
+0008ee30: 6f72 7329 290d 0a20 2020 2020 2020 2020  ors))..         
+0008ee40: 2020 2063 6d5f 6c73 7420 3d20 5b5b 636f     cm_lst = [[co
+0008ee50: 6c6f 726d 6170 5b69 6478 5d5b 305d 2c20  lormap[idx][0], 
+0008ee60: 636f 6c6f 726d 6170 5b69 6478 5d5b 315d  colormap[idx][1]
+0008ee70: 2c20 636f 6c6f 726d 6170 5b69 6478 5d5b  , colormap[idx][
+0008ee80: 325d 2c20 636f 6c6f 726d 6170 5b69 6478  2], colormap[idx
+0008ee90: 5d5b 335d 5d20 666f 7220 6964 7820 696e  ][3]] for idx in
+0008eea0: 2072 616e 6765 286e 702e 7368 6170 6528   range(np.shape(
+0008eeb0: 636f 6c6f 726d 6170 295b 305d 295d 2023  colormap)[0])] #
+0008eec0: 636f 6e76 6572 7420 746f 2072 2c67 2c62  convert to r,g,b
+0008eed0: 2c61 206c 6973 740d 0a20 2020 2020 2020  ,a list..       
+0008eee0: 2020 2020 2063 6d5f 6c73 7420 3d20 5b69       cm_lst = [i
+0008eef0: 7465 6d20 666f 7220 7375 6220 696e 205b  tem for sub in [
+0008ef00: 5b63 6d5f 6c73 745b 695d 5d2a 7365 6c66  [cm_lst[i]]*self
+0008ef10: 2e63 616c 6342 696e 5369 7a65 2869 2c63  .calcBinSize(i,c
+0008ef20: 6f6c 6f72 7329 2066 6f72 2069 2069 6e20  olors) for i in 
+0008ef30: 7261 6e67 6528 636f 6c6f 7273 295d 2066  range(colors)] f
+0008ef40: 6f72 2069 7465 6d20 696e 2073 7562 5d20  or item in sub] 
+0008ef50: 2366 696c 6c73 2032 3536 2062 696e 7320  #fills 256 bins 
+0008ef60: 6173 2065 7175 616c 2061 7320 706f 7373  as equal as poss
+0008ef70: 6962 6c65 2077 6974 6820 6e20 636f 6c6f  ible with n colo
+0008ef80: 7273 0d0a 2020 2020 2020 2020 2020 2020  rs..            
+0008ef90: 636d 5f61 7272 6179 203d 206e 702e 6172  cm_array = np.ar
+0008efa0: 7261 7928 5b6e 702e 6173 6172 7261 7928  ray([np.asarray(
+0008efb0: 636d 5f6c 7374 295d 2920 2376 6572 7469  cm_lst)]) #verti
+0008efc0: 6361 6c20 636f 6c6f 7262 6172 0d0a 2020  cal colorbar..  
+0008efd0: 2020 2020 2020 2020 2020 636d 5f6c 7374            cm_lst
+0008efe0: 2e65 7874 656e 6428 2863 6d5f 6c73 745b  .extend((cm_lst[
+0008eff0: 2d31 5d2c 636d 5f6c 7374 5b2d 315d 2c63  -1],cm_lst[-1],c
+0008f000: 6d5f 6c73 745b 2d31 5d29 290d 0a20 2020  m_lst[-1]))..   
+0008f010: 2020 2020 2020 2020 206c 7574 203d 206e           lut = n
+0008f020: 702e 6173 6172 7261 7928 636d 5f6c 7374  p.asarray(cm_lst
+0008f030: 290d 0a20 2020 2020 2020 2020 2020 206c  )..            l
+0008f040: 7574 203d 2028 6c75 7420 2a20 3235 3529  ut = (lut * 255)
+0008f050: 2e76 6965 7728 6e70 2e6e 6461 7272 6179  .view(np.ndarray
+0008f060: 2920 236c 7574 2066 6f72 204f 4420 6d61  ) #lut for OD ma
+0008f070: 700d 0a20 2020 2020 2020 2020 2020 2073  p..            s
+0008f080: 656c 662e 636d 696d 672e 7365 7449 6d61  elf.cmimg.setIma
+0008f090: 6765 2863 6d5f 6172 7261 7929 0d0a 2020  ge(cm_array)..  
+0008f0a0: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+0008f0b0: 5f69 7465 6d2e 7365 744c 6f6f 6b75 7054  _item.setLookupT
+0008f0c0: 6162 6c65 286c 7574 290d 0a20 2020 2020  able(lut)..     
+0008f0d0: 2020 2020 2020 2069 6620 6861 7361 7474         if hasatt
+0008f0e0: 7228 7365 6c66 2c20 224f 4422 293a 0d0a  r(self, "OD"):..
+0008f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008f100: 7365 6c66 2e73 6574 4f44 6261 7228 7365  self.setODbar(se
+0008f110: 6c66 2e4f 446d 696e 2c20 7365 6c66 2e4f  lf.ODmin, self.O
+0008f120: 446d 6178 290d 0a0d 0a20 2020 2064 6566  Dmax)....    def
+0008f130: 2053 686f 774d 6170 2873 656c 662c 2070   ShowMap(self, p
+0008f140: 7265 6964 782c 2070 6f73 7469 6478 293a  reidx, postidx):
+0008f150: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+0008f160: 322e 636c 6561 7228 290d 0a20 2020 2020  2.clear()..     
+0008f170: 2020 2073 656c 662e 7032 2e61 6464 4974     self.p2.addIt
+0008f180: 656d 2873 656c 662e 6d5f 6974 656d 290d  em(self.m_item).
+0008f190: 0a20 2020 2020 2020 2073 656c 662e 636d  .        self.cm
+0008f1a0: 2e63 6c65 6172 2829 0d0a 2020 2020 2020  .clear()..      
+0008f1b0: 2020 7365 6c66 2e63 6d2e 6164 6449 7465    self.cm.addIte
+0008f1c0: 6d28 7365 6c66 2e63 6d69 6d67 290d 0a20  m(self.cmimg).. 
+0008f1d0: 2020 2020 2020 2073 656c 662e 7365 7443         self.setC
+0008f1e0: 726f 7373 6861 6972 2829 0d0a 2020 2020  rosshair()..    
+0008f1f0: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
+0008f200: 2020 2020 2020 2323 204f 7074 696f 6e61        ## Optiona
+0008f210: 6c20 736f 7274 696e 6720 7377 6974 6368  l sorting switch
+0008f220: 6564 206f 6666 2066 6f72 2063 6f6e 7665  ed off for conve
+0008f230: 6e69 656e 6365 2e20 416c 6c6f 7773 206d  nience. Allows m
+0008f240: 6170 7320 746f 2072 616e 6765 2074 6f20  aps to range to 
+0008f250: 6e65 6761 7469 7665 204f 440d 0a20 2020  negative OD..   
+0008f260: 2020 2020 2020 2020 2023 7365 6c65 6374           #select
+0008f270: 696f 6e20 3d20 7072 6569 6478 202b 2070  ion = preidx + p
+0008f280: 6f73 7469 6478 0d0a 2020 2020 2020 2020  ostidx..        
+0008f290: 2020 2020 2320 7365 6c65 6374 696f 6e2e      # selection.
+0008f2a0: 736f 7274 2829 0d0a 2020 2020 2020 2020  sort()..        
+0008f2b0: 2020 2020 6966 206c 656e 2870 7265 6964      if len(preid
+0008f2c0: 7820 2b20 706f 7374 6964 7829 203d 3d20  x + postidx) == 
+0008f2d0: 323a 0d0a 2020 2020 2020 2020 2020 2020  2:..            
+0008f2e0: 2020 2020 7365 6c66 2e70 322e 7469 746c      self.p2.titl
+0008f2f0: 654c 6162 656c 2e73 6574 5465 7874 2822  eLabel.setText("
+0008f300: 3c63 656e 7465 723e 4269 6e61 7279 206d  <center>Binary m
+0008f310: 6170 2066 726f 6d20 656e 6572 6769 6573  ap from energies
+0008f320: 2022 202b 2073 7472 2872 6f75 6e64 2873   " + str(round(s
+0008f330: 656c 662e 7374 6b2e 6576 5b70 7265 6964  elf.stk.ev[preid
+0008f340: 785b 305d 5d2c 2032 2929 202b 2022 2061  x[0]], 2)) + " a
+0008f350: 6e64 2022 202b 2073 7472 280d 0a20 2020  nd " + str(..   
+0008f360: 2020 2020 2020 2020 2020 2020 2072 6f75               rou
+0008f370: 6e64 2873 656c 662e 7374 6b2e 6576 5b70  nd(self.stk.ev[p
+0008f380: 6f73 7469 6478 5b30 5d5d 2c20 3229 2920  ostidx[0]], 2)) 
+0008f390: 2b20 2220 6556 3c2f 6365 6e74 6572 3e22  + " eV</center>"
+0008f3a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 0008f3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008f3c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0008f3d0: 7472 285b 726f 756e 6428 7365 6c66 2e73  tr([round(self.s
-0008f3e0: 746b 2e65 765b 655d 2c20 3229 2066 6f72  tk.ev[e], 2) for
-0008f3f0: 2065 2069 6e20 706f 7374 6964 785d 292e   e in postidx]).
-0008f400: 7374 7269 7028 275b 5d27 2920 2b20 2220  strip('[]') + " 
-0008f410: 6556 3c2f 6365 6e74 6572 3e22 2c0d 0a20  eV</center>",.. 
-0008f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008f430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008f440: 2020 2020 2020 2020 2020 7369 7a65 3d27            size='
-0008f450: 3130 7074 2729 0d0a 2020 2020 2020 2020  10pt')..        
-0008f460: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0008f470: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0008f480: 7032 2e74 6974 6c65 4c61 6265 6c2e 7365  p2.titleLabel.se
-0008f490: 7454 6578 7428 223c 6365 6e74 6572 3e4d  tText("<center>M
-0008f4a0: 6170 2066 726f 6d20 222b 2073 7472 286c  ap from "+ str(l
-0008f4b0: 656e 2870 7265 6964 7820 2b20 706f 7374  en(preidx + post
-0008f4c0: 6964 7829 2920 2b22 2065 6e65 7267 6965  idx)) +" energie
-0008f4d0: 733a 2022 202b 2073 7472 2872 6f75 6e64  s: " + str(round
-0008f4e0: 2873 656c 662e 7374 6b2e 6576 5b70 7265  (self.stk.ev[pre
-0008f4f0: 6964 785b 305d 5d2c 2032 2929 202b 2027  idx[0]], 2)) + '
-0008f500: 202e 2e2e 2027 202b 2073 7472 2872 6f75   ... ' + str(rou
-0008f510: 6e64 2873 656c 662e 7374 6b2e 6576 5b70  nd(self.stk.ev[p
-0008f520: 7265 6964 785b 2d31 5d5d 2c20 3229 2920  reidx[-1]], 2)) 
-0008f530: 2b20 2220 616e 6420 220d 0a20 2020 2020  + " and "..     
-0008f540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008f550: 2020 2020 2020 2020 2020 2020 2b20 7374              + st
-0008f560: 7228 726f 756e 6428 7365 6c66 2e73 746b  r(round(self.stk
-0008f570: 2e65 765b 706f 7374 6964 785b 305d 5d2c  .ev[postidx[0]],
-0008f580: 2032 2929 202b 2027 202e 2e2e 2027 202b   2)) + ' ... ' +
-0008f590: 2073 7472 2872 6f75 6e64 2873 656c 662e   str(round(self.
-0008f5a0: 7374 6b2e 6576 5b70 6f73 7469 6478 5b2d  stk.ev[postidx[-
-0008f5b0: 315d 5d2c 2032 2929 202b 2022 2065 563c  1]], 2)) + " eV<
-0008f5c0: 2f63 656e 7465 723e 222c 0d0a 2020 2020  /center>",..    
-0008f5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008f5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0008f5f0: 2020 2020 2020 2073 697a 653d 2731 3070         size='10p
-0008f600: 7427 290d 0a20 2020 2020 2020 2020 2020  t')..           
-0008f610: 2073 656c 662e 4f44 203d 2073 656c 662e   self.OD = self.
-0008f620: 4361 6c63 4f44 4d61 7028 7072 6569 6478  CalcODMap(preidx
-0008f630: 2c20 706f 7374 6964 7829 0d0a 2020 2020  , postidx)..    
-0008f640: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0008f650: 6669 6c74 6572 5370 696e 426f 782e 7661  filterSpinBox.va
-0008f660: 6c75 6528 2920 3e20 313a 0d0a 2020 2020  lue() > 1:..    
-0008f670: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0008f680: 2e4f 4420 3d20 6e64 696d 6167 652e 6669  .OD = ndimage.fi
-0008f690: 6c74 6572 732e 756e 6966 6f72 6d5f 6669  lters.uniform_fi
-0008f6a0: 6c74 6572 2873 656c 662e 4f44 2c20 7369  lter(self.OD, si
-0008f6b0: 7a65 3d73 656c 662e 6669 6c74 6572 5370  ze=self.filterSp
-0008f6c0: 696e 426f 782e 7661 6c75 6528 292c 206d  inBox.value(), m
-0008f6d0: 6f64 653d 276e 6561 7265 7374 2729 0d0a  ode='nearest')..
-0008f6e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0008f6f0: 2e4f 446d 696e 203d 206e 702e 6d69 6e28  .ODmin = np.min(
-0008f700: 7365 6c66 2e4f 4429 0d0a 2020 2020 2020  self.OD)..      
-0008f710: 2020 2020 2020 7365 6c66 2e4f 446d 6178        self.ODmax
-0008f720: 203d 206e 702e 6d61 7828 7365 6c66 2e4f   = np.max(self.O
-0008f730: 4429 0d0a 2020 2020 2020 2020 2020 2020  D)..            
-0008f740: 7365 6c66 2e4f 4448 6967 6853 7069 6e42  self.ODHighSpinB
-0008f750: 6f78 2e73 6574 456e 6162 6c65 6428 5472  ox.setEnabled(Tr
-0008f760: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-0008f770: 2073 656c 662e 4f44 4c6f 7753 7069 6e42   self.ODLowSpinB
-0008f780: 6f78 2e73 6574 456e 6162 6c65 6428 5472  ox.setEnabled(Tr
-0008f790: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-0008f7a0: 2073 656c 662e 4f44 4869 6768 5370 696e   self.ODHighSpin
-0008f7b0: 426f 782e 626c 6f63 6b53 6967 6e61 6c73  Box.blockSignals
-0008f7c0: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
-0008f7d0: 2020 2020 7365 6c66 2e4f 444c 6f77 5370      self.ODLowSp
-0008f7e0: 696e 426f 782e 626c 6f63 6b53 6967 6e61  inBox.blockSigna
-0008f7f0: 6c73 2854 7275 6529 0d0a 2020 2020 2020  ls(True)..      
-0008f800: 2020 2020 2020 7365 6c66 2e4f 4448 6967        self.ODHig
-0008f810: 6853 7069 6e42 6f78 2e73 6574 4d61 7869  hSpinBox.setMaxi
-0008f820: 6d75 6d28 7365 6c66 2e4f 446d 6178 290d  mum(self.ODmax).
-0008f830: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0008f840: 662e 4f44 4869 6768 5370 696e 426f 782e  f.ODHighSpinBox.
-0008f850: 7365 744d 696e 696d 756d 2873 656c 662e  setMinimum(self.
-0008f860: 4f44 6d69 6e29 0d0a 2020 2020 2020 2020  ODmin)..        
-0008f870: 2020 2020 7365 6c66 2e4f 444c 6f77 5370      self.ODLowSp
-0008f880: 696e 426f 782e 7365 744d 6178 696d 756d  inBox.setMaximum
-0008f890: 2873 656c 662e 4f44 6d61 7829 0d0a 2020  (self.ODmax)..  
-0008f8a0: 2020 2020 2020 2020 2020 7365 6c66 2e4f            self.O
-0008f8b0: 444c 6f77 5370 696e 426f 782e 7365 744d  DLowSpinBox.setM
-0008f8c0: 696e 696d 756d 2873 656c 662e 4f44 6d69  inimum(self.ODmi
-0008f8d0: 6e29 0d0a 2020 2020 2020 2020 2020 2020  n)..            
-0008f8e0: 7365 6c66 2e4f 444c 6f77 5370 696e 426f  self.ODLowSpinBo
-0008f8f0: 782e 7365 7456 616c 7565 2873 656c 662e  x.setValue(self.
-0008f900: 4f44 6d69 6e29 0d0a 2020 2020 2020 2020  ODmin)..        
-0008f910: 2020 2020 7365 6c66 2e4f 4448 6967 6853      self.ODHighS
-0008f920: 7069 6e42 6f78 2e73 6574 5661 6c75 6528  pinBox.setValue(
-0008f930: 7365 6c66 2e4f 446d 6178 290d 0a20 2020  self.ODmax)..   
-0008f940: 2020 2020 2020 2020 2073 656c 662e 7365           self.se
-0008f950: 744f 446c 696d 6974 7328 7365 6c66 2e4f  tODlimits(self.O
-0008f960: 446d 696e 2c20 7365 6c66 2e4f 446d 6178  Dmin, self.ODmax
-0008f970: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-0008f980: 656c 662e 4f44 4869 6768 5370 696e 426f  elf.ODHighSpinBo
-0008f990: 782e 626c 6f63 6b53 6967 6e61 6c73 2846  x.blockSignals(F
-0008f9a0: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
-0008f9b0: 2020 2073 656c 662e 4f44 4c6f 7753 7069     self.ODLowSpi
-0008f9c0: 6e42 6f78 2e62 6c6f 636b 5369 676e 616c  nBox.blockSignal
-0008f9d0: 7328 4661 6c73 6529 0d0a 2020 2020 2020  s(False)..      
-0008f9e0: 2020 2020 2020 7365 6c66 2e70 6252 5354        self.pbRST
-0008f9f0: 4f44 2e73 6574 456e 6162 6c65 6428 5472  OD.setEnabled(Tr
-0008fa00: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-0008fa10: 2073 656c 662e 6669 6c74 6572 5370 696e   self.filterSpin
-0008fa20: 426f 782e 7365 7445 6e61 626c 6564 2854  Box.setEnabled(T
-0008fa30: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
-0008fa40: 2020 7365 6c66 2e70 6245 7870 4461 7461    self.pbExpData
-0008fa50: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
-0008fa60: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-0008fa70: 656c 662e 7062 4578 7049 6d67 2e73 6574  elf.pbExpImg.set
-0008fa80: 456e 6162 6c65 6428 5472 7565 290d 0a20  Enabled(True).. 
-0008fa90: 2020 2020 2020 2020 2020 2023 7365 6c66             #self
-0008faa0: 2e70 676c 6179 6f75 742e 6c61 796f 7574  .pglayout.layout
-0008fab0: 2e73 6574 436f 6c75 6d6e 4d61 7869 6d75  .setColumnMaximu
-0008fac0: 6d57 6964 7468 2831 2c20 7365 6c66 2e70  mWidth(1, self.p
-0008fad0: 312e 7769 6474 6828 2929 0d0a 2020 2020  1.width())..    
-0008fae0: 2020 2020 6578 6365 7074 2049 6e64 6578      except Index
-0008faf0: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
-0008fb00: 2020 2020 7365 6c66 2e70 322e 636c 6561      self.p2.clea
-0008fb10: 7228 290d 0a20 2020 2020 2020 2020 2020  r()..           
-0008fb20: 2073 656c 662e 636d 2e63 6c65 6172 2829   self.cm.clear()
-0008fb30: 0d0a 2020 2020 2020 2020 2020 2020 2373  ..            #s
-0008fb40: 656c 662e 7032 2e73 6574 5469 746c 6528  elf.p2.setTitle(
-0008fb50: 2250 6c65 6173 6520 7365 6c65 6374 2061  "Please select a
-0008fb60: 2073 6563 6f6e 6420 696d 6167 6521 2229   second image!")
-0008fb70: 0d0a 2020 2020 2020 2020 2020 2020 2370  ..            #p
-0008fb80: 7269 6e74 2822 5365 6c65 6374 2061 2073  rint("Select a s
-0008fb90: 6563 6f6e 6420 696d 6167 6521 2229 0d0a  econd image!")..
-0008fba0: 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ..#-------------
-0008fbb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0008fbc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0008fbd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0008fbe0: 2d2d 2d2d 2d2d 2d2d 2d0d 0a63 6c61 7373  ---------..class
-0008fbf0: 2053 7461 636b 4c69 7374 4672 616d 6528   StackListFrame(
-0008fc00: 5174 5769 6467 6574 732e 5144 6961 6c6f  QtWidgets.QDialo
-0008fc10: 6729 3a0d 0a0d 0a20 2020 2064 6566 205f  g):....    def _
-0008fc20: 5f69 6e69 745f 5f28 7365 6c66 2c20 7061  _init__(self, pa
-0008fc30: 7265 6e74 2c20 6669 6c65 7061 7468 2c20  rent, filepath, 
-0008fc40: 636f 6d2c 2073 7461 636b 2c20 6461 7461  com, stack, data
-0008fc50: 5f73 7472 7563 7429 3a0d 0a20 2020 2020  _struct):..     
-0008fc60: 2020 2051 7457 6964 6765 7473 2e51 5769     QtWidgets.QWi
-0008fc70: 6467 6574 2e5f 5f69 6e69 745f 5f28 7365  dget.__init__(se
-0008fc80: 6c66 2c20 7061 7265 6e74 290d 0a0d 0a20  lf, parent).... 
-0008fc90: 2020 2020 2020 2073 656c 662e 7061 7265         self.pare
-0008fca0: 6e74 203d 2070 6172 656e 740d 0a0d 0a20  nt = parent.... 
-0008fcb0: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
-0008fcc0: 5f73 7472 7563 7420 3d20 6461 7461 5f73  _struct = data_s
-0008fcd0: 7472 7563 740d 0a20 2020 2020 2020 2073  truct..        s
-0008fce0: 656c 662e 7374 6b20 3d20 7374 6163 6b0d  elf.stk = stack.
-0008fcf0: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
-0008fd00: 6d6d 6f6e 203d 2063 6f6d 0d0a 0d0a 2020  mmon = com....  
-0008fd10: 2020 2020 2020 7365 6c66 2e72 6573 697a        self.resiz
-0008fd20: 6528 3630 302c 2035 3030 290d 0a20 2020  e(600, 500)..   
-0008fd30: 2020 2020 2073 656c 662e 7365 7457 696e       self.setWin
-0008fd40: 646f 7754 6974 6c65 2827 5374 6163 6b20  dowTitle('Stack 
-0008fd50: 4669 6c65 204c 6973 7427 290d 0a0d 0a20  File List').... 
-0008fd60: 2020 2020 2020 2070 616c 203d 2051 7447         pal = QtG
-0008fd70: 7569 2e51 5061 6c65 7474 6528 290d 0a20  ui.QPalette().. 
-0008fd80: 2020 2020 2020 2073 656c 662e 7365 7441         self.setA
-0008fd90: 7574 6f46 696c 6c42 6163 6b67 726f 756e  utoFillBackgroun
-0008fda0: 6428 5472 7565 290d 0a20 2020 2020 2020  d(True)..       
-0008fdb0: 2070 616c 2e73 6574 436f 6c6f 7228 5174   pal.setColor(Qt
-0008fdc0: 4775 692e 5150 616c 6574 7465 2e57 696e  Gui.QPalette.Win
-0008fdd0: 646f 772c 5174 4775 692e 5143 6f6c 6f72  dow,QtGui.QColor
-0008fde0: 2827 7768 6974 6527 2929 0d0a 2020 2020  ('white'))..    
-0008fdf0: 2020 2020 7365 6c66 2e73 6574 5061 6c65      self.setPale
-0008fe00: 7474 6528 7061 6c29 0d0a 0d0a 2020 2020  tte(pal)....    
-0008fe10: 2020 2020 7365 6c66 2e66 696c 6570 6174      self.filepat
-0008fe20: 6820 3d20 7374 7228 6669 6c65 7061 7468  h = str(filepath
-0008fe30: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-0008fe40: 662e 6861 7665 3173 7420 3d20 300d 0a20  f.have1st = 0.. 
-0008fe50: 2020 2020 2020 2073 656c 662e 6861 7665         self.have
-0008fe60: 6c61 7374 203d 2030 0d0a 2020 2020 2020  last = 0..      
-0008fe70: 2020 7365 6c66 2e66 696c 6531 7374 203d    self.file1st =
-0008fe80: 2027 2027 0d0a 2020 2020 2020 2020 7365   ' '..        se
-0008fe90: 6c66 2e66 696c 656c 6173 7420 3d20 2720  lf.filelast = ' 
-0008fea0: 270d 0a0d 0a20 2020 2020 2020 2073 656c  '....        sel
-0008feb0: 662e 6669 6c65 7479 7065 203d 2027 270d  f.filetype = ''.
-0008fec0: 0a0d 0a20 2020 2020 2020 2076 626f 7820  ...        vbox 
-0008fed0: 3d20 5174 5769 6467 6574 732e 5156 426f  = QtWidgets.QVBo
-0008fee0: 784c 6179 6f75 7428 290d 0a0d 0a20 2020  xLayout()....   
-0008fef0: 2020 2020 2073 656c 662e 7465 7874 7420       self.textt 
-0008ff00: 3d20 5174 5769 6467 6574 732e 514c 6162  = QtWidgets.QLab
-0008ff10: 656c 2873 656c 6629 0d0a 2020 2020 2020  el(self)..      
-0008ff20: 2020 7365 6c66 2e74 6578 7474 2e73 6574    self.textt.set
-0008ff30: 5465 7874 2827 5365 6c65 6374 2066 6972  Text('Select fir
-0008ff40: 7374 2073 7461 636b 2066 696c 6527 290d  st stack file').
-0008ff50: 0a0d 0a20 2020 2020 2020 2076 626f 782e  ...        vbox.
-0008ff60: 6164 6453 7472 6574 6368 2831 290d 0a20  addStretch(1).. 
-0008ff70: 2020 2020 2020 2076 626f 782e 6164 6457         vbox.addW
-0008ff80: 6964 6765 7428 7365 6c66 2e74 6578 7474  idget(self.textt
-0008ff90: 290d 0a0d 0a0d 0a20 2020 2020 2020 2073  )......        s
-0008ffa0: 656c 662e 6669 6c65 6c69 7374 203d 2051  elf.filelist = Q
-0008ffb0: 7447 7569 2e51 5461 626c 6557 6964 6765  tGui.QTableWidge
-0008ffc0: 7428 290d 0a20 2020 2020 2020 2073 656c  t()..        sel
-0008ffd0: 662e 6669 6c65 6c69 7374 2e73 6574 4d69  f.filelist.setMi
-0008ffe0: 6e69 6d75 6d48 6569 6768 7428 3435 3029  nimumHeight(450)
-0008fff0: 0d0a 2020 2020 2020 2020 7365 6c66 2e66  ..        self.f
-00090000: 696c 656c 6973 742e 7365 7443 6f6c 756d  ilelist.setColum
-00090010: 6e43 6f75 6e74 2834 290d 0a20 2020 2020  nCount(4)..     
-00090020: 2020 2073 656c 662e 6669 6c65 6c69 7374     self.filelist
-00090030: 2e73 6574 486f 7269 7a6f 6e74 616c 4865  .setHorizontalHe
-00090040: 6164 6572 4c61 6265 6c73 2828 2746 696c  aderLabels(('Fil
-00090050: 6520 6c69 7374 272c 2027 5827 2c20 2759  e list', 'X', 'Y
-00090060: 272c 2027 6556 2729 290d 0a20 2020 2020  ', 'eV'))..     
-00090070: 2020 2073 656c 662e 6669 6c65 6c69 7374     self.filelist
-00090080: 2e73 6574 5368 6f77 4772 6964 2846 616c  .setShowGrid(Fal
-00090090: 7365 290d 0a20 2020 2020 2020 2073 656c  se)..        sel
-000900a0: 662e 6669 6c65 6c69 7374 2e76 6572 7469  f.filelist.verti
-000900b0: 6361 6c48 6561 6465 7228 292e 7365 7456  calHeader().setV
-000900c0: 6973 6962 6c65 2846 616c 7365 290d 0a0d  isible(False)...
-000900d0: 0a20 2020 2020 2020 2073 656c 662e 6669  .        self.fi
-000900e0: 6c65 6c69 7374 2e73 6574 436f 6c75 6d6e  lelist.setColumn
-000900f0: 5769 6474 6828 302c 3430 3029 0d0a 2020  Width(0,400)..  
-00090100: 2020 2020 2020 7365 6c66 2e66 696c 656c        self.filel
-00090110: 6973 742e 7365 7443 6f6c 756d 6e57 6964  ist.setColumnWid
-00090120: 7468 2831 2c35 3029 0d0a 2020 2020 2020  th(1,50)..      
-00090130: 2020 7365 6c66 2e66 696c 656c 6973 742e    self.filelist.
-00090140: 7365 7443 6f6c 756d 6e57 6964 7468 2832  setColumnWidth(2
-00090150: 2c35 3029 0d0a 2020 2020 2020 2020 7365  ,50)..        se
-00090160: 6c66 2e66 696c 656c 6973 742e 7365 7443  lf.filelist.setC
-00090170: 6f6c 756d 6e57 6964 7468 2833 2c35 3029  olumnWidth(3,50)
-00090180: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00090190: 2e66 696c 656c 6973 742e 7365 7452 6f77  .filelist.setRow
-000901a0: 436f 756e 7428 3029 0d0a 0d0a 2020 2020  Count(0)....    
-000901b0: 2020 2020 7365 6c66 2e66 696c 656c 6973      self.filelis
-000901c0: 742e 6365 6c6c 436c 6963 6b65 642e 636f  t.cellClicked.co
-000901d0: 6e6e 6563 7428 7365 6c66 2e4f 6e46 696c  nnect(self.OnFil
-000901e0: 654c 6973 7429 0d0a 0d0a 0d0a 0d0a 2020  eList)........  
-000901f0: 2020 2020 2020 7662 6f78 2e61 6464 5769        vbox.addWi
-00090200: 6467 6574 2873 656c 662e 6669 6c65 6c69  dget(self.fileli
-00090210: 7374 290d 0a20 2020 2020 2020 2076 626f  st)..        vbo
-00090220: 782e 6164 6453 7472 6574 6368 2831 290d  x.addStretch(1).
-00090230: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00090240: 7463 5f66 6972 7374 203d 2051 7457 6964  tc_first = QtWid
-00090250: 6765 7473 2e51 4c61 6265 6c28 7365 6c66  gets.QLabel(self
-00090260: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00090270: 7463 5f66 6972 7374 2e73 6574 5465 7874  tc_first.setText
-00090280: 2827 4669 7273 7420 7374 6163 6b20 6669  ('First stack fi
-00090290: 6c65 3a20 2729 0d0a 2020 2020 2020 2020  le: ')..        
-000902a0: 7365 6c66 2e74 635f 6c61 7374 203d 2051  self.tc_last = Q
-000902b0: 7457 6964 6765 7473 2e51 4c61 6265 6c28  tWidgets.QLabel(
-000902c0: 7365 6c66 290d 0a20 2020 2020 2020 2073  self)..        s
-000902d0: 656c 662e 7463 5f6c 6173 742e 7365 7454  elf.tc_last.setT
-000902e0: 6578 7428 274c 6173 7420 7374 6163 6b20  ext('Last stack 
-000902f0: 6669 6c65 3a20 2729 0d0a 0d0a 0d0a 2020  file: ')......  
-00090300: 2020 2020 2020 7662 6f78 2e61 6464 5769        vbox.addWi
-00090310: 6467 6574 2873 656c 662e 7463 5f66 6972  dget(self.tc_fir
-00090320: 7374 290d 0a20 2020 2020 2020 2076 626f  st)..        vbo
-00090330: 782e 6164 6457 6964 6765 7428 7365 6c66  x.addWidget(self
-00090340: 2e74 635f 6c61 7374 290d 0a20 2020 2020  .tc_last)..     
-00090350: 2020 2076 626f 782e 6164 6453 7472 6574     vbox.addStret
-00090360: 6368 2831 290d 0a0d 0a0d 0a20 2020 2020  ch(1)......     
-00090370: 2020 2068 626f 7820 3d20 5174 5769 6467     hbox = QtWidg
-00090380: 6574 732e 5148 426f 784c 6179 6f75 7428  ets.QHBoxLayout(
-00090390: 290d 0a0d 0a0d 0a20 2020 2020 2020 2073  )......        s
-000903a0: 656c 662e 6275 7474 6f6e 5f61 6363 6570  elf.button_accep
-000903b0: 7420 3d20 5174 5769 6467 6574 732e 5150  t = QtWidgets.QP
-000903c0: 7573 6842 7574 746f 6e28 2741 6363 6570  ushButton('Accep
-000903d0: 7427 290d 0a20 2020 2020 2020 2023 7365  t')..        #se
-000903e0: 6c66 2e62 7574 746f 6e5f 6163 6365 7074  lf.button_accept
-000903f0: 2e73 6574 456e 6162 6c65 6428 4661 6c73  .setEnabled(Fals
-00090400: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-00090410: 2e62 7574 746f 6e5f 6163 6365 7074 2e63  .button_accept.c
-00090420: 6c69 636b 6564 2e63 6f6e 6e65 6374 2820  licked.connect( 
-00090430: 7365 6c66 2e4f 6e41 6363 6570 7429 0d0a  self.OnAccept)..
-00090440: 2020 2020 2020 2020 6862 6f78 2e61 6464          hbox.add
-00090450: 5769 6467 6574 2873 656c 662e 6275 7474  Widget(self.butt
-00090460: 6f6e 5f61 6363 6570 7429 0d0a 0d0a 2020  on_accept)....  
-00090470: 2020 2020 2020 6275 7474 6f6e 5f63 616e        button_can
-00090480: 6365 6c20 3d20 5174 5769 6467 6574 732e  cel = QtWidgets.
-00090490: 5150 7573 6842 7574 746f 6e28 2743 616e  QPushButton('Can
-000904a0: 6365 6c27 290d 0a20 2020 2020 2020 2062  cel')..        b
-000904b0: 7574 746f 6e5f 6361 6e63 656c 2e63 6c69  utton_cancel.cli
-000904c0: 636b 6564 2e63 6f6e 6e65 6374 2820 7365  cked.connect( se
-000904d0: 6c66 2e63 6c6f 7365 290d 0a20 2020 2020  lf.close)..     
-000904e0: 2020 2068 626f 782e 6164 6457 6964 6765     hbox.addWidge
-000904f0: 7428 6275 7474 6f6e 5f63 616e 6365 6c29  t(button_cancel)
-00090500: 0d0a 0d0a 2020 2020 2020 2020 7662 6f78  ....        vbox
-00090510: 2e61 6464 4c61 796f 7574 2868 626f 7829  .addLayout(hbox)
-00090520: 0d0a 0d0a 2020 2020 2020 2020 7662 6f78  ....        vbox
-00090530: 2e61 6464 5374 7265 7463 6828 302e 3529  .addStretch(0.5)
-00090540: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7365  ......        se
-00090550: 6c66 2e73 6574 4c61 796f 7574 2876 626f  lf.setLayout(vbo
-00090560: 7829 0d0a 0d0a 2020 2020 2020 2020 7365  x)....        se
-00090570: 6c66 2e53 686f 7746 696c 654c 6973 7428  lf.ShowFileList(
-00090580: 290d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d  )....#----------
-00090590: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000905a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000905b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000905c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020  ------------..  
-000905d0: 2020 6465 6620 4f6e 4669 6c65 4c69 7374    def OnFileList
-000905e0: 2873 656c 662c 2072 6f77 2c20 636f 6c75  (self, row, colu
-000905f0: 6d6e 293a 0d0a 0d0a 0d0a 2020 2020 2020  mn):......      
-00090600: 2020 6966 2028 7365 6c66 2e68 6176 6531    if (self.have1
-00090610: 7374 203d 3d20 3129 2061 6e64 2028 7365  st == 1) and (se
-00090620: 6c66 2e68 6176 656c 6173 743d 3d31 293a  lf.havelast==1):
-00090630: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00090640: 6c66 2e68 6176 6531 7374 203d 2030 0d0a  lf.have1st = 0..
-00090650: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00090660: 2e68 6176 656c 6173 7420 3d20 300d 0a20  .havelast = 0.. 
-00090670: 2020 2020 2020 2020 2020 2023 7365 6c66             #self
-00090680: 2e62 7574 746f 6e5f 6163 6365 7074 2e73  .button_accept.s
-00090690: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
-000906a0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000906b0: 6c66 2e74 635f 6669 7273 742e 7365 7454  lf.tc_first.setT
-000906c0: 6578 7428 2746 6972 7374 2073 7461 636b  ext('First stack
-000906d0: 2066 696c 653a 2027 290d 0a20 2020 2020   file: ')..     
-000906e0: 2020 2020 2020 2073 656c 662e 7463 5f6c         self.tc_l
-000906f0: 6173 742e 7365 7454 6578 7428 274c 6173  ast.setText('Las
-00090700: 7420 7374 6163 6b20 6669 6c65 3a20 2729  t stack file: ')
-00090710: 0d0a 0d0a 2020 2020 2020 2020 6974 656d  ....        item
-00090720: 203d 2073 656c 662e 6669 6c65 6c69 7374   = self.filelist
-00090730: 2e69 7465 6d28 726f 772c 2030 290d 0a20  .item(row, 0).. 
-00090740: 2020 2020 2020 2066 6e20 3d20 2069 7465         fn =  ite
-00090750: 6d2e 7465 7874 2829 0d0a 2020 2020 2020  m.text()..      
-00090760: 2020 6966 2073 656c 662e 6861 7665 3173    if self.have1s
-00090770: 7420 3d3d 2030 3a0d 0a20 2020 2020 2020  t == 0:..       
-00090780: 2020 2020 2073 656c 662e 7463 5f66 6972       self.tc_fir
-00090790: 7374 2e73 6574 5465 7874 2827 4669 7273  st.setText('Firs
-000907a0: 7420 7374 6163 6b20 6669 6c65 3a20 2720  t stack file: ' 
-000907b0: 2b20 666e 290d 0a20 2020 2020 2020 2020  + fn)..         
-000907c0: 2020 2073 656c 662e 7465 7874 742e 7365     self.textt.se
-000907d0: 7454 6578 7428 2753 656c 6563 7420 6c61  tText('Select la
-000907e0: 7374 2073 7461 636b 2066 696c 6527 290d  st stack file').
-000907f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00090800: 662e 6669 6c65 3173 7420 3d20 666e 0d0a  f.file1st = fn..
-00090810: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00090820: 2e68 6176 6531 7374 203d 2031 0d0a 2020  .have1st = 1..  
-00090830: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-00090840: 6861 7665 6c61 7374 203d 3d20 303a 0d0a  havelast == 0:..
-00090850: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00090860: 2e74 635f 6c61 7374 2e73 6574 5465 7874  .tc_last.setText
-00090870: 2827 4c61 7374 2073 7461 636b 2066 696c  ('Last stack fil
-00090880: 653a 2027 202b 2066 6e29 0d0a 2020 2020  e: ' + fn)..    
-00090890: 2020 2020 2020 2020 7365 6c66 2e74 6578          self.tex
-000908a0: 7474 2e73 6574 5465 7874 2827 5365 6c65  tt.setText('Sele
-000908b0: 6374 2066 6972 7374 2073 7461 636b 2066  ct first stack f
-000908c0: 696c 6527 290d 0a20 2020 2020 2020 2020  ile')..         
-000908d0: 2020 2073 656c 662e 6669 6c65 6c61 7374     self.filelast
-000908e0: 203d 2066 6e0d 0a20 2020 2020 2020 2020   = fn..         
-000908f0: 2020 2023 7365 6c66 2e62 7574 746f 6e5f     #self.button_
-00090900: 6163 6365 7074 2e73 6574 456e 6162 6c65  accept.setEnable
-00090910: 6428 5472 7565 290d 0a20 2020 2020 2020  d(True)..       
-00090920: 2020 2020 2073 656c 662e 6861 7665 6c61       self.havela
-00090930: 7374 203d 2031 0d0a 0d0a 232d 2d2d 2d2d  st = 1....#-----
-00090940: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00090950: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00090960: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00090970: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00090980: 2d0d 0a20 2020 2064 6566 2053 686f 7746  -..    def ShowF
-00090990: 696c 654c 6973 7428 7365 6c66 293a 0d0a  ileList(self):..
-000909a0: 0d0a 2020 2020 2020 2020 6669 6c65 7061  ..        filepa
-000909b0: 7468 203d 2073 7472 2873 656c 662e 6669  th = str(self.fi
-000909c0: 6c65 7061 7468 290d 0a20 2020 2020 2020  lepath)..       
-000909d0: 2073 656c 662e 736d 5f66 696c 6573 203d   self.sm_files =
-000909e0: 205b 7820 666f 7220 7820 696e 206f 732e   [x for x in os.
-000909f0: 6c69 7374 6469 7228 6669 6c65 7061 7468  listdir(filepath
-00090a00: 2920 6966 2078 2e65 6e64 7377 6974 6828  ) if x.endswith(
-00090a10: 272e 736d 2729 5d0d 0a0d 0a20 2020 2020  '.sm')]....     
-00090a20: 2020 2069 6620 7365 6c66 2e73 6d5f 6669     if self.sm_fi
-00090a30: 6c65 733a 0d0a 0d0a 2020 2020 2020 2020  les:....        
-00090a40: 2020 2020 7365 6c66 2e66 696c 6574 7970      self.filetyp
-00090a50: 6520 3d20 2773 6d27 0d0a 0d0a 2020 2020  e = 'sm'....    
-00090a60: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
-00090a70: 2020 2020 2020 2020 2020 2020 2020 6672                fr
-00090a80: 6f6d 206e 6574 4344 4634 2069 6d70 6f72  om netCDF4 impor
-00090a90: 7420 4461 7461 7365 740d 0a20 2020 2020  t Dataset..     
-00090aa0: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
-00090ab0: 6669 6c65 5f70 6c75 6769 6e73 2069 6d70  file_plugins imp
-00090ac0: 6f72 7420 6669 6c65 5f73 6d5f 6e65 7463  ort file_sm_netc
-00090ad0: 6466 0d0a 0d0a 2020 2020 2020 2020 2020  df....          
-00090ae0: 2020 6578 6365 7074 3a0d 0a20 2020 2020    except:..     
-00090af0: 2020 2020 2020 2020 2020 2051 7447 7569             QtGui
-00090b00: 2e51 4d65 7373 6167 6542 6f78 2e77 6172  .QMessageBox.war
-00090b10: 6e69 6e67 2873 656c 662c 2027 4572 726f  ning(self, 'Erro
-00090b20: 7227 2c20 2243 6f75 6c64 206e 6f74 2069  r', "Could not i
-00090b30: 6d70 6f72 7420 6e65 7443 4446 3420 6c69  mport netCDF4 li
-00090b40: 6272 6172 792e 2229 0d0a 2020 2020 2020  brary.")..      
-00090b50: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00090b60: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00090b70: 636f 756e 7420 3d20 300d 0a0d 0a20 2020  count = 0....   
-00090b80: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-00090b90: 6e20 7261 6e67 6528 6c65 6e28 7365 6c66  n range(len(self
-00090ba0: 2e73 6d5f 6669 6c65 7329 293a 0d0a 0d0a  .sm_files)):....
-00090bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090bc0: 6669 6c65 6e61 6d65 203d 2073 656c 662e  filename = self.
-00090bd0: 736d 5f66 696c 6573 5b69 5d0d 0a20 2020  sm_files[i]..   
-00090be0: 2020 2020 2020 2020 2020 2020 2074 6869               thi
-00090bf0: 7366 696c 6520 3d20 6f73 2e70 6174 682e  sfile = os.path.
-00090c00: 6a6f 696e 2866 696c 6570 6174 682c 2066  join(filepath, f
-00090c10: 696c 656e 616d 6529 0d0a 0d0a 2020 2020  ilename)....    
-00090c20: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00090c30: 7665 722c 206e 636f 6c73 2c20 6e72 6f77  ver, ncols, nrow
-00090c40: 732c 2069 6576 203d 2066 696c 655f 736d  s, iev = file_sm
-00090c50: 5f6e 6574 6364 662e 7265 6164 5f73 6d5f  _netcdf.read_sm_
-00090c60: 6865 6164 6572 2874 6869 7366 696c 6529  header(thisfile)
-00090c70: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00090c80: 2020 2020 6966 2066 696c 6576 6572 203e      if filever >
-00090c90: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-00090ca0: 2020 2020 2020 2020 2073 656c 662e 6669           self.fi
-00090cb0: 6c65 6c69 7374 2e69 6e73 6572 7452 6f77  lelist.insertRow
-00090cc0: 2863 6f75 6e74 290d 0a20 2020 2020 2020  (count)..       
-00090cd0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00090ce0: 662e 6669 6c65 6c69 7374 2e73 6574 526f  f.filelist.setRo
-00090cf0: 7748 6569 6768 7428 636f 756e 742c 3230  wHeight(count,20
-00090d00: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00090d10: 2020 2020 2020 2020 2073 656c 662e 6669           self.fi
-00090d20: 6c65 6c69 7374 2e73 6574 4974 656d 2863  lelist.setItem(c
-00090d30: 6f75 6e74 2c20 302c 2051 7447 7569 2e51  ount, 0, QtGui.Q
-00090d40: 5461 626c 6557 6964 6765 7449 7465 6d28  TableWidgetItem(
-00090d50: 6669 6c65 6e61 6d65 2929 0d0a 2020 2020  filename))..    
-00090d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090d70: 7365 6c66 2e66 696c 656c 6973 742e 7365  self.filelist.se
-00090d80: 7449 7465 6d28 636f 756e 742c 2031 2c20  tItem(count, 1, 
-00090d90: 5174 4775 692e 5154 6162 6c65 5769 6467  QtGui.QTableWidg
-00090da0: 6574 4974 656d 2873 7472 286e 636f 6c73  etItem(str(ncols
-00090db0: 2929 290d 0a20 2020 2020 2020 2020 2020  )))..           
-00090dc0: 2020 2020 2020 2020 2073 656c 662e 6669           self.fi
-00090dd0: 6c65 6c69 7374 2e73 6574 4974 656d 2863  lelist.setItem(c
-00090de0: 6f75 6e74 2c20 322c 2051 7447 7569 2e51  ount, 2, QtGui.Q
-00090df0: 5461 626c 6557 6964 6765 7449 7465 6d28  TableWidgetItem(
-00090e00: 7374 7228 6e72 6f77 7329 2929 0d0a 2020  str(nrows)))..  
-00090e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090e20: 2020 7365 6c66 2e66 696c 656c 6973 742e    self.filelist.
-00090e30: 7365 7449 7465 6d28 636f 756e 742c 2033  setItem(count, 3
-00090e40: 2c20 5174 4775 692e 5154 6162 6c65 5769  , QtGui.QTableWi
-00090e50: 6467 6574 4974 656d 2827 7b30 3a35 2e32  dgetItem('{0:5.2
-00090e60: 667d 272e 666f 726d 6174 2869 6576 2929  f}'.format(iev))
-00090e70: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00090e80: 2020 2020 2020 2020 2063 6f75 6e74 202b           count +
-00090e90: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-00090ea0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00090eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00090ec0: 636f 6e74 696e 7565 0d0a 0d0a 0d0a 0d0a  continue........
-00090ed0: 0d0a 2020 2020 2020 2020 7365 6c66 2e78  ..        self.x
-00090ee0: 726d 5f66 696c 6573 203d 205b 7820 666f  rm_files = [x fo
-00090ef0: 7220 7820 696e 206f 732e 6c69 7374 6469  r x in os.listdi
-00090f00: 7228 6669 6c65 7061 7468 2920 6966 2078  r(filepath) if x
-00090f10: 2e65 6e64 7377 6974 6828 272e 7872 6d27  .endswith('.xrm'
-00090f20: 295d 0d0a 0d0a 0d0a 2020 2020 2020 2020  )]......        
-00090f30: 6966 2073 656c 662e 7872 6d5f 6669 6c65  if self.xrm_file
-00090f40: 733a 0d0a 0d0a 2020 2020 2020 2020 2020  s:....          
-00090f50: 2020 7365 6c66 2e66 696c 6574 7970 6520    self.filetype 
-00090f60: 3d20 2778 726d 270d 0a0d 0a20 2020 2020  = 'xrm'....     
-00090f70: 2020 2020 2020 2063 6f75 6e74 203d 2030         count = 0
-00090f80: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00090f90: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
-00090fa0: 656e 2873 656c 662e 7872 6d5f 6669 6c65  en(self.xrm_file
-00090fb0: 7329 293a 0d0a 0d0a 2020 2020 2020 2020  s)):....        
-00090fc0: 2020 2020 2020 2020 6669 6c65 6e61 6d65          filename
-00090fd0: 203d 2073 656c 662e 7872 6d5f 6669 6c65   = self.xrm_file
-00090fe0: 735b 695d 0d0a 2020 2020 2020 2020 2020  s[i]..          
-00090ff0: 2020 2020 2020 7468 6973 6669 6c65 203d        thisfile =
-00091000: 206f 732e 7061 7468 2e6a 6f69 6e28 6669   os.path.join(fi
-00091010: 6c65 7061 7468 2c20 6669 6c65 6e61 6d65  lepath, filename
-00091020: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00091030: 2020 2020 206e 636f 6c73 2c20 6e72 6f77       ncols, nrow
-00091040: 732c 2069 6576 203d 2066 696c 655f 7872  s, iev = file_xr
-00091050: 6d2e 7265 6164 5f78 726d 5f66 696c 6569  m.read_xrm_filei
-00091060: 6e66 6f28 7468 6973 6669 6c65 290d 0a0d  nfo(thisfile)...
-00091070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00091080: 2069 6620 6e63 6f6c 7320 3e20 303a 0d0a   if ncols > 0:..
-00091090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000910a0: 2020 2020 7365 6c66 2e66 696c 656c 6973      self.filelis
-000910b0: 742e 696e 7365 7274 526f 7728 636f 756e  t.insertRow(coun
-000910c0: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-000910d0: 2020 2020 2020 2020 7365 6c66 2e66 696c          self.fil
-000910e0: 656c 6973 742e 7365 7452 6f77 4865 6967  elist.setRowHeig
-000910f0: 6874 2863 6f75 6e74 2c32 3029 0d0a 0d0a  ht(count,20)....
-00091100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091110: 2020 2020 7365 6c66 2e66 696c 656c 6973      self.filelis
-00091120: 742e 7365 7449 7465 6d28 636f 756e 742c  t.setItem(count,
-00091130: 2030 2c20 5174 4775 692e 5154 6162 6c65   0, QtGui.QTable
-00091140: 5769 6467 6574 4974 656d 2866 696c 656e  WidgetItem(filen
-00091150: 616d 6529 290d 0a20 2020 2020 2020 2020  ame))..         
-00091160: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00091170: 6669 6c65 6c69 7374 2e73 6574 4974 656d  filelist.setItem
-00091180: 2863 6f75 6e74 2c20 312c 2051 7447 7569  (count, 1, QtGui
-00091190: 2e51 5461 626c 6557 6964 6765 7449 7465  .QTableWidgetIte
-000911a0: 6d28 7374 7228 6e63 6f6c 7329 2929 0d0a  m(str(ncols)))..
-000911b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000911c0: 2020 2020 7365 6c66 2e66 696c 656c 6973      self.filelis
-000911d0: 742e 7365 7449 7465 6d28 636f 756e 742c  t.setItem(count,
-000911e0: 2032 2c20 5174 4775 692e 5154 6162 6c65   2, QtGui.QTable
-000911f0: 5769 6467 6574 4974 656d 2873 7472 286e  WidgetItem(str(n
-00091200: 726f 7773 2929 290d 0a20 2020 2020 2020  rows)))..       
-00091210: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00091220: 662e 6669 6c65 6c69 7374 2e73 6574 4974  f.filelist.setIt
-00091230: 656d 2863 6f75 6e74 2c20 332c 2051 7447  em(count, 3, QtG
-00091240: 7569 2e51 5461 626c 6557 6964 6765 7449  ui.QTableWidgetI
-00091250: 7465 6d28 277b 303a 352e 3266 7d27 2e66  tem('{0:5.2f}'.f
-00091260: 6f72 6d61 7428 6965 7629 2929 0d0a 0d0a  ormat(iev)))....
-00091270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00091280: 2020 2020 636f 756e 7420 2b3d 2031 0d0a      count += 1..
-00091290: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000912a0: 7365 6c66 2e73 6d5f 6669 6c65 7320 3d20  self.sm_files = 
-000912b0: 7365 6c66 2e78 726d 5f66 696c 6573 0d0a  self.xrm_files..
-000912c0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-000912d0: 2e62 696d 5f66 696c 6573 203d 205b 7820  .bim_files = [x 
-000912e0: 666f 7220 7820 696e 206f 732e 6c69 7374  for x in os.list
-000912f0: 6469 7228 6669 6c65 7061 7468 2920 6966  dir(filepath) if
-00091300: 2078 2e65 6e64 7377 6974 6828 272e 6269   x.endswith('.bi
-00091310: 6d27 295d 0d0a 0d0a 0d0a 2020 2020 2020  m')]......      
-00091320: 2020 6966 2073 656c 662e 6269 6d5f 6669    if self.bim_fi
-00091330: 6c65 733a 0d0a 0d0a 2020 2020 2020 2020  les:....        
-00091340: 2020 2020 7365 6c66 2e66 696c 6574 7970      self.filetyp
-00091350: 6520 3d20 2762 696d 270d 0a0d 0a0d 0a0d  e = 'bim'.......
-00091360: 0a20 2020 2020 2020 2020 2020 2063 6f75  .            cou
-00091370: 6e74 203d 2030 0d0a 0d0a 2020 2020 2020  nt = 0....      
-00091380: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-00091390: 616e 6765 286c 656e 2873 656c 662e 6269  ange(len(self.bi
-000913a0: 6d5f 6669 6c65 7329 293a 0d0a 2020 2020  m_files)):..    
-000913b0: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
-000913c0: 6e74 2073 6d5f 6669 6c65 730d 0a20 2020  nt sm_files..   
-000913d0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-000913e0: 656e 616d 6520 3d20 7365 6c66 2e62 696d  ename = self.bim
-000913f0: 5f66 696c 6573 5b69 5d0d 0a20 2020 2020  _files[i]..     
-00091400: 2020 2020 2020 2020 2020 2074 6869 7366             thisf
-00091410: 696c 6520 3d20 6f73 2e70 6174 682e 6a6f  ile = os.path.jo
-00091420: 696e 2866 696c 6570 6174 682c 2066 696c  in(filepath, fil
-00091430: 656e 616d 6529 0d0a 0d0a 2020 2020 2020  ename)....      
-00091440: 2020 2020 2020 2020 2020 6e63 6f6c 732c            ncols,
-00091450: 206e 726f 7773 2c20 6965 7620 3d20 6669   nrows, iev = fi
-00091460: 6c65 5f62 696d 2e72 6561 645f 6269 6d5f  le_bim.read_bim_
-00091470: 696e 666f 2874 6869 7366 696c 6529 0d0a  info(thisfile)..
-00091480: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00091490: 2020 6966 206e 636f 6c73 203e 3020 3a0d    if ncols >0 :.
-000914a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000914b0: 2020 2020 2073 656c 662e 6669 6c65 6c69       self.fileli
-000914c0: 7374 2e69 6e73 6572 7452 6f77 2863 6f75  st.insertRow(cou
-000914d0: 6e74 290d 0a20 2020 2020 2020 2020 2020  nt)..           
-000914e0: 2020 2020 2020 2020 2073 656c 662e 6669           self.fi
-000914f0: 6c65 6c69 7374 2e73 6574 526f 7748 6569  lelist.setRowHei
-00091500: 6768 7428 636f 756e 742c 3230 290d 0a0d  ght(count,20)...
-00091510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00091520: 2020 2020 2073 656c 662e 6669 6c65 6c69       self.fileli
-00091530: 7374 2e73 6574 4974 656d 2863 6f75 6e74  st.setItem(count
-00091540: 2c20 302c 2051 7447 7569 2e51 5461 626c  , 0, QtGui.QTabl
-00091550: 6557 6964 6765 7449 7465 6d28 6669 6c65  eWidgetItem(file
-00091560: 6e61 6d65 2929 0d0a 2020 2020 2020 2020  name))..        
-00091570: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00091580: 2e66 696c 656c 6973 742e 7365 7449 7465  .filelist.setIte
-00091590: 6d28 636f 756e 742c 2031 2c20 5174 4775  m(count, 1, QtGu
-000915a0: 692e 5154 6162 6c65 5769 6467 6574 4974  i.QTableWidgetIt
-000915b0: 656d 2873 7472 286e 636f 6c73 2929 290d  em(str(ncols))).
-000915c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000915d0: 2020 2020 2073 656c 662e 6669 6c65 6c69       self.fileli
-000915e0: 7374 2e73 6574 4974 656d 2863 6f75 6e74  st.setItem(count
-000915f0: 2c20 322c 2051 7447 7569 2e51 5461 626c  , 2, QtGui.QTabl
-00091600: 6557 6964 6765 7449 7465 6d28 7374 7228  eWidgetItem(str(
-00091610: 6e72 6f77 7329 2929 0d0a 2020 2020 2020  nrows)))..      
-00091620: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00091630: 6c66 2e66 696c 656c 6973 742e 7365 7449  lf.filelist.setI
-00091640: 7465 6d28 636f 756e 742c 2033 2c20 5174  tem(count, 3, Qt
-00091650: 4775 692e 5154 6162 6c65 5769 6467 6574  Gui.QTableWidget
-00091660: 4974 656d 2827 7b30 3a35 2e32 667d 272e  Item('{0:5.2f}'.
-00091670: 666f 726d 6174 2869 6576 2929 290d 0a0d  format(iev)))...
-00091680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00091690: 2020 2020 2063 6f75 6e74 202b 3d20 310d       count += 1.
-000916a0: 0a0d 0a0d 0a20 2020 2020 2020 2020 2020  .....           
-000916b0: 2073 656c 662e 736d 5f66 696c 6573 203d   self.sm_files =
-000916c0: 2073 656c 662e 6269 6d5f 6669 6c65 730d   self.bim_files.
-000916d0: 0a0d 0a20 2020 2020 2020 2072 6574 7572  ...        retur
-000916e0: 6e0d 0a0d 0a0d 0a0d 0a23 2d2d 2d2d 2d2d  n........#------
-000916f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00091700: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00091710: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00091720: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00091730: 0d0a 2020 2020 6465 6620 4f6e 4163 6365  ..    def OnAcce
-00091740: 7074 2873 656c 662c 2065 7674 293a 0d0a  pt(self, evt):..
-00091750: 0d0a 2020 2020 2020 2020 5174 5769 6467  ..        QtWidg
-00091760: 6574 732e 5141 7070 6c69 6361 7469 6f6e  ets.QApplication
-00091770: 2e73 6574 4f76 6572 7269 6465 4375 7273  .setOverrideCurs
-00091780: 6f72 2851 7447 7569 2e51 4375 7273 6f72  or(QtGui.QCursor
-00091790: 2851 742e 5761 6974 4375 7273 6f72 2929  (Qt.WaitCursor))
-000917a0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-000917b0: 2e70 6172 656e 742e 6e65 775f 7374 6163  .parent.new_stac
-000917c0: 6b5f 7265 6672 6573 6828 290d 0a20 2020  k_refresh()..   
-000917d0: 2020 2020 2073 656c 662e 7374 6b2e 6e65       self.stk.ne
-000917e0: 775f 6461 7461 2829 0d0a 0d0a 2020 2020  w_data()....    
-000917f0: 2020 2020 696e 6431 7374 203d 2073 656c      ind1st = sel
-00091800: 662e 736d 5f66 696c 6573 2e69 6e64 6578  f.sm_files.index
-00091810: 2873 656c 662e 6669 6c65 3173 7429 0d0a  (self.file1st)..
-00091820: 2020 2020 2020 2020 696e 646c 6173 7420          indlast 
-00091830: 3d20 7365 6c66 2e73 6d5f 6669 6c65 732e  = self.sm_files.
-00091840: 696e 6465 7828 7365 6c66 2e66 696c 656c  index(self.filel
-00091850: 6173 7429 0d0a 0d0a 2020 2020 2020 2020  ast)....        
-00091860: 6669 6c65 6c69 7374 203d 2073 656c 662e  filelist = self.
-00091870: 736d 5f66 696c 6573 5b69 6e64 3173 743a  sm_files[ind1st:
-00091880: 696e 646c 6173 742b 315d 0d0a 0d0a 0d0a  indlast+1]......
-00091890: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000918a0: 6669 6c65 7479 7065 203d 3d20 2773 6d27  filetype == 'sm'
-000918b0: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-000918c0: 726f 6d20 6669 6c65 5f70 6c75 6769 6e73  rom file_plugins
-000918d0: 2069 6d70 6f72 7420 6669 6c65 5f73 6d5f   import file_sm_
-000918e0: 6e65 7463 6466 0d0a 2020 2020 2020 2020  netcdf..        
-000918f0: 2020 2020 6669 6c65 5f73 6d5f 6e65 7463      file_sm_netc
-00091900: 6466 2e72 6561 645f 736d 5f6c 6973 7428  df.read_sm_list(
-00091910: 7365 6c66 2c20 6669 6c65 6c69 7374 2c20  self, filelist, 
-00091920: 7365 6c66 2e66 696c 6570 6174 682c 2073  self.filepath, s
-00091930: 656c 662e 6461 7461 5f73 7472 7563 7429  elf.data_struct)
-00091940: 0d0a 2020 2020 2020 2020 656c 6966 2073  ..        elif s
-00091950: 656c 662e 6669 6c65 7479 7065 203d 3d20  elf.filetype == 
-00091960: 2778 726d 273a 0d0a 2020 2020 2020 2020  'xrm':..        
-00091970: 2020 2020 6669 6c65 5f78 726d 2e72 6561      file_xrm.rea
-00091980: 645f 7872 6d5f 6c69 7374 2873 656c 662c  d_xrm_list(self,
-00091990: 2066 696c 656c 6973 742c 2073 656c 662e   filelist, self.
-000919a0: 6669 6c65 7061 7468 2c20 7365 6c66 2e64  filepath, self.d
-000919b0: 6174 615f 7374 7275 6374 290d 0a20 2020  ata_struct)..   
-000919c0: 2020 2020 2065 6c69 6620 7365 6c66 2e66       elif self.f
-000919d0: 696c 6574 7970 6520 3d3d 2027 6269 6d27  iletype == 'bim'
-000919e0: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-000919f0: 696c 655f 6269 6d2e 7265 6164 5f62 696d  ile_bim.read_bim
-00091a00: 5f6c 6973 7428 7365 6c66 2c20 6669 6c65  _list(self, file
-00091a10: 6c69 7374 2c20 7365 6c66 2e66 696c 6570  list, self.filep
-00091a20: 6174 682c 2073 656c 662e 6461 7461 5f73  ath, self.data_s
-00091a30: 7472 7563 7429 0d0a 2020 2020 2020 2020  truct)..        
-00091a40: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00091a50: 2020 2070 7269 6e74 2827 5772 6f6e 6720     print('Wrong 
-00091a60: 6669 6c65 2074 7970 6527 290d 0a20 2020  file type')..   
-00091a70: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
-00091a80: 0a0d 0a0d 0a20 2020 2020 2020 2023 6669  .....        #fi
-00091a90: 6c6c 2074 6865 2067 7569 2073 7472 7563  ll the gui struc
-00091aa0: 7475 7265 2064 6174 610d 0a20 2020 2020  ture data..     
-00091ab0: 2020 2073 656c 662e 7374 6b2e 6162 7364     self.stk.absd
-00091ac0: 6174 6120 3d20 7365 6c66 2e64 6174 615f  ata = self.data_
-00091ad0: 7374 7275 6374 2e65 7863 6861 6e67 652e  struct.exchange.
-00091ae0: 6461 7461 0d0a 0d0a 2020 2020 2020 2020  data....        
-00091af0: 6461 7461 6469 6d20 3d20 6e70 2e69 6e74  datadim = np.int
-00091b00: 3332 2873 656c 662e 7374 6b2e 6162 7364  32(self.stk.absd
-00091b10: 6174 612e 7368 6170 6529 0d0a 2020 2020  ata.shape)..    
-00091b20: 2020 2020 7365 6c66 2e73 746b 2e6e 5f63      self.stk.n_c
-00091b30: 6f6c 7320 3d20 6461 7461 6469 6d5b 305d  ols = datadim[0]
-00091b40: 2e63 6f70 7928 290d 0a20 2020 2020 2020  .copy()..       
-00091b50: 2073 656c 662e 7374 6b2e 6e5f 726f 7773   self.stk.n_rows
-00091b60: 203d 2020 6461 7461 6469 6d5b 315d 2e63   =  datadim[1].c
-00091b70: 6f70 7928 290d 0a20 2020 2020 2020 2073  opy()..        s
-00091b80: 656c 662e 7374 6b2e 6576 203d 2073 656c  elf.stk.ev = sel
-00091b90: 662e 6461 7461 5f73 7472 7563 742e 6578  f.data_struct.ex
-00091ba0: 6368 616e 6765 2e65 6e65 7267 790d 0a20  change.energy.. 
-00091bb0: 2020 2020 2020 2073 656c 662e 7374 6b2e         self.stk.
-00091bc0: 6e5f 6576 203d 206e 702e 696e 7433 3228  n_ev = np.int32(
-00091bd0: 7365 6c66 2e73 746b 2e65 762e 7368 6170  self.stk.ev.shap
-00091be0: 655b 305d 292e 636f 7079 2829 0d0a 0d0a  e[0]).copy()....
-00091bf0: 2020 2020 2020 2020 6e70 6978 656c 7320          npixels 
-00091c00: 3d20 7365 6c66 2e73 746b 2e6e 5f63 6f6c  = self.stk.n_col
-00091c10: 732a 7365 6c66 2e73 746b 2e6e 5f72 6f77  s*self.stk.n_row
-00091c20: 732a 7365 6c66 2e73 746b 2e6e 5f65 760d  s*self.stk.n_ev.
-00091c30: 0a0d 0a0d 0a20 2020 2020 2020 2073 656c  .....        sel
-00091c40: 662e 7374 6b2e 785f 6469 7374 203d 2073  f.stk.x_dist = s
-00091c50: 656c 662e 6461 7461 5f73 7472 7563 742e  elf.data_struct.
-00091c60: 6578 6368 616e 6765 2e78 0d0a 2020 2020  exchange.x..    
-00091c70: 2020 2020 7365 6c66 2e73 746b 2e79 5f64      self.stk.y_d
-00091c80: 6973 7420 3d20 7365 6c66 2e64 6174 615f  ist = self.data_
-00091c90: 7374 7275 6374 2e65 7863 6861 6e67 652e  struct.exchange.
-00091ca0: 790d 0a0d 0a20 2020 2020 2020 2073 656c  y....        sel
-00091cb0: 662e 7374 6b2e 6461 7461 5f64 7765 6c6c  f.stk.data_dwell
-00091cc0: 203d 2073 656c 662e 6461 7461 5f73 7472   = self.data_str
-00091cd0: 7563 742e 7370 6563 7472 6f6d 6963 726f  uct.spectromicro
-00091ce0: 7363 6f70 792e 6461 7461 5f64 7765 6c6c  scopy.data_dwell
-00091cf0: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7365  ......        se
-00091d00: 6c66 2e73 746b 2e66 696c 6c5f 6835 5f73  lf.stk.fill_h5_s
-00091d10: 7472 7563 745f 6672 6f6d 5f73 746b 2829  truct_from_stk()
+0008f3c0: 2020 2020 2020 2020 2020 2020 2020 7369                si
+0008f3d0: 7a65 3d27 3130 7074 2729 0d0a 2020 2020  ze='10pt')..    
+0008f3e0: 2020 2020 2020 2020 656c 6966 206c 656e          elif len
+0008f3f0: 2870 7265 6964 7820 2b20 706f 7374 6964  (preidx + postid
+0008f400: 7829 203c 3d20 363a 0d0a 2020 2020 2020  x) <= 6:..      
+0008f410: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0008f420: 322e 7469 746c 654c 6162 656c 2e73 6574  2.titleLabel.set
+0008f430: 5465 7874 2822 3c63 656e 7465 723e 4d61  Text("<center>Ma
+0008f440: 7020 6672 6f6d 2065 6e65 7267 6965 7320  p from energies 
+0008f450: 2220 2b20 7374 7228 5b72 6f75 6e64 2873  " + str([round(s
+0008f460: 656c 662e 7374 6b2e 6576 5b65 5d2c 2032  elf.stk.ev[e], 2
+0008f470: 2920 666f 7220 6520 696e 2070 7265 6964  ) for e in preid
+0008f480: 785d 292e 7374 7269 7028 275b 5d27 2920  x]).strip('[]') 
+0008f490: 2b20 2220 616e 6420 2220 2b0d 0a20 2020  + " and " +..   
+0008f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008f4b0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+0008f4c0: 7228 5b72 6f75 6e64 2873 656c 662e 7374  r([round(self.st
+0008f4d0: 6b2e 6576 5b65 5d2c 2032 2920 666f 7220  k.ev[e], 2) for 
+0008f4e0: 6520 696e 2070 6f73 7469 6478 5d29 2e73  e in postidx]).s
+0008f4f0: 7472 6970 2827 5b5d 2729 202b 2022 2065  trip('[]') + " e
+0008f500: 563c 2f63 656e 7465 723e 222c 0d0a 2020  V</center>",..  
+0008f510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008f520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008f530: 2020 2020 2020 2020 2073 697a 653d 2731           size='1
+0008f540: 3070 7427 290d 0a20 2020 2020 2020 2020  0pt')..         
+0008f550: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0008f560: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0008f570: 322e 7469 746c 654c 6162 656c 2e73 6574  2.titleLabel.set
+0008f580: 5465 7874 2822 3c63 656e 7465 723e 4d61  Text("<center>Ma
+0008f590: 7020 6672 6f6d 2022 2b20 7374 7228 6c65  p from "+ str(le
+0008f5a0: 6e28 7072 6569 6478 202b 2070 6f73 7469  n(preidx + posti
+0008f5b0: 6478 2929 202b 2220 656e 6572 6769 6573  dx)) +" energies
+0008f5c0: 3a20 2220 2b20 7374 7228 726f 756e 6428  : " + str(round(
+0008f5d0: 7365 6c66 2e73 746b 2e65 765b 7072 6569  self.stk.ev[prei
+0008f5e0: 6478 5b30 5d5d 2c20 3229 2920 2b20 2720  dx[0]], 2)) + ' 
+0008f5f0: 2e2e 2e20 2720 2b20 7374 7228 726f 756e  ... ' + str(roun
+0008f600: 6428 7365 6c66 2e73 746b 2e65 765b 7072  d(self.stk.ev[pr
+0008f610: 6569 6478 5b2d 315d 5d2c 2032 2929 202b  eidx[-1]], 2)) +
+0008f620: 2022 2061 6e64 2022 0d0a 2020 2020 2020   " and "..      
+0008f630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008f640: 2020 2020 2020 2020 2020 202b 2073 7472             + str
+0008f650: 2872 6f75 6e64 2873 656c 662e 7374 6b2e  (round(self.stk.
+0008f660: 6576 5b70 6f73 7469 6478 5b30 5d5d 2c20  ev[postidx[0]], 
+0008f670: 3229 2920 2b20 2720 2e2e 2e20 2720 2b20  2)) + ' ... ' + 
+0008f680: 7374 7228 726f 756e 6428 7365 6c66 2e73  str(round(self.s
+0008f690: 746b 2e65 765b 706f 7374 6964 785b 2d31  tk.ev[postidx[-1
+0008f6a0: 5d5d 2c20 3229 2920 2b20 2220 6556 3c2f  ]], 2)) + " eV</
+0008f6b0: 6365 6e74 6572 3e22 2c0d 0a20 2020 2020  center>",..     
+0008f6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008f6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0008f6e0: 2020 2020 2020 7369 7a65 3d27 3130 7074        size='10pt
+0008f6f0: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
+0008f700: 7365 6c66 2e4f 4420 3d20 7365 6c66 2e43  self.OD = self.C
+0008f710: 616c 634f 444d 6170 2870 7265 6964 782c  alcODMap(preidx,
+0008f720: 2070 6f73 7469 6478 290d 0a20 2020 2020   postidx)..     
+0008f730: 2020 2020 2020 2069 6620 7365 6c66 2e66         if self.f
+0008f740: 696c 7465 7253 7069 6e42 6f78 2e76 616c  ilterSpinBox.val
+0008f750: 7565 2829 203e 2031 3a0d 0a20 2020 2020  ue() > 1:..     
+0008f760: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0008f770: 4f44 203d 206e 6469 6d61 6765 2e66 696c  OD = ndimage.fil
+0008f780: 7465 7273 2e75 6e69 666f 726d 5f66 696c  ters.uniform_fil
+0008f790: 7465 7228 7365 6c66 2e4f 442c 2073 697a  ter(self.OD, siz
+0008f7a0: 653d 7365 6c66 2e66 696c 7465 7253 7069  e=self.filterSpi
+0008f7b0: 6e42 6f78 2e76 616c 7565 2829 2c20 6d6f  nBox.value(), mo
+0008f7c0: 6465 3d27 6e65 6172 6573 7427 290d 0a20  de='nearest').. 
+0008f7d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0008f7e0: 4f44 6d69 6e20 3d20 6e70 2e6d 696e 2873  ODmin = np.min(s
+0008f7f0: 656c 662e 4f44 290d 0a20 2020 2020 2020  elf.OD)..       
+0008f800: 2020 2020 2073 656c 662e 4f44 6d61 7820       self.ODmax 
+0008f810: 3d20 6e70 2e6d 6178 2873 656c 662e 4f44  = np.max(self.OD
+0008f820: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0008f830: 656c 662e 4f44 4869 6768 5370 696e 426f  elf.ODHighSpinBo
+0008f840: 782e 7365 7445 6e61 626c 6564 2854 7275  x.setEnabled(Tru
+0008f850: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0008f860: 7365 6c66 2e4f 444c 6f77 5370 696e 426f  self.ODLowSpinBo
+0008f870: 782e 7365 7445 6e61 626c 6564 2854 7275  x.setEnabled(Tru
+0008f880: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0008f890: 7365 6c66 2e4f 4448 6967 6853 7069 6e42  self.ODHighSpinB
+0008f8a0: 6f78 2e62 6c6f 636b 5369 676e 616c 7328  ox.blockSignals(
+0008f8b0: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
+0008f8c0: 2020 2073 656c 662e 4f44 4c6f 7753 7069     self.ODLowSpi
+0008f8d0: 6e42 6f78 2e62 6c6f 636b 5369 676e 616c  nBox.blockSignal
+0008f8e0: 7328 5472 7565 290d 0a20 2020 2020 2020  s(True)..       
+0008f8f0: 2020 2020 2073 656c 662e 4f44 4869 6768       self.ODHigh
+0008f900: 5370 696e 426f 782e 7365 744d 6178 696d  SpinBox.setMaxim
+0008f910: 756d 2873 656c 662e 4f44 6d61 7829 0d0a  um(self.ODmax)..
+0008f920: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0008f930: 2e4f 4448 6967 6853 7069 6e42 6f78 2e73  .ODHighSpinBox.s
+0008f940: 6574 4d69 6e69 6d75 6d28 7365 6c66 2e4f  etMinimum(self.O
+0008f950: 446d 696e 290d 0a20 2020 2020 2020 2020  Dmin)..         
+0008f960: 2020 2073 656c 662e 4f44 4c6f 7753 7069     self.ODLowSpi
+0008f970: 6e42 6f78 2e73 6574 4d61 7869 6d75 6d28  nBox.setMaximum(
+0008f980: 7365 6c66 2e4f 446d 6178 290d 0a20 2020  self.ODmax)..   
+0008f990: 2020 2020 2020 2020 2073 656c 662e 4f44           self.OD
+0008f9a0: 4c6f 7753 7069 6e42 6f78 2e73 6574 4d69  LowSpinBox.setMi
+0008f9b0: 6e69 6d75 6d28 7365 6c66 2e4f 446d 696e  nimum(self.ODmin
+0008f9c0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0008f9d0: 656c 662e 4f44 4c6f 7753 7069 6e42 6f78  elf.ODLowSpinBox
+0008f9e0: 2e73 6574 5661 6c75 6528 7365 6c66 2e4f  .setValue(self.O
+0008f9f0: 446d 696e 290d 0a20 2020 2020 2020 2020  Dmin)..         
+0008fa00: 2020 2073 656c 662e 4f44 4869 6768 5370     self.ODHighSp
+0008fa10: 696e 426f 782e 7365 7456 616c 7565 2873  inBox.setValue(s
+0008fa20: 656c 662e 4f44 6d61 7829 0d0a 2020 2020  elf.ODmax)..    
+0008fa30: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
+0008fa40: 4f44 6c69 6d69 7473 2873 656c 662e 4f44  ODlimits(self.OD
+0008fa50: 6d69 6e2c 2073 656c 662e 4f44 6d61 7829  min, self.ODmax)
+0008fa60: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0008fa70: 6c66 2e4f 4448 6967 6853 7069 6e42 6f78  lf.ODHighSpinBox
+0008fa80: 2e62 6c6f 636b 5369 676e 616c 7328 4661  .blockSignals(Fa
+0008fa90: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
+0008faa0: 2020 7365 6c66 2e4f 444c 6f77 5370 696e    self.ODLowSpin
+0008fab0: 426f 782e 626c 6f63 6b53 6967 6e61 6c73  Box.blockSignals
+0008fac0: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
+0008fad0: 2020 2020 2073 656c 662e 7062 5253 544f       self.pbRSTO
+0008fae0: 442e 7365 7445 6e61 626c 6564 2854 7275  D.setEnabled(Tru
+0008faf0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0008fb00: 7365 6c66 2e66 696c 7465 7253 7069 6e42  self.filterSpinB
+0008fb10: 6f78 2e73 6574 456e 6162 6c65 6428 5472  ox.setEnabled(Tr
+0008fb20: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
+0008fb30: 2073 656c 662e 7062 4578 7044 6174 612e   self.pbExpData.
+0008fb40: 7365 7445 6e61 626c 6564 2854 7275 6529  setEnabled(True)
+0008fb50: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0008fb60: 6c66 2e70 6245 7870 496d 672e 7365 7445  lf.pbExpImg.setE
+0008fb70: 6e61 626c 6564 2854 7275 6529 0d0a 2020  nabled(True)..  
+0008fb80: 2020 2020 2020 2020 2020 2373 656c 662e            #self.
+0008fb90: 7067 6c61 796f 7574 2e6c 6179 6f75 742e  pglayout.layout.
+0008fba0: 7365 7443 6f6c 756d 6e4d 6178 696d 756d  setColumnMaximum
+0008fbb0: 5769 6474 6828 312c 2073 656c 662e 7031  Width(1, self.p1
+0008fbc0: 2e77 6964 7468 2829 290d 0a20 2020 2020  .width())..     
+0008fbd0: 2020 2065 7863 6570 7420 496e 6465 7845     except IndexE
+0008fbe0: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
+0008fbf0: 2020 2073 656c 662e 7032 2e63 6c65 6172     self.p2.clear
+0008fc00: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0008fc10: 7365 6c66 2e63 6d2e 636c 6561 7228 290d  self.cm.clear().
+0008fc20: 0a20 2020 2020 2020 2020 2020 2023 7365  .            #se
+0008fc30: 6c66 2e70 322e 7365 7454 6974 6c65 2822  lf.p2.setTitle("
+0008fc40: 506c 6561 7365 2073 656c 6563 7420 6120  Please select a 
+0008fc50: 7365 636f 6e64 2069 6d61 6765 2122 290d  second image!").
+0008fc60: 0a20 2020 2020 2020 2020 2020 2023 7072  .            #pr
+0008fc70: 696e 7428 2253 656c 6563 7420 6120 7365  int("Select a se
+0008fc80: 636f 6e64 2069 6d61 6765 2122 290d 0a0d  cond image!")...
+0008fc90: 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  .#--------------
+0008fca0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0008fcb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0008fcc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0008fcd0: 2d2d 2d2d 2d2d 2d2d 0d0a 636c 6173 7320  --------..class 
+0008fce0: 5374 6163 6b4c 6973 7446 7261 6d65 2851  StackListFrame(Q
+0008fcf0: 7457 6964 6765 7473 2e51 4469 616c 6f67  tWidgets.QDialog
+0008fd00: 293a 0d0a 0d0a 2020 2020 6465 6620 5f5f  ):....    def __
+0008fd10: 696e 6974 5f5f 2873 656c 662c 2070 6172  init__(self, par
+0008fd20: 656e 742c 2066 696c 6570 6174 682c 2063  ent, filepath, c
+0008fd30: 6f6d 2c20 7374 6163 6b2c 2064 6174 615f  om, stack, data_
+0008fd40: 7374 7275 6374 293a 0d0a 2020 2020 2020  struct):..      
+0008fd50: 2020 5174 5769 6467 6574 732e 5157 6964    QtWidgets.QWid
+0008fd60: 6765 742e 5f5f 696e 6974 5f5f 2873 656c  get.__init__(sel
+0008fd70: 662c 2070 6172 656e 7429 0d0a 0d0a 2020  f, parent)....  
+0008fd80: 2020 2020 2020 7365 6c66 2e70 6172 656e        self.paren
+0008fd90: 7420 3d20 7061 7265 6e74 0d0a 0d0a 2020  t = parent....  
+0008fda0: 2020 2020 2020 7365 6c66 2e64 6174 615f        self.data_
+0008fdb0: 7374 7275 6374 203d 2064 6174 615f 7374  struct = data_st
+0008fdc0: 7275 6374 0d0a 2020 2020 2020 2020 7365  ruct..        se
+0008fdd0: 6c66 2e73 746b 203d 2073 7461 636b 0d0a  lf.stk = stack..
+0008fde0: 2020 2020 2020 2020 7365 6c66 2e63 6f6d          self.com
+0008fdf0: 6d6f 6e20 3d20 636f 6d0d 0a0d 0a20 2020  mon = com....   
+0008fe00: 2020 2020 2073 656c 662e 7265 7369 7a65       self.resize
+0008fe10: 2836 3030 2c20 3530 3029 0d0a 2020 2020  (600, 500)..    
+0008fe20: 2020 2020 7365 6c66 2e73 6574 5769 6e64      self.setWind
+0008fe30: 6f77 5469 746c 6528 2753 7461 636b 2046  owTitle('Stack F
+0008fe40: 696c 6520 4c69 7374 2729 0d0a 0d0a 2020  ile List')....  
+0008fe50: 2020 2020 2020 7061 6c20 3d20 5174 4775        pal = QtGu
+0008fe60: 692e 5150 616c 6574 7465 2829 0d0a 2020  i.QPalette()..  
+0008fe70: 2020 2020 2020 7365 6c66 2e73 6574 4175        self.setAu
+0008fe80: 746f 4669 6c6c 4261 636b 6772 6f75 6e64  toFillBackground
+0008fe90: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
+0008fea0: 7061 6c2e 7365 7443 6f6c 6f72 2851 7447  pal.setColor(QtG
+0008feb0: 7569 2e51 5061 6c65 7474 652e 5769 6e64  ui.QPalette.Wind
+0008fec0: 6f77 2c51 7447 7569 2e51 436f 6c6f 7228  ow,QtGui.QColor(
+0008fed0: 2777 6869 7465 2729 290d 0a20 2020 2020  'white'))..     
+0008fee0: 2020 2073 656c 662e 7365 7450 616c 6574     self.setPalet
+0008fef0: 7465 2870 616c 290d 0a0d 0a20 2020 2020  te(pal)....     
+0008ff00: 2020 2073 656c 662e 6669 6c65 7061 7468     self.filepath
+0008ff10: 203d 2073 7472 2866 696c 6570 6174 6829   = str(filepath)
+0008ff20: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+0008ff30: 2e68 6176 6531 7374 203d 2030 0d0a 2020  .have1st = 0..  
+0008ff40: 2020 2020 2020 7365 6c66 2e68 6176 656c        self.havel
+0008ff50: 6173 7420 3d20 300d 0a20 2020 2020 2020  ast = 0..       
+0008ff60: 2073 656c 662e 6669 6c65 3173 7420 3d20   self.file1st = 
+0008ff70: 2720 270d 0a20 2020 2020 2020 2073 656c  ' '..        sel
+0008ff80: 662e 6669 6c65 6c61 7374 203d 2027 2027  f.filelast = ' '
+0008ff90: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+0008ffa0: 2e66 696c 6574 7970 6520 3d20 2727 0d0a  .filetype = ''..
+0008ffb0: 0d0a 2020 2020 2020 2020 7662 6f78 203d  ..        vbox =
+0008ffc0: 2051 7457 6964 6765 7473 2e51 5642 6f78   QtWidgets.QVBox
+0008ffd0: 4c61 796f 7574 2829 0d0a 0d0a 2020 2020  Layout()....    
+0008ffe0: 2020 2020 7365 6c66 2e74 6578 7474 203d      self.textt =
+0008fff0: 2051 7457 6964 6765 7473 2e51 4c61 6265   QtWidgets.QLabe
+00090000: 6c28 7365 6c66 290d 0a20 2020 2020 2020  l(self)..       
+00090010: 2073 656c 662e 7465 7874 742e 7365 7454   self.textt.setT
+00090020: 6578 7428 2753 656c 6563 7420 6669 7273  ext('Select firs
+00090030: 7420 7374 6163 6b20 6669 6c65 2729 0d0a  t stack file')..
+00090040: 0d0a 2020 2020 2020 2020 7662 6f78 2e61  ..        vbox.a
+00090050: 6464 5374 7265 7463 6828 3129 0d0a 2020  ddStretch(1)..  
+00090060: 2020 2020 2020 7662 6f78 2e61 6464 5769        vbox.addWi
+00090070: 6467 6574 2873 656c 662e 7465 7874 7429  dget(self.textt)
+00090080: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7365  ......        se
+00090090: 6c66 2e66 696c 656c 6973 7420 3d20 5174  lf.filelist = Qt
+000900a0: 4775 692e 5154 6162 6c65 5769 6467 6574  Gui.QTableWidget
+000900b0: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+000900c0: 2e66 696c 656c 6973 742e 7365 744d 696e  .filelist.setMin
+000900d0: 696d 756d 4865 6967 6874 2834 3530 290d  imumHeight(450).
+000900e0: 0a20 2020 2020 2020 2073 656c 662e 6669  .        self.fi
+000900f0: 6c65 6c69 7374 2e73 6574 436f 6c75 6d6e  lelist.setColumn
+00090100: 436f 756e 7428 3429 0d0a 2020 2020 2020  Count(4)..      
+00090110: 2020 7365 6c66 2e66 696c 656c 6973 742e    self.filelist.
+00090120: 7365 7448 6f72 697a 6f6e 7461 6c48 6561  setHorizontalHea
+00090130: 6465 724c 6162 656c 7328 2827 4669 6c65  derLabels(('File
+00090140: 206c 6973 7427 2c20 2758 272c 2027 5927   list', 'X', 'Y'
+00090150: 2c20 2765 5627 2929 0d0a 2020 2020 2020  , 'eV'))..      
+00090160: 2020 7365 6c66 2e66 696c 656c 6973 742e    self.filelist.
+00090170: 7365 7453 686f 7747 7269 6428 4661 6c73  setShowGrid(Fals
+00090180: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
+00090190: 2e66 696c 656c 6973 742e 7665 7274 6963  .filelist.vertic
+000901a0: 616c 4865 6164 6572 2829 2e73 6574 5669  alHeader().setVi
+000901b0: 7369 626c 6528 4661 6c73 6529 0d0a 0d0a  sible(False)....
+000901c0: 2020 2020 2020 2020 7365 6c66 2e66 696c          self.fil
+000901d0: 656c 6973 742e 7365 7443 6f6c 756d 6e57  elist.setColumnW
+000901e0: 6964 7468 2830 2c34 3030 290d 0a20 2020  idth(0,400)..   
+000901f0: 2020 2020 2073 656c 662e 6669 6c65 6c69       self.fileli
+00090200: 7374 2e73 6574 436f 6c75 6d6e 5769 6474  st.setColumnWidt
+00090210: 6828 312c 3530 290d 0a20 2020 2020 2020  h(1,50)..       
+00090220: 2073 656c 662e 6669 6c65 6c69 7374 2e73   self.filelist.s
+00090230: 6574 436f 6c75 6d6e 5769 6474 6828 322c  etColumnWidth(2,
+00090240: 3530 290d 0a20 2020 2020 2020 2073 656c  50)..        sel
+00090250: 662e 6669 6c65 6c69 7374 2e73 6574 436f  f.filelist.setCo
+00090260: 6c75 6d6e 5769 6474 6828 332c 3530 290d  lumnWidth(3,50).
+00090270: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00090280: 6669 6c65 6c69 7374 2e73 6574 526f 7743  filelist.setRowC
+00090290: 6f75 6e74 2830 290d 0a0d 0a20 2020 2020  ount(0)....     
+000902a0: 2020 2073 656c 662e 6669 6c65 6c69 7374     self.filelist
+000902b0: 2e63 656c 6c43 6c69 636b 6564 2e63 6f6e  .cellClicked.con
+000902c0: 6e65 6374 2873 656c 662e 4f6e 4669 6c65  nect(self.OnFile
+000902d0: 4c69 7374 290d 0a0d 0a0d 0a0d 0a20 2020  List)........   
+000902e0: 2020 2020 2076 626f 782e 6164 6457 6964       vbox.addWid
+000902f0: 6765 7428 7365 6c66 2e66 696c 656c 6973  get(self.filelis
+00090300: 7429 0d0a 2020 2020 2020 2020 7662 6f78  t)..        vbox
+00090310: 2e61 6464 5374 7265 7463 6828 3129 0d0a  .addStretch(1)..
+00090320: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
+00090330: 635f 6669 7273 7420 3d20 5174 5769 6467  c_first = QtWidg
+00090340: 6574 732e 514c 6162 656c 2873 656c 6629  ets.QLabel(self)
+00090350: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
+00090360: 635f 6669 7273 742e 7365 7454 6578 7428  c_first.setText(
+00090370: 2746 6972 7374 2073 7461 636b 2066 696c  'First stack fil
+00090380: 653a 2027 290d 0a20 2020 2020 2020 2073  e: ')..        s
+00090390: 656c 662e 7463 5f6c 6173 7420 3d20 5174  elf.tc_last = Qt
+000903a0: 5769 6467 6574 732e 514c 6162 656c 2873  Widgets.QLabel(s
+000903b0: 656c 6629 0d0a 2020 2020 2020 2020 7365  elf)..        se
+000903c0: 6c66 2e74 635f 6c61 7374 2e73 6574 5465  lf.tc_last.setTe
+000903d0: 7874 2827 4c61 7374 2073 7461 636b 2066  xt('Last stack f
+000903e0: 696c 653a 2027 290d 0a0d 0a0d 0a20 2020  ile: ')......   
+000903f0: 2020 2020 2076 626f 782e 6164 6457 6964       vbox.addWid
+00090400: 6765 7428 7365 6c66 2e74 635f 6669 7273  get(self.tc_firs
+00090410: 7429 0d0a 2020 2020 2020 2020 7662 6f78  t)..        vbox
+00090420: 2e61 6464 5769 6467 6574 2873 656c 662e  .addWidget(self.
+00090430: 7463 5f6c 6173 7429 0d0a 2020 2020 2020  tc_last)..      
+00090440: 2020 7662 6f78 2e61 6464 5374 7265 7463    vbox.addStretc
+00090450: 6828 3129 0d0a 0d0a 0d0a 2020 2020 2020  h(1)......      
+00090460: 2020 6862 6f78 203d 2051 7457 6964 6765    hbox = QtWidge
+00090470: 7473 2e51 4842 6f78 4c61 796f 7574 2829  ts.QHBoxLayout()
+00090480: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7365  ......        se
+00090490: 6c66 2e62 7574 746f 6e5f 6163 6365 7074  lf.button_accept
+000904a0: 203d 2051 7457 6964 6765 7473 2e51 5075   = QtWidgets.QPu
+000904b0: 7368 4275 7474 6f6e 2827 4163 6365 7074  shButton('Accept
+000904c0: 2729 0d0a 2020 2020 2020 2020 2373 656c  ')..        #sel
+000904d0: 662e 6275 7474 6f6e 5f61 6363 6570 742e  f.button_accept.
+000904e0: 7365 7445 6e61 626c 6564 2846 616c 7365  setEnabled(False
+000904f0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00090500: 6275 7474 6f6e 5f61 6363 6570 742e 636c  button_accept.cl
+00090510: 6963 6b65 642e 636f 6e6e 6563 7428 2073  icked.connect( s
+00090520: 656c 662e 4f6e 4163 6365 7074 290d 0a20  elf.OnAccept).. 
+00090530: 2020 2020 2020 2068 626f 782e 6164 6457         hbox.addW
+00090540: 6964 6765 7428 7365 6c66 2e62 7574 746f  idget(self.butto
+00090550: 6e5f 6163 6365 7074 290d 0a0d 0a20 2020  n_accept)....   
+00090560: 2020 2020 2062 7574 746f 6e5f 6361 6e63       button_canc
+00090570: 656c 203d 2051 7457 6964 6765 7473 2e51  el = QtWidgets.Q
+00090580: 5075 7368 4275 7474 6f6e 2827 4361 6e63  PushButton('Canc
+00090590: 656c 2729 0d0a 2020 2020 2020 2020 6275  el')..        bu
+000905a0: 7474 6f6e 5f63 616e 6365 6c2e 636c 6963  tton_cancel.clic
+000905b0: 6b65 642e 636f 6e6e 6563 7428 2073 656c  ked.connect( sel
+000905c0: 662e 636c 6f73 6529 0d0a 2020 2020 2020  f.close)..      
+000905d0: 2020 6862 6f78 2e61 6464 5769 6467 6574    hbox.addWidget
+000905e0: 2862 7574 746f 6e5f 6361 6e63 656c 290d  (button_cancel).
+000905f0: 0a0d 0a20 2020 2020 2020 2076 626f 782e  ...        vbox.
+00090600: 6164 644c 6179 6f75 7428 6862 6f78 290d  addLayout(hbox).
+00090610: 0a0d 0a20 2020 2020 2020 2076 626f 782e  ...        vbox.
+00090620: 6164 6453 7472 6574 6368 2830 2e35 290d  addStretch(0.5).
+00090630: 0a0d 0a0d 0a20 2020 2020 2020 2073 656c  .....        sel
+00090640: 662e 7365 744c 6179 6f75 7428 7662 6f78  f.setLayout(vbox
+00090650: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+00090660: 662e 5368 6f77 4669 6c65 4c69 7374 2829  f.ShowFileList()
+00090670: 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d  ....#-----------
+00090680: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00090690: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000906a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000906b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020  -----------..   
+000906c0: 2064 6566 204f 6e46 696c 654c 6973 7428   def OnFileList(
+000906d0: 7365 6c66 2c20 726f 772c 2063 6f6c 756d  self, row, colum
+000906e0: 6e29 3a0d 0a0d 0a0d 0a20 2020 2020 2020  n):......       
+000906f0: 2069 6620 2873 656c 662e 6861 7665 3173   if (self.have1s
+00090700: 7420 3d3d 2031 2920 616e 6420 2873 656c  t == 1) and (sel
+00090710: 662e 6861 7665 6c61 7374 3d3d 3129 3a0d  f.havelast==1):.
+00090720: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00090730: 662e 6861 7665 3173 7420 3d20 300d 0a20  f.have1st = 0.. 
+00090740: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00090750: 6861 7665 6c61 7374 203d 2030 0d0a 2020  havelast = 0..  
+00090760: 2020 2020 2020 2020 2020 2373 656c 662e            #self.
+00090770: 6275 7474 6f6e 5f61 6363 6570 742e 7365  button_accept.se
+00090780: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
+00090790: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000907a0: 662e 7463 5f66 6972 7374 2e73 6574 5465  f.tc_first.setTe
+000907b0: 7874 2827 4669 7273 7420 7374 6163 6b20  xt('First stack 
+000907c0: 6669 6c65 3a20 2729 0d0a 2020 2020 2020  file: ')..      
+000907d0: 2020 2020 2020 7365 6c66 2e74 635f 6c61        self.tc_la
+000907e0: 7374 2e73 6574 5465 7874 2827 4c61 7374  st.setText('Last
+000907f0: 2073 7461 636b 2066 696c 653a 2027 290d   stack file: ').
+00090800: 0a0d 0a20 2020 2020 2020 2069 7465 6d20  ...        item 
+00090810: 3d20 7365 6c66 2e66 696c 656c 6973 742e  = self.filelist.
+00090820: 6974 656d 2872 6f77 2c20 3029 0d0a 2020  item(row, 0)..  
+00090830: 2020 2020 2020 666e 203d 2020 6974 656d        fn =  item
+00090840: 2e74 6578 7428 290d 0a20 2020 2020 2020  .text()..       
+00090850: 2069 6620 7365 6c66 2e68 6176 6531 7374   if self.have1st
+00090860: 203d 3d20 303a 0d0a 2020 2020 2020 2020   == 0:..        
+00090870: 2020 2020 7365 6c66 2e74 635f 6669 7273      self.tc_firs
+00090880: 742e 7365 7454 6578 7428 2746 6972 7374  t.setText('First
+00090890: 2073 7461 636b 2066 696c 653a 2027 202b   stack file: ' +
+000908a0: 2066 6e29 0d0a 2020 2020 2020 2020 2020   fn)..          
+000908b0: 2020 7365 6c66 2e74 6578 7474 2e73 6574    self.textt.set
+000908c0: 5465 7874 2827 5365 6c65 6374 206c 6173  Text('Select las
+000908d0: 7420 7374 6163 6b20 6669 6c65 2729 0d0a  t stack file')..
+000908e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000908f0: 2e66 696c 6531 7374 203d 2066 6e0d 0a20  .file1st = fn.. 
+00090900: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00090910: 6861 7665 3173 7420 3d20 310d 0a20 2020  have1st = 1..   
+00090920: 2020 2020 2065 6c69 6620 7365 6c66 2e68       elif self.h
+00090930: 6176 656c 6173 7420 3d3d 2030 3a0d 0a20  avelast == 0:.. 
+00090940: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00090950: 7463 5f6c 6173 742e 7365 7454 6578 7428  tc_last.setText(
+00090960: 274c 6173 7420 7374 6163 6b20 6669 6c65  'Last stack file
+00090970: 3a20 2720 2b20 666e 290d 0a20 2020 2020  : ' + fn)..     
+00090980: 2020 2020 2020 2073 656c 662e 7465 7874         self.text
+00090990: 742e 7365 7454 6578 7428 2753 656c 6563  t.setText('Selec
+000909a0: 7420 6669 7273 7420 7374 6163 6b20 6669  t first stack fi
+000909b0: 6c65 2729 0d0a 2020 2020 2020 2020 2020  le')..          
+000909c0: 2020 7365 6c66 2e66 696c 656c 6173 7420    self.filelast 
+000909d0: 3d20 666e 0d0a 2020 2020 2020 2020 2020  = fn..          
+000909e0: 2020 2373 656c 662e 6275 7474 6f6e 5f61    #self.button_a
+000909f0: 6363 6570 742e 7365 7445 6e61 626c 6564  ccept.setEnabled
+00090a00: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
+00090a10: 2020 2020 7365 6c66 2e68 6176 656c 6173      self.havelas
+00090a20: 7420 3d20 310d 0a0d 0a23 2d2d 2d2d 2d2d  t = 1....#------
+00090a30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00090a40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00090a50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00090a60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00090a70: 0d0a 2020 2020 6465 6620 5368 6f77 4669  ..    def ShowFi
+00090a80: 6c65 4c69 7374 2873 656c 6629 3a0d 0a0d  leList(self):...
+00090a90: 0a20 2020 2020 2020 2066 696c 6570 6174  .        filepat
+00090aa0: 6820 3d20 7374 7228 7365 6c66 2e66 696c  h = str(self.fil
+00090ab0: 6570 6174 6829 0d0a 2020 2020 2020 2020  epath)..        
+00090ac0: 7365 6c66 2e73 6d5f 6669 6c65 7320 3d20  self.sm_files = 
+00090ad0: 5b78 2066 6f72 2078 2069 6e20 6f73 2e6c  [x for x in os.l
+00090ae0: 6973 7464 6972 2866 696c 6570 6174 6829  istdir(filepath)
+00090af0: 2069 6620 782e 656e 6473 7769 7468 2827   if x.endswith('
+00090b00: 2e73 6d27 295d 0d0a 0d0a 2020 2020 2020  .sm')]....      
+00090b10: 2020 6966 2073 656c 662e 736d 5f66 696c    if self.sm_fil
+00090b20: 6573 3a0d 0a0d 0a20 2020 2020 2020 2020  es:....         
+00090b30: 2020 2073 656c 662e 6669 6c65 7479 7065     self.filetype
+00090b40: 203d 2027 736d 270d 0a0d 0a20 2020 2020   = 'sm'....     
+00090b50: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
+00090b60: 2020 2020 2020 2020 2020 2020 2066 726f               fro
+00090b70: 6d20 6e65 7443 4446 3420 696d 706f 7274  m netCDF4 import
+00090b80: 2044 6174 6173 6574 0d0a 2020 2020 2020   Dataset..      
+00090b90: 2020 2020 2020 2020 2020 6672 6f6d 2066            from f
+00090ba0: 696c 655f 706c 7567 696e 7320 696d 706f  ile_plugins impo
+00090bb0: 7274 2066 696c 655f 736d 5f6e 6574 6364  rt file_sm_netcd
+00090bc0: 660d 0a0d 0a20 2020 2020 2020 2020 2020  f....           
+00090bd0: 2065 7863 6570 743a 0d0a 2020 2020 2020   except:..      
+00090be0: 2020 2020 2020 2020 2020 5174 4775 692e            QtGui.
+00090bf0: 514d 6573 7361 6765 426f 782e 7761 726e  QMessageBox.warn
+00090c00: 696e 6728 7365 6c66 2c20 2745 7272 6f72  ing(self, 'Error
+00090c10: 272c 2022 436f 756c 6420 6e6f 7420 696d  ', "Could not im
+00090c20: 706f 7274 206e 6574 4344 4634 206c 6962  port netCDF4 lib
+00090c30: 7261 7279 2e22 290d 0a20 2020 2020 2020  rary.")..       
+00090c40: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
+00090c50: 0a0d 0a20 2020 2020 2020 2020 2020 2063  ...            c
+00090c60: 6f75 6e74 203d 2030 0d0a 0d0a 2020 2020  ount = 0....    
+00090c70: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+00090c80: 2072 616e 6765 286c 656e 2873 656c 662e   range(len(self.
+00090c90: 736d 5f66 696c 6573 2929 3a0d 0a0d 0a20  sm_files)):.... 
+00090ca0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00090cb0: 696c 656e 616d 6520 3d20 7365 6c66 2e73  ilename = self.s
+00090cc0: 6d5f 6669 6c65 735b 695d 0d0a 2020 2020  m_files[i]..    
+00090cd0: 2020 2020 2020 2020 2020 2020 7468 6973              this
+00090ce0: 6669 6c65 203d 206f 732e 7061 7468 2e6a  file = os.path.j
+00090cf0: 6f69 6e28 6669 6c65 7061 7468 2c20 6669  oin(filepath, fi
+00090d00: 6c65 6e61 6d65 290d 0a0d 0a20 2020 2020  lename)....     
+00090d10: 2020 2020 2020 2020 2020 2066 696c 6576             filev
+00090d20: 6572 2c20 6e63 6f6c 732c 206e 726f 7773  er, ncols, nrows
+00090d30: 2c20 6965 7620 3d20 6669 6c65 5f73 6d5f  , iev = file_sm_
+00090d40: 6e65 7463 6466 2e72 6561 645f 736d 5f68  netcdf.read_sm_h
+00090d50: 6561 6465 7228 7468 6973 6669 6c65 290d  eader(thisfile).
+00090d60: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00090d70: 2020 2069 6620 6669 6c65 7665 7220 3e20     if filever > 
+00090d80: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
+00090d90: 2020 2020 2020 2020 7365 6c66 2e66 696c          self.fil
+00090da0: 656c 6973 742e 696e 7365 7274 526f 7728  elist.insertRow(
+00090db0: 636f 756e 7429 0d0a 2020 2020 2020 2020  count)..        
+00090dc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00090dd0: 2e66 696c 656c 6973 742e 7365 7452 6f77  .filelist.setRow
+00090de0: 4865 6967 6874 2863 6f75 6e74 2c32 3029  Height(count,20)
+00090df0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00090e00: 2020 2020 2020 2020 7365 6c66 2e66 696c          self.fil
+00090e10: 656c 6973 742e 7365 7449 7465 6d28 636f  elist.setItem(co
+00090e20: 756e 742c 2030 2c20 5174 4775 692e 5154  unt, 0, QtGui.QT
+00090e30: 6162 6c65 5769 6467 6574 4974 656d 2866  ableWidgetItem(f
+00090e40: 696c 656e 616d 6529 290d 0a20 2020 2020  ilename))..     
+00090e50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00090e60: 656c 662e 6669 6c65 6c69 7374 2e73 6574  elf.filelist.set
+00090e70: 4974 656d 2863 6f75 6e74 2c20 312c 2051  Item(count, 1, Q
+00090e80: 7447 7569 2e51 5461 626c 6557 6964 6765  tGui.QTableWidge
+00090e90: 7449 7465 6d28 7374 7228 6e63 6f6c 7329  tItem(str(ncols)
+00090ea0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00090eb0: 2020 2020 2020 2020 7365 6c66 2e66 696c          self.fil
+00090ec0: 656c 6973 742e 7365 7449 7465 6d28 636f  elist.setItem(co
+00090ed0: 756e 742c 2032 2c20 5174 4775 692e 5154  unt, 2, QtGui.QT
+00090ee0: 6162 6c65 5769 6467 6574 4974 656d 2873  ableWidgetItem(s
+00090ef0: 7472 286e 726f 7773 2929 290d 0a20 2020  tr(nrows)))..   
+00090f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00090f10: 2073 656c 662e 6669 6c65 6c69 7374 2e73   self.filelist.s
+00090f20: 6574 4974 656d 2863 6f75 6e74 2c20 332c  etItem(count, 3,
+00090f30: 2051 7447 7569 2e51 5461 626c 6557 6964   QtGui.QTableWid
+00090f40: 6765 7449 7465 6d28 277b 303a 352e 3266  getItem('{0:5.2f
+00090f50: 7d27 2e66 6f72 6d61 7428 6965 7629 2929  }'.format(iev)))
+00090f60: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00090f70: 2020 2020 2020 2020 636f 756e 7420 2b3d          count +=
+00090f80: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
+00090f90: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00090fa0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00090fb0: 6f6e 7469 6e75 650d 0a0d 0a0d 0a0d 0a0d  ontinue.........
+00090fc0: 0a20 2020 2020 2020 2073 656c 662e 7872  .        self.xr
+00090fd0: 6d5f 6669 6c65 7320 3d20 5b78 2066 6f72  m_files = [x for
+00090fe0: 2078 2069 6e20 6f73 2e6c 6973 7464 6972   x in os.listdir
+00090ff0: 2866 696c 6570 6174 6829 2069 6620 782e  (filepath) if x.
+00091000: 656e 6473 7769 7468 2827 2e78 726d 2729  endswith('.xrm')
+00091010: 5d0d 0a0d 0a0d 0a20 2020 2020 2020 2069  ]......        i
+00091020: 6620 7365 6c66 2e78 726d 5f66 696c 6573  f self.xrm_files
+00091030: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
+00091040: 2073 656c 662e 6669 6c65 7479 7065 203d   self.filetype =
+00091050: 2027 7872 6d27 0d0a 0d0a 2020 2020 2020   'xrm'....      
+00091060: 2020 2020 2020 636f 756e 7420 3d20 300d        count = 0.
+00091070: 0a0d 0a20 2020 2020 2020 2020 2020 2066  ...            f
+00091080: 6f72 2069 2069 6e20 7261 6e67 6528 6c65  or i in range(le
+00091090: 6e28 7365 6c66 2e78 726d 5f66 696c 6573  n(self.xrm_files
+000910a0: 2929 3a0d 0a0d 0a20 2020 2020 2020 2020  )):....         
+000910b0: 2020 2020 2020 2066 696c 656e 616d 6520         filename 
+000910c0: 3d20 7365 6c66 2e78 726d 5f66 696c 6573  = self.xrm_files
+000910d0: 5b69 5d0d 0a20 2020 2020 2020 2020 2020  [i]..           
+000910e0: 2020 2020 2074 6869 7366 696c 6520 3d20       thisfile = 
+000910f0: 6f73 2e70 6174 682e 6a6f 696e 2866 696c  os.path.join(fil
+00091100: 6570 6174 682c 2066 696c 656e 616d 6529  epath, filename)
+00091110: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00091120: 2020 2020 6e63 6f6c 732c 206e 726f 7773      ncols, nrows
+00091130: 2c20 6965 7620 3d20 6669 6c65 5f78 726d  , iev = file_xrm
+00091140: 2e72 6561 645f 7872 6d5f 6669 6c65 696e  .read_xrm_filein
+00091150: 666f 2874 6869 7366 696c 6529 0d0a 0d0a  fo(thisfile)....
+00091160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091170: 6966 206e 636f 6c73 203e 2030 3a0d 0a20  if ncols > 0:.. 
+00091180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091190: 2020 2073 656c 662e 6669 6c65 6c69 7374     self.filelist
+000911a0: 2e69 6e73 6572 7452 6f77 2863 6f75 6e74  .insertRow(count
+000911b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000911c0: 2020 2020 2020 2073 656c 662e 6669 6c65         self.file
+000911d0: 6c69 7374 2e73 6574 526f 7748 6569 6768  list.setRowHeigh
+000911e0: 7428 636f 756e 742c 3230 290d 0a0d 0a20  t(count,20).... 
+000911f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091200: 2020 2073 656c 662e 6669 6c65 6c69 7374     self.filelist
+00091210: 2e73 6574 4974 656d 2863 6f75 6e74 2c20  .setItem(count, 
+00091220: 302c 2051 7447 7569 2e51 5461 626c 6557  0, QtGui.QTableW
+00091230: 6964 6765 7449 7465 6d28 6669 6c65 6e61  idgetItem(filena
+00091240: 6d65 2929 0d0a 2020 2020 2020 2020 2020  me))..          
+00091250: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
+00091260: 696c 656c 6973 742e 7365 7449 7465 6d28  ilelist.setItem(
+00091270: 636f 756e 742c 2031 2c20 5174 4775 692e  count, 1, QtGui.
+00091280: 5154 6162 6c65 5769 6467 6574 4974 656d  QTableWidgetItem
+00091290: 2873 7472 286e 636f 6c73 2929 290d 0a20  (str(ncols))).. 
+000912a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000912b0: 2020 2073 656c 662e 6669 6c65 6c69 7374     self.filelist
+000912c0: 2e73 6574 4974 656d 2863 6f75 6e74 2c20  .setItem(count, 
+000912d0: 322c 2051 7447 7569 2e51 5461 626c 6557  2, QtGui.QTableW
+000912e0: 6964 6765 7449 7465 6d28 7374 7228 6e72  idgetItem(str(nr
+000912f0: 6f77 7329 2929 0d0a 2020 2020 2020 2020  ows)))..        
+00091300: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00091310: 2e66 696c 656c 6973 742e 7365 7449 7465  .filelist.setIte
+00091320: 6d28 636f 756e 742c 2033 2c20 5174 4775  m(count, 3, QtGu
+00091330: 692e 5154 6162 6c65 5769 6467 6574 4974  i.QTableWidgetIt
+00091340: 656d 2827 7b30 3a35 2e32 667d 272e 666f  em('{0:5.2f}'.fo
+00091350: 726d 6174 2869 6576 2929 290d 0a0d 0a20  rmat(iev))).... 
+00091360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091370: 2020 2063 6f75 6e74 202b 3d20 310d 0a0d     count += 1...
+00091380: 0a0d 0a20 2020 2020 2020 2020 2020 2073  ...            s
+00091390: 656c 662e 736d 5f66 696c 6573 203d 2073  elf.sm_files = s
+000913a0: 656c 662e 7872 6d5f 6669 6c65 730d 0a0d  elf.xrm_files...
+000913b0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+000913c0: 6269 6d5f 6669 6c65 7320 3d20 5b78 2066  bim_files = [x f
+000913d0: 6f72 2078 2069 6e20 6f73 2e6c 6973 7464  or x in os.listd
+000913e0: 6972 2866 696c 6570 6174 6829 2069 6620  ir(filepath) if 
+000913f0: 782e 656e 6473 7769 7468 2827 2e62 696d  x.endswith('.bim
+00091400: 2729 5d0d 0a0d 0a0d 0a20 2020 2020 2020  ')]......       
+00091410: 2069 6620 7365 6c66 2e62 696d 5f66 696c   if self.bim_fil
+00091420: 6573 3a0d 0a0d 0a20 2020 2020 2020 2020  es:....         
+00091430: 2020 2073 656c 662e 6669 6c65 7479 7065     self.filetype
+00091440: 203d 2027 6269 6d27 0d0a 0d0a 0d0a 0d0a   = 'bim'........
+00091450: 2020 2020 2020 2020 2020 2020 636f 756e              coun
+00091460: 7420 3d20 300d 0a0d 0a20 2020 2020 2020  t = 0....       
+00091470: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+00091480: 6e67 6528 6c65 6e28 7365 6c66 2e62 696d  nge(len(self.bim
+00091490: 5f66 696c 6573 2929 3a0d 0a20 2020 2020  _files)):..     
+000914a0: 2020 2020 2020 2020 2020 2023 7072 696e             #prin
+000914b0: 7420 736d 5f66 696c 6573 0d0a 2020 2020  t sm_files..    
+000914c0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+000914d0: 6e61 6d65 203d 2073 656c 662e 6269 6d5f  name = self.bim_
+000914e0: 6669 6c65 735b 695d 0d0a 2020 2020 2020  files[i]..      
+000914f0: 2020 2020 2020 2020 2020 7468 6973 6669            thisfi
+00091500: 6c65 203d 206f 732e 7061 7468 2e6a 6f69  le = os.path.joi
+00091510: 6e28 6669 6c65 7061 7468 2c20 6669 6c65  n(filepath, file
+00091520: 6e61 6d65 290d 0a0d 0a20 2020 2020 2020  name)....       
+00091530: 2020 2020 2020 2020 206e 636f 6c73 2c20           ncols, 
+00091540: 6e72 6f77 732c 2069 6576 203d 2066 696c  nrows, iev = fil
+00091550: 655f 6269 6d2e 7265 6164 5f62 696d 5f69  e_bim.read_bim_i
+00091560: 6e66 6f28 7468 6973 6669 6c65 290d 0a0d  nfo(thisfile)...
+00091570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00091580: 2069 6620 6e63 6f6c 7320 3e30 203a 0d0a   if ncols >0 :..
+00091590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000915a0: 2020 2020 7365 6c66 2e66 696c 656c 6973      self.filelis
+000915b0: 742e 696e 7365 7274 526f 7728 636f 756e  t.insertRow(coun
+000915c0: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+000915d0: 2020 2020 2020 2020 7365 6c66 2e66 696c          self.fil
+000915e0: 656c 6973 742e 7365 7452 6f77 4865 6967  elist.setRowHeig
+000915f0: 6874 2863 6f75 6e74 2c32 3029 0d0a 0d0a  ht(count,20)....
+00091600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091610: 2020 2020 7365 6c66 2e66 696c 656c 6973      self.filelis
+00091620: 742e 7365 7449 7465 6d28 636f 756e 742c  t.setItem(count,
+00091630: 2030 2c20 5174 4775 692e 5154 6162 6c65   0, QtGui.QTable
+00091640: 5769 6467 6574 4974 656d 2866 696c 656e  WidgetItem(filen
+00091650: 616d 6529 290d 0a20 2020 2020 2020 2020  ame))..         
+00091660: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00091670: 6669 6c65 6c69 7374 2e73 6574 4974 656d  filelist.setItem
+00091680: 2863 6f75 6e74 2c20 312c 2051 7447 7569  (count, 1, QtGui
+00091690: 2e51 5461 626c 6557 6964 6765 7449 7465  .QTableWidgetIte
+000916a0: 6d28 7374 7228 6e63 6f6c 7329 2929 0d0a  m(str(ncols)))..
+000916b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000916c0: 2020 2020 7365 6c66 2e66 696c 656c 6973      self.filelis
+000916d0: 742e 7365 7449 7465 6d28 636f 756e 742c  t.setItem(count,
+000916e0: 2032 2c20 5174 4775 692e 5154 6162 6c65   2, QtGui.QTable
+000916f0: 5769 6467 6574 4974 656d 2873 7472 286e  WidgetItem(str(n
+00091700: 726f 7773 2929 290d 0a20 2020 2020 2020  rows)))..       
+00091710: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00091720: 662e 6669 6c65 6c69 7374 2e73 6574 4974  f.filelist.setIt
+00091730: 656d 2863 6f75 6e74 2c20 332c 2051 7447  em(count, 3, QtG
+00091740: 7569 2e51 5461 626c 6557 6964 6765 7449  ui.QTableWidgetI
+00091750: 7465 6d28 277b 303a 352e 3266 7d27 2e66  tem('{0:5.2f}'.f
+00091760: 6f72 6d61 7428 6965 7629 2929 0d0a 0d0a  ormat(iev)))....
+00091770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00091780: 2020 2020 636f 756e 7420 2b3d 2031 0d0a      count += 1..
+00091790: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+000917a0: 7365 6c66 2e73 6d5f 6669 6c65 7320 3d20  self.sm_files = 
+000917b0: 7365 6c66 2e62 696d 5f66 696c 6573 0d0a  self.bim_files..
+000917c0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000917d0: 0d0a 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d  ........#-------
+000917e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000917f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00091800: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00091810: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
+00091820: 0a20 2020 2064 6566 204f 6e41 6363 6570  .    def OnAccep
+00091830: 7428 7365 6c66 2c20 6576 7429 3a0d 0a0d  t(self, evt):...
+00091840: 0a20 2020 2020 2020 2051 7457 6964 6765  .        QtWidge
+00091850: 7473 2e51 4170 706c 6963 6174 696f 6e2e  ts.QApplication.
+00091860: 7365 744f 7665 7272 6964 6543 7572 736f  setOverrideCurso
+00091870: 7228 5174 4775 692e 5143 7572 736f 7228  r(QtGui.QCursor(
+00091880: 5174 2e57 6169 7443 7572 736f 7229 290d  Qt.WaitCursor)).
+00091890: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+000918a0: 7061 7265 6e74 2e6e 6577 5f73 7461 636b  parent.new_stack
+000918b0: 5f72 6566 7265 7368 2829 0d0a 2020 2020  _refresh()..    
+000918c0: 2020 2020 7365 6c66 2e73 746b 2e6e 6577      self.stk.new
+000918d0: 5f64 6174 6128 290d 0a0d 0a20 2020 2020  _data()....     
+000918e0: 2020 2069 6e64 3173 7420 3d20 7365 6c66     ind1st = self
+000918f0: 2e73 6d5f 6669 6c65 732e 696e 6465 7828  .sm_files.index(
+00091900: 7365 6c66 2e66 696c 6531 7374 290d 0a20  self.file1st).. 
+00091910: 2020 2020 2020 2069 6e64 6c61 7374 203d         indlast =
+00091920: 2073 656c 662e 736d 5f66 696c 6573 2e69   self.sm_files.i
+00091930: 6e64 6578 2873 656c 662e 6669 6c65 6c61  ndex(self.filela
+00091940: 7374 290d 0a0d 0a20 2020 2020 2020 2066  st)....        f
+00091950: 696c 656c 6973 7420 3d20 7365 6c66 2e73  ilelist = self.s
+00091960: 6d5f 6669 6c65 735b 696e 6431 7374 3a69  m_files[ind1st:i
+00091970: 6e64 6c61 7374 2b31 5d0d 0a0d 0a0d 0a20  ndlast+1]...... 
+00091980: 2020 2020 2020 2069 6620 7365 6c66 2e66         if self.f
+00091990: 696c 6574 7970 6520 3d3d 2027 736d 273a  iletype == 'sm':
+000919a0: 0d0a 2020 2020 2020 2020 2020 2020 6672  ..            fr
+000919b0: 6f6d 2066 696c 655f 706c 7567 696e 7320  om file_plugins 
+000919c0: 696d 706f 7274 2066 696c 655f 736d 5f6e  import file_sm_n
+000919d0: 6574 6364 660d 0a20 2020 2020 2020 2020  etcdf..         
+000919e0: 2020 2066 696c 655f 736d 5f6e 6574 6364     file_sm_netcd
+000919f0: 662e 7265 6164 5f73 6d5f 6c69 7374 2873  f.read_sm_list(s
+00091a00: 656c 662c 2066 696c 656c 6973 742c 2073  elf, filelist, s
+00091a10: 656c 662e 6669 6c65 7061 7468 2c20 7365  elf.filepath, se
+00091a20: 6c66 2e64 6174 615f 7374 7275 6374 290d  lf.data_struct).
+00091a30: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
+00091a40: 6c66 2e66 696c 6574 7970 6520 3d3d 2027  lf.filetype == '
+00091a50: 7872 6d27 3a0d 0a20 2020 2020 2020 2020  xrm':..         
+00091a60: 2020 2066 696c 655f 7872 6d2e 7265 6164     file_xrm.read
+00091a70: 5f78 726d 5f6c 6973 7428 7365 6c66 2c20  _xrm_list(self, 
+00091a80: 6669 6c65 6c69 7374 2c20 7365 6c66 2e66  filelist, self.f
+00091a90: 696c 6570 6174 682c 2073 656c 662e 6461  ilepath, self.da
+00091aa0: 7461 5f73 7472 7563 7429 0d0a 2020 2020  ta_struct)..    
+00091ab0: 2020 2020 656c 6966 2073 656c 662e 6669      elif self.fi
+00091ac0: 6c65 7479 7065 203d 3d20 2762 696d 273a  letype == 'bim':
+00091ad0: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
+00091ae0: 6c65 5f62 696d 2e72 6561 645f 6269 6d5f  le_bim.read_bim_
+00091af0: 6c69 7374 2873 656c 662c 2066 696c 656c  list(self, filel
+00091b00: 6973 742c 2073 656c 662e 6669 6c65 7061  ist, self.filepa
+00091b10: 7468 2c20 7365 6c66 2e64 6174 615f 7374  th, self.data_st
+00091b20: 7275 6374 290d 0a20 2020 2020 2020 2065  ruct)..        e
+00091b30: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00091b40: 2020 7072 696e 7428 2757 726f 6e67 2066    print('Wrong f
+00091b50: 696c 6520 7479 7065 2729 0d0a 2020 2020  ile type')..    
+00091b60: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
+00091b70: 0d0a 0d0a 2020 2020 2020 2020 2366 696c  ....        #fil
+00091b80: 6c20 7468 6520 6775 6920 7374 7275 6374  l the gui struct
+00091b90: 7572 6520 6461 7461 0d0a 2020 2020 2020  ure data..      
+00091ba0: 2020 7365 6c66 2e73 746b 2e61 6273 6461    self.stk.absda
+00091bb0: 7461 203d 2073 656c 662e 6461 7461 5f73  ta = self.data_s
+00091bc0: 7472 7563 742e 6578 6368 616e 6765 2e64  truct.exchange.d
+00091bd0: 6174 610d 0a0d 0a20 2020 2020 2020 2064  ata....        d
+00091be0: 6174 6164 696d 203d 206e 702e 696e 7433  atadim = np.int3
+00091bf0: 3228 7365 6c66 2e73 746b 2e61 6273 6461  2(self.stk.absda
+00091c00: 7461 2e73 6861 7065 290d 0a20 2020 2020  ta.shape)..     
+00091c10: 2020 2073 656c 662e 7374 6b2e 6e5f 636f     self.stk.n_co
+00091c20: 6c73 203d 2064 6174 6164 696d 5b30 5d2e  ls = datadim[0].
+00091c30: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
+00091c40: 7365 6c66 2e73 746b 2e6e 5f72 6f77 7320  self.stk.n_rows 
+00091c50: 3d20 2064 6174 6164 696d 5b31 5d2e 636f  =  datadim[1].co
+00091c60: 7079 2829 0d0a 2020 2020 2020 2020 7365  py()..        se
+00091c70: 6c66 2e73 746b 2e65 7620 3d20 7365 6c66  lf.stk.ev = self
+00091c80: 2e64 6174 615f 7374 7275 6374 2e65 7863  .data_struct.exc
+00091c90: 6861 6e67 652e 656e 6572 6779 0d0a 2020  hange.energy..  
+00091ca0: 2020 2020 2020 7365 6c66 2e73 746b 2e6e        self.stk.n
+00091cb0: 5f65 7620 3d20 6e70 2e69 6e74 3332 2873  _ev = np.int32(s
+00091cc0: 656c 662e 7374 6b2e 6576 2e73 6861 7065  elf.stk.ev.shape
+00091cd0: 5b30 5d29 2e63 6f70 7928 290d 0a0d 0a20  [0]).copy().... 
+00091ce0: 2020 2020 2020 206e 7069 7865 6c73 203d         npixels =
+00091cf0: 2073 656c 662e 7374 6b2e 6e5f 636f 6c73   self.stk.n_cols
+00091d00: 2a73 656c 662e 7374 6b2e 6e5f 726f 7773  *self.stk.n_rows
+00091d10: 2a73 656c 662e 7374 6b2e 6e5f 6576 0d0a  *self.stk.n_ev..
 00091d20: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00091d30: 2e73 746b 2e73 6361 6c65 5f62 6172 2829  .stk.scale_bar()
-00091d40: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7365  ......        se
-00091d50: 6c66 2e70 6172 656e 742e 7061 6765 312e  lf.parent.page1.
-00091d60: 6965 7620 3d20 696e 7428 7365 6c66 2e73  iev = int(self.s
-00091d70: 746b 2e6e 5f65 762f 3329 2023 4973 2074  tk.n_ev/3) #Is t
-00091d80: 6869 7320 636f 7272 6563 743f 0d0a 0d0a  his correct?....
-00091d90: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
-00091da0: 656e 742e 6978 203d 2069 6e74 2873 656c  ent.ix = int(sel
-00091db0: 662e 7374 6b2e 6e5f 636f 6c73 2f32 290d  f.stk.n_cols/2).
-00091dc0: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
-00091dd0: 7265 6e74 2e69 7920 3d20 696e 7428 7365  rent.iy = int(se
-00091de0: 6c66 2e73 746b 2e6e 5f72 6f77 732f 3229  lf.stk.n_rows/2)
-00091df0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00091e00: 2e63 6f6d 6d6f 6e2e 7374 6163 6b5f 6c6f  .common.stack_lo
-00091e10: 6164 6564 203d 2031 0d0a 0d0a 2020 2020  aded = 1....    
-00091e20: 2020 2020 7365 6c66 2e70 6172 656e 742e      self.parent.
-00091e30: 7265 6672 6573 685f 7769 6467 6574 7328  refresh_widgets(
-00091e40: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00091e50: 7061 7265 6e74 2e70 6167 6531 2e52 6573  parent.page1.Res
-00091e60: 6574 4469 7370 6c61 7953 6574 7469 6e67  etDisplaySetting
-00091e70: 7328 290d 0a20 2020 2020 2020 2073 656c  s()..        sel
-00091e80: 662e 7061 7265 6e74 2e70 6167 6531 2e66  f.parent.page1.f
-00091e90: 696c 656e 616d 6520 3d20 6669 6c65 6c69  ilename = fileli
-00091ea0: 7374 5b30 5d0d 0a20 2020 2020 2020 2073  st[0]..        s
-00091eb0: 656c 662e 7061 7265 6e74 2e70 6167 6531  elf.parent.page1
-00091ec0: 2e74 6578 7463 7472 6c2e 7365 7454 6578  .textctrl.setTex
-00091ed0: 7428 6669 6c65 6c69 7374 5b30 5d29 0d0a  t(filelist[0])..
-00091ee0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-00091ef0: 6172 656e 742e 7061 6765 302e 736c 6964  arent.page0.slid
-00091f00: 6572 5f65 6e67 2e73 6574 5261 6e67 6528  er_eng.setRange(
-00091f10: 302c 7365 6c66 2e73 746b 2e6e 5f65 762d  0,self.stk.n_ev-
-00091f20: 3129 0d0a 2020 2020 2020 2020 7365 6c66  1)..        self
-00091f30: 2e70 6172 656e 742e 7061 6765 302e 6965  .parent.page0.ie
-00091f40: 7620 3d20 696e 7428 7365 6c66 2e73 746b  v = int(self.stk
-00091f50: 2e6e 5f65 762f 3229 0d0a 2020 2020 2020  .n_ev/2)..      
-00091f60: 2020 7365 6c66 2e70 6172 656e 742e 7061    self.parent.pa
-00091f70: 6765 302e 736c 6964 6572 5f65 6e67 2e73  ge0.slider_eng.s
-00091f80: 6574 5661 6c75 6528 7365 6c66 2e70 6172  etValue(self.par
-00091f90: 656e 742e 7061 6765 312e 6965 7629 0d0a  ent.page1.iev)..
-00091fa0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-00091fb0: 6172 656e 742e 7061 6765 312e 736c 6964  arent.page1.slid
-00091fc0: 6572 5f65 6e67 2e73 6574 5261 6e67 6528  er_eng.setRange(
-00091fd0: 302c 7365 6c66 2e73 746b 2e6e 5f65 762d  0,self.stk.n_ev-
-00091fe0: 3129 0d0a 2020 2020 2020 2020 7365 6c66  1)..        self
-00091ff0: 2e70 6172 656e 742e 7061 6765 312e 6965  .parent.page1.ie
-00092000: 7620 3d20 7365 6c66 2e73 746b 2e6e 5f65  v = self.stk.n_e
-00092010: 762f 320d 0a20 2020 2020 2020 2073 656c  v/2..        sel
-00092020: 662e 7061 7265 6e74 2e70 6167 6531 2e73  f.parent.page1.s
-00092030: 6c69 6465 725f 656e 672e 7365 7456 616c  lider_eng.setVal
-00092040: 7565 2873 656c 662e 7061 7265 6e74 2e70  ue(self.parent.p
-00092050: 6167 6531 2e69 6576 290d 0a0d 0a20 2020  age1.iev)....   
-00092060: 2020 2020 2073 656c 662e 7061 7265 6e74       self.parent
-00092070: 2e70 6167 6531 2e73 686f 7753 7065 6374  .page1.showSpect
-00092080: 7275 6d28 7365 6c66 2e70 6172 656e 742e  rum(self.parent.
-00092090: 7061 6765 312e 6978 2c20 7365 6c66 2e70  page1.ix, self.p
-000920a0: 6172 656e 742e 7061 6765 312e 6979 290d  arent.page1.iy).
-000920b0: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
-000920c0: 7265 6e74 2e70 6167 6531 2e6c 6f61 6449  rent.page1.loadI
-000920d0: 6d61 6765 2829 0d0a 0d0a 2020 2020 2020  mage()....      
-000920e0: 2020 7365 6c66 2e70 6172 656e 742e 7061    self.parent.pa
-000920f0: 6765 302e 5368 6f77 496e 666f 2866 696c  ge0.ShowInfo(fil
-00092100: 656c 6973 745b 305d 2c20 7365 6c66 2e66  elist[0], self.f
-00092110: 696c 6570 6174 6829 0d0a 0d0a 2020 2020  ilepath)....    
-00092120: 2020 2020 5174 5769 6467 6574 732e 5141      QtWidgets.QA
-00092130: 7070 6c69 6361 7469 6f6e 2e72 6573 746f  pplication.resto
-00092140: 7265 4f76 6572 7269 6465 4375 7273 6f72  reOverrideCursor
-00092150: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
-00092160: 2e63 6c6f 7365 2829 0d0a 0d0a 0d0a 232d  .close()......#-
-00092170: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00092180: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00092190: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000921a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000921b0: 2d2d 2d2d 2d0d 0a63 6c61 7373 2049 6e70  -----..class Inp
-000921c0: 7574 5265 6769 6f6e 4469 616c 6f67 2851  utRegionDialog(Q
-000921d0: 7457 6964 6765 7473 2e51 4469 616c 6f67  tWidgets.QDialog
-000921e0: 293a 0d0a 0d0a 2020 2020 6465 6620 5f5f  ):....    def __
-000921f0: 696e 6974 5f5f 2873 656c 662c 2070 6172  init__(self, par
-00092200: 656e 742c 206e 7265 6769 6f6e 732c 2074  ent, nregions, t
-00092210: 6974 6c65 3d27 4d75 6c74 6920 5265 6769  itle='Multi Regi
-00092220: 6f6e 2053 7461 636b 2729 3a0d 0a0d 0a20  on Stack'):.... 
-00092230: 2020 2020 2020 2051 7457 6964 6765 7473         QtWidgets
-00092240: 2e51 5769 6467 6574 2e5f 5f69 6e69 745f  .QWidget.__init_
-00092250: 5f28 7365 6c66 2c20 7061 7265 6e74 290d  _(self, parent).
-00092260: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00092270: 7061 7265 6e74 203d 2070 6172 656e 740d  parent = parent.
-00092280: 0a0d 0a20 2020 2020 2020 206d 6169 6e4c  ...        mainL
-00092290: 6179 6f75 7420 3d20 5174 5769 6467 6574  ayout = QtWidget
-000922a0: 732e 5156 426f 784c 6179 6f75 7428 290d  s.QVBoxLayout().
-000922b0: 0a0d 0a20 2020 2020 2020 206c 6179 6f75  ...        layou
-000922c0: 7420 3d20 5174 5769 6467 6574 732e 5148  t = QtWidgets.QH
-000922d0: 426f 784c 6179 6f75 7428 290d 0a20 2020  BoxLayout()..   
-000922e0: 2020 2020 206c 6162 656c 203d 2051 7457       label = QtW
-000922f0: 6964 6765 7473 2e51 4c61 6265 6c28 290d  idgets.QLabel().
-00092300: 0a20 2020 2020 2020 206c 6162 656c 2e73  .        label.s
-00092310: 6574 5465 7874 2827 5365 6c65 6374 2052  etText('Select R
-00092320: 6567 696f 6e20 746f 206c 6f61 643a 2729  egion to load:')
-00092330: 0d0a 2020 2020 2020 2020 6c61 796f 7574  ..        layout
-00092340: 2e61 6464 5769 6467 6574 286c 6162 656c  .addWidget(label
-00092350: 290d 0a20 2020 2020 2020 2063 6f6d 626f  )..        combo
-00092360: 203d 2051 7457 6964 6765 7473 2e51 436f   = QtWidgets.QCo
-00092370: 6d62 6f42 6f78 2873 656c 6629 0d0a 2020  mboBox(self)..  
-00092380: 2020 2020 2020 636f 6d62 6f2e 6164 6449        combo.addI
-00092390: 7465 6d28 2241 6c6c 2229 0d0a 2020 2020  tem("All")..    
-000923a0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-000923b0: 6765 286e 7265 6769 6f6e 7329 3a0d 0a20  ge(nregions):.. 
-000923c0: 2020 2020 2020 2020 2020 2063 6f6d 626f             combo
-000923d0: 2e61 6464 4974 656d 2873 7472 2869 2b31  .addItem(str(i+1
-000923e0: 2929 0d0a 2020 2020 2020 2020 636f 6d62  ))..        comb
-000923f0: 6f2e 7365 7443 7572 7265 6e74 496e 6465  o.setCurrentInde
-00092400: 7828 3129 0d0a 2020 2020 2020 2020 7365  x(1)..        se
-00092410: 6c66 2e70 6172 656e 742e 6c6f 6164 7265  lf.parent.loadre
-00092420: 6769 6f6e 203d 2031 0d0a 2020 2020 2020  gion = 1..      
-00092430: 2020 636f 6d62 6f2e 6163 7469 7661 7465    combo.activate
-00092440: 645b 696e 745d 2e63 6f6e 6e65 6374 2873  d[int].connect(s
-00092450: 656c 662e 4f6e 5365 6c65 6374 5265 6769  elf.OnSelectRegi
-00092460: 6f6e 290d 0a0d 0a20 2020 2020 2020 206c  on)....        l
-00092470: 6179 6f75 742e 6164 6457 6964 6765 7428  ayout.addWidget(
-00092480: 636f 6d62 6f29 0d0a 0d0a 2020 2020 2020  combo)....      
-00092490: 2020 6d61 696e 4c61 796f 7574 2e61 6464    mainLayout.add
-000924a0: 4c61 796f 7574 286c 6179 6f75 7429 0d0a  Layout(layout)..
-000924b0: 0d0a 0d0a 2020 2020 2020 2020 6c61 796f  ....        layo
-000924c0: 7574 203d 2051 7457 6964 6765 7473 2e51  ut = QtWidgets.Q
-000924d0: 4842 6f78 4c61 796f 7574 2829 0d0a 2020  HBoxLayout()..  
-000924e0: 2020 2020 2020 6275 7474 6f6e 203d 2051        button = Q
-000924f0: 7457 6964 6765 7473 2e51 5075 7368 4275  tWidgets.QPushBu
-00092500: 7474 6f6e 2822 5375 626d 6974 2229 2023  tton("Submit") #
-00092510: 7374 7269 6e67 206f 7220 6963 6f6e 0d0a  string or icon..
-00092520: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
-00092530: 6e65 6374 2862 7574 746f 6e2c 2051 7443  nect(button, QtC
-00092540: 6f72 652e 5349 474e 414c 2822 636c 6963  ore.SIGNAL("clic
-00092550: 6b65 6428 2922 292c 2073 656c 662e 636c  ked()"), self.cl
-00092560: 6f73 6529 0d0a 2020 2020 2020 2020 6c61  ose)..        la
-00092570: 796f 7574 2e61 6464 5769 6467 6574 2862  yout.addWidget(b
-00092580: 7574 746f 6e29 0d0a 0d0a 2020 2020 2020  utton)....      
-00092590: 2020 6d61 696e 4c61 796f 7574 2e61 6464    mainLayout.add
-000925a0: 4c61 796f 7574 286c 6179 6f75 7429 0d0a  Layout(layout)..
-000925b0: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-000925c0: 4c61 796f 7574 286d 6169 6e4c 6179 6f75  Layout(mainLayou
-000925d0: 7429 0d0a 0d0a 2020 2020 2020 2020 7365  t)....        se
-000925e0: 6c66 2e72 6573 697a 6528 3235 302c 2036  lf.resize(250, 6
-000925f0: 3029 0d0a 2020 2020 2020 2020 7365 6c66  0)..        self
-00092600: 2e73 6574 5769 6e64 6f77 5469 746c 6528  .setWindowTitle(
-00092610: 7469 746c 6529 0d0a 0d0a 232d 2d2d 2d2d  title)....#-----
-00092620: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00092630: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00092640: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00092650: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00092660: 2d0d 0a20 2020 2064 6566 204f 6e53 656c  -..    def OnSel
-00092670: 6563 7452 6567 696f 6e28 7365 6c66 2c20  ectRegion(self, 
-00092680: 7661 6c75 6529 3a0d 0a20 2020 2020 2020  value):..       
-00092690: 2069 7465 6d20 3d20 7661 6c75 650d 0a20   item = value.. 
-000926a0: 2020 2020 2020 2073 656c 7265 6769 6f6e         selregion
-000926b0: 203d 2069 7465 6d0d 0a20 2020 2020 2020   = item..       
-000926c0: 2073 656c 662e 7061 7265 6e74 2e6c 6f61   self.parent.loa
-000926d0: 6472 6567 696f 6e20 3d20 7365 6c72 6567  dregion = selreg
-000926e0: 696f 6e0d 0a0d 0a0d 0a0d 0a23 2d2d 2d2d  ion........#----
-000926f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00092700: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00091d30: 2e73 746b 2e78 5f64 6973 7420 3d20 7365  .stk.x_dist = se
+00091d40: 6c66 2e64 6174 615f 7374 7275 6374 2e65  lf.data_struct.e
+00091d50: 7863 6861 6e67 652e 780d 0a20 2020 2020  xchange.x..     
+00091d60: 2020 2073 656c 662e 7374 6b2e 795f 6469     self.stk.y_di
+00091d70: 7374 203d 2073 656c 662e 6461 7461 5f73  st = self.data_s
+00091d80: 7472 7563 742e 6578 6368 616e 6765 2e79  truct.exchange.y
+00091d90: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00091da0: 2e73 746b 2e64 6174 615f 6477 656c 6c20  .stk.data_dwell 
+00091db0: 3d20 7365 6c66 2e64 6174 615f 7374 7275  = self.data_stru
+00091dc0: 6374 2e73 7065 6374 726f 6d69 6372 6f73  ct.spectromicros
+00091dd0: 636f 7079 2e64 6174 615f 6477 656c 6c0d  copy.data_dwell.
+00091de0: 0a0d 0a0d 0a20 2020 2020 2020 2073 656c  .....        sel
+00091df0: 662e 7374 6b2e 6669 6c6c 5f68 355f 7374  f.stk.fill_h5_st
+00091e00: 7275 6374 5f66 726f 6d5f 7374 6b28 290d  ruct_from_stk().
+00091e10: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00091e20: 7374 6b2e 7363 616c 655f 6261 7228 290d  stk.scale_bar().
+00091e30: 0a0d 0a0d 0a20 2020 2020 2020 2073 656c  .....        sel
+00091e40: 662e 7061 7265 6e74 2e70 6167 6531 2e69  f.parent.page1.i
+00091e50: 6576 203d 2069 6e74 2873 656c 662e 7374  ev = int(self.st
+00091e60: 6b2e 6e5f 6576 2f33 2920 2349 7320 7468  k.n_ev/3) #Is th
+00091e70: 6973 2063 6f72 7265 6374 3f0d 0a0d 0a20  is correct?.... 
+00091e80: 2020 2020 2020 2073 656c 662e 7061 7265         self.pare
+00091e90: 6e74 2e69 7820 3d20 696e 7428 7365 6c66  nt.ix = int(self
+00091ea0: 2e73 746b 2e6e 5f63 6f6c 732f 3229 0d0a  .stk.n_cols/2)..
+00091eb0: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
+00091ec0: 656e 742e 6979 203d 2069 6e74 2873 656c  ent.iy = int(sel
+00091ed0: 662e 7374 6b2e 6e5f 726f 7773 2f32 290d  f.stk.n_rows/2).
+00091ee0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00091ef0: 636f 6d6d 6f6e 2e73 7461 636b 5f6c 6f61  common.stack_loa
+00091f00: 6465 6420 3d20 310d 0a0d 0a20 2020 2020  ded = 1....     
+00091f10: 2020 2073 656c 662e 7061 7265 6e74 2e72     self.parent.r
+00091f20: 6566 7265 7368 5f77 6964 6765 7473 2829  efresh_widgets()
+00091f30: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00091f40: 6172 656e 742e 7061 6765 312e 5265 7365  arent.page1.Rese
+00091f50: 7444 6973 706c 6179 5365 7474 696e 6773  tDisplaySettings
+00091f60: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+00091f70: 2e70 6172 656e 742e 7061 6765 312e 6669  .parent.page1.fi
+00091f80: 6c65 6e61 6d65 203d 2066 696c 656c 6973  lename = filelis
+00091f90: 745b 305d 0d0a 2020 2020 2020 2020 7365  t[0]..        se
+00091fa0: 6c66 2e70 6172 656e 742e 7061 6765 312e  lf.parent.page1.
+00091fb0: 7465 7874 6374 726c 2e73 6574 5465 7874  textctrl.setText
+00091fc0: 2866 696c 656c 6973 745b 305d 290d 0a0d  (filelist[0])...
+00091fd0: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+00091fe0: 7265 6e74 2e70 6167 6530 2e73 6c69 6465  rent.page0.slide
+00091ff0: 725f 656e 672e 7365 7452 616e 6765 2830  r_eng.setRange(0
+00092000: 2c73 656c 662e 7374 6b2e 6e5f 6576 2d31  ,self.stk.n_ev-1
+00092010: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00092020: 7061 7265 6e74 2e70 6167 6530 2e69 6576  parent.page0.iev
+00092030: 203d 2069 6e74 2873 656c 662e 7374 6b2e   = int(self.stk.
+00092040: 6e5f 6576 2f32 290d 0a20 2020 2020 2020  n_ev/2)..       
+00092050: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
+00092060: 6530 2e73 6c69 6465 725f 656e 672e 7365  e0.slider_eng.se
+00092070: 7456 616c 7565 2873 656c 662e 7061 7265  tValue(self.pare
+00092080: 6e74 2e70 6167 6531 2e69 6576 290d 0a0d  nt.page1.iev)...
+00092090: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+000920a0: 7265 6e74 2e70 6167 6531 2e73 6c69 6465  rent.page1.slide
+000920b0: 725f 656e 672e 7365 7452 616e 6765 2830  r_eng.setRange(0
+000920c0: 2c73 656c 662e 7374 6b2e 6e5f 6576 2d31  ,self.stk.n_ev-1
+000920d0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000920e0: 7061 7265 6e74 2e70 6167 6531 2e69 6576  parent.page1.iev
+000920f0: 203d 2073 656c 662e 7374 6b2e 6e5f 6576   = self.stk.n_ev
+00092100: 2f32 0d0a 2020 2020 2020 2020 7365 6c66  /2..        self
+00092110: 2e70 6172 656e 742e 7061 6765 312e 736c  .parent.page1.sl
+00092120: 6964 6572 5f65 6e67 2e73 6574 5661 6c75  ider_eng.setValu
+00092130: 6528 7365 6c66 2e70 6172 656e 742e 7061  e(self.parent.pa
+00092140: 6765 312e 6965 7629 0d0a 0d0a 2020 2020  ge1.iev)....    
+00092150: 2020 2020 7365 6c66 2e70 6172 656e 742e      self.parent.
+00092160: 7061 6765 312e 7368 6f77 5370 6563 7472  page1.showSpectr
+00092170: 756d 2873 656c 662e 7061 7265 6e74 2e70  um(self.parent.p
+00092180: 6167 6531 2e69 782c 2073 656c 662e 7061  age1.ix, self.pa
+00092190: 7265 6e74 2e70 6167 6531 2e69 7929 0d0a  rent.page1.iy)..
+000921a0: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
+000921b0: 656e 742e 7061 6765 312e 6c6f 6164 496d  ent.page1.loadIm
+000921c0: 6167 6528 290d 0a0d 0a20 2020 2020 2020  age()....       
+000921d0: 2073 656c 662e 7061 7265 6e74 2e70 6167   self.parent.pag
+000921e0: 6530 2e53 686f 7749 6e66 6f28 6669 6c65  e0.ShowInfo(file
+000921f0: 6c69 7374 5b30 5d2c 2073 656c 662e 6669  list[0], self.fi
+00092200: 6c65 7061 7468 290d 0a0d 0a20 2020 2020  lepath)....     
+00092210: 2020 2051 7457 6964 6765 7473 2e51 4170     QtWidgets.QAp
+00092220: 706c 6963 6174 696f 6e2e 7265 7374 6f72  plication.restor
+00092230: 654f 7665 7272 6964 6543 7572 736f 7228  eOverrideCursor(
+00092240: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00092250: 636c 6f73 6528 290d 0a0d 0a0d 0a23 2d2d  close()......#--
+00092260: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00092270: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00092280: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00092290: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000922a0: 2d2d 2d2d 0d0a 636c 6173 7320 496e 7075  ----..class Inpu
+000922b0: 7452 6567 696f 6e44 6961 6c6f 6728 5174  tRegionDialog(Qt
+000922c0: 5769 6467 6574 732e 5144 6961 6c6f 6729  Widgets.QDialog)
+000922d0: 3a0d 0a0d 0a20 2020 2064 6566 205f 5f69  :....    def __i
+000922e0: 6e69 745f 5f28 7365 6c66 2c20 7061 7265  nit__(self, pare
+000922f0: 6e74 2c20 6e72 6567 696f 6e73 2c20 7469  nt, nregions, ti
+00092300: 746c 653d 274d 756c 7469 2052 6567 696f  tle='Multi Regio
+00092310: 6e20 5374 6163 6b27 293a 0d0a 0d0a 2020  n Stack'):....  
+00092320: 2020 2020 2020 5174 5769 6467 6574 732e        QtWidgets.
+00092330: 5157 6964 6765 742e 5f5f 696e 6974 5f5f  QWidget.__init__
+00092340: 2873 656c 662c 2070 6172 656e 7429 0d0a  (self, parent)..
+00092350: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00092360: 6172 656e 7420 3d20 7061 7265 6e74 0d0a  arent = parent..
+00092370: 0d0a 2020 2020 2020 2020 6d61 696e 4c61  ..        mainLa
+00092380: 796f 7574 203d 2051 7457 6964 6765 7473  yout = QtWidgets
+00092390: 2e51 5642 6f78 4c61 796f 7574 2829 0d0a  .QVBoxLayout()..
+000923a0: 0d0a 2020 2020 2020 2020 6c61 796f 7574  ..        layout
+000923b0: 203d 2051 7457 6964 6765 7473 2e51 4842   = QtWidgets.QHB
+000923c0: 6f78 4c61 796f 7574 2829 0d0a 2020 2020  oxLayout()..    
+000923d0: 2020 2020 6c61 6265 6c20 3d20 5174 5769      label = QtWi
+000923e0: 6467 6574 732e 514c 6162 656c 2829 0d0a  dgets.QLabel()..
+000923f0: 2020 2020 2020 2020 6c61 6265 6c2e 7365          label.se
+00092400: 7454 6578 7428 2753 656c 6563 7420 5265  tText('Select Re
+00092410: 6769 6f6e 2074 6f20 6c6f 6164 3a27 290d  gion to load:').
+00092420: 0a20 2020 2020 2020 206c 6179 6f75 742e  .        layout.
+00092430: 6164 6457 6964 6765 7428 6c61 6265 6c29  addWidget(label)
+00092440: 0d0a 2020 2020 2020 2020 636f 6d62 6f20  ..        combo 
+00092450: 3d20 5174 5769 6467 6574 732e 5143 6f6d  = QtWidgets.QCom
+00092460: 626f 426f 7828 7365 6c66 290d 0a20 2020  boBox(self)..   
+00092470: 2020 2020 2063 6f6d 626f 2e61 6464 4974       combo.addIt
+00092480: 656d 2822 416c 6c22 290d 0a20 2020 2020  em("All")..     
+00092490: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+000924a0: 6528 6e72 6567 696f 6e73 293a 0d0a 2020  e(nregions):..  
+000924b0: 2020 2020 2020 2020 2020 636f 6d62 6f2e            combo.
+000924c0: 6164 6449 7465 6d28 7374 7228 692b 3129  addItem(str(i+1)
+000924d0: 290d 0a20 2020 2020 2020 2063 6f6d 626f  )..        combo
+000924e0: 2e73 6574 4375 7272 656e 7449 6e64 6578  .setCurrentIndex
+000924f0: 2831 290d 0a20 2020 2020 2020 2073 656c  (1)..        sel
+00092500: 662e 7061 7265 6e74 2e6c 6f61 6472 6567  f.parent.loadreg
+00092510: 696f 6e20 3d20 310d 0a20 2020 2020 2020  ion = 1..       
+00092520: 2063 6f6d 626f 2e61 6374 6976 6174 6564   combo.activated
+00092530: 5b69 6e74 5d2e 636f 6e6e 6563 7428 7365  [int].connect(se
+00092540: 6c66 2e4f 6e53 656c 6563 7452 6567 696f  lf.OnSelectRegio
+00092550: 6e29 0d0a 0d0a 2020 2020 2020 2020 6c61  n)....        la
+00092560: 796f 7574 2e61 6464 5769 6467 6574 2863  yout.addWidget(c
+00092570: 6f6d 626f 290d 0a0d 0a20 2020 2020 2020  ombo)....       
+00092580: 206d 6169 6e4c 6179 6f75 742e 6164 644c   mainLayout.addL
+00092590: 6179 6f75 7428 6c61 796f 7574 290d 0a0d  ayout(layout)...
+000925a0: 0a0d 0a20 2020 2020 2020 206c 6179 6f75  ...        layou
+000925b0: 7420 3d20 5174 5769 6467 6574 732e 5148  t = QtWidgets.QH
+000925c0: 426f 784c 6179 6f75 7428 290d 0a20 2020  BoxLayout()..   
+000925d0: 2020 2020 2062 7574 746f 6e20 3d20 5174       button = Qt
+000925e0: 5769 6467 6574 732e 5150 7573 6842 7574  Widgets.QPushBut
+000925f0: 746f 6e28 2253 7562 6d69 7422 2920 2373  ton("Submit") #s
+00092600: 7472 696e 6720 6f72 2069 636f 6e0d 0a20  tring or icon.. 
+00092610: 2020 2020 2020 2073 656c 662e 636f 6e6e         self.conn
+00092620: 6563 7428 6275 7474 6f6e 2c20 5174 436f  ect(button, QtCo
+00092630: 7265 2e53 4947 4e41 4c28 2263 6c69 636b  re.SIGNAL("click
+00092640: 6564 2829 2229 2c20 7365 6c66 2e63 6c6f  ed()"), self.clo
+00092650: 7365 290d 0a20 2020 2020 2020 206c 6179  se)..        lay
+00092660: 6f75 742e 6164 6457 6964 6765 7428 6275  out.addWidget(bu
+00092670: 7474 6f6e 290d 0a0d 0a20 2020 2020 2020  tton)....       
+00092680: 206d 6169 6e4c 6179 6f75 742e 6164 644c   mainLayout.addL
+00092690: 6179 6f75 7428 6c61 796f 7574 290d 0a20  ayout(layout).. 
+000926a0: 2020 2020 2020 2073 656c 662e 7365 744c         self.setL
+000926b0: 6179 6f75 7428 6d61 696e 4c61 796f 7574  ayout(mainLayout
+000926c0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+000926d0: 662e 7265 7369 7a65 2832 3530 2c20 3630  f.resize(250, 60
+000926e0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000926f0: 7365 7457 696e 646f 7754 6974 6c65 2874  setWindowTitle(t
+00092700: 6974 6c65 290d 0a0d 0a23 2d2d 2d2d 2d2d  itle)....#------
 00092710: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00092720: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00092730: 2d2d 0d0a 636c 6173 7320 4162 6f75 7446  --..class AboutF
-00092740: 7261 6d65 2851 7457 6964 6765 7473 2e51  rame(QtWidgets.Q
-00092750: 4469 616c 6f67 293a 0d0a 0d0a 2020 2020  Dialog):....    
-00092760: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00092770: 662c 2070 6172 656e 7420 3d20 4e6f 6e65  f, parent = None
-00092780: 2c20 7469 746c 653d 2741 626f 7574 2729  , title='About')
-00092790: 3a0d 0a20 2020 2020 2020 2051 7457 6964  :..        QtWid
-000927a0: 6765 7473 2e51 5769 6467 6574 2e5f 5f69  gets.QWidget.__i
-000927b0: 6e69 745f 5f28 7365 6c66 2c20 7061 7265  nit__(self, pare
-000927c0: 6e74 290d 0a0d 0a20 2020 2020 2020 2073  nt)....        s
-000927d0: 656c 662e 7265 7369 7a65 2833 3630 2c20  elf.resize(360, 
-000927e0: 3636 3029 0d0a 2020 2020 2020 2020 7365  660)..        se
-000927f0: 6c66 2e73 6574 5769 6e64 6f77 5469 746c  lf.setWindowTitl
-00092800: 6528 2741 626f 7574 204d 616e 7469 7327  e('About Mantis'
-00092810: 290d 0a0d 0a20 2020 2020 2020 2070 616c  )....        pal
-00092820: 203d 2051 7447 7569 2e51 5061 6c65 7474   = QtGui.QPalett
-00092830: 6528 290d 0a20 2020 2020 2020 2073 656c  e()..        sel
-00092840: 662e 7365 7441 7574 6f46 696c 6c42 6163  f.setAutoFillBac
-00092850: 6b67 726f 756e 6428 5472 7565 290d 0a20  kground(True).. 
-00092860: 2020 2020 2020 2070 616c 2e73 6574 436f         pal.setCo
-00092870: 6c6f 7228 5174 4775 692e 5150 616c 6574  lor(QtGui.QPalet
-00092880: 7465 2e57 696e 646f 772c 5174 4775 692e  te.Window,QtGui.
-00092890: 5143 6f6c 6f72 2827 7768 6974 6527 2929  QColor('white'))
-000928a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-000928b0: 6574 5061 6c65 7474 6528 7061 6c29 0d0a  etPalette(pal)..
-000928c0: 0d0a 2020 2020 2020 2020 7662 6f78 203d  ..        vbox =
-000928d0: 2051 7457 6964 6765 7473 2e51 5642 6f78   QtWidgets.QVBox
-000928e0: 4c61 796f 7574 2829 0d0a 0d0a 2020 2020  Layout()....    
-000928f0: 2020 2020 7365 6c66 2e69 6d61 6765 203d      self.image =
-00092900: 2051 7447 7569 2e51 496d 6167 6528 7265   QtGui.QImage(re
-00092910: 736f 7572 6365 5f70 6174 6828 6f73 2e70  source_path(os.p
-00092920: 6174 682e 6a6f 696e 2827 696d 6167 6573  ath.join('images
-00092930: 272c 274d 616e 7469 735f 6c6f 676f 5f61  ','Mantis_logo_a
-00092940: 626f 7574 2e70 6e67 2729 2929 0d0a 0d0a  bout.png')))....
-00092950: 2020 2020 2020 2020 7365 6c66 2e69 6d61          self.ima
-00092960: 6765 4c61 6265 6c20 3d20 5174 5769 6467  geLabel = QtWidg
-00092970: 6574 732e 514c 6162 656c 2829 0d0a 2020  ets.QLabel()..  
-00092980: 2020 2020 2020 7365 6c66 2e69 6d61 6765        self.image
-00092990: 4c61 6265 6c2e 7365 7442 6163 6b67 726f  Label.setBackgro
-000929a0: 756e 6452 6f6c 6528 5174 4775 692e 5150  undRole(QtGui.QP
-000929b0: 616c 6574 7465 2e42 6173 6529 0d0a 0d0a  alette.Base)....
-000929c0: 2020 2020 2020 2020 7365 6c66 2e69 6d61          self.ima
-000929d0: 6765 4c61 6265 6c2e 7365 7450 6978 6d61  geLabel.setPixma
-000929e0: 7028 5174 4775 692e 5150 6978 6d61 702e  p(QtGui.QPixmap.
-000929f0: 6672 6f6d 496d 6167 6528 7365 6c66 2e69  fromImage(self.i
-00092a00: 6d61 6765 2929 0d0a 2020 2020 2020 2020  mage))..        
-00092a10: 7662 6f78 2e61 6464 5769 6467 6574 2873  vbox.addWidget(s
-00092a20: 656c 662e 696d 6167 654c 6162 656c 290d  elf.imageLabel).
-00092a30: 0a0d 0a0d 0a0d 0a20 2020 2020 2020 2074  .......        t
-00092a40: 6578 7431 203d 2051 7457 6964 6765 7473  ext1 = QtWidgets
-00092a50: 2e51 4c61 6265 6c28 7365 6c66 290d 0a20  .QLabel(self).. 
-00092a60: 2020 2020 2020 2074 6578 7431 2e73 6574         text1.set
-00092a70: 5465 7874 2822 7777 772e 326e 646c 6f6f  Text("www.2ndloo
-00092a80: 6b63 6f6e 7375 6c74 696e 672e 636f 6d22  kconsulting.com"
-00092a90: 290d 0a20 2020 2020 2020 2074 6578 7431  )..        text1
-00092aa0: 2e73 6574 5374 796c 6553 6865 6574 2827  .setStyleSheet('
-00092ab0: 636f 6c6f 723a 2072 6762 2835 332c 3135  color: rgb(53,15
-00092ac0: 392c 3231 3729 3b66 6f6e 742d 7369 7a65  9,217);font-size
-00092ad0: 3a20 3134 7074 3b20 666f 6e74 2d66 616d  : 14pt; font-fam
-00092ae0: 696c 793a 2053 616e 7353 6572 6966 3b27  ily: SansSerif;'
-00092af0: 290d 0a20 2020 2020 2020 2023 7465 7874  )..        #text
-00092b00: 312e 7365 7446 6f6e 7428 5174 4775 692e  1.setFont(QtGui.
-00092b10: 5146 6f6e 7428 2753 616e 7353 6572 6966  QFont('SansSerif
-00092b20: 272c 2031 3429 290d 0a0d 0a20 2020 2020  ', 14))....     
-00092b30: 2020 2023 666f 6e74 3220 3d20 7778 2e46     #font2 = wx.F
-00092b40: 6f6e 7428 3132 2c20 7778 2e53 5749 5353  ont(12, wx.SWISS
-00092b50: 2c20 7778 2e4e 4f52 4d41 4c2c 2077 782e  , wx.NORMAL, wx.
-00092b60: 4e4f 524d 414c 290d 0a20 2020 2020 2020  NORMAL)..       
-00092b70: 2074 6578 7432 203d 2051 7457 6964 6765   text2 = QtWidge
-00092b80: 7473 2e51 4c61 6265 6c28 7365 6c66 290d  ts.QLabel(self).
-00092b90: 0a20 2020 2020 2020 2074 6578 7432 2e73  .        text2.s
-00092ba0: 6574 5465 7874 2827 4d61 6e74 6973 2027  etText('Mantis '
-00092bb0: 2b76 6572 7369 6f6e 290d 0a20 2020 2020  +version)..     
-00092bc0: 2020 2074 6578 7432 2e73 6574 5374 796c     text2.setStyl
-00092bd0: 6553 6865 6574 2827 666f 6e74 2d73 697a  eSheet('font-siz
-00092be0: 653a 2031 3270 7427 290d 0a20 2020 2020  e: 12pt')..     
-00092bf0: 2020 2023 7465 7874 322e 5365 7446 6f6e     #text2.SetFon
-00092c00: 7428 666f 6e74 3229 0d0a 0d0a 2020 2020  t(font2)....    
-00092c10: 2020 2020 2366 6f6e 7433 203d 2077 782e      #font3 = wx.
-00092c20: 466f 6e74 2838 2c20 7778 2e53 5749 5353  Font(8, wx.SWISS
-00092c30: 2c20 7778 2e4e 4f52 4d41 4c2c 2077 782e  , wx.NORMAL, wx.
-00092c40: 4e4f 524d 414c 290d 0a20 2020 2020 2020  NORMAL)..       
-00092c50: 2074 6578 7433 203d 2051 7457 6964 6765   text3 = QtWidge
-00092c60: 7473 2e51 4c61 6265 6c28 7365 6c66 290d  ts.QLabel(self).
-00092c70: 0a20 2020 2020 2020 2074 6578 7433 2e73  .        text3.s
-00092c80: 6574 5465 7874 2820 2727 270d 0a44 6576  etText( '''..Dev
-00092c90: 656c 6f70 6564 2062 7920 4d69 726e 6120  eloped by Mirna 
-00092ca0: 4c65 726f 7469 632c 2062 6173 6564 206f  Lerotic, based o
-00092cb0: 6e20 6561 726c 6965 7220 7072 6f67 7261  n earlier progra
-00092cc0: 6d73 2062 7920 4d69 726e 610d 0a4c 6572  ms by Mirna..Ler
-00092cd0: 6f74 6963 2061 6e64 2043 6872 6973 204a  otic and Chris J
-00092ce0: 6163 6f62 7365 6e2e 2049 6e69 7469 616c  acobsen. Initial
-00092cf0: 2064 6576 656c 6f70 6d65 6e74 2073 7570   development sup
-00092d00: 706f 7274 6564 2062 790d 0a41 7267 6f6e  ported by..Argon
-00092d10: 6e65 204e 6174 696f 6e61 6c20 4c61 626f  ne National Labo
-00092d20: 7261 746f 7279 204c 4452 4420 3230 3130  ratory LDRD 2010
-00092d30: 2d31 3933 2d52 3120 3931 3133 2e20 2727  -193-R1 9113. ''
-00092d40: 2729 0d0a 2020 2020 2020 2020 2374 6578  ')..        #tex
-00092d50: 7433 2e53 6574 466f 6e74 2866 6f6e 7433  t3.SetFont(font3
-00092d60: 290d 0a0d 0a0d 0a20 2020 2020 2020 2023  )......        #
-00092d70: 666f 6e74 3420 3d20 7778 2e46 6f6e 7428  font4 = wx.Font(
-00092d80: 382c 2077 782e 5357 4953 532c 2077 782e  8, wx.SWISS, wx.
-00092d90: 4e4f 524d 414c 2c20 7778 2e4e 4f52 4d41  NORMAL, wx.NORMA
-00092da0: 4c29 0d0a 2020 2020 2020 2020 7465 7874  L)..        text
-00092db0: 3420 3d20 5174 5769 6467 6574 732e 514c  4 = QtWidgets.QL
-00092dc0: 6162 656c 2873 656c 6629 0d0a 2020 2020  abel(self)..    
-00092dd0: 2020 2020 7465 7874 342e 7365 7454 6578      text4.setTex
-00092de0: 7428 2027 2727 0d0a 4d61 6e74 6973 2069  t( '''..Mantis i
-00092df0: 7320 6672 6565 2073 6f66 7477 6172 653a  s free software:
-00092e00: 2079 6f75 2063 616e 2072 6564 6973 7472   you can redistr
-00092e10: 6962 7574 6520 6974 2061 6e64 2f6f 7220  ibute it and/or 
-00092e20: 6d6f 6469 6679 0d0a 6974 2075 6e64 6572  modify..it under
-00092e30: 2074 6865 2074 6572 6d73 206f 6620 7468   the terms of th
-00092e40: 6520 474e 5520 4765 6e65 7261 6c20 5075  e GNU General Pu
-00092e50: 626c 6963 204c 6963 656e 7365 2061 7320  blic License as 
-00092e60: 7075 626c 6973 6865 640d 0a62 7920 7468  published..by th
-00092e70: 6520 4672 6565 2053 6f66 7477 6172 6520  e Free Software 
-00092e80: 466f 756e 6461 7469 6f6e 2c20 6569 7468  Foundation, eith
-00092e90: 6572 2076 6572 7369 6f6e 2033 206f 6620  er version 3 of 
-00092ea0: 7468 6520 4c69 6365 6e73 652c 0d0a 6f72  the License,..or
-00092eb0: 2061 6e79 206c 6174 6572 2076 6572 7369   any later versi
-00092ec0: 6f6e 2e0d 0a0d 0a4d 616e 7469 7320 6973  on.....Mantis is
-00092ed0: 2064 6973 7472 6962 7574 6564 2069 6e20   distributed in 
-00092ee0: 7468 6520 686f 7065 2074 6861 7420 6974  the hope that it
-00092ef0: 2077 696c 6c20 6265 2075 7365 6675 6c2c   will be useful,
-00092f00: 0d0a 6275 7420 5749 5448 4f55 5420 414e  ..but WITHOUT AN
-00092f10: 5920 5741 5252 414e 5459 3b20 7769 7468  Y WARRANTY; with
-00092f20: 6f75 7420 6576 656e 2074 6865 2069 6d70  out even the imp
-00092f30: 6c69 6564 2077 6172 7261 6e74 790d 0a6f  lied warranty..o
-00092f40: 6620 4d45 5243 4841 4e54 4142 494c 4954  f MERCHANTABILIT
-00092f50: 5920 6f72 2046 4954 4e45 5353 2046 4f52  Y or FITNESS FOR
-00092f60: 2041 2050 4152 5449 4355 4c41 5220 5055   A PARTICULAR PU
-00092f70: 5250 4f53 452e 0d0a 5365 6520 7468 6520  RPOSE...See the 
-00092f80: 474e 5520 4765 6e65 7261 6c20 5075 626c  GNU General Publ
-00092f90: 6963 204c 6963 656e 7365 2066 6f72 206d  ic License for m
-00092fa0: 6f72 6520 6465 7461 696c 730d 0a68 7474  ore details..htt
-00092fb0: 703a 2f2f 7777 772e 676e 752e 6f72 672f  p://www.gnu.org/
-00092fc0: 6c69 6365 6e73 6573 2f2e 2727 2729 0d0a  licenses/.''')..
-00092fd0: 2020 2020 2020 2020 2374 6578 7434 2e53          #text4.S
-00092fe0: 6574 466f 6e74 2866 6f6e 7434 290d 0a0d  etFont(font4)...
-00092ff0: 0a20 2020 2020 2020 2076 626f 782e 6164  .        vbox.ad
-00093000: 6453 7472 6574 6368 2831 290d 0a20 2020  dStretch(1)..   
-00093010: 2020 2020 2068 626f 7820 3d20 5174 5769       hbox = QtWi
-00093020: 6467 6574 732e 5148 426f 784c 6179 6f75  dgets.QHBoxLayou
-00093030: 7428 290d 0a20 2020 2020 2020 2068 626f  t()..        hbo
-00093040: 782e 6164 6453 7472 6574 6368 2831 290d  x.addStretch(1).
-00093050: 0a20 2020 2020 2020 2076 626f 7832 203d  .        vbox2 =
-00093060: 2051 7457 6964 6765 7473 2e51 5642 6f78   QtWidgets.QVBox
-00093070: 4c61 796f 7574 2829 0d0a 2020 2020 2020  Layout()..      
-00093080: 2020 7662 6f78 322e 6164 6457 6964 6765    vbox2.addWidge
-00093090: 7428 7465 7874 3129 0d0a 2020 2020 2020  t(text1)..      
-000930a0: 2020 7662 6f78 322e 6164 6453 7472 6574    vbox2.addStret
-000930b0: 6368 2830 2e35 290d 0a20 2020 2020 2020  ch(0.5)..       
-000930c0: 2076 626f 7832 2e61 6464 5769 6467 6574   vbox2.addWidget
-000930d0: 2874 6578 7432 290d 0a20 2020 2020 2020  (text2)..       
-000930e0: 2076 626f 7832 2e61 6464 5769 6467 6574   vbox2.addWidget
-000930f0: 2874 6578 7433 290d 0a20 2020 2020 2020  (text3)..       
-00093100: 2076 626f 7832 2e61 6464 5769 6467 6574   vbox2.addWidget
-00093110: 2874 6578 7434 290d 0a20 2020 2020 2020  (text4)..       
-00093120: 2068 626f 782e 6164 644c 6179 6f75 7428   hbox.addLayout(
-00093130: 7662 6f78 3229 0d0a 2020 2020 2020 2020  vbox2)..        
-00093140: 6862 6f78 2e61 6464 5374 7265 7463 6828  hbox.addStretch(
-00093150: 3129 0d0a 2020 2020 2020 2020 7662 6f78  1)..        vbox
-00093160: 2e61 6464 4c61 796f 7574 2868 626f 7829  .addLayout(hbox)
-00093170: 0d0a 2020 2020 2020 2020 7662 6f78 2e61  ..        vbox.a
-00093180: 6464 5374 7265 7463 6828 3129 0d0a 0d0a  ddStretch(1)....
-00093190: 2020 2020 2020 2020 6275 7474 6f6e 5f63          button_c
-000931a0: 6c6f 7365 203d 2051 7457 6964 6765 7473  lose = QtWidgets
-000931b0: 2e51 5075 7368 4275 7474 6f6e 2827 436c  .QPushButton('Cl
-000931c0: 6f73 6527 290d 0a20 2020 2020 2020 2062  ose')..        b
-000931d0: 7574 746f 6e5f 636c 6f73 652e 636c 6963  utton_close.clic
-000931e0: 6b65 642e 636f 6e6e 6563 7428 2073 656c  ked.connect( sel
-000931f0: 662e 636c 6f73 6529 0d0a 2020 2020 2020  f.close)..      
-00093200: 2020 7662 6f78 2e61 6464 5769 6467 6574    vbox.addWidget
-00093210: 2862 7574 746f 6e5f 636c 6f73 6529 0d0a  (button_close)..
-00093220: 2020 2020 2020 2020 7662 6f78 2e61 6464          vbox.add
-00093230: 5374 7265 7463 6828 302e 3529 0d0a 0d0a  Stretch(0.5)....
-00093240: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00093250: 2e73 6574 4c61 796f 7574 2876 626f 7829  .setLayout(vbox)
-00093260: 0d0a 0d0a 2222 2220 2d2d 2d2d 2d2d 2d2d  ....""" --------
-00093270: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00093280: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00093290: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000932a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000932b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000932c0: 2d2d 2d2d 2d2d 2d2d 2222 220d 0a63 6c61  --------"""..cla
-000932d0: 7373 204d 6169 6e46 7261 6d65 2851 7457  ss MainFrame(QtW
-000932e0: 6964 6765 7473 2e51 4d61 696e 5769 6e64  idgets.QMainWind
-000932f0: 6f77 293a 0d0a 0d0a 2020 2020 6465 6620  ow):....    def 
-00093300: 5f5f 696e 6974 5f5f 2873 656c 6629 3a0d  __init__(self):.
-00093310: 0a20 2020 2020 2020 2073 7570 6572 284d  .        super(M
-00093320: 6169 6e46 7261 6d65 2c20 7365 6c66 292e  ainFrame, self).
-00093330: 5f5f 696e 6974 5f5f 2829 0d0a 0d0a 2020  __init__()....  
-00093340: 2020 2020 2020 7365 6c66 2e69 6e69 7455        self.initU
-00093350: 4928 290d 0a0d 0a0d 0a0d 0a23 2d2d 2d2d  I()........#----
+00092730: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00092740: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00092750: 0d0a 2020 2020 6465 6620 4f6e 5365 6c65  ..    def OnSele
+00092760: 6374 5265 6769 6f6e 2873 656c 662c 2076  ctRegion(self, v
+00092770: 616c 7565 293a 0d0a 2020 2020 2020 2020  alue):..        
+00092780: 6974 656d 203d 2076 616c 7565 0d0a 2020  item = value..  
+00092790: 2020 2020 2020 7365 6c72 6567 696f 6e20        selregion 
+000927a0: 3d20 6974 656d 0d0a 2020 2020 2020 2020  = item..        
+000927b0: 7365 6c66 2e70 6172 656e 742e 6c6f 6164  self.parent.load
+000927c0: 7265 6769 6f6e 203d 2073 656c 7265 6769  region = selregi
+000927d0: 6f6e 0d0a 0d0a 0d0a 0d0a 232d 2d2d 2d2d  on........#-----
+000927e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000927f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00092800: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00092810: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00092820: 2d0d 0a63 6c61 7373 2041 626f 7574 4672  -..class AboutFr
+00092830: 616d 6528 5174 5769 6467 6574 732e 5144  ame(QtWidgets.QD
+00092840: 6961 6c6f 6729 3a0d 0a0d 0a20 2020 2064  ialog):....    d
+00092850: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+00092860: 2c20 7061 7265 6e74 203d 204e 6f6e 652c  , parent = None,
+00092870: 2074 6974 6c65 3d27 4162 6f75 7427 293a   title='About'):
+00092880: 0d0a 2020 2020 2020 2020 5174 5769 6467  ..        QtWidg
+00092890: 6574 732e 5157 6964 6765 742e 5f5f 696e  ets.QWidget.__in
+000928a0: 6974 5f5f 2873 656c 662c 2070 6172 656e  it__(self, paren
+000928b0: 7429 0d0a 0d0a 2020 2020 2020 2020 7365  t)....        se
+000928c0: 6c66 2e72 6573 697a 6528 3336 302c 2036  lf.resize(360, 6
+000928d0: 3630 290d 0a20 2020 2020 2020 2073 656c  60)..        sel
+000928e0: 662e 7365 7457 696e 646f 7754 6974 6c65  f.setWindowTitle
+000928f0: 2827 4162 6f75 7420 4d61 6e74 6973 2729  ('About Mantis')
+00092900: 0d0a 0d0a 2020 2020 2020 2020 7061 6c20  ....        pal 
+00092910: 3d20 5174 4775 692e 5150 616c 6574 7465  = QtGui.QPalette
+00092920: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+00092930: 2e73 6574 4175 746f 4669 6c6c 4261 636b  .setAutoFillBack
+00092940: 6772 6f75 6e64 2854 7275 6529 0d0a 2020  ground(True)..  
+00092950: 2020 2020 2020 7061 6c2e 7365 7443 6f6c        pal.setCol
+00092960: 6f72 2851 7447 7569 2e51 5061 6c65 7474  or(QtGui.QPalett
+00092970: 652e 5769 6e64 6f77 2c51 7447 7569 2e51  e.Window,QtGui.Q
+00092980: 436f 6c6f 7228 2777 6869 7465 2729 290d  Color('white')).
+00092990: 0a20 2020 2020 2020 2073 656c 662e 7365  .        self.se
+000929a0: 7450 616c 6574 7465 2870 616c 290d 0a0d  tPalette(pal)...
+000929b0: 0a20 2020 2020 2020 2076 626f 7820 3d20  .        vbox = 
+000929c0: 5174 5769 6467 6574 732e 5156 426f 784c  QtWidgets.QVBoxL
+000929d0: 6179 6f75 7428 290d 0a0d 0a20 2020 2020  ayout()....     
+000929e0: 2020 2073 656c 662e 696d 6167 6520 3d20     self.image = 
+000929f0: 5174 4775 692e 5149 6d61 6765 2872 6573  QtGui.QImage(res
+00092a00: 6f75 7263 655f 7061 7468 286f 732e 7061  ource_path(os.pa
+00092a10: 7468 2e6a 6f69 6e28 2769 6d61 6765 7327  th.join('images'
+00092a20: 2c27 4d61 6e74 6973 5f6c 6f67 6f5f 6162  ,'Mantis_logo_ab
+00092a30: 6f75 742e 706e 6727 2929 290d 0a0d 0a20  out.png'))).... 
+00092a40: 2020 2020 2020 2073 656c 662e 696d 6167         self.imag
+00092a50: 654c 6162 656c 203d 2051 7457 6964 6765  eLabel = QtWidge
+00092a60: 7473 2e51 4c61 6265 6c28 290d 0a20 2020  ts.QLabel()..   
+00092a70: 2020 2020 2073 656c 662e 696d 6167 654c       self.imageL
+00092a80: 6162 656c 2e73 6574 4261 636b 6772 6f75  abel.setBackgrou
+00092a90: 6e64 526f 6c65 2851 7447 7569 2e51 5061  ndRole(QtGui.QPa
+00092aa0: 6c65 7474 652e 4261 7365 290d 0a0d 0a20  lette.Base).... 
+00092ab0: 2020 2020 2020 2073 656c 662e 696d 6167         self.imag
+00092ac0: 654c 6162 656c 2e73 6574 5069 786d 6170  eLabel.setPixmap
+00092ad0: 2851 7447 7569 2e51 5069 786d 6170 2e66  (QtGui.QPixmap.f
+00092ae0: 726f 6d49 6d61 6765 2873 656c 662e 696d  romImage(self.im
+00092af0: 6167 6529 290d 0a20 2020 2020 2020 2076  age))..        v
+00092b00: 626f 782e 6164 6457 6964 6765 7428 7365  box.addWidget(se
+00092b10: 6c66 2e69 6d61 6765 4c61 6265 6c29 0d0a  lf.imageLabel)..
+00092b20: 0d0a 0d0a 0d0a 2020 2020 2020 2020 7465  ......        te
+00092b30: 7874 3120 3d20 5174 5769 6467 6574 732e  xt1 = QtWidgets.
+00092b40: 514c 6162 656c 2873 656c 6629 0d0a 2020  QLabel(self)..  
+00092b50: 2020 2020 2020 7465 7874 312e 7365 7454        text1.setT
+00092b60: 6578 7428 2277 7777 2e32 6e64 6c6f 6f6b  ext("www.2ndlook
+00092b70: 636f 6e73 756c 7469 6e67 2e63 6f6d 2229  consulting.com")
+00092b80: 0d0a 2020 2020 2020 2020 7465 7874 312e  ..        text1.
+00092b90: 7365 7453 7479 6c65 5368 6565 7428 2763  setStyleSheet('c
+00092ba0: 6f6c 6f72 3a20 7267 6228 3533 2c31 3539  olor: rgb(53,159
+00092bb0: 2c32 3137 293b 666f 6e74 2d73 697a 653a  ,217);font-size:
+00092bc0: 2031 3470 743b 2066 6f6e 742d 6661 6d69   14pt; font-fami
+00092bd0: 6c79 3a20 5361 6e73 5365 7269 663b 2729  ly: SansSerif;')
+00092be0: 0d0a 2020 2020 2020 2020 2374 6578 7431  ..        #text1
+00092bf0: 2e73 6574 466f 6e74 2851 7447 7569 2e51  .setFont(QtGui.Q
+00092c00: 466f 6e74 2827 5361 6e73 5365 7269 6627  Font('SansSerif'
+00092c10: 2c20 3134 2929 0d0a 0d0a 2020 2020 2020  , 14))....      
+00092c20: 2020 2366 6f6e 7432 203d 2077 782e 466f    #font2 = wx.Fo
+00092c30: 6e74 2831 322c 2077 782e 5357 4953 532c  nt(12, wx.SWISS,
+00092c40: 2077 782e 4e4f 524d 414c 2c20 7778 2e4e   wx.NORMAL, wx.N
+00092c50: 4f52 4d41 4c29 0d0a 2020 2020 2020 2020  ORMAL)..        
+00092c60: 7465 7874 3220 3d20 5174 5769 6467 6574  text2 = QtWidget
+00092c70: 732e 514c 6162 656c 2873 656c 6629 0d0a  s.QLabel(self)..
+00092c80: 2020 2020 2020 2020 7465 7874 322e 7365          text2.se
+00092c90: 7454 6578 7428 274d 616e 7469 7320 272b  tText('Mantis '+
+00092ca0: 7665 7273 696f 6e29 0d0a 2020 2020 2020  version)..      
+00092cb0: 2020 7465 7874 322e 7365 7453 7479 6c65    text2.setStyle
+00092cc0: 5368 6565 7428 2766 6f6e 742d 7369 7a65  Sheet('font-size
+00092cd0: 3a20 3132 7074 2729 0d0a 2020 2020 2020  : 12pt')..      
+00092ce0: 2020 2374 6578 7432 2e53 6574 466f 6e74    #text2.SetFont
+00092cf0: 2866 6f6e 7432 290d 0a0d 0a20 2020 2020  (font2)....     
+00092d00: 2020 2023 666f 6e74 3320 3d20 7778 2e46     #font3 = wx.F
+00092d10: 6f6e 7428 382c 2077 782e 5357 4953 532c  ont(8, wx.SWISS,
+00092d20: 2077 782e 4e4f 524d 414c 2c20 7778 2e4e   wx.NORMAL, wx.N
+00092d30: 4f52 4d41 4c29 0d0a 2020 2020 2020 2020  ORMAL)..        
+00092d40: 7465 7874 3320 3d20 5174 5769 6467 6574  text3 = QtWidget
+00092d50: 732e 514c 6162 656c 2873 656c 6629 0d0a  s.QLabel(self)..
+00092d60: 2020 2020 2020 2020 7465 7874 332e 7365          text3.se
+00092d70: 7454 6578 7428 2027 2727 0d0a 4465 7665  tText( '''..Deve
+00092d80: 6c6f 7065 6420 6279 204d 6972 6e61 204c  loped by Mirna L
+00092d90: 6572 6f74 6963 2c20 6261 7365 6420 6f6e  erotic, based on
+00092da0: 2065 6172 6c69 6572 2070 726f 6772 616d   earlier program
+00092db0: 7320 6279 204d 6972 6e61 0d0a 4c65 726f  s by Mirna..Lero
+00092dc0: 7469 6320 616e 6420 4368 7269 7320 4a61  tic and Chris Ja
+00092dd0: 636f 6273 656e 2e20 496e 6974 6961 6c20  cobsen. Initial 
+00092de0: 6465 7665 6c6f 706d 656e 7420 7375 7070  development supp
+00092df0: 6f72 7465 6420 6279 0d0a 4172 676f 6e6e  orted by..Argonn
+00092e00: 6520 4e61 7469 6f6e 616c 204c 6162 6f72  e National Labor
+00092e10: 6174 6f72 7920 4c44 5244 2032 3031 302d  atory LDRD 2010-
+00092e20: 3139 332d 5231 2039 3131 332e 2027 2727  193-R1 9113. '''
+00092e30: 290d 0a20 2020 2020 2020 2023 7465 7874  )..        #text
+00092e40: 332e 5365 7446 6f6e 7428 666f 6e74 3329  3.SetFont(font3)
+00092e50: 0d0a 0d0a 0d0a 2020 2020 2020 2020 2366  ......        #f
+00092e60: 6f6e 7434 203d 2077 782e 466f 6e74 2838  ont4 = wx.Font(8
+00092e70: 2c20 7778 2e53 5749 5353 2c20 7778 2e4e  , wx.SWISS, wx.N
+00092e80: 4f52 4d41 4c2c 2077 782e 4e4f 524d 414c  ORMAL, wx.NORMAL
+00092e90: 290d 0a20 2020 2020 2020 2074 6578 7434  )..        text4
+00092ea0: 203d 2051 7457 6964 6765 7473 2e51 4c61   = QtWidgets.QLa
+00092eb0: 6265 6c28 7365 6c66 290d 0a20 2020 2020  bel(self)..     
+00092ec0: 2020 2074 6578 7434 2e73 6574 5465 7874     text4.setText
+00092ed0: 2820 2727 270d 0a4d 616e 7469 7320 6973  ( '''..Mantis is
+00092ee0: 2066 7265 6520 736f 6674 7761 7265 3a20   free software: 
+00092ef0: 796f 7520 6361 6e20 7265 6469 7374 7269  you can redistri
+00092f00: 6275 7465 2069 7420 616e 642f 6f72 206d  bute it and/or m
+00092f10: 6f64 6966 790d 0a69 7420 756e 6465 7220  odify..it under 
+00092f20: 7468 6520 7465 726d 7320 6f66 2074 6865  the terms of the
+00092f30: 2047 4e55 2047 656e 6572 616c 2050 7562   GNU General Pub
+00092f40: 6c69 6320 4c69 6365 6e73 6520 6173 2070  lic License as p
+00092f50: 7562 6c69 7368 6564 0d0a 6279 2074 6865  ublished..by the
+00092f60: 2046 7265 6520 536f 6674 7761 7265 2046   Free Software F
+00092f70: 6f75 6e64 6174 696f 6e2c 2065 6974 6865  oundation, eithe
+00092f80: 7220 7665 7273 696f 6e20 3320 6f66 2074  r version 3 of t
+00092f90: 6865 204c 6963 656e 7365 2c0d 0a6f 7220  he License,..or 
+00092fa0: 616e 7920 6c61 7465 7220 7665 7273 696f  any later versio
+00092fb0: 6e2e 0d0a 0d0a 4d61 6e74 6973 2069 7320  n.....Mantis is 
+00092fc0: 6469 7374 7269 6275 7465 6420 696e 2074  distributed in t
+00092fd0: 6865 2068 6f70 6520 7468 6174 2069 7420  he hope that it 
+00092fe0: 7769 6c6c 2062 6520 7573 6566 756c 2c0d  will be useful,.
+00092ff0: 0a62 7574 2057 4954 484f 5554 2041 4e59  .but WITHOUT ANY
+00093000: 2057 4152 5241 4e54 593b 2077 6974 686f   WARRANTY; witho
+00093010: 7574 2065 7665 6e20 7468 6520 696d 706c  ut even the impl
+00093020: 6965 6420 7761 7272 616e 7479 0d0a 6f66  ied warranty..of
+00093030: 204d 4552 4348 414e 5441 4249 4c49 5459   MERCHANTABILITY
+00093040: 206f 7220 4649 544e 4553 5320 464f 5220   or FITNESS FOR 
+00093050: 4120 5041 5254 4943 554c 4152 2050 5552  A PARTICULAR PUR
+00093060: 504f 5345 2e0d 0a53 6565 2074 6865 2047  POSE...See the G
+00093070: 4e55 2047 656e 6572 616c 2050 7562 6c69  NU General Publi
+00093080: 6320 4c69 6365 6e73 6520 666f 7220 6d6f  c License for mo
+00093090: 7265 2064 6574 6169 6c73 0d0a 6874 7470  re details..http
+000930a0: 3a2f 2f77 7777 2e67 6e75 2e6f 7267 2f6c  ://www.gnu.org/l
+000930b0: 6963 656e 7365 732f 2e27 2727 290d 0a20  icenses/.''').. 
+000930c0: 2020 2020 2020 2023 7465 7874 342e 5365         #text4.Se
+000930d0: 7446 6f6e 7428 666f 6e74 3429 0d0a 0d0a  tFont(font4)....
+000930e0: 2020 2020 2020 2020 7662 6f78 2e61 6464          vbox.add
+000930f0: 5374 7265 7463 6828 3129 0d0a 2020 2020  Stretch(1)..    
+00093100: 2020 2020 6862 6f78 203d 2051 7457 6964      hbox = QtWid
+00093110: 6765 7473 2e51 4842 6f78 4c61 796f 7574  gets.QHBoxLayout
+00093120: 2829 0d0a 2020 2020 2020 2020 6862 6f78  ()..        hbox
+00093130: 2e61 6464 5374 7265 7463 6828 3129 0d0a  .addStretch(1)..
+00093140: 2020 2020 2020 2020 7662 6f78 3220 3d20          vbox2 = 
+00093150: 5174 5769 6467 6574 732e 5156 426f 784c  QtWidgets.QVBoxL
+00093160: 6179 6f75 7428 290d 0a20 2020 2020 2020  ayout()..       
+00093170: 2076 626f 7832 2e61 6464 5769 6467 6574   vbox2.addWidget
+00093180: 2874 6578 7431 290d 0a20 2020 2020 2020  (text1)..       
+00093190: 2076 626f 7832 2e61 6464 5374 7265 7463   vbox2.addStretc
+000931a0: 6828 302e 3529 0d0a 2020 2020 2020 2020  h(0.5)..        
+000931b0: 7662 6f78 322e 6164 6457 6964 6765 7428  vbox2.addWidget(
+000931c0: 7465 7874 3229 0d0a 2020 2020 2020 2020  text2)..        
+000931d0: 7662 6f78 322e 6164 6457 6964 6765 7428  vbox2.addWidget(
+000931e0: 7465 7874 3329 0d0a 2020 2020 2020 2020  text3)..        
+000931f0: 7662 6f78 322e 6164 6457 6964 6765 7428  vbox2.addWidget(
+00093200: 7465 7874 3429 0d0a 2020 2020 2020 2020  text4)..        
+00093210: 6862 6f78 2e61 6464 4c61 796f 7574 2876  hbox.addLayout(v
+00093220: 626f 7832 290d 0a20 2020 2020 2020 2068  box2)..        h
+00093230: 626f 782e 6164 6453 7472 6574 6368 2831  box.addStretch(1
+00093240: 290d 0a20 2020 2020 2020 2076 626f 782e  )..        vbox.
+00093250: 6164 644c 6179 6f75 7428 6862 6f78 290d  addLayout(hbox).
+00093260: 0a20 2020 2020 2020 2076 626f 782e 6164  .        vbox.ad
+00093270: 6453 7472 6574 6368 2831 290d 0a0d 0a20  dStretch(1).... 
+00093280: 2020 2020 2020 2062 7574 746f 6e5f 636c         button_cl
+00093290: 6f73 6520 3d20 5174 5769 6467 6574 732e  ose = QtWidgets.
+000932a0: 5150 7573 6842 7574 746f 6e28 2743 6c6f  QPushButton('Clo
+000932b0: 7365 2729 0d0a 2020 2020 2020 2020 6275  se')..        bu
+000932c0: 7474 6f6e 5f63 6c6f 7365 2e63 6c69 636b  tton_close.click
+000932d0: 6564 2e63 6f6e 6e65 6374 2820 7365 6c66  ed.connect( self
+000932e0: 2e63 6c6f 7365 290d 0a20 2020 2020 2020  .close)..       
+000932f0: 2076 626f 782e 6164 6457 6964 6765 7428   vbox.addWidget(
+00093300: 6275 7474 6f6e 5f63 6c6f 7365 290d 0a20  button_close).. 
+00093310: 2020 2020 2020 2076 626f 782e 6164 6453         vbox.addS
+00093320: 7472 6574 6368 2830 2e35 290d 0a0d 0a0d  tretch(0.5).....
+00093330: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00093340: 7365 744c 6179 6f75 7428 7662 6f78 290d  setLayout(vbox).
+00093350: 0a0d 0a22 2222 202d 2d2d 2d2d 2d2d 2d2d  ...""" ---------
 00093360: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00093370: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00093380: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00093390: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000933a0: 2d2d 0d0a 2020 2020 6465 6620 696e 6974  --..    def init
-000933b0: 5549 2873 656c 6629 3a0d 0a0d 0a20 2020  UI(self):....   
-000933c0: 2020 2020 2073 656c 662e 6461 7461 5f73       self.data_s
-000933d0: 7472 7563 7420 3d20 6461 7461 5f73 7472  truct = data_str
-000933e0: 7563 742e 6835 2829 0d0a 2020 2020 2020  uct.h5()..      
-000933f0: 2020 7365 6c66 2e73 746b 203d 2064 6174    self.stk = dat
-00093400: 615f 7374 6163 6b2e 6461 7461 2873 656c  a_stack.data(sel
-00093410: 662e 6461 7461 5f73 7472 7563 7429 0d0a  f.data_struct)..
-00093420: 2020 2020 2020 2020 7365 6c66 2e61 6e6c          self.anl
-00093430: 7a20 3d20 616e 616c 797a 652e 616e 616c  z = analyze.anal
-00093440: 797a 6528 7365 6c66 2e73 746b 290d 0a20  yze(self.stk).. 
-00093450: 2020 2020 2020 2073 656c 662e 6e6e 6d61         self.nnma
-00093460: 203d 206e 6e6d 612e 6e6e 6d61 2873 656c   = nnma.nnma(sel
-00093470: 662e 7374 6b29 0d0a 2020 2020 2020 2020  f.stk)..        
-00093480: 7365 6c66 2e63 6f6d 6d6f 6e20 3d20 636f  self.common = co
-00093490: 6d6d 6f6e 2829 0d0a 0d0a 0d0a 2020 2020  mmon()......    
-000934a0: 2020 2020 7365 6c66 2e72 6573 697a 6528      self.resize(
-000934b0: 5769 6e73 697a 6578 2c20 5769 6e73 697a  Winsizex, Winsiz
-000934c0: 6579 290d 0a20 2020 2020 2020 2073 656c  ey)..        sel
-000934d0: 662e 7365 7457 696e 646f 7754 6974 6c65  f.setWindowTitle
-000934e0: 2827 4d61 6e74 6973 2076 2e7b 307d 272e  ('Mantis v.{0}'.
-000934f0: 666f 726d 6174 2876 6572 7369 6f6e 2929  format(version))
-00093500: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00093510: 2e69 6e69 7454 6f6f 6c62 6172 2829 0d0a  .initToolbar()..
-00093520: 0d0a 0d0a 2020 2020 2020 2020 6963 6f20  ....        ico 
-00093530: 3d20 5174 4775 692e 5149 636f 6e28 7265  = QtGui.QIcon(re
-00093540: 736f 7572 6365 5f70 6174 6828 6f73 2e70  source_path(os.p
-00093550: 6174 682e 6a6f 696e 2827 696d 6167 6573  ath.join('images
-00093560: 272c 276c 6f67 6f2d 326c 2d33 322e 6963  ','logo-2l-32.ic
-00093570: 6f27 2929 290d 0a20 2020 2020 2020 2073  o')))..        s
-00093580: 656c 662e 7365 7457 696e 646f 7749 636f  elf.setWindowIco
-00093590: 6e28 6963 6f29 0d0a 0d0a 2020 2020 2020  n(ico)....      
-000935a0: 2020 7461 6273 203d 2051 7457 6964 6765    tabs = QtWidge
-000935b0: 7473 2e51 5461 6257 6964 6765 7428 290d  ts.QTabWidget().
-000935c0: 0a0d 0a0d 0a20 2020 2020 2020 2023 2063  .....        # c
-000935d0: 7265 6174 6520 7468 6520 7061 6765 2077  reate the page w
-000935e0: 696e 646f 7773 2061 7320 7461 6273 0d0a  indows as tabs..
-000935f0: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
-00093600: 6530 203d 2050 6167 654c 6f61 6444 6174  e0 = PageLoadDat
-00093610: 6128 7365 6c66 2e63 6f6d 6d6f 6e2c 2073  a(self.common, s
-00093620: 656c 662e 6461 7461 5f73 7472 7563 742c  elf.data_struct,
-00093630: 2073 656c 662e 7374 6b29 0d0a 2020 2020   self.stk)..    
-00093640: 2020 2020 7365 6c66 2e70 6167 6531 203d      self.page1 =
-00093650: 2050 6167 6553 7461 636b 2873 656c 662e   PageStack(self.
-00093660: 636f 6d6d 6f6e 2c20 7365 6c66 2e64 6174  common, self.dat
-00093670: 615f 7374 7275 6374 2c20 7365 6c66 2e73  a_struct, self.s
-00093680: 746b 290d 0a20 2020 2020 2020 2073 656c  tk)..        sel
-00093690: 662e 7061 6765 3220 3d20 5061 6765 5043  f.page2 = PagePC
-000936a0: 4128 7365 6c66 2e63 6f6d 6d6f 6e2c 2073  A(self.common, s
-000936b0: 656c 662e 6461 7461 5f73 7472 7563 742c  elf.data_struct,
-000936c0: 2073 656c 662e 7374 6b2c 2073 656c 662e   self.stk, self.
-000936d0: 616e 6c7a 290d 0a20 2020 2020 2020 2073  anlz)..        s
-000936e0: 656c 662e 7061 6765 3320 3d20 5061 6765  elf.page3 = Page
-000936f0: 436c 7573 7465 7228 7365 6c66 2e63 6f6d  Cluster(self.com
-00093700: 6d6f 6e2c 2073 656c 662e 6461 7461 5f73  mon, self.data_s
-00093710: 7472 7563 742c 2073 656c 662e 7374 6b2c  truct, self.stk,
-00093720: 2073 656c 662e 616e 6c7a 290d 0a20 2020   self.anlz)..   
-00093730: 2020 2020 2073 656c 662e 7061 6765 3420       self.page4 
-00093740: 3d20 5061 6765 5370 6563 7472 616c 2873  = PageSpectral(s
-00093750: 656c 662e 636f 6d6d 6f6e 2c20 7365 6c66  elf.common, self
-00093760: 2e64 6174 615f 7374 7275 6374 2c20 7365  .data_struct, se
-00093770: 6c66 2e73 746b 2c20 7365 6c66 2e61 6e6c  lf.stk, self.anl
-00093780: 7a29 0d0a 2020 2020 2020 2020 7365 6c66  z)..        self
-00093790: 2e70 6167 6535 203d 2050 6167 6550 6561  .page5 = PagePea
-000937a0: 6b49 4428 7365 6c66 2e63 6f6d 6d6f 6e2c  kID(self.common,
-000937b0: 2073 656c 662e 6461 7461 5f73 7472 7563   self.data_struc
-000937c0: 742c 2073 656c 662e 7374 6b2c 2073 656c  t, self.stk, sel
-000937d0: 662e 616e 6c7a 290d 0a20 2020 2020 2020  f.anlz)..       
-000937e0: 2073 656c 662e 7061 6765 3620 3d20 5061   self.page6 = Pa
-000937f0: 6765 5872 6179 5065 616b 4669 7474 696e  geXrayPeakFittin
-00093800: 6728 7365 6c66 2e63 6f6d 6d6f 6e2c 2073  g(self.common, s
-00093810: 656c 662e 6461 7461 5f73 7472 7563 742c  elf.data_struct,
-00093820: 2073 656c 662e 7374 6b2c 2073 656c 662e   self.stk, self.
-00093830: 616e 6c7a 290d 0a20 2020 2020 2020 2073  anlz)..        s
-00093840: 656c 662e 7061 6765 3720 3d20 5061 6765  elf.page7 = Page
-00093850: 4e4e 4d41 2873 656c 662e 636f 6d6d 6f6e  NNMA(self.common
-00093860: 2c20 7365 6c66 2e64 6174 615f 7374 7275  , self.data_stru
-00093870: 6374 2c20 7365 6c66 2e73 746b 2c20 7365  ct, self.stk, se
-00093880: 6c66 2e61 6e6c 7a2c 2073 656c 662e 6e6e  lf.anlz, self.nn
-00093890: 6d61 290d 0a0d 0a0d 0a20 2020 2020 2020  ma)......       
-000938a0: 2074 6162 732e 6164 6454 6162 2873 656c   tabs.addTab(sel
-000938b0: 662e 7061 6765 302c 224c 6f61 6420 4461  f.page0,"Load Da
-000938c0: 7461 2229 0d0a 2020 2020 2020 2020 7461  ta")..        ta
-000938d0: 6273 2e61 6464 5461 6228 7365 6c66 2e70  bs.addTab(self.p
-000938e0: 6167 6531 2c20 2250 7265 7072 6f63 6573  age1, "Preproces
-000938f0: 7320 4461 7461 2229 0d0a 2020 2020 2020  s Data")..      
-00093900: 2020 7461 6273 2e61 6464 5461 6228 7365    tabs.addTab(se
-00093910: 6c66 2e70 6167 6532 2c22 5043 4122 290d  lf.page2,"PCA").
-00093920: 0a20 2020 2020 2020 2074 6162 732e 6164  .        tabs.ad
-00093930: 6454 6162 2873 656c 662e 7061 6765 332c  dTab(self.page3,
-00093940: 2243 6c75 7374 6572 2041 6e61 6c79 7369  "Cluster Analysi
-00093950: 7322 290d 0a20 2020 2020 2020 2074 6162  s")..        tab
-00093960: 732e 6164 6454 6162 2873 656c 662e 7061  s.addTab(self.pa
-00093970: 6765 342c 2253 7065 6374 7261 6c20 4d61  ge4,"Spectral Ma
-00093980: 7073 2229 0d0a 2020 2020 2020 2020 7461  ps")..        ta
-00093990: 6273 2e61 6464 5461 6228 7365 6c66 2e70  bs.addTab(self.p
-000939a0: 6167 6537 2c20 224e 4e4d 4120 416e 616c  age7, "NNMA Anal
-000939b0: 7973 6973 2229 0d0a 2020 2020 2020 2020  ysis")..        
-000939c0: 7461 6273 2e61 6464 5461 6228 7365 6c66  tabs.addTab(self
-000939d0: 2e70 6167 6535 2c22 5065 616b 2049 4422  .page5,"Peak ID"
-000939e0: 290d 0a20 2020 2020 2020 2074 6162 732e  )..        tabs.
-000939f0: 6164 6454 6162 2873 656c 662e 7061 6765  addTab(self.page
-00093a00: 362c 2022 5872 6179 5065 616b 4669 7474  6, "XrayPeakFitt
-00093a10: 696e 6722 290d 0a0d 0a20 2020 2020 2020  ing")....       
-00093a20: 2069 6620 7368 6f77 746f 6d6f 7461 623a   if showtomotab:
-00093a30: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00093a40: 6c66 2e70 6167 6538 203d 2050 6167 6554  lf.page8 = PageT
-00093a50: 6f6d 6f28 7365 6c66 2e63 6f6d 6d6f 6e2c  omo(self.common,
-00093a60: 2073 656c 662e 6461 7461 5f73 7472 7563   self.data_struc
-00093a70: 742c 2073 656c 662e 7374 6b2c 2073 656c  t, self.stk, sel
-00093a80: 662e 616e 6c7a 290d 0a20 2020 2020 2020  f.anlz)..       
-00093a90: 2020 2020 2074 6162 732e 6164 6454 6162       tabs.addTab
-00093aa0: 2873 656c 662e 7061 6765 382c 2022 546f  (self.page8, "To
-00093ab0: 6d6f 6772 6170 6879 2229 0d0a 0d0a 2020  mography")....  
-00093ac0: 2020 2020 2020 6966 2073 686f 776d 6170        if showmap
-00093ad0: 7461 623a 0d0a 2020 2020 2020 2020 2020  tab:..          
-00093ae0: 2020 7365 6c66 2e70 6167 6539 203d 2050    self.page9 = P
-00093af0: 6167 654d 6170 2873 656c 662e 636f 6d6d  ageMap(self.comm
-00093b00: 6f6e 2c20 7365 6c66 2e64 6174 615f 7374  on, self.data_st
-00093b10: 7275 6374 2c20 7365 6c66 2e73 746b 290d  ruct, self.stk).
-00093b20: 0a20 2020 2020 2020 2020 2020 2074 6162  .            tab
-00093b30: 732e 6164 6454 6162 2873 656c 662e 7061  s.addTab(self.pa
-00093b40: 6765 392c 2022 496d 6167 6520 4d61 7073  ge9, "Image Maps
-00093b50: 2229 0d0a 0d0a 2020 2020 2020 2020 6966  ")....        if
-00093b60: 2073 7973 2e70 6c61 7466 6f72 6d20 3d3d   sys.platform ==
-00093b70: 2027 7769 6e33 3227 3a0d 0a20 2020 2020   'win32':..     
-00093b80: 2020 2020 2020 2074 6162 732e 7365 744d         tabs.setM
-00093b90: 696e 696d 756d 4865 6967 6874 2837 3530  inimumHeight(750
-00093ba0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-00093bb0: 0d0a 2020 2020 2020 2020 2020 2020 7461  ..            ta
-00093bc0: 6273 2e73 6574 4d69 6e69 6d75 6d48 6569  bs.setMinimumHei
-00093bd0: 6768 7428 3430 3029 0d0a 0d0a 2020 2020  ght(400)....    
-00093be0: 2020 2020 7461 6273 2e74 6162 4261 7228      tabs.tabBar(
-00093bf0: 292e 7365 7454 6162 5465 7874 436f 6c6f  ).setTabTextColo
-00093c00: 7228 302c 2051 7447 7569 2e51 436f 6c6f  r(0, QtGui.QColo
-00093c10: 7228 2767 7265 656e 2729 290d 0a20 2020  r('green'))..   
-00093c20: 2020 2020 2074 6162 732e 7461 6242 6172       tabs.tabBar
-00093c30: 2829 2e73 6574 5461 6254 6578 7443 6f6c  ().setTabTextCol
-00093c40: 6f72 2831 2c20 5174 4775 692e 5143 6f6c  or(1, QtGui.QCol
-00093c50: 6f72 2827 6772 6565 6e27 2929 0d0a 2020  or('green'))..  
-00093c60: 2020 2020 2020 7461 6273 2e74 6162 4261        tabs.tabBa
-00093c70: 7228 292e 7365 7454 6162 5465 7874 436f  r().setTabTextCo
-00093c80: 6c6f 7228 322c 2051 7447 7569 2e51 436f  lor(2, QtGui.QCo
-00093c90: 6c6f 7228 2764 6172 6b52 6564 2729 290d  lor('darkRed')).
-00093ca0: 0a20 2020 2020 2020 2074 6162 732e 7461  .        tabs.ta
-00093cb0: 6242 6172 2829 2e73 6574 5461 6254 6578  bBar().setTabTex
-00093cc0: 7443 6f6c 6f72 2833 2c20 5174 4775 692e  tColor(3, QtGui.
-00093cd0: 5143 6f6c 6f72 2827 6461 726b 5265 6427  QColor('darkRed'
-00093ce0: 2929 0d0a 2020 2020 2020 2020 7461 6273  ))..        tabs
-00093cf0: 2e74 6162 4261 7228 292e 7365 7454 6162  .tabBar().setTab
-00093d00: 5465 7874 436f 6c6f 7228 342c 2051 7447  TextColor(4, QtG
-00093d10: 7569 2e51 436f 6c6f 7228 2764 6172 6b52  ui.QColor('darkR
-00093d20: 6564 2729 290d 0a20 2020 2020 2020 2074  ed'))..        t
-00093d30: 6162 732e 7461 6242 6172 2829 2e73 6574  abs.tabBar().set
-00093d40: 5461 6254 6578 7443 6f6c 6f72 2835 2c20  TabTextColor(5, 
-00093d50: 5174 4775 692e 5143 6f6c 6f72 2827 6461  QtGui.QColor('da
-00093d60: 726b 5265 6427 2929 0d0a 2020 2020 2020  rkRed'))..      
-00093d70: 2020 7461 6273 2e74 6162 4261 7228 292e    tabs.tabBar().
-00093d80: 7365 7454 6162 5465 7874 436f 6c6f 7228  setTabTextColor(
-00093d90: 362c 2051 7447 7569 2e51 436f 6c6f 7228  6, QtGui.QColor(
-00093da0: 2770 7572 706c 6527 2929 0d0a 2020 2020  'purple'))..    
-00093db0: 2020 2020 7461 6273 2e74 6162 4261 7228      tabs.tabBar(
-00093dc0: 292e 7365 7454 6162 5465 7874 436f 6c6f  ).setTabTextColo
-00093dd0: 7228 372c 2051 7447 7569 2e51 436f 6c6f  r(7, QtGui.QColo
-00093de0: 7228 2770 7572 706c 6527 2929 0d0a 2020  r('purple'))..  
-00093df0: 2020 2020 2020 6966 2073 686f 7774 6f6d        if showtom
-00093e00: 6f74 6162 3a0d 0a20 2020 2020 2020 2020  otab:..         
-00093e10: 2020 2074 6162 732e 7461 6242 6172 2829     tabs.tabBar()
-00093e20: 2e73 6574 5461 6254 6578 7443 6f6c 6f72  .setTabTextColor
-00093e30: 2838 2c20 5174 4775 692e 5143 6f6c 6f72  (8, QtGui.QColor
-00093e40: 2827 6461 726b 626c 7565 2729 290d 0a20  ('darkblue')).. 
-00093e50: 2020 2020 2020 2069 6620 7368 6f77 6d61         if showma
-00093e60: 7074 6162 3a0d 0a20 2020 2020 2020 2020  ptab:..         
-00093e70: 2020 2074 6162 732e 7461 6242 6172 2829     tabs.tabBar()
-00093e80: 2e73 6574 5461 6254 6578 7443 6f6c 6f72  .setTabTextColor
-00093e90: 2839 2c20 5174 4775 692e 5143 6f6c 6f72  (9, QtGui.QColor
-00093ea0: 2827 6461 726b 626c 7565 2729 290d 0a0d  ('darkblue'))...
-00093eb0: 0a0d 0a0d 0a20 2020 2020 2020 2023 204f  .....        # O
-00093ec0: 6e6c 7920 6164 6420 2265 7870 6572 7422  nly add "expert"
-00093ed0: 2070 6167 6573 2069 6620 6f70 7469 6f6e   pages if option
-00093ee0: 2022 2d2d 6b65 7922 2069 7320 6769 7665   "--key" is give
-00093ef0: 6e20 696e 2063 6f6d 6d61 6e64 206c 696e  n in command lin
-00093f00: 650d 0a20 2020 2020 2020 2074 7279 3a0d  e..        try:.
-00093f10: 0a20 2020 2020 2020 2020 2020 206f 7074  .            opt
-00093f20: 696f 6e73 2c20 6578 7472 6150 6172 616d  ions, extraParam
-00093f30: 7320 3d20 6765 746f 7074 2e67 6574 6f70  s = getopt.getop
-00093f40: 7428 7379 732e 6172 6776 5b31 3a5d 2c20  t(sys.argv[1:], 
-00093f50: 2727 2c20 5b27 7778 272c 2027 6261 7463  '', ['wx', 'batc
-00093f60: 6827 2c20 276e 6e6d 6127 2c20 2769 6361  h', 'nnma', 'ica
-00093f70: 272c 2027 6b65 7965 6e67 275d 290d 0a20  ', 'keyeng']).. 
-00093f80: 2020 2020 2020 2065 7863 6570 743a 0d0a         except:..
-00093f90: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00093fa0: 7428 2745 7272 6f72 202d 2077 726f 6e67  t('Error - wrong
-00093fb0: 2063 6f6d 6d61 6e64 206c 696e 6520 6f70   command line op
-00093fc0: 7469 6f6e 2075 7365 642e 2041 7661 696c  tion used. Avail
-00093fd0: 6162 6c65 206f 7074 696f 6e73 2061 7265  able options are
-00093fe0: 202d 2d77 782c 202d 2d62 6174 6368 2061   --wx, --batch a
-00093ff0: 6e64 202d 2d6e 6e6d 6127 290d 0a20 2020  nd --nnma')..   
-00094000: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
-00094010: 0a0d 0a23 2020 2020 2020 2020 2066 6f72  ...#         for
-00094020: 206f 7074 2c20 6172 6720 696e 206f 7074   opt, arg in opt
-00094030: 696f 6e73 3a0d 0a23 2020 2020 2020 2020  ions:..#        
-00094040: 2020 2020 2069 6620 6f70 7420 696e 2027       if opt in '
-00094050: 2d2d 6e6e 6d61 273a 0d0a 2320 2020 2020  --nnma':..#     
-00094060: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-00094070: 6572 626f 7365 3a20 7072 696e 7420 2252  erbose: print "R
-00094080: 756e 6e69 6e67 2077 6974 6820 4e4e 4d41  unning with NNMA
-00094090: 2e22 0d0a 2320 2020 2020 2020 2020 2020  ."..#           
-000940a0: 2020 2020 2020 7365 6c66 2e70 6167 6537        self.page7
-000940b0: 203d 2050 6167 654e 4e4d 4128 7365 6c66   = PageNNMA(self
-000940c0: 2e63 6f6d 6d6f 6e2c 2073 656c 662e 6461  .common, self.da
-000940d0: 7461 5f73 7472 7563 742c 2073 656c 662e  ta_struct, self.
-000940e0: 7374 6b2c 2073 656c 662e 616e 6c7a 2c20  stk, self.anlz, 
-000940f0: 7365 6c66 2e6e 6e6d 6129 0d0a 2320 2020  self.nnma)..#   
-00094100: 2020 2020 2020 2020 2020 2020 2020 7461                ta
-00094110: 6273 2e61 6464 5461 6228 7365 6c66 2e70  bs.addTab(self.p
-00094120: 6167 6537 2c20 224e 4e4d 4120 416e 616c  age7, "NNMA Anal
-00094130: 7973 6973 2229 0d0a 0d0a 0d0a 2020 2020  ysis")......    
-00094140: 2020 2020 6c61 796f 7574 203d 2051 7457      layout = QtW
-00094150: 6964 6765 7473 2e51 5642 6f78 4c61 796f  idgets.QVBoxLayo
-00094160: 7574 2829 0d0a 0d0a 2020 2020 2020 2020  ut()....        
-00094170: 6c61 796f 7574 2e61 6464 5769 6467 6574  layout.addWidget
-00094180: 2874 6162 7329 0d0a 2020 2020 2020 2020  (tabs)..        
-00094190: 2373 656c 662e 7365 7443 656e 7472 616c  #self.setCentral
-000941a0: 5769 6467 6574 2874 6162 7329 0d0a 0d0a  Widget(tabs)....
-000941b0: 2020 2020 2020 2020 7365 6c66 2e73 6372          self.scr
-000941c0: 6f6c 6c41 7265 6120 3d20 5174 5769 6467  ollArea = QtWidg
-000941d0: 6574 732e 5153 6372 6f6c 6c41 7265 6128  ets.QScrollArea(
-000941e0: 290d 0a20 2020 2020 2020 2023 7365 6c66  )..        #self
-000941f0: 2e73 6372 6f6c 6c41 7265 612e 7365 7442  .scrollArea.setB
-00094200: 6163 6b67 726f 756e 6452 6f6c 6528 5174  ackgroundRole(Qt
-00094210: 4775 692e 5150 616c 6574 7465 2e44 6172  Gui.QPalette.Dar
-00094220: 6b29 0d0a 2020 2020 2020 2020 7365 6c66  k)..        self
-00094230: 2e73 6372 6f6c 6c41 7265 612e 7365 7457  .scrollArea.setW
-00094240: 6964 6765 7428 7461 6273 290d 0a20 2020  idget(tabs)..   
-00094250: 2020 2020 2023 7365 6c66 2e73 6372 6f6c       #self.scrol
-00094260: 6c41 7265 612e 7365 7456 6572 7469 6361  lArea.setVertica
-00094270: 6c53 6372 6f6c 6c42 6172 506f 6c69 6379  lScrollBarPolicy
-00094280: 2851 742e 5363 726f 6c6c 4261 7241 6c77  (Qt.ScrollBarAlw
-00094290: 6179 734f 6e29 0d0a 2020 2020 2020 2020  aysOn)..        
-000942a0: 2373 656c 662e 7363 726f 6c6c 4172 6561  #self.scrollArea
-000942b0: 2e73 6574 486f 7269 7a6f 6e74 616c 5363  .setHorizontalSc
-000942c0: 726f 6c6c 4261 7250 6f6c 6963 7928 5174  rollBarPolicy(Qt
-000942d0: 2e53 6372 6f6c 6c42 6172 416c 7761 7973  .ScrollBarAlways
-000942e0: 4f66 6629 0d0a 2020 2020 2020 2020 7365  Off)..        se
-000942f0: 6c66 2e73 6372 6f6c 6c41 7265 612e 7365  lf.scrollArea.se
-00094300: 7457 6964 6765 7452 6573 697a 6162 6c65  tWidgetResizable
-00094310: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
-00094320: 7365 6c66 2e73 6574 4365 6e74 7261 6c57  self.setCentralW
-00094330: 6964 6765 7428 7365 6c66 2e73 6372 6f6c  idget(self.scrol
-00094340: 6c41 7265 6129 0d0a 0d0a 0d0a 2020 2020  lArea)......    
-00094350: 2020 2020 7363 7265 656e 203d 2051 7457      screen = QtW
-00094360: 6964 6765 7473 2e51 4465 736b 746f 7057  idgets.QDesktopW
-00094370: 6964 6765 7428 292e 7363 7265 656e 4765  idget().screenGe
-00094380: 6f6d 6574 7279 2829 0d0a 0d0a 0d0a 2020  ometry()......  
-00094390: 2020 2020 2020 6966 2073 6372 6565 6e2e        if screen.
-000943a0: 6865 6967 6874 2829 203c 2057 696e 7369  height() < Winsi
-000943b0: 7a65 7920 2d20 3530 3a0d 0a20 2020 2020  zey - 50:..     
-000943c0: 2020 2020 2020 2073 656c 662e 7368 6f77         self.show
-000943d0: 4d61 7869 6d69 7a65 6428 290d 0a0d 0a0d  Maximized().....
-000943e0: 0a20 2020 2020 2020 2073 656c 662e 7368  .        self.sh
-000943f0: 6f77 2829 0d0a 2020 2020 2020 2020 6966  ow()..        if
-00094400: 2073 7973 2e70 6c61 7466 6f72 6d20 3d3d   sys.platform ==
-00094410: 2022 6461 7277 696e 223a 0d0a 2020 2020   "darwin":..    
-00094420: 2020 2020 2020 2020 7365 6c66 2e72 6169          self.rai
-00094430: 7365 5f28 290d 0a0d 0a0d 0a23 2d2d 2d2d  se_()......#----
-00094440: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00094450: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00094460: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00094470: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00094480: 2d2d 0d0a 2020 2020 6465 6620 696e 6974  --..    def init
-00094490: 546f 6f6c 6261 7228 7365 6c66 293a 0d0a  Toolbar(self):..
-000944a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-000944b0: 6374 696f 6e4f 7065 6e20 3d20 5174 5769  ctionOpen = QtWi
-000944c0: 6467 6574 732e 5141 6374 696f 6e28 7365  dgets.QAction(se
-000944d0: 6c66 290d 0a20 2020 2020 2020 2073 656c  lf)..        sel
-000944e0: 662e 6163 7469 6f6e 4f70 656e 2e73 6574  f.actionOpen.set
-000944f0: 4f62 6a65 6374 4e61 6d65 2827 6163 7469  ObjectName('acti
-00094500: 6f6e 4f70 656e 2729 0d0a 2020 2020 2020  onOpen')..      
-00094510: 2020 7365 6c66 2e61 6374 696f 6e4f 7065    self.actionOpe
-00094520: 6e2e 7365 7449 636f 6e28 5174 4775 692e  n.setIcon(QtGui.
-00094530: 5149 636f 6e28 7265 736f 7572 6365 5f70  QIcon(resource_p
-00094540: 6174 6828 6f73 2e70 6174 682e 6a6f 696e  ath(os.path.join
-00094550: 2827 696d 6167 6573 272c 2764 6f63 756d  ('images','docum
-00094560: 656e 742d 6f70 656e 2e70 6e67 2729 2929  ent-open.png')))
-00094570: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00094580: 746f 6f6c 6261 7220 3d20 7365 6c66 2e61  toolbar = self.a
-00094590: 6464 546f 6f6c 4261 7228 2761 6374 696f  ddToolBar('actio
-000945a0: 6e4f 7065 6e27 290d 0a20 2020 2020 2020  nOpen')..       
-000945b0: 2073 656c 662e 746f 6f6c 6261 722e 6164   self.toolbar.ad
-000945c0: 6441 6374 696f 6e28 7365 6c66 2e61 6374  dAction(self.act
-000945d0: 696f 6e4f 7065 6e29 0d0a 2020 2020 2020  ionOpen)..      
-000945e0: 2020 7365 6c66 2e61 6374 696f 6e4f 7065    self.actionOpe
-000945f0: 6e2e 7472 6967 6765 7265 642e 636f 6e6e  n.triggered.conn
-00094600: 6563 7428 7365 6c66 2e4c 6f61 6453 7461  ect(self.LoadSta
-00094610: 636b 290d 0a0d 0a20 2020 2020 2020 2073  ck)....        s
-00094620: 656c 662e 6163 7469 6f6e 4f70 656e 534c  elf.actionOpenSL
-00094630: 203d 2051 7457 6964 6765 7473 2e51 4163   = QtWidgets.QAc
-00094640: 7469 6f6e 2873 656c 6629 0d0a 2020 2020  tion(self)..    
-00094650: 2020 2020 7365 6c66 2e61 6374 696f 6e4f      self.actionO
-00094660: 7065 6e53 4c2e 7365 744f 626a 6563 744e  penSL.setObjectN
-00094670: 616d 6528 2761 6374 696f 6e4f 7065 6e53  ame('actionOpenS
-00094680: 4c27 290d 0a20 2020 2020 2020 2073 656c  L')..        sel
-00094690: 662e 6163 7469 6f6e 4f70 656e 534c 2e73  f.actionOpenSL.s
-000946a0: 6574 4963 6f6e 2851 7447 7569 2e51 4963  etIcon(QtGui.QIc
-000946b0: 6f6e 2872 6573 6f75 7263 655f 7061 7468  on(resource_path
-000946c0: 286f 732e 7061 7468 2e6a 6f69 6e28 2769  (os.path.join('i
-000946d0: 6d61 6765 7327 2c27 6f70 656e 2d73 6c2e  mages','open-sl.
-000946e0: 706e 6727 2929 2929 0d0a 2020 2020 2020  png'))))..      
-000946f0: 2020 7365 6c66 2e74 6f6f 6c62 6172 2e61    self.toolbar.a
-00094700: 6464 4163 7469 6f6e 2873 656c 662e 6163  ddAction(self.ac
-00094710: 7469 6f6e 4f70 656e 534c 290d 0a20 2020  tionOpenSL)..   
-00094720: 2020 2020 2073 656c 662e 6163 7469 6f6e       self.action
-00094730: 4f70 656e 534c 2e74 7269 6767 6572 6564  OpenSL.triggered
-00094740: 2e63 6f6e 6e65 6374 2873 656c 662e 4275  .connect(self.Bu
-00094750: 696c 6453 7461 636b 290d 0a0d 0a20 2020  ildStack)....   
-00094760: 2020 2020 2073 656c 662e 6163 7469 6f6e       self.action
-00094770: 5361 7665 203d 2051 7457 6964 6765 7473  Save = QtWidgets
-00094780: 2e51 4163 7469 6f6e 2873 656c 6629 0d0a  .QAction(self)..
-00094790: 2020 2020 2020 2020 7365 6c66 2e61 6374          self.act
-000947a0: 696f 6e53 6176 652e 7365 744f 626a 6563  ionSave.setObjec
-000947b0: 744e 616d 6528 2761 6374 696f 6e53 6176  tName('actionSav
-000947c0: 6527 290d 0a20 2020 2020 2020 2073 656c  e')..        sel
-000947d0: 662e 6163 7469 6f6e 5361 7665 2e73 6574  f.actionSave.set
-000947e0: 4963 6f6e 2851 7447 7569 2e51 4963 6f6e  Icon(QtGui.QIcon
-000947f0: 2872 6573 6f75 7263 655f 7061 7468 286f  (resource_path(o
-00094800: 732e 7061 7468 2e6a 6f69 6e28 2769 6d61  s.path.join('ima
-00094810: 6765 7327 2c27 6d65 6469 612d 666c 6f70  ges','media-flop
-00094820: 7079 2e70 6e67 2729 2929 290d 0a20 2020  py.png'))))..   
-00094830: 2020 2020 2073 656c 662e 746f 6f6c 6261       self.toolba
-00094840: 722e 6164 6441 6374 696f 6e28 7365 6c66  r.addAction(self
-00094850: 2e61 6374 696f 6e53 6176 6529 0d0a 2020  .actionSave)..  
-00094860: 2020 2020 2020 7365 6c66 2e61 6374 696f        self.actio
-00094870: 6e53 6176 652e 7472 6967 6765 7265 642e  nSave.triggered.
-00094880: 636f 6e6e 6563 7428 7365 6c66 2e6f 6e53  connect(self.onS
-00094890: 6176 6552 6573 756c 7473 546f 4835 290d  aveResultsToH5).
-000948a0: 0a20 2020 2020 2020 2073 656c 662e 6163  .        self.ac
-000948b0: 7469 6f6e 5361 7665 2e73 6574 456e 6162  tionSave.setEnab
-000948c0: 6c65 6428 4661 6c73 6529 0d0a 0d0a 2020  led(False)....  
-000948d0: 2020 2020 2020 7365 6c66 2e61 6374 696f        self.actio
-000948e0: 6e49 6e66 6f20 3d20 5174 5769 6467 6574  nInfo = QtWidget
-000948f0: 732e 5141 6374 696f 6e28 7365 6c66 290d  s.QAction(self).
-00094900: 0a20 2020 2020 2020 2073 656c 662e 6163  .        self.ac
-00094910: 7469 6f6e 496e 666f 2e73 6574 4f62 6a65  tionInfo.setObje
-00094920: 6374 4e61 6d65 2827 6163 7469 6f6e 496e  ctName('actionIn
-00094930: 666f 2729 0d0a 2020 2020 2020 2020 7365  fo')..        se
-00094940: 6c66 2e61 6374 696f 6e49 6e66 6f2e 7365  lf.actionInfo.se
-00094950: 7449 636f 6e28 5174 4775 692e 5149 636f  tIcon(QtGui.QIco
-00094960: 6e28 7265 736f 7572 6365 5f70 6174 6828  n(resource_path(
-00094970: 6f73 2e70 6174 682e 6a6f 696e 2827 696d  os.path.join('im
-00094980: 6167 6573 272c 2768 656c 702d 6272 6f77  ages','help-brow
-00094990: 7365 722e 706e 6727 2929 2929 0d0a 2020  ser.png'))))..  
-000949a0: 2020 2020 2020 7365 6c66 2e74 6f6f 6c62        self.toolb
-000949b0: 6172 2e61 6464 4163 7469 6f6e 2873 656c  ar.addAction(sel
-000949c0: 662e 6163 7469 6f6e 496e 666f 290d 0a20  f.actionInfo).. 
-000949d0: 2020 2020 2020 2073 656c 662e 6163 7469         self.acti
-000949e0: 6f6e 496e 666f 2e74 7269 6767 6572 6564  onInfo.triggered
-000949f0: 2e63 6f6e 6e65 6374 2873 656c 662e 6f6e  .connect(self.on
-00094a00: 4162 6f75 7429 0d0a 0d0a 232d 2d2d 2d2d  About)....#-----
-00094a10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00094a20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00094a30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00094a40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00094a50: 2d0d 0a20 2020 2064 6566 204c 6f61 6453  -..    def LoadS
-00094a60: 7461 636b 2873 656c 6629 3a0d 0a20 2020  tack(self):..   
-00094a70: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00094a80: 2020 4272 6f77 7365 2066 6f72 2061 2073    Browse for a s
-00094a90: 7461 636b 2066 696c 653a 0d0a 2020 2020  tack file:..    
-00094aa0: 2020 2020 2222 220d 0a0d 0a20 2020 2020      """....     
-00094ab0: 2020 2066 696c 6570 6174 682c 2070 6c75     filepath, plu
-00094ac0: 6769 6e20 3d20 4669 6c65 5f47 5549 2e53  gin = File_GUI.S
-00094ad0: 656c 6563 7446 696c 6528 2772 6561 6427  electFile('read'
-00094ae0: 2c27 7374 6163 6b27 290d 0a20 2020 2020  ,'stack')..     
-00094af0: 2020 2070 7269 6e74 2866 696c 6570 6174     print(filepat
-00094b00: 682c 2070 6c75 6769 6e29 0d0a 2020 2020  h, plugin)..    
-00094b10: 2020 2020 4a53 4f4e 636f 6e76 6572 7420      JSONconvert 
-00094b20: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-00094b30: 2069 6620 6669 6c65 7061 7468 2069 7320   if filepath is 
-00094b40: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-00094b50: 2020 2020 2020 2069 6620 706c 7567 696e         if plugin
-00094b60: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-00094b70: 2020 2020 2020 2020 2020 2070 6c75 6769             plugi
-00094b80: 6e20 3d20 6669 6c65 5f70 6c75 6769 6e73  n = file_plugins
-00094b90: 2e69 6465 6e74 6966 7928 6669 6c65 7061  .identify(filepa
-00094ba0: 7468 290d 0a20 2020 2020 2020 2020 2020  th)..           
-00094bb0: 2046 696c 6553 7472 7563 7420 3d20 6669   FileStruct = fi
-00094bc0: 6c65 5f70 6c75 6769 6e73 2e47 6574 4669  le_plugins.GetFi
-00094bd0: 6c65 5374 7275 6374 7572 6528 6669 6c65  leStructure(file
-00094be0: 7061 7468 2c20 706c 7567 696e 3d70 6c75  path, plugin=plu
-00094bf0: 6769 6e29 0d0a 2020 2020 2020 2020 2020  gin)..          
-00094c00: 2020 4669 6c65 496e 7465 726e 616c 5365    FileInternalSe
-00094c10: 6c65 6374 696f 6e20 3d20 5b28 302c 3029  lection = [(0,0)
-00094c20: 5d0d 0a20 2020 2020 2020 2020 2020 2069  ]..            i
-00094c30: 6620 4669 6c65 5374 7275 6374 2069 7320  f FileStruct is 
-00094c40: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-00094c50: 2020 2020 2020 2020 2020 2064 6c67 203d             dlg =
-00094c60: 2046 696c 655f 4755 492e 4461 7461 4368   File_GUI.DataCh
-00094c70: 6f69 6365 4469 616c 6f67 2866 696c 6570  oiceDialog(filep
-00094c80: 6174 683d 6669 6c65 7061 7468 2c20 6669  ath=filepath, fi
-00094c90: 6c65 7374 7275 6374 3d46 696c 6553 7472  lestruct=FileStr
-00094ca0: 7563 742c 2070 6c75 6769 6e3d 706c 7567  uct, plugin=plug
-00094cb0: 696e 290d 0a20 2020 2020 2020 2020 2020  in)..           
-00094cc0: 2020 2020 2069 6620 6e6f 7420 646c 672e       if not dlg.
-00094cd0: 6578 6563 5f28 293a 0d0a 2020 2020 2020  exec_():..      
-00094ce0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00094cf0: 7475 726e 2023 2064 6f20 6e6f 7468 696e  turn # do nothin
-00094d00: 6720 6966 2047 5549 2069 7320 6361 6e63  g if GUI is canc
-00094d10: 656c 6c65 640d 0a20 2020 2020 2020 2020  elled..         
-00094d20: 2020 2020 2020 2046 696c 6549 6e74 6572         FileInter
-00094d30: 6e61 6c53 656c 6563 7469 6f6e 203d 2064  nalSelection = d
-00094d40: 6c67 2e73 656c 6563 7469 6f6e 0d0a 2020  lg.selection..  
-00094d50: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00094d60: 2064 6c67 2e66 696c 6570 6174 6820 213d   dlg.filepath !=
-00094d70: 2066 696c 6570 6174 683a 0d0a 2020 2020   filepath:..    
-00094d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00094d90: 6669 6c65 7061 7468 203d 2064 6c67 2e66  filepath = dlg.f
-00094da0: 696c 6570 6174 680d 0a20 2020 2020 2020  ilepath..       
-00094db0: 2020 2020 2020 2020 2020 2020 2070 6c75               plu
-00094dc0: 6769 6e20 3d20 6669 6c65 5f70 6c75 6769  gin = file_plugi
-00094dd0: 6e73 2e69 6465 6e74 6966 7928 646c 672e  ns.identify(dlg.
-00094de0: 6669 6c65 7061 7468 290d 0a20 2020 2020  filepath)..     
-00094df0: 2020 2020 2020 2069 6620 706c 7567 696e         if plugin
-00094e00: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-00094e10: 2020 2020 2020 2020 2020 2051 7457 6964             QtWid
-00094e20: 6765 7473 2e51 4d65 7373 6167 6542 6f78  gets.QMessageBox
-00094e30: 2e77 6172 6e69 6e67 2873 656c 662c 2027  .warning(self, '
-00094e40: 4572 726f 7221 272c 2022 556e 6b6e 6f77  Error!', "Unknow
-00094e50: 6e20 6669 6c65 2074 7970 6522 290d 0a0d  n file type")...
-00094e60: 0a20 2020 2020 2020 2020 2020 2051 7457  .            QtW
-00094e70: 6964 6765 7473 2e51 4170 706c 6963 6174  idgets.QApplicat
-00094e80: 696f 6e2e 7365 744f 7665 7272 6964 6543  ion.setOverrideC
-00094e90: 7572 736f 7228 5174 4775 692e 5143 7572  ursor(QtGui.QCur
-00094ea0: 736f 7228 5174 2e57 6169 7443 7572 736f  sor(Qt.WaitCurso
-00094eb0: 7229 290d 0a0d 0a20 2020 2020 2020 2020  r))....         
-00094ec0: 2020 2069 6620 7365 6c66 2e63 6f6d 6d6f     if self.commo
-00094ed0: 6e2e 7374 6163 6b5f 6c6f 6164 6564 203d  n.stack_loaded =
-00094ee0: 3d20 313a 0d0a 2020 2020 2020 2020 2020  = 1:..          
-00094ef0: 2020 2020 2020 7365 6c66 2e6e 6577 5f73        self.new_s
-00094f00: 7461 636b 5f72 6566 7265 7368 2829 0d0a  tack_refresh()..
-00094f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00094f20: 7365 6c66 2e73 746b 2e6e 6577 5f64 6174  self.stk.new_dat
-00094f30: 6128 290d 0a20 2020 2020 2020 2020 2020  a()..           
-00094f40: 2020 2020 2073 656c 662e 616e 6c7a 2e64       self.anlz.d
-00094f50: 656c 6574 655f 6461 7461 2829 0d0a 2020  elete_data()..  
-00094f60: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-00094f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00094f80: 4a53 4f4e 636f 6e76 6572 7420 3d20 646c  JSONconvert = dl
-00094f90: 672e 6a73 6f6e 6368 6563 6b2e 6973 4368  g.jsoncheck.isCh
-00094fa0: 6563 6b65 6428 290d 0a20 2020 2020 2020  ecked()..       
-00094fb0: 2020 2020 2065 7863 6570 7420 556e 626f       except Unbo
-00094fc0: 756e 644c 6f63 616c 4572 726f 723a 0d0a  undLocalError:..
-00094fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00094fe0: 7072 696e 7428 2244 6174 6143 686f 6963  print("DataChoic
-00094ff0: 6544 6961 6c6f 6720 736b 6970 7065 6422  eDialog skipped"
-00095000: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
-00095010: 696c 655f 706c 7567 696e 732e 6c6f 6164  ile_plugins.load
-00095020: 2866 696c 6570 6174 682c 2073 7461 636b  (filepath, stack
-00095030: 5f6f 626a 6563 743d 7365 6c66 2e73 746b  _object=self.stk
-00095040: 2c20 706c 7567 696e 3d70 6c75 6769 6e2c  , plugin=plugin,
-00095050: 2073 656c 6563 7469 6f6e 3d46 696c 6549   selection=FileI
-00095060: 6e74 6572 6e61 6c53 656c 6563 7469 6f6e  nternalSelection
-00095070: 2c6a 736f 6e3d 4a53 4f4e 636f 6e76 6572  ,json=JSONconver
-00095080: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-00095090: 6469 7265 6374 6f72 7920 3d20 6f73 2e70  directory = os.p
-000950a0: 6174 682e 6469 726e 616d 6528 7374 7228  ath.dirname(str(
-000950b0: 6669 6c65 7061 7468 2929 0d0a 2020 2020  filepath))..    
-000950c0: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
-000950d0: 6531 2e66 696c 656e 616d 6520 3d20 6f73  e1.filename = os
-000950e0: 2e70 6174 682e 6261 7365 6e61 6d65 2873  .path.basename(s
-000950f0: 7472 2866 696c 6570 6174 6829 290d 0a0d  tr(filepath))...
-00095100: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
-00095110: 5570 6461 7465 2077 6964 6765 7473 0d0a  Update widgets..
-00095120: 2020 2020 2020 2020 2020 2020 783d 7365              x=se
-00095130: 6c66 2e73 746b 2e6e 5f63 6f6c 730d 0a20  lf.stk.n_cols.. 
-00095140: 2020 2020 2020 2020 2020 2079 3d73 656c             y=sel
-00095150: 662e 7374 6b2e 6e5f 726f 7773 0d0a 2020  f.stk.n_rows..  
-00095160: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00095170: 6167 6531 2e69 6d67 7267 6220 3d20 6e70  age1.imgrgb = np
-00095180: 2e7a 6572 6f73 2878 2a79 2a33 2c64 7479  .zeros(x*y*3,dty
-00095190: 7065 203d 2022 7569 6e74 3822 290d 0a20  pe = "uint8").. 
-000951a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000951b0: 7061 6765 312e 6d61 7876 616c 203d 206e  page1.maxval = n
-000951c0: 702e 616d 6178 2873 656c 662e 7374 6b2e  p.amax(self.stk.
-000951d0: 6162 7364 6174 6129 0d0a 0d0a 0d0a 2020  absdata)......  
-000951e0: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-000951f0: 7820 3d20 696e 7428 782f 3229 0d0a 2020  x = int(x/2)..  
-00095200: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-00095210: 7920 3d20 696e 7428 792f 3229 0d0a 0d0a  y = int(y/2)....
-00095220: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00095230: 2e70 6167 6531 2e69 7820 3d20 7365 6c66  .page1.ix = self
-00095240: 2e69 780d 0a20 2020 2020 2020 2020 2020  .ix..           
-00095250: 2073 656c 662e 7061 6765 312e 6979 203d   self.page1.iy =
-00095260: 2073 656c 662e 6979 0d0a 0d0a 2020 2020   self.iy....    
-00095270: 2020 2020 2020 2020 7365 6c66 2e69 6576          self.iev
-00095280: 203d 2069 6e74 2873 656c 662e 7374 6b2e   = int(self.stk.
-00095290: 6e5f 6576 2f32 290d 0a20 2020 2020 2020  n_ev/2)..       
-000952a0: 2020 2020 2073 656c 662e 7061 6765 302e       self.page0.
-000952b0: 736c 6964 6572 5f65 6e67 2e73 6574 5261  slider_eng.setRa
-000952c0: 6e67 6528 302c 7365 6c66 2e73 746b 2e6e  nge(0,self.stk.n
-000952d0: 5f65 762d 3129 0d0a 2020 2020 2020 2020  _ev-1)..        
-000952e0: 2020 2020 7365 6c66 2e70 6167 6530 2e69      self.page0.i
-000952f0: 6576 203d 2073 656c 662e 6965 760d 0a20  ev = self.iev.. 
-00095300: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00095310: 7061 6765 302e 736c 6964 6572 5f65 6e67  page0.slider_eng
-00095320: 2e73 6574 5661 6c75 6528 7365 6c66 2e69  .setValue(self.i
-00095330: 6576 290d 0a0d 0a20 2020 2020 2020 2020  ev)....         
-00095340: 2020 2073 656c 662e 7061 6765 312e 736c     self.page1.sl
-00095350: 6964 6572 5f65 6e67 2e73 6574 5261 6e67  ider_eng.setRang
-00095360: 6528 302c 7365 6c66 2e73 746b 2e6e 5f65  e(0,self.stk.n_e
-00095370: 762d 3129 0d0a 2020 2020 2020 2020 2020  v-1)..          
-00095380: 2020 7365 6c66 2e70 6167 6531 2e69 6576    self.page1.iev
-00095390: 203d 2073 656c 662e 6965 760d 0a20 2020   = self.iev..   
-000953a0: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-000953b0: 6765 312e 736c 6964 6572 5f65 6e67 2e73  ge1.slider_eng.s
-000953c0: 6574 5661 6c75 6528 7365 6c66 2e69 6576  etValue(self.iev
-000953d0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-000953e0: 6620 7368 6f77 6d61 7074 6162 3a0d 0a20  f showmaptab:.. 
-000953f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00095400: 656c 662e 7061 6765 392e 436c 6561 7228  elf.page9.Clear(
-00095410: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00095420: 2020 2073 656c 662e 7061 6765 392e 736c     self.page9.sl
-00095430: 6964 6572 5f65 6e67 2e73 6574 5261 6e67  ider_eng.setRang
-00095440: 6528 302c 7365 6c66 2e73 746b 2e6e 5f65  e(0,self.stk.n_e
-00095450: 762d 3129 0d0a 2020 2020 2020 2020 2020  v-1)..          
-00095460: 2020 7365 6c66 2e73 746b 2e73 6361 6c65    self.stk.scale
-00095470: 5f62 6172 2829 0d0a 2020 2020 2020 2020  _bar()..        
-00095480: 2020 2020 7365 6c66 2e63 6f6d 6d6f 6e2e      self.common.
-00095490: 7374 6163 6b5f 6c6f 6164 6564 203d 2031  stack_loaded = 1
-000954a0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000954b0: 6c66 2e63 6f6d 6d6f 6e2e 7061 7468 203d  lf.common.path =
-000954c0: 2064 6972 6563 746f 7279 0d0a 0d0a 2020   directory....  
-000954d0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-000954e0: 662e 7374 6b2e 6461 7461 5f73 7472 7563  f.stk.data_struc
-000954f0: 742e 7370 6563 7472 6f6d 6963 726f 7363  t.spectromicrosc
-00095500: 6f70 792e 6e6f 726d 616c 697a 6174 696f  opy.normalizatio
-00095510: 6e2e 7768 6974 655f 7370 6563 7472 756d  n.white_spectrum
-00095520: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00095530: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00095540: 656c 662e 636f 6d6d 6f6e 2e69 305f 6c6f  elf.common.i0_lo
-00095550: 6164 6564 203d 2031 0d0a 2020 2020 2020  aded = 1..      
-00095560: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-00095570: 746b 2e63 616c 6375 6c61 7465 5f6f 7074  tk.calculate_opt
-00095580: 6963 616c 5f64 656e 7369 7479 2829 0d0a  ical_density()..
-00095590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000955a0: 7365 6c66 2e73 746b 2e66 696c 6c5f 6835  self.stk.fill_h5
-000955b0: 5f73 7472 7563 745f 6e6f 726d 616c 697a  _struct_normaliz
-000955c0: 6174 696f 6e28 290d 0a0d 0a0d 0a20 2020  ation()......   
-000955d0: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-000955e0: 6765 312e 5265 7365 7444 6973 706c 6179  ge1.ResetDisplay
-000955f0: 5365 7474 696e 6773 2829 0d0a 2020 2020  Settings()..    
-00095600: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
-00095610: 6531 2e6c 6f61 6449 6d61 6765 2829 0d0a  e1.loadImage()..
-00095620: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00095630: 2e70 6167 6531 2e62 7574 746f 6e5f 6d75  .page1.button_mu
-00095640: 6c74 6963 726f 702e 7365 7454 6578 7428  lticrop.setText(
-00095650: 2743 726f 7020 7374 6163 6b20 3344 2e2e  'Crop stack 3D..
-00095660: 2e27 290d 0a20 2020 2020 2020 2020 2020  .')..           
-00095670: 2023 7072 696e 7420 2878 2c79 292c 2028   #print (x,y), (
-00095680: 7365 6c66 2e69 782c 7365 6c66 2e69 7929  self.ix,self.iy)
-00095690: 2c20 7365 6c66 2e73 746b 2e61 6273 6461  , self.stk.absda
-000956a0: 7461 2e73 6861 7065 0d0a 2020 2020 2020  ta.shape..      
-000956b0: 2020 2020 2020 7365 6c66 2e70 6167 6531        self.page1
-000956c0: 2e73 686f 7753 7065 6374 7275 6d28 7365  .showSpectrum(se
-000956d0: 6c66 2e69 782c 2073 656c 662e 6979 290d  lf.ix, self.iy).
-000956e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000956f0: 662e 7061 6765 312e 7465 7874 6374 726c  f.page1.textctrl
-00095700: 2e73 6574 5465 7874 2873 656c 662e 7061  .setText(self.pa
-00095710: 6765 312e 6669 6c65 6e61 6d65 290d 0a0d  ge1.filename)...
-00095720: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00095730: 662e 7061 6765 302e 436c 6561 7228 290d  f.page0.Clear().
-00095740: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00095750: 662e 7061 6765 302e 4c6f 6164 456e 7472  f.page0.LoadEntr
-00095760: 6965 7328 290d 0a20 2020 2020 2020 2020  ies()..         
-00095770: 2020 2073 656c 662e 7061 6765 302e 5368     self.page0.Sh
-00095780: 6f77 496e 666f 2873 656c 662e 7061 6765  owInfo(self.page
-00095790: 312e 6669 6c65 6e61 6d65 2c20 6469 7265  1.filename, dire
-000957a0: 6374 6f72 7929 0d0a 0d0a 2020 2020 2020  ctory)....      
-000957b0: 2020 2020 2020 7365 6c66 2e70 6167 6535        self.page5
-000957c0: 2e75 7064 6174 6577 6964 6765 7473 2829  .updatewidgets()
-000957d0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000957e0: 5174 5769 6467 6574 732e 5141 7070 6c69  QtWidgets.QAppli
-000957f0: 6361 7469 6f6e 2e72 6573 746f 7265 4f76  cation.restoreOv
-00095800: 6572 7269 6465 4375 7273 6f72 2829 0d0a  errideCursor()..
-00095810: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00095820: 2073 686f 776d 6170 7461 623a 0d0a 2020   showmaptab:..  
-00095830: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00095840: 6c66 2e70 6167 6539 2e43 6c65 6172 2829  lf.page9.Clear()
-00095850: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00095860: 2020 7365 6c66 2e70 6167 6539 2e4c 6f61    self.page9.Loa
-00095870: 6445 6e74 7269 6573 2829 0d0a 2020 2020  dEntries()..    
-00095880: 2020 2020 7365 6c66 2e72 6566 7265 7368      self.refresh
-00095890: 5f77 6964 6765 7473 2829 0d0a 0d0a 0d0a  _widgets()......
-000958a0: 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  #---------------
-000958b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000958c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000958d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000958e0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6566  -------..    def
-000958f0: 2042 7569 6c64 5374 6163 6b28 7365 6c66   BuildStack(self
-00095900: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-00095910: 0a20 2020 2020 2020 2042 726f 7773 6520  .        Browse 
-00095920: 666f 7220 2e73 6d20 6669 6c65 730d 0a20  for .sm files.. 
-00095930: 2020 2020 2020 2022 2222 0d0a 0d0a 2020         """....  
-00095940: 2020 2020 2020 2374 7279 3a0d 0a20 2020        #try:..   
-00095950: 2020 2020 2069 6620 5472 7565 3a0d 0a20       if True:.. 
-00095960: 2020 2020 2020 2020 2020 2064 6972 6563             direc
-00095970: 746f 7279 203d 2051 7457 6964 6765 7473  tory = QtWidgets
-00095980: 2e51 4669 6c65 4469 616c 6f67 2e67 6574  .QFileDialog.get
-00095990: 4578 6973 7469 6e67 4469 7265 6374 6f72  ExistingDirector
-000959a0: 7928 7365 6c66 2c20 2243 686f 6f73 6520  y(self, "Choose 
-000959b0: 6120 6469 7265 6374 6f72 7922 2c20 2727  a directory", ''
-000959c0: 2c20 5174 5769 6467 6574 732e 5146 696c  , QtWidgets.QFil
-000959d0: 6544 6961 6c6f 672e 5368 6f77 4469 7273  eDialog.ShowDirs
-000959e0: 4f6e 6c79 7c51 7457 6964 6765 7473 2e51  Only|QtWidgets.Q
-000959f0: 4669 6c65 4469 616c 6f67 2e52 6561 644f  FileDialog.ReadO
-00095a00: 6e6c 7920 290d 0a0d 0a0d 0a0d 0a20 2020  nly )........   
-00095a10: 2020 2020 2020 2020 2069 6620 6469 7265           if dire
-00095a20: 6374 6f72 7920 3d3d 2027 273a 0d0a 2020  ctory == '':..  
-00095a30: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00095a40: 7475 726e 0d0a 0d0a 2020 2020 2020 2020  turn....        
-00095a50: 2020 2020 7365 6c66 2e63 6f6d 6d6f 6e2e      self.common.
-00095a60: 7061 7468 203d 2064 6972 6563 746f 7279  path = directory
-00095a70: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00095a80: 7374 6163 6b66 7261 6d65 203d 2053 7461  stackframe = Sta
-00095a90: 636b 4c69 7374 4672 616d 6528 7365 6c66  ckListFrame(self
-00095aa0: 2c20 6469 7265 6374 6f72 792c 2073 656c  , directory, sel
-00095ab0: 662e 636f 6d6d 6f6e 2c20 7365 6c66 2e73  f.common, self.s
-00095ac0: 746b 2c20 7365 6c66 2e64 6174 615f 7374  tk, self.data_st
-00095ad0: 7275 6374 290d 0a20 2020 2020 2020 2020  ruct)..         
-00095ae0: 2020 2073 7461 636b 6672 616d 652e 7368     stackframe.sh
-00095af0: 6f77 2829 0d0a 0d0a 2320 2020 2020 2020  ow()....#       
-00095b00: 2020 6578 6365 7074 3a0d 0a23 2020 2020    except:..#    
-00095b10: 2020 2020 2020 2020 2070 7269 6e74 2027           print '
-00095b20: 4572 726f 7220 636f 756c 6420 6e6f 7420  Error could not 
-00095b30: 6275 696c 6420 7374 6163 6b20 6c69 7374  build stack list
-00095b40: 2e27 0d0a 2320 2020 2020 2020 2020 2020  .'..#           
-00095b50: 2020 7365 6c66 2e63 6f6d 6d6f 6e2e 7374    self.common.st
-00095b60: 6163 6b5f 6c6f 6164 6564 203d 2030 0d0a  ack_loaded = 0..
-00095b70: 2320 2020 2020 2020 2020 2020 2020 7365  #             se
-00095b80: 6c66 2e63 6f6d 6d6f 6e2e 6930 5f6c 6f61  lf.common.i0_loa
-00095b90: 6465 6420 3d20 300d 0a23 2020 2020 2020  ded = 0..#      
-00095ba0: 2020 2020 2020 2073 656c 662e 6e65 775f         self.new_
-00095bb0: 7374 6163 6b5f 7265 6672 6573 6828 290d  stack_refresh().
-00095bc0: 0a23 2020 2020 2020 2020 2020 2020 2073  .#             s
-00095bd0: 656c 662e 7265 6672 6573 685f 7769 6467  elf.refresh_widg
-00095be0: 6574 7328 290d 0a23 0d0a 2320 2020 2020  ets()..#..#     
-00095bf0: 2020 2020 2020 2020 5174 4775 692e 514d          QtGui.QM
-00095c00: 6573 7361 6765 426f 782e 7761 726e 696e  essageBox.warnin
-00095c10: 6728 7365 6c66 2c27 4572 726f 7227 2c22  g(self,'Error',"
-00095c20: 4572 726f 7220 636f 756c 6420 6e6f 7420  Error could not 
-00095c30: 6275 696c 6420 7374 6163 6b20 6c69 7374  build stack list
-00095c40: 2229 0d0a 2320 2020 2020 2020 2020 2020  ")..#           
-00095c50: 2020 696d 706f 7274 2073 7973 3b20 7072    import sys; pr
-00095c60: 696e 7420 7379 732e 6578 635f 696e 666f  int sys.exc_info
-00095c70: 2829 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d  ()......#-------
-00095c80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00095c90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00095ca0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00095cb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
-00095cc0: 0a20 2020 2064 6566 204c 6f61 6453 7461  .    def LoadSta
-00095cd0: 636b 3444 2873 656c 6629 3a0d 0a0d 0a20  ck4D(self):.... 
-00095ce0: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-00095cf0: 2020 2020 2023 6966 2054 7275 653a 0d0a       #if True:..
-00095d00: 0d0a 2020 2020 2020 2020 2020 2020 7769  ..            wi
-00095d10: 6c64 6361 7264 203d 2022 5375 7070 6f72  ldcard = "Suppor
-00095d20: 7465 6420 3444 2066 6f72 6d61 7473 2028  ted 4D formats (
-00095d30: 2a2e 6864 6635 202a 2e6e 6362 293b 3b48  *.hdf5 *.ncb);;H
-00095d40: 4446 3520 6669 6c65 7320 282a 2e68 6466  DF5 files (*.hdf
-00095d50: 3529 3b3b 4e43 4220 6669 6c65 7320 282a  5);;NCB files (*
-00095d60: 2e6e 6362 293b 3b22 0d0a 0d0a 2020 2020  .ncb);;"....    
-00095d70: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
-00095d80: 2c20 5f66 696c 7465 7220 3d20 5174 5769  , _filter = QtWi
-00095d90: 6467 6574 732e 5146 696c 6544 6961 6c6f  dgets.QFileDialo
-00095da0: 672e 6765 744f 7065 6e46 696c 654e 616d  g.getOpenFileNam
-00095db0: 6573 2873 656c 662c 2027 4f70 656e 2066  es(self, 'Open f
-00095dc0: 696c 6573 272c 2027 272c 2077 696c 6463  iles', '', wildc
-00095dd0: 6172 6429 0d0a 0d0a 2020 2020 2020 2020  ard)....        
-00095de0: 2020 2020 6966 2066 696c 6570 6174 6820      if filepath 
-00095df0: 3d3d 2027 273a 0d0a 2020 2020 2020 2020  == '':..        
-00095e00: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
-00095e10: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
-00095e20: 6c65 6e61 6d65 7320 3d20 5b5d 0d0a 2020  lenames = []..  
-00095e30: 2020 2020 2020 2020 2020 666f 7220 6e61            for na
-00095e40: 6d65 2069 6e20 6669 6c65 7061 7468 3a0d  me in filepath:.
-00095e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00095e60: 2066 696c 656e 616d 6573 2e61 7070 656e   filenames.appen
-00095e70: 6428 7374 7228 6e61 6d65 2929 0d0a 0d0a  d(str(name))....
-00095e80: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
-00095e90: 7265 6374 6f72 7920 3d20 206f 732e 7061  rectory =  os.pa
-00095ea0: 7468 2e64 6972 6e61 6d65 2873 7472 2866  th.dirname(str(f
-00095eb0: 696c 656e 616d 6573 5b30 5d29 290d 0a20  ilenames[0])).. 
-00095ec0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00095ed0: 7061 6765 312e 6669 6c65 6e61 6d65 203d  page1.filename =
-00095ee0: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
-00095ef0: 6528 6669 6c65 6e61 6d65 735b 305d 290d  e(filenames[0]).
-00095f00: 0a0d 0a20 2020 2020 2020 2020 2020 2051  ...            Q
-00095f10: 7457 6964 6765 7473 2e51 4170 706c 6963  tWidgets.QApplic
-00095f20: 6174 696f 6e2e 7365 744f 7665 7272 6964  ation.setOverrid
-00095f30: 6543 7572 736f 7228 5174 4775 692e 5143  eCursor(QtGui.QC
-00095f40: 7572 736f 7228 5174 2e57 6169 7443 7572  ursor(Qt.WaitCur
-00095f50: 736f 7229 290d 0a20 2020 2020 2020 2020  sor))..         
-00095f60: 2020 2062 6173 656e 616d 652c 2065 7874     basename, ext
-00095f70: 656e 7369 6f6e 203d 206f 732e 7061 7468  ension = os.path
-00095f80: 2e73 706c 6974 6578 7428 7365 6c66 2e70  .splitext(self.p
-00095f90: 6167 6531 2e66 696c 656e 616d 6529 0d0a  age1.filename)..
-00095fa0: 2020 2020 2020 2020 2020 2020 6578 7465              exte
-00095fb0: 6e73 696f 6e20 3d20 6578 7465 6e73 696f  nsion = extensio
-00095fc0: 6e2e 7374 7269 7028 290d 0a0d 0a20 2020  n.strip()....   
-00095fd0: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
-00095fe0: 6d6d 6f6e 2e70 6174 6820 3d20 6469 7265  mmon.path = dire
-00095ff0: 6374 6f72 790d 0a20 2020 2020 2020 2020  ctory..         
-00096000: 2020 2073 656c 662e 636f 6d6d 6f6e 2e66     self.common.f
-00096010: 696c 656e 616d 6520 3d20 7365 6c66 2e70  ilename = self.p
-00096020: 6167 6531 2e66 696c 656e 616d 650d 0a0d  age1.filename...
-00096030: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00096040: 6578 7465 6e73 696f 6e20 3d3d 2027 2e68  extension == '.h
-00096050: 6466 3527 3a0d 0a20 2020 2020 2020 2020  df5':..         
-00096060: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
-00096070: 6f6d 6d6f 6e2e 7374 6163 6b5f 6c6f 6164  ommon.stack_load
-00096080: 6564 203d 3d20 313a 0d0a 2020 2020 2020  ed == 1:..      
-00096090: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000960a0: 6c66 2e6e 6577 5f73 7461 636b 5f72 6566  lf.new_stack_ref
-000960b0: 7265 7368 2829 0d0a 2020 2020 2020 2020  resh()..        
-000960c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000960d0: 2e73 746b 2e6e 6577 5f64 6174 6128 290d  .stk.new_data().
-000960e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000960f0: 2020 2020 2073 656c 662e 616e 6c7a 2e64       self.anlz.d
-00096100: 656c 6574 655f 6461 7461 2829 0d0a 2020  elete_data()..  
-00096110: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00096120: 6c66 2e73 746b 2e72 6561 645f 6835 3444  lf.stk.read_h54D
-00096130: 2866 696c 656e 616d 6573 5b30 5d29 0d0a  (filenames[0])..
-00096140: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00096150: 2020 7072 696e 7428 2746 696e 6973 6865    print('Finishe
-00096160: 6420 7265 6164 696e 6720 3444 2073 7461  d reading 4D sta
-00096170: 636b 272c 2066 696c 656e 616d 6573 5b30  ck', filenames[0
-00096180: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
-00096190: 2020 656c 6966 2065 7874 656e 7369 6f6e    elif extension
-000961a0: 203d 3d20 272e 6e63 6227 3a0d 0a20 2020   == '.ncb':..   
-000961b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000961c0: 7365 6c66 2e63 6f6d 6d6f 6e2e 7374 6163  self.common.stac
-000961d0: 6b5f 6c6f 6164 6564 203d 3d20 313a 0d0a  k_loaded == 1:..
-000961e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000961f0: 2020 2020 7365 6c66 2e6e 6577 5f73 7461      self.new_sta
-00096200: 636b 5f72 6566 7265 7368 2829 0d0a 2020  ck_refresh()..  
-00096210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00096220: 2020 7365 6c66 2e73 746b 2e6e 6577 5f64    self.stk.new_d
-00096230: 6174 6128 290d 0a20 2020 2020 2020 2020  ata()..         
-00096240: 2020 2020 2020 2020 2020 2023 7365 6c66             #self
-00096250: 2e73 746b 2e64 6174 615f 7374 7275 6374  .stk.data_struct
-00096260: 2e64 656c 6574 655f 6461 7461 2829 0d0a  .delete_data()..
-00096270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00096280: 2020 2020 7365 6c66 2e61 6e6c 7a2e 6465      self.anlz.de
-00096290: 6c65 7465 5f64 6174 6128 290d 0a20 2020  lete_data()..   
-000962a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000962b0: 662e 7374 6b2e 7265 6164 5f6e 6362 3444  f.stk.read_ncb4D
-000962c0: 2866 696c 656e 616d 6573 290d 0a20 2020  (filenames)..   
-000962d0: 2020 2020 2020 2020 2020 2020 2023 4765               #Ge
-000962e0: 7420 656e 6572 6779 206c 6973 740d 0a20  t energy list.. 
-000962f0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00096300: 696c 6463 6172 6420 3d20 2022 5465 7874  ildcard =  "Text
-00096310: 2066 696c 6520 282a 2e74 7874 293b 3b22   file (*.txt);;"
-00096320: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00096330: 2020 656e 6766 696c 6570 6174 682c 205f    engfilepath, _
-00096340: 6669 6c74 6572 203d 2051 7457 6964 6765  filter = QtWidge
-00096350: 7473 2e51 4669 6c65 4469 616c 6f67 2e67  ts.QFileDialog.g
-00096360: 6574 4f70 656e 4669 6c65 4e61 6d65 2873  etOpenFileName(s
-00096370: 656c 662c 2027 4f70 656e 2066 696c 6527  elf, 'Open file'
-00096380: 2c20 6469 7265 6374 6f72 792c 2077 696c  , directory, wil
-00096390: 6463 6172 6429 0d0a 2020 2020 2020 2020  dcard)..        
-000963a0: 2020 2020 2020 2020 7365 6c66 2e73 746b          self.stk
-000963b0: 2e72 6561 645f 6e63 6234 4465 6e65 7267  .read_ncb4Denerg
-000963c0: 7928 7374 7228 656e 6766 696c 6570 6174  y(str(engfilepat
-000963d0: 6829 290d 0a0d 0a0d 0a20 2020 2020 2020  h))......       
-000963e0: 2020 2020 2023 5570 6461 7465 2077 6964       #Update wid
-000963f0: 6765 7473 0d0a 2020 2020 2020 2020 2020  gets..          
-00096400: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
-00096410: 2873 656c 662e 7374 6b2c 2027 7468 6574  (self.stk, 'thet
-00096420: 6127 2920 6f72 2074 7970 6528 7365 6c66  a') or type(self
-00096430: 2e73 746b 2e74 6865 7461 2920 3d3d 2069  .stk.theta) == i
-00096440: 6e74 3a0d 0a20 2020 2020 2020 2020 2020  nt:..           
-00096450: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
-00096460: 7272 6f72 2822 4e6f 7420 6120 3444 2073  rror("Not a 4D s
-00096470: 7461 636b 2229 0d0a 2020 2020 2020 2020  tack")..        
-00096480: 2020 2020 7365 6c66 2e63 6f6d 6d6f 6e2e      self.common.
-00096490: 7374 6163 6b5f 3464 203d 2031 0d0a 0d0a  stack_4d = 1....
-000964a0: 2020 2020 2020 2020 2020 2020 783d 7365              x=se
-000964b0: 6c66 2e73 746b 2e6e 5f63 6f6c 730d 0a20  lf.stk.n_cols.. 
-000964c0: 2020 2020 2020 2020 2020 2079 3d73 656c             y=sel
-000964d0: 662e 7374 6b2e 6e5f 726f 7773 0d0a 2020  f.stk.n_rows..  
-000964e0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-000964f0: 6167 6531 2e69 6d67 7267 6220 3d20 6e70  age1.imgrgb = np
-00096500: 2e7a 6572 6f73 2878 2a79 2a33 2c64 7479  .zeros(x*y*3,dty
-00096510: 7065 203d 2022 7569 6e74 3822 290d 0a20  pe = "uint8").. 
-00096520: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00096530: 7061 6765 312e 6d61 7876 616c 203d 206e  page1.maxval = n
-00096540: 702e 616d 6178 2873 656c 662e 7374 6b2e  p.amax(self.stk.
-00096550: 6162 7364 6174 6129 0d0a 0d0a 0d0a 2020  absdata)......  
-00096560: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-00096570: 7820 3d20 696e 7428 782f 3229 0d0a 2020  x = int(x/2)..  
-00096580: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-00096590: 7920 3d20 696e 7428 792f 3229 0d0a 0d0a  y = int(y/2)....
-000965a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000965b0: 2e70 6167 6531 2e69 7820 3d20 7365 6c66  .page1.ix = self
-000965c0: 2e69 780d 0a20 2020 2020 2020 2020 2020  .ix..           
-000965d0: 2073 656c 662e 7061 6765 312e 6979 203d   self.page1.iy =
-000965e0: 2073 656c 662e 6979 0d0a 0d0a 2020 2020   self.iy....    
-000965f0: 2020 2020 2020 2020 7365 6c66 2e69 6576          self.iev
-00096600: 203d 2069 6e74 2873 656c 662e 7374 6b2e   = int(self.stk.
-00096610: 6e5f 6576 2f32 290d 0a20 2020 2020 2020  n_ev/2)..       
-00096620: 2020 2020 2073 656c 662e 7061 6765 302e       self.page0.
-00096630: 736c 6964 6572 5f65 6e67 2e73 6574 5261  slider_eng.setRa
-00096640: 6e67 6528 302c 7365 6c66 2e73 746b 2e6e  nge(0,self.stk.n
-00096650: 5f65 762d 3129 0d0a 2020 2020 2020 2020  _ev-1)..        
-00096660: 2020 2020 7365 6c66 2e70 6167 6530 2e69      self.page0.i
-00096670: 6576 203d 2073 656c 662e 6965 760d 0a20  ev = self.iev.. 
-00096680: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00096690: 7061 6765 302e 736c 6964 6572 5f65 6e67  page0.slider_eng
-000966a0: 2e73 6574 5661 6c75 6528 7365 6c66 2e69  .setValue(self.i
-000966b0: 6576 290d 0a0d 0a20 2020 2020 2020 2020  ev)....         
-000966c0: 2020 2073 656c 662e 7061 6765 312e 736c     self.page1.sl
-000966d0: 6964 6572 5f65 6e67 2e73 6574 5261 6e67  ider_eng.setRang
-000966e0: 6528 302c 7365 6c66 2e73 746b 2e6e 5f65  e(0,self.stk.n_e
-000966f0: 762d 3129 0d0a 2020 2020 2020 2020 2020  v-1)..          
-00096700: 2020 7365 6c66 2e70 6167 6531 2e69 6576    self.page1.iev
-00096710: 203d 2073 656c 662e 6965 760d 0a20 2020   = self.iev..   
-00096720: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-00096730: 6765 312e 736c 6964 6572 5f65 6e67 2e73  ge1.slider_eng.s
-00096740: 6574 5661 6c75 6528 7365 6c66 2e69 6576  etValue(self.iev
-00096750: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00096760: 2073 656c 662e 7061 6765 302e 736c 6964   self.page0.slid
-00096770: 6572 5f74 6865 7461 2e73 6574 5669 7369  er_theta.setVisi
-00096780: 626c 6528 5472 7565 290d 0a20 2020 2020  ble(True)..     
-00096790: 2020 2020 2020 2023 7365 6c66 2e70 6167         #self.pag
-000967a0: 6530 2e74 635f 696d 6167 6574 6865 7461  e0.tc_imagetheta
-000967b0: 2e73 6574 5669 7369 626c 6528 5472 7565  .setVisible(True
-000967c0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-000967d0: 656c 662e 6974 6865 7461 203d 2030 0d0a  elf.itheta = 0..
-000967e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000967f0: 2e70 6167 6530 2e73 6c69 6465 725f 7468  .page0.slider_th
-00096800: 6574 612e 7365 7452 616e 6765 2830 2c73  eta.setRange(0,s
-00096810: 656c 662e 7374 6b2e 6e5f 7468 6574 612d  elf.stk.n_theta-
-00096820: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-00096830: 7365 6c66 2e70 6167 6530 2e69 7468 6574  self.page0.ithet
-00096840: 6120 3d20 7365 6c66 2e69 7468 6574 610d  a = self.itheta.
-00096850: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00096860: 662e 7061 6765 302e 736c 6964 6572 5f74  f.page0.slider_t
-00096870: 6865 7461 2e73 6574 5661 6c75 6528 7365  heta.setValue(se
-00096880: 6c66 2e69 7468 6574 6129 0d0a 2020 2020  lf.itheta)..    
-00096890: 2020 2020 2020 2020 2373 656c 662e 7061          #self.pa
-000968a0: 6765 302e 7463 5f69 6d61 6765 7468 6574  ge0.tc_imagethet
-000968b0: 612e 7365 7454 6578 7428 2234 4420 4461  a.setText("4D Da
-000968c0: 7461 2041 6e67 6c65 3a20 222b 7374 7228  ta Angle: "+str(
-000968d0: 7365 6c66 2e73 746b 2e74 6865 7461 5b73  self.stk.theta[s
-000968e0: 656c 662e 6974 6865 7461 5d29 290d 0a0d  elf.itheta]))...
-000968f0: 0a0d 0a20 2020 2020 2020 2020 2020 2073  ...            s
-00096900: 656c 662e 7061 6765 312e 736c 6964 6572  elf.page1.slider
-00096910: 5f74 6865 7461 2e73 6574 5669 7369 626c  _theta.setVisibl
-00096920: 6528 5472 7565 290d 0a20 2020 2020 2020  e(True)..       
-00096930: 2020 2020 2073 656c 662e 7061 6765 312e       self.page1.
-00096940: 7463 5f69 6d61 6765 7468 6574 612e 7365  tc_imagetheta.se
-00096950: 7456 6973 6962 6c65 2854 7275 6529 0d0a  tVisible(True)..
-00096960: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00096970: 2e70 6167 6531 2e73 6c69 6465 725f 7468  .page1.slider_th
-00096980: 6574 612e 7365 7452 616e 6765 2830 2c73  eta.setRange(0,s
-00096990: 656c 662e 7374 6b2e 6e5f 7468 6574 612d  elf.stk.n_theta-
-000969a0: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-000969b0: 7365 6c66 2e70 6167 6531 2e69 7468 6574  self.page1.ithet
-000969c0: 6120 3d20 7365 6c66 2e69 7468 6574 610d  a = self.itheta.
-000969d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000969e0: 662e 7061 6765 312e 736c 6964 6572 5f74  f.page1.slider_t
-000969f0: 6865 7461 2e73 6574 5661 6c75 6528 7365  heta.setValue(se
-00096a00: 6c66 2e69 7468 6574 6129 0d0a 2020 2020  lf.itheta)..    
-00096a10: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
-00096a20: 6531 2e62 7574 746f 6e5f 6d75 6c74 6963  e1.button_multic
-00096a30: 726f 702e 7365 7454 6578 7428 2743 726f  rop.setText('Cro
-00096a40: 7020 7374 6163 6b20 3444 2e2e 2e27 290d  p stack 4D...').
-00096a50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00096a60: 662e 7061 6765 312e 7463 5f69 6d61 6765  f.page1.tc_image
-00096a70: 7468 6574 612e 7365 7454 6578 7428 2234  theta.setText("4
-00096a80: 4420 4461 7461 2041 6e67 6c65 3a20 222b  D Data Angle: "+
-00096a90: 7374 7228 7365 6c66 2e73 746b 2e74 6865  str(self.stk.the
-00096aa0: 7461 5b73 656c 662e 6974 6865 7461 5d29  ta[self.itheta])
-00096ab0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00096ac0: 2073 656c 662e 7061 6765 322e 6275 7474   self.page2.butt
-00096ad0: 6f6e 5f63 616c 6370 6361 3444 2e73 6574  on_calcpca4D.set
-00096ae0: 5669 7369 626c 6528 5472 7565 290d 0a20  Visible(True).. 
-00096af0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00096b00: 7061 6765 342e 6275 7474 6f6e 5f63 616c  page4.button_cal
-00096b10: 6334 642e 7365 7456 6973 6962 6c65 2854  c4d.setVisible(T
-00096b20: 7275 6529 0d0a 0d0a 0d0a 2020 2020 2020  rue)......      
-00096b30: 2020 2020 2020 7365 6c66 2e63 6f6d 6d6f        self.commo
-00096b40: 6e2e 7374 6163 6b5f 6c6f 6164 6564 203d  n.stack_loaded =
-00096b50: 2031 0d0a 0d0a 2020 2020 2020 2020 2020   1....          
-00096b60: 2020 6966 2073 656c 662e 7374 6b2e 6461    if self.stk.da
-00096b70: 7461 5f73 7472 7563 742e 7370 6563 7472  ta_struct.spectr
-00096b80: 6f6d 6963 726f 7363 6f70 792e 6e6f 726d  omicroscopy.norm
-00096b90: 616c 697a 6174 696f 6e2e 7768 6974 655f  alization.white_
-00096ba0: 7370 6563 7472 756d 2069 7320 6e6f 7420  spectrum is not 
-00096bb0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00096bc0: 2020 2020 2020 2073 656c 662e 636f 6d6d         self.comm
-00096bd0: 6f6e 2e69 305f 6c6f 6164 6564 203d 2031  on.i0_loaded = 1
-00096be0: 0d0a 0d0a 0d0a 2020 2020 2020 2020 2020  ......          
-00096bf0: 2020 7365 6c66 2e70 6167 6531 2e52 6573    self.page1.Res
-00096c00: 6574 4469 7370 6c61 7953 6574 7469 6e67  etDisplaySetting
-00096c10: 7328 290d 0a20 2020 2020 2020 2020 2020  s()..           
-00096c20: 2073 656c 662e 7061 6765 312e 6c6f 6164   self.page1.load
-00096c30: 496d 6167 6528 290d 0a20 2020 2020 2020  Image()..       
-00096c40: 2020 2020 2073 656c 662e 7061 6765 312e       self.page1.
-00096c50: 7368 6f77 5370 6563 7472 756d 2873 656c  showSpectrum(sel
-00096c60: 662e 6978 2c20 7365 6c66 2e69 7929 0d0a  f.ix, self.iy)..
-00096c70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00096c80: 2e70 6167 6531 2e74 6578 7463 7472 6c2e  .page1.textctrl.
-00096c90: 7365 7454 6578 7428 7365 6c66 2e70 6167  setText(self.pag
-00096ca0: 6531 2e66 696c 656e 616d 6529 0d0a 0d0a  e1.filename)....
-00096cb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00096cc0: 2e70 6167 6530 2e43 6c65 6172 2829 0d0a  .page0.Clear()..
-00096cd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00096ce0: 2e70 6167 6530 2e4c 6f61 6445 6e74 7269  .page0.LoadEntri
-00096cf0: 6573 2829 0d0a 2020 2020 2020 2020 2020  es()..          
-00096d00: 2020 7365 6c66 2e70 6167 6530 2e53 686f    self.page0.Sho
-00096d10: 7749 6e66 6f28 7365 6c66 2e70 6167 6531  wInfo(self.page1
-00096d20: 2e66 696c 656e 616d 652c 2064 6972 6563  .filename, direc
-00096d30: 746f 7279 290d 0a0d 0a20 2020 2020 2020  tory)....       
-00096d40: 2020 2020 2073 656c 662e 7061 6765 352e       self.page5.
-00096d50: 7570 6461 7465 7769 6467 6574 7328 290d  updatewidgets().
-00096d60: 0a0d 0a20 2020 2020 2020 2020 2020 2051  ...            Q
-00096d70: 7457 6964 6765 7473 2e51 4170 706c 6963  tWidgets.QApplic
-00096d80: 6174 696f 6e2e 7265 7374 6f72 654f 7665  ation.restoreOve
-00096d90: 7272 6964 6543 7572 736f 7228 290d 0a0d  rrideCursor()...
-00096da0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00096db0: 7368 6f77 6d61 7074 6162 3a0d 0a20 2020  showmaptab:..   
-00096dc0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00096dd0: 662e 7061 6765 392e 436c 6561 7228 290d  f.page9.Clear().
-00096de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00096df0: 2073 656c 662e 7061 6765 392e 4c6f 6164   self.page9.Load
-00096e00: 456e 7472 6965 7328 290d 0a20 2020 2020  Entries()..     
-00096e10: 2020 2065 7863 6570 743a 0d0a 0d0a 2020     except:....  
-00096e20: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00096e30: 6f6d 6d6f 6e2e 7374 6163 6b5f 6c6f 6164  ommon.stack_load
-00096e40: 6564 203d 2030 0d0a 2020 2020 2020 2020  ed = 0..        
-00096e50: 2020 2020 7365 6c66 2e63 6f6d 6d6f 6e2e      self.common.
-00096e60: 6930 5f6c 6f61 6465 6420 3d20 300d 0a20  i0_loaded = 0.. 
-00096e70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00096e80: 6e65 775f 7374 6163 6b5f 7265 6672 6573  new_stack_refres
-00096e90: 6828 290d 0a20 2020 2020 2020 2020 2020  h()..           
-00096ea0: 2073 656c 662e 7061 6765 312e 6275 7474   self.page1.butt
-00096eb0: 6f6e 5f6d 756c 7469 6372 6f70 2e73 6574  on_multicrop.set
-00096ec0: 5465 7874 2827 4372 6f70 2073 7461 636b  Text('Crop stack
-00096ed0: 2033 442f 3444 2e2e 2e27 290d 0a20 2020   3D/4D...')..   
-00096ee0: 2020 2020 2020 2020 2051 7457 6964 6765           QtWidge
-00096ef0: 7473 2e51 4170 706c 6963 6174 696f 6e2e  ts.QApplication.
-00096f00: 7265 7374 6f72 654f 7665 7272 6964 6543  restoreOverrideC
-00096f10: 7572 736f 7228 290d 0a20 2020 2020 2020  ursor()..       
-00096f20: 2020 2020 2051 7447 7569 2e51 4d65 7373       QtGui.QMess
-00096f30: 6167 6542 6f78 2e77 6172 6e69 6e67 2873  ageBox.warning(s
-00096f40: 656c 662c 2027 4572 726f 7227 2c20 2749  elf, 'Error', 'I
-00096f50: 6d61 6765 2073 7461 636b 206e 6f74 206c  mage stack not l
-00096f60: 6f61 6465 642e 2729 0d0a 0d0a 2020 2020  oaded.')....    
-00096f70: 2020 2020 2020 2020 696d 706f 7274 2073          import s
-00096f80: 7973 0d0a 2020 2020 2020 2020 2020 2020  ys..            
-00096f90: 7072 696e 7428 7379 732e 6578 635f 696e  print(sys.exc_in
-00096fa0: 666f 2829 290d 0a0d 0a0d 0a20 2020 2020  fo())......     
-00096fb0: 2020 2073 656c 662e 7265 6672 6573 685f     self.refresh_
-00096fc0: 7769 6467 6574 7328 290d 0a0d 0a23 2d2d  widgets()....#--
-00096fd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00096fe0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00096ff0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00097000: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00097010: 2d2d 2d2d 0d0a 2020 2020 6465 6620 4f6e  ----..    def On
-00097020: 5361 7665 5072 6f63 6573 7365 6453 7461  SaveProcessedSta
-00097030: 636b 2873 656c 662c 2065 7665 6e74 293a  ck(self, event):
-00097040: 0d0a 2020 2020 2020 2020 7365 6c66 2e53  ..        self.S
-00097050: 6176 6550 726f 6365 7373 6564 5374 6163  aveProcessedStac
-00097060: 6b28 290d 0a0d 0a0d 0a23 2d2d 2d2d 2d2d  k()......#------
-00097070: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00097080: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00097090: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000970a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000970b0: 0d0a 2020 2020 6465 6620 5361 7665 5072  ..    def SavePr
-000970c0: 6f63 6573 7365 6453 7461 636b 2873 656c  ocessedStack(sel
-000970d0: 6629 3a0d 0a0d 0a20 2020 2020 2020 2022  f):....        "
-000970e0: 2222 0d0a 2020 2020 2020 2020 4578 706f  ""..        Expo
-000970f0: 7274 2070 726f 6365 7373 6564 2073 7461  rt processed sta
-00097100: 636b 2074 6f20 6669 6c65 0d0a 2020 2020  ck to file..    
-00097110: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00097120: 2066 696c 6570 6174 682c 2070 6c75 6769   filepath, plugi
-00097130: 6e20 3d20 4669 6c65 5f47 5549 2e53 656c  n = File_GUI.Sel
-00097140: 6563 7446 696c 6528 2777 7269 7465 272c  ectFile('write',
-00097150: 2773 7461 636b 2729 0d0a 2020 2020 2020  'stack')..      
-00097160: 2020 6966 2066 696c 6570 6174 6820 6973    if filepath is
-00097170: 206e 6f74 204e 6f6e 6520 616e 6420 706c   not None and pl
-00097180: 7567 696e 2069 7320 6e6f 7420 4e6f 6e65  ugin is not None
-00097190: 3a0d 0a20 2020 2020 2020 2020 2020 2051  :..            Q
-000971a0: 7457 6964 6765 7473 2e51 4170 706c 6963  tWidgets.QApplic
-000971b0: 6174 696f 6e2e 7365 744f 7665 7272 6964  ation.setOverrid
-000971c0: 6543 7572 736f 7228 5174 4775 692e 5143  eCursor(QtGui.QC
-000971d0: 7572 736f 7228 5174 2e57 6169 7443 7572  ursor(Qt.WaitCur
-000971e0: 736f 7229 290d 0a20 2020 2020 2020 2020  sor))..         
-000971f0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00097200: 2020 2020 2020 2020 2066 696c 655f 706c           file_pl
-00097210: 7567 696e 732e 7361 7665 2866 696c 6570  ugins.save(filep
-00097220: 6174 682c 2073 656c 662e 7374 6b2c 2027  ath, self.stk, '
-00097230: 7374 6163 6b27 2c20 706c 7567 696e 3d70  stack', plugin=p
-00097240: 6c75 6769 6e29 0d0a 2020 2020 2020 2020  lugin)..        
-00097250: 2020 2020 2020 2020 5174 5769 6467 6574          QtWidget
-00097260: 732e 5141 7070 6c69 6361 7469 6f6e 2e72  s.QApplication.r
-00097270: 6573 746f 7265 4f76 6572 7269 6465 4375  estoreOverrideCu
-00097280: 7273 6f72 2829 0d0a 2020 2020 2020 2020  rsor()..        
-00097290: 2020 2020 6578 6365 7074 3a0d 0a20 2020      except:..   
-000972a0: 2020 2020 2020 2020 2020 2020 2051 7457               QtW
-000972b0: 6964 6765 7473 2e51 4170 706c 6963 6174  idgets.QApplicat
-000972c0: 696f 6e2e 7265 7374 6f72 654f 7665 7272  ion.restoreOverr
-000972d0: 6964 6543 7572 736f 7228 290d 0a20 2020  ideCursor()..   
-000972e0: 2020 2020 2020 2020 2020 2020 2051 7457               QtW
-000972f0: 6964 6765 7473 2e51 4d65 7373 6167 6542  idgets.QMessageB
-00097300: 6f78 2e77 6172 6e69 6e67 2873 656c 662c  ox.warning(self,
-00097310: 2027 4572 726f 7227 2c20 2743 6f75 6c64   'Error', 'Could
-00097320: 206e 6f74 2073 6176 6520 7072 6f63 6573   not save proces
-00097330: 7365 6420 7374 6163 6b20 6669 6c65 2e27  sed stack file.'
-00097340: 290d 0a0d 0a0d 0a0d 0a0d 0a20 2020 2020  )..........     
-00097350: 2020 2072 6574 7572 6e0d 0a0d 0a0d 0a23     return......#
-00097360: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00097370: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00097380: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00097390: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000973a0: 2d2d 2d2d 2d2d 0d0a 2020 2020 6465 6620  ------..    def 
-000973b0: 6f6e 5361 7665 5265 7375 6c74 7354 6f48  onSaveResultsToH
-000973c0: 3528 7365 6c66 2c20 6576 656e 7429 3a0d  5(self, event):.
-000973d0: 0a20 2020 2020 2020 2073 656c 662e 5361  .        self.Sa
-000973e0: 7665 5265 7375 6c74 7354 6f48 3528 290d  veResultsToH5().
-000973f0: 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ...#------------
-00097400: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00097410: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00097420: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00097430: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
-00097440: 6465 6620 5361 7665 5265 7375 6c74 7354  def SaveResultsT
-00097450: 6f48 3528 7365 6c66 293a 0d0a 0d0a 2020  oH5(self):....  
-00097460: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00097470: 2020 2042 726f 7773 6520 666f 7220 2e68     Browse for .h
-00097480: 6466 3520 6669 6c65 0d0a 2020 2020 2020  df5 file..      
-00097490: 2020 2222 220d 0a0d 0a20 2020 2020 2020    """....       
-000974a0: 2074 7279 3a0d 0a0d 0a20 2020 2020 2020   try:....       
-000974b0: 2020 2020 2023 7072 696e 7420 7365 6c66       #print self
-000974c0: 2e64 6174 615f 7374 7275 6374 2e65 7863  .data_struct.exc
-000974d0: 6861 6e67 652e 6461 7461 2e73 6861 7065  hange.data.shape
-000974e0: 0d0a 2020 2020 2020 2020 2020 2020 2370  ..            #p
-000974f0: 7269 6e74 2073 656c 662e 6461 7461 5f73  rint self.data_s
-00097500: 7472 7563 742e 6578 6368 616e 6765 2e64  truct.exchange.d
-00097510: 6174 615f 6178 6573 0d0a 0d0a 2020 2020  ata_axes....    
-00097520: 2020 2020 2020 2020 7769 6c64 6361 7264          wildcard
-00097530: 203d 2022 4844 4635 2066 696c 6573 2028   = "HDF5 files (
-00097540: 2a2e 6864 6635 2922 0d0a 0d0a 2020 2020  *.hdf5)"....    
-00097550: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
-00097560: 2c20 5f66 696c 7465 7220 3d20 5174 5769  , _filter = QtWi
-00097570: 6467 6574 732e 5146 696c 6544 6961 6c6f  dgets.QFileDialo
-00097580: 672e 6765 7453 6176 6546 696c 654e 616d  g.getSaveFileNam
-00097590: 6528 7365 6c66 2c20 2753 6176 6520 6173  e(self, 'Save as
-000975a0: 202e 6864 6635 272c 2027 272c 2077 696c   .hdf5', '', wil
-000975b0: 6463 6172 6429 0d0a 0d0a 2020 2020 2020  dcard)....      
-000975c0: 2020 2020 2020 6669 6c65 7061 7468 203d        filepath =
-000975d0: 2073 7472 2866 696c 6570 6174 6829 0d0a   str(filepath)..
-000975e0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-000975f0: 696c 6570 6174 6820 3d3d 2027 273a 0d0a  ilepath == '':..
-00097600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00097610: 7265 7475 726e 0d0a 0d0a 0d0a 2020 2020  return......    
-00097620: 2020 2020 2020 2020 6469 7265 6374 6f72          director
-00097630: 7920 3d20 206f 732e 7061 7468 2e64 6972  y =  os.path.dir
-00097640: 6e61 6d65 2873 7472 2866 696c 6570 6174  name(str(filepat
-00097650: 6829 290d 0a20 2020 2020 2020 2020 2020  h))..           
-00097660: 2073 656c 662e 7061 6765 312e 6669 6c65   self.page1.file
-00097670: 6e61 6d65 203d 2020 6f73 2e70 6174 682e  name =  os.path.
-00097680: 6261 7365 6e61 6d65 2873 7472 2866 696c  basename(str(fil
-00097690: 6570 6174 6829 290d 0a0d 0a20 2020 2020  epath))....     
-000976a0: 2020 2020 2020 2051 7457 6964 6765 7473         QtWidgets
-000976b0: 2e51 4170 706c 6963 6174 696f 6e2e 7365  .QApplication.se
-000976c0: 744f 7665 7272 6964 6543 7572 736f 7228  tOverrideCursor(
-000976d0: 5174 4775 692e 5143 7572 736f 7228 5174  QtGui.QCursor(Qt
-000976e0: 2e57 6169 7443 7572 736f 7229 290d 0a0d  .WaitCursor))...
-000976f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00097700: 662e 636f 6d6d 6f6e 2e70 6174 6820 3d20  f.common.path = 
-00097710: 6469 7265 6374 6f72 790d 0a20 2020 2020  directory..     
-00097720: 2020 2020 2020 2073 656c 662e 636f 6d6d         self.comm
-00097730: 6f6e 2e66 696c 656e 616d 6520 3d20 7365  on.filename = se
-00097740: 6c66 2e70 6167 6531 2e66 696c 656e 616d  lf.page1.filenam
-00097750: 650d 0a0d 0a0d 0a20 2020 2020 2020 2020  e......         
-00097760: 2020 2066 696c 655f 6461 7461 6578 6368     file_dataexch
-00097770: 5f68 6466 352e 7772 6974 655f 7265 7375  _hdf5.write_resu
-00097780: 6c74 735f 6835 2866 696c 6570 6174 682c  lts_h5(filepath,
-00097790: 2073 656c 662e 6461 7461 5f73 7472 7563   self.data_struc
-000977a0: 742c 2073 656c 662e 616e 6c7a 290d 0a0d  t, self.anlz)...
-000977b0: 0a20 2020 2020 2020 2020 2020 2051 7457  .            QtW
-000977c0: 6964 6765 7473 2e51 4170 706c 6963 6174  idgets.QApplicat
-000977d0: 696f 6e2e 7265 7374 6f72 654f 7665 7272  ion.restoreOverr
-000977e0: 6964 6543 7572 736f 7228 290d 0a0d 0a20  ideCursor().... 
-000977f0: 2020 2020 2020 2065 7863 6570 743a 0d0a         except:..
-00097800: 0d0a 2020 2020 2020 2020 2020 2020 5174  ..            Qt
-00097810: 5769 6467 6574 732e 5141 7070 6c69 6361  Widgets.QApplica
-00097820: 7469 6f6e 2e72 6573 746f 7265 4f76 6572  tion.restoreOver
-00097830: 7269 6465 4375 7273 6f72 2829 0d0a 2020  rideCursor()..  
-00097840: 2020 2020 2020 2020 2020 5174 4775 692e            QtGui.
-00097850: 514d 6573 7361 6765 426f 782e 7761 726e  QMessageBox.warn
-00097860: 696e 6728 7365 6c66 2c20 2745 7272 6f72  ing(self, 'Error
-00097870: 272c 2027 436f 756c 6420 6e6f 7420 7361  ', 'Could not sa
-00097880: 7665 2048 4446 3520 6669 6c65 2e27 290d  ve HDF5 file.').
-00097890: 0a0d 0a0d 0a20 2020 2020 2020 2073 656c  .....        sel
-000978a0: 662e 7265 6672 6573 685f 7769 6467 6574  f.refresh_widget
-000978b0: 7328 290d 0a0d 0a20 2020 2020 2020 2072  s()....        r
-000978c0: 6574 7572 6e0d 0a0d 0a23 2d2d 2d2d 2d2d  eturn....#------
-000978d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000978e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000978f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00097900: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00097910: 0d0a 2020 2020 6465 6620 6f6e 4162 6f75  ..    def onAbou
-00097920: 7428 7365 6c66 293a 0d0a 0d0a 2020 2020  t(self):....    
-00097930: 2020 2020 7365 6c66 2e70 6f70 7570 203d      self.popup =
-00097940: 2041 626f 7574 4672 616d 6528 7365 6c66   AboutFrame(self
-00097950: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00097960: 706f 7075 702e 7368 6f77 2829 0d0a 0d0a  popup.show()....
-00097970: 0d0a 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d  ....#-----------
-00097980: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00097990: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000979a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000979b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020  -----------..   
-000979c0: 2064 6566 2072 6566 7265 7368 5f77 6964   def refresh_wid
-000979d0: 6765 7473 2873 656c 6629 3a0d 0a0d 0a0d  gets(self):.....
-000979e0: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
-000979f0: 6c66 2e63 6f6d 6d6f 6e2e 7374 6163 6b5f  lf.common.stack_
-00097a00: 6c6f 6164 6564 203d 3d20 303a 0d0a 2020  loaded == 0:..  
-00097a10: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00097a20: 6167 6531 2e62 7574 746f 6e5f 6930 6666  age1.button_i0ff
-00097a30: 696c 652e 7365 7445 6e61 626c 6564 2846  ile.setEnabled(F
-00097a40: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
-00097a50: 2020 2073 656c 662e 7061 6765 312e 6275     self.page1.bu
-00097a60: 7474 6f6e 5f69 3068 6973 746f 6772 616d  tton_i0histogram
-00097a70: 2e73 6574 456e 6162 6c65 6428 4661 6c73  .setEnabled(Fals
-00097a80: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00097a90: 7365 6c66 2e70 6167 6531 2e62 7574 746f  self.page1.butto
-00097aa0: 6e5f 6172 7465 6661 6374 732e 7365 7445  n_artefacts.setE
-00097ab0: 6e61 626c 6564 2846 616c 7365 290d 0a20  nabled(False).. 
-00097ac0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00097ad0: 7061 6765 312e 6275 7474 6f6e 5f70 7265  page1.button_pre
-00097ae0: 6e6f 726d 2e73 6574 456e 6162 6c65 6428  norm.setEnabled(
-00097af0: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-00097b00: 2020 2020 7365 6c66 2e70 6167 6531 2e62      self.page1.b
-00097b10: 7574 746f 6e5f 7265 6669 6d67 732e 7365  utton_refimgs.se
-00097b20: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
-00097b30: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00097b40: 662e 7061 6765 312e 6275 7474 6f6e 5f6d  f.page1.button_m
-00097b50: 756c 7469 6372 6f70 2e73 6574 456e 6162  ulticrop.setEnab
-00097b60: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
-00097b70: 2020 2020 2020 2020 2373 656c 662e 7061          #self.pa
-00097b80: 6765 312e 6275 7474 6f6e 5f6c 696d 6974  ge1.button_limit
-00097b90: 6576 2e73 6574 456e 6162 6c65 6428 4661  ev.setEnabled(Fa
-00097ba0: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
-00097bb0: 2020 2373 656c 662e 7061 6765 312e 6275    #self.page1.bu
-00097bc0: 7474 6f6e 5f73 7562 7265 6769 6f6e 2e73  tton_subregion.s
-00097bd0: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
-00097be0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00097bf0: 6c66 2e70 6167 6531 2e62 7574 746f 6e5f  lf.page1.button_
-00097c00: 6461 726b 7369 672e 7365 7445 6e61 626c  darksig.setEnabl
-00097c10: 6564 2846 616c 7365 290d 0a20 2020 2020  ed(False)..     
-00097c20: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
-00097c30: 312e 6275 7474 6f6e 5f73 6176 652e 7365  1.button_save.se
-00097c40: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
-00097c50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00097c60: 662e 7061 6765 312e 6275 7474 6f6e 5f73  f.page1.button_s
-00097c70: 6176 6573 7461 636b 2e73 6574 456e 6162  avestack.setEnab
-00097c80: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
-00097c90: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
-00097ca0: 6531 2e62 7574 746f 6e5f 616c 6967 6e2e  e1.button_align.
-00097cb0: 7365 7445 6e61 626c 6564 2846 616c 7365  setEnabled(False
-00097cc0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00097cd0: 656c 662e 7061 6765 312e 6275 7474 6f6e  elf.page1.button
-00097ce0: 5f73 6c69 6465 7368 6f77 2e73 6574 456e  _slideshow.setEn
-00097cf0: 6162 6c65 6428 4661 6c73 6529 0d0a 2020  abled(False)..  
-00097d00: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00097d10: 6167 6531 2e62 7574 746f 6e5f 6164 6452  age1.button_addR
-00097d20: 4f49 2e73 6574 456e 6162 6c65 6428 4661  OI.setEnabled(Fa
-00097d30: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
-00097d40: 2020 7365 6c66 2e70 6167 6531 2e62 7574    self.page1.but
-00097d50: 746f 6e5f 7370 6563 7472 616c 524f 492e  ton_spectralROI.
-00097d60: 7365 7445 6e61 626c 6564 2846 616c 7365  setEnabled(False
-00097d70: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00097d80: 656c 662e 7061 6765 312e 6275 7474 6f6e  elf.page1.button
-00097d90: 5f72 6573 6574 6469 7370 6c61 792e 7365  _resetdisplay.se
-00097da0: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
-00097db0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00097dc0: 662e 7061 6765 312e 6275 7474 6f6e 5f64  f.page1.button_d
-00097dd0: 6573 7069 6b65 2e73 6574 456e 6162 6c65  espike.setEnable
-00097de0: 6428 4661 6c73 6529 0d0a 2020 2020 2020  d(False)..      
-00097df0: 2020 2020 2020 7365 6c66 2e70 6167 6531        self.page1
-00097e00: 2e62 7574 746f 6e5f 6469 7370 6c61 7963  .button_displayc
-00097e10: 6f6c 6f72 2e73 6574 456e 6162 6c65 6428  olor.setEnabled(
-00097e20: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-00097e30: 2020 2020 7365 6c66 2e61 6374 696f 6e53      self.actionS
-00097e40: 6176 652e 7365 7445 6e61 626c 6564 2846  ave.setEnabled(F
-00097e50: 616c 7365 290d 0a0d 0a20 2020 2020 2020  alse)....       
-00097e60: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00097e70: 2020 2020 7365 6c66 2e70 6167 6531 2e62      self.page1.b
-00097e80: 7574 746f 6e5f 6930 6666 696c 652e 7365  utton_i0ffile.se
-00097e90: 7445 6e61 626c 6564 2854 7275 6529 0d0a  tEnabled(True)..
+000933a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000933b0: 2d2d 2d2d 2d2d 2d22 2222 0d0a 636c 6173  -------"""..clas
+000933c0: 7320 4d61 696e 4672 616d 6528 5174 5769  s MainFrame(QtWi
+000933d0: 6467 6574 732e 514d 6169 6e57 696e 646f  dgets.QMainWindo
+000933e0: 7729 3a0d 0a0d 0a20 2020 2064 6566 205f  w):....    def _
+000933f0: 5f69 6e69 745f 5f28 7365 6c66 293a 0d0a  _init__(self):..
+00093400: 2020 2020 2020 2020 7375 7065 7228 4d61          super(Ma
+00093410: 696e 4672 616d 652c 2073 656c 6629 2e5f  inFrame, self)._
+00093420: 5f69 6e69 745f 5f28 290d 0a0d 0a20 2020  _init__()....   
+00093430: 2020 2020 2073 656c 662e 696e 6974 5549       self.initUI
+00093440: 2829 0d0a 0d0a 0d0a 0d0a 232d 2d2d 2d2d  ()........#-----
+00093450: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00093460: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00093470: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00093480: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00093490: 2d0d 0a20 2020 2064 6566 2069 6e69 7455  -..    def initU
+000934a0: 4928 7365 6c66 293a 0d0a 0d0a 2020 2020  I(self):....    
+000934b0: 2020 2020 7365 6c66 2e64 6174 615f 7374      self.data_st
+000934c0: 7275 6374 203d 2064 6174 615f 7374 7275  ruct = data_stru
+000934d0: 6374 2e68 3528 290d 0a20 2020 2020 2020  ct.h5()..       
+000934e0: 2073 656c 662e 7374 6b20 3d20 6461 7461   self.stk = data
+000934f0: 5f73 7461 636b 2e64 6174 6128 7365 6c66  _stack.data(self
+00093500: 2e64 6174 615f 7374 7275 6374 290d 0a20  .data_struct).. 
+00093510: 2020 2020 2020 2073 656c 662e 616e 6c7a         self.anlz
+00093520: 203d 2061 6e61 6c79 7a65 2e61 6e61 6c79   = analyze.analy
+00093530: 7a65 2873 656c 662e 7374 6b29 0d0a 2020  ze(self.stk)..  
+00093540: 2020 2020 2020 7365 6c66 2e6e 6e6d 6120        self.nnma 
+00093550: 3d20 6e6e 6d61 2e6e 6e6d 6128 7365 6c66  = nnma.nnma(self
+00093560: 2e73 746b 290d 0a20 2020 2020 2020 2073  .stk)..        s
+00093570: 656c 662e 636f 6d6d 6f6e 203d 2063 6f6d  elf.common = com
+00093580: 6d6f 6e28 290d 0a0d 0a0d 0a20 2020 2020  mon()......     
+00093590: 2020 2073 656c 662e 7265 7369 7a65 2857     self.resize(W
+000935a0: 696e 7369 7a65 782c 2057 696e 7369 7a65  insizex, Winsize
+000935b0: 7929 0d0a 2020 2020 2020 2020 7365 6c66  y)..        self
+000935c0: 2e73 6574 5769 6e64 6f77 5469 746c 6528  .setWindowTitle(
+000935d0: 274d 616e 7469 7320 762e 7b30 7d27 2e66  'Mantis v.{0}'.f
+000935e0: 6f72 6d61 7428 7665 7273 696f 6e29 290d  ormat(version)).
+000935f0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00093600: 696e 6974 546f 6f6c 6261 7228 290d 0a0d  initToolbar()...
+00093610: 0a0d 0a20 2020 2020 2020 2069 636f 203d  ...        ico =
+00093620: 2051 7447 7569 2e51 4963 6f6e 2872 6573   QtGui.QIcon(res
+00093630: 6f75 7263 655f 7061 7468 286f 732e 7061  ource_path(os.pa
+00093640: 7468 2e6a 6f69 6e28 2769 6d61 6765 7327  th.join('images'
+00093650: 2c27 6c6f 676f 2d32 6c2d 3332 2e69 636f  ,'logo-2l-32.ico
+00093660: 2729 2929 0d0a 2020 2020 2020 2020 7365  ')))..        se
+00093670: 6c66 2e73 6574 5769 6e64 6f77 4963 6f6e  lf.setWindowIcon
+00093680: 2869 636f 290d 0a0d 0a20 2020 2020 2020  (ico)....       
+00093690: 2074 6162 7320 3d20 5174 5769 6467 6574   tabs = QtWidget
+000936a0: 732e 5154 6162 5769 6467 6574 2829 0d0a  s.QTabWidget()..
+000936b0: 0d0a 0d0a 2020 2020 2020 2020 2320 6372  ....        # cr
+000936c0: 6561 7465 2074 6865 2070 6167 6520 7769  eate the page wi
+000936d0: 6e64 6f77 7320 6173 2074 6162 730d 0a20  ndows as tabs.. 
+000936e0: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
+000936f0: 3020 3d20 5061 6765 4c6f 6164 4461 7461  0 = PageLoadData
+00093700: 2873 656c 662e 636f 6d6d 6f6e 2c20 7365  (self.common, se
+00093710: 6c66 2e64 6174 615f 7374 7275 6374 2c20  lf.data_struct, 
+00093720: 7365 6c66 2e73 746b 290d 0a20 2020 2020  self.stk)..     
+00093730: 2020 2073 656c 662e 7061 6765 3120 3d20     self.page1 = 
+00093740: 5061 6765 5374 6163 6b28 7365 6c66 2e63  PageStack(self.c
+00093750: 6f6d 6d6f 6e2c 2073 656c 662e 6461 7461  ommon, self.data
+00093760: 5f73 7472 7563 742c 2073 656c 662e 7374  _struct, self.st
+00093770: 6b29 0d0a 2020 2020 2020 2020 7365 6c66  k)..        self
+00093780: 2e70 6167 6532 203d 2050 6167 6550 4341  .page2 = PagePCA
+00093790: 2873 656c 662e 636f 6d6d 6f6e 2c20 7365  (self.common, se
+000937a0: 6c66 2e64 6174 615f 7374 7275 6374 2c20  lf.data_struct, 
+000937b0: 7365 6c66 2e73 746b 2c20 7365 6c66 2e61  self.stk, self.a
+000937c0: 6e6c 7a29 0d0a 2020 2020 2020 2020 7365  nlz)..        se
+000937d0: 6c66 2e70 6167 6533 203d 2050 6167 6543  lf.page3 = PageC
+000937e0: 6c75 7374 6572 2873 656c 662e 636f 6d6d  luster(self.comm
+000937f0: 6f6e 2c20 7365 6c66 2e64 6174 615f 7374  on, self.data_st
+00093800: 7275 6374 2c20 7365 6c66 2e73 746b 2c20  ruct, self.stk, 
+00093810: 7365 6c66 2e61 6e6c 7a29 0d0a 2020 2020  self.anlz)..    
+00093820: 2020 2020 7365 6c66 2e70 6167 6534 203d      self.page4 =
+00093830: 2050 6167 6553 7065 6374 7261 6c28 7365   PageSpectral(se
+00093840: 6c66 2e63 6f6d 6d6f 6e2c 2073 656c 662e  lf.common, self.
+00093850: 6461 7461 5f73 7472 7563 742c 2073 656c  data_struct, sel
+00093860: 662e 7374 6b2c 2073 656c 662e 616e 6c7a  f.stk, self.anlz
+00093870: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00093880: 7061 6765 3520 3d20 5061 6765 5065 616b  page5 = PagePeak
+00093890: 4944 2873 656c 662e 636f 6d6d 6f6e 2c20  ID(self.common, 
+000938a0: 7365 6c66 2e64 6174 615f 7374 7275 6374  self.data_struct
+000938b0: 2c20 7365 6c66 2e73 746b 2c20 7365 6c66  , self.stk, self
+000938c0: 2e61 6e6c 7a29 0d0a 2020 2020 2020 2020  .anlz)..        
+000938d0: 7365 6c66 2e70 6167 6536 203d 2050 6167  self.page6 = Pag
+000938e0: 6558 7261 7950 6561 6b46 6974 7469 6e67  eXrayPeakFitting
+000938f0: 2873 656c 662e 636f 6d6d 6f6e 2c20 7365  (self.common, se
+00093900: 6c66 2e64 6174 615f 7374 7275 6374 2c20  lf.data_struct, 
+00093910: 7365 6c66 2e73 746b 2c20 7365 6c66 2e61  self.stk, self.a
+00093920: 6e6c 7a29 0d0a 2020 2020 2020 2020 7365  nlz)..        se
+00093930: 6c66 2e70 6167 6537 203d 2050 6167 654e  lf.page7 = PageN
+00093940: 4e4d 4128 7365 6c66 2e63 6f6d 6d6f 6e2c  NMA(self.common,
+00093950: 2073 656c 662e 6461 7461 5f73 7472 7563   self.data_struc
+00093960: 742c 2073 656c 662e 7374 6b2c 2073 656c  t, self.stk, sel
+00093970: 662e 616e 6c7a 2c20 7365 6c66 2e6e 6e6d  f.anlz, self.nnm
+00093980: 6129 0d0a 0d0a 0d0a 2020 2020 2020 2020  a)......        
+00093990: 7461 6273 2e61 6464 5461 6228 7365 6c66  tabs.addTab(self
+000939a0: 2e70 6167 6530 2c22 4c6f 6164 2044 6174  .page0,"Load Dat
+000939b0: 6122 290d 0a20 2020 2020 2020 2074 6162  a")..        tab
+000939c0: 732e 6164 6454 6162 2873 656c 662e 7061  s.addTab(self.pa
+000939d0: 6765 312c 2022 5072 6570 726f 6365 7373  ge1, "Preprocess
+000939e0: 2044 6174 6122 290d 0a20 2020 2020 2020   Data")..       
+000939f0: 2074 6162 732e 6164 6454 6162 2873 656c   tabs.addTab(sel
+00093a00: 662e 7061 6765 322c 2250 4341 2229 0d0a  f.page2,"PCA")..
+00093a10: 2020 2020 2020 2020 7461 6273 2e61 6464          tabs.add
+00093a20: 5461 6228 7365 6c66 2e70 6167 6533 2c22  Tab(self.page3,"
+00093a30: 436c 7573 7465 7220 416e 616c 7973 6973  Cluster Analysis
+00093a40: 2229 0d0a 2020 2020 2020 2020 7461 6273  ")..        tabs
+00093a50: 2e61 6464 5461 6228 7365 6c66 2e70 6167  .addTab(self.pag
+00093a60: 6534 2c22 5370 6563 7472 616c 204d 6170  e4,"Spectral Map
+00093a70: 7322 290d 0a20 2020 2020 2020 2074 6162  s")..        tab
+00093a80: 732e 6164 6454 6162 2873 656c 662e 7061  s.addTab(self.pa
+00093a90: 6765 372c 2022 4e4e 4d41 2041 6e61 6c79  ge7, "NNMA Analy
+00093aa0: 7369 7322 290d 0a20 2020 2020 2020 2074  sis")..        t
+00093ab0: 6162 732e 6164 6454 6162 2873 656c 662e  abs.addTab(self.
+00093ac0: 7061 6765 352c 2250 6561 6b20 4944 2229  page5,"Peak ID")
+00093ad0: 0d0a 2020 2020 2020 2020 7461 6273 2e61  ..        tabs.a
+00093ae0: 6464 5461 6228 7365 6c66 2e70 6167 6536  ddTab(self.page6
+00093af0: 2c20 2258 7261 7950 6561 6b46 6974 7469  , "XrayPeakFitti
+00093b00: 6e67 2229 0d0a 0d0a 2020 2020 2020 2020  ng")....        
+00093b10: 6966 2073 686f 7774 6f6d 6f74 6162 3a0d  if showtomotab:.
+00093b20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00093b30: 662e 7061 6765 3820 3d20 5061 6765 546f  f.page8 = PageTo
+00093b40: 6d6f 2873 656c 662e 636f 6d6d 6f6e 2c20  mo(self.common, 
+00093b50: 7365 6c66 2e64 6174 615f 7374 7275 6374  self.data_struct
+00093b60: 2c20 7365 6c66 2e73 746b 2c20 7365 6c66  , self.stk, self
+00093b70: 2e61 6e6c 7a29 0d0a 2020 2020 2020 2020  .anlz)..        
+00093b80: 2020 2020 7461 6273 2e61 6464 5461 6228      tabs.addTab(
+00093b90: 7365 6c66 2e70 6167 6538 2c20 2254 6f6d  self.page8, "Tom
+00093ba0: 6f67 7261 7068 7922 290d 0a0d 0a20 2020  ography")....   
+00093bb0: 2020 2020 2069 6620 7368 6f77 6d61 7074       if showmapt
+00093bc0: 6162 3a0d 0a20 2020 2020 2020 2020 2020  ab:..           
+00093bd0: 2073 656c 662e 7061 6765 3920 3d20 5061   self.page9 = Pa
+00093be0: 6765 4d61 7028 7365 6c66 2e63 6f6d 6d6f  geMap(self.commo
+00093bf0: 6e2c 2073 656c 662e 6461 7461 5f73 7472  n, self.data_str
+00093c00: 7563 742c 2073 656c 662e 7374 6b29 0d0a  uct, self.stk)..
+00093c10: 2020 2020 2020 2020 2020 2020 7461 6273              tabs
+00093c20: 2e61 6464 5461 6228 7365 6c66 2e70 6167  .addTab(self.pag
+00093c30: 6539 2c20 2249 6d61 6765 204d 6170 7322  e9, "Image Maps"
+00093c40: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
+00093c50: 7379 732e 706c 6174 666f 726d 203d 3d20  sys.platform == 
+00093c60: 2777 696e 3332 273a 0d0a 2020 2020 2020  'win32':..      
+00093c70: 2020 2020 2020 7461 6273 2e73 6574 4d69        tabs.setMi
+00093c80: 6e69 6d75 6d48 6569 6768 7428 3735 3029  nimumHeight(750)
+00093c90: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00093ca0: 0a20 2020 2020 2020 2020 2020 2074 6162  .            tab
+00093cb0: 732e 7365 744d 696e 696d 756d 4865 6967  s.setMinimumHeig
+00093cc0: 6874 2834 3030 290d 0a0d 0a20 2020 2020  ht(400)....     
+00093cd0: 2020 2074 6162 732e 7461 6242 6172 2829     tabs.tabBar()
+00093ce0: 2e73 6574 5461 6254 6578 7443 6f6c 6f72  .setTabTextColor
+00093cf0: 2830 2c20 5174 4775 692e 5143 6f6c 6f72  (0, QtGui.QColor
+00093d00: 2827 6772 6565 6e27 2929 0d0a 2020 2020  ('green'))..    
+00093d10: 2020 2020 7461 6273 2e74 6162 4261 7228      tabs.tabBar(
+00093d20: 292e 7365 7454 6162 5465 7874 436f 6c6f  ).setTabTextColo
+00093d30: 7228 312c 2051 7447 7569 2e51 436f 6c6f  r(1, QtGui.QColo
+00093d40: 7228 2767 7265 656e 2729 290d 0a20 2020  r('green'))..   
+00093d50: 2020 2020 2074 6162 732e 7461 6242 6172       tabs.tabBar
+00093d60: 2829 2e73 6574 5461 6254 6578 7443 6f6c  ().setTabTextCol
+00093d70: 6f72 2832 2c20 5174 4775 692e 5143 6f6c  or(2, QtGui.QCol
+00093d80: 6f72 2827 6461 726b 5265 6427 2929 0d0a  or('darkRed'))..
+00093d90: 2020 2020 2020 2020 7461 6273 2e74 6162          tabs.tab
+00093da0: 4261 7228 292e 7365 7454 6162 5465 7874  Bar().setTabText
+00093db0: 436f 6c6f 7228 332c 2051 7447 7569 2e51  Color(3, QtGui.Q
+00093dc0: 436f 6c6f 7228 2764 6172 6b52 6564 2729  Color('darkRed')
+00093dd0: 290d 0a20 2020 2020 2020 2074 6162 732e  )..        tabs.
+00093de0: 7461 6242 6172 2829 2e73 6574 5461 6254  tabBar().setTabT
+00093df0: 6578 7443 6f6c 6f72 2834 2c20 5174 4775  extColor(4, QtGu
+00093e00: 692e 5143 6f6c 6f72 2827 6461 726b 5265  i.QColor('darkRe
+00093e10: 6427 2929 0d0a 2020 2020 2020 2020 7461  d'))..        ta
+00093e20: 6273 2e74 6162 4261 7228 292e 7365 7454  bs.tabBar().setT
+00093e30: 6162 5465 7874 436f 6c6f 7228 352c 2051  abTextColor(5, Q
+00093e40: 7447 7569 2e51 436f 6c6f 7228 2764 6172  tGui.QColor('dar
+00093e50: 6b52 6564 2729 290d 0a20 2020 2020 2020  kRed'))..       
+00093e60: 2074 6162 732e 7461 6242 6172 2829 2e73   tabs.tabBar().s
+00093e70: 6574 5461 6254 6578 7443 6f6c 6f72 2836  etTabTextColor(6
+00093e80: 2c20 5174 4775 692e 5143 6f6c 6f72 2827  , QtGui.QColor('
+00093e90: 7075 7270 6c65 2729 290d 0a20 2020 2020  purple'))..     
+00093ea0: 2020 2074 6162 732e 7461 6242 6172 2829     tabs.tabBar()
+00093eb0: 2e73 6574 5461 6254 6578 7443 6f6c 6f72  .setTabTextColor
+00093ec0: 2837 2c20 5174 4775 692e 5143 6f6c 6f72  (7, QtGui.QColor
+00093ed0: 2827 7075 7270 6c65 2729 290d 0a20 2020  ('purple'))..   
+00093ee0: 2020 2020 2069 6620 7368 6f77 746f 6d6f       if showtomo
+00093ef0: 7461 623a 0d0a 2020 2020 2020 2020 2020  tab:..          
+00093f00: 2020 7461 6273 2e74 6162 4261 7228 292e    tabs.tabBar().
+00093f10: 7365 7454 6162 5465 7874 436f 6c6f 7228  setTabTextColor(
+00093f20: 382c 2051 7447 7569 2e51 436f 6c6f 7228  8, QtGui.QColor(
+00093f30: 2764 6172 6b62 6c75 6527 2929 0d0a 2020  'darkblue'))..  
+00093f40: 2020 2020 2020 6966 2073 686f 776d 6170        if showmap
+00093f50: 7461 623a 0d0a 2020 2020 2020 2020 2020  tab:..          
+00093f60: 2020 7461 6273 2e74 6162 4261 7228 292e    tabs.tabBar().
+00093f70: 7365 7454 6162 5465 7874 436f 6c6f 7228  setTabTextColor(
+00093f80: 392c 2051 7447 7569 2e51 436f 6c6f 7228  9, QtGui.QColor(
+00093f90: 2764 6172 6b62 6c75 6527 2929 0d0a 0d0a  'darkblue'))....
+00093fa0: 0d0a 0d0a 2020 2020 2020 2020 2320 4f6e  ....        # On
+00093fb0: 6c79 2061 6464 2022 6578 7065 7274 2220  ly add "expert" 
+00093fc0: 7061 6765 7320 6966 206f 7074 696f 6e20  pages if option 
+00093fd0: 222d 2d6b 6579 2220 6973 2067 6976 656e  "--key" is given
+00093fe0: 2069 6e20 636f 6d6d 616e 6420 6c69 6e65   in command line
+00093ff0: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
+00094000: 2020 2020 2020 2020 2020 2020 6f70 7469              opti
+00094010: 6f6e 732c 2065 7874 7261 5061 7261 6d73  ons, extraParams
+00094020: 203d 2067 6574 6f70 742e 6765 746f 7074   = getopt.getopt
+00094030: 2873 7973 2e61 7267 765b 313a 5d2c 2027  (sys.argv[1:], '
+00094040: 272c 205b 2777 7827 2c20 2762 6174 6368  ', ['wx', 'batch
+00094050: 272c 2027 6e6e 6d61 272c 2027 6963 6127  ', 'nnma', 'ica'
+00094060: 2c20 276b 6579 656e 6727 5d29 0d0a 2020  , 'keyeng'])..  
+00094070: 2020 2020 2020 6578 6365 7074 3a0d 0a20        except:.. 
+00094080: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00094090: 2827 4572 726f 7220 2d20 7772 6f6e 6720  ('Error - wrong 
+000940a0: 636f 6d6d 616e 6420 6c69 6e65 206f 7074  command line opt
+000940b0: 696f 6e20 7573 6564 2e20 4176 6169 6c61  ion used. Availa
+000940c0: 626c 6520 6f70 7469 6f6e 7320 6172 6520  ble options are 
+000940d0: 2d2d 7778 2c20 2d2d 6261 7463 6820 616e  --wx, --batch an
+000940e0: 6420 2d2d 6e6e 6d61 2729 0d0a 2020 2020  d --nnma')..    
+000940f0: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
+00094100: 0d0a 2320 2020 2020 2020 2020 666f 7220  ..#         for 
+00094110: 6f70 742c 2061 7267 2069 6e20 6f70 7469  opt, arg in opti
+00094120: 6f6e 733a 0d0a 2320 2020 2020 2020 2020  ons:..#         
+00094130: 2020 2020 6966 206f 7074 2069 6e20 272d      if opt in '-
+00094140: 2d6e 6e6d 6127 3a0d 0a23 2020 2020 2020  -nnma':..#      
+00094150: 2020 2020 2020 2020 2020 2069 6620 7665             if ve
+00094160: 7262 6f73 653a 2070 7269 6e74 2022 5275  rbose: print "Ru
+00094170: 6e6e 696e 6720 7769 7468 204e 4e4d 412e  nning with NNMA.
+00094180: 220d 0a23 2020 2020 2020 2020 2020 2020  "..#            
+00094190: 2020 2020 2073 656c 662e 7061 6765 3720       self.page7 
+000941a0: 3d20 5061 6765 4e4e 4d41 2873 656c 662e  = PageNNMA(self.
+000941b0: 636f 6d6d 6f6e 2c20 7365 6c66 2e64 6174  common, self.dat
+000941c0: 615f 7374 7275 6374 2c20 7365 6c66 2e73  a_struct, self.s
+000941d0: 746b 2c20 7365 6c66 2e61 6e6c 7a2c 2073  tk, self.anlz, s
+000941e0: 656c 662e 6e6e 6d61 290d 0a23 2020 2020  elf.nnma)..#    
+000941f0: 2020 2020 2020 2020 2020 2020 2074 6162               tab
+00094200: 732e 6164 6454 6162 2873 656c 662e 7061  s.addTab(self.pa
+00094210: 6765 372c 2022 4e4e 4d41 2041 6e61 6c79  ge7, "NNMA Analy
+00094220: 7369 7322 290d 0a0d 0a0d 0a20 2020 2020  sis")......     
+00094230: 2020 206c 6179 6f75 7420 3d20 5174 5769     layout = QtWi
+00094240: 6467 6574 732e 5156 426f 784c 6179 6f75  dgets.QVBoxLayou
+00094250: 7428 290d 0a0d 0a20 2020 2020 2020 206c  t()....        l
+00094260: 6179 6f75 742e 6164 6457 6964 6765 7428  ayout.addWidget(
+00094270: 7461 6273 290d 0a20 2020 2020 2020 2023  tabs)..        #
+00094280: 7365 6c66 2e73 6574 4365 6e74 7261 6c57  self.setCentralW
+00094290: 6964 6765 7428 7461 6273 290d 0a0d 0a20  idget(tabs).... 
+000942a0: 2020 2020 2020 2073 656c 662e 7363 726f         self.scro
+000942b0: 6c6c 4172 6561 203d 2051 7457 6964 6765  llArea = QtWidge
+000942c0: 7473 2e51 5363 726f 6c6c 4172 6561 2829  ts.QScrollArea()
+000942d0: 0d0a 2020 2020 2020 2020 2373 656c 662e  ..        #self.
+000942e0: 7363 726f 6c6c 4172 6561 2e73 6574 4261  scrollArea.setBa
+000942f0: 636b 6772 6f75 6e64 526f 6c65 2851 7447  ckgroundRole(QtG
+00094300: 7569 2e51 5061 6c65 7474 652e 4461 726b  ui.QPalette.Dark
+00094310: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00094320: 7363 726f 6c6c 4172 6561 2e73 6574 5769  scrollArea.setWi
+00094330: 6467 6574 2874 6162 7329 0d0a 2020 2020  dget(tabs)..    
+00094340: 2020 2020 2373 656c 662e 7363 726f 6c6c      #self.scroll
+00094350: 4172 6561 2e73 6574 5665 7274 6963 616c  Area.setVertical
+00094360: 5363 726f 6c6c 4261 7250 6f6c 6963 7928  ScrollBarPolicy(
+00094370: 5174 2e53 6372 6f6c 6c42 6172 416c 7761  Qt.ScrollBarAlwa
+00094380: 7973 4f6e 290d 0a20 2020 2020 2020 2023  ysOn)..        #
+00094390: 7365 6c66 2e73 6372 6f6c 6c41 7265 612e  self.scrollArea.
+000943a0: 7365 7448 6f72 697a 6f6e 7461 6c53 6372  setHorizontalScr
+000943b0: 6f6c 6c42 6172 506f 6c69 6379 2851 742e  ollBarPolicy(Qt.
+000943c0: 5363 726f 6c6c 4261 7241 6c77 6179 734f  ScrollBarAlwaysO
+000943d0: 6666 290d 0a20 2020 2020 2020 2073 656c  ff)..        sel
+000943e0: 662e 7363 726f 6c6c 4172 6561 2e73 6574  f.scrollArea.set
+000943f0: 5769 6467 6574 5265 7369 7a61 626c 6528  WidgetResizable(
+00094400: 5472 7565 290d 0a20 2020 2020 2020 2073  True)..        s
+00094410: 656c 662e 7365 7443 656e 7472 616c 5769  elf.setCentralWi
+00094420: 6467 6574 2873 656c 662e 7363 726f 6c6c  dget(self.scroll
+00094430: 4172 6561 290d 0a0d 0a0d 0a20 2020 2020  Area)......     
+00094440: 2020 2073 6372 6565 6e20 3d20 5174 5769     screen = QtWi
+00094450: 6467 6574 732e 5144 6573 6b74 6f70 5769  dgets.QDesktopWi
+00094460: 6467 6574 2829 2e73 6372 6565 6e47 656f  dget().screenGeo
+00094470: 6d65 7472 7928 290d 0a0d 0a0d 0a20 2020  metry()......   
+00094480: 2020 2020 2069 6620 7363 7265 656e 2e68       if screen.h
+00094490: 6569 6768 7428 2920 3c20 5769 6e73 697a  eight() < Winsiz
+000944a0: 6579 202d 2035 303a 0d0a 2020 2020 2020  ey - 50:..      
+000944b0: 2020 2020 2020 7365 6c66 2e73 686f 774d        self.showM
+000944c0: 6178 696d 697a 6564 2829 0d0a 0d0a 0d0a  aximized()......
+000944d0: 2020 2020 2020 2020 7365 6c66 2e73 686f          self.sho
+000944e0: 7728 290d 0a20 2020 2020 2020 2069 6620  w()..        if 
+000944f0: 7379 732e 706c 6174 666f 726d 203d 3d20  sys.platform == 
+00094500: 2264 6172 7769 6e22 3a0d 0a20 2020 2020  "darwin":..     
+00094510: 2020 2020 2020 2073 656c 662e 7261 6973         self.rais
+00094520: 655f 2829 0d0a 0d0a 0d0a 232d 2d2d 2d2d  e_()......#-----
+00094530: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00094540: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00094550: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00094560: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00094570: 2d0d 0a20 2020 2064 6566 2069 6e69 7454  -..    def initT
+00094580: 6f6f 6c62 6172 2873 656c 6629 3a0d 0a0d  oolbar(self):...
+00094590: 0a20 2020 2020 2020 2073 656c 662e 6163  .        self.ac
+000945a0: 7469 6f6e 4f70 656e 203d 2051 7457 6964  tionOpen = QtWid
+000945b0: 6765 7473 2e51 4163 7469 6f6e 2873 656c  gets.QAction(sel
+000945c0: 6629 0d0a 2020 2020 2020 2020 7365 6c66  f)..        self
+000945d0: 2e61 6374 696f 6e4f 7065 6e2e 7365 744f  .actionOpen.setO
+000945e0: 626a 6563 744e 616d 6528 2761 6374 696f  bjectName('actio
+000945f0: 6e4f 7065 6e27 290d 0a20 2020 2020 2020  nOpen')..       
+00094600: 2073 656c 662e 6163 7469 6f6e 4f70 656e   self.actionOpen
+00094610: 2e73 6574 4963 6f6e 2851 7447 7569 2e51  .setIcon(QtGui.Q
+00094620: 4963 6f6e 2872 6573 6f75 7263 655f 7061  Icon(resource_pa
+00094630: 7468 286f 732e 7061 7468 2e6a 6f69 6e28  th(os.path.join(
+00094640: 2769 6d61 6765 7327 2c27 646f 6375 6d65  'images','docume
+00094650: 6e74 2d6f 7065 6e2e 706e 6727 2929 2929  nt-open.png'))))
+00094660: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
+00094670: 6f6f 6c62 6172 203d 2073 656c 662e 6164  oolbar = self.ad
+00094680: 6454 6f6f 6c42 6172 2827 6163 7469 6f6e  dToolBar('action
+00094690: 4f70 656e 2729 0d0a 2020 2020 2020 2020  Open')..        
+000946a0: 7365 6c66 2e74 6f6f 6c62 6172 2e61 6464  self.toolbar.add
+000946b0: 4163 7469 6f6e 2873 656c 662e 6163 7469  Action(self.acti
+000946c0: 6f6e 4f70 656e 290d 0a20 2020 2020 2020  onOpen)..       
+000946d0: 2073 656c 662e 6163 7469 6f6e 4f70 656e   self.actionOpen
+000946e0: 2e74 7269 6767 6572 6564 2e63 6f6e 6e65  .triggered.conne
+000946f0: 6374 2873 656c 662e 4c6f 6164 5374 6163  ct(self.LoadStac
+00094700: 6b29 0d0a 0d0a 2020 2020 2020 2020 7365  k)....        se
+00094710: 6c66 2e61 6374 696f 6e4f 7065 6e53 4c20  lf.actionOpenSL 
+00094720: 3d20 5174 5769 6467 6574 732e 5141 6374  = QtWidgets.QAct
+00094730: 696f 6e28 7365 6c66 290d 0a20 2020 2020  ion(self)..     
+00094740: 2020 2073 656c 662e 6163 7469 6f6e 4f70     self.actionOp
+00094750: 656e 534c 2e73 6574 4f62 6a65 6374 4e61  enSL.setObjectNa
+00094760: 6d65 2827 6163 7469 6f6e 4f70 656e 534c  me('actionOpenSL
+00094770: 2729 0d0a 2020 2020 2020 2020 7365 6c66  ')..        self
+00094780: 2e61 6374 696f 6e4f 7065 6e53 4c2e 7365  .actionOpenSL.se
+00094790: 7449 636f 6e28 5174 4775 692e 5149 636f  tIcon(QtGui.QIco
+000947a0: 6e28 7265 736f 7572 6365 5f70 6174 6828  n(resource_path(
+000947b0: 6f73 2e70 6174 682e 6a6f 696e 2827 696d  os.path.join('im
+000947c0: 6167 6573 272c 276f 7065 6e2d 736c 2e70  ages','open-sl.p
+000947d0: 6e67 2729 2929 290d 0a20 2020 2020 2020  ng'))))..       
+000947e0: 2073 656c 662e 746f 6f6c 6261 722e 6164   self.toolbar.ad
+000947f0: 6441 6374 696f 6e28 7365 6c66 2e61 6374  dAction(self.act
+00094800: 696f 6e4f 7065 6e53 4c29 0d0a 2020 2020  ionOpenSL)..    
+00094810: 2020 2020 7365 6c66 2e61 6374 696f 6e4f      self.actionO
+00094820: 7065 6e53 4c2e 7472 6967 6765 7265 642e  penSL.triggered.
+00094830: 636f 6e6e 6563 7428 7365 6c66 2e42 7569  connect(self.Bui
+00094840: 6c64 5374 6163 6b29 0d0a 0d0a 2020 2020  ldStack)....    
+00094850: 2020 2020 7365 6c66 2e61 6374 696f 6e53      self.actionS
+00094860: 6176 6520 3d20 5174 5769 6467 6574 732e  ave = QtWidgets.
+00094870: 5141 6374 696f 6e28 7365 6c66 290d 0a20  QAction(self).. 
+00094880: 2020 2020 2020 2073 656c 662e 6163 7469         self.acti
+00094890: 6f6e 5361 7665 2e73 6574 4f62 6a65 6374  onSave.setObject
+000948a0: 4e61 6d65 2827 6163 7469 6f6e 5361 7665  Name('actionSave
+000948b0: 2729 0d0a 2020 2020 2020 2020 7365 6c66  ')..        self
+000948c0: 2e61 6374 696f 6e53 6176 652e 7365 7449  .actionSave.setI
+000948d0: 636f 6e28 5174 4775 692e 5149 636f 6e28  con(QtGui.QIcon(
+000948e0: 7265 736f 7572 6365 5f70 6174 6828 6f73  resource_path(os
+000948f0: 2e70 6174 682e 6a6f 696e 2827 696d 6167  .path.join('imag
+00094900: 6573 272c 276d 6564 6961 2d66 6c6f 7070  es','media-flopp
+00094910: 792e 706e 6727 2929 2929 0d0a 2020 2020  y.png'))))..    
+00094920: 2020 2020 7365 6c66 2e74 6f6f 6c62 6172      self.toolbar
+00094930: 2e61 6464 4163 7469 6f6e 2873 656c 662e  .addAction(self.
+00094940: 6163 7469 6f6e 5361 7665 290d 0a20 2020  actionSave)..   
+00094950: 2020 2020 2073 656c 662e 6163 7469 6f6e       self.action
+00094960: 5361 7665 2e74 7269 6767 6572 6564 2e63  Save.triggered.c
+00094970: 6f6e 6e65 6374 2873 656c 662e 6f6e 5361  onnect(self.onSa
+00094980: 7665 5265 7375 6c74 7354 6f48 3529 0d0a  veResultsToH5)..
+00094990: 2020 2020 2020 2020 7365 6c66 2e61 6374          self.act
+000949a0: 696f 6e53 6176 652e 7365 7445 6e61 626c  ionSave.setEnabl
+000949b0: 6564 2846 616c 7365 290d 0a0d 0a20 2020  ed(False)....   
+000949c0: 2020 2020 2073 656c 662e 6163 7469 6f6e       self.action
+000949d0: 496e 666f 203d 2051 7457 6964 6765 7473  Info = QtWidgets
+000949e0: 2e51 4163 7469 6f6e 2873 656c 6629 0d0a  .QAction(self)..
+000949f0: 2020 2020 2020 2020 7365 6c66 2e61 6374          self.act
+00094a00: 696f 6e49 6e66 6f2e 7365 744f 626a 6563  ionInfo.setObjec
+00094a10: 744e 616d 6528 2761 6374 696f 6e49 6e66  tName('actionInf
+00094a20: 6f27 290d 0a20 2020 2020 2020 2073 656c  o')..        sel
+00094a30: 662e 6163 7469 6f6e 496e 666f 2e73 6574  f.actionInfo.set
+00094a40: 4963 6f6e 2851 7447 7569 2e51 4963 6f6e  Icon(QtGui.QIcon
+00094a50: 2872 6573 6f75 7263 655f 7061 7468 286f  (resource_path(o
+00094a60: 732e 7061 7468 2e6a 6f69 6e28 2769 6d61  s.path.join('ima
+00094a70: 6765 7327 2c27 6865 6c70 2d62 726f 7773  ges','help-brows
+00094a80: 6572 2e70 6e67 2729 2929 290d 0a20 2020  er.png'))))..   
+00094a90: 2020 2020 2073 656c 662e 746f 6f6c 6261       self.toolba
+00094aa0: 722e 6164 6441 6374 696f 6e28 7365 6c66  r.addAction(self
+00094ab0: 2e61 6374 696f 6e49 6e66 6f29 0d0a 2020  .actionInfo)..  
+00094ac0: 2020 2020 2020 7365 6c66 2e61 6374 696f        self.actio
+00094ad0: 6e49 6e66 6f2e 7472 6967 6765 7265 642e  nInfo.triggered.
+00094ae0: 636f 6e6e 6563 7428 7365 6c66 2e6f 6e41  connect(self.onA
+00094af0: 626f 7574 290d 0a0d 0a23 2d2d 2d2d 2d2d  bout)....#------
+00094b00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00094b10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00094b20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00094b30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00094b40: 0d0a 2020 2020 6465 6620 4c6f 6164 5374  ..    def LoadSt
+00094b50: 6163 6b28 7365 6c66 293a 0d0a 2020 2020  ack(self):..    
+00094b60: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00094b70: 2042 726f 7773 6520 666f 7220 6120 7374   Browse for a st
+00094b80: 6163 6b20 6669 6c65 3a0d 0a20 2020 2020  ack file:..     
+00094b90: 2020 2022 2222 0d0a 0d0a 2020 2020 2020     """....      
+00094ba0: 2020 6669 6c65 7061 7468 2c20 706c 7567    filepath, plug
+00094bb0: 696e 203d 2046 696c 655f 4755 492e 5365  in = File_GUI.Se
+00094bc0: 6c65 6374 4669 6c65 2827 7265 6164 272c  lectFile('read',
+00094bd0: 2773 7461 636b 2729 0d0a 2020 2020 2020  'stack')..      
+00094be0: 2020 7072 696e 7428 6669 6c65 7061 7468    print(filepath
+00094bf0: 2c20 706c 7567 696e 290d 0a20 2020 2020  , plugin)..     
+00094c00: 2020 204a 534f 4e63 6f6e 7665 7274 203d     JSONconvert =
+00094c10: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00094c20: 6966 2066 696c 6570 6174 6820 6973 206e  if filepath is n
+00094c30: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+00094c40: 2020 2020 2020 6966 2070 6c75 6769 6e20        if plugin 
+00094c50: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+00094c60: 2020 2020 2020 2020 2020 706c 7567 696e            plugin
+00094c70: 203d 2066 696c 655f 706c 7567 696e 732e   = file_plugins.
+00094c80: 6964 656e 7469 6679 2866 696c 6570 6174  identify(filepat
+00094c90: 6829 0d0a 2020 2020 2020 2020 2020 2020  h)..            
+00094ca0: 4669 6c65 5374 7275 6374 203d 2066 696c  FileStruct = fil
+00094cb0: 655f 706c 7567 696e 732e 4765 7446 696c  e_plugins.GetFil
+00094cc0: 6553 7472 7563 7475 7265 2866 696c 6570  eStructure(filep
+00094cd0: 6174 682c 2070 6c75 6769 6e3d 706c 7567  ath, plugin=plug
+00094ce0: 696e 290d 0a20 2020 2020 2020 2020 2020  in)..           
+00094cf0: 2046 696c 6549 6e74 6572 6e61 6c53 656c   FileInternalSel
+00094d00: 6563 7469 6f6e 203d 205b 2830 2c30 295d  ection = [(0,0)]
+00094d10: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00094d20: 2046 696c 6553 7472 7563 7420 6973 206e   FileStruct is n
+00094d30: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+00094d40: 2020 2020 2020 2020 2020 646c 6720 3d20            dlg = 
+00094d50: 4669 6c65 5f47 5549 2e44 6174 6143 686f  File_GUI.DataCho
+00094d60: 6963 6544 6961 6c6f 6728 6669 6c65 7061  iceDialog(filepa
+00094d70: 7468 3d66 696c 6570 6174 682c 2066 696c  th=filepath, fil
+00094d80: 6573 7472 7563 743d 4669 6c65 5374 7275  estruct=FileStru
+00094d90: 6374 2c20 706c 7567 696e 3d70 6c75 6769  ct, plugin=plugi
+00094da0: 6e29 0d0a 2020 2020 2020 2020 2020 2020  n)..            
+00094db0: 2020 2020 6966 206e 6f74 2064 6c67 2e65      if not dlg.e
+00094dc0: 7865 635f 2829 3a0d 0a20 2020 2020 2020  xec_():..       
+00094dd0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00094de0: 7572 6e20 2320 646f 206e 6f74 6869 6e67  urn # do nothing
+00094df0: 2069 6620 4755 4920 6973 2063 616e 6365   if GUI is cance
+00094e00: 6c6c 6564 0d0a 2020 2020 2020 2020 2020  lled..          
+00094e10: 2020 2020 2020 4669 6c65 496e 7465 726e        FileIntern
+00094e20: 616c 5365 6c65 6374 696f 6e20 3d20 646c  alSelection = dl
+00094e30: 672e 7365 6c65 6374 696f 6e0d 0a20 2020  g.selection..   
+00094e40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00094e50: 646c 672e 6669 6c65 7061 7468 2021 3d20  dlg.filepath != 
+00094e60: 6669 6c65 7061 7468 3a0d 0a20 2020 2020  filepath:..     
+00094e70: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00094e80: 696c 6570 6174 6820 3d20 646c 672e 6669  ilepath = dlg.fi
+00094e90: 6c65 7061 7468 0d0a 2020 2020 2020 2020  lepath..        
+00094ea0: 2020 2020 2020 2020 2020 2020 706c 7567              plug
+00094eb0: 696e 203d 2066 696c 655f 706c 7567 696e  in = file_plugin
+00094ec0: 732e 6964 656e 7469 6679 2864 6c67 2e66  s.identify(dlg.f
+00094ed0: 696c 6570 6174 6829 0d0a 2020 2020 2020  ilepath)..      
+00094ee0: 2020 2020 2020 6966 2070 6c75 6769 6e20        if plugin 
+00094ef0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+00094f00: 2020 2020 2020 2020 2020 5174 5769 6467            QtWidg
+00094f10: 6574 732e 514d 6573 7361 6765 426f 782e  ets.QMessageBox.
+00094f20: 7761 726e 696e 6728 7365 6c66 2c20 2745  warning(self, 'E
+00094f30: 7272 6f72 2127 2c20 2255 6e6b 6e6f 776e  rror!', "Unknown
+00094f40: 2066 696c 6520 7479 7065 2229 0d0a 0d0a   file type")....
+00094f50: 2020 2020 2020 2020 2020 2020 5174 5769              QtWi
+00094f60: 6467 6574 732e 5141 7070 6c69 6361 7469  dgets.QApplicati
+00094f70: 6f6e 2e73 6574 4f76 6572 7269 6465 4375  on.setOverrideCu
+00094f80: 7273 6f72 2851 7447 7569 2e51 4375 7273  rsor(QtGui.QCurs
+00094f90: 6f72 2851 742e 5761 6974 4375 7273 6f72  or(Qt.WaitCursor
+00094fa0: 2929 0d0a 0d0a 2020 2020 2020 2020 2020  ))....          
+00094fb0: 2020 6966 2073 656c 662e 636f 6d6d 6f6e    if self.common
+00094fc0: 2e73 7461 636b 5f6c 6f61 6465 6420 3d3d  .stack_loaded ==
+00094fd0: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
+00094fe0: 2020 2020 2073 656c 662e 6e65 775f 7374       self.new_st
+00094ff0: 6163 6b5f 7265 6672 6573 6828 290d 0a20  ack_refresh().. 
+00095000: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00095010: 656c 662e 7374 6b2e 6e65 775f 6461 7461  elf.stk.new_data
+00095020: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00095030: 2020 2020 7365 6c66 2e61 6e6c 7a2e 6465      self.anlz.de
+00095040: 6c65 7465 5f64 6174 6128 290d 0a20 2020  lete_data()..   
+00095050: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
+00095060: 2020 2020 2020 2020 2020 2020 2020 204a                 J
+00095070: 534f 4e63 6f6e 7665 7274 203d 2064 6c67  SONconvert = dlg
+00095080: 2e6a 736f 6e63 6865 636b 2e69 7343 6865  .jsoncheck.isChe
+00095090: 636b 6564 2829 0d0a 2020 2020 2020 2020  cked()..        
+000950a0: 2020 2020 6578 6365 7074 2055 6e62 6f75      except Unbou
+000950b0: 6e64 4c6f 6361 6c45 7272 6f72 3a0d 0a20  ndLocalError:.. 
+000950c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000950d0: 7269 6e74 2822 4461 7461 4368 6f69 6365  rint("DataChoice
+000950e0: 4469 616c 6f67 2073 6b69 7070 6564 2229  Dialog skipped")
+000950f0: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
+00095100: 6c65 5f70 6c75 6769 6e73 2e6c 6f61 6428  le_plugins.load(
+00095110: 6669 6c65 7061 7468 2c20 7374 6163 6b5f  filepath, stack_
+00095120: 6f62 6a65 6374 3d73 656c 662e 7374 6b2c  object=self.stk,
+00095130: 2070 6c75 6769 6e3d 706c 7567 696e 2c20   plugin=plugin, 
+00095140: 7365 6c65 6374 696f 6e3d 4669 6c65 496e  selection=FileIn
+00095150: 7465 726e 616c 5365 6c65 6374 696f 6e2c  ternalSelection,
+00095160: 6a73 6f6e 3d4a 534f 4e63 6f6e 7665 7274  json=JSONconvert
+00095170: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
+00095180: 6972 6563 746f 7279 203d 206f 732e 7061  irectory = os.pa
+00095190: 7468 2e64 6972 6e61 6d65 2873 7472 2866  th.dirname(str(f
+000951a0: 696c 6570 6174 6829 290d 0a20 2020 2020  ilepath))..     
+000951b0: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
+000951c0: 312e 6669 6c65 6e61 6d65 203d 206f 732e  1.filename = os.
+000951d0: 7061 7468 2e62 6173 656e 616d 6528 7374  path.basename(st
+000951e0: 7228 6669 6c65 7061 7468 2929 0d0a 0d0a  r(filepath))....
+000951f0: 0d0a 2020 2020 2020 2020 2020 2020 2355  ..            #U
+00095200: 7064 6174 6520 7769 6467 6574 730d 0a20  pdate widgets.. 
+00095210: 2020 2020 2020 2020 2020 2078 3d73 656c             x=sel
+00095220: 662e 7374 6b2e 6e5f 636f 6c73 0d0a 2020  f.stk.n_cols..  
+00095230: 2020 2020 2020 2020 2020 793d 7365 6c66            y=self
+00095240: 2e73 746b 2e6e 5f72 6f77 730d 0a20 2020  .stk.n_rows..   
+00095250: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
+00095260: 6765 312e 696d 6772 6762 203d 206e 702e  ge1.imgrgb = np.
+00095270: 7a65 726f 7328 782a 792a 332c 6474 7970  zeros(x*y*3,dtyp
+00095280: 6520 3d20 2275 696e 7438 2229 0d0a 2020  e = "uint8")..  
+00095290: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+000952a0: 6167 6531 2e6d 6178 7661 6c20 3d20 6e70  age1.maxval = np
+000952b0: 2e61 6d61 7828 7365 6c66 2e73 746b 2e61  .amax(self.stk.a
+000952c0: 6273 6461 7461 290d 0a0d 0a0d 0a20 2020  bsdata)......   
+000952d0: 2020 2020 2020 2020 2073 656c 662e 6978           self.ix
+000952e0: 203d 2069 6e74 2878 2f32 290d 0a20 2020   = int(x/2)..   
+000952f0: 2020 2020 2020 2020 2073 656c 662e 6979           self.iy
+00095300: 203d 2069 6e74 2879 2f32 290d 0a0d 0a20   = int(y/2).... 
+00095310: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00095320: 7061 6765 312e 6978 203d 2073 656c 662e  page1.ix = self.
+00095330: 6978 0d0a 2020 2020 2020 2020 2020 2020  ix..            
+00095340: 7365 6c66 2e70 6167 6531 2e69 7920 3d20  self.page1.iy = 
+00095350: 7365 6c66 2e69 790d 0a0d 0a20 2020 2020  self.iy....     
+00095360: 2020 2020 2020 2073 656c 662e 6965 7620         self.iev 
+00095370: 3d20 696e 7428 7365 6c66 2e73 746b 2e6e  = int(self.stk.n
+00095380: 5f65 762f 3229 0d0a 2020 2020 2020 2020  _ev/2)..        
+00095390: 2020 2020 7365 6c66 2e70 6167 6530 2e73      self.page0.s
+000953a0: 6c69 6465 725f 656e 672e 7365 7452 616e  lider_eng.setRan
+000953b0: 6765 2830 2c73 656c 662e 7374 6b2e 6e5f  ge(0,self.stk.n_
+000953c0: 6576 2d31 290d 0a20 2020 2020 2020 2020  ev-1)..         
+000953d0: 2020 2073 656c 662e 7061 6765 302e 6965     self.page0.ie
+000953e0: 7620 3d20 7365 6c66 2e69 6576 0d0a 2020  v = self.iev..  
+000953f0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00095400: 6167 6530 2e73 6c69 6465 725f 656e 672e  age0.slider_eng.
+00095410: 7365 7456 616c 7565 2873 656c 662e 6965  setValue(self.ie
+00095420: 7629 0d0a 0d0a 2020 2020 2020 2020 2020  v)....          
+00095430: 2020 7365 6c66 2e70 6167 6531 2e73 6c69    self.page1.sli
+00095440: 6465 725f 656e 672e 7365 7452 616e 6765  der_eng.setRange
+00095450: 2830 2c73 656c 662e 7374 6b2e 6e5f 6576  (0,self.stk.n_ev
+00095460: 2d31 290d 0a20 2020 2020 2020 2020 2020  -1)..           
+00095470: 2073 656c 662e 7061 6765 312e 6965 7620   self.page1.iev 
+00095480: 3d20 7365 6c66 2e69 6576 0d0a 2020 2020  = self.iev..    
+00095490: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
+000954a0: 6531 2e73 6c69 6465 725f 656e 672e 7365  e1.slider_eng.se
+000954b0: 7456 616c 7565 2873 656c 662e 6965 7629  tValue(self.iev)
+000954c0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000954d0: 2073 686f 776d 6170 7461 623a 0d0a 2020   showmaptab:..  
+000954e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000954f0: 6c66 2e70 6167 6539 2e43 6c65 6172 2829  lf.page9.Clear()
+00095500: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00095510: 2020 7365 6c66 2e70 6167 6539 2e73 6c69    self.page9.sli
+00095520: 6465 725f 656e 672e 7365 7452 616e 6765  der_eng.setRange
+00095530: 2830 2c73 656c 662e 7374 6b2e 6e5f 6576  (0,self.stk.n_ev
+00095540: 2d31 290d 0a20 2020 2020 2020 2020 2020  -1)..           
+00095550: 2073 656c 662e 7374 6b2e 7363 616c 655f   self.stk.scale_
+00095560: 6261 7228 290d 0a20 2020 2020 2020 2020  bar()..         
+00095570: 2020 2073 656c 662e 636f 6d6d 6f6e 2e73     self.common.s
+00095580: 7461 636b 5f6c 6f61 6465 6420 3d20 310d  tack_loaded = 1.
+00095590: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000955a0: 662e 636f 6d6d 6f6e 2e70 6174 6820 3d20  f.common.path = 
+000955b0: 6469 7265 6374 6f72 790d 0a0d 0a20 2020  directory....   
+000955c0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+000955d0: 2e73 746b 2e64 6174 615f 7374 7275 6374  .stk.data_struct
+000955e0: 2e73 7065 6374 726f 6d69 6372 6f73 636f  .spectromicrosco
+000955f0: 7079 2e6e 6f72 6d61 6c69 7a61 7469 6f6e  py.normalization
+00095600: 2e77 6869 7465 5f73 7065 6374 7275 6d20  .white_spectrum 
+00095610: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+00095620: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00095630: 6c66 2e63 6f6d 6d6f 6e2e 6930 5f6c 6f61  lf.common.i0_loa
+00095640: 6465 6420 3d20 310d 0a20 2020 2020 2020  ded = 1..       
+00095650: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
+00095660: 6b2e 6361 6c63 756c 6174 655f 6f70 7469  k.calculate_opti
+00095670: 6361 6c5f 6465 6e73 6974 7928 290d 0a20  cal_density().. 
+00095680: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00095690: 656c 662e 7374 6b2e 6669 6c6c 5f68 355f  elf.stk.fill_h5_
+000956a0: 7374 7275 6374 5f6e 6f72 6d61 6c69 7a61  struct_normaliza
+000956b0: 7469 6f6e 2829 0d0a 0d0a 0d0a 2020 2020  tion()......    
+000956c0: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
+000956d0: 6531 2e52 6573 6574 4469 7370 6c61 7953  e1.ResetDisplayS
+000956e0: 6574 7469 6e67 7328 290d 0a20 2020 2020  ettings()..     
+000956f0: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
+00095700: 312e 6c6f 6164 496d 6167 6528 290d 0a20  1.loadImage().. 
+00095710: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00095720: 7061 6765 312e 6275 7474 6f6e 5f6d 756c  page1.button_mul
+00095730: 7469 6372 6f70 2e73 6574 5465 7874 2827  ticrop.setText('
+00095740: 4372 6f70 2073 7461 636b 2033 442e 2e2e  Crop stack 3D...
+00095750: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
+00095760: 2370 7269 6e74 2028 782c 7929 2c20 2873  #print (x,y), (s
+00095770: 656c 662e 6978 2c73 656c 662e 6979 292c  elf.ix,self.iy),
+00095780: 2073 656c 662e 7374 6b2e 6162 7364 6174   self.stk.absdat
+00095790: 612e 7368 6170 650d 0a20 2020 2020 2020  a.shape..       
+000957a0: 2020 2020 2073 656c 662e 7061 6765 312e       self.page1.
+000957b0: 7368 6f77 5370 6563 7472 756d 2873 656c  showSpectrum(sel
+000957c0: 662e 6978 2c20 7365 6c66 2e69 7929 0d0a  f.ix, self.iy)..
+000957d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000957e0: 2e70 6167 6531 2e74 6578 7463 7472 6c2e  .page1.textctrl.
+000957f0: 7365 7454 6578 7428 7365 6c66 2e70 6167  setText(self.pag
+00095800: 6531 2e66 696c 656e 616d 6529 0d0a 0d0a  e1.filename)....
+00095810: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00095820: 2e70 6167 6530 2e43 6c65 6172 2829 0d0a  .page0.Clear()..
+00095830: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00095840: 2e70 6167 6530 2e4c 6f61 6445 6e74 7269  .page0.LoadEntri
+00095850: 6573 2829 0d0a 2020 2020 2020 2020 2020  es()..          
+00095860: 2020 7365 6c66 2e70 6167 6530 2e53 686f    self.page0.Sho
+00095870: 7749 6e66 6f28 7365 6c66 2e70 6167 6531  wInfo(self.page1
+00095880: 2e66 696c 656e 616d 652c 2064 6972 6563  .filename, direc
+00095890: 746f 7279 290d 0a0d 0a20 2020 2020 2020  tory)....       
+000958a0: 2020 2020 2073 656c 662e 7061 6765 352e       self.page5.
+000958b0: 7570 6461 7465 7769 6467 6574 7328 290d  updatewidgets().
+000958c0: 0a0d 0a20 2020 2020 2020 2020 2020 2051  ...            Q
+000958d0: 7457 6964 6765 7473 2e51 4170 706c 6963  tWidgets.QApplic
+000958e0: 6174 696f 6e2e 7265 7374 6f72 654f 7665  ation.restoreOve
+000958f0: 7272 6964 6543 7572 736f 7228 290d 0a0d  rrideCursor()...
+00095900: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00095910: 7368 6f77 6d61 7074 6162 3a0d 0a20 2020  showmaptab:..   
+00095920: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00095930: 662e 7061 6765 392e 436c 6561 7228 290d  f.page9.Clear().
+00095940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00095950: 2073 656c 662e 7061 6765 392e 4c6f 6164   self.page9.Load
+00095960: 456e 7472 6965 7328 290d 0a20 2020 2020  Entries()..     
+00095970: 2020 2073 656c 662e 7265 6672 6573 685f     self.refresh_
+00095980: 7769 6467 6574 7328 290d 0a0d 0a0d 0a23  widgets()......#
+00095990: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000959a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000959b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000959c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000959d0: 2d2d 2d2d 2d2d 0d0a 2020 2020 6465 6620  ------..    def 
+000959e0: 4275 696c 6453 7461 636b 2873 656c 6629  BuildStack(self)
+000959f0: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+00095a00: 2020 2020 2020 2020 4272 6f77 7365 2066          Browse f
+00095a10: 6f72 202e 736d 2066 696c 6573 0d0a 2020  or .sm files..  
+00095a20: 2020 2020 2020 2222 220d 0a0d 0a20 2020        """....   
+00095a30: 2020 2020 2023 7472 793a 0d0a 2020 2020       #try:..    
+00095a40: 2020 2020 6966 2054 7275 653a 0d0a 2020      if True:..  
+00095a50: 2020 2020 2020 2020 2020 6469 7265 6374            direct
+00095a60: 6f72 7920 3d20 5174 5769 6467 6574 732e  ory = QtWidgets.
+00095a70: 5146 696c 6544 6961 6c6f 672e 6765 7445  QFileDialog.getE
+00095a80: 7869 7374 696e 6744 6972 6563 746f 7279  xistingDirectory
+00095a90: 2873 656c 662c 2022 4368 6f6f 7365 2061  (self, "Choose a
+00095aa0: 2064 6972 6563 746f 7279 222c 2027 272c   directory", '',
+00095ab0: 2051 7457 6964 6765 7473 2e51 4669 6c65   QtWidgets.QFile
+00095ac0: 4469 616c 6f67 2e53 686f 7744 6972 734f  Dialog.ShowDirsO
+00095ad0: 6e6c 797c 5174 5769 6467 6574 732e 5146  nly|QtWidgets.QF
+00095ae0: 696c 6544 6961 6c6f 672e 5265 6164 4f6e  ileDialog.ReadOn
+00095af0: 6c79 2029 0d0a 0d0a 0d0a 0d0a 2020 2020  ly )........    
+00095b00: 2020 2020 2020 2020 6966 2064 6972 6563          if direc
+00095b10: 746f 7279 203d 3d20 2727 3a0d 0a20 2020  tory == '':..   
+00095b20: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00095b30: 7572 6e0d 0a0d 0a20 2020 2020 2020 2020  urn....         
+00095b40: 2020 2073 656c 662e 636f 6d6d 6f6e 2e70     self.common.p
+00095b50: 6174 6820 3d20 6469 7265 6374 6f72 790d  ath = directory.
+00095b60: 0a0d 0a20 2020 2020 2020 2020 2020 2073  ...            s
+00095b70: 7461 636b 6672 616d 6520 3d20 5374 6163  tackframe = Stac
+00095b80: 6b4c 6973 7446 7261 6d65 2873 656c 662c  kListFrame(self,
+00095b90: 2064 6972 6563 746f 7279 2c20 7365 6c66   directory, self
+00095ba0: 2e63 6f6d 6d6f 6e2c 2073 656c 662e 7374  .common, self.st
+00095bb0: 6b2c 2073 656c 662e 6461 7461 5f73 7472  k, self.data_str
+00095bc0: 7563 7429 0d0a 2020 2020 2020 2020 2020  uct)..          
+00095bd0: 2020 7374 6163 6b66 7261 6d65 2e73 686f    stackframe.sho
+00095be0: 7728 290d 0a0d 0a23 2020 2020 2020 2020  w()....#        
+00095bf0: 2065 7863 6570 743a 0d0a 2320 2020 2020   except:..#     
+00095c00: 2020 2020 2020 2020 7072 696e 7420 2745          print 'E
+00095c10: 7272 6f72 2063 6f75 6c64 206e 6f74 2062  rror could not b
+00095c20: 7569 6c64 2073 7461 636b 206c 6973 742e  uild stack list.
+00095c30: 270d 0a23 2020 2020 2020 2020 2020 2020  '..#            
+00095c40: 2073 656c 662e 636f 6d6d 6f6e 2e73 7461   self.common.sta
+00095c50: 636b 5f6c 6f61 6465 6420 3d20 300d 0a23  ck_loaded = 0..#
+00095c60: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00095c70: 662e 636f 6d6d 6f6e 2e69 305f 6c6f 6164  f.common.i0_load
+00095c80: 6564 203d 2030 0d0a 2320 2020 2020 2020  ed = 0..#       
+00095c90: 2020 2020 2020 7365 6c66 2e6e 6577 5f73        self.new_s
+00095ca0: 7461 636b 5f72 6566 7265 7368 2829 0d0a  tack_refresh()..
+00095cb0: 2320 2020 2020 2020 2020 2020 2020 7365  #             se
+00095cc0: 6c66 2e72 6566 7265 7368 5f77 6964 6765  lf.refresh_widge
+00095cd0: 7473 2829 0d0a 230d 0a23 2020 2020 2020  ts()..#..#      
+00095ce0: 2020 2020 2020 2051 7447 7569 2e51 4d65         QtGui.QMe
+00095cf0: 7373 6167 6542 6f78 2e77 6172 6e69 6e67  ssageBox.warning
+00095d00: 2873 656c 662c 2745 7272 6f72 272c 2245  (self,'Error',"E
+00095d10: 7272 6f72 2063 6f75 6c64 206e 6f74 2062  rror could not b
+00095d20: 7569 6c64 2073 7461 636b 206c 6973 7422  uild stack list"
+00095d30: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
+00095d40: 2069 6d70 6f72 7420 7379 733b 2070 7269   import sys; pri
+00095d50: 6e74 2073 7973 2e65 7863 5f69 6e66 6f28  nt sys.exc_info(
+00095d60: 290d 0a0d 0a0d 0a23 2d2d 2d2d 2d2d 2d2d  )......#--------
+00095d70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00095d80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00095d90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00095da0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a  --------------..
+00095db0: 2020 2020 6465 6620 4c6f 6164 5374 6163      def LoadStac
+00095dc0: 6b34 4428 7365 6c66 293a 0d0a 0d0a 2020  k4D(self):....  
+00095dd0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00095de0: 2020 2020 2369 6620 5472 7565 3a0d 0a0d      #if True:...
+00095df0: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
+00095e00: 6463 6172 6420 3d20 2253 7570 706f 7274  dcard = "Support
+00095e10: 6564 2034 4420 666f 726d 6174 7320 282a  ed 4D formats (*
+00095e20: 2e68 6466 3520 2a2e 6e63 6229 3b3b 4844  .hdf5 *.ncb);;HD
+00095e30: 4635 2066 696c 6573 2028 2a2e 6864 6635  F5 files (*.hdf5
+00095e40: 293b 3b4e 4342 2066 696c 6573 2028 2a2e  );;NCB files (*.
+00095e50: 6e63 6229 3b3b 220d 0a0d 0a20 2020 2020  ncb);;"....     
+00095e60: 2020 2020 2020 2066 696c 6570 6174 682c         filepath,
+00095e70: 205f 6669 6c74 6572 203d 2051 7457 6964   _filter = QtWid
+00095e80: 6765 7473 2e51 4669 6c65 4469 616c 6f67  gets.QFileDialog
+00095e90: 2e67 6574 4f70 656e 4669 6c65 4e61 6d65  .getOpenFileName
+00095ea0: 7328 7365 6c66 2c20 274f 7065 6e20 6669  s(self, 'Open fi
+00095eb0: 6c65 7327 2c20 2727 2c20 7769 6c64 6361  les', '', wildca
+00095ec0: 7264 290d 0a0d 0a20 2020 2020 2020 2020  rd)....         
+00095ed0: 2020 2069 6620 6669 6c65 7061 7468 203d     if filepath =
+00095ee0: 3d20 2727 3a0d 0a20 2020 2020 2020 2020  = '':..         
+00095ef0: 2020 2020 2020 2072 6574 7572 6e0d 0a0d         return...
+00095f00: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+00095f10: 656e 616d 6573 203d 205b 5d0d 0a20 2020  enames = []..   
+00095f20: 2020 2020 2020 2020 2066 6f72 206e 616d           for nam
+00095f30: 6520 696e 2066 696c 6570 6174 683a 0d0a  e in filepath:..
+00095f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00095f50: 6669 6c65 6e61 6d65 732e 6170 7065 6e64  filenames.append
+00095f60: 2873 7472 286e 616d 6529 290d 0a0d 0a0d  (str(name)).....
+00095f70: 0a20 2020 2020 2020 2020 2020 2064 6972  .            dir
+00095f80: 6563 746f 7279 203d 2020 6f73 2e70 6174  ectory =  os.pat
+00095f90: 682e 6469 726e 616d 6528 7374 7228 6669  h.dirname(str(fi
+00095fa0: 6c65 6e61 6d65 735b 305d 2929 0d0a 2020  lenames[0]))..  
+00095fb0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00095fc0: 6167 6531 2e66 696c 656e 616d 6520 3d20  age1.filename = 
+00095fd0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+00095fe0: 2866 696c 656e 616d 6573 5b30 5d29 0d0a  (filenames[0])..
+00095ff0: 0d0a 2020 2020 2020 2020 2020 2020 5174  ..            Qt
+00096000: 5769 6467 6574 732e 5141 7070 6c69 6361  Widgets.QApplica
+00096010: 7469 6f6e 2e73 6574 4f76 6572 7269 6465  tion.setOverride
+00096020: 4375 7273 6f72 2851 7447 7569 2e51 4375  Cursor(QtGui.QCu
+00096030: 7273 6f72 2851 742e 5761 6974 4375 7273  rsor(Qt.WaitCurs
+00096040: 6f72 2929 0d0a 2020 2020 2020 2020 2020  or))..          
+00096050: 2020 6261 7365 6e61 6d65 2c20 6578 7465    basename, exte
+00096060: 6e73 696f 6e20 3d20 6f73 2e70 6174 682e  nsion = os.path.
+00096070: 7370 6c69 7465 7874 2873 656c 662e 7061  splitext(self.pa
+00096080: 6765 312e 6669 6c65 6e61 6d65 290d 0a20  ge1.filename).. 
+00096090: 2020 2020 2020 2020 2020 2065 7874 656e             exten
+000960a0: 7369 6f6e 203d 2065 7874 656e 7369 6f6e  sion = extension
+000960b0: 2e73 7472 6970 2829 0d0a 0d0a 2020 2020  .strip()....    
+000960c0: 2020 2020 2020 2020 7365 6c66 2e63 6f6d          self.com
+000960d0: 6d6f 6e2e 7061 7468 203d 2064 6972 6563  mon.path = direc
+000960e0: 746f 7279 0d0a 2020 2020 2020 2020 2020  tory..          
+000960f0: 2020 7365 6c66 2e63 6f6d 6d6f 6e2e 6669    self.common.fi
+00096100: 6c65 6e61 6d65 203d 2073 656c 662e 7061  lename = self.pa
+00096110: 6765 312e 6669 6c65 6e61 6d65 0d0a 0d0a  ge1.filename....
+00096120: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+00096130: 7874 656e 7369 6f6e 203d 3d20 272e 6864  xtension == '.hd
+00096140: 6635 273a 0d0a 2020 2020 2020 2020 2020  f5':..          
+00096150: 2020 2020 2020 6966 2073 656c 662e 636f        if self.co
+00096160: 6d6d 6f6e 2e73 7461 636b 5f6c 6f61 6465  mmon.stack_loade
+00096170: 6420 3d3d 2031 3a0d 0a20 2020 2020 2020  d == 1:..       
+00096180: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00096190: 662e 6e65 775f 7374 6163 6b5f 7265 6672  f.new_stack_refr
+000961a0: 6573 6828 290d 0a20 2020 2020 2020 2020  esh()..         
+000961b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000961c0: 7374 6b2e 6e65 775f 6461 7461 2829 0d0a  stk.new_data()..
+000961d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000961e0: 2020 2020 7365 6c66 2e61 6e6c 7a2e 6465      self.anlz.de
+000961f0: 6c65 7465 5f64 6174 6128 290d 0a20 2020  lete_data()..   
+00096200: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00096210: 662e 7374 6b2e 7265 6164 5f68 3534 4428  f.stk.read_h54D(
+00096220: 6669 6c65 6e61 6d65 735b 305d 290d 0a0d  filenames[0])...
+00096230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00096240: 2070 7269 6e74 2827 4669 6e69 7368 6564   print('Finished
+00096250: 2072 6561 6469 6e67 2034 4420 7374 6163   reading 4D stac
+00096260: 6b27 2c20 6669 6c65 6e61 6d65 735b 305d  k', filenames[0]
+00096270: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00096280: 2065 6c69 6620 6578 7465 6e73 696f 6e20   elif extension 
+00096290: 3d3d 2027 2e6e 6362 273a 0d0a 2020 2020  == '.ncb':..    
+000962a0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000962b0: 656c 662e 636f 6d6d 6f6e 2e73 7461 636b  elf.common.stack
+000962c0: 5f6c 6f61 6465 6420 3d3d 2031 3a0d 0a20  _loaded == 1:.. 
+000962d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000962e0: 2020 2073 656c 662e 6e65 775f 7374 6163     self.new_stac
+000962f0: 6b5f 7265 6672 6573 6828 290d 0a20 2020  k_refresh()..   
+00096300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00096310: 2073 656c 662e 7374 6b2e 6e65 775f 6461   self.stk.new_da
+00096320: 7461 2829 0d0a 2020 2020 2020 2020 2020  ta()..          
+00096330: 2020 2020 2020 2020 2020 2373 656c 662e            #self.
+00096340: 7374 6b2e 6461 7461 5f73 7472 7563 742e  stk.data_struct.
+00096350: 6465 6c65 7465 5f64 6174 6128 290d 0a20  delete_data().. 
+00096360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00096370: 2020 2073 656c 662e 616e 6c7a 2e64 656c     self.anlz.del
+00096380: 6574 655f 6461 7461 2829 0d0a 2020 2020  ete_data()..    
+00096390: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000963a0: 2e73 746b 2e72 6561 645f 6e63 6234 4428  .stk.read_ncb4D(
+000963b0: 6669 6c65 6e61 6d65 7329 0d0a 2020 2020  filenames)..    
+000963c0: 2020 2020 2020 2020 2020 2020 2347 6574              #Get
+000963d0: 2065 6e65 7267 7920 6c69 7374 0d0a 2020   energy list..  
+000963e0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+000963f0: 6c64 6361 7264 203d 2020 2254 6578 7420  ldcard =  "Text 
+00096400: 6669 6c65 2028 2a2e 7478 7429 3b3b 220d  file (*.txt);;".
+00096410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00096420: 2065 6e67 6669 6c65 7061 7468 2c20 5f66   engfilepath, _f
+00096430: 696c 7465 7220 3d20 5174 5769 6467 6574  ilter = QtWidget
+00096440: 732e 5146 696c 6544 6961 6c6f 672e 6765  s.QFileDialog.ge
+00096450: 744f 7065 6e46 696c 654e 616d 6528 7365  tOpenFileName(se
+00096460: 6c66 2c20 274f 7065 6e20 6669 6c65 272c  lf, 'Open file',
+00096470: 2064 6972 6563 746f 7279 2c20 7769 6c64   directory, wild
+00096480: 6361 7264 290d 0a20 2020 2020 2020 2020  card)..         
+00096490: 2020 2020 2020 2073 656c 662e 7374 6b2e         self.stk.
+000964a0: 7265 6164 5f6e 6362 3444 656e 6572 6779  read_ncb4Denergy
+000964b0: 2873 7472 2865 6e67 6669 6c65 7061 7468  (str(engfilepath
+000964c0: 2929 0d0a 0d0a 0d0a 2020 2020 2020 2020  ))......        
+000964d0: 2020 2020 2355 7064 6174 6520 7769 6467      #Update widg
+000964e0: 6574 730d 0a20 2020 2020 2020 2020 2020  ets..           
+000964f0: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
+00096500: 7365 6c66 2e73 746b 2c20 2774 6865 7461  self.stk, 'theta
+00096510: 2729 206f 7220 7479 7065 2873 656c 662e  ') or type(self.
+00096520: 7374 6b2e 7468 6574 6129 203d 3d20 696e  stk.theta) == in
+00096530: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00096540: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+00096550: 726f 7228 224e 6f74 2061 2034 4420 7374  ror("Not a 4D st
+00096560: 6163 6b22 290d 0a20 2020 2020 2020 2020  ack")..         
+00096570: 2020 2073 656c 662e 636f 6d6d 6f6e 2e73     self.common.s
+00096580: 7461 636b 5f34 6420 3d20 310d 0a0d 0a20  tack_4d = 1.... 
+00096590: 2020 2020 2020 2020 2020 2078 3d73 656c             x=sel
+000965a0: 662e 7374 6b2e 6e5f 636f 6c73 0d0a 2020  f.stk.n_cols..  
+000965b0: 2020 2020 2020 2020 2020 793d 7365 6c66            y=self
+000965c0: 2e73 746b 2e6e 5f72 6f77 730d 0a20 2020  .stk.n_rows..   
+000965d0: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
+000965e0: 6765 312e 696d 6772 6762 203d 206e 702e  ge1.imgrgb = np.
+000965f0: 7a65 726f 7328 782a 792a 332c 6474 7970  zeros(x*y*3,dtyp
+00096600: 6520 3d20 2275 696e 7438 2229 0d0a 2020  e = "uint8")..  
+00096610: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00096620: 6167 6531 2e6d 6178 7661 6c20 3d20 6e70  age1.maxval = np
+00096630: 2e61 6d61 7828 7365 6c66 2e73 746b 2e61  .amax(self.stk.a
+00096640: 6273 6461 7461 290d 0a0d 0a0d 0a20 2020  bsdata)......   
+00096650: 2020 2020 2020 2020 2073 656c 662e 6978           self.ix
+00096660: 203d 2069 6e74 2878 2f32 290d 0a20 2020   = int(x/2)..   
+00096670: 2020 2020 2020 2020 2073 656c 662e 6979           self.iy
+00096680: 203d 2069 6e74 2879 2f32 290d 0a0d 0a20   = int(y/2).... 
+00096690: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000966a0: 7061 6765 312e 6978 203d 2073 656c 662e  page1.ix = self.
+000966b0: 6978 0d0a 2020 2020 2020 2020 2020 2020  ix..            
+000966c0: 7365 6c66 2e70 6167 6531 2e69 7920 3d20  self.page1.iy = 
+000966d0: 7365 6c66 2e69 790d 0a0d 0a20 2020 2020  self.iy....     
+000966e0: 2020 2020 2020 2073 656c 662e 6965 7620         self.iev 
+000966f0: 3d20 696e 7428 7365 6c66 2e73 746b 2e6e  = int(self.stk.n
+00096700: 5f65 762f 3229 0d0a 2020 2020 2020 2020  _ev/2)..        
+00096710: 2020 2020 7365 6c66 2e70 6167 6530 2e73      self.page0.s
+00096720: 6c69 6465 725f 656e 672e 7365 7452 616e  lider_eng.setRan
+00096730: 6765 2830 2c73 656c 662e 7374 6b2e 6e5f  ge(0,self.stk.n_
+00096740: 6576 2d31 290d 0a20 2020 2020 2020 2020  ev-1)..         
+00096750: 2020 2073 656c 662e 7061 6765 302e 6965     self.page0.ie
+00096760: 7620 3d20 7365 6c66 2e69 6576 0d0a 2020  v = self.iev..  
+00096770: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00096780: 6167 6530 2e73 6c69 6465 725f 656e 672e  age0.slider_eng.
+00096790: 7365 7456 616c 7565 2873 656c 662e 6965  setValue(self.ie
+000967a0: 7629 0d0a 0d0a 2020 2020 2020 2020 2020  v)....          
+000967b0: 2020 7365 6c66 2e70 6167 6531 2e73 6c69    self.page1.sli
+000967c0: 6465 725f 656e 672e 7365 7452 616e 6765  der_eng.setRange
+000967d0: 2830 2c73 656c 662e 7374 6b2e 6e5f 6576  (0,self.stk.n_ev
+000967e0: 2d31 290d 0a20 2020 2020 2020 2020 2020  -1)..           
+000967f0: 2073 656c 662e 7061 6765 312e 6965 7620   self.page1.iev 
+00096800: 3d20 7365 6c66 2e69 6576 0d0a 2020 2020  = self.iev..    
+00096810: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
+00096820: 6531 2e73 6c69 6465 725f 656e 672e 7365  e1.slider_eng.se
+00096830: 7456 616c 7565 2873 656c 662e 6965 7629  tValue(self.iev)
+00096840: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00096850: 7365 6c66 2e70 6167 6530 2e73 6c69 6465  self.page0.slide
+00096860: 725f 7468 6574 612e 7365 7456 6973 6962  r_theta.setVisib
+00096870: 6c65 2854 7275 6529 0d0a 2020 2020 2020  le(True)..      
+00096880: 2020 2020 2020 2373 656c 662e 7061 6765        #self.page
+00096890: 302e 7463 5f69 6d61 6765 7468 6574 612e  0.tc_imagetheta.
+000968a0: 7365 7456 6973 6962 6c65 2854 7275 6529  setVisible(True)
+000968b0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000968c0: 6c66 2e69 7468 6574 6120 3d20 300d 0a20  lf.itheta = 0.. 
+000968d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000968e0: 7061 6765 302e 736c 6964 6572 5f74 6865  page0.slider_the
+000968f0: 7461 2e73 6574 5261 6e67 6528 302c 7365  ta.setRange(0,se
+00096900: 6c66 2e73 746b 2e6e 5f74 6865 7461 2d31  lf.stk.n_theta-1
+00096910: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00096920: 656c 662e 7061 6765 302e 6974 6865 7461  elf.page0.itheta
+00096930: 203d 2073 656c 662e 6974 6865 7461 0d0a   = self.itheta..
+00096940: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00096950: 2e70 6167 6530 2e73 6c69 6465 725f 7468  .page0.slider_th
+00096960: 6574 612e 7365 7456 616c 7565 2873 656c  eta.setValue(sel
+00096970: 662e 6974 6865 7461 290d 0a20 2020 2020  f.itheta)..     
+00096980: 2020 2020 2020 2023 7365 6c66 2e70 6167         #self.pag
+00096990: 6530 2e74 635f 696d 6167 6574 6865 7461  e0.tc_imagetheta
+000969a0: 2e73 6574 5465 7874 2822 3444 2044 6174  .setText("4D Dat
+000969b0: 6120 416e 676c 653a 2022 2b73 7472 2873  a Angle: "+str(s
+000969c0: 656c 662e 7374 6b2e 7468 6574 615b 7365  elf.stk.theta[se
+000969d0: 6c66 2e69 7468 6574 615d 2929 0d0a 0d0a  lf.itheta]))....
+000969e0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000969f0: 6c66 2e70 6167 6531 2e73 6c69 6465 725f  lf.page1.slider_
+00096a00: 7468 6574 612e 7365 7456 6973 6962 6c65  theta.setVisible
+00096a10: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
+00096a20: 2020 2020 7365 6c66 2e70 6167 6531 2e74      self.page1.t
+00096a30: 635f 696d 6167 6574 6865 7461 2e73 6574  c_imagetheta.set
+00096a40: 5669 7369 626c 6528 5472 7565 290d 0a20  Visible(True).. 
+00096a50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00096a60: 7061 6765 312e 736c 6964 6572 5f74 6865  page1.slider_the
+00096a70: 7461 2e73 6574 5261 6e67 6528 302c 7365  ta.setRange(0,se
+00096a80: 6c66 2e73 746b 2e6e 5f74 6865 7461 2d31  lf.stk.n_theta-1
+00096a90: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00096aa0: 656c 662e 7061 6765 312e 6974 6865 7461  elf.page1.itheta
+00096ab0: 203d 2073 656c 662e 6974 6865 7461 0d0a   = self.itheta..
+00096ac0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00096ad0: 2e70 6167 6531 2e73 6c69 6465 725f 7468  .page1.slider_th
+00096ae0: 6574 612e 7365 7456 616c 7565 2873 656c  eta.setValue(sel
+00096af0: 662e 6974 6865 7461 290d 0a20 2020 2020  f.itheta)..     
+00096b00: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
+00096b10: 312e 6275 7474 6f6e 5f6d 756c 7469 6372  1.button_multicr
+00096b20: 6f70 2e73 6574 5465 7874 2827 4372 6f70  op.setText('Crop
+00096b30: 2073 7461 636b 2034 442e 2e2e 2729 0d0a   stack 4D...')..
+00096b40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00096b50: 2e70 6167 6531 2e74 635f 696d 6167 6574  .page1.tc_imaget
+00096b60: 6865 7461 2e73 6574 5465 7874 2822 3444  heta.setText("4D
+00096b70: 2044 6174 6120 416e 676c 653a 2022 2b73   Data Angle: "+s
+00096b80: 7472 2873 656c 662e 7374 6b2e 7468 6574  tr(self.stk.thet
+00096b90: 615b 7365 6c66 2e69 7468 6574 615d 2929  a[self.itheta]))
+00096ba0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00096bb0: 7365 6c66 2e70 6167 6532 2e62 7574 746f  self.page2.butto
+00096bc0: 6e5f 6361 6c63 7063 6134 442e 7365 7456  n_calcpca4D.setV
+00096bd0: 6973 6962 6c65 2854 7275 6529 0d0a 2020  isible(True)..  
+00096be0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00096bf0: 6167 6534 2e62 7574 746f 6e5f 6361 6c63  age4.button_calc
+00096c00: 3464 2e73 6574 5669 7369 626c 6528 5472  4d.setVisible(Tr
+00096c10: 7565 290d 0a0d 0a0d 0a20 2020 2020 2020  ue)......       
+00096c20: 2020 2020 2073 656c 662e 636f 6d6d 6f6e       self.common
+00096c30: 2e73 7461 636b 5f6c 6f61 6465 6420 3d20  .stack_loaded = 
+00096c40: 310d 0a0d 0a20 2020 2020 2020 2020 2020  1....           
+00096c50: 2069 6620 7365 6c66 2e73 746b 2e64 6174   if self.stk.dat
+00096c60: 615f 7374 7275 6374 2e73 7065 6374 726f  a_struct.spectro
+00096c70: 6d69 6372 6f73 636f 7079 2e6e 6f72 6d61  microscopy.norma
+00096c80: 6c69 7a61 7469 6f6e 2e77 6869 7465 5f73  lization.white_s
+00096c90: 7065 6374 7275 6d20 6973 206e 6f74 204e  pectrum is not N
+00096ca0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00096cb0: 2020 2020 2020 7365 6c66 2e63 6f6d 6d6f        self.commo
+00096cc0: 6e2e 6930 5f6c 6f61 6465 6420 3d20 310d  n.i0_loaded = 1.
+00096cd0: 0a0d 0a0d 0a20 2020 2020 2020 2020 2020  .....           
+00096ce0: 2073 656c 662e 7061 6765 312e 5265 7365   self.page1.Rese
+00096cf0: 7444 6973 706c 6179 5365 7474 696e 6773  tDisplaySettings
+00096d00: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00096d10: 7365 6c66 2e70 6167 6531 2e6c 6f61 6449  self.page1.loadI
+00096d20: 6d61 6765 2829 0d0a 2020 2020 2020 2020  mage()..        
+00096d30: 2020 2020 7365 6c66 2e70 6167 6531 2e73      self.page1.s
+00096d40: 686f 7753 7065 6374 7275 6d28 7365 6c66  howSpectrum(self
+00096d50: 2e69 782c 2073 656c 662e 6979 290d 0a20  .ix, self.iy).. 
+00096d60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00096d70: 7061 6765 312e 7465 7874 6374 726c 2e73  page1.textctrl.s
+00096d80: 6574 5465 7874 2873 656c 662e 7061 6765  etText(self.page
+00096d90: 312e 6669 6c65 6e61 6d65 290d 0a0d 0a20  1.filename).... 
+00096da0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00096db0: 7061 6765 302e 436c 6561 7228 290d 0a20  page0.Clear().. 
+00096dc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00096dd0: 7061 6765 302e 4c6f 6164 456e 7472 6965  page0.LoadEntrie
+00096de0: 7328 290d 0a20 2020 2020 2020 2020 2020  s()..           
+00096df0: 2073 656c 662e 7061 6765 302e 5368 6f77   self.page0.Show
+00096e00: 496e 666f 2873 656c 662e 7061 6765 312e  Info(self.page1.
+00096e10: 6669 6c65 6e61 6d65 2c20 6469 7265 6374  filename, direct
+00096e20: 6f72 7929 0d0a 0d0a 2020 2020 2020 2020  ory)....        
+00096e30: 2020 2020 7365 6c66 2e70 6167 6535 2e75      self.page5.u
+00096e40: 7064 6174 6577 6964 6765 7473 2829 0d0a  pdatewidgets()..
+00096e50: 0d0a 2020 2020 2020 2020 2020 2020 5174  ..            Qt
+00096e60: 5769 6467 6574 732e 5141 7070 6c69 6361  Widgets.QApplica
+00096e70: 7469 6f6e 2e72 6573 746f 7265 4f76 6572  tion.restoreOver
+00096e80: 7269 6465 4375 7273 6f72 2829 0d0a 0d0a  rideCursor()....
+00096e90: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00096ea0: 686f 776d 6170 7461 623a 0d0a 2020 2020  howmaptab:..    
+00096eb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00096ec0: 2e70 6167 6539 2e43 6c65 6172 2829 0d0a  .page9.Clear()..
+00096ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00096ee0: 7365 6c66 2e70 6167 6539 2e4c 6f61 6445  self.page9.LoadE
+00096ef0: 6e74 7269 6573 2829 0d0a 2020 2020 2020  ntries()..      
+00096f00: 2020 6578 6365 7074 3a0d 0a0d 0a20 2020    except:....   
+00096f10: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
+00096f20: 6d6d 6f6e 2e73 7461 636b 5f6c 6f61 6465  mmon.stack_loade
+00096f30: 6420 3d20 300d 0a20 2020 2020 2020 2020  d = 0..         
+00096f40: 2020 2073 656c 662e 636f 6d6d 6f6e 2e69     self.common.i
+00096f50: 305f 6c6f 6164 6564 203d 2030 0d0a 2020  0_loaded = 0..  
+00096f60: 2020 2020 2020 2020 2020 7365 6c66 2e6e            self.n
+00096f70: 6577 5f73 7461 636b 5f72 6566 7265 7368  ew_stack_refresh
+00096f80: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00096f90: 7365 6c66 2e70 6167 6531 2e62 7574 746f  self.page1.butto
+00096fa0: 6e5f 6d75 6c74 6963 726f 702e 7365 7454  n_multicrop.setT
+00096fb0: 6578 7428 2743 726f 7020 7374 6163 6b20  ext('Crop stack 
+00096fc0: 3344 2f34 442e 2e2e 2729 0d0a 2020 2020  3D/4D...')..    
+00096fd0: 2020 2020 2020 2020 5174 5769 6467 6574          QtWidget
+00096fe0: 732e 5141 7070 6c69 6361 7469 6f6e 2e72  s.QApplication.r
+00096ff0: 6573 746f 7265 4f76 6572 7269 6465 4375  estoreOverrideCu
+00097000: 7273 6f72 2829 0d0a 2020 2020 2020 2020  rsor()..        
+00097010: 2020 2020 5174 4775 692e 514d 6573 7361      QtGui.QMessa
+00097020: 6765 426f 782e 7761 726e 696e 6728 7365  geBox.warning(se
+00097030: 6c66 2c20 2745 7272 6f72 272c 2027 496d  lf, 'Error', 'Im
+00097040: 6167 6520 7374 6163 6b20 6e6f 7420 6c6f  age stack not lo
+00097050: 6164 6564 2e27 290d 0a0d 0a20 2020 2020  aded.')....     
+00097060: 2020 2020 2020 2069 6d70 6f72 7420 7379         import sy
+00097070: 730d 0a20 2020 2020 2020 2020 2020 2070  s..            p
+00097080: 7269 6e74 2873 7973 2e65 7863 5f69 6e66  rint(sys.exc_inf
+00097090: 6f28 2929 0d0a 0d0a 0d0a 2020 2020 2020  o())......      
+000970a0: 2020 7365 6c66 2e72 6566 7265 7368 5f77    self.refresh_w
+000970b0: 6964 6765 7473 2829 0d0a 0d0a 232d 2d2d  idgets()....#---
+000970c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000970d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000970e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000970f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00097100: 2d2d 2d0d 0a20 2020 2064 6566 204f 6e53  ---..    def OnS
+00097110: 6176 6550 726f 6365 7373 6564 5374 6163  aveProcessedStac
+00097120: 6b28 7365 6c66 2c20 6576 656e 7429 3a0d  k(self, event):.
+00097130: 0a20 2020 2020 2020 2073 656c 662e 5361  .        self.Sa
+00097140: 7665 5072 6f63 6573 7365 6453 7461 636b  veProcessedStack
+00097150: 2829 0d0a 0d0a 0d0a 232d 2d2d 2d2d 2d2d  ()......#-------
+00097160: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00097170: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00097180: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00097190: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
+000971a0: 0a20 2020 2064 6566 2053 6176 6550 726f  .    def SavePro
+000971b0: 6365 7373 6564 5374 6163 6b28 7365 6c66  cessedStack(self
+000971c0: 293a 0d0a 0d0a 2020 2020 2020 2020 2222  ):....        ""
+000971d0: 220d 0a20 2020 2020 2020 2045 7870 6f72  "..        Expor
+000971e0: 7420 7072 6f63 6573 7365 6420 7374 6163  t processed stac
+000971f0: 6b20 746f 2066 696c 650d 0a20 2020 2020  k to file..     
+00097200: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00097210: 6669 6c65 7061 7468 2c20 706c 7567 696e  filepath, plugin
+00097220: 203d 2046 696c 655f 4755 492e 5365 6c65   = File_GUI.Sele
+00097230: 6374 4669 6c65 2827 7772 6974 6527 2c27  ctFile('write','
+00097240: 7374 6163 6b27 290d 0a20 2020 2020 2020  stack')..       
+00097250: 2069 6620 6669 6c65 7061 7468 2069 7320   if filepath is 
+00097260: 6e6f 7420 4e6f 6e65 2061 6e64 2070 6c75  not None and plu
+00097270: 6769 6e20 6973 206e 6f74 204e 6f6e 653a  gin is not None:
+00097280: 0d0a 2020 2020 2020 2020 2020 2020 5174  ..            Qt
+00097290: 5769 6467 6574 732e 5141 7070 6c69 6361  Widgets.QApplica
+000972a0: 7469 6f6e 2e73 6574 4f76 6572 7269 6465  tion.setOverride
+000972b0: 4375 7273 6f72 2851 7447 7569 2e51 4375  Cursor(QtGui.QCu
+000972c0: 7273 6f72 2851 742e 5761 6974 4375 7273  rsor(Qt.WaitCurs
+000972d0: 6f72 2929 0d0a 2020 2020 2020 2020 2020  or))..          
+000972e0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+000972f0: 2020 2020 2020 2020 6669 6c65 5f70 6c75          file_plu
+00097300: 6769 6e73 2e73 6176 6528 6669 6c65 7061  gins.save(filepa
+00097310: 7468 2c20 7365 6c66 2e73 746b 2c20 2773  th, self.stk, 's
+00097320: 7461 636b 272c 2070 6c75 6769 6e3d 706c  tack', plugin=pl
+00097330: 7567 696e 290d 0a20 2020 2020 2020 2020  ugin)..         
+00097340: 2020 2020 2020 2051 7457 6964 6765 7473         QtWidgets
+00097350: 2e51 4170 706c 6963 6174 696f 6e2e 7265  .QApplication.re
+00097360: 7374 6f72 654f 7665 7272 6964 6543 7572  storeOverrideCur
+00097370: 736f 7228 290d 0a20 2020 2020 2020 2020  sor()..         
+00097380: 2020 2065 7863 6570 743a 0d0a 2020 2020     except:..    
+00097390: 2020 2020 2020 2020 2020 2020 5174 5769              QtWi
+000973a0: 6467 6574 732e 5141 7070 6c69 6361 7469  dgets.QApplicati
+000973b0: 6f6e 2e72 6573 746f 7265 4f76 6572 7269  on.restoreOverri
+000973c0: 6465 4375 7273 6f72 2829 0d0a 2020 2020  deCursor()..    
+000973d0: 2020 2020 2020 2020 2020 2020 5174 5769              QtWi
+000973e0: 6467 6574 732e 514d 6573 7361 6765 426f  dgets.QMessageBo
+000973f0: 782e 7761 726e 696e 6728 7365 6c66 2c20  x.warning(self, 
+00097400: 2745 7272 6f72 272c 2027 436f 756c 6420  'Error', 'Could 
+00097410: 6e6f 7420 7361 7665 2070 726f 6365 7373  not save process
+00097420: 6564 2073 7461 636b 2066 696c 652e 2729  ed stack file.')
+00097430: 0d0a 0d0a 0d0a 0d0a 0d0a 2020 2020 2020  ..........      
+00097440: 2020 7265 7475 726e 0d0a 0d0a 0d0a 232d    return......#-
+00097450: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00097460: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00097470: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00097480: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00097490: 2d2d 2d2d 2d0d 0a20 2020 2064 6566 206f  -----..    def o
+000974a0: 6e53 6176 6552 6573 756c 7473 546f 4835  nSaveResultsToH5
+000974b0: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
+000974c0: 2020 2020 2020 2020 7365 6c66 2e53 6176          self.Sav
+000974d0: 6552 6573 756c 7473 546f 4835 2829 0d0a  eResultsToH5()..
+000974e0: 0d0a 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ..#-------------
+000974f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00097500: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00097510: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00097520: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
+00097530: 6566 2053 6176 6552 6573 756c 7473 546f  ef SaveResultsTo
+00097540: 4835 2873 656c 6629 3a0d 0a0d 0a20 2020  H5(self):....   
+00097550: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00097560: 2020 4272 6f77 7365 2066 6f72 202e 6864    Browse for .hd
+00097570: 6635 2066 696c 650d 0a20 2020 2020 2020  f5 file..       
+00097580: 2022 2222 0d0a 0d0a 2020 2020 2020 2020   """....        
+00097590: 7472 793a 0d0a 0d0a 2020 2020 2020 2020  try:....        
+000975a0: 2020 2020 2370 7269 6e74 2073 656c 662e      #print self.
+000975b0: 6461 7461 5f73 7472 7563 742e 6578 6368  data_struct.exch
+000975c0: 616e 6765 2e64 6174 612e 7368 6170 650d  ange.data.shape.
+000975d0: 0a20 2020 2020 2020 2020 2020 2023 7072  .            #pr
+000975e0: 696e 7420 7365 6c66 2e64 6174 615f 7374  int self.data_st
+000975f0: 7275 6374 2e65 7863 6861 6e67 652e 6461  ruct.exchange.da
+00097600: 7461 5f61 7865 730d 0a0d 0a20 2020 2020  ta_axes....     
+00097610: 2020 2020 2020 2077 696c 6463 6172 6420         wildcard 
+00097620: 3d20 2248 4446 3520 6669 6c65 7320 282a  = "HDF5 files (*
+00097630: 2e68 6466 3529 220d 0a0d 0a20 2020 2020  .hdf5)"....     
+00097640: 2020 2020 2020 2066 696c 6570 6174 682c         filepath,
+00097650: 205f 6669 6c74 6572 203d 2051 7457 6964   _filter = QtWid
+00097660: 6765 7473 2e51 4669 6c65 4469 616c 6f67  gets.QFileDialog
+00097670: 2e67 6574 5361 7665 4669 6c65 4e61 6d65  .getSaveFileName
+00097680: 2873 656c 662c 2027 5361 7665 2061 7320  (self, 'Save as 
+00097690: 2e68 6466 3527 2c20 2727 2c20 7769 6c64  .hdf5', '', wild
+000976a0: 6361 7264 290d 0a0d 0a20 2020 2020 2020  card)....       
+000976b0: 2020 2020 2066 696c 6570 6174 6820 3d20       filepath = 
+000976c0: 7374 7228 6669 6c65 7061 7468 290d 0a20  str(filepath).. 
+000976d0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+000976e0: 6c65 7061 7468 203d 3d20 2727 3a0d 0a20  lepath == '':.. 
+000976f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00097700: 6574 7572 6e0d 0a0d 0a0d 0a20 2020 2020  eturn......     
+00097710: 2020 2020 2020 2064 6972 6563 746f 7279         directory
+00097720: 203d 2020 6f73 2e70 6174 682e 6469 726e   =  os.path.dirn
+00097730: 616d 6528 7374 7228 6669 6c65 7061 7468  ame(str(filepath
+00097740: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00097750: 7365 6c66 2e70 6167 6531 2e66 696c 656e  self.page1.filen
+00097760: 616d 6520 3d20 206f 732e 7061 7468 2e62  ame =  os.path.b
+00097770: 6173 656e 616d 6528 7374 7228 6669 6c65  asename(str(file
+00097780: 7061 7468 2929 0d0a 0d0a 2020 2020 2020  path))....      
+00097790: 2020 2020 2020 5174 5769 6467 6574 732e        QtWidgets.
+000977a0: 5141 7070 6c69 6361 7469 6f6e 2e73 6574  QApplication.set
+000977b0: 4f76 6572 7269 6465 4375 7273 6f72 2851  OverrideCursor(Q
+000977c0: 7447 7569 2e51 4375 7273 6f72 2851 742e  tGui.QCursor(Qt.
+000977d0: 5761 6974 4375 7273 6f72 2929 0d0a 0d0a  WaitCursor))....
+000977e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000977f0: 2e63 6f6d 6d6f 6e2e 7061 7468 203d 2064  .common.path = d
+00097800: 6972 6563 746f 7279 0d0a 2020 2020 2020  irectory..      
+00097810: 2020 2020 2020 7365 6c66 2e63 6f6d 6d6f        self.commo
+00097820: 6e2e 6669 6c65 6e61 6d65 203d 2073 656c  n.filename = sel
+00097830: 662e 7061 6765 312e 6669 6c65 6e61 6d65  f.page1.filename
+00097840: 0d0a 0d0a 0d0a 2020 2020 2020 2020 2020  ......          
+00097850: 2020 6669 6c65 5f64 6174 6165 7863 685f    file_dataexch_
+00097860: 6864 6635 2e77 7269 7465 5f72 6573 756c  hdf5.write_resul
+00097870: 7473 5f68 3528 6669 6c65 7061 7468 2c20  ts_h5(filepath, 
+00097880: 7365 6c66 2e64 6174 615f 7374 7275 6374  self.data_struct
+00097890: 2c20 7365 6c66 2e61 6e6c 7a29 0d0a 0d0a  , self.anlz)....
+000978a0: 2020 2020 2020 2020 2020 2020 5174 5769              QtWi
+000978b0: 6467 6574 732e 5141 7070 6c69 6361 7469  dgets.QApplicati
+000978c0: 6f6e 2e72 6573 746f 7265 4f76 6572 7269  on.restoreOverri
+000978d0: 6465 4375 7273 6f72 2829 0d0a 0d0a 2020  deCursor()....  
+000978e0: 2020 2020 2020 6578 6365 7074 3a0d 0a0d        except:...
+000978f0: 0a20 2020 2020 2020 2020 2020 2051 7457  .            QtW
+00097900: 6964 6765 7473 2e51 4170 706c 6963 6174  idgets.QApplicat
+00097910: 696f 6e2e 7265 7374 6f72 654f 7665 7272  ion.restoreOverr
+00097920: 6964 6543 7572 736f 7228 290d 0a20 2020  ideCursor()..   
+00097930: 2020 2020 2020 2020 2051 7447 7569 2e51           QtGui.Q
+00097940: 4d65 7373 6167 6542 6f78 2e77 6172 6e69  MessageBox.warni
+00097950: 6e67 2873 656c 662c 2027 4572 726f 7227  ng(self, 'Error'
+00097960: 2c20 2743 6f75 6c64 206e 6f74 2073 6176  , 'Could not sav
+00097970: 6520 4844 4635 2066 696c 652e 2729 0d0a  e HDF5 file.')..
+00097980: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00097990: 2e72 6566 7265 7368 5f77 6964 6765 7473  .refresh_widgets
+000979a0: 2829 0d0a 0d0a 2020 2020 2020 2020 7265  ()....        re
+000979b0: 7475 726e 0d0a 0d0a 232d 2d2d 2d2d 2d2d  turn....#-------
+000979c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000979d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000979e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000979f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
+00097a00: 0a20 2020 2064 6566 206f 6e41 626f 7574  .    def onAbout
+00097a10: 2873 656c 6629 3a0d 0a0d 0a20 2020 2020  (self):....     
+00097a20: 2020 2073 656c 662e 706f 7075 7020 3d20     self.popup = 
+00097a30: 4162 6f75 7446 7261 6d65 2873 656c 6629  AboutFrame(self)
+00097a40: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00097a50: 6f70 7570 2e73 686f 7728 290d 0a0d 0a0d  opup.show().....
+00097a60: 0a0d 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ...#------------
+00097a70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00097a80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00097a90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00097aa0: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
+00097ab0: 6465 6620 7265 6672 6573 685f 7769 6467  def refresh_widg
+00097ac0: 6574 7328 7365 6c66 293a 0d0a 0d0a 0d0a  ets(self):......
+00097ad0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00097ae0: 662e 636f 6d6d 6f6e 2e73 7461 636b 5f6c  f.common.stack_l
+00097af0: 6f61 6465 6420 3d3d 2030 3a0d 0a20 2020  oaded == 0:..   
+00097b00: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
+00097b10: 6765 312e 6275 7474 6f6e 5f69 3066 6669  ge1.button_i0ffi
+00097b20: 6c65 2e73 6574 456e 6162 6c65 6428 4661  le.setEnabled(Fa
+00097b30: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
+00097b40: 2020 7365 6c66 2e70 6167 6531 2e62 7574    self.page1.but
+00097b50: 746f 6e5f 6930 6869 7374 6f67 7261 6d2e  ton_i0histogram.
+00097b60: 7365 7445 6e61 626c 6564 2846 616c 7365  setEnabled(False
+00097b70: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00097b80: 656c 662e 7061 6765 312e 6275 7474 6f6e  elf.page1.button
+00097b90: 5f61 7274 6566 6163 7473 2e73 6574 456e  _artefacts.setEn
+00097ba0: 6162 6c65 6428 4661 6c73 6529 0d0a 2020  abled(False)..  
+00097bb0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00097bc0: 6167 6531 2e62 7574 746f 6e5f 7072 656e  age1.button_pren
+00097bd0: 6f72 6d2e 7365 7445 6e61 626c 6564 2846  orm.setEnabled(F
+00097be0: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
+00097bf0: 2020 2073 656c 662e 7061 6765 312e 6275     self.page1.bu
+00097c00: 7474 6f6e 5f72 6566 696d 6773 2e73 6574  tton_refimgs.set
+00097c10: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
+00097c20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00097c30: 2e70 6167 6531 2e62 7574 746f 6e5f 6d75  .page1.button_mu
+00097c40: 6c74 6963 726f 702e 7365 7445 6e61 626c  lticrop.setEnabl
+00097c50: 6564 2846 616c 7365 290d 0a20 2020 2020  ed(False)..     
+00097c60: 2020 2020 2020 2023 7365 6c66 2e70 6167         #self.pag
+00097c70: 6531 2e62 7574 746f 6e5f 6c69 6d69 7465  e1.button_limite
+00097c80: 762e 7365 7445 6e61 626c 6564 2846 616c  v.setEnabled(Fal
+00097c90: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
+00097ca0: 2023 7365 6c66 2e70 6167 6531 2e62 7574   #self.page1.but
+00097cb0: 746f 6e5f 7375 6272 6567 696f 6e2e 7365  ton_subregion.se
+00097cc0: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
+00097cd0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00097ce0: 662e 7061 6765 312e 6275 7474 6f6e 5f64  f.page1.button_d
+00097cf0: 6172 6b73 6967 2e73 6574 456e 6162 6c65  arksig.setEnable
+00097d00: 6428 4661 6c73 6529 0d0a 2020 2020 2020  d(False)..      
+00097d10: 2020 2020 2020 7365 6c66 2e70 6167 6531        self.page1
+00097d20: 2e62 7574 746f 6e5f 7361 7665 2e73 6574  .button_save.set
+00097d30: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
+00097d40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00097d50: 2e70 6167 6531 2e62 7574 746f 6e5f 7361  .page1.button_sa
+00097d60: 7665 7374 6163 6b2e 7365 7445 6e61 626c  vestack.setEnabl
+00097d70: 6564 2846 616c 7365 290d 0a20 2020 2020  ed(False)..     
+00097d80: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
+00097d90: 312e 6275 7474 6f6e 5f61 6c69 676e 2e73  1.button_align.s
+00097da0: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
+00097db0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00097dc0: 6c66 2e70 6167 6531 2e62 7574 746f 6e5f  lf.page1.button_
+00097dd0: 736c 6964 6573 686f 772e 7365 7445 6e61  slideshow.setEna
+00097de0: 626c 6564 2846 616c 7365 290d 0a20 2020  bled(False)..   
+00097df0: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
+00097e00: 6765 312e 6275 7474 6f6e 5f61 6464 524f  ge1.button_addRO
+00097e10: 492e 7365 7445 6e61 626c 6564 2846 616c  I.setEnabled(Fal
+00097e20: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
+00097e30: 2073 656c 662e 7061 6765 312e 6275 7474   self.page1.butt
+00097e40: 6f6e 5f73 7065 6374 7261 6c52 4f49 2e73  on_spectralROI.s
+00097e50: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
+00097e60: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00097e70: 6c66 2e70 6167 6531 2e62 7574 746f 6e5f  lf.page1.button_
+00097e80: 7265 7365 7464 6973 706c 6179 2e73 6574  resetdisplay.set
+00097e90: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
 00097ea0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00097eb0: 2e70 6167 6531 2e62 7574 746f 6e5f 6930  .page1.button_i0
-00097ec0: 6869 7374 6f67 7261 6d2e 7365 7445 6e61  histogram.setEna
-00097ed0: 626c 6564 2854 7275 6529 0d0a 2020 2020  bled(True)..    
-00097ee0: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
-00097ef0: 6531 2e62 7574 746f 6e5f 6172 7465 6661  e1.button_artefa
-00097f00: 6374 732e 7365 7445 6e61 626c 6564 2854  cts.setEnabled(T
-00097f10: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
-00097f20: 2020 7365 6c66 2e70 6167 6531 2e62 7574    self.page1.but
-00097f30: 746f 6e5f 7072 656e 6f72 6d2e 7365 7445  ton_prenorm.setE
-00097f40: 6e61 626c 6564 2854 7275 6529 0d0a 2020  nabled(True)..  
-00097f50: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00097f60: 6167 6531 2e62 7574 746f 6e5f 6d75 6c74  age1.button_mult
-00097f70: 6963 726f 702e 7365 7445 6e61 626c 6564  icrop.setEnabled
-00097f80: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
-00097f90: 2020 2020 2373 656c 662e 7061 6765 312e      #self.page1.
-00097fa0: 6275 7474 6f6e 5f6c 696d 6974 6576 2e73  button_limitev.s
-00097fb0: 6574 456e 6162 6c65 6428 5472 7565 290d  etEnabled(True).
-00097fc0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00097fd0: 7365 6c66 2e63 6f6d 6d6f 6e2e 7374 6163  self.common.stac
-00097fe0: 6b5f 3464 203d 3d20 303a 0d0a 2020 2020  k_4d == 0:..    
-00097ff0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00098000: 2e70 6167 6531 2e62 7574 746f 6e5f 7265  .page1.button_re
-00098010: 6669 6d67 732e 7365 7445 6e61 626c 6564  fimgs.setEnabled
-00098020: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
-00098030: 2020 2020 2020 2020 2373 656c 662e 7061          #self.pa
-00098040: 6765 312e 6275 7474 6f6e 5f73 7562 7265  ge1.button_subre
-00098050: 6769 6f6e 2e73 6574 456e 6162 6c65 6428  gion.setEnabled(
-00098060: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
-00098070: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
-00098080: 312e 6275 7474 6f6e 5f64 6172 6b73 6967  1.button_darksig
-00098090: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
-000980a0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-000980b0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-000980c0: 2020 2020 2020 7365 6c66 2e70 6167 6531        self.page1
-000980d0: 2e62 7574 746f 6e5f 7265 6669 6d67 732e  .button_refimgs.
-000980e0: 7365 7445 6e61 626c 6564 2846 616c 7365  setEnabled(False
-000980f0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00098100: 2020 2023 7365 6c66 2e70 6167 6531 2e62     #self.page1.b
-00098110: 7574 746f 6e5f 7375 6272 6567 696f 6e2e  utton_subregion.
-00098120: 7365 7445 6e61 626c 6564 2846 616c 7365  setEnabled(False
-00098130: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00098140: 2020 2073 656c 662e 7061 6765 312e 6275     self.page1.bu
-00098150: 7474 6f6e 5f64 6172 6b73 6967 2e73 6574  tton_darksig.set
-00098160: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
-00098170: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00098180: 2e70 6167 6531 2e62 7574 746f 6e5f 7361  .page1.button_sa
-00098190: 7665 2e73 6574 456e 6162 6c65 6428 5472  ve.setEnabled(Tr
-000981a0: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-000981b0: 2073 656c 662e 7061 6765 312e 6275 7474   self.page1.butt
-000981c0: 6f6e 5f73 6176 6573 7461 636b 2e73 6574  on_savestack.set
-000981d0: 456e 6162 6c65 6428 5472 7565 290d 0a20  Enabled(True).. 
-000981e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000981f0: 7061 6765 312e 6275 7474 6f6e 5f61 6c69  page1.button_ali
-00098200: 676e 2e73 6574 456e 6162 6c65 6428 5472  gn.setEnabled(Tr
-00098210: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-00098220: 2073 656c 662e 7061 6765 312e 6275 7474   self.page1.butt
-00098230: 6f6e 5f73 6c69 6465 7368 6f77 2e73 6574  on_slideshow.set
-00098240: 456e 6162 6c65 6428 5472 7565 290d 0a20  Enabled(True).. 
-00098250: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00098260: 7061 6765 312e 6275 7474 6f6e 5f61 6464  page1.button_add
-00098270: 524f 492e 7365 7445 6e61 626c 6564 2854  ROI.setEnabled(T
-00098280: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
-00098290: 2020 7365 6c66 2e70 6167 6531 2e62 7574    self.page1.but
-000982a0: 746f 6e5f 7370 6563 7472 616c 524f 492e  ton_spectralROI.
-000982b0: 7365 7445 6e61 626c 6564 2854 7275 6529  setEnabled(True)
-000982c0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000982d0: 6c66 2e70 6167 6531 2e62 7574 746f 6e5f  lf.page1.button_
-000982e0: 7265 7365 7464 6973 706c 6179 2e73 6574  resetdisplay.set
-000982f0: 456e 6162 6c65 6428 5472 7565 290d 0a20  Enabled(True).. 
-00098300: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00098310: 7061 6765 312e 6275 7474 6f6e 5f64 6573  page1.button_des
-00098320: 7069 6b65 2e73 6574 456e 6162 6c65 6428  pike.setEnabled(
-00098330: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
-00098340: 2020 2073 656c 662e 7061 6765 312e 6275     self.page1.bu
-00098350: 7474 6f6e 5f64 6973 706c 6179 636f 6c6f  tton_displaycolo
-00098360: 722e 7365 7445 6e61 626c 6564 2854 7275  r.setEnabled(Tru
-00098370: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00098380: 7365 6c66 2e61 6374 696f 6e53 6176 652e  self.actionSave.
-00098390: 7365 7445 6e61 626c 6564 2854 7275 6529  setEnabled(True)
-000983a0: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6966  ......        if
-000983b0: 2073 656c 662e 636f 6d6d 6f6e 2e69 305f   self.common.i0_
-000983c0: 6c6f 6164 6564 203d 3d20 303a 0d0a 2020  loaded == 0:..  
-000983d0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-000983e0: 6167 6531 2e62 7574 746f 6e5f 7368 6f77  age1.button_show
-000983f0: 6930 2e73 6574 456e 6162 6c65 6428 4661  i0.setEnabled(Fa
-00098400: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
-00098410: 2020 7365 6c66 2e70 6167 6531 2e72 625f    self.page1.rb_
-00098420: 666c 7578 2e73 6574 456e 6162 6c65 6428  flux.setEnabled(
-00098430: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-00098440: 2020 2020 7365 6c66 2e70 6167 6531 2e72      self.page1.r
-00098450: 625f 6f64 2e73 6574 456e 6162 6c65 6428  b_od.setEnabled(
-00098460: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-00098470: 2020 2020 7365 6c66 2e70 6167 6531 2e62      self.page1.b
-00098480: 7574 746f 6e5f 7265 7365 7469 302e 7365  utton_reseti0.se
-00098490: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
-000984a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000984b0: 662e 7061 6765 312e 6275 7474 6f6e 5f73  f.page1.button_s
-000984c0: 6176 656f 642e 7365 7445 6e61 626c 6564  aveod.setEnabled
-000984d0: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
-000984e0: 2020 2020 2073 656c 662e 7061 6765 322e       self.page2.
-000984f0: 6275 7474 6f6e 5f63 616c 6370 6361 2e73  button_calcpca.s
-00098500: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
-00098510: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00098520: 6c66 2e70 6167 6532 2e62 7574 746f 6e5f  lf.page2.button_
-00098530: 6361 6c63 7063 6134 442e 7365 7445 6e61  calcpca4D.setEna
-00098540: 626c 6564 2846 616c 7365 290d 0a20 2020  bled(False)..   
-00098550: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-00098560: 6765 342e 6275 7474 6f6e 5f6c 6f61 6474  ge4.button_loadt
-00098570: 7370 6563 2e73 6574 456e 6162 6c65 6428  spec.setEnabled(
-00098580: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-00098590: 2020 2020 7365 6c66 2e70 6167 6534 2e62      self.page4.b
-000985a0: 7574 746f 6e5f 6164 6466 6c61 742e 7365  utton_addflat.se
-000985b0: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
-000985c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000985d0: 662e 7061 6765 352e 6275 7474 6f6e 5f73  f.page5.button_s
-000985e0: 6176 652e 7365 7445 6e61 626c 6564 2846  ave.setEnabled(F
-000985f0: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
-00098600: 2020 2069 6620 7365 6c66 2e70 6167 6537     if self.page7
-00098610: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00098620: 2020 2073 656c 662e 7061 6765 372e 6275     self.page7.bu
-00098630: 7474 6f6e 5f63 616c 636e 6e6d 612e 7365  tton_calcnnma.se
-00098640: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
-00098650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00098660: 2073 656c 662e 7061 6765 372e 6275 7474   self.page7.butt
-00098670: 6f6e 5f6d 7566 696c 652e 7365 7445 6e61  on_mufile.setEna
-00098680: 626c 6564 2846 616c 7365 290d 0a20 2020  bled(False)..   
-00098690: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000986a0: 662e 7061 6765 372e 6275 7474 6f6e 5f6d  f.page7.button_m
-000986b0: 7572 616e 642e 7365 7445 6e61 626c 6564  urand.setEnabled
-000986c0: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
-000986d0: 2020 2020 2069 6620 7368 6f77 746f 6d6f       if showtomo
-000986e0: 7461 623a 0d0a 2020 2020 2020 2020 2020  tab:..          
-000986f0: 2020 2020 2020 7365 6c66 2e70 6167 6538        self.page8
-00098700: 2e62 7574 746f 6e5f 656e 6764 6174 612e  .button_engdata.
-00098710: 7365 7445 6e61 626c 6564 2846 616c 7365  setEnabled(False
-00098720: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-00098730: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00098740: 6c66 2e70 6167 6531 2e62 7574 746f 6e5f  lf.page1.button_
-00098750: 7368 6f77 6930 2e73 6574 456e 6162 6c65  showi0.setEnable
-00098760: 6428 5472 7565 290d 0a20 2020 2020 2020  d(True)..       
-00098770: 2020 2020 2073 656c 662e 7061 6765 312e       self.page1.
-00098780: 7262 5f66 6c75 782e 7365 7445 6e61 626c  rb_flux.setEnabl
-00098790: 6564 2854 7275 6529 0d0a 2020 2020 2020  ed(True)..      
-000987a0: 2020 2020 2020 7365 6c66 2e70 6167 6531        self.page1
-000987b0: 2e72 625f 6f64 2e73 6574 456e 6162 6c65  .rb_od.setEnable
-000987c0: 6428 5472 7565 290d 0a20 2020 2020 2020  d(True)..       
-000987d0: 2020 2020 2073 656c 662e 7061 6765 312e       self.page1.
-000987e0: 6275 7474 6f6e 5f72 6573 6574 6930 2e73  button_reseti0.s
-000987f0: 6574 456e 6162 6c65 6428 5472 7565 290d  etEnabled(True).
-00098800: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00098810: 662e 7061 6765 312e 6275 7474 6f6e 5f73  f.page1.button_s
-00098820: 6176 656f 642e 7365 7445 6e61 626c 6564  aveod.setEnabled
-00098830: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
-00098840: 2020 2020 7365 6c66 2e70 6167 6532 2e62      self.page2.b
-00098850: 7574 746f 6e5f 6361 6c63 7063 612e 7365  utton_calcpca.se
-00098860: 7445 6e61 626c 6564 2854 7275 6529 0d0a  tEnabled(True)..
-00098870: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00098880: 2e70 6167 6532 2e62 7574 746f 6e5f 6361  .page2.button_ca
-00098890: 6c63 7063 6134 442e 7365 7445 6e61 626c  lcpca4D.setEnabl
-000988a0: 6564 2854 7275 6529 0d0a 2020 2020 2020  ed(True)..      
-000988b0: 2020 2020 2020 7365 6c66 2e70 6167 6534        self.page4
-000988c0: 2e62 7574 746f 6e5f 6c6f 6164 7473 7065  .button_loadtspe
-000988d0: 632e 7365 7445 6e61 626c 6564 2854 7275  c.setEnabled(Tru
-000988e0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-000988f0: 7365 6c66 2e70 6167 6534 2e62 7574 746f  self.page4.butto
-00098900: 6e5f 6164 6466 6c61 742e 7365 7445 6e61  n_addflat.setEna
-00098910: 626c 6564 2854 7275 6529 0d0a 2020 2020  bled(True)..    
-00098920: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
-00098930: 6535 2e62 7574 746f 6e5f 7361 7665 2e73  e5.button_save.s
-00098940: 6574 456e 6162 6c65 6428 5472 7565 290d  etEnabled(True).
-00098950: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00098960: 7365 6c66 2e70 6167 6537 3a0d 0a20 2020  self.page7:..   
-00098970: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00098980: 662e 7061 6765 372e 6275 7474 6f6e 5f63  f.page7.button_c
-00098990: 616c 636e 6e6d 612e 7365 7445 6e61 626c  alcnnma.setEnabl
-000989a0: 6564 2854 7275 6529 0d0a 2020 2020 2020  ed(True)..      
-000989b0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-000989c0: 6167 6537 2e62 7574 746f 6e5f 6d75 6669  age7.button_mufi
-000989d0: 6c65 2e73 6574 456e 6162 6c65 6428 5472  le.setEnabled(Tr
-000989e0: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-000989f0: 2020 2020 2073 656c 662e 7061 6765 372e       self.page7.
-00098a00: 6275 7474 6f6e 5f6d 7572 616e 642e 7365  button_murand.se
-00098a10: 7445 6e61 626c 6564 2854 7275 6529 0d0a  tEnabled(True)..
-00098a20: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00098a30: 686f 7774 6f6d 6f74 6162 3a0d 0a20 2020  howtomotab:..   
-00098a40: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00098a50: 662e 7061 6765 382e 6275 7474 6f6e 5f65  f.page8.button_e
-00098a60: 6e67 6461 7461 2e73 6574 456e 6162 6c65  ngdata.setEnable
-00098a70: 6428 5472 7565 290d 0a0d 0a20 2020 2020  d(True)....     
-00098a80: 2020 2069 6620 7365 6c66 2e63 6f6d 6d6f     if self.commo
-00098a90: 6e2e 7063 615f 6361 6c63 756c 6174 6564  n.pca_calculated
-00098aa0: 203d 3d20 303a 0d0a 2020 2020 2020 2020   == 0:..        
-00098ab0: 2020 2020 7365 6c66 2e70 6167 6532 2e62      self.page2.b
-00098ac0: 7574 746f 6e5f 7361 7665 7063 612e 7365  utton_savepca.se
-00098ad0: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
-00098ae0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00098af0: 662e 7061 6765 322e 736c 6964 6572 7368  f.page2.slidersh
-00098b00: 6f77 2e73 6574 456e 6162 6c65 6428 4661  ow.setEnabled(Fa
-00098b10: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
-00098b20: 2020 7365 6c66 2e70 6167 6532 2e62 7574    self.page2.but
-00098b30: 746f 6e5f 6d6f 7665 7063 7570 2e73 6574  ton_movepcup.set
-00098b40: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
-00098b50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00098b60: 2e70 6167 6533 2e62 7574 746f 6e5f 6361  .page3.button_ca
-00098b70: 6c63 6361 2e73 6574 456e 6162 6c65 6428  lcca.setEnabled(
-00098b80: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-00098b90: 2020 2020 7365 6c66 2e70 6167 6534 2e72      self.page4.r
-00098ba0: 625f 6669 742e 7365 7445 6e61 626c 6564  b_fit.setEnabled
-00098bb0: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
-00098bc0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00098bd0: 2020 2020 7365 6c66 2e70 6167 6532 2e62      self.page2.b
-00098be0: 7574 746f 6e5f 7361 7665 7063 612e 7365  utton_savepca.se
-00098bf0: 7445 6e61 626c 6564 2854 7275 6529 0d0a  tEnabled(True)..
-00098c00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00098c10: 2e70 6167 6532 2e73 6c69 6465 7273 686f  .page2.slidersho
-00098c20: 772e 7365 7445 6e61 626c 6564 2854 7275  w.setEnabled(Tru
-00098c30: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00098c40: 7365 6c66 2e70 6167 6532 2e62 7574 746f  self.page2.butto
-00098c50: 6e5f 6d6f 7665 7063 7570 2e73 6574 456e  n_movepcup.setEn
-00098c60: 6162 6c65 6428 5472 7565 290d 0a20 2020  abled(True)..   
-00098c70: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-00098c80: 6765 332e 6275 7474 6f6e 5f63 616c 6363  ge3.button_calcc
-00098c90: 612e 7365 7445 6e61 626c 6564 2854 7275  a.setEnabled(Tru
-00098ca0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00098cb0: 7365 6c66 2e70 6167 6534 2e72 625f 6669  self.page4.rb_fi
-00098cc0: 742e 7365 7445 6e61 626c 6564 2854 7275  t.setEnabled(Tru
-00098cd0: 6529 0d0a 0d0a 2020 2020 2020 2020 6966  e)....        if
-00098ce0: 2073 656c 662e 636f 6d6d 6f6e 2e63 6c75   self.common.clu
-00098cf0: 7374 6572 5f63 616c 6375 6c61 7465 6420  ster_calculated 
-00098d00: 3d3d 2030 3a0d 0a20 2020 2020 2020 2020  == 0:..         
-00098d10: 2020 2073 656c 662e 7061 6765 332e 6275     self.page3.bu
-00098d20: 7474 6f6e 5f73 6361 7474 6572 706c 6f74  tton_scatterplot
-00098d30: 732e 7365 7445 6e61 626c 6564 2846 616c  s.setEnabled(Fal
-00098d40: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
-00098d50: 2073 656c 662e 7061 6765 332e 6275 7474   self.page3.butt
-00098d60: 6f6e 5f73 6176 6563 6c75 7374 6572 2e73  on_savecluster.s
-00098d70: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
-00098d80: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00098d90: 6c66 2e70 6167 6533 2e73 6c69 6465 7273  lf.page3.sliders
-00098da0: 686f 772e 7365 7445 6e61 626c 6564 2846  how.setEnabled(F
-00098db0: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
-00098dc0: 2020 2073 656c 662e 7061 6765 342e 6275     self.page4.bu
-00098dd0: 7474 6f6e 5f61 6464 636c 7370 6563 2e73  tton_addclspec.s
-00098de0: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
-00098df0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00098e00: 6c66 2e70 6167 6535 2e62 7574 746f 6e5f  lf.page5.button_
-00098e10: 6164 6463 6c73 7065 632e 7365 7445 6e61  addclspec.setEna
-00098e20: 626c 6564 2846 616c 7365 290d 0a20 2020  bled(False)..   
-00098e30: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00098e40: 2e70 6167 6537 3a0d 0a20 2020 2020 2020  .page7:..       
-00098e50: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-00098e60: 6765 372e 6275 7474 6f6e 5f6d 7563 6c75  ge7.button_muclu
-00098e70: 7374 6572 2e73 6574 456e 6162 6c65 6428  ster.setEnabled(
-00098e80: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-00098e90: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00098ea0: 2020 2073 656c 662e 7061 6765 332e 6275     self.page3.bu
-00098eb0: 7474 6f6e 5f73 6361 7474 6572 706c 6f74  tton_scatterplot
-00098ec0: 732e 7365 7445 6e61 626c 6564 2854 7275  s.setEnabled(Tru
-00098ed0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00098ee0: 7365 6c66 2e70 6167 6533 2e62 7574 746f  self.page3.butto
-00098ef0: 6e5f 7361 7665 636c 7573 7465 722e 7365  n_savecluster.se
-00098f00: 7445 6e61 626c 6564 2854 7275 6529 0d0a  tEnabled(True)..
-00098f10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00098f20: 2e70 6167 6533 2e73 6c69 6465 7273 686f  .page3.slidersho
-00098f30: 772e 7365 7445 6e61 626c 6564 2854 7275  w.setEnabled(Tru
-00098f40: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00098f50: 7365 6c66 2e70 6167 6534 2e62 7574 746f  self.page4.butto
-00098f60: 6e5f 6164 6463 6c73 7065 632e 7365 7445  n_addclspec.setE
-00098f70: 6e61 626c 6564 2854 7275 6529 0d0a 2020  nabled(True)..  
-00098f80: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00098f90: 6167 6535 2e62 7574 746f 6e5f 6164 6463  age5.button_addc
-00098fa0: 6c73 7065 632e 7365 7445 6e61 626c 6564  lspec.setEnabled
-00098fb0: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
-00098fc0: 2020 2020 6966 2073 656c 662e 7061 6765      if self.page
-00098fd0: 373a 0d0a 2020 2020 2020 2020 2020 2020  7:..            
-00098fe0: 2020 2020 7365 6c66 2e70 6167 6537 2e62      self.page7.b
-00098ff0: 7574 746f 6e5f 6d75 636c 7573 7465 722e  utton_mucluster.
-00099000: 7365 7445 6e61 626c 6564 2854 7275 6529  setEnabled(True)
-00099010: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6966  ......        if
-00099020: 2073 656c 662e 636f 6d6d 6f6e 2e73 7065   self.common.spe
-00099030: 635f 616e 6c5f 6361 6c63 756c 6174 6564  c_anl_calculated
-00099040: 203d 3d20 303a 0d0a 2020 2020 2020 2020   == 0:..        
-00099050: 2020 2020 7365 6c66 2e70 6167 6534 2e62      self.page4.b
-00099060: 7574 746f 6e5f 7265 6d6f 7665 7370 6563  utton_removespec
-00099070: 2e73 6574 456e 6162 6c65 6428 4661 6c73  .setEnabled(Fals
-00099080: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00099090: 7365 6c66 2e70 6167 6534 2e62 7574 746f  self.page4.butto
-000990a0: 6e5f 6d6f 7665 7370 646f 776e 2e73 6574  n_movespdown.set
-000990b0: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
-000990c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000990d0: 2e70 6167 6534 2e62 7574 746f 6e5f 6d6f  .page4.button_mo
-000990e0: 7665 7370 7570 2e73 6574 456e 6162 6c65  vespup.setEnable
-000990f0: 6428 4661 6c73 6529 0d0a 2020 2020 2020  d(False)..      
-00099100: 2020 2020 2020 7365 6c66 2e70 6167 6534        self.page4
-00099110: 2e62 7574 746f 6e5f 7361 7665 2e73 6574  .button_save.set
-00099120: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
-00099130: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00099140: 2e70 6167 6534 2e62 7574 746f 6e5f 7368  .page4.button_sh
-00099150: 6f77 7267 622e 7365 7445 6e61 626c 6564  owrgb.setEnabled
-00099160: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
-00099170: 2020 2020 2073 656c 662e 7061 6765 342e       self.page4.
-00099180: 6275 7474 6f6e 5f68 6973 746f 6772 616d  button_histogram
-00099190: 2e73 6574 456e 6162 6c65 6428 4661 6c73  .setEnabled(Fals
-000991a0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-000991b0: 7365 6c66 2e70 6167 6534 2e62 7574 746f  self.page4.butto
-000991c0: 6e5f 6361 6c63 3464 2e73 6574 456e 6162  n_calc4d.setEnab
-000991d0: 6c65 6428 4661 6c73 6529 0d0a 0d0a 2020  led(False)....  
-000991e0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-000991f0: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-00099200: 6765 342e 6275 7474 6f6e 5f72 656d 6f76  ge4.button_remov
-00099210: 6573 7065 632e 7365 7445 6e61 626c 6564  espec.setEnabled
-00099220: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
-00099230: 2020 2020 7365 6c66 2e70 6167 6534 2e62      self.page4.b
-00099240: 7574 746f 6e5f 6d6f 7665 7370 646f 776e  utton_movespdown
-00099250: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
-00099260: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00099270: 656c 662e 7061 6765 342e 6275 7474 6f6e  elf.page4.button
-00099280: 5f6d 6f76 6573 7075 702e 7365 7445 6e61  _movespup.setEna
-00099290: 626c 6564 2854 7275 6529 0d0a 2020 2020  bled(True)..    
-000992a0: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
-000992b0: 6534 2e62 7574 746f 6e5f 7361 7665 2e73  e4.button_save.s
-000992c0: 6574 456e 6162 6c65 6428 5472 7565 290d  etEnabled(True).
-000992d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000992e0: 662e 7061 6765 342e 6275 7474 6f6e 5f73  f.page4.button_s
-000992f0: 686f 7772 6762 2e73 6574 456e 6162 6c65  howrgb.setEnable
-00099300: 6428 5472 7565 290d 0a20 2020 2020 2020  d(True)..       
-00099310: 2020 2020 2073 656c 662e 7061 6765 342e       self.page4.
-00099320: 6275 7474 6f6e 5f68 6973 746f 6772 616d  button_histogram
-00099330: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
-00099340: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00099350: 656c 662e 7061 6765 342e 6275 7474 6f6e  elf.page4.button
-00099360: 5f63 616c 6334 642e 7365 7445 6e61 626c  _calc4d.setEnabl
-00099370: 6564 2854 7275 6529 0d0a 0d0a 0d0a 2020  ed(True)......  
-00099380: 2020 2020 2020 6966 2073 686f 7774 6f6d        if showtom
-00099390: 6f74 6162 3a0d 0a20 2020 2020 2020 2020  otab:..         
-000993a0: 2020 2069 6620 7365 6c66 2e63 6f6d 6d6f     if self.commo
-000993b0: 6e2e 7370 6563 5f61 6e6c 3444 5f63 616c  n.spec_anl4D_cal
-000993c0: 6375 6c61 7465 6420 3d3d 2030 3a0d 0a20  culated == 0:.. 
-000993d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000993e0: 656c 662e 7061 6765 382e 6275 7474 6f6e  elf.page8.button
-000993f0: 5f73 7063 6f6d 702e 7365 7445 6e61 626c  _spcomp.setEnabl
-00099400: 6564 2846 616c 7365 290d 0a20 2020 2020  ed(False)..     
-00099410: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00099420: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00099430: 6c66 2e70 6167 6538 2e62 7574 746f 6e5f  lf.page8.button_
-00099440: 7370 636f 6d70 2e73 6574 456e 6162 6c65  spcomp.setEnable
-00099450: 6428 5472 7565 290d 0a0d 0a0d 0a20 2020  d(True)......   
-00099460: 2020 2020 2069 6620 7365 6c66 2e70 6167       if self.pag
-00099470: 6536 2021 3d20 4e6f 6e65 3a0d 0a20 2020  e6 != None:..   
-00099480: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00099490: 2e63 6f6d 6d6f 6e2e 636c 7573 7465 725f  .common.cluster_
-000994a0: 6361 6c63 756c 6174 6564 203d 3d20 303a  calculated == 0:
-000994b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000994c0: 2020 7365 6c66 2e70 6167 6536 2e62 7574    self.page6.but
-000994d0: 746f 6e5f 6164 6463 6c73 7065 632e 7365  ton_addclspec.se
-000994e0: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
-000994f0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00099500: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00099510: 2020 2020 7365 6c66 2e70 6167 6536 2e62      self.page6.b
-00099520: 7574 746f 6e5f 6164 6463 6c73 7065 632e  utton_addclspec.
-00099530: 7365 7445 6e61 626c 6564 2854 7275 6529  setEnabled(True)
-00099540: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00099550: 6966 2073 656c 662e 636f 6d6d 6f6e 2e78  if self.common.x
-00099560: 7066 5f6c 6f61 6465 6420 3d3d 2031 3a0d  pf_loaded == 1:.
-00099570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00099580: 2073 656c 662e 7061 6765 362e 736c 6964   self.page6.slid
-00099590: 6572 5f73 7065 632e 7365 7445 6e61 626c  er_spec.setEnabl
-000995a0: 6564 2854 7275 6529 0d0a 2020 2020 2020  ed(True)..      
-000995b0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-000995c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000995d0: 662e 7061 6765 362e 736c 6964 6572 5f73  f.page6.slider_s
-000995e0: 7065 632e 7365 7445 6e61 626c 6564 2846  pec.setEnabled(F
-000995f0: 616c 7365 290d 0a0d 0a0d 0a0d 0a20 2020  alse)........   
-00099600: 2020 2020 2073 656c 662e 7061 6765 312e       self.page1.
-00099610: 5265 7365 7444 6973 706c 6179 5365 7474  ResetDisplaySett
-00099620: 696e 6773 2829 0d0a 0d0a 0d0a 0d0a 232d  ings()........#-
-00099630: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00099640: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00099650: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00099660: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00099670: 2d2d 2d2d 2d0d 0a20 2020 2064 6566 206e  -----..    def n
-00099680: 6577 5f73 7461 636b 5f72 6566 7265 7368  ew_stack_refresh
-00099690: 2873 656c 6629 3a0d 0a0d 0a0d 0a20 2020  (self):......   
-000996a0: 2020 2020 2073 656c 662e 636f 6d6d 6f6e       self.common
-000996b0: 2e69 305f 6c6f 6164 6564 203d 2030 0d0a  .i0_loaded = 0..
-000996c0: 2020 2020 2020 2020 7365 6c66 2e63 6f6d          self.com
-000996d0: 6d6f 6e2e 7063 615f 6361 6c63 756c 6174  mon.pca_calculat
-000996e0: 6564 203d 2030 0d0a 2020 2020 2020 2020  ed = 0..        
-000996f0: 7365 6c66 2e63 6f6d 6d6f 6e2e 636c 7573  self.common.clus
-00099700: 7465 725f 6361 6c63 756c 6174 6564 203d  ter_calculated =
-00099710: 2030 0d0a 2020 2020 2020 2020 7365 6c66   0..        self
-00099720: 2e63 6f6d 6d6f 6e2e 7370 6563 5f61 6e6c  .common.spec_anl
-00099730: 5f63 616c 6375 6c61 7465 6420 3d20 300d  _calculated = 0.
-00099740: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
-00099750: 6d6d 6f6e 2e78 7066 5f6c 6f61 6465 6420  mmon.xpf_loaded 
-00099760: 3d20 300d 0a20 2020 2020 2020 2073 656c  = 0..        sel
-00099770: 662e 636f 6d6d 6f6e 2e73 7461 636b 5f34  f.common.stack_4
-00099780: 6420 3d20 300d 0a20 2020 2020 2020 2073  d = 0..        s
-00099790: 656c 662e 636f 6d6d 6f6e 2e70 6361 3444  elf.common.pca4D
-000997a0: 5f63 616c 6375 6c61 7465 6420 3d20 300d  _calculated = 0.
-000997b0: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
-000997c0: 6d6d 6f6e 2e73 7065 635f 616e 6c34 445f  mmon.spec_anl4D_
-000997d0: 6361 6c63 756c 6174 6564 203d 2030 0d0a  calculated = 0..
-000997e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
-000997f0: 6566 7265 7368 5f77 6964 6765 7473 2829  efresh_widgets()
-00099800: 0d0a 0d0a 2020 2020 2020 2020 2370 6167  ....        #pag
-00099810: 6520 300d 0a20 2020 2020 2020 2073 656c  e 0..        sel
-00099820: 662e 7061 6765 302e 736c 6964 6572 5f74  f.page0.slider_t
-00099830: 6865 7461 2e73 6574 5669 7369 626c 6528  heta.setVisible(
-00099840: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-00099850: 2373 656c 662e 7061 6765 302e 7463 5f69  #self.page0.tc_i
-00099860: 6d61 6765 7468 6574 612e 7365 7456 6973  magetheta.setVis
-00099870: 6962 6c65 2846 616c 7365 290d 0a0d 0a20  ible(False).... 
-00099880: 2020 2020 2020 2023 7061 6765 2031 0d0a         #page 1..
-00099890: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
-000998a0: 6531 2e72 625f 666c 7578 2e73 6574 4368  e1.rb_flux.setCh
-000998b0: 6563 6b65 6428 5472 7565 290d 0a20 2020  ecked(True)..   
-000998c0: 2020 2020 2073 656c 662e 7061 6765 312e       self.page1.
-000998d0: 7262 5f6f 642e 7365 7443 6865 636b 6564  rb_od.setChecked
-000998e0: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
-000998f0: 2073 656c 662e 7061 6765 312e 7368 6f77   self.page1.show
-00099900: 666c 7578 203d 2054 7275 650d 0a0d 0a20  flux = True.... 
-00099910: 2020 2020 2020 2066 6967 203d 2073 656c         fig = sel
-00099920: 662e 7061 6765 312e 7370 6563 6669 670d  f.page1.specfig.
-00099930: 0a20 2020 2020 2020 2066 6967 2e63 6c66  .        fig.clf
-00099940: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
-00099950: 2e70 6167 6531 2e53 7065 6374 7275 6d50  .page1.SpectrumP
-00099960: 616e 656c 2e64 7261 7728 290d 0a20 2020  anel.draw()..   
-00099970: 2020 2020 2073 656c 662e 7061 6765 312e       self.page1.
-00099980: 7463 5f73 7065 632e 7365 7454 6578 7428  tc_spec.setText(
-00099990: 2253 7065 6374 7275 6d20 6174 2070 6f69  "Spectrum at poi
-000999a0: 6e74 3a20 2229 0d0a 0d0a 2020 2020 2020  nt: ")....      
-000999b0: 2020 6669 6720 3d20 7365 6c66 2e70 6167    fig = self.pag
-000999c0: 6531 2e61 6273 696d 6766 6967 0d0a 2020  e1.absimgfig..  
-000999d0: 2020 2020 2020 6669 672e 636c 6628 290d        fig.clf().
-000999e0: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
-000999f0: 6765 312e 4162 7349 6d61 6765 5061 6e65  ge1.AbsImagePane
-00099a00: 6c2e 6472 6177 2829 0d0a 2020 2020 2020  l.draw()..      
-00099a10: 2020 7365 6c66 2e70 6167 6531 2e74 635f    self.page1.tc_
-00099a20: 696d 6167 6565 6e67 2e73 6574 5465 7874  imageeng.setText
-00099a30: 2822 496d 6167 6520 6174 2065 6e65 7267  ("Image at energ
-00099a40: 793a 2022 290d 0a0d 0a20 2020 2020 2020  y: ")....       
-00099a50: 2073 656c 662e 7061 6765 312e 7465 7874   self.page1.text
-00099a60: 6374 726c 2e73 6574 5465 7874 2827 2027  ctrl.setText(' '
-00099a70: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-00099a80: 662e 7061 6765 312e 5265 7365 7452 4f49  f.page1.ResetROI
-00099a90: 2829 0d0a 0d0a 2020 2020 2020 2020 7365  ()....        se
-00099aa0: 6c66 2e70 6167 6531 2e52 6573 6574 4469  lf.page1.ResetDi
-00099ab0: 7370 6c61 7953 6574 7469 6e67 7328 290d  splaySettings().
-00099ac0: 0a20 2020 2020 2020 2023 7061 6765 2030  .        #page 0
-00099ad0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-00099ae0: 6167 6531 2e73 6c69 6465 725f 7468 6574  age1.slider_thet
-00099af0: 612e 7365 7456 6973 6962 6c65 2846 616c  a.setVisible(Fal
-00099b00: 7365 290d 0a20 2020 2020 2020 2073 656c  se)..        sel
-00099b10: 662e 7061 6765 312e 7463 5f69 6d61 6765  f.page1.tc_image
-00099b20: 7468 6574 612e 7365 7456 6973 6962 6c65  theta.setVisible
-00099b30: 2846 616c 7365 290d 0a0d 0a20 2020 2020  (False)....     
-00099b40: 2020 2023 7061 6765 2032 0d0a 2020 2020     #page 2..    
-00099b50: 2020 2020 6669 6720 3d20 7365 6c66 2e70      fig = self.p
-00099b60: 6167 6532 2e70 6361 6576 616c 7366 6967  age2.pcaevalsfig
-00099b70: 0d0a 2020 2020 2020 2020 6669 672e 636c  ..        fig.cl
-00099b80: 6628 290d 0a20 2020 2020 2020 2073 656c  f()..        sel
-00099b90: 662e 7061 6765 322e 5043 4145 7661 6c73  f.page2.PCAEvals
-00099ba0: 5061 6e2e 6472 6177 2829 0d0a 0d0a 2020  Pan.draw()....  
-00099bb0: 2020 2020 2020 6669 6720 3d20 7365 6c66        fig = self
-00099bc0: 2e70 6167 6532 2e70 6361 696d 6766 6967  .page2.pcaimgfig
-00099bd0: 0d0a 2020 2020 2020 2020 6669 672e 636c  ..        fig.cl
-00099be0: 6628 290d 0a20 2020 2020 2020 2073 656c  f()..        sel
-00099bf0: 662e 7061 6765 322e 5043 4149 6d61 6765  f.page2.PCAImage
-00099c00: 5061 6e2e 6472 6177 2829 0d0a 0d0a 2020  Pan.draw()....  
-00099c10: 2020 2020 2020 6669 6720 3d20 7365 6c66        fig = self
-00099c20: 2e70 6167 6532 2e70 6361 7370 6563 6669  .page2.pcaspecfi
-00099c30: 670d 0a20 2020 2020 2020 2066 6967 2e63  g..        fig.c
-00099c40: 6c66 2829 0d0a 2020 2020 2020 2020 7365  lf()..        se
-00099c50: 6c66 2e70 6167 6532 2e50 4341 5370 6563  lf.page2.PCASpec
-00099c60: 5061 6e2e 6472 6177 2829 0d0a 0d0a 2020  Pan.draw()....  
-00099c70: 2020 2020 2020 7365 6c66 2e70 6167 6532        self.page2
-00099c80: 2e76 6172 7463 2e73 6574 5465 7874 2827  .vartc.setText('
-00099c90: 3025 2729 0d0a 2020 2020 2020 2020 7365  0%')..        se
-00099ca0: 6c66 2e70 6167 6532 2e6e 7063 6173 7069  lf.page2.npcaspi
-00099cb0: 6e2e 7365 7456 616c 7565 2831 290d 0a20  n.setValue(1).. 
-00099cc0: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
-00099cd0: 322e 7463 5f50 4341 636f 6d70 2e73 6574  2.tc_PCAcomp.set
-00099ce0: 5465 7874 2822 5043 4120 636f 6d70 6f6e  Text("PCA compon
-00099cf0: 656e 7420 2229 0d0a 2020 2020 2020 2020  ent ")..        
-00099d00: 7365 6c66 2e70 6167 6532 2e74 6578 745f  self.page2.text_
-00099d10: 7063 6173 7065 632e 7365 7454 6578 7428  pcaspec.setText(
-00099d20: 2250 4341 2073 7065 6374 7275 6d20 2229  "PCA spectrum ")
-00099d30: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00099d40: 2e70 6167 6532 2e73 656c 7063 6120 3d20  .page2.selpca = 
-00099d50: 310d 0a20 2020 2020 2020 2073 656c 662e  1..        self.
-00099d60: 7061 6765 322e 6e75 6d73 6967 7063 6120  page2.numsigpca 
-00099d70: 3d20 320d 0a20 2020 2020 2020 2073 656c  = 2..        sel
-00099d80: 662e 7061 6765 322e 736c 6964 6572 7368  f.page2.slidersh
-00099d90: 6f77 2e73 6574 5661 6c75 6528 7365 6c66  ow.setValue(self
-00099da0: 2e70 6167 6532 2e73 656c 7063 6129 0d0a  .page2.selpca)..
-00099db0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-00099dc0: 6167 6532 2e73 6c69 6465 725f 7468 6574  age2.slider_thet
-00099dd0: 612e 7365 7456 6973 6962 6c65 2846 616c  a.setVisible(Fal
-00099de0: 7365 290d 0a20 2020 2020 2020 2073 656c  se)..        sel
-00099df0: 662e 7061 6765 322e 7463 5f69 6d61 6765  f.page2.tc_image
-00099e00: 7468 6574 612e 7365 7456 6973 6962 6c65  theta.setVisible
-00099e10: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
-00099e20: 2073 656c 662e 7061 6765 322e 6275 7474   self.page2.butt
-00099e30: 6f6e 5f63 616c 6370 6361 3444 2e73 6574  on_calcpca4D.set
-00099e40: 5669 7369 626c 6528 4661 6c73 6529 0d0a  Visible(False)..
-00099e50: 0d0a 2020 2020 2020 2020 2370 6167 6520  ..        #page 
-00099e60: 330d 0a20 2020 2020 2020 2066 6967 203d  3..        fig =
-00099e70: 2073 656c 662e 7061 6765 332e 636c 7573   self.page3.clus
-00099e80: 7465 7269 6d67 6669 670d 0a20 2020 2020  terimgfig..     
-00099e90: 2020 2066 6967 2e63 6c66 2829 0d0a 2020     fig.clf()..  
-00099ea0: 2020 2020 2020 7365 6c66 2e70 6167 6533        self.page3
-00099eb0: 2e43 6c75 7374 6572 496d 6167 6550 616e  .ClusterImagePan
-00099ec0: 2e64 7261 7728 290d 0a0d 0a20 2020 2020  .draw()....     
-00099ed0: 2020 2066 6967 203d 2073 656c 662e 7061     fig = self.pa
-00099ee0: 6765 332e 636c 7573 7465 7269 6e64 7669  ge3.clusterindvi
-00099ef0: 6d67 6669 670d 0a20 2020 2020 2020 2066  mgfig..        f
-00099f00: 6967 2e63 6c66 2829 0d0a 2020 2020 2020  ig.clf()..      
-00099f10: 2020 7365 6c66 2e70 6167 6533 2e43 6c75    self.page3.Clu
-00099f20: 7374 6572 496e 6476 496d 6167 6550 616e  sterIndvImagePan
-00099f30: 2e64 7261 7728 290d 0a0d 0a20 2020 2020  .draw()....     
-00099f40: 2020 2066 6967 203d 2073 656c 662e 7061     fig = self.pa
-00099f50: 6765 332e 636c 7573 7465 7273 7065 6366  ge3.clusterspecf
-00099f60: 6967 0d0a 2020 2020 2020 2020 6669 672e  ig..        fig.
-00099f70: 636c 6628 290d 0a20 2020 2020 2020 2073  clf()..        s
-00099f80: 656c 662e 7061 6765 332e 436c 7573 7465  elf.page3.Cluste
-00099f90: 7253 7065 6350 616e 2e64 7261 7728 290d  rSpecPan.draw().
-00099fa0: 0a0d 0a20 2020 2020 2020 2066 6967 203d  ...        fig =
-00099fb0: 2073 656c 662e 7061 6765 332e 636c 7573   self.page3.clus
-00099fc0: 7465 7264 6973 746d 6170 6669 670d 0a20  terdistmapfig.. 
-00099fd0: 2020 2020 2020 2066 6967 2e63 6c66 2829         fig.clf()
-00099fe0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-00099ff0: 6167 6533 2e43 6c75 7374 6572 4469 7374  age3.ClusterDist
-0009a000: 4d61 7050 616e 2e64 7261 7728 290d 0a0d  MapPan.draw()...
-0009a010: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
-0009a020: 6765 332e 7365 6c63 6c75 7374 6572 203d  ge3.selcluster =
-0009a030: 2031 0d0a 2020 2020 2020 2020 7365 6c66   1..        self
-0009a040: 2e70 6167 6533 2e73 6c69 6465 7273 686f  .page3.slidersho
-0009a050: 772e 7365 7456 616c 7565 2873 656c 662e  w.setValue(self.
-0009a060: 7061 6765 332e 7365 6c63 6c75 7374 6572  page3.selcluster
-0009a070: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0009a080: 7061 6765 332e 6e75 6d63 6c75 7374 6572  page3.numcluster
-0009a090: 7320 3d20 350d 0a20 2020 2020 2020 2073  s = 5..        s
-0009a0a0: 656c 662e 7061 6765 332e 6e63 6c75 7374  elf.page3.nclust
-0009a0b0: 6572 7370 696e 2e73 6574 5661 6c75 6528  erspin.setValue(
-0009a0c0: 7365 6c66 2e70 6167 6533 2e6e 756d 636c  self.page3.numcl
-0009a0d0: 7573 7465 7273 290d 0a20 2020 2020 2020  usters)..       
-0009a0e0: 2073 656c 662e 7061 6765 332e 7463 5f63   self.page3.tc_c
-0009a0f0: 6c75 7374 6572 2e73 6574 5465 7874 2822  luster.setText("
-0009a100: 436c 7573 7465 7220 2229 0d0a 2020 2020  Cluster ")..    
-0009a110: 2020 2020 7365 6c66 2e70 6167 6533 2e74      self.page3.t
-0009a120: 635f 636c 7573 7465 7273 702e 7365 7454  c_clustersp.setT
-0009a130: 6578 7428 2243 6c75 7374 6572 2073 7065  ext("Cluster spe
-0009a140: 6374 7275 6d22 290d 0a20 2020 2020 2020  ctrum")..       
-0009a150: 2073 656c 662e 7061 6765 332e 776f 5f31   self.page3.wo_1
-0009a160: 7374 5f70 6361 203d 2030 0d0a 2020 2020  st_pca = 0..    
-0009a170: 2020 2020 7365 6c66 2e70 6167 6533 2e72      self.page3.r
-0009a180: 656d 6f76 6531 7374 7063 6163 622e 7365  emove1stpcacb.se
-0009a190: 7443 6865 636b 6564 2846 616c 7365 290d  tChecked(False).
-0009a1a0: 0a0d 0a0d 0a20 2020 2020 2020 2023 7061  .....        #pa
-0009a1b0: 6765 2034 0d0a 2020 2020 2020 2020 7365  ge 4..        se
-0009a1c0: 6c66 2e70 6167 6534 2e43 6c65 6172 5769  lf.page4.ClearWi
-0009a1d0: 6467 6574 7328 290d 0a0d 0a20 2020 2020  dgets()....     
-0009a1e0: 2020 2023 7061 6765 2035 0d0a 2020 2020     #page 5..    
-0009a1f0: 2020 2020 6669 6720 3d20 7365 6c66 2e70      fig = self.p
-0009a200: 6167 6535 2e6b 6573 7065 6366 6967 0d0a  age5.kespecfig..
-0009a210: 2020 2020 2020 2020 6669 672e 636c 6628          fig.clf(
-0009a220: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0009a230: 7061 6765 352e 4b45 5370 6563 5061 6e2e  page5.KESpecPan.
-0009a240: 6472 6177 2829 0d0a 2020 2020 2020 2020  draw()..        
-0009a250: 6669 6720 3d20 7365 6c66 2e70 6167 6535  fig = self.page5
-0009a260: 2e61 6273 696d 6766 6967 0d0a 2020 2020  .absimgfig..    
-0009a270: 2020 2020 6669 672e 636c 6628 290d 0a20      fig.clf().. 
-0009a280: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
-0009a290: 352e 4162 7349 6d61 6765 5061 6e65 6c2e  5.AbsImagePanel.
-0009a2a0: 6472 6177 2829 0d0a 0d0a 0d0a 2020 2020  draw()......    
-0009a2b0: 2020 2020 2370 6167 6520 360d 0a20 2020      #page 6..   
-0009a2c0: 2020 2020 2069 6620 7365 6c66 2e70 6167       if self.pag
-0009a2d0: 6536 2021 3d20 4e6f 6e65 3a0d 0a20 2020  e6 != None:..   
-0009a2e0: 2020 2020 2020 2020 2066 6967 203d 2073           fig = s
-0009a2f0: 656c 662e 7061 6765 362e 5370 6563 6669  elf.page6.Specfi
-0009a300: 670d 0a20 2020 2020 2020 2020 2020 2066  g..            f
-0009a310: 6967 2e63 6c66 2829 0d0a 2020 2020 2020  ig.clf()..      
-0009a320: 2020 2020 2020 7365 6c66 2e70 6167 6536        self.page6
-0009a330: 2e53 7065 6374 7275 6d50 616e 656c 2e64  .SpectrumPanel.d
-0009a340: 7261 7728 290d 0a20 2020 2020 2020 2020  raw()..         
-0009a350: 2020 2073 656c 662e 7061 6765 362e 736c     self.page6.sl
-0009a360: 6964 6572 5f73 7065 632e 7365 7445 6e61  ider_spec.setEna
-0009a370: 626c 6564 2846 616c 7365 290d 0a0d 0a20  bled(False).... 
-0009a380: 2020 2020 2020 2023 7061 6765 380d 0a20         #page8.. 
-0009a390: 2020 2020 2020 2069 6620 7368 6f77 746f         if showto
-0009a3a0: 6d6f 7461 623a 0d0a 2020 2020 2020 2020  motab:..        
-0009a3b0: 2020 2020 7365 6c66 2e70 6167 6538 2e4e      self.page8.N
-0009a3c0: 6577 5374 6163 6b43 6c65 6172 2829 0d0a  ewStackClear()..
-0009a3d0: 0d0a 0d0a 2222 2220 2d2d 2d2d 2d2d 2d2d  ....""" --------
-0009a3e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0009a3f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0009a400: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0009a410: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0009a420: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0009a430: 2d2d 2d2d 2d2d 2d2d 2222 220d 0a64 6566  --------"""..def
-0009a440: 206d 6169 6e28 293a 0d0a 0d0a 2020 2020   main():....    
-0009a450: 6170 7020 3d20 5174 5769 6467 6574 732e  app = QtWidgets.
-0009a460: 5141 7070 6c69 6361 7469 6f6e 2873 7973  QApplication(sys
-0009a470: 2e61 7267 7629 0d0a 2020 2020 2370 7269  .argv)..    #pri
-0009a480: 6e74 2827 6d61 696e 272c 2074 6872 6561  nt('main', threa
-0009a490: 6469 6e67 2e67 6574 5f69 6465 6e74 2829  ding.get_ident()
-0009a4a0: 290d 0a20 2020 2077 6974 6820 6f70 656e  )..    with open
-0009a4b0: 2871 7373 7061 7468 2c20 2272 2229 2061  (qsspath, "r") a
-0009a4c0: 7320 7374 796c 6573 6865 6574 3a0d 0a20  s stylesheet:.. 
-0009a4d0: 2020 2020 2020 2061 7070 2e73 6574 5374         app.setSt
-0009a4e0: 796c 6553 6865 6574 2873 7479 6c65 7368  yleSheet(stylesh
-0009a4f0: 6565 742e 7265 6164 2829 290d 0a20 2020  eet.read())..   
-0009a500: 2066 7261 6d65 203d 204d 6169 6e46 7261   frame = MainFra
-0009a510: 6d65 2829 0d0a 2020 2020 7379 732e 6578  me()..    sys.ex
-0009a520: 6974 2861 7070 2e65 7865 635f 2829 290d  it(app.exec_()).
-0009a530: 0a0d 0a0d 0a69 6620 5f5f 6e61 6d65 5f5f  .....if __name__
-0009a540: 203d 3d20 275f 5f6d 6169 6e5f 5f27 3a0d   == '__main__':.
-0009a550: 0a20 2020 206d 6169 6e28 290d 0a         .    main()..
+00097eb0: 2e70 6167 6531 2e62 7574 746f 6e5f 6465  .page1.button_de
+00097ec0: 7370 696b 652e 7365 7445 6e61 626c 6564  spike.setEnabled
+00097ed0: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
+00097ee0: 2020 2020 2073 656c 662e 7061 6765 312e       self.page1.
+00097ef0: 6275 7474 6f6e 5f64 6973 706c 6179 636f  button_displayco
+00097f00: 6c6f 722e 7365 7445 6e61 626c 6564 2846  lor.setEnabled(F
+00097f10: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
+00097f20: 2020 2073 656c 662e 6163 7469 6f6e 5361     self.actionSa
+00097f30: 7665 2e73 6574 456e 6162 6c65 6428 4661  ve.setEnabled(Fa
+00097f40: 6c73 6529 0d0a 0d0a 2020 2020 2020 2020  lse)....        
+00097f50: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00097f60: 2020 2073 656c 662e 7061 6765 312e 6275     self.page1.bu
+00097f70: 7474 6f6e 5f69 3066 6669 6c65 2e73 6574  tton_i0ffile.set
+00097f80: 456e 6162 6c65 6428 5472 7565 290d 0a20  Enabled(True).. 
+00097f90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00097fa0: 7061 6765 312e 6275 7474 6f6e 5f69 3068  page1.button_i0h
+00097fb0: 6973 746f 6772 616d 2e73 6574 456e 6162  istogram.setEnab
+00097fc0: 6c65 6428 5472 7565 290d 0a20 2020 2020  led(True)..     
+00097fd0: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
+00097fe0: 312e 6275 7474 6f6e 5f61 7274 6566 6163  1.button_artefac
+00097ff0: 7473 2e73 6574 456e 6162 6c65 6428 5472  ts.setEnabled(Tr
+00098000: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
+00098010: 2073 656c 662e 7061 6765 312e 6275 7474   self.page1.butt
+00098020: 6f6e 5f70 7265 6e6f 726d 2e73 6574 456e  on_prenorm.setEn
+00098030: 6162 6c65 6428 5472 7565 290d 0a20 2020  abled(True)..   
+00098040: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
+00098050: 6765 312e 6275 7474 6f6e 5f6d 756c 7469  ge1.button_multi
+00098060: 6372 6f70 2e73 6574 456e 6162 6c65 6428  crop.setEnabled(
+00098070: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
+00098080: 2020 2023 7365 6c66 2e70 6167 6531 2e62     #self.page1.b
+00098090: 7574 746f 6e5f 6c69 6d69 7465 762e 7365  utton_limitev.se
+000980a0: 7445 6e61 626c 6564 2854 7275 6529 0d0a  tEnabled(True)..
+000980b0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000980c0: 656c 662e 636f 6d6d 6f6e 2e73 7461 636b  elf.common.stack
+000980d0: 5f34 6420 3d3d 2030 3a0d 0a20 2020 2020  _4d == 0:..     
+000980e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000980f0: 7061 6765 312e 6275 7474 6f6e 5f72 6566  page1.button_ref
+00098100: 696d 6773 2e73 6574 456e 6162 6c65 6428  imgs.setEnabled(
+00098110: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
+00098120: 2020 2020 2020 2023 7365 6c66 2e70 6167         #self.pag
+00098130: 6531 2e62 7574 746f 6e5f 7375 6272 6567  e1.button_subreg
+00098140: 696f 6e2e 7365 7445 6e61 626c 6564 2854  ion.setEnabled(T
+00098150: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
+00098160: 2020 2020 2020 7365 6c66 2e70 6167 6531        self.page1
+00098170: 2e62 7574 746f 6e5f 6461 726b 7369 672e  .button_darksig.
+00098180: 7365 7445 6e61 626c 6564 2854 7275 6529  setEnabled(True)
+00098190: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+000981a0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+000981b0: 2020 2020 2073 656c 662e 7061 6765 312e       self.page1.
+000981c0: 6275 7474 6f6e 5f72 6566 696d 6773 2e73  button_refimgs.s
+000981d0: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
+000981e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000981f0: 2020 2373 656c 662e 7061 6765 312e 6275    #self.page1.bu
+00098200: 7474 6f6e 5f73 7562 7265 6769 6f6e 2e73  tton_subregion.s
+00098210: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
+00098220: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00098230: 2020 7365 6c66 2e70 6167 6531 2e62 7574    self.page1.but
+00098240: 746f 6e5f 6461 726b 7369 672e 7365 7445  ton_darksig.setE
+00098250: 6e61 626c 6564 2846 616c 7365 290d 0a20  nabled(False).. 
+00098260: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00098270: 7061 6765 312e 6275 7474 6f6e 5f73 6176  page1.button_sav
+00098280: 652e 7365 7445 6e61 626c 6564 2854 7275  e.setEnabled(Tru
+00098290: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+000982a0: 7365 6c66 2e70 6167 6531 2e62 7574 746f  self.page1.butto
+000982b0: 6e5f 7361 7665 7374 6163 6b2e 7365 7445  n_savestack.setE
+000982c0: 6e61 626c 6564 2854 7275 6529 0d0a 2020  nabled(True)..  
+000982d0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+000982e0: 6167 6531 2e62 7574 746f 6e5f 616c 6967  age1.button_alig
+000982f0: 6e2e 7365 7445 6e61 626c 6564 2854 7275  n.setEnabled(Tru
+00098300: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00098310: 7365 6c66 2e70 6167 6531 2e62 7574 746f  self.page1.butto
+00098320: 6e5f 736c 6964 6573 686f 772e 7365 7445  n_slideshow.setE
+00098330: 6e61 626c 6564 2854 7275 6529 0d0a 2020  nabled(True)..  
+00098340: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00098350: 6167 6531 2e62 7574 746f 6e5f 6164 6452  age1.button_addR
+00098360: 4f49 2e73 6574 456e 6162 6c65 6428 5472  OI.setEnabled(Tr
+00098370: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
+00098380: 2073 656c 662e 7061 6765 312e 6275 7474   self.page1.butt
+00098390: 6f6e 5f73 7065 6374 7261 6c52 4f49 2e73  on_spectralROI.s
+000983a0: 6574 456e 6162 6c65 6428 5472 7565 290d  etEnabled(True).
+000983b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000983c0: 662e 7061 6765 312e 6275 7474 6f6e 5f72  f.page1.button_r
+000983d0: 6573 6574 6469 7370 6c61 792e 7365 7445  esetdisplay.setE
+000983e0: 6e61 626c 6564 2854 7275 6529 0d0a 2020  nabled(True)..  
+000983f0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00098400: 6167 6531 2e62 7574 746f 6e5f 6465 7370  age1.button_desp
+00098410: 696b 652e 7365 7445 6e61 626c 6564 2854  ike.setEnabled(T
+00098420: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
+00098430: 2020 7365 6c66 2e70 6167 6531 2e62 7574    self.page1.but
+00098440: 746f 6e5f 6469 7370 6c61 7963 6f6c 6f72  ton_displaycolor
+00098450: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
+00098460: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00098470: 656c 662e 6163 7469 6f6e 5361 7665 2e73  elf.actionSave.s
+00098480: 6574 456e 6162 6c65 6428 5472 7565 290d  etEnabled(True).
+00098490: 0a0d 0a0d 0a20 2020 2020 2020 2069 6620  .....        if 
+000984a0: 7365 6c66 2e63 6f6d 6d6f 6e2e 6930 5f6c  self.common.i0_l
+000984b0: 6f61 6465 6420 3d3d 2030 3a0d 0a20 2020  oaded == 0:..   
+000984c0: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
+000984d0: 6765 312e 6275 7474 6f6e 5f73 686f 7769  ge1.button_showi
+000984e0: 302e 7365 7445 6e61 626c 6564 2846 616c  0.setEnabled(Fal
+000984f0: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
+00098500: 2073 656c 662e 7061 6765 312e 7262 5f66   self.page1.rb_f
+00098510: 6c75 782e 7365 7445 6e61 626c 6564 2846  lux.setEnabled(F
+00098520: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
+00098530: 2020 2073 656c 662e 7061 6765 312e 7262     self.page1.rb
+00098540: 5f6f 642e 7365 7445 6e61 626c 6564 2846  _od.setEnabled(F
+00098550: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
+00098560: 2020 2073 656c 662e 7061 6765 312e 6275     self.page1.bu
+00098570: 7474 6f6e 5f72 6573 6574 6930 2e73 6574  tton_reseti0.set
+00098580: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
+00098590: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000985a0: 2e70 6167 6531 2e62 7574 746f 6e5f 7361  .page1.button_sa
+000985b0: 7665 6f64 2e73 6574 456e 6162 6c65 6428  veod.setEnabled(
+000985c0: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
+000985d0: 2020 2020 7365 6c66 2e70 6167 6532 2e62      self.page2.b
+000985e0: 7574 746f 6e5f 6361 6c63 7063 612e 7365  utton_calcpca.se
+000985f0: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
+00098600: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00098610: 662e 7061 6765 322e 6275 7474 6f6e 5f63  f.page2.button_c
+00098620: 616c 6370 6361 3444 2e73 6574 456e 6162  alcpca4D.setEnab
+00098630: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
+00098640: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
+00098650: 6534 2e62 7574 746f 6e5f 6c6f 6164 7473  e4.button_loadts
+00098660: 7065 632e 7365 7445 6e61 626c 6564 2846  pec.setEnabled(F
+00098670: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
+00098680: 2020 2073 656c 662e 7061 6765 342e 6275     self.page4.bu
+00098690: 7474 6f6e 5f61 6464 666c 6174 2e73 6574  tton_addflat.set
+000986a0: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
+000986b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000986c0: 2e70 6167 6535 2e62 7574 746f 6e5f 7361  .page5.button_sa
+000986d0: 7665 2e73 6574 456e 6162 6c65 6428 4661  ve.setEnabled(Fa
+000986e0: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
+000986f0: 2020 6966 2073 656c 662e 7061 6765 373a    if self.page7:
+00098700: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00098710: 2020 7365 6c66 2e70 6167 6537 2e62 7574    self.page7.but
+00098720: 746f 6e5f 6361 6c63 6e6e 6d61 2e73 6574  ton_calcnnma.set
+00098730: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
+00098740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00098750: 7365 6c66 2e70 6167 6537 2e62 7574 746f  self.page7.butto
+00098760: 6e5f 6d75 6669 6c65 2e73 6574 456e 6162  n_mufile.setEnab
+00098770: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
+00098780: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00098790: 2e70 6167 6537 2e62 7574 746f 6e5f 6d75  .page7.button_mu
+000987a0: 7261 6e64 2e73 6574 456e 6162 6c65 6428  rand.setEnabled(
+000987b0: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
+000987c0: 2020 2020 6966 2073 686f 7774 6f6d 6f74      if showtomot
+000987d0: 6162 3a0d 0a20 2020 2020 2020 2020 2020  ab:..           
+000987e0: 2020 2020 2073 656c 662e 7061 6765 382e       self.page8.
+000987f0: 6275 7474 6f6e 5f65 6e67 6461 7461 2e73  button_engdata.s
+00098800: 6574 456e 6162 6c65 6428 4661 6c73 6529  etEnabled(False)
+00098810: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00098820: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00098830: 662e 7061 6765 312e 6275 7474 6f6e 5f73  f.page1.button_s
+00098840: 686f 7769 302e 7365 7445 6e61 626c 6564  howi0.setEnabled
+00098850: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
+00098860: 2020 2020 7365 6c66 2e70 6167 6531 2e72      self.page1.r
+00098870: 625f 666c 7578 2e73 6574 456e 6162 6c65  b_flux.setEnable
+00098880: 6428 5472 7565 290d 0a20 2020 2020 2020  d(True)..       
+00098890: 2020 2020 2073 656c 662e 7061 6765 312e       self.page1.
+000988a0: 7262 5f6f 642e 7365 7445 6e61 626c 6564  rb_od.setEnabled
+000988b0: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
+000988c0: 2020 2020 7365 6c66 2e70 6167 6531 2e62      self.page1.b
+000988d0: 7574 746f 6e5f 7265 7365 7469 302e 7365  utton_reseti0.se
+000988e0: 7445 6e61 626c 6564 2854 7275 6529 0d0a  tEnabled(True)..
+000988f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00098900: 2e70 6167 6531 2e62 7574 746f 6e5f 7361  .page1.button_sa
+00098910: 7665 6f64 2e73 6574 456e 6162 6c65 6428  veod.setEnabled(
+00098920: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
+00098930: 2020 2073 656c 662e 7061 6765 322e 6275     self.page2.bu
+00098940: 7474 6f6e 5f63 616c 6370 6361 2e73 6574  tton_calcpca.set
+00098950: 456e 6162 6c65 6428 5472 7565 290d 0a20  Enabled(True).. 
+00098960: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00098970: 7061 6765 322e 6275 7474 6f6e 5f63 616c  page2.button_cal
+00098980: 6370 6361 3444 2e73 6574 456e 6162 6c65  cpca4D.setEnable
+00098990: 6428 5472 7565 290d 0a20 2020 2020 2020  d(True)..       
+000989a0: 2020 2020 2073 656c 662e 7061 6765 342e       self.page4.
+000989b0: 6275 7474 6f6e 5f6c 6f61 6474 7370 6563  button_loadtspec
+000989c0: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
+000989d0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+000989e0: 656c 662e 7061 6765 342e 6275 7474 6f6e  elf.page4.button
+000989f0: 5f61 6464 666c 6174 2e73 6574 456e 6162  _addflat.setEnab
+00098a00: 6c65 6428 5472 7565 290d 0a20 2020 2020  led(True)..     
+00098a10: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
+00098a20: 352e 6275 7474 6f6e 5f73 6176 652e 7365  5.button_save.se
+00098a30: 7445 6e61 626c 6564 2854 7275 6529 0d0a  tEnabled(True)..
+00098a40: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00098a50: 656c 662e 7061 6765 373a 0d0a 2020 2020  elf.page7:..    
+00098a60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00098a70: 2e70 6167 6537 2e62 7574 746f 6e5f 6361  .page7.button_ca
+00098a80: 6c63 6e6e 6d61 2e73 6574 456e 6162 6c65  lcnnma.setEnable
+00098a90: 6428 5472 7565 290d 0a20 2020 2020 2020  d(True)..       
+00098aa0: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
+00098ab0: 6765 372e 6275 7474 6f6e 5f6d 7566 696c  ge7.button_mufil
+00098ac0: 652e 7365 7445 6e61 626c 6564 2854 7275  e.setEnabled(Tru
+00098ad0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00098ae0: 2020 2020 7365 6c66 2e70 6167 6537 2e62      self.page7.b
+00098af0: 7574 746f 6e5f 6d75 7261 6e64 2e73 6574  utton_murand.set
+00098b00: 456e 6162 6c65 6428 5472 7565 290d 0a20  Enabled(True).. 
+00098b10: 2020 2020 2020 2020 2020 2069 6620 7368             if sh
+00098b20: 6f77 746f 6d6f 7461 623a 0d0a 2020 2020  owtomotab:..    
+00098b30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00098b40: 2e70 6167 6538 2e62 7574 746f 6e5f 656e  .page8.button_en
+00098b50: 6764 6174 612e 7365 7445 6e61 626c 6564  gdata.setEnabled
+00098b60: 2854 7275 6529 0d0a 0d0a 2020 2020 2020  (True)....      
+00098b70: 2020 6966 2073 656c 662e 636f 6d6d 6f6e    if self.common
+00098b80: 2e70 6361 5f63 616c 6375 6c61 7465 6420  .pca_calculated 
+00098b90: 3d3d 2030 3a0d 0a20 2020 2020 2020 2020  == 0:..         
+00098ba0: 2020 2073 656c 662e 7061 6765 322e 6275     self.page2.bu
+00098bb0: 7474 6f6e 5f73 6176 6570 6361 2e73 6574  tton_savepca.set
+00098bc0: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
+00098bd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00098be0: 2e70 6167 6532 2e73 6c69 6465 7273 686f  .page2.slidersho
+00098bf0: 772e 7365 7445 6e61 626c 6564 2846 616c  w.setEnabled(Fal
+00098c00: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
+00098c10: 2073 656c 662e 7061 6765 322e 6275 7474   self.page2.butt
+00098c20: 6f6e 5f6d 6f76 6570 6375 702e 7365 7445  on_movepcup.setE
+00098c30: 6e61 626c 6564 2846 616c 7365 290d 0a20  nabled(False).. 
+00098c40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00098c50: 7061 6765 332e 6275 7474 6f6e 5f63 616c  page3.button_cal
+00098c60: 6363 612e 7365 7445 6e61 626c 6564 2846  cca.setEnabled(F
+00098c70: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
+00098c80: 2020 2073 656c 662e 7061 6765 342e 7262     self.page4.rb
+00098c90: 5f66 6974 2e73 6574 456e 6162 6c65 6428  _fit.setEnabled(
+00098ca0: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
+00098cb0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00098cc0: 2020 2073 656c 662e 7061 6765 322e 6275     self.page2.bu
+00098cd0: 7474 6f6e 5f73 6176 6570 6361 2e73 6574  tton_savepca.set
+00098ce0: 456e 6162 6c65 6428 5472 7565 290d 0a20  Enabled(True).. 
+00098cf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00098d00: 7061 6765 322e 736c 6964 6572 7368 6f77  page2.slidershow
+00098d10: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
+00098d20: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00098d30: 656c 662e 7061 6765 322e 6275 7474 6f6e  elf.page2.button
+00098d40: 5f6d 6f76 6570 6375 702e 7365 7445 6e61  _movepcup.setEna
+00098d50: 626c 6564 2854 7275 6529 0d0a 2020 2020  bled(True)..    
+00098d60: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
+00098d70: 6533 2e62 7574 746f 6e5f 6361 6c63 6361  e3.button_calcca
+00098d80: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
+00098d90: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00098da0: 656c 662e 7061 6765 342e 7262 5f66 6974  elf.page4.rb_fit
+00098db0: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
+00098dc0: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
+00098dd0: 7365 6c66 2e63 6f6d 6d6f 6e2e 636c 7573  self.common.clus
+00098de0: 7465 725f 6361 6c63 756c 6174 6564 203d  ter_calculated =
+00098df0: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
+00098e00: 2020 7365 6c66 2e70 6167 6533 2e62 7574    self.page3.but
+00098e10: 746f 6e5f 7363 6174 7465 7270 6c6f 7473  ton_scatterplots
+00098e20: 2e73 6574 456e 6162 6c65 6428 4661 6c73  .setEnabled(Fals
+00098e30: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00098e40: 7365 6c66 2e70 6167 6533 2e62 7574 746f  self.page3.butto
+00098e50: 6e5f 7361 7665 636c 7573 7465 722e 7365  n_savecluster.se
+00098e60: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
+00098e70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00098e80: 662e 7061 6765 332e 736c 6964 6572 7368  f.page3.slidersh
+00098e90: 6f77 2e73 6574 456e 6162 6c65 6428 4661  ow.setEnabled(Fa
+00098ea0: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
+00098eb0: 2020 7365 6c66 2e70 6167 6534 2e62 7574    self.page4.but
+00098ec0: 746f 6e5f 6164 6463 6c73 7065 632e 7365  ton_addclspec.se
+00098ed0: 7445 6e61 626c 6564 2846 616c 7365 290d  tEnabled(False).
+00098ee0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00098ef0: 662e 7061 6765 352e 6275 7474 6f6e 5f61  f.page5.button_a
+00098f00: 6464 636c 7370 6563 2e73 6574 456e 6162  ddclspec.setEnab
+00098f10: 6c65 6428 4661 6c73 6529 0d0a 2020 2020  led(False)..    
+00098f20: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00098f30: 7061 6765 373a 0d0a 2020 2020 2020 2020  page7:..        
+00098f40: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
+00098f50: 6537 2e62 7574 746f 6e5f 6d75 636c 7573  e7.button_muclus
+00098f60: 7465 722e 7365 7445 6e61 626c 6564 2846  ter.setEnabled(F
+00098f70: 616c 7365 290d 0a20 2020 2020 2020 2065  alse)..        e
+00098f80: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00098f90: 2020 7365 6c66 2e70 6167 6533 2e62 7574    self.page3.but
+00098fa0: 746f 6e5f 7363 6174 7465 7270 6c6f 7473  ton_scatterplots
+00098fb0: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
+00098fc0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00098fd0: 656c 662e 7061 6765 332e 6275 7474 6f6e  elf.page3.button
+00098fe0: 5f73 6176 6563 6c75 7374 6572 2e73 6574  _savecluster.set
+00098ff0: 456e 6162 6c65 6428 5472 7565 290d 0a20  Enabled(True).. 
+00099000: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00099010: 7061 6765 332e 736c 6964 6572 7368 6f77  page3.slidershow
+00099020: 2e73 6574 456e 6162 6c65 6428 5472 7565  .setEnabled(True
+00099030: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00099040: 656c 662e 7061 6765 342e 6275 7474 6f6e  elf.page4.button
+00099050: 5f61 6464 636c 7370 6563 2e73 6574 456e  _addclspec.setEn
+00099060: 6162 6c65 6428 5472 7565 290d 0a20 2020  abled(True)..   
+00099070: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
+00099080: 6765 352e 6275 7474 6f6e 5f61 6464 636c  ge5.button_addcl
+00099090: 7370 6563 2e73 6574 456e 6162 6c65 6428  spec.setEnabled(
+000990a0: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
+000990b0: 2020 2069 6620 7365 6c66 2e70 6167 6537     if self.page7
+000990c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000990d0: 2020 2073 656c 662e 7061 6765 372e 6275     self.page7.bu
+000990e0: 7474 6f6e 5f6d 7563 6c75 7374 6572 2e73  tton_mucluster.s
+000990f0: 6574 456e 6162 6c65 6428 5472 7565 290d  etEnabled(True).
+00099100: 0a0d 0a0d 0a20 2020 2020 2020 2069 6620  .....        if 
+00099110: 7365 6c66 2e63 6f6d 6d6f 6e2e 7370 6563  self.common.spec
+00099120: 5f61 6e6c 5f63 616c 6375 6c61 7465 6420  _anl_calculated 
+00099130: 3d3d 2030 3a0d 0a20 2020 2020 2020 2020  == 0:..         
+00099140: 2020 2073 656c 662e 7061 6765 342e 6275     self.page4.bu
+00099150: 7474 6f6e 5f72 656d 6f76 6573 7065 632e  tton_removespec.
+00099160: 7365 7445 6e61 626c 6564 2846 616c 7365  setEnabled(False
+00099170: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00099180: 656c 662e 7061 6765 342e 6275 7474 6f6e  elf.page4.button
+00099190: 5f6d 6f76 6573 7064 6f77 6e2e 7365 7445  _movespdown.setE
+000991a0: 6e61 626c 6564 2846 616c 7365 290d 0a20  nabled(False).. 
+000991b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000991c0: 7061 6765 342e 6275 7474 6f6e 5f6d 6f76  page4.button_mov
+000991d0: 6573 7075 702e 7365 7445 6e61 626c 6564  espup.setEnabled
+000991e0: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
+000991f0: 2020 2020 2073 656c 662e 7061 6765 342e       self.page4.
+00099200: 6275 7474 6f6e 5f73 6176 652e 7365 7445  button_save.setE
+00099210: 6e61 626c 6564 2846 616c 7365 290d 0a20  nabled(False).. 
+00099220: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00099230: 7061 6765 342e 6275 7474 6f6e 5f73 686f  page4.button_sho
+00099240: 7772 6762 2e73 6574 456e 6162 6c65 6428  wrgb.setEnabled(
+00099250: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
+00099260: 2020 2020 7365 6c66 2e70 6167 6534 2e62      self.page4.b
+00099270: 7574 746f 6e5f 6869 7374 6f67 7261 6d2e  utton_histogram.
+00099280: 7365 7445 6e61 626c 6564 2846 616c 7365  setEnabled(False
+00099290: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+000992a0: 656c 662e 7061 6765 342e 6275 7474 6f6e  elf.page4.button
+000992b0: 5f63 616c 6334 642e 7365 7445 6e61 626c  _calc4d.setEnabl
+000992c0: 6564 2846 616c 7365 290d 0a0d 0a20 2020  ed(False)....   
+000992d0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+000992e0: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
+000992f0: 6534 2e62 7574 746f 6e5f 7265 6d6f 7665  e4.button_remove
+00099300: 7370 6563 2e73 6574 456e 6162 6c65 6428  spec.setEnabled(
+00099310: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
+00099320: 2020 2073 656c 662e 7061 6765 342e 6275     self.page4.bu
+00099330: 7474 6f6e 5f6d 6f76 6573 7064 6f77 6e2e  tton_movespdown.
+00099340: 7365 7445 6e61 626c 6564 2854 7275 6529  setEnabled(True)
+00099350: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00099360: 6c66 2e70 6167 6534 2e62 7574 746f 6e5f  lf.page4.button_
+00099370: 6d6f 7665 7370 7570 2e73 6574 456e 6162  movespup.setEnab
+00099380: 6c65 6428 5472 7565 290d 0a20 2020 2020  led(True)..     
+00099390: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
+000993a0: 342e 6275 7474 6f6e 5f73 6176 652e 7365  4.button_save.se
+000993b0: 7445 6e61 626c 6564 2854 7275 6529 0d0a  tEnabled(True)..
+000993c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000993d0: 2e70 6167 6534 2e62 7574 746f 6e5f 7368  .page4.button_sh
+000993e0: 6f77 7267 622e 7365 7445 6e61 626c 6564  owrgb.setEnabled
+000993f0: 2854 7275 6529 0d0a 2020 2020 2020 2020  (True)..        
+00099400: 2020 2020 7365 6c66 2e70 6167 6534 2e62      self.page4.b
+00099410: 7574 746f 6e5f 6869 7374 6f67 7261 6d2e  utton_histogram.
+00099420: 7365 7445 6e61 626c 6564 2854 7275 6529  setEnabled(True)
+00099430: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00099440: 6c66 2e70 6167 6534 2e62 7574 746f 6e5f  lf.page4.button_
+00099450: 6361 6c63 3464 2e73 6574 456e 6162 6c65  calc4d.setEnable
+00099460: 6428 5472 7565 290d 0a0d 0a0d 0a20 2020  d(True)......   
+00099470: 2020 2020 2069 6620 7368 6f77 746f 6d6f       if showtomo
+00099480: 7461 623a 0d0a 2020 2020 2020 2020 2020  tab:..          
+00099490: 2020 6966 2073 656c 662e 636f 6d6d 6f6e    if self.common
+000994a0: 2e73 7065 635f 616e 6c34 445f 6361 6c63  .spec_anl4D_calc
+000994b0: 756c 6174 6564 203d 3d20 303a 0d0a 2020  ulated == 0:..  
+000994c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000994d0: 6c66 2e70 6167 6538 2e62 7574 746f 6e5f  lf.page8.button_
+000994e0: 7370 636f 6d70 2e73 6574 456e 6162 6c65  spcomp.setEnable
+000994f0: 6428 4661 6c73 6529 0d0a 2020 2020 2020  d(False)..      
+00099500: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00099510: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00099520: 662e 7061 6765 382e 6275 7474 6f6e 5f73  f.page8.button_s
+00099530: 7063 6f6d 702e 7365 7445 6e61 626c 6564  pcomp.setEnabled
+00099540: 2854 7275 6529 0d0a 0d0a 0d0a 2020 2020  (True)......    
+00099550: 2020 2020 6966 2073 656c 662e 7061 6765      if self.page
+00099560: 3620 213d 204e 6f6e 653a 0d0a 2020 2020  6 != None:..    
+00099570: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00099580: 636f 6d6d 6f6e 2e63 6c75 7374 6572 5f63  common.cluster_c
+00099590: 616c 6375 6c61 7465 6420 3d3d 2030 3a0d  alculated == 0:.
+000995a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000995b0: 2073 656c 662e 7061 6765 362e 6275 7474   self.page6.butt
+000995c0: 6f6e 5f61 6464 636c 7370 6563 2e73 6574  on_addclspec.set
+000995d0: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
+000995e0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000995f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00099600: 2020 2073 656c 662e 7061 6765 362e 6275     self.page6.bu
+00099610: 7474 6f6e 5f61 6464 636c 7370 6563 2e73  tton_addclspec.s
+00099620: 6574 456e 6162 6c65 6428 5472 7565 290d  etEnabled(True).
+00099630: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+00099640: 6620 7365 6c66 2e63 6f6d 6d6f 6e2e 7870  f self.common.xp
+00099650: 665f 6c6f 6164 6564 203d 3d20 313a 0d0a  f_loaded == 1:..
+00099660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00099670: 7365 6c66 2e70 6167 6536 2e73 6c69 6465  self.page6.slide
+00099680: 725f 7370 6563 2e73 6574 456e 6162 6c65  r_spec.setEnable
+00099690: 6428 5472 7565 290d 0a20 2020 2020 2020  d(True)..       
+000996a0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+000996b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000996c0: 2e70 6167 6536 2e73 6c69 6465 725f 7370  .page6.slider_sp
+000996d0: 6563 2e73 6574 456e 6162 6c65 6428 4661  ec.setEnabled(Fa
+000996e0: 6c73 6529 0d0a 0d0a 0d0a 0d0a 2020 2020  lse)........    
+000996f0: 2020 2020 7365 6c66 2e70 6167 6531 2e52      self.page1.R
+00099700: 6573 6574 4469 7370 6c61 7953 6574 7469  esetDisplaySetti
+00099710: 6e67 7328 290d 0a0d 0a0d 0a0d 0a23 2d2d  ngs()........#--
+00099720: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00099730: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00099740: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00099750: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00099760: 2d2d 2d2d 0d0a 2020 2020 6465 6620 6e65  ----..    def ne
+00099770: 775f 7374 6163 6b5f 7265 6672 6573 6828  w_stack_refresh(
+00099780: 7365 6c66 293a 0d0a 0d0a 0d0a 2020 2020  self):......    
+00099790: 2020 2020 7365 6c66 2e63 6f6d 6d6f 6e2e      self.common.
+000997a0: 6930 5f6c 6f61 6465 6420 3d20 300d 0a20  i0_loaded = 0.. 
+000997b0: 2020 2020 2020 2073 656c 662e 636f 6d6d         self.comm
+000997c0: 6f6e 2e70 6361 5f63 616c 6375 6c61 7465  on.pca_calculate
+000997d0: 6420 3d20 300d 0a20 2020 2020 2020 2073  d = 0..        s
+000997e0: 656c 662e 636f 6d6d 6f6e 2e63 6c75 7374  elf.common.clust
+000997f0: 6572 5f63 616c 6375 6c61 7465 6420 3d20  er_calculated = 
+00099800: 300d 0a20 2020 2020 2020 2073 656c 662e  0..        self.
+00099810: 636f 6d6d 6f6e 2e73 7065 635f 616e 6c5f  common.spec_anl_
+00099820: 6361 6c63 756c 6174 6564 203d 2030 0d0a  calculated = 0..
+00099830: 2020 2020 2020 2020 7365 6c66 2e63 6f6d          self.com
+00099840: 6d6f 6e2e 7870 665f 6c6f 6164 6564 203d  mon.xpf_loaded =
+00099850: 2030 0d0a 2020 2020 2020 2020 7365 6c66   0..        self
+00099860: 2e63 6f6d 6d6f 6e2e 7374 6163 6b5f 3464  .common.stack_4d
+00099870: 203d 2030 0d0a 2020 2020 2020 2020 7365   = 0..        se
+00099880: 6c66 2e63 6f6d 6d6f 6e2e 7063 6134 445f  lf.common.pca4D_
+00099890: 6361 6c63 756c 6174 6564 203d 2030 0d0a  calculated = 0..
+000998a0: 2020 2020 2020 2020 7365 6c66 2e63 6f6d          self.com
+000998b0: 6d6f 6e2e 7370 6563 5f61 6e6c 3444 5f63  mon.spec_anl4D_c
+000998c0: 616c 6375 6c61 7465 6420 3d20 300d 0a0d  alculated = 0...
+000998d0: 0a20 2020 2020 2020 2073 656c 662e 7265  .        self.re
+000998e0: 6672 6573 685f 7769 6467 6574 7328 290d  fresh_widgets().
+000998f0: 0a0d 0a20 2020 2020 2020 2023 7061 6765  ...        #page
+00099900: 2030 0d0a 2020 2020 2020 2020 7365 6c66   0..        self
+00099910: 2e70 6167 6530 2e73 6c69 6465 725f 7468  .page0.slider_th
+00099920: 6574 612e 7365 7456 6973 6962 6c65 2846  eta.setVisible(F
+00099930: 616c 7365 290d 0a20 2020 2020 2020 2023  alse)..        #
+00099940: 7365 6c66 2e70 6167 6530 2e74 635f 696d  self.page0.tc_im
+00099950: 6167 6574 6865 7461 2e73 6574 5669 7369  agetheta.setVisi
+00099960: 626c 6528 4661 6c73 6529 0d0a 0d0a 2020  ble(False)....  
+00099970: 2020 2020 2020 2370 6167 6520 310d 0a20        #page 1.. 
+00099980: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
+00099990: 312e 7262 5f66 6c75 782e 7365 7443 6865  1.rb_flux.setChe
+000999a0: 636b 6564 2854 7275 6529 0d0a 2020 2020  cked(True)..    
+000999b0: 2020 2020 7365 6c66 2e70 6167 6531 2e72      self.page1.r
+000999c0: 625f 6f64 2e73 6574 4368 6563 6b65 6428  b_od.setChecked(
+000999d0: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
+000999e0: 7365 6c66 2e70 6167 6531 2e73 686f 7766  self.page1.showf
+000999f0: 6c75 7820 3d20 5472 7565 0d0a 0d0a 2020  lux = True....  
+00099a00: 2020 2020 2020 6669 6720 3d20 7365 6c66        fig = self
+00099a10: 2e70 6167 6531 2e73 7065 6366 6967 0d0a  .page1.specfig..
+00099a20: 2020 2020 2020 2020 6669 672e 636c 6628          fig.clf(
+00099a30: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00099a40: 7061 6765 312e 5370 6563 7472 756d 5061  page1.SpectrumPa
+00099a50: 6e65 6c2e 6472 6177 2829 0d0a 2020 2020  nel.draw()..    
+00099a60: 2020 2020 7365 6c66 2e70 6167 6531 2e74      self.page1.t
+00099a70: 635f 7370 6563 2e73 6574 5465 7874 2822  c_spec.setText("
+00099a80: 5370 6563 7472 756d 2061 7420 706f 696e  Spectrum at poin
+00099a90: 743a 2022 290d 0a0d 0a20 2020 2020 2020  t: ")....       
+00099aa0: 2066 6967 203d 2073 656c 662e 7061 6765   fig = self.page
+00099ab0: 312e 6162 7369 6d67 6669 670d 0a20 2020  1.absimgfig..   
+00099ac0: 2020 2020 2066 6967 2e63 6c66 2829 0d0a       fig.clf()..
+00099ad0: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
+00099ae0: 6531 2e41 6273 496d 6167 6550 616e 656c  e1.AbsImagePanel
+00099af0: 2e64 7261 7728 290d 0a20 2020 2020 2020  .draw()..       
+00099b00: 2073 656c 662e 7061 6765 312e 7463 5f69   self.page1.tc_i
+00099b10: 6d61 6765 656e 672e 7365 7454 6578 7428  mageeng.setText(
+00099b20: 2249 6d61 6765 2061 7420 656e 6572 6779  "Image at energy
+00099b30: 3a20 2229 0d0a 0d0a 2020 2020 2020 2020  : ")....        
+00099b40: 7365 6c66 2e70 6167 6531 2e74 6578 7463  self.page1.textc
+00099b50: 7472 6c2e 7365 7454 6578 7428 2720 2729  trl.setText(' ')
+00099b60: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00099b70: 2e70 6167 6531 2e52 6573 6574 524f 4928  .page1.ResetROI(
+00099b80: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+00099b90: 662e 7061 6765 312e 5265 7365 7444 6973  f.page1.ResetDis
+00099ba0: 706c 6179 5365 7474 696e 6773 2829 0d0a  playSettings()..
+00099bb0: 2020 2020 2020 2020 2370 6167 6520 300d          #page 0.
+00099bc0: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+00099bd0: 6765 312e 736c 6964 6572 5f74 6865 7461  ge1.slider_theta
+00099be0: 2e73 6574 5669 7369 626c 6528 4661 6c73  .setVisible(Fals
+00099bf0: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
+00099c00: 2e70 6167 6531 2e74 635f 696d 6167 6574  .page1.tc_imaget
+00099c10: 6865 7461 2e73 6574 5669 7369 626c 6528  heta.setVisible(
+00099c20: 4661 6c73 6529 0d0a 0d0a 2020 2020 2020  False)....      
+00099c30: 2020 2370 6167 6520 320d 0a20 2020 2020    #page 2..     
+00099c40: 2020 2066 6967 203d 2073 656c 662e 7061     fig = self.pa
+00099c50: 6765 322e 7063 6165 7661 6c73 6669 670d  ge2.pcaevalsfig.
+00099c60: 0a20 2020 2020 2020 2066 6967 2e63 6c66  .        fig.clf
+00099c70: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+00099c80: 2e70 6167 6532 2e50 4341 4576 616c 7350  .page2.PCAEvalsP
+00099c90: 616e 2e64 7261 7728 290d 0a0d 0a20 2020  an.draw()....   
+00099ca0: 2020 2020 2066 6967 203d 2073 656c 662e       fig = self.
+00099cb0: 7061 6765 322e 7063 6169 6d67 6669 670d  page2.pcaimgfig.
+00099cc0: 0a20 2020 2020 2020 2066 6967 2e63 6c66  .        fig.clf
+00099cd0: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+00099ce0: 2e70 6167 6532 2e50 4341 496d 6167 6550  .page2.PCAImageP
+00099cf0: 616e 2e64 7261 7728 290d 0a0d 0a20 2020  an.draw()....   
+00099d00: 2020 2020 2066 6967 203d 2073 656c 662e       fig = self.
+00099d10: 7061 6765 322e 7063 6173 7065 6366 6967  page2.pcaspecfig
+00099d20: 0d0a 2020 2020 2020 2020 6669 672e 636c  ..        fig.cl
+00099d30: 6628 290d 0a20 2020 2020 2020 2073 656c  f()..        sel
+00099d40: 662e 7061 6765 322e 5043 4153 7065 6350  f.page2.PCASpecP
+00099d50: 616e 2e64 7261 7728 290d 0a0d 0a20 2020  an.draw()....   
+00099d60: 2020 2020 2073 656c 662e 7061 6765 322e       self.page2.
+00099d70: 7661 7274 632e 7365 7454 6578 7428 2730  vartc.setText('0
+00099d80: 2527 290d 0a20 2020 2020 2020 2073 656c  %')..        sel
+00099d90: 662e 7061 6765 322e 6e70 6361 7370 696e  f.page2.npcaspin
+00099da0: 2e73 6574 5661 6c75 6528 3129 0d0a 2020  .setValue(1)..  
+00099db0: 2020 2020 2020 7365 6c66 2e70 6167 6532        self.page2
+00099dc0: 2e74 635f 5043 4163 6f6d 702e 7365 7454  .tc_PCAcomp.setT
+00099dd0: 6578 7428 2250 4341 2063 6f6d 706f 6e65  ext("PCA compone
+00099de0: 6e74 2022 290d 0a20 2020 2020 2020 2073  nt ")..        s
+00099df0: 656c 662e 7061 6765 322e 7465 7874 5f70  elf.page2.text_p
+00099e00: 6361 7370 6563 2e73 6574 5465 7874 2822  caspec.setText("
+00099e10: 5043 4120 7370 6563 7472 756d 2022 290d  PCA spectrum ").
+00099e20: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00099e30: 7061 6765 322e 7365 6c70 6361 203d 2031  page2.selpca = 1
+00099e40: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00099e50: 6167 6532 2e6e 756d 7369 6770 6361 203d  age2.numsigpca =
+00099e60: 2032 0d0a 2020 2020 2020 2020 7365 6c66   2..        self
+00099e70: 2e70 6167 6532 2e73 6c69 6465 7273 686f  .page2.slidersho
+00099e80: 772e 7365 7456 616c 7565 2873 656c 662e  w.setValue(self.
+00099e90: 7061 6765 322e 7365 6c70 6361 290d 0a0d  page2.selpca)...
+00099ea0: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+00099eb0: 6765 322e 736c 6964 6572 5f74 6865 7461  ge2.slider_theta
+00099ec0: 2e73 6574 5669 7369 626c 6528 4661 6c73  .setVisible(Fals
+00099ed0: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
+00099ee0: 2e70 6167 6532 2e74 635f 696d 6167 6574  .page2.tc_imaget
+00099ef0: 6865 7461 2e73 6574 5669 7369 626c 6528  heta.setVisible(
+00099f00: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
+00099f10: 7365 6c66 2e70 6167 6532 2e62 7574 746f  self.page2.butto
+00099f20: 6e5f 6361 6c63 7063 6134 442e 7365 7456  n_calcpca4D.setV
+00099f30: 6973 6962 6c65 2846 616c 7365 290d 0a0d  isible(False)...
+00099f40: 0a20 2020 2020 2020 2023 7061 6765 2033  .        #page 3
+00099f50: 0d0a 2020 2020 2020 2020 6669 6720 3d20  ..        fig = 
+00099f60: 7365 6c66 2e70 6167 6533 2e63 6c75 7374  self.page3.clust
+00099f70: 6572 696d 6766 6967 0d0a 2020 2020 2020  erimgfig..      
+00099f80: 2020 6669 672e 636c 6628 290d 0a20 2020    fig.clf()..   
+00099f90: 2020 2020 2073 656c 662e 7061 6765 332e       self.page3.
+00099fa0: 436c 7573 7465 7249 6d61 6765 5061 6e2e  ClusterImagePan.
+00099fb0: 6472 6177 2829 0d0a 0d0a 2020 2020 2020  draw()....      
+00099fc0: 2020 6669 6720 3d20 7365 6c66 2e70 6167    fig = self.pag
+00099fd0: 6533 2e63 6c75 7374 6572 696e 6476 696d  e3.clusterindvim
+00099fe0: 6766 6967 0d0a 2020 2020 2020 2020 6669  gfig..        fi
+00099ff0: 672e 636c 6628 290d 0a20 2020 2020 2020  g.clf()..       
+0009a000: 2073 656c 662e 7061 6765 332e 436c 7573   self.page3.Clus
+0009a010: 7465 7249 6e64 7649 6d61 6765 5061 6e2e  terIndvImagePan.
+0009a020: 6472 6177 2829 0d0a 0d0a 2020 2020 2020  draw()....      
+0009a030: 2020 6669 6720 3d20 7365 6c66 2e70 6167    fig = self.pag
+0009a040: 6533 2e63 6c75 7374 6572 7370 6563 6669  e3.clusterspecfi
+0009a050: 670d 0a20 2020 2020 2020 2066 6967 2e63  g..        fig.c
+0009a060: 6c66 2829 0d0a 2020 2020 2020 2020 7365  lf()..        se
+0009a070: 6c66 2e70 6167 6533 2e43 6c75 7374 6572  lf.page3.Cluster
+0009a080: 5370 6563 5061 6e2e 6472 6177 2829 0d0a  SpecPan.draw()..
+0009a090: 0d0a 2020 2020 2020 2020 6669 6720 3d20  ..        fig = 
+0009a0a0: 7365 6c66 2e70 6167 6533 2e63 6c75 7374  self.page3.clust
+0009a0b0: 6572 6469 7374 6d61 7066 6967 0d0a 2020  erdistmapfig..  
+0009a0c0: 2020 2020 2020 6669 672e 636c 6628 290d        fig.clf().
+0009a0d0: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+0009a0e0: 6765 332e 436c 7573 7465 7244 6973 744d  ge3.ClusterDistM
+0009a0f0: 6170 5061 6e2e 6472 6177 2829 0d0a 0d0a  apPan.draw()....
+0009a100: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
+0009a110: 6533 2e73 656c 636c 7573 7465 7220 3d20  e3.selcluster = 
+0009a120: 310d 0a20 2020 2020 2020 2073 656c 662e  1..        self.
+0009a130: 7061 6765 332e 736c 6964 6572 7368 6f77  page3.slidershow
+0009a140: 2e73 6574 5661 6c75 6528 7365 6c66 2e70  .setValue(self.p
+0009a150: 6167 6533 2e73 656c 636c 7573 7465 7229  age3.selcluster)
+0009a160: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+0009a170: 6167 6533 2e6e 756d 636c 7573 7465 7273  age3.numclusters
+0009a180: 203d 2035 0d0a 2020 2020 2020 2020 7365   = 5..        se
+0009a190: 6c66 2e70 6167 6533 2e6e 636c 7573 7465  lf.page3.ncluste
+0009a1a0: 7273 7069 6e2e 7365 7456 616c 7565 2873  rspin.setValue(s
+0009a1b0: 656c 662e 7061 6765 332e 6e75 6d63 6c75  elf.page3.numclu
+0009a1c0: 7374 6572 7329 0d0a 2020 2020 2020 2020  sters)..        
+0009a1d0: 7365 6c66 2e70 6167 6533 2e74 635f 636c  self.page3.tc_cl
+0009a1e0: 7573 7465 722e 7365 7454 6578 7428 2243  uster.setText("C
+0009a1f0: 6c75 7374 6572 2022 290d 0a20 2020 2020  luster ")..     
+0009a200: 2020 2073 656c 662e 7061 6765 332e 7463     self.page3.tc
+0009a210: 5f63 6c75 7374 6572 7370 2e73 6574 5465  _clustersp.setTe
+0009a220: 7874 2822 436c 7573 7465 7220 7370 6563  xt("Cluster spec
+0009a230: 7472 756d 2229 0d0a 2020 2020 2020 2020  trum")..        
+0009a240: 7365 6c66 2e70 6167 6533 2e77 6f5f 3173  self.page3.wo_1s
+0009a250: 745f 7063 6120 3d20 300d 0a20 2020 2020  t_pca = 0..     
+0009a260: 2020 2073 656c 662e 7061 6765 332e 7265     self.page3.re
+0009a270: 6d6f 7665 3173 7470 6361 6362 2e73 6574  move1stpcacb.set
+0009a280: 4368 6563 6b65 6428 4661 6c73 6529 0d0a  Checked(False)..
+0009a290: 0d0a 0d0a 2020 2020 2020 2020 2370 6167  ....        #pag
+0009a2a0: 6520 340d 0a20 2020 2020 2020 2073 656c  e 4..        sel
+0009a2b0: 662e 7061 6765 342e 436c 6561 7257 6964  f.page4.ClearWid
+0009a2c0: 6765 7473 2829 0d0a 0d0a 2020 2020 2020  gets()....      
+0009a2d0: 2020 2370 6167 6520 350d 0a20 2020 2020    #page 5..     
+0009a2e0: 2020 2066 6967 203d 2073 656c 662e 7061     fig = self.pa
+0009a2f0: 6765 352e 6b65 7370 6563 6669 670d 0a20  ge5.kespecfig.. 
+0009a300: 2020 2020 2020 2066 6967 2e63 6c66 2829         fig.clf()
+0009a310: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+0009a320: 6167 6535 2e4b 4553 7065 6350 616e 2e64  age5.KESpecPan.d
+0009a330: 7261 7728 290d 0a20 2020 2020 2020 2066  raw()..        f
+0009a340: 6967 203d 2073 656c 662e 7061 6765 352e  ig = self.page5.
+0009a350: 6162 7369 6d67 6669 670d 0a20 2020 2020  absimgfig..     
+0009a360: 2020 2066 6967 2e63 6c66 2829 0d0a 2020     fig.clf()..  
+0009a370: 2020 2020 2020 7365 6c66 2e70 6167 6535        self.page5
+0009a380: 2e41 6273 496d 6167 6550 616e 656c 2e64  .AbsImagePanel.d
+0009a390: 7261 7728 290d 0a0d 0a0d 0a20 2020 2020  raw()......     
+0009a3a0: 2020 2023 7061 6765 2036 0d0a 2020 2020     #page 6..    
+0009a3b0: 2020 2020 6966 2073 656c 662e 7061 6765      if self.page
+0009a3c0: 3620 213d 204e 6f6e 653a 0d0a 2020 2020  6 != None:..    
+0009a3d0: 2020 2020 2020 2020 6669 6720 3d20 7365          fig = se
+0009a3e0: 6c66 2e70 6167 6536 2e53 7065 6366 6967  lf.page6.Specfig
+0009a3f0: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
+0009a400: 672e 636c 6628 290d 0a20 2020 2020 2020  g.clf()..       
+0009a410: 2020 2020 2073 656c 662e 7061 6765 362e       self.page6.
+0009a420: 5370 6563 7472 756d 5061 6e65 6c2e 6472  SpectrumPanel.dr
+0009a430: 6177 2829 0d0a 2020 2020 2020 2020 2020  aw()..          
+0009a440: 2020 7365 6c66 2e70 6167 6536 2e73 6c69    self.page6.sli
+0009a450: 6465 725f 7370 6563 2e73 6574 456e 6162  der_spec.setEnab
+0009a460: 6c65 6428 4661 6c73 6529 0d0a 0d0a 2020  led(False)....  
+0009a470: 2020 2020 2020 2370 6167 6538 0d0a 2020        #page8..  
+0009a480: 2020 2020 2020 6966 2073 686f 7774 6f6d        if showtom
+0009a490: 6f74 6162 3a0d 0a20 2020 2020 2020 2020  otab:..         
+0009a4a0: 2020 2073 656c 662e 7061 6765 382e 4e65     self.page8.Ne
+0009a4b0: 7753 7461 636b 436c 6561 7228 290d 0a0d  wStackClear()...
+0009a4c0: 0a0d 0a22 2222 202d 2d2d 2d2d 2d2d 2d2d  ...""" ---------
+0009a4d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0009a4e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0009a4f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0009a500: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0009a510: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0009a520: 2d2d 2d2d 2d2d 2d22 2222 0d0a 6465 6620  -------"""..def 
+0009a530: 6d61 696e 2829 3a0d 0a0d 0a20 2020 2061  main():....    a
+0009a540: 7070 203d 2051 7457 6964 6765 7473 2e51  pp = QtWidgets.Q
+0009a550: 4170 706c 6963 6174 696f 6e28 7379 732e  Application(sys.
+0009a560: 6172 6776 290d 0a20 2020 2023 7072 696e  argv)..    #prin
+0009a570: 7428 276d 6169 6e27 2c20 7468 7265 6164  t('main', thread
+0009a580: 696e 672e 6765 745f 6964 656e 7428 2929  ing.get_ident())
+0009a590: 0d0a 2020 2020 7769 7468 206f 7065 6e28  ..    with open(
+0009a5a0: 7173 7370 6174 682c 2022 7222 2920 6173  qsspath, "r") as
+0009a5b0: 2073 7479 6c65 7368 6565 743a 0d0a 2020   stylesheet:..  
+0009a5c0: 2020 2020 2020 6170 702e 7365 7453 7479        app.setSty
+0009a5d0: 6c65 5368 6565 7428 7374 796c 6573 6865  leSheet(styleshe
+0009a5e0: 6574 2e72 6561 6428 2929 0d0a 2020 2020  et.read())..    
+0009a5f0: 6672 616d 6520 3d20 4d61 696e 4672 616d  frame = MainFram
+0009a600: 6528 290d 0a20 2020 2073 7973 2e65 7869  e()..    sys.exi
+0009a610: 7428 6170 702e 6578 6563 5f28 2929 0d0a  t(app.exec_())..
+0009a620: 0d0a 0d0a 6966 205f 5f6e 616d 655f 5f20  ....if __name__ 
+0009a630: 3d3d 2027 5f5f 6d61 696e 5f5f 273a 0d0a  == '__main__':..
+0009a640: 2020 2020 6d61 696e 2829 0d0a                main()..
```

### Comparing `mantis-xray-3.1.7/mantis_xray/nnma.py` & `mantis-xray-3.1.9/mantis_xray/nnma.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/pageloaddata.ui` & `mantis-xray-3.1.9/mantis_xray/pageloaddata.ui`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/pagemap.ui` & `mantis-xray-3.1.9/mantis_xray/pagemap.ui`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/showalign2.ui` & `mantis-xray-3.1.9/mantis_xray/showalign2.ui`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/showartefacts.ui` & `mantis-xray-3.1.9/mantis_xray/showartefacts.ui`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/showhistogram.ui` & `mantis-xray-3.1.9/mantis_xray/showhistogram.ui`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/showmulticrop.ui` & `mantis-xray-3.1.9/mantis_xray/showmulticrop.ui`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/showspectralroi.ui` & `mantis-xray-3.1.9/mantis_xray/showspectralroi.ui`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray/tomo_reconstruction.py` & `mantis-xray-3.1.9/mantis_xray/tomo_reconstruction.py`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/mantis_xray.egg-info/PKG-INFO` & `mantis-xray-3.1.9/mantis_xray.egg-info/PKG-INFO`

 * *Files 6% similar despite different names*

```diff
@@ -1,18 +1,16 @@
 Metadata-Version: 2.1
 Name: mantis-xray
-Version: 3.1.7
+Version: 3.1.9
 Summary: MANTiS is a Multivariate ANalysis Tool for x-ray Spectromicroscopy
 Home-page: https://spectromicroscopy.com/
 Author: Mirna Lerotic
 Author-email: mirna@2ndlookconsulting.com
-License: UNKNOWN
 Project-URL: Code, https://github.com/mlerotic/spectromicroscopy
 Project-URL: Documentation, https://docs.spectromicroscopy.com
-Platform: UNKNOWN
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: GNU General Public License v3 or later (GPLv3+)
 Classifier: Operating System :: OS Independent
 Classifier: Topic :: Scientific/Engineering
 Requires-Python: >=3
 Description-Content-Type: text/markdown
 Provides-Extra: netCDF
@@ -44,9 +42,7 @@
 Mantis User Guide can be found on the project Wiki pages [Home](https://github.com/mlerotic/spectromicroscopy/wiki).
 
 ## References ##
 
 Please use the following reference when quoting Mantis
 
 Lerotic M, Mak R, Wirick S, Meirer F, Jacobsen C. MANTiS: a program for the analysis of X-ray spectromicroscopy data. J. Synchrotron Rad. 2014 Sep; 21(5); 1206â€“1212 [http://dx.doi.org/10.1107/S1600577514013964]
-
-
```

### Comparing `mantis-xray-3.1.7/mantis_xray.egg-info/SOURCES.txt` & `mantis-xray-3.1.9/mantis_xray.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `mantis-xray-3.1.7/setup.py` & `mantis-xray-3.1.9/setup.py`

 * *Files identical despite different names*

