# Comparing `tmp/censoredsummarystats-1.1.0.tar.gz` & `tmp/censoredsummarystats-1.1.1.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "censoredsummarystats-1.1.0.tar", max compression
+gzip compressed data, was "censoredsummarystats-1.1.1.tar", max compression
```

## Comparing `censoredsummarystats-1.1.0.tar` & `censoredsummarystats-1.1.1.tar`

### file list

```diff
@@ -1,7 +1,7 @@
--rw-r--r--   0        0        0      256 2023-04-29 03:54:32.851141 censoredsummarystats-1.1.0/censoredsummarystats/__init__.py
--rw-r--r--   0        0        0    50106 2023-04-29 23:52:07.081367 censoredsummarystats-1.1.0/censoredsummarystats/statistics.py
--rw-r--r--   0        0        0     2291 2023-04-29 21:55:33.186386 censoredsummarystats-1.1.0/censoredsummarystats/utils.py
--rw-r--r--   0        0        0    11558 2023-03-12 00:39:53.769556 censoredsummarystats-1.1.0/LICENSE
--rw-r--r--   0        0        0      558 2023-04-30 00:02:25.472559 censoredsummarystats-1.1.0/pyproject.toml
--rw-r--r--   0        0        0      112 2023-03-12 00:39:53.771555 censoredsummarystats-1.1.0/README.md
--rw-r--r--   0        0        0      876 1970-01-01 00:00:00.000000 censoredsummarystats-1.1.0/PKG-INFO
+-rw-r--r--   0        0        0       71 2023-04-30 00:07:23.730885 censoredsummarystats-1.1.1/censoredsummarystats/__init__.py
+-rw-r--r--   0        0        0    50017 2023-04-30 00:07:49.121812 censoredsummarystats-1.1.1/censoredsummarystats/statistics.py
+-rw-r--r--   0        0        0     2291 2023-04-29 21:55:33.186386 censoredsummarystats-1.1.1/censoredsummarystats/utils.py
+-rw-r--r--   0        0        0    11558 2023-03-12 00:39:53.769556 censoredsummarystats-1.1.1/LICENSE
+-rw-r--r--   0        0        0      558 2023-04-30 00:09:07.166268 censoredsummarystats-1.1.1/pyproject.toml
+-rw-r--r--   0        0        0      112 2023-03-12 00:39:53.771555 censoredsummarystats-1.1.1/README.md
+-rw-r--r--   0        0        0      876 1970-01-01 00:00:00.000000 censoredsummarystats-1.1.1/PKG-INFO
```

### Comparing `censoredsummarystats-1.1.0/censoredsummarystats/statistics.py` & `censoredsummarystats-1.1.1/censoredsummarystats/statistics.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,3132 +1,3127 @@
-00000000: 2320 2d2a 2d20 636f 6469 6e67 3a20 7574  # -*- coding: ut
-00000010: 662d 3820 2d2a 2d0d 0a22 2222 0d0a 4372  f-8 -*-.."""..Cr
-00000020: 6561 7465 6420 6f6e 2053 756e 204d 6172  eated on Sun Mar
-00000030: 2031 3220 3133 3a34 323a 3030 2032 3032   12 13:42:00 202
-00000040: 330d 0a0d 0a40 6175 7468 6f72 3a20 4b75  3....@author: Ku
-00000050: 7274 560d 0a22 2222 0d0a 0d0a 696d 706f  rtV.."""....impo
-00000060: 7274 206e 756d 7079 2061 7320 6e70 0d0a  rt numpy as np..
-00000070: 6672 6f6d 2075 7469 6c73 2069 6d70 6f72  from utils impor
-00000080: 7420 7374 7269 6e67 5f70 7265 6369 7369  t string_precisi
-00000090: 6f6e 2c20 6e75 6d65 7269 635f 7072 6563  on, numeric_prec
-000000a0: 6973 696f 6e0d 0a0d 0a23 2053 6574 2064  ision....# Set d
-000000b0: 6566 6175 6c74 2063 6f6c 756d 6e20 6e61  efault column na
-000000c0: 6d65 730d 0a73 7461 745f 636f 6c20 3d20  mes..stat_col = 
-000000d0: 2753 7461 7469 7374 6963 270d 0a72 6573  'Statistic'..res
-000000e0: 756c 745f 636f 6c20 3d20 2752 6573 756c  ult_col = 'Resul
-000000f0: 7427 0d0a 6365 6e73 6f72 5f63 6f6c 203d  t'..censor_col =
-00000100: 2027 4365 6e73 6f72 436f 6d70 6f6e 656e   'CensorComponen
-00000110: 7427 0d0a 6e75 6d65 7269 635f 636f 6c20  t'..numeric_col 
-00000120: 3d20 274e 756d 6572 6963 436f 6d70 6f6e  = 'NumericCompon
-00000130: 656e 7427 0d0a 696e 7465 7276 616c 5f63  ent'..interval_c
-00000140: 6f6c 203d 2027 496e 7465 7276 616c 270d  ol = 'Interval'.
-00000150: 0a6c 6566 745f 626f 756e 6461 7279 5f63  .left_boundary_c
-00000160: 6f6c 203d 2027 5f5f 4c65 6674 426f 756e  ol = '__LeftBoun
-00000170: 6461 7279 5f5f 270d 0a6c 6566 745f 626f  dary__'..left_bo
-00000180: 756e 645f 636f 6c20 3d20 275f 5f4c 6566  und_col = '__Lef
-00000190: 7442 6f75 6e64 5f5f 270d 0a6d 6964 706f  tBound__'..midpo
-000001a0: 696e 745f 636f 6c20 3d20 275f 5f4d 6964  int_col = '__Mid
-000001b0: 506f 696e 745f 5f27 0d0a 7269 6768 745f  Point__'..right_
-000001c0: 626f 756e 645f 636f 6c20 3d20 275f 5f52  bound_col = '__R
-000001d0: 6967 6874 426f 756e 645f 5f27 0d0a 7269  ightBound__'..ri
-000001e0: 6768 745f 626f 756e 6461 7279 5f63 6f6c  ght_boundary_col
-000001f0: 203d 2027 5f5f 5269 6768 7442 6f75 6e64   = '__RightBound
-00000200: 6172 795f 5f27 0d0a 0d0a 0d0a 0d0a 2325  ary__'........#%
-00000210: 2520 436f 6e76 6572 7369 6f6e 2062 6574  % Conversion bet
-00000220: 7765 656e 2072 6573 756c 7420 616e 6420  ween result and 
-00000230: 696e 7465 7276 616c 2063 6f6d 706f 6e65  interval compone
-00000240: 6e74 730d 0a0d 0a23 2525 2520 4265 7477  nts....#%%% Betw
-00000250: 6565 6e20 7265 7375 6c74 2061 6e64 2063  een result and c
-00000260: 656e 736f 722f 6e75 6d65 7269 6320 636f  ensor/numeric co
-00000270: 6d70 6f6e 656e 7473 0d0a 0d0a 6465 6620  mponents....def 
-00000280: 7265 7375 6c74 5f74 6f5f 636f 6d70 6f6e  result_to_compon
-00000290: 656e 7473 2864 662c 0d0a 2020 2020 2020  ents(df,..      
-000002a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000002b0: 2020 2072 6573 756c 745f 636f 6c75 6d6e     result_column
-000002c0: 293a 0d0a 2020 2020 2727 270d 0a20 2020  ):..    '''..   
-000002d0: 2041 2066 756e 6374 696f 6e20 7468 6174   A function that
-000002e0: 2073 6570 6172 6174 6573 2063 656e 736f   separates censo
-000002f0: 7273 2028 3c2c e289 a42c e289 a52c 3e29  rs (<,...,...,>)
-00000300: 2066 726f 6d20 6120 7265 7375 6c74 2e20   from a result. 
-00000310: 5370 6c69 7474 696e 6720 7468 650d 0a20  Splitting the.. 
-00000320: 2020 2063 656e 736f 7220 636f 6d70 6f6e     censor compon
-00000330: 656e 7420 6672 6f6d 2074 6865 206e 756d  ent from the num
-00000340: 6572 6963 2063 6f6d 706f 6e65 6e74 2065  eric component e
-00000350: 6e61 626c 6573 2074 6865 2075 7365 206f  nables the use o
-00000360: 6620 6e75 6d65 7269 630d 0a20 2020 2064  f numeric..    d
-00000370: 6174 6120 7479 7065 732e 2041 2072 6573  ata types. A res
-00000380: 756c 7420 6f66 203c 3130 2028 7374 7269  ult of <10 (stri
-00000390: 6e67 2f74 6578 7429 2069 7320 7370 6c69  ng/text) is spli
-000003a0: 7420 696e 746f 2061 2063 656e 736f 7220  t into a censor 
-000003b0: 636f 6d70 6f6e 656e 740d 0a20 2020 206f  component..    o
-000003c0: 6620 3c20 2873 7472 696e 672f 7465 7874  f < (string/text
-000003d0: 2920 616e 6420 6120 6e75 6d65 7269 6320  ) and a numeric 
-000003e0: 636f 6d70 6f6e 656e 7420 6f66 2031 3020  component of 10 
-000003f0: 2866 6c6f 6174 2f64 6563 696d 616c 292e  (float/decimal).
-00000400: 0d0a 0d0a 2020 2020 5061 7261 6d65 7465  ....    Paramete
-00000410: 7273 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d  rs..    --------
-00000420: 2d2d 0d0a 2020 2020 6466 203a 2044 6174  --..    df : Dat
-00000430: 6146 7261 6d65 0d0a 2020 2020 2020 2020  aFrame..        
-00000440: 4461 7461 4672 616d 6520 636f 6e74 6169  DataFrame contai
-00000450: 6e69 6e67 2061 2063 6f6c 756d 6e20 746f  ning a column to
-00000460: 2062 6520 7370 6c69 7420 696e 746f 2063   be split into c
-00000470: 6f6d 706f 6e65 6e74 730d 0a20 2020 2072  omponents..    r
-00000480: 6573 756c 745f 636f 6c75 6d6e 203a 2073  esult_column : s
-00000490: 7472 696e 670d 0a20 2020 2020 2020 2043  tring..        C
-000004a0: 6f6c 756d 6e20 6e61 6d65 2066 6f72 2074  olumn name for t
-000004b0: 6865 2063 6f6c 756d 6e20 7468 6174 2063  he column that c
-000004c0: 6f6e 7461 696e 7320 7468 6520 7265 7375  ontains the resu
-000004d0: 6c74 7320 746f 2062 6520 7370 6c69 740d  lts to be split.
-000004e0: 0a0d 0a20 2020 2052 6574 7572 6e73 0d0a  ...    Returns..
-000004f0: 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020      -------..   
-00000500: 2064 6620 3a20 4461 7461 4672 616d 650d   df : DataFrame.
-00000510: 0a20 2020 2020 2020 2049 6e70 7574 2044  .        Input D
-00000520: 6174 6146 7261 6d65 2077 6974 6820 7477  ataFrame with tw
-00000530: 6f20 6164 6469 7469 6f6e 616c 2063 6f6c  o additional col
-00000540: 756d 6e73 2063 7265 6174 6564 2066 6f72  umns created for
-00000550: 2074 6865 2063 656e 736f 720d 0a20 2020   the censor..   
-00000560: 2020 2020 2061 6e64 206e 756d 6572 6963       and numeric
-00000570: 2063 6f6d 706f 6e65 6e74 730d 0a0d 0a20   components.... 
-00000580: 2020 2027 2727 0d0a 2020 2020 0d0a 2020     '''..    ..  
-00000590: 2020 2320 4372 6561 7465 2061 2063 6f70    # Create a cop
-000005a0: 7920 6f66 2074 6865 2044 6174 6146 7261  y of the DataFra
-000005b0: 6d65 0d0a 2020 2020 6466 203d 2064 662e  me..    df = df.
-000005c0: 636f 7079 2829 0d0a 2020 2020 0d0a 2020  copy()..    ..  
-000005d0: 2020 2320 456e 7375 7265 2074 6865 2076    # Ensure the v
-000005e0: 616c 7565 2063 6f6c 756d 6e20 6973 2074  alue column is t
-000005f0: 6578 742f 7374 7269 6e67 2064 6174 6120  ext/string data 
-00000600: 7479 7065 2e0d 0a20 2020 2064 665b 7265  type...    df[re
-00000610: 7375 6c74 5f63 6f6c 756d 6e5d 203d 2064  sult_column] = d
-00000620: 665b 7265 7375 6c74 5f63 6f6c 756d 6e5d  f[result_column]
-00000630: 2e61 7374 7970 6528 7374 7229 0d0a 2020  .astype(str)..  
-00000640: 2020 0d0a 2020 2020 2320 4372 6561 7465    ..    # Create
-00000650: 2063 656e 736f 7220 616e 6420 6e75 6d65   censor and nume
-00000660: 7269 6320 636f 6c75 6d6e 7320 6672 6f6d  ric columns from
-00000670: 2072 6573 756c 7420 636f 6c75 6d6e 0d0a   result column..
-00000680: 2020 2020 6466 5b63 656e 736f 725f 636f      df[censor_co
-00000690: 6c5d 203d 2064 665b 7265 7375 6c74 5f63  l] = df[result_c
-000006a0: 6f6c 756d 6e5d 2e73 7472 2e65 7874 7261  olumn].str.extra
-000006b0: 6374 2872 2728 5b3c e289 a4e2 89a5 3e5d  ct(r'([<......>]
-000006c0: 2927 292e 6669 6c6c 6e61 2827 2729 0d0a  )').fillna('')..
-000006d0: 2020 2020 6466 5b6e 756d 6572 6963 5f63      df[numeric_c
-000006e0: 6f6c 5d20 3d20 6466 5b72 6573 756c 745f  ol] = df[result_
-000006f0: 636f 6c75 6d6e 5d2e 7374 722e 7265 706c  column].str.repl
-00000700: 6163 6528 273c 7ce2 89a4 7ce2 89a5 7c3e  ace('<|...|...|>
-00000710: 272c 2727 2c72 6567 6578 3d54 7275 6529  ','',regex=True)
-00000720: 2e61 7374 7970 6528 666c 6f61 7429 0d0a  .astype(float)..
-00000730: 2020 2020 0d0a 2020 2020 7265 7475 726e      ..    return
-00000740: 2064 660d 0a0d 0a64 6566 2063 6f6d 706f   df....def compo
-00000750: 6e65 6e74 735f 746f 5f72 6573 756c 7428  nents_to_result(
-00000760: 6466 2c0d 0a20 2020 2020 2020 2020 2020  df,..           
-00000770: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00000780: 6563 6973 696f 6e5f 726f 756e 6469 6e67  ecision_rounding
-00000790: 203d 2054 7275 6529 3a0d 0a20 2020 2027   = True):..    '
-000007a0: 2727 0d0a 2020 2020 4120 6675 6e63 7469  ''..    A functi
-000007b0: 6f6e 2074 6861 7420 636f 6d62 696e 6573  on that combines
-000007c0: 2063 656e 736f 7220 616e 6420 6e75 6d65   censor and nume
-000007d0: 7269 6320 636f 6d70 6f6e 656e 7473 2069  ric components i
-000007e0: 6e74 6f20 6120 636f 6d62 696e 6564 0d0a  nto a combined..
-000007f0: 2020 2020 7374 7269 6e67 2f74 6578 7420      string/text 
-00000800: 7265 7375 6c74 2e0d 0a0d 0a20 2020 2050  result.....    P
-00000810: 6172 616d 6574 6572 730d 0a20 2020 202d  arameters..    -
-00000820: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
-00000830: 6620 3a20 4461 7461 4672 616d 650d 0a20  f : DataFrame.. 
-00000840: 2020 2020 2020 2044 6174 6146 7261 6d65         DataFrame
-00000850: 2063 6f6e 7461 696e 696e 6720 6365 6e73   containing cens
-00000860: 6f72 2061 6e64 206e 756d 6572 6963 2063  or and numeric c
-00000870: 6f6c 756d 6e73 2074 6861 7420 7769 6c6c  olumns that will
-00000880: 2062 6520 636f 6d62 696e 6564 0d0a 2020   be combined..  
-00000890: 2020 7072 6563 6973 696f 6e5f 726f 756e    precision_roun
-000008a0: 6469 6e67 203a 2062 6f6f 6c65 616e 2c20  ding : boolean, 
-000008b0: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
-000008c0: 2020 4966 2054 7275 652c 2061 2072 6f75    If True, a rou
-000008d0: 6e64 696e 6720 6d65 7468 6f64 2069 7320  nding method is 
-000008e0: 6170 706c 6965 6420 746f 2072 6f75 6e64  applied to round
-000008f0: 2072 6573 756c 7473 2074 6f20 6861 7665   results to have
-00000900: 206e 6f20 6d6f 7265 0d0a 2020 2020 2020   no more..      
-00000910: 2020 6465 6369 6d61 6c73 2074 6861 6e20    decimals than 
-00000920: 7768 6174 2063 616e 2062 6520 6d65 6173  what can be meas
-00000930: 7572 6564 2e0d 0a20 2020 2020 2020 2054  ured...        T
-00000940: 6865 2064 6566 6175 6c74 2069 7320 5472  he default is Tr
-00000950: 7565 2e0d 0a0d 0a20 2020 2052 6574 7572  ue.....    Retur
-00000960: 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d 2d0d  ns..    -------.
-00000970: 0a20 2020 2064 6620 3a20 4461 7461 4672  .    df : DataFr
-00000980: 616d 650d 0a20 2020 2020 2020 2049 6e70  ame..        Inp
-00000990: 7574 2044 6174 6146 7261 6d65 2074 6861  ut DataFrame tha
-000009a0: 7420 636f 6e74 6169 6e73 2061 206e 6577  t contains a new
-000009b0: 2073 7472 696e 672f 7465 7874 2063 6f6c   string/text col
-000009c0: 756d 6e20 7468 6174 2063 6f6d 6269 6e65  umn that combine
-000009d0: 730d 0a20 2020 2020 2020 2074 6865 2063  s..        the c
-000009e0: 656e 736f 7220 616e 6420 6e75 6d65 7269  ensor and numeri
-000009f0: 6320 636f 6d70 6f6e 656e 7473 206f 6620  c components of 
-00000a00: 6120 7265 7375 6c74 0d0a 0d0a 2020 2020  a result....    
-00000a10: 2727 270d 0a20 2020 200d 0a20 2020 2023  '''..    ..    #
-00000a20: 2043 7265 6174 6520 6120 636f 7079 206f   Create a copy o
-00000a30: 6620 7468 6520 4461 7461 4672 616d 650d  f the DataFrame.
-00000a40: 0a20 2020 2064 6620 3d20 6466 2e63 6f70  .    df = df.cop
-00000a50: 7928 290d 0a20 2020 200d 0a20 2020 2023  y()..    ..    #
-00000a60: 2043 6f6d 6269 6e65 2074 6865 2063 656e   Combine the cen
-00000a70: 736f 7220 616e 6420 6e75 6d65 7269 6320  sor and numeric 
-00000a80: 636f 6d70 6f6e 656e 7473 2074 6f20 6372  components to cr
-00000a90: 6561 7465 2061 2063 6f6d 6269 6e65 6420  eate a combined 
-00000aa0: 7265 7375 6c74 0d0a 2020 2020 2320 4170  result..    # Ap
-00000ab0: 706c 7920 7468 6520 6170 7072 6f70 7269  ply the appropri
-00000ac0: 6174 6520 726f 756e 6469 6e67 2066 756e  ate rounding fun
-00000ad0: 6374 696f 6e73 2069 6620 7072 6563 6973  ctions if precis
-00000ae0: 696f 6e5f 726f 756e 6469 6e67 2069 7320  ion_rounding is 
-00000af0: 5472 7565 0d0a 2020 2020 6966 2070 7265  True..    if pre
-00000b00: 6369 7369 6f6e 5f72 6f75 6e64 696e 673a  cision_rounding:
-00000b10: 0d0a 2020 2020 2020 2020 6466 5b72 6573  ..        df[res
-00000b20: 756c 745f 636f 6c5d 203d 2064 665b 6365  ult_col] = df[ce
-00000b30: 6e73 6f72 5f63 6f6c 5d20 2b20 6466 5b6e  nsor_col] + df[n
-00000b40: 756d 6572 6963 5f63 6f6c 5d2e 6170 706c  umeric_col].appl
-00000b50: 7928 7374 7269 6e67 5f70 7265 6369 7369  y(string_precisi
-00000b60: 6f6e 2c74 686f 7573 616e 6473 5f63 6f6d  on,thousands_com
-00000b70: 6d61 3d54 7275 6529 0d0a 2020 2020 2020  ma=True)..      
-00000b80: 2020 6466 5b6e 756d 6572 6963 5f63 6f6c    df[numeric_col
-00000b90: 5d20 3d20 6466 5b6e 756d 6572 6963 5f63  ] = df[numeric_c
-00000ba0: 6f6c 5d2e 6170 706c 7928 6e75 6d65 7269  ol].apply(numeri
-00000bb0: 635f 7072 6563 6973 696f 6e29 0d0a 2020  c_precision)..  
-00000bc0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00000bd0: 2064 665b 7265 7375 6c74 5f63 6f6c 5d20   df[result_col] 
-00000be0: 3d20 6466 5b63 656e 736f 725f 636f 6c5d  = df[censor_col]
-00000bf0: 202b 2064 665b 6e75 6d65 7269 635f 636f   + df[numeric_co
-00000c00: 6c5d 2e61 7374 7970 6528 7374 7229 0d0a  l].astype(str)..
-00000c10: 2020 2020 0d0a 2020 2020 7265 7475 726e      ..    return
-00000c20: 2064 660d 0a0d 0a23 2525 2520 4265 7477   df....#%%% Betw
-00000c30: 6565 6e20 6365 6e73 6f72 2f6e 756d 6572  een censor/numer
-00000c40: 6963 2063 6f6d 706f 6e65 6e74 7320 616e  ic components an
-00000c50: 6420 696e 7465 7276 616c 2063 6f6d 706f  d interval compo
-00000c60: 6e65 6e74 730d 0a0d 0a64 6566 2063 6f6d  nents....def com
-00000c70: 706f 6e65 6e74 735f 746f 5f69 6e74 6572  ponents_to_inter
-00000c80: 7661 6c28 6466 2c0d 0a20 2020 2020 2020  val(df,..       
-00000c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000ca0: 2020 2020 696e 636c 7564 655f 6e65 6761      include_nega
-00000cb0: 7469 7665 5f69 6e74 6572 7661 6c20 3d20  tive_interval = 
-00000cc0: 4661 6c73 6529 3a0d 0a20 2020 2027 2727  False):..    '''
-00000cd0: 0d0a 2020 2020 4120 6675 6e63 7469 6f6e  ..    A function
-00000ce0: 2074 6861 7420 7574 696c 6973 6573 2074   that utilises t
-00000cf0: 6865 2063 656e 736f 7220 616e 6420 6e75  he censor and nu
-00000d00: 6d65 7269 6320 636f 6d70 6f6e 656e 7473  meric components
-00000d10: 2074 6f20 636f 6e76 6572 740d 0a20 2020   to convert..   
-00000d20: 2065 6163 6820 7265 7375 6c74 2069 6e74   each result int
-00000d30: 6f20 696e 7465 7276 616c 206e 6f74 6174  o interval notat
-00000d40: 696f 6e2e 2046 6f75 7220 636f 6c75 6d6e  ion. Four column
-00000d50: 7320 6172 6520 6372 6561 7465 6420 746f  s are created to
-00000d60: 2073 746f 7265 0d0a 2020 2020 7468 6520   store..    the 
-00000d70: 696e 7465 7276 616c 2069 6e66 6f72 6d61  interval informa
-00000d80: 7469 6f6e 2069 6e63 6c75 6469 6e67 206c  tion including l
-00000d90: 6566 742f 7269 6768 7420 626f 756e 6473  eft/right bounds
-00000da0: 2061 6e64 2077 6865 7468 6572 2074 6865   and whether the
-00000db0: 0d0a 2020 2020 656e 6470 6f69 6e74 732f  ..    endpoints/
-00000dc0: 626f 756e 6461 7269 6573 2061 7265 2069  boundaries are i
-00000dd0: 6e63 6c75 7369 7665 206f 7220 6578 636c  nclusive or excl
-00000de0: 7573 6976 6520 2865 2e67 2e2c 203c 3120  usive (e.g., <1 
-00000df0: 7673 20e2 89a4 3129 0d0a 0d0a 2020 2020  vs ...1)....    
-00000e00: 5061 7261 6d65 7465 7273 0d0a 2020 2020  Parameters..    
-00000e10: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
-00000e20: 6466 203a 2044 6174 6146 7261 6d65 0d0a  df : DataFrame..
-00000e30: 2020 2020 2020 2020 4461 7461 4672 616d          DataFram
-00000e40: 6520 636f 6e74 6169 6e69 6e67 2074 6865  e containing the
-00000e50: 2063 656e 736f 7220 616e 6420 6e75 6d65   censor and nume
-00000e60: 7269 6320 636f 6c75 6d6e 730d 0a20 2020  ric columns..   
-00000e70: 2069 6e63 6c75 6465 5f6e 6567 6174 6976   include_negativ
-00000e80: 655f 696e 7465 7276 616c 203a 2062 6f6f  e_interval : boo
-00000e90: 6c65 616e 2c20 6f70 7469 6f6e 616c 0d0a  lean, optional..
-00000ea0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-00000eb0: 2074 6865 6e20 616c 6c20 706f 7369 7469   then all positi
-00000ec0: 7665 2061 6e64 206e 6567 6174 6976 6520  ve and negative 
-00000ed0: 7661 6c75 6573 2061 7265 2063 6f6e 7369  values are consi
-00000ee0: 6465 7265 640d 0a20 2020 2020 2020 2065  dered..        e
-00000ef0: 2e67 2e2c 203c 302e 3520 776f 756c 6420  .g., <0.5 would 
-00000f00: 6265 2063 6f6e 7665 7274 6564 2074 6f20  be converted to 
-00000f10: 282d 6e70 2e69 6e66 2c35 292e 0d0a 2020  (-np.inf,5)...  
-00000f20: 2020 2020 2020 4966 2046 616c 7365 2c20        If False, 
-00000f30: 7468 656e 206f 6e6c 7920 6e6f 6e2d 6e65  then only non-ne
-00000f40: 6761 7469 7665 2076 616c 7565 7320 6172  gative values ar
-00000f50: 6520 636f 6e73 6964 6572 6564 0d0a 2020  e considered..  
-00000f60: 2020 2020 2020 652e 672e 2c20 3c30 2e35        e.g., <0.5
-00000f70: 2077 6f75 6c64 2062 6520 636f 6e76 6572   would be conver
-00000f80: 7465 6420 746f 205b 302c 3529 2e0d 0a20  ted to [0,5)... 
-00000f90: 2020 2020 2020 2054 6865 2064 6566 6175         The defau
-00000fa0: 6c74 2069 7320 4661 6c73 652e 0d0a 2020  lt is False...  
-00000fb0: 2020 0d0a 2020 2020 5261 6973 6573 0d0a    ..    Raises..
-00000fc0: 2020 2020 2d2d 2d2d 2d2d 0d0a 2020 2020      ------..    
-00000fd0: 5661 6c75 6545 7272 6f72 0d0a 2020 2020  ValueError..    
-00000fe0: 2020 2020 416e 2065 7272 6f72 2074 6861      An error tha
-00000ff0: 7420 6973 2072 6574 7572 6e65 6420 7768  t is returned wh
-00001000: 656e 2072 6573 756c 7473 2061 7265 2066  en results are f
-00001010: 6f75 6e64 2074 6f20 6265 206f 7574 7369  ound to be outsi
-00001020: 6465 2074 6865 0d0a 2020 2020 2020 2020  de the..        
-00001030: 6173 7375 6d65 6420 6f72 2064 6566 696e  assumed or defin
-00001040: 6564 206c 6f77 6572 2061 6e64 2075 7070  ed lower and upp
-00001050: 6572 2062 6f75 6e64 6172 6965 732e 0d0a  er boundaries...
-00001060: 0d0a 2020 2020 5265 7475 726e 730d 0a20  ..    Returns.. 
-00001070: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
-00001080: 6466 203a 2044 6174 6146 7261 6d65 0d0a  df : DataFrame..
-00001090: 2020 2020 2020 2020 496e 7075 7420 4461          Input Da
-000010a0: 7461 4672 616d 6520 7769 7468 2066 6f75  taFrame with fou
-000010b0: 7220 6164 6469 7469 6f6e 616c 2063 6f6c  r additional col
-000010c0: 756d 6e73 2063 7265 6174 6564 2074 6861  umns created tha
-000010d0: 7420 7374 6f72 6520 7468 650d 0a20 2020  t store the..   
-000010e0: 2020 2020 2069 6e66 6f72 6d61 7469 6f6e       information
-000010f0: 2066 6f72 2074 6865 2069 6e74 6572 7661   for the interva
-00001100: 6c73 2074 6861 7420 7265 7072 6573 656e  ls that represen
-00001110: 7420 7468 6520 7261 6e67 6520 6f66 2070  t the range of p
-00001120: 6f74 656e 7469 616c 0d0a 2020 2020 2020  otential..      
-00001130: 2020 7661 6c75 6573 2066 6f72 2074 6865    values for the
-00001140: 2072 6573 756c 7473 0d0a 0d0a 2020 2020   results....    
-00001150: 2727 270d 0a20 2020 200d 0a20 2020 2023  '''..    ..    #
-00001160: 2043 7265 6174 6520 6120 636f 7079 206f   Create a copy o
-00001170: 6620 7468 6520 4461 7461 4672 616d 650d  f the DataFrame.
-00001180: 0a20 2020 2064 6620 3d20 6466 2e63 6f70  .    df = df.cop
-00001190: 7928 290d 0a20 2020 200d 0a20 2020 2023  y()..    ..    #
-000011a0: 2044 6566 696e 6520 7768 6572 6520 7468   Define where th
-000011b0: 6520 6c65 6674 2062 6f75 6e64 2069 7320  e left bound is 
-000011c0: 636c 6f73 6564 0d0a 2020 2020 6466 5b6c  closed..    df[l
-000011d0: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
-000011e0: 5d20 3d20 6e70 2e77 6865 7265 2864 665b  ] = np.where(df[
-000011f0: 6365 6e73 6f72 5f63 6f6c 5d2e 6973 696e  censor_col].isin
-00001200: 285b 2727 2c27 e289 a527 5d29 2c0d 0a20  (['','...']),.. 
-00001210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001230: 2027 436c 6f73 6564 272c 2027 4f70 656e   'Closed', 'Open
-00001240: 2729 0d0a 2020 2020 0d0a 2020 2020 2320  ')..    ..    # 
-00001250: 4465 6669 6e65 2077 6865 7265 206c 6566  Define where lef
-00001260: 7420 626f 756e 6420 6973 2075 6e6c 696d  t bound is unlim
-00001270: 6974 6564 0d0a 2020 2020 6466 5b6c 6566  ited..    df[lef
-00001280: 745f 626f 756e 645f 636f 6c5d 203d 206e  t_bound_col] = n
-00001290: 702e 7768 6572 6528 6466 5b63 656e 736f  p.where(df[censo
-000012a0: 725f 636f 6c5d 2e69 7369 6e28 5b27 3c27  r_col].isin(['<'
-000012b0: 2c27 e289 a427 5d29 2c0d 0a20 2020 2020  ,'...']),..     
-000012c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000012d0: 2020 2020 2020 2020 2020 2d6e 702e 696e            -np.in
-000012e0: 662c 2064 665b 6e75 6d65 7269 635f 636f  f, df[numeric_co
-000012f0: 6c5d 290d 0a20 2020 200d 0a20 2020 2023  l])..    ..    #
-00001300: 2044 6566 696e 6520 7768 6572 6520 7269   Define where ri
-00001310: 6768 7420 626f 756e 6420 6973 2075 6e6c  ght bound is unl
-00001320: 696d 6974 6564 0d0a 2020 2020 6466 5b72  imited..    df[r
-00001330: 6967 6874 5f62 6f75 6e64 5f63 6f6c 5d20  ight_bound_col] 
-00001340: 3d20 6e70 2e77 6865 7265 2864 665b 6365  = np.where(df[ce
-00001350: 6e73 6f72 5f63 6f6c 5d2e 6973 696e 285b  nsor_col].isin([
-00001360: 27e2 89a5 272c 273e 275d 292c 0d0a 2020  '...','>']),..  
-00001370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001380: 2020 2020 2020 2020 2020 2020 2020 6e70                np
-00001390: 2e69 6e66 2c20 6466 5b6e 756d 6572 6963  .inf, df[numeric
-000013a0: 5f63 6f6c 5d29 0d0a 2020 2020 0d0a 2020  _col])..    ..  
-000013b0: 2020 2320 4465 6669 6e65 2077 6865 7265    # Define where
-000013c0: 2074 6865 2072 6967 6874 2062 6f75 6e64   the right bound
-000013d0: 2069 7320 636c 6f73 6564 0d0a 2020 2020   is closed..    
-000013e0: 6466 5b72 6967 6874 5f62 6f75 6e64 6172  df[right_boundar
-000013f0: 795f 636f 6c5d 203d 206e 702e 7768 6572  y_col] = np.wher
-00001400: 6528 6466 5b63 656e 736f 725f 636f 6c5d  e(df[censor_col]
-00001410: 2e69 7369 6e28 5b27 e289 a427 2c27 275d  .isin(['...','']
-00001420: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-00001430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001440: 2020 2020 2020 2027 436c 6f73 6564 272c         'Closed',
-00001450: 2027 4f70 656e 2729 0d0a 2020 2020 0d0a   'Open')..    ..
-00001460: 2020 2020 2320 4966 206c 6566 7420 6365      # If left ce
-00001470: 6e73 6f72 6564 2061 7265 2061 7373 756d  nsored are assum
-00001480: 6564 2070 6f73 6974 6976 650d 0a20 2020  ed positive..   
-00001490: 2069 6620 6e6f 7420 696e 636c 7564 655f   if not include_
-000014a0: 6e65 6761 7469 7665 5f69 6e74 6572 7661  negative_interva
-000014b0: 6c3a 0d0a 2020 2020 2020 2020 2320 4368  l:..        # Ch
-000014c0: 6563 6b20 666f 7220 616e 7920 6e65 6761  eck for any nega
-000014d0: 7469 7665 2076 616c 7565 7320 2865 7863  tive values (exc
-000014e0: 6c75 6465 202d 696e 6629 0d0a 2020 2020  lude -inf)..    
-000014f0: 2020 2020 6966 2064 665b 6c65 6674 5f62      if df[left_b
-00001500: 6f75 6e64 5f63 6f6c 5d2e 6265 7477 6565  ound_col].betwee
-00001510: 6e28 2d6e 702e 696e 662c 2030 2c20 696e  n(-np.inf, 0, in
-00001520: 636c 7573 6976 653d 276e 6569 7468 6572  clusive='neither
-00001530: 2729 2e61 6e79 2829 3a0d 0a20 2020 2020  ').any():..     
-00001540: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00001550: 7565 4572 726f 7228 274e 6567 6174 6976  ueError('Negativ
-00001560: 6520 7661 6c75 6573 2065 7869 7374 2069  e values exist i
-00001570: 6e20 7468 6520 6461 7461 2e20 5265 736f  n the data. Reso
-00001580: 6c76 6520 6e65 6761 7469 7665 270d 0a20  lve negative'.. 
-00001590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000015a0: 2020 2020 2020 2020 2020 2020 2776 616c              'val
-000015b0: 7565 7320 6f72 2073 6574 2069 6e63 6c75  ues or set inclu
-000015c0: 6465 5f6e 6567 6174 6976 655f 696e 7465  de_negative_inte
-000015d0: 7276 616c 2074 6f20 5472 7565 2729 0d0a  rval to True')..
-000015e0: 2020 2020 2020 2020 2320 5365 7420 616e          # Set an
-000015f0: 7920 2d69 6e66 206c 6566 7420 626f 756e  y -inf left boun
-00001600: 6473 2074 6f20 3020 7769 7468 2063 6c6f  ds to 0 with clo
-00001610: 7365 6420 626f 756e 6461 7279 0d0a 2020  sed boundary..  
-00001620: 2020 2020 2020 636f 6e64 6974 696f 6e20        condition 
-00001630: 3d20 2864 665b 6c65 6674 5f62 6f75 6e64  = (df[left_bound
-00001640: 5f63 6f6c 5d20 3c20 3029 0d0a 2020 2020  _col] < 0)..    
-00001650: 2020 2020 6466 5b6c 6566 745f 626f 756e      df[left_boun
-00001660: 6461 7279 5f63 6f6c 5d20 3d20 6e70 2e77  dary_col] = np.w
-00001670: 6865 7265 2863 6f6e 6469 7469 6f6e 2c20  here(condition, 
-00001680: 2743 6c6f 7365 6427 2c20 6466 5b6c 6566  'Closed', df[lef
-00001690: 745f 626f 756e 6461 7279 5f63 6f6c 5d29  t_boundary_col])
-000016a0: 0d0a 2020 2020 2020 2020 6466 5b6c 6566  ..        df[lef
-000016b0: 745f 626f 756e 645f 636f 6c5d 203d 206e  t_bound_col] = n
-000016c0: 702e 7768 6572 6528 636f 6e64 6974 696f  p.where(conditio
-000016d0: 6e2c 2030 2e30 2c20 6466 5b6c 6566 745f  n, 0.0, df[left_
-000016e0: 626f 756e 645f 636f 6c5d 290d 0a20 2020  bound_col])..   
-000016f0: 200d 0a20 2020 2072 6574 7572 6e20 6466   ..    return df
-00001700: 0d0a 0d0a 0d0a 6465 6620 696e 7465 7276  ......def interv
-00001710: 616c 5f74 6f5f 636f 6d70 6f6e 656e 7473  al_to_components
-00001720: 2864 662c 0d0a 2020 2020 2020 2020 2020  (df,..          
-00001730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001740: 2066 6f63 7573 5f68 6967 685f 706f 7465   focus_high_pote
-00001750: 6e74 6961 6c20 3d20 5472 7565 2c0d 0a20  ntial = True,.. 
-00001760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001770: 2020 2020 2020 2020 2020 696e 636c 7564            includ
-00001780: 655f 6e65 6761 7469 7665 5f69 6e74 6572  e_negative_inter
-00001790: 7661 6c20 3d20 4661 6c73 652c 0d0a 2020  val = False,..  
-000017a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000017b0: 2020 2020 2020 2020 2070 7265 6369 7369           precisi
-000017c0: 6f6e 5f74 6f6c 6572 616e 6365 5f74 6f5f  on_tolerance_to_
-000017d0: 6472 6f70 5f63 656e 736f 7220 3d20 302e  drop_censor = 0.
-000017e0: 3235 293a 0d0a 2020 2020 2727 270d 0a20  25):..    '''.. 
-000017f0: 2020 2041 2066 756e 6374 696f 6e20 7468     A function th
-00001800: 6174 2064 6574 6572 6d69 6e65 7320 7468  at determines th
-00001810: 6520 6365 6e73 6f72 2061 6e64 206e 756d  e censor and num
-00001820: 6572 6963 2063 6f6d 706f 6e65 6e74 730d  eric components.
-00001830: 0a20 2020 2066 726f 6d20 696e 7465 7276  .    from interv
-00001840: 616c 730d 0a0d 0a20 2020 2050 6172 616d  als....    Param
-00001850: 6574 6572 730d 0a20 2020 202d 2d2d 2d2d  eters..    -----
-00001860: 2d2d 2d2d 2d0d 0a20 2020 2064 6620 3a20  -----..    df : 
-00001870: 4461 7461 4672 616d 650d 0a20 2020 2020  DataFrame..     
-00001880: 2020 2044 6174 6146 7261 6d65 2074 6861     DataFrame tha
-00001890: 7420 636f 6e74 6169 6e73 2069 6e74 6572  t contains inter
-000018a0: 7661 6c20 696e 666f 726d 6174 696f 6e0d  val information.
-000018b0: 0a20 2020 2066 6f63 7573 5f68 6967 685f  .    focus_high_
-000018c0: 706f 7465 6e74 6961 6c20 3a20 626f 6f6c  potential : bool
-000018d0: 6561 6e2c 206f 7074 696f 6e61 6c0d 0a20  ean, optional.. 
-000018e0: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-000018f0: 7468 656e 2069 6e66 6f72 6d61 7469 6f6e  then information
-00001900: 206f 6e20 7468 6520 6869 6768 6573 7420   on the highest 
-00001910: 706f 7465 6e74 6961 6c20 7265 7375 6c74  potential result
-00001920: 2077 696c 6c20 6265 0d0a 2020 2020 2020   will be..      
-00001930: 2020 666f 6375 7365 6420 6f76 6572 2074    focused over t
-00001940: 6865 206c 6f77 6573 7420 706f 7465 6e74  he lowest potent
-00001950: 6961 6c20 7265 7375 6c74 2e0d 0a20 2020  ial result...   
-00001960: 2069 6e63 6c75 6465 5f6e 6567 6174 6976   include_negativ
-00001970: 655f 696e 7465 7276 616c 203a 2062 6f6f  e_interval : boo
-00001980: 6c65 616e 2c20 6f70 7469 6f6e 616c 0d0a  lean, optional..
-00001990: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-000019a0: 2074 6865 6e20 616c 6c20 706f 7369 7469   then all positi
-000019b0: 7665 2061 6e64 206e 6567 6174 6976 6520  ve and negative 
-000019c0: 7661 6c75 6573 2061 7265 2063 6f6e 7369  values are consi
-000019d0: 6465 7265 640d 0a20 2020 2020 2020 2065  dered..        e
-000019e0: 2e67 2e2c 203c 302e 3520 776f 756c 6420  .g., <0.5 would 
-000019f0: 6265 2063 6f6e 7665 7274 6564 2074 6f20  be converted to 
-00001a00: 282d 6e70 2e69 6e66 2c35 292e 0d0a 2020  (-np.inf,5)...  
-00001a10: 2020 2020 2020 4966 2046 616c 7365 2c20        If False, 
-00001a20: 7468 656e 206f 6e6c 7920 6e6f 6e2d 6e65  then only non-ne
-00001a30: 6761 7469 7665 2076 616c 7565 7320 6172  gative values ar
-00001a40: 6520 636f 6e73 6964 6572 6564 0d0a 2020  e considered..  
-00001a50: 2020 2020 2020 652e 672e 2c20 3c30 2e35        e.g., <0.5
-00001a60: 2077 6f75 6c64 2062 6520 636f 6e76 6572   would be conver
-00001a70: 7465 6420 746f 205b 302c 3529 2e0d 0a20  ted to [0,5)... 
-00001a80: 2020 2020 2020 2054 6869 7320 7365 7474         This sett
-00001a90: 696e 6720 6f6e 6c79 2061 6666 6563 7473  ing only affects
-00001aa0: 2072 6573 756c 7473 2069 6620 666f 6375   results if focu
-00001ab0: 735f 6869 6768 5f70 6f74 656e 7469 616c  s_high_potential
-00001ac0: 2069 7320 4661 6c73 652e 0d0a 2020 2020   is False...    
-00001ad0: 2020 2020 5468 6520 6465 6661 756c 7420      The default 
-00001ae0: 6973 2046 616c 7365 2e0d 0a20 2020 2070  is False...    p
-00001af0: 7265 6369 7369 6f6e 5f74 6f6c 6572 616e  recision_toleran
-00001b00: 6365 5f74 6f5f 6472 6f70 5f63 656e 736f  ce_to_drop_censo
-00001b10: 7220 3a20 666c 6f61 742c 206f 7074 696f  r : float, optio
-00001b20: 6e61 6c0d 0a20 2020 2020 2020 2054 6872  nal..        Thr
-00001b30: 6573 686f 6c64 2066 6f72 2072 6570 6f72  eshold for repor
-00001b40: 7469 6e67 2063 656e 736f 7265 6420 7673  ting censored vs
-00001b50: 206e 6f6e 2d63 656e 736f 7265 6420 7265   non-censored re
-00001b60: 7375 6c74 732e 0d0a 2020 2020 2020 2020  sults...        
-00001b70: 5573 696e 6720 7468 6520 6465 6661 756c  Using the defaul
-00001b80: 742c 2061 2072 6573 756c 7420 7468 6174  t, a result that
-00001b90: 2069 7320 6b6e 6f77 6e20 746f 2062 6520   is known to be 
-00001ba0: 696e 2074 6865 2069 6e74 6572 7661 6c20  in the interval 
-00001bb0: 2830 2e33 2c20 302e 3529 0d0a 2020 2020  (0.3, 0.5)..    
-00001bc0: 2020 2020 776f 756c 6420 6265 2072 6574      would be ret
-00001bd0: 7572 6e65 6420 6173 2030 2e34 2c20 7768  urned as 0.4, wh
-00001be0: 6572 6561 7320 6120 746f 6c65 7261 6e63  ereas a toleranc
-00001bf0: 6520 6f66 2030 2077 6f75 6c64 2079 6965  e of 0 would yie
-00001c00: 6c64 2061 0d0a 2020 2020 2020 2020 7265  ld a..        re
-00001c10: 7375 6c74 206f 6620 3c30 2e35 206f 7220  sult of <0.5 or 
-00001c20: 3e30 2e33 2064 6570 656e 6469 6e67 206f  >0.3 depending o
-00001c30: 6e20 7468 6520 7661 6c75 6520 6f66 2066  n the value of f
-00001c40: 6f63 7573 5f68 6967 6865 7374 5f70 6f74  ocus_highest_pot
-00001c50: 656e 7469 616c 2e0d 0a20 2020 2020 2020  ential...       
-00001c60: 2054 6865 2064 6566 6175 6c74 2069 7320   The default is 
-00001c70: 302e 3235 2e0d 0a0d 0a20 2020 2052 6574  0.25.....    Ret
-00001c80: 7572 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d  urns..    ------
-00001c90: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
-00001ca0: 4672 616d 650d 0a20 2020 2020 2020 2044  Frame..        D
-00001cb0: 6174 6146 7261 6d65 2077 6865 7265 2069  ataFrame where i
-00001cc0: 6e74 6572 7661 6c73 2066 6f72 2072 6573  ntervals for res
-00001cd0: 756c 7473 2068 6176 6520 6265 656e 2061  ults have been a
-00001ce0: 6e61 6c79 7365 6420 746f 2063 656e 736f  nalysed to censo
-00001cf0: 7220 616e 640d 0a20 2020 2020 2020 206e  r and..        n
-00001d00: 756d 6572 6963 2063 6f6d 706f 6e65 6e74  umeric component
-00001d10: 732e 0d0a 0d0a 2020 2020 2727 270d 0a20  s.....    '''.. 
-00001d20: 2020 200d 0a20 2020 2023 2043 7265 6174     ..    # Creat
-00001d30: 6520 6120 636f 7079 206f 6620 7468 6520  e a copy of the 
-00001d40: 4461 7461 4672 616d 650d 0a20 2020 2064  DataFrame..    d
-00001d50: 6620 3d20 6466 2e63 6f70 7928 290d 0a20  f = df.copy().. 
-00001d60: 2020 200d 0a20 2020 2023 2044 6574 6572     ..    # Deter
-00001d70: 6d69 6e65 2074 6865 206d 6964 706f 696e  mine the midpoin
-00001d80: 7420 666f 7220 7468 6520 696e 7465 7276  t for the interv
-00001d90: 616c 2069 6620 6669 6e69 7465 2069 6e74  al if finite int
-00001da0: 6572 7661 6c0d 0a20 2020 2064 665b 6d69  erval..    df[mi
-00001db0: 6470 6f69 6e74 5f63 6f6c 5d20 3d20 6e70  dpoint_col] = np
-00001dc0: 2e77 6865 7265 2828 6466 5b6c 6566 745f  .where((df[left_
-00001dd0: 626f 756e 645f 636f 6c5d 203e 202d 6e70  bound_col] > -np
-00001de0: 2e69 6e66 2920 2620 2864 665b 7269 6768  .inf) & (df[righ
-00001df0: 745f 626f 756e 645f 636f 6c5d 203c 206e  t_bound_col] < n
-00001e00: 702e 696e 6629 2c0d 0a20 2020 2020 2020  p.inf),..       
-00001e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001e20: 2020 2020 2020 2030 2e35 202a 2028 6466         0.5 * (df
-00001e30: 5b6c 6566 745f 626f 756e 645f 636f 6c5d  [left_bound_col]
-00001e40: 202b 2064 665b 7269 6768 745f 626f 756e   + df[right_boun
-00001e50: 645f 636f 6c5d 292c 0d0a 2020 2020 2020  d_col]),..      
-00001e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001e70: 2020 2020 2020 2020 6e70 2e6e 616e 290d          np.nan).
-00001e80: 0a20 2020 200d 0a20 2020 200d 0a20 2020  .    ..    ..   
-00001e90: 2023 2044 6566 696e 6520 7468 6520 636f   # Define the co
-00001ea0: 6e64 6974 696f 6e73 2066 6f72 2061 6e20  nditions for an 
-00001eb0: 756e 6365 6e73 6f72 6564 2072 6573 756c  uncensored resul
-00001ec0: 740d 0a20 2020 2063 6f6e 6469 7469 6f6e  t..    condition
-00001ed0: 7320 3d20 5b0d 0a20 2020 2020 2020 2023  s = [..        #
-00001ee0: 2049 6620 7468 6520 626f 756e 6473 2061   If the bounds a
-00001ef0: 7265 2065 7175 616c 2c20 7468 656e 2074  re equal, then t
-00001f00: 6865 2072 6573 756c 7420 6973 2075 6e63  he result is unc
-00001f10: 656e 736f 7265 640d 0a20 2020 2020 2020  ensored..       
-00001f20: 2028 6466 5b6c 6566 745f 626f 756e 645f   (df[left_bound_
-00001f30: 636f 6c5d 203d 3d20 6466 5b72 6967 6874  col] == df[right
-00001f40: 5f62 6f75 6e64 5f63 6f6c 5d29 2c0d 0a20  _bound_col]),.. 
-00001f50: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
-00001f60: 626f 756e 6473 2061 7265 2066 696e 6974  bounds are finit
-00001f70: 6520 616e 6420 7468 6520 696e 7465 7276  e and the interv
-00001f80: 616c 2069 7320 7769 7468 696e 2074 6865  al is within the
-00001f90: 2070 7265 6369 7369 6f6e 2074 6f6c 6572   precision toler
-00001fa0: 616e 6365 2c20 6176 6f69 6420 7468 6520  ance, avoid the 
-00001fb0: 7573 6520 6f66 2063 656e 736f 7273 0d0a  use of censors..
-00001fc0: 2020 2020 2020 2020 2864 665b 7269 6768          (df[righ
-00001fd0: 745f 626f 756e 645f 636f 6c5d 202d 2064  t_bound_col] - d
-00001fe0: 665b 6d69 6470 6f69 6e74 5f63 6f6c 5d29  f[midpoint_col])
-00001ff0: 203c 3d20 6466 5b6d 6964 706f 696e 745f   <= df[midpoint_
-00002000: 636f 6c5d 202a 2070 7265 6369 7369 6f6e  col] * precision
-00002010: 5f74 6f6c 6572 616e 6365 5f74 6f5f 6472  _tolerance_to_dr
-00002020: 6f70 5f63 656e 736f 720d 0a20 2020 2020  op_censor..     
-00002030: 2020 205d 0d0a 2020 2020 0d0a 2020 2020     ]..    ..    
-00002040: 6365 6e73 6f72 5f72 6573 756c 7473 203d  censor_results =
-00002050: 205b 0d0a 2020 2020 2020 2020 2727 2c0d   [..        '',.
-00002060: 0a20 2020 2020 2020 2027 270d 0a20 2020  .        ''..   
-00002070: 2020 2020 205d 0d0a 2020 2020 0d0a 2020       ]..    ..  
-00002080: 2020 6e75 6d65 7269 635f 7265 7375 6c74    numeric_result
-00002090: 7320 3d5b 0d0a 2020 2020 2020 2020 6466  s =[..        df
-000020a0: 5b6d 6964 706f 696e 745f 636f 6c5d 2c0d  [midpoint_col],.
-000020b0: 0a20 2020 2020 2020 2064 665b 6d69 6470  .        df[midp
-000020c0: 6f69 6e74 5f63 6f6c 5d0d 0a20 2020 2020  oint_col]..     
-000020d0: 2020 205d 0d0a 2020 2020 0d0a 2020 2020     ]..    ..    
-000020e0: 2320 4966 2066 6f63 7573 6564 206f 6e20  # If focused on 
-000020f0: 7468 6520 6869 6768 6573 7420 706f 7465  the highest pote
-00002100: 6e74 6961 6c20 7265 7375 6c74 0d0a 2020  ntial result..  
-00002110: 2020 6966 2066 6f63 7573 5f68 6967 685f    if focus_high_
-00002120: 706f 7465 6e74 6961 6c3a 0d0a 2020 2020  potential:..    
-00002130: 2020 2020 2320 5365 7420 6365 6e73 6f72      # Set censor
-00002140: 2061 6e64 206e 756d 6572 6963 2063 6f6d   and numeric com
-00002150: 706f 6e65 6e74 7320 666f 7220 6561 6368  ponents for each
-00002160: 2063 6f6e 6469 7469 6f6e 0d0a 2020 2020   condition..    
-00002170: 2020 2020 636f 6e64 6974 696f 6e73 202b      conditions +
-00002180: 3d20 5b0d 0a20 2020 2020 2020 2020 2020  = [..           
-00002190: 2023 2049 6620 7468 6572 6520 6973 2061   # If there is a
-000021a0: 6e20 696e 6669 6e69 7465 2072 6967 6874  n infinite right
-000021b0: 2062 6f75 6e64 2c20 7468 6520 7265 7375   bound, the resu
-000021c0: 6c74 2069 7320 7269 6768 7420 6365 6e73  lt is right cens
-000021d0: 6f72 6564 0d0a 2020 2020 2020 2020 2020  ored..          
-000021e0: 2020 2864 665b 7269 6768 745f 626f 756e    (df[right_boun
-000021f0: 645f 636f 6c5d 203d 3d20 6e70 2e69 6e66  d_col] == np.inf
-00002200: 2920 2620 2864 665b 6c65 6674 5f62 6f75  ) & (df[left_bou
-00002210: 6e64 5f63 6f6c 5d20 3e20 2d6e 702e 696e  nd_col] > -np.in
-00002220: 6629 2026 2028 6466 5b6c 6566 745f 626f  f) & (df[left_bo
-00002230: 756e 6461 7279 5f63 6f6c 5d20 3d3d 2027  undary_col] == '
-00002240: 4f70 656e 2729 2c0d 0a20 2020 2020 2020  Open'),..       
-00002250: 2020 2020 2028 6466 5b72 6967 6874 5f62       (df[right_b
-00002260: 6f75 6e64 5f63 6f6c 5d20 3d3d 206e 702e  ound_col] == np.
-00002270: 696e 6629 2026 2028 6466 5b6c 6566 745f  inf) & (df[left_
-00002280: 626f 756e 645f 636f 6c5d 203e 202d 6e70  bound_col] > -np
-00002290: 2e69 6e66 2920 2620 2864 665b 6c65 6674  .inf) & (df[left
-000022a0: 5f62 6f75 6e64 6172 795f 636f 6c5d 203d  _boundary_col] =
-000022b0: 3d20 2743 6c6f 7365 6427 292c 0d0a 2020  = 'Closed'),..  
-000022c0: 2020 2020 2020 2020 2020 2320 4f74 6865            # Othe
-000022d0: 7277 6973 652c 2074 6865 2072 6573 756c  rwise, the resul
-000022e0: 7420 7368 6f75 6c64 2062 6520 6c65 6674  t should be left
-000022f0: 2063 656e 736f 7265 640d 0a20 2020 2020   censored..     
-00002300: 2020 2020 2020 2028 6466 5b72 6967 6874         (df[right
-00002310: 5f62 6f75 6e64 5f63 6f6c 5d20 3c20 6e70  _bound_col] < np
-00002320: 2e69 6e66 2920 2620 2864 665b 7269 6768  .inf) & (df[righ
-00002330: 745f 626f 756e 6461 7279 5f63 6f6c 5d20  t_boundary_col] 
-00002340: 3d3d 2027 4f70 656e 2729 2c0d 0a20 2020  == 'Open'),..   
-00002350: 2020 2020 2020 2020 2028 6466 5b72 6967           (df[rig
-00002360: 6874 5f62 6f75 6e64 5f63 6f6c 5d20 3c20  ht_bound_col] < 
-00002370: 6e70 2e69 6e66 2920 2620 2864 665b 7269  np.inf) & (df[ri
-00002380: 6768 745f 626f 756e 6461 7279 5f63 6f6c  ght_boundary_col
-00002390: 5d20 3d3d 2027 436c 6f73 6564 2729 0d0a  ] == 'Closed')..
-000023a0: 2020 2020 2020 2020 2020 2020 5d0d 0a20              ].. 
-000023b0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-000023c0: 2063 656e 736f 725f 7265 7375 6c74 7320   censor_results 
-000023d0: 2b3d 205b 0d0a 2020 2020 2020 2020 2020  += [..          
-000023e0: 2020 273e 272c 0d0a 2020 2020 2020 2020    '>',..        
-000023f0: 2020 2020 27e2 89a5 272c 0d0a 2020 2020      '...',..    
-00002400: 2020 2020 2020 2020 273c 272c 0d0a 2020          '<',..  
-00002410: 2020 2020 2020 2020 2020 27e2 89a4 270d            '...'.
-00002420: 0a20 2020 2020 2020 2020 2020 205d 0d0a  .            ]..
-00002430: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00002440: 2020 6e75 6d65 7269 635f 7265 7375 6c74    numeric_result
-00002450: 7320 2b3d 205b 0d0a 2020 2020 2020 2020  s += [..        
-00002460: 2020 2020 6466 5b6c 6566 745f 626f 756e      df[left_boun
-00002470: 645f 636f 6c5d 2c0d 0a20 2020 2020 2020  d_col],..       
-00002480: 2020 2020 2064 665b 6c65 6674 5f62 6f75       df[left_bou
-00002490: 6e64 5f63 6f6c 5d2c 0d0a 2020 2020 2020  nd_col],..      
-000024a0: 2020 2020 2020 6466 5b72 6967 6874 5f62        df[right_b
-000024b0: 6f75 6e64 5f63 6f6c 5d2c 0d0a 2020 2020  ound_col],..    
-000024c0: 2020 2020 2020 2020 6466 5b72 6967 6874          df[right
-000024d0: 5f62 6f75 6e64 5f63 6f6c 5d0d 0a20 2020  _bound_col]..   
-000024e0: 2020 2020 2020 2020 205d 0d0a 2020 2020           ]..    
-000024f0: 2320 456c 7365 2066 6f63 7573 6564 206f  # Else focused o
-00002500: 6e20 7468 6520 6c6f 7765 7374 2070 6f74  n the lowest pot
-00002510: 656e 7469 616c 2072 6573 756c 740d 0a20  ential result.. 
-00002520: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00002530: 2020 2320 4465 7465 726d 696e 6520 7468    # Determine th
-00002540: 6520 6c6f 7765 7220 626f 756e 640d 0a20  e lower bound.. 
-00002550: 2020 2020 2020 2069 6620 696e 636c 7564         if includ
-00002560: 655f 6e65 6761 7469 7665 5f69 6e74 6572  e_negative_inter
-00002570: 7661 6c3a 0d0a 2020 2020 2020 2020 2020  val:..          
-00002580: 2020 6c6f 7765 725f 626f 756e 6420 3d20    lower_bound = 
-00002590: 2d6e 702e 696e 660d 0a20 2020 2020 2020  -np.inf..       
-000025a0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-000025b0: 2020 2020 6c6f 7765 725f 626f 756e 6420      lower_bound 
-000025c0: 3d20 302e 300d 0a20 2020 2020 2020 2023  = 0.0..        #
-000025d0: 2053 6574 2063 656e 736f 7220 616e 6420   Set censor and 
-000025e0: 6e75 6d65 7269 6320 636f 6d70 6f6e 656e  numeric componen
-000025f0: 7473 2066 6f72 2065 6163 6820 636f 6e64  ts for each cond
-00002600: 6974 696f 6e0d 0a20 2020 2020 2020 2063  ition..        c
-00002610: 6f6e 6469 7469 6f6e 7320 2b3d 205b 0d0a  onditions += [..
-00002620: 2020 2020 2020 2020 2020 2020 2320 4966              # If
-00002630: 2074 6865 206c 6566 7420 626f 756e 6420   the left bound 
-00002640: 6973 2069 6465 6e74 6963 616c 2074 6f20  is identical to 
-00002650: 7468 6520 6c6f 7765 7374 2070 6f74 656e  the lowest poten
-00002660: 7469 616c 206c 6f77 6572 2062 6f75 6e64  tial lower bound
-00002670: 2c0d 0a20 2020 2020 2020 2020 2020 2023  ,..            #
-00002680: 2074 6865 6e20 7468 6520 7265 7375 6c74   then the result
-00002690: 2069 7320 6c65 6674 2063 656e 736f 7265   is left censore
-000026a0: 640d 0a20 2020 2020 2020 2020 2020 2028  d..            (
-000026b0: 6466 5b6c 6566 745f 626f 756e 645f 636f  df[left_bound_co
-000026c0: 6c5d 203d 3d20 6c6f 7765 725f 626f 756e  l] == lower_boun
-000026d0: 6429 2026 2028 6466 5b72 6967 6874 5f62  d) & (df[right_b
-000026e0: 6f75 6e64 5f63 6f6c 5d20 3c20 6e70 2e69  ound_col] < np.i
-000026f0: 6e66 2920 2620 2864 665b 7269 6768 745f  nf) & (df[right_
-00002700: 626f 756e 6461 7279 5f63 6f6c 5d20 3d3d  boundary_col] ==
-00002710: 2027 4f70 656e 2729 2c0d 0a20 2020 2020   'Open'),..     
-00002720: 2020 2020 2020 2028 6466 5b6c 6566 745f         (df[left_
-00002730: 626f 756e 645f 636f 6c5d 203d 3d20 6c6f  bound_col] == lo
-00002740: 7765 725f 626f 756e 6429 2026 2028 6466  wer_bound) & (df
-00002750: 5b72 6967 6874 5f62 6f75 6e64 5f63 6f6c  [right_bound_col
-00002760: 5d20 3c20 6e70 2e69 6e66 2920 2620 2864  ] < np.inf) & (d
-00002770: 665b 7269 6768 745f 626f 756e 6461 7279  f[right_boundary
-00002780: 5f63 6f6c 5d20 3d3d 2027 436c 6f73 6564  _col] == 'Closed
-00002790: 2729 2c0d 0a20 2020 2020 2020 2020 2020  '),..           
-000027a0: 2023 204f 7468 6572 7769 7365 2c20 7468   # Otherwise, th
-000027b0: 6520 7265 7375 6c74 2073 686f 756c 6420  e result should 
-000027c0: 6265 2072 6967 6874 2063 656e 736f 7265  be right censore
-000027d0: 640d 0a20 2020 2020 2020 2020 2020 2028  d..            (
-000027e0: 6466 5b6c 6566 745f 626f 756e 645f 636f  df[left_bound_co
-000027f0: 6c5d 203e 206c 6f77 6572 5f62 6f75 6e64  l] > lower_bound
-00002800: 2920 2620 2864 665b 6c65 6674 5f62 6f75  ) & (df[left_bou
-00002810: 6e64 6172 795f 636f 6c5d 203d 3d20 274f  ndary_col] == 'O
-00002820: 7065 6e27 292c 0d0a 2020 2020 2020 2020  pen'),..        
-00002830: 2020 2020 2864 665b 6c65 6674 5f62 6f75      (df[left_bou
-00002840: 6e64 5f63 6f6c 5d20 3e20 6c6f 7765 725f  nd_col] > lower_
-00002850: 626f 756e 6429 2026 2028 6466 5b6c 6566  bound) & (df[lef
-00002860: 745f 626f 756e 6461 7279 5f63 6f6c 5d20  t_boundary_col] 
-00002870: 3d3d 2027 436c 6f73 6564 2729 0d0a 2020  == 'Closed')..  
-00002880: 2020 2020 2020 2020 2020 5d0d 0a20 2020            ]..   
-00002890: 2020 2020 200d 0a20 2020 2020 2020 2063       ..        c
-000028a0: 656e 736f 725f 7265 7375 6c74 7320 2b3d  ensor_results +=
-000028b0: 205b 0d0a 2020 2020 2020 2020 2020 2020   [..            
-000028c0: 273c 272c 0d0a 2020 2020 2020 2020 2020  '<',..          
-000028d0: 2020 27e2 89a4 272c 0d0a 2020 2020 2020    '...',..      
-000028e0: 2020 2020 2020 273e 272c 0d0a 2020 2020        '>',..    
-000028f0: 2020 2020 2020 2020 27e2 89a5 270d 0a20          '...'.. 
-00002900: 2020 2020 2020 2020 2020 205d 0d0a 2020             ]..  
-00002910: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00002920: 6e75 6d65 7269 635f 7265 7375 6c74 7320  numeric_results 
-00002930: 2b3d 205b 0d0a 2020 2020 2020 2020 2020  += [..          
-00002940: 2020 6466 5b72 6967 6874 5f62 6f75 6e64    df[right_bound
-00002950: 5f63 6f6c 5d2c 0d0a 2020 2020 2020 2020  _col],..        
-00002960: 2020 2020 6466 5b72 6967 6874 5f62 6f75      df[right_bou
-00002970: 6e64 5f63 6f6c 5d2c 0d0a 2020 2020 2020  nd_col],..      
-00002980: 2020 2020 2020 6466 5b6c 6566 745f 626f        df[left_bo
-00002990: 756e 645f 636f 6c5d 2c0d 0a20 2020 2020  und_col],..     
-000029a0: 2020 2020 2020 2064 665b 6c65 6674 5f62         df[left_b
-000029b0: 6f75 6e64 5f63 6f6c 5d0d 0a20 2020 2020  ound_col]..     
-000029c0: 2020 2020 2020 205d 0d0a 2020 2020 0d0a         ]..    ..
-000029d0: 2020 2020 2320 4465 7465 726d 696e 6520      # Determine 
-000029e0: 7468 6520 6365 6e73 6f72 2061 6e64 206e  the censor and n
-000029f0: 756d 6572 6963 2063 6f6d 706f 6e65 6e74  umeric component
-00002a00: 730d 0a20 2020 2023 2049 6620 6e6f 2063  s..    # If no c
-00002a10: 6f6e 6469 7469 6f6e 2069 7320 6d65 742c  ondition is met,
-00002a20: 2064 6566 6175 6c74 2074 6f20 3c3e 2061   default to <> a
-00002a30: 6e64 204e 614e 0d0a 2020 2020 6466 5b63  nd NaN..    df[c
-00002a40: 656e 736f 725f 636f 6c5d 203d 206e 702e  ensor_col] = np.
-00002a50: 7365 6c65 6374 2863 6f6e 6469 7469 6f6e  select(condition
-00002a60: 732c 2063 656e 736f 725f 7265 7375 6c74  s, censor_result
-00002a70: 732c 2027 3c3e 2729 0d0a 2020 2020 6466  s, '<>')..    df
-00002a80: 5b6e 756d 6572 6963 5f63 6f6c 5d20 3d20  [numeric_col] = 
-00002a90: 6e70 2e73 656c 6563 7428 636f 6e64 6974  np.select(condit
-00002aa0: 696f 6e73 2c20 6e75 6d65 7269 635f 7265  ions, numeric_re
-00002ab0: 7375 6c74 732c 206e 702e 6e61 6e29 0d0a  sults, np.nan)..
-00002ac0: 2020 2020 0d0a 2020 2020 7265 7475 726e      ..    return
-00002ad0: 2064 660d 0a0d 0a23 2525 2520 496e 7465   df....#%%% Inte
-00002ae0: 7276 616c 2063 6f6d 706f 6e65 6e74 7320  rval components 
-00002af0: 746f 2069 6e74 6572 7661 6c20 7374 7269  to interval stri
-00002b00: 6e67 0d0a 0d0a 6465 6620 696e 7465 7276  ng....def interv
-00002b10: 616c 5f6e 6f74 6174 696f 6e28 6466 2c0d  al_notation(df,.
-00002b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002b30: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
-00002b40: 5f72 6f75 6e64 696e 673d 5472 7565 293a  _rounding=True):
-00002b50: 0d0a 2020 2020 2727 270d 0a20 2020 2054  ..    '''..    T
-00002b60: 6869 7320 6675 6e63 7469 6f6e 2063 7265  his function cre
-00002b70: 6174 6573 2061 2063 6f6c 756d 6e20 7468  ates a column th
-00002b80: 6174 2063 6f6d 6269 6e65 7320 7468 6520  at combines the 
-00002b90: 696e 7465 7276 616c 2063 6f6d 706f 6e65  interval compone
-00002ba0: 6e74 730d 0a20 2020 2069 6e74 6f20 6120  nts..    into a 
-00002bb0: 7369 6e67 6c65 2074 6578 7420 6e6f 7461  single text nota
-00002bc0: 7469 6f6e 2066 6f72 2069 6e74 6572 7661  tion for interva
-00002bd0: 6c73 2e0d 0a0d 0a20 2020 2050 6172 616d  ls.....    Param
-00002be0: 6574 6572 730d 0a20 2020 202d 2d2d 2d2d  eters..    -----
-00002bf0: 2d2d 2d2d 2d0d 0a20 2020 2064 6620 3a20  -----..    df : 
-00002c00: 4461 7461 4672 616d 650d 0a20 2020 2020  DataFrame..     
-00002c10: 2020 2044 6174 6146 7261 6d65 2063 6f6e     DataFrame con
-00002c20: 7461 696e 696e 6720 636f 6c75 6d6e 7320  taining columns 
-00002c30: 666f 7220 6c65 6674 2f72 6967 6874 2062  for left/right b
-00002c40: 6f75 6e64 7320 616e 6420 626f 756e 6461  ounds and bounda
-00002c50: 7269 6573 0d0a 2020 2020 7072 6563 6973  ries..    precis
-00002c60: 696f 6e5f 726f 756e 6469 6e67 203a 2062  ion_rounding : b
-00002c70: 6f6f 6c65 616e 2c20 6f70 7469 6f6e 616c  oolean, optional
-00002c80: 0d0a 2020 2020 2020 2020 4966 2054 7275  ..        If Tru
-00002c90: 652c 2061 2072 6f75 6e64 696e 6720 6d65  e, a rounding me
-00002ca0: 7468 6f64 2069 7320 6170 706c 6965 6420  thod is applied 
-00002cb0: 746f 2072 6f75 6e64 2072 6573 756c 7473  to round results
-00002cc0: 2074 6f20 6861 7665 206e 6f20 6d6f 7265   to have no more
-00002cd0: 0d0a 2020 2020 2020 2020 6465 6369 6d61  ..        decima
-00002ce0: 6c73 2074 6861 6e20 7768 6174 2063 616e  ls than what can
-00002cf0: 2062 6520 6d65 6173 7572 6564 2e0d 0a20   be measured... 
-00002d00: 2020 2020 2020 2054 6865 2064 6566 6175         The defau
-00002d10: 6c74 2069 7320 5472 7565 2e0d 0a0d 0a20  lt is True..... 
-00002d20: 2020 2052 6574 7572 6e73 0d0a 2020 2020     Returns..    
-00002d30: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6620  -------..    df 
-00002d40: 3a20 4461 7461 4672 616d 650d 0a20 2020  : DataFrame..   
-00002d50: 2020 2020 2044 6174 6146 7261 6d65 2069       DataFrame i
-00002d60: 6465 6e74 6963 616c 2074 6f20 696e 7470  dentical to intp
-00002d70: 7574 2077 6974 6820 6164 6469 7469 6f6e  ut with addition
-00002d80: 616c 2063 6f6c 756d 6e20 7769 7468 2063  al column with c
-00002d90: 6f6d 6269 6e65 640d 0a20 2020 2020 2020  ombined..       
-00002da0: 2069 6e74 6572 7661 6c20 6e6f 7461 7469   interval notati
-00002db0: 6f6e 0d0a 0d0a 2020 2020 2727 270d 0a20  on....    '''.. 
-00002dc0: 2020 200d 0a20 2020 2023 2043 7265 6174     ..    # Creat
-00002dd0: 6520 6120 636f 7079 206f 6620 7468 6520  e a copy of the 
-00002de0: 4461 7461 4672 616d 650d 0a20 2020 2064  DataFrame..    d
-00002df0: 6620 3d20 6466 2e63 6f70 7928 290d 0a20  f = df.copy().. 
-00002e00: 2020 200d 0a20 2020 2023 2044 6574 6572     ..    # Deter
-00002e10: 6d69 6e65 2074 6865 206c 6566 7420 626f  mine the left bo
-00002e20: 756e 6461 7279 2073 796d 626f 6c0d 0a20  undary symbol.. 
-00002e30: 2020 2064 665b 696e 7465 7276 616c 5f63     df[interval_c
-00002e40: 6f6c 5d20 3d20 6e70 2e77 6865 7265 2864  ol] = np.where(d
-00002e50: 665b 6c65 6674 5f62 6f75 6e64 6172 795f  f[left_boundary_
-00002e60: 636f 6c5d 203d 3d20 274f 7065 6e27 2c20  col] == 'Open', 
-00002e70: 2728 272c 2027 5b27 290d 0a20 2020 200d  '(', '[')..    .
-00002e80: 0a20 2020 2023 2049 6e63 6f72 706f 7261  .    # Incorpora
-00002e90: 7465 206c 6566 7420 616e 6420 7269 6768  te left and righ
-00002ea0: 7420 626f 756e 6473 0d0a 2020 2020 6966  t bounds..    if
-00002eb0: 2070 7265 6369 7369 6f6e 5f72 6f75 6e64   precision_round
-00002ec0: 696e 673a 0d0a 2020 2020 2020 2020 6466  ing:..        df
-00002ed0: 5b69 6e74 6572 7661 6c5f 636f 6c5d 202b  [interval_col] +
-00002ee0: 3d20 6466 5b6c 6566 745f 626f 756e 645f  = df[left_bound_
-00002ef0: 636f 6c5d 2e61 7070 6c79 2873 7472 696e  col].apply(strin
-00002f00: 675f 7072 6563 6973 696f 6e29 202b 2027  g_precision) + '
-00002f10: 2c20 2720 2b20 6466 5b72 6967 6874 5f62  , ' + df[right_b
-00002f20: 6f75 6e64 5f63 6f6c 5d2e 6170 706c 7928  ound_col].apply(
-00002f30: 7374 7269 6e67 5f70 7265 6369 7369 6f6e  string_precision
-00002f40: 290d 0a20 2020 2065 6c73 653a 0d0a 2020  )..    else:..  
-00002f50: 2020 2020 2020 6466 5b69 6e74 6572 7661        df[interva
-00002f60: 6c5f 636f 6c5d 202b 3d20 6466 5b6c 6566  l_col] += df[lef
-00002f70: 745f 626f 756e 645f 636f 6c5d 2e61 7374  t_bound_col].ast
-00002f80: 7970 6528 7374 7229 202b 2027 2c20 2720  ype(str) + ', ' 
-00002f90: 2b20 6466 5b72 6967 6874 5f62 6f75 6e64  + df[right_bound
-00002fa0: 5f63 6f6c 5d2e 6173 7479 7065 2873 7472  _col].astype(str
-00002fb0: 290d 0a20 2020 200d 0a20 2020 2023 2044  )..    ..    # D
-00002fc0: 6574 6572 6d69 6e65 2074 6865 2072 6967  etermine the rig
-00002fd0: 6874 2062 6f75 6e64 6172 7920 7379 6d62  ht boundary symb
-00002fe0: 6f6c 0d0a 2020 2020 6466 5b69 6e74 6572  ol..    df[inter
-00002ff0: 7661 6c5f 636f 6c5d 202b 3d20 6e70 2e77  val_col] += np.w
-00003000: 6865 7265 2864 665b 7269 6768 745f 626f  here(df[right_bo
-00003010: 756e 6461 7279 5f63 6f6c 5d2e 6973 696e  undary_col].isin
-00003020: 285b 274f 7065 6e27 5d29 2c20 2729 272c  (['Open']), ')',
-00003030: 2027 5d27 290d 0a20 2020 200d 0a20 2020   ']')..    ..   
-00003040: 2072 6574 7572 6e20 6466 0d0a 0d0a 0d0a   return df......
-00003050: 2325 2520 4d61 7869 6d75 6d20 5265 7375  #%% Maximum Resu
-00003060: 6c74 0d0a 0d0a 6465 6620 6d61 7869 6d75  lt....def maximu
-00003070: 6d5f 696e 7465 7276 616c 2864 662c 0d0a  m_interval(df,..
-00003080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003090: 2020 2020 2067 726f 7570 6279 5f63 6f6c       groupby_col
-000030a0: 756d 6e73 293a 0d0a 2020 2020 2727 270d  umns):..    '''.
-000030b0: 0a20 2020 2041 2066 756e 6374 696f 6e20  .    A function 
-000030c0: 7468 6174 2061 6e61 6c79 7365 7320 7468  that analyses th
-000030d0: 6520 696e 7465 7276 616c 206e 6f74 6174  e interval notat
-000030e0: 696f 6e20 666f 726d 206f 6620 7265 7375  ion form of resu
-000030f0: 6c74 7320 7265 7475 726e 6564 0d0a 2020  lts returned..  
-00003100: 2020 6672 6f6d 2063 6f6d 706f 6e65 6e74    from component
-00003110: 735f 746f 5f69 6e74 6572 7661 6c20 746f  s_to_interval to
-00003120: 2067 656e 6572 6174 6520 6120 6e65 7720   generate a new 
-00003130: 696e 7465 7276 616c 2066 6f72 2074 6865  interval for the
-00003140: 206d 6178 696d 756d 2e20 4772 6f75 7073   maximum. Groups
-00003150: 0d0a 2020 2020 6f66 2072 6573 756c 7473  ..    of results
-00003160: 2063 616e 2062 6520 6465 6669 6e65 6420   can be defined 
-00003170: 6279 2069 6e63 6c75 6469 6e67 2074 6865  by including the
-00003180: 2063 6f6c 756d 6e73 2074 6861 7420 7368   columns that sh
-00003190: 6f75 6c64 2062 6520 7573 6564 2074 6f0d  ould be used to.
-000031a0: 0a20 2020 2063 7265 6174 6520 6772 6f75  .    create grou
-000031b0: 7073 2e0d 0a0d 0a20 2020 2050 6172 616d  ps.....    Param
-000031c0: 6574 6572 730d 0a20 2020 202d 2d2d 2d2d  eters..    -----
-000031d0: 2d2d 2d2d 2d0d 0a20 2020 2064 6620 3a20  -----..    df : 
-000031e0: 4461 7461 4672 616d 650d 0a20 2020 2020  DataFrame..     
-000031f0: 2020 2044 6174 6146 7261 6d65 2074 6861     DataFrame tha
-00003200: 7420 636f 6e74 6169 6e73 2072 6573 756c  t contains resul
-00003210: 7473 2069 6e20 6120 7370 6563 6966 6963  ts in a specific
-00003220: 2069 6e74 6572 7661 6c20 6e6f 7461 7469   interval notati
-00003230: 6f6e 2e0d 0a20 2020 2067 726f 7570 6279  on...    groupby
-00003240: 5f63 6f6c 756d 6e73 203a 206c 6973 7420  _columns : list 
-00003250: 6f66 2073 7472 696e 6773 0d0a 2020 2020  of strings..    
-00003260: 2020 2020 4c69 7374 206f 6620 636f 6c75      List of colu
-00003270: 6d6e 206e 616d 6573 2074 6861 7420 7368  mn names that sh
-00003280: 6f75 6c64 2062 6520 7573 6564 2074 6f20  ould be used to 
-00003290: 6372 6561 7465 2067 726f 7570 732e 0d0a  create groups...
-000032a0: 0d0a 2020 2020 5265 7475 726e 730d 0a20  ..    Returns.. 
-000032b0: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
-000032c0: 6466 203a 2044 6174 6146 7261 6d65 0d0a  df : DataFrame..
-000032d0: 2020 2020 2020 2020 4461 7461 4672 616d          DataFram
-000032e0: 6520 7468 6174 2068 6173 2074 6865 2069  e that has the i
-000032f0: 6e74 6572 7661 6c20 666f 7220 7468 6520  nterval for the 
-00003300: 6d61 7869 6d75 6d20 2866 6f72 2065 6163  maximum (for eac
-00003310: 6820 6772 6f75 7020 6966 0d0a 2020 2020  h group if..    
-00003320: 2020 2020 636f 6c75 6d6e 206e 616d 6573      column names
-00003330: 2061 7265 2070 726f 7669 6465 6420 666f   are provided fo
-00003340: 7220 6772 6f75 7069 6e67 290d 0a0d 0a20  r grouping).... 
-00003350: 2020 2027 2727 0d0a 2020 2020 0d0a 2020     '''..    ..  
-00003360: 2020 2320 4372 6561 7465 2061 2063 6f70    # Create a cop
-00003370: 7920 6f66 2074 6865 2044 6174 6146 7261  y of the DataFra
-00003380: 6d65 0d0a 2020 2020 6466 203d 2064 662e  me..    df = df.
-00003390: 636f 7079 2829 2e72 6573 6574 5f69 6e64  copy().reset_ind
-000033a0: 6578 2829 0d0a 2020 2020 0d0a 2020 2020  ex()..    ..    
-000033b0: 2320 4372 6561 7465 2063 6f6c 756d 6e20  # Create column 
-000033c0: 7468 6174 2069 6e64 6963 6174 6573 2074  that indicates t
-000033d0: 6865 2067 656e 6572 6174 6564 2073 7461  he generated sta
-000033e0: 7469 7374 6963 2061 6e64 2061 7070 656e  tistic and appen
-000033f0: 6420 746f 2067 726f 7570 696e 6720 6c69  d to grouping li
-00003400: 7374 0d0a 2020 2020 6466 5b73 7461 745f  st..    df[stat_
-00003410: 636f 6c5d 203d 2027 4d61 7869 6d75 6d27  col] = 'Maximum'
-00003420: 0d0a 2020 2020 6772 6f75 7062 795f 636f  ..    groupby_co
-00003430: 6c75 6d6e 732e 6170 7065 6e64 2873 7461  lumns.append(sta
-00003440: 745f 636f 6c29 0d0a 2020 2020 0d0a 2020  t_col)..    ..  
-00003450: 2020 2320 4465 7465 726d 696e 6520 6c65    # Determine le
-00003460: 6674 2062 6f75 6e64 2061 6e64 2062 6f75  ft bound and bou
-00003470: 6e64 6172 7920 666f 7220 6d61 7869 6d75  ndary for maximu
-00003480: 6d20 666f 7220 6561 6368 2067 726f 7570  m for each group
-00003490: 2e0d 0a20 2020 200d 0a20 2020 2023 2043  ...    ..    # C
-000034a0: 6f6e 7369 6465 7220 7468 6520 6d61 7869  onsider the maxi
-000034b0: 6d75 6d20 626f 756e 6420 666f 7220 6561  mum bound for ea
-000034c0: 6368 206c 6566 7420 626f 756e 6461 7279  ch left boundary
-000034d0: 206f 7074 696f 6e20 746f 2064 6574 6572   option to deter
-000034e0: 6d69 6e65 0d0a 2020 2020 2320 7768 6574  mine..    # whet
-000034f0: 6865 7220 7468 6520 626f 756e 6420 7368  her the bound sh
-00003500: 6f75 6c64 2062 6520 6f70 656e 206f 7220  ould be open or 
-00003510: 636c 6f73 6564 2e0d 0a20 2020 206c 6566  closed...    lef
-00003520: 7420 3d20 6466 2e67 726f 7570 6279 2867  t = df.groupby(g
-00003530: 726f 7570 6279 5f63 6f6c 756d 6e73 2b5b  roupby_columns+[
-00003540: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
-00003550: 6c5d 295b 6c65 6674 5f62 6f75 6e64 5f63  l])[left_bound_c
-00003560: 6f6c 5d2e 6d61 7828 292e 756e 7374 6163  ol].max().unstac
-00003570: 6b28 6c65 6674 5f62 6f75 6e64 6172 795f  k(left_boundary_
-00003580: 636f 6c29 0d0a 2020 2020 2320 4372 6561  col)..    # Crea
-00003590: 7465 206d 6973 7369 6e67 2063 6f6c 756d  te missing colum
-000035a0: 6e73 0d0a 2020 2020 666f 7220 6974 656d  ns..    for item
-000035b0: 2069 6e20 5b27 4f70 656e 272c 2743 6c6f   in ['Open','Clo
-000035c0: 7365 6427 5d3a 0d0a 2020 2020 2020 2020  sed']:..        
-000035d0: 6966 2069 7465 6d20 6e6f 7420 696e 206c  if item not in l
-000035e0: 6566 742e 636f 6c75 6d6e 733a 0d0a 2020  eft.columns:..  
-000035f0: 2020 2020 2020 2020 2020 6c65 6674 5b69            left[i
-00003600: 7465 6d5d 203d 206e 702e 6e61 6e0d 0a20  tem] = np.nan.. 
-00003610: 2020 2023 2055 7365 2074 6865 206d 6178     # Use the max
-00003620: 696d 756d 2063 6c6f 7365 6420 626f 756e  imum closed boun
-00003630: 6461 7279 2069 6620 7468 6572 6520 6172  dary if there ar
-00003640: 6520 6e6f 206f 7065 6e20 626f 756e 6461  e no open bounda
-00003650: 7269 6573 206f 720d 0a20 2020 2023 2069  ries or..    # i
-00003660: 6620 7468 6520 636c 6f73 6564 2062 6f75  f the closed bou
-00003670: 6e64 6172 7920 6973 206c 6172 6765 7220  ndary is larger 
-00003680: 7468 616e 2074 6865 206c 6172 6765 7374  than the largest
-00003690: 206f 7065 6e20 626f 756e 6461 7279 0d0a   open boundary..
-000036a0: 2020 2020 636f 6e64 6974 696f 6e20 3d20      condition = 
-000036b0: 286c 6566 745b 2743 6c6f 7365 6427 5d20  (left['Closed'] 
-000036c0: 3e20 6c65 6674 5b27 4f70 656e 275d 2920  > left['Open']) 
-000036d0: 7c20 286c 6566 745b 274f 7065 6e27 5d2e  | (left['Open'].
-000036e0: 6973 6e61 2829 290d 0a20 2020 206c 6566  isna())..    lef
-000036f0: 745b 6c65 6674 5f62 6f75 6e64 6172 795f  t[left_boundary_
-00003700: 636f 6c5d 203d 206e 702e 7768 6572 6528  col] = np.where(
-00003710: 636f 6e64 6974 696f 6e2c 2743 6c6f 7365  condition,'Close
-00003720: 6427 2c27 4f70 656e 2729 0d0a 2020 2020  d','Open')..    
-00003730: 6c65 6674 5b6c 6566 745f 626f 756e 645f  left[left_bound_
-00003740: 636f 6c5d 203d 206e 702e 7768 6572 6528  col] = np.where(
-00003750: 636f 6e64 6974 696f 6e2c 6c65 6674 5b27  condition,left['
-00003760: 436c 6f73 6564 275d 2c6c 6566 745b 274f  Closed'],left['O
-00003770: 7065 6e27 5d29 0d0a 2020 2020 6c65 6674  pen'])..    left
-00003780: 203d 206c 6566 745b 5b6c 6566 745f 626f   = left[[left_bo
-00003790: 756e 6461 7279 5f63 6f6c 2c6c 6566 745f  undary_col,left_
-000037a0: 626f 756e 645f 636f 6c5d 5d0d 0a20 2020  bound_col]]..   
-000037b0: 200d 0a20 2020 2023 2044 6574 6572 6d69   ..    # Determi
-000037c0: 6e65 2072 6967 6874 2062 6f75 6e64 2061  ne right bound a
-000037d0: 6e64 2062 6f75 6e64 6172 7920 666f 7220  nd boundary for 
-000037e0: 6d61 7869 6d75 6d20 666f 7220 6561 6368  maximum for each
-000037f0: 2067 726f 7570 2e0d 0a20 2020 200d 0a20   group...    .. 
-00003800: 2020 2023 2043 6f6e 7369 6465 7220 7468     # Consider th
-00003810: 6520 6d61 7869 6d75 6d20 626f 756e 6420  e maximum bound 
-00003820: 666f 7220 6561 6368 2072 6967 6874 2062  for each right b
-00003830: 6f75 6e64 6172 7920 6f70 7469 6f6e 2074  oundary option t
-00003840: 6f20 6465 7465 726d 696e 650d 0a20 2020  o determine..   
-00003850: 2023 2077 6865 7468 6572 2074 6865 2062   # whether the b
-00003860: 6f75 6e64 2073 686f 756c 6420 6265 206f  ound should be o
-00003870: 7065 6e20 6f72 2063 6c6f 7365 642e 0d0a  pen or closed...
-00003880: 2020 2020 7269 6768 7420 3d20 6466 2e67      right = df.g
-00003890: 726f 7570 6279 2867 726f 7570 6279 5f63  roupby(groupby_c
-000038a0: 6f6c 756d 6e73 2b5b 7269 6768 745f 626f  olumns+[right_bo
-000038b0: 756e 6461 7279 5f63 6f6c 5d29 5b72 6967  undary_col])[rig
-000038c0: 6874 5f62 6f75 6e64 5f63 6f6c 5d2e 6d61  ht_bound_col].ma
-000038d0: 7828 292e 756e 7374 6163 6b28 7269 6768  x().unstack(righ
-000038e0: 745f 626f 756e 6461 7279 5f63 6f6c 290d  t_boundary_col).
-000038f0: 0a20 2020 2023 2043 7265 6174 6520 6d69  .    # Create mi
-00003900: 7373 696e 6720 636f 6c75 6d6e 730d 0a20  ssing columns.. 
-00003910: 2020 2066 6f72 2069 7465 6d20 696e 205b     for item in [
-00003920: 274f 7065 6e27 2c27 436c 6f73 6564 275d  'Open','Closed']
-00003930: 3a0d 0a20 2020 2020 2020 2069 6620 6974  :..        if it
-00003940: 656d 206e 6f74 2069 6e20 7269 6768 742e  em not in right.
-00003950: 636f 6c75 6d6e 733a 0d0a 2020 2020 2020  columns:..      
-00003960: 2020 2020 2020 7269 6768 745b 6974 656d        right[item
-00003970: 5d20 3d20 6e70 2e6e 616e 0d0a 2020 2020  ] = np.nan..    
-00003980: 2320 5573 6520 7468 6520 6d61 7869 6d75  # Use the maximu
-00003990: 6d20 636c 6f73 6564 2062 6f75 6e64 6172  m closed boundar
-000039a0: 7920 6966 2074 6865 7265 2061 7265 206e  y if there are n
-000039b0: 6f20 6f70 656e 2062 6f75 6e64 6172 6965  o open boundarie
-000039c0: 7320 6f72 0d0a 2020 2020 2320 6966 2074  s or..    # if t
-000039d0: 6865 2063 6c6f 7365 6420 626f 756e 6461  he closed bounda
-000039e0: 7279 2069 7320 6c61 7267 6572 2074 6861  ry is larger tha
-000039f0: 6e20 6f72 2065 7175 616c 2074 6f20 7468  n or equal to th
-00003a00: 6520 6c61 7267 6573 7420 6f70 656e 2062  e largest open b
-00003a10: 6f75 6e64 6172 790d 0a20 2020 2063 6f6e  oundary..    con
-00003a20: 6469 7469 6f6e 203d 2028 7269 6768 745b  dition = (right[
-00003a30: 2743 6c6f 7365 6427 5d20 3e3d 2072 6967  'Closed'] >= rig
-00003a40: 6874 5b27 4f70 656e 275d 2920 7c20 2872  ht['Open']) | (r
-00003a50: 6967 6874 5b27 4f70 656e 275d 2e69 736e  ight['Open'].isn
-00003a60: 6128 2929 0d0a 2020 2020 7269 6768 745b  a())..    right[
-00003a70: 7269 6768 745f 626f 756e 645f 636f 6c5d  right_bound_col]
-00003a80: 203d 206e 702e 7768 6572 6528 636f 6e64   = np.where(cond
-00003a90: 6974 696f 6e2c 7269 6768 745b 2743 6c6f  ition,right['Clo
-00003aa0: 7365 6427 5d2c 7269 6768 745b 274f 7065  sed'],right['Ope
-00003ab0: 6e27 5d29 0d0a 2020 2020 7269 6768 745b  n'])..    right[
-00003ac0: 7269 6768 745f 626f 756e 6461 7279 5f63  right_boundary_c
-00003ad0: 6f6c 5d20 3d20 6e70 2e77 6865 7265 2863  ol] = np.where(c
-00003ae0: 6f6e 6469 7469 6f6e 2c27 436c 6f73 6564  ondition,'Closed
-00003af0: 272c 274f 7065 6e27 290d 0a20 2020 2072  ','Open')..    r
-00003b00: 6967 6874 203d 2072 6967 6874 5b5b 7269  ight = right[[ri
-00003b10: 6768 745f 626f 756e 645f 636f 6c2c 7269  ght_bound_col,ri
-00003b20: 6768 745f 626f 756e 6461 7279 5f63 6f6c  ght_boundary_col
-00003b30: 5d5d 0d0a 2020 2020 0d0a 2020 2020 2320  ]]..    ..    # 
-00003b40: 4d65 7267 6520 7468 6520 7477 6f20 626f  Merge the two bo
-00003b50: 756e 6461 7269 6573 2074 6f20 6372 6561  undaries to crea
-00003b60: 7465 2074 6865 2069 6e74 6572 7661 6c20  te the interval 
-00003b70: 666f 7220 7468 6520 6d61 7869 6d75 6d0d  for the maximum.
-00003b80: 0a20 2020 2023 2043 6865 636b 2074 6861  .    # Check tha
-00003b90: 7420 7468 6520 6d65 7267 6520 6973 2031  t the merge is 1
-00003ba0: 2d74 6f2d 310d 0a20 2020 2064 6620 3d20  -to-1..    df = 
-00003bb0: 6c65 6674 2e6d 6572 6765 2872 6967 6874  left.merge(right
-00003bc0: 2c20 686f 7720 3d20 276f 7574 6572 272c  , how = 'outer',
-00003bd0: 206f 6e20 3d20 6772 6f75 7062 795f 636f   on = groupby_co
-00003be0: 6c75 6d6e 732c 2076 616c 6964 6174 6520  lumns, validate 
-00003bf0: 3d20 2731 3a31 2729 0d0a 2020 2020 0d0a  = '1:1')..    ..
-00003c00: 2020 2020 2320 5265 7365 7420 696e 6465      # Reset inde
-00003c10: 780d 0a20 2020 2064 6620 3d20 6466 2e72  x..    df = df.r
-00003c20: 6573 6574 5f69 6e64 6578 2829 0d0a 2020  eset_index()..  
-00003c30: 2020 0d0a 2020 2020 7265 7475 726e 2064    ..    return d
-00003c40: 660d 0a0d 0a64 6566 206d 6178 696d 756d  f....def maximum
-00003c50: 2864 662c 0d0a 2020 2020 2020 2020 2020  (df,..          
-00003c60: 2020 7265 7375 6c74 5f63 6f6c 2c0d 0a20    result_col,.. 
-00003c70: 2020 2020 2020 2020 2020 2067 726f 7570             group
-00003c80: 6279 5f63 6f6c 756d 6e73 203d 204e 6f6e  by_columns = Non
-00003c90: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00003ca0: 696e 636c 7564 655f 6e65 6761 7469 7665  include_negative
-00003cb0: 5f69 6e74 6572 7661 6c20 3d20 4661 6c73  _interval = Fals
-00003cc0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00003cd0: 7072 6563 6973 696f 6e5f 746f 6c65 7261  precision_tolera
-00003ce0: 6e63 655f 746f 5f64 726f 705f 6365 6e73  nce_to_drop_cens
-00003cf0: 6f72 203d 2030 2e32 352c 0d0a 2020 2020  or = 0.25,..    
-00003d00: 2020 2020 2020 2020 7072 6563 6973 696f          precisio
-00003d10: 6e5f 726f 756e 6469 6e67 203d 2054 7275  n_rounding = Tru
-00003d20: 6529 3a0d 0a20 2020 2027 2727 0d0a 2020  e):..    '''..  
-00003d30: 2020 4120 6675 6e63 7469 6f6e 2074 6861    A function tha
-00003d40: 7420 636f 6d62 696e 6573 2074 6865 2072  t combines the r
-00003d50: 656c 6576 616e 7420 6d61 7869 6d75 6d20  elevant maximum 
-00003d60: 616e 6420 7574 696c 6974 7920 6675 6e63  and utility func
-00003d70: 7469 6f6e 7320 746f 0d0a 2020 2020 6765  tions to..    ge
-00003d80: 6e65 7261 7465 2074 6865 206d 6178 696d  nerate the maxim
-00003d90: 6120 7265 7375 6c74 7320 666f 7220 6772  a results for gr
-00003da0: 6f75 7073 2077 6974 6869 6e20 6120 4461  oups within a Da
-00003db0: 7461 4672 616d 652e 0d0a 0d0a 2020 2020  taFrame.....    
-00003dc0: 5061 7261 6d65 7465 7273 0d0a 2020 2020  Parameters..    
-00003dd0: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
-00003de0: 6466 203a 2044 6174 6146 7261 6d65 0d0a  df : DataFrame..
-00003df0: 2020 2020 2020 2020 4461 7461 4672 616d          DataFram
-00003e00: 6520 7468 6174 2063 6f6e 7461 696e 7320  e that contains 
-00003e10: 6365 6e73 6f72 6564 206f 7220 756e 6365  censored or unce
-00003e20: 6e73 6f72 6564 2072 6573 756c 7473 0d0a  nsored results..
-00003e30: 2020 2020 7265 7375 6c74 5f63 6f6c 203a      result_col :
-00003e40: 2073 7472 696e 670d 0a20 2020 2020 2020   string..       
-00003e50: 2054 6865 2063 6f6c 756d 6e20 6e61 6d65   The column name
-00003e60: 2066 6f72 2074 6865 2063 6f6c 756d 6e20   for the column 
-00003e70: 7468 6174 2063 6f6e 7461 696e 2074 6865  that contain the
-00003e80: 2072 6573 756c 7473 2061 7320 7465 7874   results as text
-00003e90: 2e0d 0a20 2020 2020 2020 204f 6e6c 7920  ...        Only 
-00003ea0: 666f 7572 2070 6f73 7369 626c 6520 6365  four possible ce
-00003eb0: 6e73 6f72 7320 7368 6f75 6c64 2062 6520  nsors should be 
-00003ec0: 7573 6564 2028 3c2c e289 a42c e289 a52c  used (<,...,...,
-00003ed0: 3e29 2e0d 0a20 2020 2067 726f 7570 6279  >)...    groupby
-00003ee0: 5f63 6f6c 756d 6e73 203a 206c 6973 7473  _columns : lists
-00003ef0: 206f 6620 7374 7269 6e67 7320 286f 7220   of strings (or 
-00003f00: 6c69 7374 206f 6620 6c69 7374 7329 2c20  list of lists), 
-00003f10: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
-00003f20: 2020 4c69 7374 206f 6620 636f 6c75 6d6e    List of column
-00003f30: 206e 616d 6573 2074 6861 7420 7368 6f75   names that shou
-00003f40: 6c64 2062 6520 7573 6564 2074 6f20 6372  ld be used to cr
-00003f50: 6561 7465 2067 726f 7570 732e 2041 206d  eate groups. A m
-00003f60: 6178 696d 756d 0d0a 2020 2020 2020 2020  aximum..        
-00003f70: 7769 6c6c 2062 6520 666f 756e 6420 7769  will be found wi
-00003f80: 7468 696e 2065 6163 6820 6772 6f75 702e  thin each group.
-00003f90: 204d 756c 7469 706c 6520 6c69 7374 7320   Multiple lists 
-00003fa0: 6361 6e20 6265 2073 7570 706c 6965 6420  can be supplied 
-00003fb0: 746f 0d0a 2020 2020 2020 2020 7065 7266  to..        perf
-00003fc0: 6f72 6d20 7365 7175 656e 7469 616c 206d  orm sequential m
-00003fd0: 6178 696d 6120 6265 666f 7265 2063 6f6e  axima before con
-00003fe0: 7665 7274 696e 6720 696e 7465 7276 616c  verting interval
-00003ff0: 7320 746f 2061 2072 6573 756c 742e 0d0a  s to a result...
-00004000: 2020 2020 2020 2020 5468 6520 6465 6661          The defa
-00004010: 756c 7420 6973 204e 6f6e 652e 0d0a 2020  ult is None...  
-00004020: 2020 696e 636c 7564 655f 6e65 6761 7469    include_negati
-00004030: 7665 5f69 6e74 6572 7661 6c20 3a20 626f  ve_interval : bo
-00004040: 6f6c 6561 6e2c 206f 7074 696f 6e61 6c0d  olean, optional.
-00004050: 0a20 2020 2020 2020 2049 6620 5472 7565  .        If True
-00004060: 2c20 7468 656e 2061 6c6c 2070 6f73 6974  , then all posit
-00004070: 6976 6520 616e 6420 6e65 6761 7469 7665  ive and negative
-00004080: 2076 616c 7565 7320 6172 6520 636f 6e73   values are cons
-00004090: 6964 6572 6564 0d0a 2020 2020 2020 2020  idered..        
-000040a0: 652e 672e 2c20 3c30 2e35 2077 6f75 6c64  e.g., <0.5 would
-000040b0: 2062 6520 636f 6e76 6572 7465 6420 746f   be converted to
-000040c0: 2028 2d6e 702e 696e 662c 3529 2e0d 0a20   (-np.inf,5)... 
-000040d0: 2020 2020 2020 2049 6620 4661 6c73 652c         If False,
-000040e0: 2074 6865 6e20 6f6e 6c79 206e 6f6e 2d6e   then only non-n
-000040f0: 6567 6174 6976 6520 7661 6c75 6573 2061  egative values a
-00004100: 7265 2063 6f6e 7369 6465 7265 640d 0a20  re considered.. 
-00004110: 2020 2020 2020 2065 2e67 2e2c 203c 302e         e.g., <0.
-00004120: 3520 776f 756c 6420 6265 2063 6f6e 7665  5 would be conve
-00004130: 7274 6564 2074 6f20 5b30 2c35 292e 0d0a  rted to [0,5)...
-00004140: 2020 2020 2020 2020 5468 6973 2073 6574          This set
-00004150: 7469 6e67 206f 6e6c 7920 6166 6665 6374  ting only affect
-00004160: 7320 7265 7375 6c74 7320 6966 2066 6f63  s results if foc
-00004170: 7573 5f68 6967 685f 706f 7465 6e74 6961  us_high_potentia
-00004180: 6c20 6973 2046 616c 7365 2e0d 0a20 2020  l is False...   
-00004190: 2020 2020 2054 6865 2064 6566 6175 6c74       The default
-000041a0: 2069 7320 4661 6c73 652e 0d0a 2020 2020   is False...    
-000041b0: 7072 6563 6973 696f 6e5f 746f 6c65 7261  precision_tolera
-000041c0: 6e63 655f 746f 5f64 726f 705f 6365 6e73  nce_to_drop_cens
-000041d0: 6f72 203a 2066 6c6f 6174 2c20 6f70 7469  or : float, opti
-000041e0: 6f6e 616c 0d0a 2020 2020 2020 2020 5468  onal..        Th
-000041f0: 7265 7368 6f6c 6420 666f 7220 7265 706f  reshold for repo
-00004200: 7274 696e 6720 6365 6e73 6f72 6564 2076  rting censored v
-00004210: 7320 6e6f 6e2d 6365 6e73 6f72 6564 2072  s non-censored r
-00004220: 6573 756c 7473 2e0d 0a20 2020 2020 2020  esults...       
-00004230: 2055 7369 6e67 2074 6865 2064 6566 6175   Using the defau
-00004240: 6c74 2c20 6120 7265 7375 6c74 2074 6861  lt, a result tha
-00004250: 7420 6973 206b 6e6f 776e 2074 6f20 6265  t is known to be
-00004260: 2069 6e20 7468 6520 696e 7465 7276 616c   in the interval
-00004270: 2028 302e 332c 2030 2e35 290d 0a20 2020   (0.3, 0.5)..   
-00004280: 2020 2020 2077 6f75 6c64 2062 6520 7265       would be re
-00004290: 7475 726e 6564 2061 7320 302e 342c 2077  turned as 0.4, w
-000042a0: 6865 7265 6173 2061 2074 6f6c 6572 616e  hereas a toleran
-000042b0: 6365 206f 6620 3020 776f 756c 6420 7969  ce of 0 would yi
-000042c0: 656c 6420 610d 0a20 2020 2020 2020 2072  eld a..        r
-000042d0: 6573 756c 7420 6f66 203c 302e 3520 6f72  esult of <0.5 or
-000042e0: 203e 302e 3320 6465 7065 6e64 696e 6720   >0.3 depending 
-000042f0: 6f6e 2074 6865 2076 616c 7565 206f 6620  on the value of 
-00004300: 666f 6375 735f 6869 6768 6573 745f 706f  focus_highest_po
-00004310: 7465 6e74 6961 6c2e 0d0a 2020 2020 2020  tential...      
-00004320: 2020 5468 6520 6465 6661 756c 7420 6973    The default is
-00004330: 2030 2e32 352e 0d0a 2020 2020 7072 6563   0.25...    prec
-00004340: 6973 696f 6e5f 726f 756e 6469 6e67 203a  ision_rounding :
-00004350: 2062 6f6f 6c65 616e 2c20 6f70 7469 6f6e   boolean, option
-00004360: 616c 0d0a 2020 2020 2020 2020 4966 2054  al..        If T
-00004370: 7275 652c 2061 2072 6f75 6e64 696e 6720  rue, a rounding 
-00004380: 6d65 7468 6f64 2069 7320 6170 706c 6965  method is applie
-00004390: 6420 746f 2072 6f75 6e64 2072 6573 756c  d to round resul
-000043a0: 7473 2074 6f20 6861 7665 206e 6f20 6d6f  ts to have no mo
-000043b0: 7265 0d0a 2020 2020 2020 2020 6465 6369  re..        deci
-000043c0: 6d61 6c73 2074 6861 6e20 7768 6174 2063  mals than what c
-000043d0: 616e 2062 6520 6d65 6173 7572 6564 2e0d  an be measured..
-000043e0: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
-000043f0: 6175 6c74 2069 7320 5472 7565 2e0d 0a0d  ault is True....
-00004400: 0a20 2020 2052 6574 7572 6e73 0d0a 2020  .    Returns..  
-00004410: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064    -------..    d
-00004420: 6620 3a20 4461 7461 4672 616d 650d 0a20  f : DataFrame.. 
-00004430: 2020 2020 2020 2044 6174 6146 7261 6d65         DataFrame
-00004440: 2074 6861 7420 636f 6e74 6169 6e73 2061   that contains a
-00004450: 2063 6f6c 756d 6e20 7769 7468 2074 6865   column with the
-00004460: 2072 656c 6576 616e 7420 6d61 7869 6d75   relevant maximu
-00004470: 6d20 6f72 206d 6178 696d 610d 0a0d 0a20  m or maxima.... 
-00004480: 2020 2027 2727 0d0a 2020 2020 0d0a 2020     '''..    ..  
-00004490: 2020 2320 4372 6561 7465 2061 2063 6f70    # Create a cop
-000044a0: 7920 6f66 2074 6865 2044 6174 6146 7261  y of the DataFra
-000044b0: 6d65 0d0a 2020 2020 6466 203d 2064 662e  me..    df = df.
-000044c0: 636f 7079 2829 0d0a 2020 2020 0d0a 2020  copy()..    ..  
-000044d0: 2020 2320 5370 6c69 7420 7468 6520 7265    # Split the re
-000044e0: 7375 6c74 2069 6e74 6f20 6365 6e73 6f72  sult into censor
-000044f0: 2061 6e64 206e 756d 6572 6963 2063 6f6d   and numeric com
-00004500: 706f 6e65 6e74 730d 0a20 2020 2064 6620  ponents..    df 
-00004510: 3d20 7265 7375 6c74 5f74 6f5f 636f 6d70  = result_to_comp
-00004520: 6f6e 656e 7473 2864 662c 7265 7375 6c74  onents(df,result
-00004530: 5f63 6f6c 290d 0a20 2020 200d 0a20 2020  _col)..    ..   
-00004540: 2023 2043 6f6e 7665 7274 2074 6865 2072   # Convert the r
-00004550: 6573 756c 7473 2066 726f 6d20 6365 6e73  esults from cens
-00004560: 6f72 2061 6e64 206e 756d 6572 6963 2063  or and numeric c
-00004570: 6f6d 706f 6e65 6e74 7320 746f 2061 6e20  omponents to an 
-00004580: 696e 7465 7276 616c 2072 6570 7265 7365  interval represe
-00004590: 6e74 6174 696f 6e0d 0a20 2020 2064 6620  ntation..    df 
-000045a0: 3d20 636f 6d70 6f6e 656e 7473 5f74 6f5f  = components_to_
-000045b0: 696e 7465 7276 616c 2864 662c 2069 6e63  interval(df, inc
-000045c0: 6c75 6465 5f6e 6567 6174 6976 655f 696e  lude_negative_in
-000045d0: 7465 7276 616c 290d 0a20 2020 200d 0a20  terval)..    .. 
-000045e0: 2020 2023 2055 7369 6e67 2074 6865 2069     # Using the i
-000045f0: 6e74 6572 7661 6c73 2c20 6465 7465 726d  ntervals, determ
-00004600: 696e 6520 7468 6520 7261 6e67 6520 6f66  ine the range of
-00004610: 2070 6f73 7369 626c 6520 6d61 7869 6d61   possible maxima
-00004620: 0d0a 2020 2020 0d0a 2020 2020 2320 4966  ..    ..    # If
-00004630: 2074 6865 7265 2061 7265 206e 6f20 6772   there are no gr
-00004640: 6f75 7062 792d 636f 6c75 6d6e 732c 2074  oupby-columns, t
-00004650: 6865 6e20 7461 6b65 206d 6178 206f 6620  hen take max of 
-00004660: 616c 6c20 7265 7375 6c74 730d 0a20 2020  all results..   
-00004670: 2069 6620 6e6f 7420 6772 6f75 7062 795f   if not groupby_
-00004680: 636f 6c75 6d6e 733a 0d0a 2020 2020 2020  columns:..      
-00004690: 2020 6466 203d 206d 6178 696d 756d 5f69    df = maximum_i
-000046a0: 6e74 6572 7661 6c28 6466 2c20 6772 6f75  nterval(df, grou
-000046b0: 7062 795f 636f 6c75 6d6e 733d 5b5d 290d  pby_columns=[]).
-000046c0: 0a20 2020 2023 2049 6620 7468 6520 6772  .    # If the gr
-000046d0: 6f75 7062 795f 636f 6c75 6d6e 7320 6973  oupby_columns is
-000046e0: 2061 206c 6973 7420 6f66 206c 6973 7473   a list of lists
-000046f0: 2c20 7468 656e 2070 6572 666f 726d 206d  , then perform m
-00004700: 756c 7469 706c 6520 6d61 7869 6d75 6d73  ultiple maximums
-00004710: 0d0a 2020 2020 656c 6966 2069 7369 6e73  ..    elif isins
-00004720: 7461 6e63 6528 6772 6f75 7062 795f 636f  tance(groupby_co
-00004730: 6c75 6d6e 735b 305d 2c6c 6973 7429 3a0d  lumns[0],list):.
-00004740: 0a20 2020 2020 2020 2066 6f72 2067 726f  .        for gro
-00004750: 7570 696e 6720 696e 2067 726f 7570 6279  uping in groupby
-00004760: 5f63 6f6c 756d 6e73 3a0d 0a20 2020 2020  _columns:..     
-00004770: 2020 2020 2020 2023 2055 7369 6e67 2074         # Using t
-00004780: 6865 2069 6e74 6572 7661 6c73 2c20 6465  he intervals, de
-00004790: 7465 726d 696e 6520 7468 6520 7261 6e67  termine the rang
-000047a0: 6520 6f66 2070 6f73 7369 626c 6520 6d61  e of possible ma
-000047b0: 7869 6d61 0d0a 2020 2020 2020 2020 2020  xima..          
-000047c0: 2020 6466 203d 206d 6178 696d 756d 5f69    df = maximum_i
-000047d0: 6e74 6572 7661 6c28 6466 2c20 6772 6f75  nterval(df, grou
-000047e0: 7069 6e67 290d 0a20 2020 2023 2045 6c73  ping)..    # Els
-000047f0: 6520 7468 6520 6772 6f75 7062 795f 636f  e the groupby_co
-00004800: 6c75 6d6e 7320 6973 2061 206c 6973 7420  lumns is a list 
-00004810: 6f66 2063 6f6c 756d 6e20 6e61 6d65 730d  of column names.
-00004820: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
-00004830: 2020 2020 6466 203d 206d 6178 696d 756d      df = maximum
-00004840: 5f69 6e74 6572 7661 6c28 6466 2c20 6772  _interval(df, gr
-00004850: 6f75 7062 795f 636f 6c75 6d6e 7329 0d0a  oupby_columns)..
-00004860: 2020 2020 0d0a 2020 2020 2320 436f 6e76      ..    # Conv
-00004870: 6572 7420 7468 6520 696e 7465 7276 616c  ert the interval
-00004880: 2066 6f72 2074 6865 206d 6178 696d 756d   for the maximum
-00004890: 2069 6e74 6f20 6365 6e73 6f72 2061 6e64   into censor and
-000048a0: 206e 756d 6572 6963 206e 6f74 6174 696f   numeric notatio
-000048b0: 6e0d 0a20 2020 2064 6620 3d20 696e 7465  n..    df = inte
-000048c0: 7276 616c 5f74 6f5f 636f 6d70 6f6e 656e  rval_to_componen
-000048d0: 7473 2864 662c 0d0a 2020 2020 2020 2020  ts(df,..        
-000048e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048f0: 2020 2020 2020 2020 666f 6375 735f 6869          focus_hi
-00004900: 6768 5f70 6f74 656e 7469 616c 203d 2054  gh_potential = T
-00004910: 7275 652c 0d0a 2020 2020 2020 2020 2020  rue,..          
+00000000: 0d0a 696d 706f 7274 206e 756d 7079 2061  ..import numpy a
+00000010: 7320 6e70 0d0a 6672 6f6d 202e 7574 696c  s np..from .util
+00000020: 7320 696d 706f 7274 2073 7472 696e 675f  s import string_
+00000030: 7072 6563 6973 696f 6e2c 206e 756d 6572  precision, numer
+00000040: 6963 5f70 7265 6369 7369 6f6e 0d0a 0d0a  ic_precision....
+00000050: 2320 5365 7420 6465 6661 756c 7420 636f  # Set default co
+00000060: 6c75 6d6e 206e 616d 6573 0d0a 7374 6174  lumn names..stat
+00000070: 5f63 6f6c 203d 2027 5374 6174 6973 7469  _col = 'Statisti
+00000080: 6327 0d0a 7265 7375 6c74 5f63 6f6c 203d  c'..result_col =
+00000090: 2027 5265 7375 6c74 270d 0a63 656e 736f   'Result'..censo
+000000a0: 725f 636f 6c20 3d20 2743 656e 736f 7243  r_col = 'CensorC
+000000b0: 6f6d 706f 6e65 6e74 270d 0a6e 756d 6572  omponent'..numer
+000000c0: 6963 5f63 6f6c 203d 2027 4e75 6d65 7269  ic_col = 'Numeri
+000000d0: 6343 6f6d 706f 6e65 6e74 270d 0a69 6e74  cComponent'..int
+000000e0: 6572 7661 6c5f 636f 6c20 3d20 2749 6e74  erval_col = 'Int
+000000f0: 6572 7661 6c27 0d0a 6c65 6674 5f62 6f75  erval'..left_bou
+00000100: 6e64 6172 795f 636f 6c20 3d20 275f 5f4c  ndary_col = '__L
+00000110: 6566 7442 6f75 6e64 6172 795f 5f27 0d0a  eftBoundary__'..
+00000120: 6c65 6674 5f62 6f75 6e64 5f63 6f6c 203d  left_bound_col =
+00000130: 2027 5f5f 4c65 6674 426f 756e 645f 5f27   '__LeftBound__'
+00000140: 0d0a 6d69 6470 6f69 6e74 5f63 6f6c 203d  ..midpoint_col =
+00000150: 2027 5f5f 4d69 6450 6f69 6e74 5f5f 270d   '__MidPoint__'.
+00000160: 0a72 6967 6874 5f62 6f75 6e64 5f63 6f6c  .right_bound_col
+00000170: 203d 2027 5f5f 5269 6768 7442 6f75 6e64   = '__RightBound
+00000180: 5f5f 270d 0a72 6967 6874 5f62 6f75 6e64  __'..right_bound
+00000190: 6172 795f 636f 6c20 3d20 275f 5f52 6967  ary_col = '__Rig
+000001a0: 6874 426f 756e 6461 7279 5f5f 270d 0a0d  htBoundary__'...
+000001b0: 0a0d 0a0d 0a23 2525 2043 6f6e 7665 7273  .....#%% Convers
+000001c0: 696f 6e20 6265 7477 6565 6e20 7265 7375  ion between resu
+000001d0: 6c74 2061 6e64 2069 6e74 6572 7661 6c20  lt and interval 
+000001e0: 636f 6d70 6f6e 656e 7473 0d0a 0d0a 2325  components....#%
+000001f0: 2525 2042 6574 7765 656e 2072 6573 756c  %% Between resul
+00000200: 7420 616e 6420 6365 6e73 6f72 2f6e 756d  t and censor/num
+00000210: 6572 6963 2063 6f6d 706f 6e65 6e74 730d  eric components.
+00000220: 0a0d 0a64 6566 2072 6573 756c 745f 746f  ...def result_to
+00000230: 5f63 6f6d 706f 6e65 6e74 7328 6466 2c0d  _components(df,.
+00000240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000250: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00000260: 5f63 6f6c 756d 6e29 3a0d 0a20 2020 2027  _column):..    '
+00000270: 2727 0d0a 2020 2020 4120 6675 6e63 7469  ''..    A functi
+00000280: 6f6e 2074 6861 7420 7365 7061 7261 7465  on that separate
+00000290: 7320 6365 6e73 6f72 7320 283c 2ce2 89a4  s censors (<,...
+000002a0: 2ce2 89a5 2c3e 2920 6672 6f6d 2061 2072  ,...,>) from a r
+000002b0: 6573 756c 742e 2053 706c 6974 7469 6e67  esult. Splitting
+000002c0: 2074 6865 0d0a 2020 2020 6365 6e73 6f72   the..    censor
+000002d0: 2063 6f6d 706f 6e65 6e74 2066 726f 6d20   component from 
+000002e0: 7468 6520 6e75 6d65 7269 6320 636f 6d70  the numeric comp
+000002f0: 6f6e 656e 7420 656e 6162 6c65 7320 7468  onent enables th
+00000300: 6520 7573 6520 6f66 206e 756d 6572 6963  e use of numeric
+00000310: 0d0a 2020 2020 6461 7461 2074 7970 6573  ..    data types
+00000320: 2e20 4120 7265 7375 6c74 206f 6620 3c31  . A result of <1
+00000330: 3020 2873 7472 696e 672f 7465 7874 2920  0 (string/text) 
+00000340: 6973 2073 706c 6974 2069 6e74 6f20 6120  is split into a 
+00000350: 6365 6e73 6f72 2063 6f6d 706f 6e65 6e74  censor component
+00000360: 0d0a 2020 2020 6f66 203c 2028 7374 7269  ..    of < (stri
+00000370: 6e67 2f74 6578 7429 2061 6e64 2061 206e  ng/text) and a n
+00000380: 756d 6572 6963 2063 6f6d 706f 6e65 6e74  umeric component
+00000390: 206f 6620 3130 2028 666c 6f61 742f 6465   of 10 (float/de
+000003a0: 6369 6d61 6c29 2e0d 0a0d 0a20 2020 2050  cimal).....    P
+000003b0: 6172 616d 6574 6572 730d 0a20 2020 202d  arameters..    -
+000003c0: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
+000003d0: 6620 3a20 4461 7461 4672 616d 650d 0a20  f : DataFrame.. 
+000003e0: 2020 2020 2020 2044 6174 6146 7261 6d65         DataFrame
+000003f0: 2063 6f6e 7461 696e 696e 6720 6120 636f   containing a co
+00000400: 6c75 6d6e 2074 6f20 6265 2073 706c 6974  lumn to be split
+00000410: 2069 6e74 6f20 636f 6d70 6f6e 656e 7473   into components
+00000420: 0d0a 2020 2020 7265 7375 6c74 5f63 6f6c  ..    result_col
+00000430: 756d 6e20 3a20 7374 7269 6e67 0d0a 2020  umn : string..  
+00000440: 2020 2020 2020 436f 6c75 6d6e 206e 616d        Column nam
+00000450: 6520 666f 7220 7468 6520 636f 6c75 6d6e  e for the column
+00000460: 2074 6861 7420 636f 6e74 6169 6e73 2074   that contains t
+00000470: 6865 2072 6573 756c 7473 2074 6f20 6265  he results to be
+00000480: 2073 706c 6974 0d0a 0d0a 2020 2020 5265   split....    Re
+00000490: 7475 726e 730d 0a20 2020 202d 2d2d 2d2d  turns..    -----
+000004a0: 2d2d 0d0a 2020 2020 6466 203a 2044 6174  --..    df : Dat
+000004b0: 6146 7261 6d65 0d0a 2020 2020 2020 2020  aFrame..        
+000004c0: 496e 7075 7420 4461 7461 4672 616d 6520  Input DataFrame 
+000004d0: 7769 7468 2074 776f 2061 6464 6974 696f  with two additio
+000004e0: 6e61 6c20 636f 6c75 6d6e 7320 6372 6561  nal columns crea
+000004f0: 7465 6420 666f 7220 7468 6520 6365 6e73  ted for the cens
+00000500: 6f72 0d0a 2020 2020 2020 2020 616e 6420  or..        and 
+00000510: 6e75 6d65 7269 6320 636f 6d70 6f6e 656e  numeric componen
+00000520: 7473 0d0a 0d0a 2020 2020 2727 270d 0a20  ts....    '''.. 
+00000530: 2020 200d 0a20 2020 2023 2043 7265 6174     ..    # Creat
+00000540: 6520 6120 636f 7079 206f 6620 7468 6520  e a copy of the 
+00000550: 4461 7461 4672 616d 650d 0a20 2020 2064  DataFrame..    d
+00000560: 6620 3d20 6466 2e63 6f70 7928 290d 0a20  f = df.copy().. 
+00000570: 2020 200d 0a20 2020 2023 2045 6e73 7572     ..    # Ensur
+00000580: 6520 7468 6520 7661 6c75 6520 636f 6c75  e the value colu
+00000590: 6d6e 2069 7320 7465 7874 2f73 7472 696e  mn is text/strin
+000005a0: 6720 6461 7461 2074 7970 652e 0d0a 2020  g data type...  
+000005b0: 2020 6466 5b72 6573 756c 745f 636f 6c75    df[result_colu
+000005c0: 6d6e 5d20 3d20 6466 5b72 6573 756c 745f  mn] = df[result_
+000005d0: 636f 6c75 6d6e 5d2e 6173 7479 7065 2873  column].astype(s
+000005e0: 7472 290d 0a20 2020 200d 0a20 2020 2023  tr)..    ..    #
+000005f0: 2043 7265 6174 6520 6365 6e73 6f72 2061   Create censor a
+00000600: 6e64 206e 756d 6572 6963 2063 6f6c 756d  nd numeric colum
+00000610: 6e73 2066 726f 6d20 7265 7375 6c74 2063  ns from result c
+00000620: 6f6c 756d 6e0d 0a20 2020 2064 665b 6365  olumn..    df[ce
+00000630: 6e73 6f72 5f63 6f6c 5d20 3d20 6466 5b72  nsor_col] = df[r
+00000640: 6573 756c 745f 636f 6c75 6d6e 5d2e 7374  esult_column].st
+00000650: 722e 6578 7472 6163 7428 7227 285b 3ce2  r.extract(r'([<.
+00000660: 89a4 e289 a53e 5d29 2729 2e66 696c 6c6e  .....>])').filln
+00000670: 6128 2727 290d 0a20 2020 2064 665b 6e75  a('')..    df[nu
+00000680: 6d65 7269 635f 636f 6c5d 203d 2064 665b  meric_col] = df[
+00000690: 7265 7375 6c74 5f63 6f6c 756d 6e5d 2e73  result_column].s
+000006a0: 7472 2e72 6570 6c61 6365 2827 3c7c e289  tr.replace('<|..
+000006b0: a47c e289 a57c 3e27 2c27 272c 7265 6765  .|...|>','',rege
+000006c0: 783d 5472 7565 292e 6173 7479 7065 2866  x=True).astype(f
+000006d0: 6c6f 6174 290d 0a20 2020 200d 0a20 2020  loat)..    ..   
+000006e0: 2072 6574 7572 6e20 6466 0d0a 0d0a 6465   return df....de
+000006f0: 6620 636f 6d70 6f6e 656e 7473 5f74 6f5f  f components_to_
+00000700: 7265 7375 6c74 2864 662c 0d0a 2020 2020  result(df,..    
+00000710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000720: 2020 2020 2070 7265 6369 7369 6f6e 5f72       precision_r
+00000730: 6f75 6e64 696e 6720 3d20 5472 7565 293a  ounding = True):
+00000740: 0d0a 2020 2020 2727 270d 0a20 2020 2041  ..    '''..    A
+00000750: 2066 756e 6374 696f 6e20 7468 6174 2063   function that c
+00000760: 6f6d 6269 6e65 7320 6365 6e73 6f72 2061  ombines censor a
+00000770: 6e64 206e 756d 6572 6963 2063 6f6d 706f  nd numeric compo
+00000780: 6e65 6e74 7320 696e 746f 2061 2063 6f6d  nents into a com
+00000790: 6269 6e65 640d 0a20 2020 2073 7472 696e  bined..    strin
+000007a0: 672f 7465 7874 2072 6573 756c 742e 0d0a  g/text result...
+000007b0: 0d0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
+000007c0: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  ..    ----------
+000007d0: 0d0a 2020 2020 6466 203a 2044 6174 6146  ..    df : DataF
+000007e0: 7261 6d65 0d0a 2020 2020 2020 2020 4461  rame..        Da
+000007f0: 7461 4672 616d 6520 636f 6e74 6169 6e69  taFrame containi
+00000800: 6e67 2063 656e 736f 7220 616e 6420 6e75  ng censor and nu
+00000810: 6d65 7269 6320 636f 6c75 6d6e 7320 7468  meric columns th
+00000820: 6174 2077 696c 6c20 6265 2063 6f6d 6269  at will be combi
+00000830: 6e65 640d 0a20 2020 2070 7265 6369 7369  ned..    precisi
+00000840: 6f6e 5f72 6f75 6e64 696e 6720 3a20 626f  on_rounding : bo
+00000850: 6f6c 6561 6e2c 206f 7074 696f 6e61 6c0d  olean, optional.
+00000860: 0a20 2020 2020 2020 2049 6620 5472 7565  .        If True
+00000870: 2c20 6120 726f 756e 6469 6e67 206d 6574  , a rounding met
+00000880: 686f 6420 6973 2061 7070 6c69 6564 2074  hod is applied t
+00000890: 6f20 726f 756e 6420 7265 7375 6c74 7320  o round results 
+000008a0: 746f 2068 6176 6520 6e6f 206d 6f72 650d  to have no more.
+000008b0: 0a20 2020 2020 2020 2064 6563 696d 616c  .        decimal
+000008c0: 7320 7468 616e 2077 6861 7420 6361 6e20  s than what can 
+000008d0: 6265 206d 6561 7375 7265 642e 0d0a 2020  be measured...  
+000008e0: 2020 2020 2020 5468 6520 6465 6661 756c        The defaul
+000008f0: 7420 6973 2054 7275 652e 0d0a 0d0a 2020  t is True.....  
+00000900: 2020 5265 7475 726e 730d 0a20 2020 202d    Returns..    -
+00000910: 2d2d 2d2d 2d2d 0d0a 2020 2020 6466 203a  ------..    df :
+00000920: 2044 6174 6146 7261 6d65 0d0a 2020 2020   DataFrame..    
+00000930: 2020 2020 496e 7075 7420 4461 7461 4672      Input DataFr
+00000940: 616d 6520 7468 6174 2063 6f6e 7461 696e  ame that contain
+00000950: 7320 6120 6e65 7720 7374 7269 6e67 2f74  s a new string/t
+00000960: 6578 7420 636f 6c75 6d6e 2074 6861 7420  ext column that 
+00000970: 636f 6d62 696e 6573 0d0a 2020 2020 2020  combines..      
+00000980: 2020 7468 6520 6365 6e73 6f72 2061 6e64    the censor and
+00000990: 206e 756d 6572 6963 2063 6f6d 706f 6e65   numeric compone
+000009a0: 6e74 7320 6f66 2061 2072 6573 756c 740d  nts of a result.
+000009b0: 0a0d 0a20 2020 2027 2727 0d0a 2020 2020  ...    '''..    
+000009c0: 0d0a 2020 2020 2320 4372 6561 7465 2061  ..    # Create a
+000009d0: 2063 6f70 7920 6f66 2074 6865 2044 6174   copy of the Dat
+000009e0: 6146 7261 6d65 0d0a 2020 2020 6466 203d  aFrame..    df =
+000009f0: 2064 662e 636f 7079 2829 0d0a 2020 2020   df.copy()..    
+00000a00: 0d0a 2020 2020 2320 436f 6d62 696e 6520  ..    # Combine 
+00000a10: 7468 6520 6365 6e73 6f72 2061 6e64 206e  the censor and n
+00000a20: 756d 6572 6963 2063 6f6d 706f 6e65 6e74  umeric component
+00000a30: 7320 746f 2063 7265 6174 6520 6120 636f  s to create a co
+00000a40: 6d62 696e 6564 2072 6573 756c 740d 0a20  mbined result.. 
+00000a50: 2020 2023 2041 7070 6c79 2074 6865 2061     # Apply the a
+00000a60: 7070 726f 7072 6961 7465 2072 6f75 6e64  ppropriate round
+00000a70: 696e 6720 6675 6e63 7469 6f6e 7320 6966  ing functions if
+00000a80: 2070 7265 6369 7369 6f6e 5f72 6f75 6e64   precision_round
+00000a90: 696e 6720 6973 2054 7275 650d 0a20 2020  ing is True..   
+00000aa0: 2069 6620 7072 6563 6973 696f 6e5f 726f   if precision_ro
+00000ab0: 756e 6469 6e67 3a0d 0a20 2020 2020 2020  unding:..       
+00000ac0: 2064 665b 7265 7375 6c74 5f63 6f6c 5d20   df[result_col] 
+00000ad0: 3d20 6466 5b63 656e 736f 725f 636f 6c5d  = df[censor_col]
+00000ae0: 202b 2064 665b 6e75 6d65 7269 635f 636f   + df[numeric_co
+00000af0: 6c5d 2e61 7070 6c79 2873 7472 696e 675f  l].apply(string_
+00000b00: 7072 6563 6973 696f 6e2c 7468 6f75 7361  precision,thousa
+00000b10: 6e64 735f 636f 6d6d 613d 5472 7565 290d  nds_comma=True).
+00000b20: 0a20 2020 2020 2020 2064 665b 6e75 6d65  .        df[nume
+00000b30: 7269 635f 636f 6c5d 203d 2064 665b 6e75  ric_col] = df[nu
+00000b40: 6d65 7269 635f 636f 6c5d 2e61 7070 6c79  meric_col].apply
+00000b50: 286e 756d 6572 6963 5f70 7265 6369 7369  (numeric_precisi
+00000b60: 6f6e 290d 0a20 2020 2065 6c73 653a 0d0a  on)..    else:..
+00000b70: 2020 2020 2020 2020 6466 5b72 6573 756c          df[resul
+00000b80: 745f 636f 6c5d 203d 2064 665b 6365 6e73  t_col] = df[cens
+00000b90: 6f72 5f63 6f6c 5d20 2b20 6466 5b6e 756d  or_col] + df[num
+00000ba0: 6572 6963 5f63 6f6c 5d2e 6173 7479 7065  eric_col].astype
+00000bb0: 2873 7472 290d 0a20 2020 200d 0a20 2020  (str)..    ..   
+00000bc0: 2072 6574 7572 6e20 6466 0d0a 0d0a 2325   return df....#%
+00000bd0: 2525 2042 6574 7765 656e 2063 656e 736f  %% Between censo
+00000be0: 722f 6e75 6d65 7269 6320 636f 6d70 6f6e  r/numeric compon
+00000bf0: 656e 7473 2061 6e64 2069 6e74 6572 7661  ents and interva
+00000c00: 6c20 636f 6d70 6f6e 656e 7473 0d0a 0d0a  l components....
+00000c10: 6465 6620 636f 6d70 6f6e 656e 7473 5f74  def components_t
+00000c20: 6f5f 696e 7465 7276 616c 2864 662c 0d0a  o_interval(df,..
+00000c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000c40: 2020 2020 2020 2020 2020 2069 6e63 6c75             inclu
+00000c50: 6465 5f6e 6567 6174 6976 655f 696e 7465  de_negative_inte
+00000c60: 7276 616c 203d 2046 616c 7365 293a 0d0a  rval = False):..
+00000c70: 2020 2020 2727 270d 0a20 2020 2041 2066      '''..    A f
+00000c80: 756e 6374 696f 6e20 7468 6174 2075 7469  unction that uti
+00000c90: 6c69 7365 7320 7468 6520 6365 6e73 6f72  lises the censor
+00000ca0: 2061 6e64 206e 756d 6572 6963 2063 6f6d   and numeric com
+00000cb0: 706f 6e65 6e74 7320 746f 2063 6f6e 7665  ponents to conve
+00000cc0: 7274 0d0a 2020 2020 6561 6368 2072 6573  rt..    each res
+00000cd0: 756c 7420 696e 746f 2069 6e74 6572 7661  ult into interva
+00000ce0: 6c20 6e6f 7461 7469 6f6e 2e20 466f 7572  l notation. Four
+00000cf0: 2063 6f6c 756d 6e73 2061 7265 2063 7265   columns are cre
+00000d00: 6174 6564 2074 6f20 7374 6f72 650d 0a20  ated to store.. 
+00000d10: 2020 2074 6865 2069 6e74 6572 7661 6c20     the interval 
+00000d20: 696e 666f 726d 6174 696f 6e20 696e 636c  information incl
+00000d30: 7564 696e 6720 6c65 6674 2f72 6967 6874  uding left/right
+00000d40: 2062 6f75 6e64 7320 616e 6420 7768 6574   bounds and whet
+00000d50: 6865 7220 7468 650d 0a20 2020 2065 6e64  her the..    end
+00000d60: 706f 696e 7473 2f62 6f75 6e64 6172 6965  points/boundarie
+00000d70: 7320 6172 6520 696e 636c 7573 6976 6520  s are inclusive 
+00000d80: 6f72 2065 7863 6c75 7369 7665 2028 652e  or exclusive (e.
+00000d90: 672e 2c20 3c31 2076 7320 e289 a431 290d  g., <1 vs ...1).
+00000da0: 0a0d 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
+00000db0: 730d 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  s..    ---------
+00000dc0: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
+00000dd0: 4672 616d 650d 0a20 2020 2020 2020 2044  Frame..        D
+00000de0: 6174 6146 7261 6d65 2063 6f6e 7461 696e  ataFrame contain
+00000df0: 696e 6720 7468 6520 6365 6e73 6f72 2061  ing the censor a
+00000e00: 6e64 206e 756d 6572 6963 2063 6f6c 756d  nd numeric colum
+00000e10: 6e73 0d0a 2020 2020 696e 636c 7564 655f  ns..    include_
+00000e20: 6e65 6761 7469 7665 5f69 6e74 6572 7661  negative_interva
+00000e30: 6c20 3a20 626f 6f6c 6561 6e2c 206f 7074  l : boolean, opt
+00000e40: 696f 6e61 6c0d 0a20 2020 2020 2020 2049  ional..        I
+00000e50: 6620 5472 7565 2c20 7468 656e 2061 6c6c  f True, then all
+00000e60: 2070 6f73 6974 6976 6520 616e 6420 6e65   positive and ne
+00000e70: 6761 7469 7665 2076 616c 7565 7320 6172  gative values ar
+00000e80: 6520 636f 6e73 6964 6572 6564 0d0a 2020  e considered..  
+00000e90: 2020 2020 2020 652e 672e 2c20 3c30 2e35        e.g., <0.5
+00000ea0: 2077 6f75 6c64 2062 6520 636f 6e76 6572   would be conver
+00000eb0: 7465 6420 746f 2028 2d6e 702e 696e 662c  ted to (-np.inf,
+00000ec0: 3529 2e0d 0a20 2020 2020 2020 2049 6620  5)...        If 
+00000ed0: 4661 6c73 652c 2074 6865 6e20 6f6e 6c79  False, then only
+00000ee0: 206e 6f6e 2d6e 6567 6174 6976 6520 7661   non-negative va
+00000ef0: 6c75 6573 2061 7265 2063 6f6e 7369 6465  lues are conside
+00000f00: 7265 640d 0a20 2020 2020 2020 2065 2e67  red..        e.g
+00000f10: 2e2c 203c 302e 3520 776f 756c 6420 6265  ., <0.5 would be
+00000f20: 2063 6f6e 7665 7274 6564 2074 6f20 5b30   converted to [0
+00000f30: 2c35 292e 0d0a 2020 2020 2020 2020 5468  ,5)...        Th
+00000f40: 6520 6465 6661 756c 7420 6973 2046 616c  e default is Fal
+00000f50: 7365 2e0d 0a20 2020 200d 0a20 2020 2052  se...    ..    R
+00000f60: 6169 7365 730d 0a20 2020 202d 2d2d 2d2d  aises..    -----
+00000f70: 2d0d 0a20 2020 2056 616c 7565 4572 726f  -..    ValueErro
+00000f80: 720d 0a20 2020 2020 2020 2041 6e20 6572  r..        An er
+00000f90: 726f 7220 7468 6174 2069 7320 7265 7475  ror that is retu
+00000fa0: 726e 6564 2077 6865 6e20 7265 7375 6c74  rned when result
+00000fb0: 7320 6172 6520 666f 756e 6420 746f 2062  s are found to b
+00000fc0: 6520 6f75 7473 6964 6520 7468 650d 0a20  e outside the.. 
+00000fd0: 2020 2020 2020 2061 7373 756d 6564 206f         assumed o
+00000fe0: 7220 6465 6669 6e65 6420 6c6f 7765 7220  r defined lower 
+00000ff0: 616e 6420 7570 7065 7220 626f 756e 6461  and upper bounda
+00001000: 7269 6573 2e0d 0a0d 0a20 2020 2052 6574  ries.....    Ret
+00001010: 7572 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d  urns..    ------
+00001020: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
+00001030: 4672 616d 650d 0a20 2020 2020 2020 2049  Frame..        I
+00001040: 6e70 7574 2044 6174 6146 7261 6d65 2077  nput DataFrame w
+00001050: 6974 6820 666f 7572 2061 6464 6974 696f  ith four additio
+00001060: 6e61 6c20 636f 6c75 6d6e 7320 6372 6561  nal columns crea
+00001070: 7465 6420 7468 6174 2073 746f 7265 2074  ted that store t
+00001080: 6865 0d0a 2020 2020 2020 2020 696e 666f  he..        info
+00001090: 726d 6174 696f 6e20 666f 7220 7468 6520  rmation for the 
+000010a0: 696e 7465 7276 616c 7320 7468 6174 2072  intervals that r
+000010b0: 6570 7265 7365 6e74 2074 6865 2072 616e  epresent the ran
+000010c0: 6765 206f 6620 706f 7465 6e74 6961 6c0d  ge of potential.
+000010d0: 0a20 2020 2020 2020 2076 616c 7565 7320  .        values 
+000010e0: 666f 7220 7468 6520 7265 7375 6c74 730d  for the results.
+000010f0: 0a0d 0a20 2020 2027 2727 0d0a 2020 2020  ...    '''..    
+00001100: 0d0a 2020 2020 2320 4372 6561 7465 2061  ..    # Create a
+00001110: 2063 6f70 7920 6f66 2074 6865 2044 6174   copy of the Dat
+00001120: 6146 7261 6d65 0d0a 2020 2020 6466 203d  aFrame..    df =
+00001130: 2064 662e 636f 7079 2829 0d0a 2020 2020   df.copy()..    
+00001140: 0d0a 2020 2020 2320 4465 6669 6e65 2077  ..    # Define w
+00001150: 6865 7265 2074 6865 206c 6566 7420 626f  here the left bo
+00001160: 756e 6420 6973 2063 6c6f 7365 640d 0a20  und is closed.. 
+00001170: 2020 2064 665b 6c65 6674 5f62 6f75 6e64     df[left_bound
+00001180: 6172 795f 636f 6c5d 203d 206e 702e 7768  ary_col] = np.wh
+00001190: 6572 6528 6466 5b63 656e 736f 725f 636f  ere(df[censor_co
+000011a0: 6c5d 2e69 7369 6e28 5b27 272c 27e2 89a5  l].isin(['','...
+000011b0: 275d 292c 0d0a 2020 2020 2020 2020 2020  ']),..          
+000011c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000011d0: 2020 2020 2020 2020 2743 6c6f 7365 6427          'Closed'
+000011e0: 2c20 274f 7065 6e27 290d 0a20 2020 200d  , 'Open')..    .
+000011f0: 0a20 2020 2023 2044 6566 696e 6520 7768  .    # Define wh
+00001200: 6572 6520 6c65 6674 2062 6f75 6e64 2069  ere left bound i
+00001210: 7320 756e 6c69 6d69 7465 640d 0a20 2020  s unlimited..   
+00001220: 2064 665b 6c65 6674 5f62 6f75 6e64 5f63   df[left_bound_c
+00001230: 6f6c 5d20 3d20 6e70 2e77 6865 7265 2864  ol] = np.where(d
+00001240: 665b 6365 6e73 6f72 5f63 6f6c 5d2e 6973  f[censor_col].is
+00001250: 696e 285b 273c 272c 27e2 89a4 275d 292c  in(['<','...']),
+00001260: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00001270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001280: 202d 6e70 2e69 6e66 2c20 6466 5b6e 756d   -np.inf, df[num
+00001290: 6572 6963 5f63 6f6c 5d29 0d0a 2020 2020  eric_col])..    
+000012a0: 0d0a 2020 2020 2320 4465 6669 6e65 2077  ..    # Define w
+000012b0: 6865 7265 2072 6967 6874 2062 6f75 6e64  here right bound
+000012c0: 2069 7320 756e 6c69 6d69 7465 640d 0a20   is unlimited.. 
+000012d0: 2020 2064 665b 7269 6768 745f 626f 756e     df[right_boun
+000012e0: 645f 636f 6c5d 203d 206e 702e 7768 6572  d_col] = np.wher
+000012f0: 6528 6466 5b63 656e 736f 725f 636f 6c5d  e(df[censor_col]
+00001300: 2e69 7369 6e28 5b27 e289 a527 2c27 3e27  .isin(['...','>'
+00001310: 5d29 2c0d 0a20 2020 2020 2020 2020 2020  ]),..           
+00001320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001330: 2020 2020 206e 702e 696e 662c 2064 665b       np.inf, df[
+00001340: 6e75 6d65 7269 635f 636f 6c5d 290d 0a20  numeric_col]).. 
+00001350: 2020 200d 0a20 2020 2023 2044 6566 696e     ..    # Defin
+00001360: 6520 7768 6572 6520 7468 6520 7269 6768  e where the righ
+00001370: 7420 626f 756e 6420 6973 2063 6c6f 7365  t bound is close
+00001380: 640d 0a20 2020 2064 665b 7269 6768 745f  d..    df[right_
+00001390: 626f 756e 6461 7279 5f63 6f6c 5d20 3d20  boundary_col] = 
+000013a0: 6e70 2e77 6865 7265 2864 665b 6365 6e73  np.where(df[cens
+000013b0: 6f72 5f63 6f6c 5d2e 6973 696e 285b 27e2  or_col].isin(['.
+000013c0: 89a4 272c 2727 5d29 2c0d 0a20 2020 2020  ..','']),..     
+000013d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000013e0: 2020 2020 2020 2020 2020 2020 2020 2743                'C
+000013f0: 6c6f 7365 6427 2c20 274f 7065 6e27 290d  losed', 'Open').
+00001400: 0a20 2020 200d 0a20 2020 2023 2049 6620  .    ..    # If 
+00001410: 6c65 6674 2063 656e 736f 7265 6420 6172  left censored ar
+00001420: 6520 6173 7375 6d65 6420 706f 7369 7469  e assumed positi
+00001430: 7665 0d0a 2020 2020 6966 206e 6f74 2069  ve..    if not i
+00001440: 6e63 6c75 6465 5f6e 6567 6174 6976 655f  nclude_negative_
+00001450: 696e 7465 7276 616c 3a0d 0a20 2020 2020  interval:..     
+00001460: 2020 2023 2043 6865 636b 2066 6f72 2061     # Check for a
+00001470: 6e79 206e 6567 6174 6976 6520 7661 6c75  ny negative valu
+00001480: 6573 2028 6578 636c 7564 6520 2d69 6e66  es (exclude -inf
+00001490: 290d 0a20 2020 2020 2020 2069 6620 6466  )..        if df
+000014a0: 5b6c 6566 745f 626f 756e 645f 636f 6c5d  [left_bound_col]
+000014b0: 2e62 6574 7765 656e 282d 6e70 2e69 6e66  .between(-np.inf
+000014c0: 2c20 302c 2069 6e63 6c75 7369 7665 3d27  , 0, inclusive='
+000014d0: 6e65 6974 6865 7227 292e 616e 7928 293a  neither').any():
+000014e0: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+000014f0: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
+00001500: 4e65 6761 7469 7665 2076 616c 7565 7320  Negative values 
+00001510: 6578 6973 7420 696e 2074 6865 2064 6174  exist in the dat
+00001520: 612e 2052 6573 6f6c 7665 206e 6567 6174  a. Resolve negat
+00001530: 6976 6527 0d0a 2020 2020 2020 2020 2020  ive'..          
+00001540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001550: 2020 2027 7661 6c75 6573 206f 7220 7365     'values or se
+00001560: 7420 696e 636c 7564 655f 6e65 6761 7469  t include_negati
+00001570: 7665 5f69 6e74 6572 7661 6c20 746f 2054  ve_interval to T
+00001580: 7275 6527 290d 0a20 2020 2020 2020 2023  rue')..        #
+00001590: 2053 6574 2061 6e79 202d 696e 6620 6c65   Set any -inf le
+000015a0: 6674 2062 6f75 6e64 7320 746f 2030 2077  ft bounds to 0 w
+000015b0: 6974 6820 636c 6f73 6564 2062 6f75 6e64  ith closed bound
+000015c0: 6172 790d 0a20 2020 2020 2020 2063 6f6e  ary..        con
+000015d0: 6469 7469 6f6e 203d 2028 6466 5b6c 6566  dition = (df[lef
+000015e0: 745f 626f 756e 645f 636f 6c5d 203c 2030  t_bound_col] < 0
+000015f0: 290d 0a20 2020 2020 2020 2064 665b 6c65  )..        df[le
+00001600: 6674 5f62 6f75 6e64 6172 795f 636f 6c5d  ft_boundary_col]
+00001610: 203d 206e 702e 7768 6572 6528 636f 6e64   = np.where(cond
+00001620: 6974 696f 6e2c 2027 436c 6f73 6564 272c  ition, 'Closed',
+00001630: 2064 665b 6c65 6674 5f62 6f75 6e64 6172   df[left_boundar
+00001640: 795f 636f 6c5d 290d 0a20 2020 2020 2020  y_col])..       
+00001650: 2064 665b 6c65 6674 5f62 6f75 6e64 5f63   df[left_bound_c
+00001660: 6f6c 5d20 3d20 6e70 2e77 6865 7265 2863  ol] = np.where(c
+00001670: 6f6e 6469 7469 6f6e 2c20 302e 302c 2064  ondition, 0.0, d
+00001680: 665b 6c65 6674 5f62 6f75 6e64 5f63 6f6c  f[left_bound_col
+00001690: 5d29 0d0a 2020 2020 0d0a 2020 2020 7265  ])..    ..    re
+000016a0: 7475 726e 2064 660d 0a0d 0a0d 0a64 6566  turn df......def
+000016b0: 2069 6e74 6572 7661 6c5f 746f 5f63 6f6d   interval_to_com
+000016c0: 706f 6e65 6e74 7328 6466 2c0d 0a20 2020  ponents(df,..   
+000016d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000016e0: 2020 2020 2020 2020 666f 6375 735f 6869          focus_hi
+000016f0: 6768 5f70 6f74 656e 7469 616c 203d 2054  gh_potential = T
+00001700: 7275 652c 0d0a 2020 2020 2020 2020 2020  rue,..          
+00001710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001720: 2069 6e63 6c75 6465 5f6e 6567 6174 6976   include_negativ
+00001730: 655f 696e 7465 7276 616c 203d 2046 616c  e_interval = Fal
+00001740: 7365 2c0d 0a20 2020 2020 2020 2020 2020  se,..           
+00001750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001760: 7072 6563 6973 696f 6e5f 746f 6c65 7261  precision_tolera
+00001770: 6e63 655f 746f 5f64 726f 705f 6365 6e73  nce_to_drop_cens
+00001780: 6f72 203d 2030 2e32 3529 3a0d 0a20 2020  or = 0.25):..   
+00001790: 2027 2727 0d0a 2020 2020 4120 6675 6e63   '''..    A func
+000017a0: 7469 6f6e 2074 6861 7420 6465 7465 726d  tion that determ
+000017b0: 696e 6573 2074 6865 2063 656e 736f 7220  ines the censor 
+000017c0: 616e 6420 6e75 6d65 7269 6320 636f 6d70  and numeric comp
+000017d0: 6f6e 656e 7473 0d0a 2020 2020 6672 6f6d  onents..    from
+000017e0: 2069 6e74 6572 7661 6c73 0d0a 0d0a 2020   intervals....  
+000017f0: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+00001800: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
+00001810: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
+00001820: 0d0a 2020 2020 2020 2020 4461 7461 4672  ..        DataFr
+00001830: 616d 6520 7468 6174 2063 6f6e 7461 696e  ame that contain
+00001840: 7320 696e 7465 7276 616c 2069 6e66 6f72  s interval infor
+00001850: 6d61 7469 6f6e 0d0a 2020 2020 666f 6375  mation..    focu
+00001860: 735f 6869 6768 5f70 6f74 656e 7469 616c  s_high_potential
+00001870: 203a 2062 6f6f 6c65 616e 2c20 6f70 7469   : boolean, opti
+00001880: 6f6e 616c 0d0a 2020 2020 2020 2020 4966  onal..        If
+00001890: 2054 7275 652c 2074 6865 6e20 696e 666f   True, then info
+000018a0: 726d 6174 696f 6e20 6f6e 2074 6865 2068  rmation on the h
+000018b0: 6967 6865 7374 2070 6f74 656e 7469 616c  ighest potential
+000018c0: 2072 6573 756c 7420 7769 6c6c 2062 650d   result will be.
+000018d0: 0a20 2020 2020 2020 2066 6f63 7573 6564  .        focused
+000018e0: 206f 7665 7220 7468 6520 6c6f 7765 7374   over the lowest
+000018f0: 2070 6f74 656e 7469 616c 2072 6573 756c   potential resul
+00001900: 742e 0d0a 2020 2020 696e 636c 7564 655f  t...    include_
+00001910: 6e65 6761 7469 7665 5f69 6e74 6572 7661  negative_interva
+00001920: 6c20 3a20 626f 6f6c 6561 6e2c 206f 7074  l : boolean, opt
+00001930: 696f 6e61 6c0d 0a20 2020 2020 2020 2049  ional..        I
+00001940: 6620 5472 7565 2c20 7468 656e 2061 6c6c  f True, then all
+00001950: 2070 6f73 6974 6976 6520 616e 6420 6e65   positive and ne
+00001960: 6761 7469 7665 2076 616c 7565 7320 6172  gative values ar
+00001970: 6520 636f 6e73 6964 6572 6564 0d0a 2020  e considered..  
+00001980: 2020 2020 2020 652e 672e 2c20 3c30 2e35        e.g., <0.5
+00001990: 2077 6f75 6c64 2062 6520 636f 6e76 6572   would be conver
+000019a0: 7465 6420 746f 2028 2d6e 702e 696e 662c  ted to (-np.inf,
+000019b0: 3529 2e0d 0a20 2020 2020 2020 2049 6620  5)...        If 
+000019c0: 4661 6c73 652c 2074 6865 6e20 6f6e 6c79  False, then only
+000019d0: 206e 6f6e 2d6e 6567 6174 6976 6520 7661   non-negative va
+000019e0: 6c75 6573 2061 7265 2063 6f6e 7369 6465  lues are conside
+000019f0: 7265 640d 0a20 2020 2020 2020 2065 2e67  red..        e.g
+00001a00: 2e2c 203c 302e 3520 776f 756c 6420 6265  ., <0.5 would be
+00001a10: 2063 6f6e 7665 7274 6564 2074 6f20 5b30   converted to [0
+00001a20: 2c35 292e 0d0a 2020 2020 2020 2020 5468  ,5)...        Th
+00001a30: 6973 2073 6574 7469 6e67 206f 6e6c 7920  is setting only 
+00001a40: 6166 6665 6374 7320 7265 7375 6c74 7320  affects results 
+00001a50: 6966 2066 6f63 7573 5f68 6967 685f 706f  if focus_high_po
+00001a60: 7465 6e74 6961 6c20 6973 2046 616c 7365  tential is False
+00001a70: 2e0d 0a20 2020 2020 2020 2054 6865 2064  ...        The d
+00001a80: 6566 6175 6c74 2069 7320 4661 6c73 652e  efault is False.
+00001a90: 0d0a 2020 2020 7072 6563 6973 696f 6e5f  ..    precision_
+00001aa0: 746f 6c65 7261 6e63 655f 746f 5f64 726f  tolerance_to_dro
+00001ab0: 705f 6365 6e73 6f72 203a 2066 6c6f 6174  p_censor : float
+00001ac0: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
+00001ad0: 2020 2020 5468 7265 7368 6f6c 6420 666f      Threshold fo
+00001ae0: 7220 7265 706f 7274 696e 6720 6365 6e73  r reporting cens
+00001af0: 6f72 6564 2076 7320 6e6f 6e2d 6365 6e73  ored vs non-cens
+00001b00: 6f72 6564 2072 6573 756c 7473 2e0d 0a20  ored results... 
+00001b10: 2020 2020 2020 2055 7369 6e67 2074 6865         Using the
+00001b20: 2064 6566 6175 6c74 2c20 6120 7265 7375   default, a resu
+00001b30: 6c74 2074 6861 7420 6973 206b 6e6f 776e  lt that is known
+00001b40: 2074 6f20 6265 2069 6e20 7468 6520 696e   to be in the in
+00001b50: 7465 7276 616c 2028 302e 332c 2030 2e35  terval (0.3, 0.5
+00001b60: 290d 0a20 2020 2020 2020 2077 6f75 6c64  )..        would
+00001b70: 2062 6520 7265 7475 726e 6564 2061 7320   be returned as 
+00001b80: 302e 342c 2077 6865 7265 6173 2061 2074  0.4, whereas a t
+00001b90: 6f6c 6572 616e 6365 206f 6620 3020 776f  olerance of 0 wo
+00001ba0: 756c 6420 7969 656c 6420 610d 0a20 2020  uld yield a..   
+00001bb0: 2020 2020 2072 6573 756c 7420 6f66 203c       result of <
+00001bc0: 302e 3520 6f72 203e 302e 3320 6465 7065  0.5 or >0.3 depe
+00001bd0: 6e64 696e 6720 6f6e 2074 6865 2076 616c  nding on the val
+00001be0: 7565 206f 6620 666f 6375 735f 6869 6768  ue of focus_high
+00001bf0: 6573 745f 706f 7465 6e74 6961 6c2e 0d0a  est_potential...
+00001c00: 2020 2020 2020 2020 5468 6520 6465 6661          The defa
+00001c10: 756c 7420 6973 2030 2e32 352e 0d0a 0d0a  ult is 0.25.....
+00001c20: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
+00001c30: 202d 2d2d 2d2d 2d2d 0d0a 2020 2020 6466   -------..    df
+00001c40: 203a 2044 6174 6146 7261 6d65 0d0a 2020   : DataFrame..  
+00001c50: 2020 2020 2020 4461 7461 4672 616d 6520        DataFrame 
+00001c60: 7768 6572 6520 696e 7465 7276 616c 7320  where intervals 
+00001c70: 666f 7220 7265 7375 6c74 7320 6861 7665  for results have
+00001c80: 2062 6565 6e20 616e 616c 7973 6564 2074   been analysed t
+00001c90: 6f20 6365 6e73 6f72 2061 6e64 0d0a 2020  o censor and..  
+00001ca0: 2020 2020 2020 6e75 6d65 7269 6320 636f        numeric co
+00001cb0: 6d70 6f6e 656e 7473 2e0d 0a0d 0a20 2020  mponents.....   
+00001cc0: 2027 2727 0d0a 2020 2020 0d0a 2020 2020   '''..    ..    
+00001cd0: 2320 4372 6561 7465 2061 2063 6f70 7920  # Create a copy 
+00001ce0: 6f66 2074 6865 2044 6174 6146 7261 6d65  of the DataFrame
+00001cf0: 0d0a 2020 2020 6466 203d 2064 662e 636f  ..    df = df.co
+00001d00: 7079 2829 0d0a 2020 2020 0d0a 2020 2020  py()..    ..    
+00001d10: 2320 4465 7465 726d 696e 6520 7468 6520  # Determine the 
+00001d20: 6d69 6470 6f69 6e74 2066 6f72 2074 6865  midpoint for the
+00001d30: 2069 6e74 6572 7661 6c20 6966 2066 696e   interval if fin
+00001d40: 6974 6520 696e 7465 7276 616c 0d0a 2020  ite interval..  
+00001d50: 2020 6466 5b6d 6964 706f 696e 745f 636f    df[midpoint_co
+00001d60: 6c5d 203d 206e 702e 7768 6572 6528 2864  l] = np.where((d
+00001d70: 665b 6c65 6674 5f62 6f75 6e64 5f63 6f6c  f[left_bound_col
+00001d80: 5d20 3e20 2d6e 702e 696e 6629 2026 2028  ] > -np.inf) & (
+00001d90: 6466 5b72 6967 6874 5f62 6f75 6e64 5f63  df[right_bound_c
+00001da0: 6f6c 5d20 3c20 6e70 2e69 6e66 292c 0d0a  ol] < np.inf),..
+00001db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001dc0: 2020 2020 2020 2020 2020 2020 2020 302e                0.
+00001dd0: 3520 2a20 2864 665b 6c65 6674 5f62 6f75  5 * (df[left_bou
+00001de0: 6e64 5f63 6f6c 5d20 2b20 6466 5b72 6967  nd_col] + df[rig
+00001df0: 6874 5f62 6f75 6e64 5f63 6f6c 5d29 2c0d  ht_bound_col]),.
+00001e00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001e10: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00001e20: 702e 6e61 6e29 0d0a 2020 2020 0d0a 2020  p.nan)..    ..  
+00001e30: 2020 0d0a 2020 2020 2320 4465 6669 6e65    ..    # Define
+00001e40: 2074 6865 2063 6f6e 6469 7469 6f6e 7320   the conditions 
+00001e50: 666f 7220 616e 2075 6e63 656e 736f 7265  for an uncensore
+00001e60: 6420 7265 7375 6c74 0d0a 2020 2020 636f  d result..    co
+00001e70: 6e64 6974 696f 6e73 203d 205b 0d0a 2020  nditions = [..  
+00001e80: 2020 2020 2020 2320 4966 2074 6865 2062        # If the b
+00001e90: 6f75 6e64 7320 6172 6520 6571 7561 6c2c  ounds are equal,
+00001ea0: 2074 6865 6e20 7468 6520 7265 7375 6c74   then the result
+00001eb0: 2069 7320 756e 6365 6e73 6f72 6564 0d0a   is uncensored..
+00001ec0: 2020 2020 2020 2020 2864 665b 6c65 6674          (df[left
+00001ed0: 5f62 6f75 6e64 5f63 6f6c 5d20 3d3d 2064  _bound_col] == d
+00001ee0: 665b 7269 6768 745f 626f 756e 645f 636f  f[right_bound_co
+00001ef0: 6c5d 292c 0d0a 2020 2020 2020 2020 2320  l]),..        # 
+00001f00: 4966 2074 6865 2062 6f75 6e64 7320 6172  If the bounds ar
+00001f10: 6520 6669 6e69 7465 2061 6e64 2074 6865  e finite and the
+00001f20: 2069 6e74 6572 7661 6c20 6973 2077 6974   interval is wit
+00001f30: 6869 6e20 7468 6520 7072 6563 6973 696f  hin the precisio
+00001f40: 6e20 746f 6c65 7261 6e63 652c 2061 766f  n tolerance, avo
+00001f50: 6964 2074 6865 2075 7365 206f 6620 6365  id the use of ce
+00001f60: 6e73 6f72 730d 0a20 2020 2020 2020 2028  nsors..        (
+00001f70: 6466 5b72 6967 6874 5f62 6f75 6e64 5f63  df[right_bound_c
+00001f80: 6f6c 5d20 2d20 6466 5b6d 6964 706f 696e  ol] - df[midpoin
+00001f90: 745f 636f 6c5d 2920 3c3d 2064 665b 6d69  t_col]) <= df[mi
+00001fa0: 6470 6f69 6e74 5f63 6f6c 5d20 2a20 7072  dpoint_col] * pr
+00001fb0: 6563 6973 696f 6e5f 746f 6c65 7261 6e63  ecision_toleranc
+00001fc0: 655f 746f 5f64 726f 705f 6365 6e73 6f72  e_to_drop_censor
+00001fd0: 0d0a 2020 2020 2020 2020 5d0d 0a20 2020  ..        ]..   
+00001fe0: 200d 0a20 2020 2063 656e 736f 725f 7265   ..    censor_re
+00001ff0: 7375 6c74 7320 3d20 5b0d 0a20 2020 2020  sults = [..     
+00002000: 2020 2027 272c 0d0a 2020 2020 2020 2020     '',..        
+00002010: 2727 0d0a 2020 2020 2020 2020 5d0d 0a20  ''..        ].. 
+00002020: 2020 200d 0a20 2020 206e 756d 6572 6963     ..    numeric
+00002030: 5f72 6573 756c 7473 203d 5b0d 0a20 2020  _results =[..   
+00002040: 2020 2020 2064 665b 6d69 6470 6f69 6e74       df[midpoint
+00002050: 5f63 6f6c 5d2c 0d0a 2020 2020 2020 2020  _col],..        
+00002060: 6466 5b6d 6964 706f 696e 745f 636f 6c5d  df[midpoint_col]
+00002070: 0d0a 2020 2020 2020 2020 5d0d 0a20 2020  ..        ]..   
+00002080: 200d 0a20 2020 2023 2049 6620 666f 6375   ..    # If focu
+00002090: 7365 6420 6f6e 2074 6865 2068 6967 6865  sed on the highe
+000020a0: 7374 2070 6f74 656e 7469 616c 2072 6573  st potential res
+000020b0: 756c 740d 0a20 2020 2069 6620 666f 6375  ult..    if focu
+000020c0: 735f 6869 6768 5f70 6f74 656e 7469 616c  s_high_potential
+000020d0: 3a0d 0a20 2020 2020 2020 2023 2053 6574  :..        # Set
+000020e0: 2063 656e 736f 7220 616e 6420 6e75 6d65   censor and nume
+000020f0: 7269 6320 636f 6d70 6f6e 656e 7473 2066  ric components f
+00002100: 6f72 2065 6163 6820 636f 6e64 6974 696f  or each conditio
+00002110: 6e0d 0a20 2020 2020 2020 2063 6f6e 6469  n..        condi
+00002120: 7469 6f6e 7320 2b3d 205b 0d0a 2020 2020  tions += [..    
+00002130: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
+00002140: 7265 2069 7320 616e 2069 6e66 696e 6974  re is an infinit
+00002150: 6520 7269 6768 7420 626f 756e 642c 2074  e right bound, t
+00002160: 6865 2072 6573 756c 7420 6973 2072 6967  he result is rig
+00002170: 6874 2063 656e 736f 7265 640d 0a20 2020  ht censored..   
+00002180: 2020 2020 2020 2020 2028 6466 5b72 6967           (df[rig
+00002190: 6874 5f62 6f75 6e64 5f63 6f6c 5d20 3d3d  ht_bound_col] ==
+000021a0: 206e 702e 696e 6629 2026 2028 6466 5b6c   np.inf) & (df[l
+000021b0: 6566 745f 626f 756e 645f 636f 6c5d 203e  eft_bound_col] >
+000021c0: 202d 6e70 2e69 6e66 2920 2620 2864 665b   -np.inf) & (df[
+000021d0: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
+000021e0: 6c5d 203d 3d20 274f 7065 6e27 292c 0d0a  l] == 'Open'),..
+000021f0: 2020 2020 2020 2020 2020 2020 2864 665b              (df[
+00002200: 7269 6768 745f 626f 756e 645f 636f 6c5d  right_bound_col]
+00002210: 203d 3d20 6e70 2e69 6e66 2920 2620 2864   == np.inf) & (d
+00002220: 665b 6c65 6674 5f62 6f75 6e64 5f63 6f6c  f[left_bound_col
+00002230: 5d20 3e20 2d6e 702e 696e 6629 2026 2028  ] > -np.inf) & (
+00002240: 6466 5b6c 6566 745f 626f 756e 6461 7279  df[left_boundary
+00002250: 5f63 6f6c 5d20 3d3d 2027 436c 6f73 6564  _col] == 'Closed
+00002260: 2729 2c0d 0a20 2020 2020 2020 2020 2020  '),..           
+00002270: 2023 204f 7468 6572 7769 7365 2c20 7468   # Otherwise, th
+00002280: 6520 7265 7375 6c74 2073 686f 756c 6420  e result should 
+00002290: 6265 206c 6566 7420 6365 6e73 6f72 6564  be left censored
+000022a0: 0d0a 2020 2020 2020 2020 2020 2020 2864  ..            (d
+000022b0: 665b 7269 6768 745f 626f 756e 645f 636f  f[right_bound_co
+000022c0: 6c5d 203c 206e 702e 696e 6629 2026 2028  l] < np.inf) & (
+000022d0: 6466 5b72 6967 6874 5f62 6f75 6e64 6172  df[right_boundar
+000022e0: 795f 636f 6c5d 203d 3d20 274f 7065 6e27  y_col] == 'Open'
+000022f0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00002300: 2864 665b 7269 6768 745f 626f 756e 645f  (df[right_bound_
+00002310: 636f 6c5d 203c 206e 702e 696e 6629 2026  col] < np.inf) &
+00002320: 2028 6466 5b72 6967 6874 5f62 6f75 6e64   (df[right_bound
+00002330: 6172 795f 636f 6c5d 203d 3d20 2743 6c6f  ary_col] == 'Clo
+00002340: 7365 6427 290d 0a20 2020 2020 2020 2020  sed')..         
+00002350: 2020 205d 0d0a 2020 2020 2020 2020 0d0a     ]..        ..
+00002360: 2020 2020 2020 2020 6365 6e73 6f72 5f72          censor_r
+00002370: 6573 756c 7473 202b 3d20 5b0d 0a20 2020  esults += [..   
+00002380: 2020 2020 2020 2020 2027 3e27 2c0d 0a20           '>',.. 
+00002390: 2020 2020 2020 2020 2020 2027 e289 a527             '...'
+000023a0: 2c0d 0a20 2020 2020 2020 2020 2020 2027  ,..            '
+000023b0: 3c27 2c0d 0a20 2020 2020 2020 2020 2020  <',..           
+000023c0: 2027 e289 a427 0d0a 2020 2020 2020 2020   '...'..        
+000023d0: 2020 2020 5d0d 0a20 2020 2020 2020 200d      ]..        .
+000023e0: 0a20 2020 2020 2020 206e 756d 6572 6963  .        numeric
+000023f0: 5f72 6573 756c 7473 202b 3d20 5b0d 0a20  _results += [.. 
+00002400: 2020 2020 2020 2020 2020 2064 665b 6c65             df[le
+00002410: 6674 5f62 6f75 6e64 5f63 6f6c 5d2c 0d0a  ft_bound_col],..
+00002420: 2020 2020 2020 2020 2020 2020 6466 5b6c              df[l
+00002430: 6566 745f 626f 756e 645f 636f 6c5d 2c0d  eft_bound_col],.
+00002440: 0a20 2020 2020 2020 2020 2020 2064 665b  .            df[
+00002450: 7269 6768 745f 626f 756e 645f 636f 6c5d  right_bound_col]
+00002460: 2c0d 0a20 2020 2020 2020 2020 2020 2064  ,..            d
+00002470: 665b 7269 6768 745f 626f 756e 645f 636f  f[right_bound_co
+00002480: 6c5d 0d0a 2020 2020 2020 2020 2020 2020  l]..            
+00002490: 5d0d 0a20 2020 2023 2045 6c73 6520 666f  ]..    # Else fo
+000024a0: 6375 7365 6420 6f6e 2074 6865 206c 6f77  cused on the low
+000024b0: 6573 7420 706f 7465 6e74 6961 6c20 7265  est potential re
+000024c0: 7375 6c74 0d0a 2020 2020 656c 7365 3a0d  sult..    else:.
+000024d0: 0a20 2020 2020 2020 2023 2044 6574 6572  .        # Deter
+000024e0: 6d69 6e65 2074 6865 206c 6f77 6572 2062  mine the lower b
+000024f0: 6f75 6e64 0d0a 2020 2020 2020 2020 6966  ound..        if
+00002500: 2069 6e63 6c75 6465 5f6e 6567 6174 6976   include_negativ
+00002510: 655f 696e 7465 7276 616c 3a0d 0a20 2020  e_interval:..   
+00002520: 2020 2020 2020 2020 206c 6f77 6572 5f62           lower_b
+00002530: 6f75 6e64 203d 202d 6e70 2e69 6e66 0d0a  ound = -np.inf..
+00002540: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00002550: 2020 2020 2020 2020 2020 206c 6f77 6572             lower
+00002560: 5f62 6f75 6e64 203d 2030 2e30 0d0a 2020  _bound = 0.0..  
+00002570: 2020 2020 2020 2320 5365 7420 6365 6e73        # Set cens
+00002580: 6f72 2061 6e64 206e 756d 6572 6963 2063  or and numeric c
+00002590: 6f6d 706f 6e65 6e74 7320 666f 7220 6561  omponents for ea
+000025a0: 6368 2063 6f6e 6469 7469 6f6e 0d0a 2020  ch condition..  
+000025b0: 2020 2020 2020 636f 6e64 6974 696f 6e73        conditions
+000025c0: 202b 3d20 5b0d 0a20 2020 2020 2020 2020   += [..         
+000025d0: 2020 2023 2049 6620 7468 6520 6c65 6674     # If the left
+000025e0: 2062 6f75 6e64 2069 7320 6964 656e 7469   bound is identi
+000025f0: 6361 6c20 746f 2074 6865 206c 6f77 6573  cal to the lowes
+00002600: 7420 706f 7465 6e74 6961 6c20 6c6f 7765  t potential lowe
+00002610: 7220 626f 756e 642c 0d0a 2020 2020 2020  r bound,..      
+00002620: 2020 2020 2020 2320 7468 656e 2074 6865        # then the
+00002630: 2072 6573 756c 7420 6973 206c 6566 7420   result is left 
+00002640: 6365 6e73 6f72 6564 0d0a 2020 2020 2020  censored..      
+00002650: 2020 2020 2020 2864 665b 6c65 6674 5f62        (df[left_b
+00002660: 6f75 6e64 5f63 6f6c 5d20 3d3d 206c 6f77  ound_col] == low
+00002670: 6572 5f62 6f75 6e64 2920 2620 2864 665b  er_bound) & (df[
+00002680: 7269 6768 745f 626f 756e 645f 636f 6c5d  right_bound_col]
+00002690: 203c 206e 702e 696e 6629 2026 2028 6466   < np.inf) & (df
+000026a0: 5b72 6967 6874 5f62 6f75 6e64 6172 795f  [right_boundary_
+000026b0: 636f 6c5d 203d 3d20 274f 7065 6e27 292c  col] == 'Open'),
+000026c0: 0d0a 2020 2020 2020 2020 2020 2020 2864  ..            (d
+000026d0: 665b 6c65 6674 5f62 6f75 6e64 5f63 6f6c  f[left_bound_col
+000026e0: 5d20 3d3d 206c 6f77 6572 5f62 6f75 6e64  ] == lower_bound
+000026f0: 2920 2620 2864 665b 7269 6768 745f 626f  ) & (df[right_bo
+00002700: 756e 645f 636f 6c5d 203c 206e 702e 696e  und_col] < np.in
+00002710: 6629 2026 2028 6466 5b72 6967 6874 5f62  f) & (df[right_b
+00002720: 6f75 6e64 6172 795f 636f 6c5d 203d 3d20  oundary_col] == 
+00002730: 2743 6c6f 7365 6427 292c 0d0a 2020 2020  'Closed'),..    
+00002740: 2020 2020 2020 2020 2320 4f74 6865 7277          # Otherw
+00002750: 6973 652c 2074 6865 2072 6573 756c 7420  ise, the result 
+00002760: 7368 6f75 6c64 2062 6520 7269 6768 7420  should be right 
+00002770: 6365 6e73 6f72 6564 0d0a 2020 2020 2020  censored..      
+00002780: 2020 2020 2020 2864 665b 6c65 6674 5f62        (df[left_b
+00002790: 6f75 6e64 5f63 6f6c 5d20 3e20 6c6f 7765  ound_col] > lowe
+000027a0: 725f 626f 756e 6429 2026 2028 6466 5b6c  r_bound) & (df[l
+000027b0: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
+000027c0: 5d20 3d3d 2027 4f70 656e 2729 2c0d 0a20  ] == 'Open'),.. 
+000027d0: 2020 2020 2020 2020 2020 2028 6466 5b6c             (df[l
+000027e0: 6566 745f 626f 756e 645f 636f 6c5d 203e  eft_bound_col] >
+000027f0: 206c 6f77 6572 5f62 6f75 6e64 2920 2620   lower_bound) & 
+00002800: 2864 665b 6c65 6674 5f62 6f75 6e64 6172  (df[left_boundar
+00002810: 795f 636f 6c5d 203d 3d20 2743 6c6f 7365  y_col] == 'Close
+00002820: 6427 290d 0a20 2020 2020 2020 2020 2020  d')..           
+00002830: 205d 0d0a 2020 2020 2020 2020 0d0a 2020   ]..        ..  
+00002840: 2020 2020 2020 6365 6e73 6f72 5f72 6573        censor_res
+00002850: 756c 7473 202b 3d20 5b0d 0a20 2020 2020  ults += [..     
+00002860: 2020 2020 2020 2027 3c27 2c0d 0a20 2020         '<',..   
+00002870: 2020 2020 2020 2020 2027 e289 a427 2c0d           '...',.
+00002880: 0a20 2020 2020 2020 2020 2020 2027 3e27  .            '>'
+00002890: 2c0d 0a20 2020 2020 2020 2020 2020 2027  ,..            '
+000028a0: e289 a527 0d0a 2020 2020 2020 2020 2020  ...'..          
+000028b0: 2020 5d0d 0a20 2020 2020 2020 200d 0a20    ]..        .. 
+000028c0: 2020 2020 2020 206e 756d 6572 6963 5f72         numeric_r
+000028d0: 6573 756c 7473 202b 3d20 5b0d 0a20 2020  esults += [..   
+000028e0: 2020 2020 2020 2020 2064 665b 7269 6768           df[righ
+000028f0: 745f 626f 756e 645f 636f 6c5d 2c0d 0a20  t_bound_col],.. 
+00002900: 2020 2020 2020 2020 2020 2064 665b 7269             df[ri
+00002910: 6768 745f 626f 756e 645f 636f 6c5d 2c0d  ght_bound_col],.
+00002920: 0a20 2020 2020 2020 2020 2020 2064 665b  .            df[
+00002930: 6c65 6674 5f62 6f75 6e64 5f63 6f6c 5d2c  left_bound_col],
+00002940: 0d0a 2020 2020 2020 2020 2020 2020 6466  ..            df
+00002950: 5b6c 6566 745f 626f 756e 645f 636f 6c5d  [left_bound_col]
+00002960: 0d0a 2020 2020 2020 2020 2020 2020 5d0d  ..            ].
+00002970: 0a20 2020 200d 0a20 2020 2023 2044 6574  .    ..    # Det
+00002980: 6572 6d69 6e65 2074 6865 2063 656e 736f  ermine the censo
+00002990: 7220 616e 6420 6e75 6d65 7269 6320 636f  r and numeric co
+000029a0: 6d70 6f6e 656e 7473 0d0a 2020 2020 2320  mponents..    # 
+000029b0: 4966 206e 6f20 636f 6e64 6974 696f 6e20  If no condition 
+000029c0: 6973 206d 6574 2c20 6465 6661 756c 7420  is met, default 
+000029d0: 746f 203c 3e20 616e 6420 4e61 4e0d 0a20  to <> and NaN.. 
+000029e0: 2020 2064 665b 6365 6e73 6f72 5f63 6f6c     df[censor_col
+000029f0: 5d20 3d20 6e70 2e73 656c 6563 7428 636f  ] = np.select(co
+00002a00: 6e64 6974 696f 6e73 2c20 6365 6e73 6f72  nditions, censor
+00002a10: 5f72 6573 756c 7473 2c20 273c 3e27 290d  _results, '<>').
+00002a20: 0a20 2020 2064 665b 6e75 6d65 7269 635f  .    df[numeric_
+00002a30: 636f 6c5d 203d 206e 702e 7365 6c65 6374  col] = np.select
+00002a40: 2863 6f6e 6469 7469 6f6e 732c 206e 756d  (conditions, num
+00002a50: 6572 6963 5f72 6573 756c 7473 2c20 6e70  eric_results, np
+00002a60: 2e6e 616e 290d 0a20 2020 200d 0a20 2020  .nan)..    ..   
+00002a70: 2072 6574 7572 6e20 6466 0d0a 0d0a 2325   return df....#%
+00002a80: 2525 2049 6e74 6572 7661 6c20 636f 6d70  %% Interval comp
+00002a90: 6f6e 656e 7473 2074 6f20 696e 7465 7276  onents to interv
+00002aa0: 616c 2073 7472 696e 670d 0a0d 0a64 6566  al string....def
+00002ab0: 2069 6e74 6572 7661 6c5f 6e6f 7461 7469   interval_notati
+00002ac0: 6f6e 2864 662c 0d0a 2020 2020 2020 2020  on(df,..        
+00002ad0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00002ae0: 6563 6973 696f 6e5f 726f 756e 6469 6e67  ecision_rounding
+00002af0: 3d54 7275 6529 3a0d 0a20 2020 2027 2727  =True):..    '''
+00002b00: 0d0a 2020 2020 5468 6973 2066 756e 6374  ..    This funct
+00002b10: 696f 6e20 6372 6561 7465 7320 6120 636f  ion creates a co
+00002b20: 6c75 6d6e 2074 6861 7420 636f 6d62 696e  lumn that combin
+00002b30: 6573 2074 6865 2069 6e74 6572 7661 6c20  es the interval 
+00002b40: 636f 6d70 6f6e 656e 7473 0d0a 2020 2020  components..    
+00002b50: 696e 746f 2061 2073 696e 676c 6520 7465  into a single te
+00002b60: 7874 206e 6f74 6174 696f 6e20 666f 7220  xt notation for 
+00002b70: 696e 7465 7276 616c 732e 0d0a 0d0a 2020  intervals.....  
+00002b80: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+00002b90: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
+00002ba0: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
+00002bb0: 0d0a 2020 2020 2020 2020 4461 7461 4672  ..        DataFr
+00002bc0: 616d 6520 636f 6e74 6169 6e69 6e67 2063  ame containing c
+00002bd0: 6f6c 756d 6e73 2066 6f72 206c 6566 742f  olumns for left/
+00002be0: 7269 6768 7420 626f 756e 6473 2061 6e64  right bounds and
+00002bf0: 2062 6f75 6e64 6172 6965 730d 0a20 2020   boundaries..   
+00002c00: 2070 7265 6369 7369 6f6e 5f72 6f75 6e64   precision_round
+00002c10: 696e 6720 3a20 626f 6f6c 6561 6e2c 206f  ing : boolean, o
+00002c20: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
+00002c30: 2049 6620 5472 7565 2c20 6120 726f 756e   If True, a roun
+00002c40: 6469 6e67 206d 6574 686f 6420 6973 2061  ding method is a
+00002c50: 7070 6c69 6564 2074 6f20 726f 756e 6420  pplied to round 
+00002c60: 7265 7375 6c74 7320 746f 2068 6176 6520  results to have 
+00002c70: 6e6f 206d 6f72 650d 0a20 2020 2020 2020  no more..       
+00002c80: 2064 6563 696d 616c 7320 7468 616e 2077   decimals than w
+00002c90: 6861 7420 6361 6e20 6265 206d 6561 7375  hat can be measu
+00002ca0: 7265 642e 0d0a 2020 2020 2020 2020 5468  red...        Th
+00002cb0: 6520 6465 6661 756c 7420 6973 2054 7275  e default is Tru
+00002cc0: 652e 0d0a 0d0a 2020 2020 5265 7475 726e  e.....    Return
+00002cd0: 730d 0a20 2020 202d 2d2d 2d2d 2d2d 0d0a  s..    -------..
+00002ce0: 2020 2020 6466 203a 2044 6174 6146 7261      df : DataFra
+00002cf0: 6d65 0d0a 2020 2020 2020 2020 4461 7461  me..        Data
+00002d00: 4672 616d 6520 6964 656e 7469 6361 6c20  Frame identical 
+00002d10: 746f 2069 6e74 7075 7420 7769 7468 2061  to intput with a
+00002d20: 6464 6974 696f 6e61 6c20 636f 6c75 6d6e  dditional column
+00002d30: 2077 6974 6820 636f 6d62 696e 6564 0d0a   with combined..
+00002d40: 2020 2020 2020 2020 696e 7465 7276 616c          interval
+00002d50: 206e 6f74 6174 696f 6e0d 0a0d 0a20 2020   notation....   
+00002d60: 2027 2727 0d0a 2020 2020 0d0a 2020 2020   '''..    ..    
+00002d70: 2320 4372 6561 7465 2061 2063 6f70 7920  # Create a copy 
+00002d80: 6f66 2074 6865 2044 6174 6146 7261 6d65  of the DataFrame
+00002d90: 0d0a 2020 2020 6466 203d 2064 662e 636f  ..    df = df.co
+00002da0: 7079 2829 0d0a 2020 2020 0d0a 2020 2020  py()..    ..    
+00002db0: 2320 4465 7465 726d 696e 6520 7468 6520  # Determine the 
+00002dc0: 6c65 6674 2062 6f75 6e64 6172 7920 7379  left boundary sy
+00002dd0: 6d62 6f6c 0d0a 2020 2020 6466 5b69 6e74  mbol..    df[int
+00002de0: 6572 7661 6c5f 636f 6c5d 203d 206e 702e  erval_col] = np.
+00002df0: 7768 6572 6528 6466 5b6c 6566 745f 626f  where(df[left_bo
+00002e00: 756e 6461 7279 5f63 6f6c 5d20 3d3d 2027  undary_col] == '
+00002e10: 4f70 656e 272c 2027 2827 2c20 275b 2729  Open', '(', '[')
+00002e20: 0d0a 2020 2020 0d0a 2020 2020 2320 496e  ..    ..    # In
+00002e30: 636f 7270 6f72 6174 6520 6c65 6674 2061  corporate left a
+00002e40: 6e64 2072 6967 6874 2062 6f75 6e64 730d  nd right bounds.
+00002e50: 0a20 2020 2069 6620 7072 6563 6973 696f  .    if precisio
+00002e60: 6e5f 726f 756e 6469 6e67 3a0d 0a20 2020  n_rounding:..   
+00002e70: 2020 2020 2064 665b 696e 7465 7276 616c       df[interval
+00002e80: 5f63 6f6c 5d20 2b3d 2064 665b 6c65 6674  _col] += df[left
+00002e90: 5f62 6f75 6e64 5f63 6f6c 5d2e 6170 706c  _bound_col].appl
+00002ea0: 7928 7374 7269 6e67 5f70 7265 6369 7369  y(string_precisi
+00002eb0: 6f6e 2920 2b20 272c 2027 202b 2064 665b  on) + ', ' + df[
+00002ec0: 7269 6768 745f 626f 756e 645f 636f 6c5d  right_bound_col]
+00002ed0: 2e61 7070 6c79 2873 7472 696e 675f 7072  .apply(string_pr
+00002ee0: 6563 6973 696f 6e29 0d0a 2020 2020 656c  ecision)..    el
+00002ef0: 7365 3a0d 0a20 2020 2020 2020 2064 665b  se:..        df[
+00002f00: 696e 7465 7276 616c 5f63 6f6c 5d20 2b3d  interval_col] +=
+00002f10: 2064 665b 6c65 6674 5f62 6f75 6e64 5f63   df[left_bound_c
+00002f20: 6f6c 5d2e 6173 7479 7065 2873 7472 2920  ol].astype(str) 
+00002f30: 2b20 272c 2027 202b 2064 665b 7269 6768  + ', ' + df[righ
+00002f40: 745f 626f 756e 645f 636f 6c5d 2e61 7374  t_bound_col].ast
+00002f50: 7970 6528 7374 7229 0d0a 2020 2020 0d0a  ype(str)..    ..
+00002f60: 2020 2020 2320 4465 7465 726d 696e 6520      # Determine 
+00002f70: 7468 6520 7269 6768 7420 626f 756e 6461  the right bounda
+00002f80: 7279 2073 796d 626f 6c0d 0a20 2020 2064  ry symbol..    d
+00002f90: 665b 696e 7465 7276 616c 5f63 6f6c 5d20  f[interval_col] 
+00002fa0: 2b3d 206e 702e 7768 6572 6528 6466 5b72  += np.where(df[r
+00002fb0: 6967 6874 5f62 6f75 6e64 6172 795f 636f  ight_boundary_co
+00002fc0: 6c5d 2e69 7369 6e28 5b27 4f70 656e 275d  l].isin(['Open']
+00002fd0: 292c 2027 2927 2c20 275d 2729 0d0a 2020  ), ')', ']')..  
+00002fe0: 2020 0d0a 2020 2020 7265 7475 726e 2064    ..    return d
+00002ff0: 660d 0a0d 0a0d 0a23 2525 204d 6178 696d  f......#%% Maxim
+00003000: 756d 2052 6573 756c 740d 0a0d 0a64 6566  um Result....def
+00003010: 206d 6178 696d 756d 5f69 6e74 6572 7661   maximum_interva
+00003020: 6c28 6466 2c0d 0a20 2020 2020 2020 2020  l(df,..         
+00003030: 2020 2020 2020 2020 2020 2020 6772 6f75              grou
+00003040: 7062 795f 636f 6c75 6d6e 7329 3a0d 0a20  pby_columns):.. 
+00003050: 2020 2027 2727 0d0a 2020 2020 4120 6675     '''..    A fu
+00003060: 6e63 7469 6f6e 2074 6861 7420 616e 616c  nction that anal
+00003070: 7973 6573 2074 6865 2069 6e74 6572 7661  yses the interva
+00003080: 6c20 6e6f 7461 7469 6f6e 2066 6f72 6d20  l notation form 
+00003090: 6f66 2072 6573 756c 7473 2072 6574 7572  of results retur
+000030a0: 6e65 640d 0a20 2020 2066 726f 6d20 636f  ned..    from co
+000030b0: 6d70 6f6e 656e 7473 5f74 6f5f 696e 7465  mponents_to_inte
+000030c0: 7276 616c 2074 6f20 6765 6e65 7261 7465  rval to generate
+000030d0: 2061 206e 6577 2069 6e74 6572 7661 6c20   a new interval 
+000030e0: 666f 7220 7468 6520 6d61 7869 6d75 6d2e  for the maximum.
+000030f0: 2047 726f 7570 730d 0a20 2020 206f 6620   Groups..    of 
+00003100: 7265 7375 6c74 7320 6361 6e20 6265 2064  results can be d
+00003110: 6566 696e 6564 2062 7920 696e 636c 7564  efined by includ
+00003120: 696e 6720 7468 6520 636f 6c75 6d6e 7320  ing the columns 
+00003130: 7468 6174 2073 686f 756c 6420 6265 2075  that should be u
+00003140: 7365 6420 746f 0d0a 2020 2020 6372 6561  sed to..    crea
+00003150: 7465 2067 726f 7570 732e 0d0a 0d0a 2020  te groups.....  
+00003160: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+00003170: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
+00003180: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
+00003190: 0d0a 2020 2020 2020 2020 4461 7461 4672  ..        DataFr
+000031a0: 616d 6520 7468 6174 2063 6f6e 7461 696e  ame that contain
+000031b0: 7320 7265 7375 6c74 7320 696e 2061 2073  s results in a s
+000031c0: 7065 6369 6669 6320 696e 7465 7276 616c  pecific interval
+000031d0: 206e 6f74 6174 696f 6e2e 0d0a 2020 2020   notation...    
+000031e0: 6772 6f75 7062 795f 636f 6c75 6d6e 7320  groupby_columns 
+000031f0: 3a20 6c69 7374 206f 6620 7374 7269 6e67  : list of string
+00003200: 730d 0a20 2020 2020 2020 204c 6973 7420  s..        List 
+00003210: 6f66 2063 6f6c 756d 6e20 6e61 6d65 7320  of column names 
+00003220: 7468 6174 2073 686f 756c 6420 6265 2075  that should be u
+00003230: 7365 6420 746f 2063 7265 6174 6520 6772  sed to create gr
+00003240: 6f75 7073 2e0d 0a0d 0a20 2020 2052 6574  oups.....    Ret
+00003250: 7572 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d  urns..    ------
+00003260: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
+00003270: 4672 616d 650d 0a20 2020 2020 2020 2044  Frame..        D
+00003280: 6174 6146 7261 6d65 2074 6861 7420 6861  ataFrame that ha
+00003290: 7320 7468 6520 696e 7465 7276 616c 2066  s the interval f
+000032a0: 6f72 2074 6865 206d 6178 696d 756d 2028  or the maximum (
+000032b0: 666f 7220 6561 6368 2067 726f 7570 2069  for each group i
+000032c0: 660d 0a20 2020 2020 2020 2063 6f6c 756d  f..        colum
+000032d0: 6e20 6e61 6d65 7320 6172 6520 7072 6f76  n names are prov
+000032e0: 6964 6564 2066 6f72 2067 726f 7570 696e  ided for groupin
+000032f0: 6729 0d0a 0d0a 2020 2020 2727 270d 0a20  g)....    '''.. 
+00003300: 2020 200d 0a20 2020 2023 2043 7265 6174     ..    # Creat
+00003310: 6520 6120 636f 7079 206f 6620 7468 6520  e a copy of the 
+00003320: 4461 7461 4672 616d 650d 0a20 2020 2064  DataFrame..    d
+00003330: 6620 3d20 6466 2e63 6f70 7928 292e 7265  f = df.copy().re
+00003340: 7365 745f 696e 6465 7828 290d 0a20 2020  set_index()..   
+00003350: 200d 0a20 2020 2023 2043 7265 6174 6520   ..    # Create 
+00003360: 636f 6c75 6d6e 2074 6861 7420 696e 6469  column that indi
+00003370: 6361 7465 7320 7468 6520 6765 6e65 7261  cates the genera
+00003380: 7465 6420 7374 6174 6973 7469 6320 616e  ted statistic an
+00003390: 6420 6170 7065 6e64 2074 6f20 6772 6f75  d append to grou
+000033a0: 7069 6e67 206c 6973 740d 0a20 2020 2064  ping list..    d
+000033b0: 665b 7374 6174 5f63 6f6c 5d20 3d20 274d  f[stat_col] = 'M
+000033c0: 6178 696d 756d 270d 0a20 2020 2067 726f  aximum'..    gro
+000033d0: 7570 6279 5f63 6f6c 756d 6e73 2e61 7070  upby_columns.app
+000033e0: 656e 6428 7374 6174 5f63 6f6c 290d 0a20  end(stat_col).. 
+000033f0: 2020 200d 0a20 2020 2023 2044 6574 6572     ..    # Deter
+00003400: 6d69 6e65 206c 6566 7420 626f 756e 6420  mine left bound 
+00003410: 616e 6420 626f 756e 6461 7279 2066 6f72  and boundary for
+00003420: 206d 6178 696d 756d 2066 6f72 2065 6163   maximum for eac
+00003430: 6820 6772 6f75 702e 0d0a 2020 2020 0d0a  h group...    ..
+00003440: 2020 2020 2320 436f 6e73 6964 6572 2074      # Consider t
+00003450: 6865 206d 6178 696d 756d 2062 6f75 6e64  he maximum bound
+00003460: 2066 6f72 2065 6163 6820 6c65 6674 2062   for each left b
+00003470: 6f75 6e64 6172 7920 6f70 7469 6f6e 2074  oundary option t
+00003480: 6f20 6465 7465 726d 696e 650d 0a20 2020  o determine..   
+00003490: 2023 2077 6865 7468 6572 2074 6865 2062   # whether the b
+000034a0: 6f75 6e64 2073 686f 756c 6420 6265 206f  ound should be o
+000034b0: 7065 6e20 6f72 2063 6c6f 7365 642e 0d0a  pen or closed...
+000034c0: 2020 2020 6c65 6674 203d 2064 662e 6772      left = df.gr
+000034d0: 6f75 7062 7928 6772 6f75 7062 795f 636f  oupby(groupby_co
+000034e0: 6c75 6d6e 732b 5b6c 6566 745f 626f 756e  lumns+[left_boun
+000034f0: 6461 7279 5f63 6f6c 5d29 5b6c 6566 745f  dary_col])[left_
+00003500: 626f 756e 645f 636f 6c5d 2e6d 6178 2829  bound_col].max()
+00003510: 2e75 6e73 7461 636b 286c 6566 745f 626f  .unstack(left_bo
+00003520: 756e 6461 7279 5f63 6f6c 290d 0a20 2020  undary_col)..   
+00003530: 2023 2043 7265 6174 6520 6d69 7373 696e   # Create missin
+00003540: 6720 636f 6c75 6d6e 730d 0a20 2020 2066  g columns..    f
+00003550: 6f72 2069 7465 6d20 696e 205b 274f 7065  or item in ['Ope
+00003560: 6e27 2c27 436c 6f73 6564 275d 3a0d 0a20  n','Closed']:.. 
+00003570: 2020 2020 2020 2069 6620 6974 656d 206e         if item n
+00003580: 6f74 2069 6e20 6c65 6674 2e63 6f6c 756d  ot in left.colum
+00003590: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
+000035a0: 206c 6566 745b 6974 656d 5d20 3d20 6e70   left[item] = np
+000035b0: 2e6e 616e 0d0a 2020 2020 2320 5573 6520  .nan..    # Use 
+000035c0: 7468 6520 6d61 7869 6d75 6d20 636c 6f73  the maximum clos
+000035d0: 6564 2062 6f75 6e64 6172 7920 6966 2074  ed boundary if t
+000035e0: 6865 7265 2061 7265 206e 6f20 6f70 656e  here are no open
+000035f0: 2062 6f75 6e64 6172 6965 7320 6f72 0d0a   boundaries or..
+00003600: 2020 2020 2320 6966 2074 6865 2063 6c6f      # if the clo
+00003610: 7365 6420 626f 756e 6461 7279 2069 7320  sed boundary is 
+00003620: 6c61 7267 6572 2074 6861 6e20 7468 6520  larger than the 
+00003630: 6c61 7267 6573 7420 6f70 656e 2062 6f75  largest open bou
+00003640: 6e64 6172 790d 0a20 2020 2063 6f6e 6469  ndary..    condi
+00003650: 7469 6f6e 203d 2028 6c65 6674 5b27 436c  tion = (left['Cl
+00003660: 6f73 6564 275d 203e 206c 6566 745b 274f  osed'] > left['O
+00003670: 7065 6e27 5d29 207c 2028 6c65 6674 5b27  pen']) | (left['
+00003680: 4f70 656e 275d 2e69 736e 6128 2929 0d0a  Open'].isna())..
+00003690: 2020 2020 6c65 6674 5b6c 6566 745f 626f      left[left_bo
+000036a0: 756e 6461 7279 5f63 6f6c 5d20 3d20 6e70  undary_col] = np
+000036b0: 2e77 6865 7265 2863 6f6e 6469 7469 6f6e  .where(condition
+000036c0: 2c27 436c 6f73 6564 272c 274f 7065 6e27  ,'Closed','Open'
+000036d0: 290d 0a20 2020 206c 6566 745b 6c65 6674  )..    left[left
+000036e0: 5f62 6f75 6e64 5f63 6f6c 5d20 3d20 6e70  _bound_col] = np
+000036f0: 2e77 6865 7265 2863 6f6e 6469 7469 6f6e  .where(condition
+00003700: 2c6c 6566 745b 2743 6c6f 7365 6427 5d2c  ,left['Closed'],
+00003710: 6c65 6674 5b27 4f70 656e 275d 290d 0a20  left['Open']).. 
+00003720: 2020 206c 6566 7420 3d20 6c65 6674 5b5b     left = left[[
+00003730: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
+00003740: 6c2c 6c65 6674 5f62 6f75 6e64 5f63 6f6c  l,left_bound_col
+00003750: 5d5d 0d0a 2020 2020 0d0a 2020 2020 2320  ]]..    ..    # 
+00003760: 4465 7465 726d 696e 6520 7269 6768 7420  Determine right 
+00003770: 626f 756e 6420 616e 6420 626f 756e 6461  bound and bounda
+00003780: 7279 2066 6f72 206d 6178 696d 756d 2066  ry for maximum f
+00003790: 6f72 2065 6163 6820 6772 6f75 702e 0d0a  or each group...
+000037a0: 2020 2020 0d0a 2020 2020 2320 436f 6e73      ..    # Cons
+000037b0: 6964 6572 2074 6865 206d 6178 696d 756d  ider the maximum
+000037c0: 2062 6f75 6e64 2066 6f72 2065 6163 6820   bound for each 
+000037d0: 7269 6768 7420 626f 756e 6461 7279 206f  right boundary o
+000037e0: 7074 696f 6e20 746f 2064 6574 6572 6d69  ption to determi
+000037f0: 6e65 0d0a 2020 2020 2320 7768 6574 6865  ne..    # whethe
+00003800: 7220 7468 6520 626f 756e 6420 7368 6f75  r the bound shou
+00003810: 6c64 2062 6520 6f70 656e 206f 7220 636c  ld be open or cl
+00003820: 6f73 6564 2e0d 0a20 2020 2072 6967 6874  osed...    right
+00003830: 203d 2064 662e 6772 6f75 7062 7928 6772   = df.groupby(gr
+00003840: 6f75 7062 795f 636f 6c75 6d6e 732b 5b72  oupby_columns+[r
+00003850: 6967 6874 5f62 6f75 6e64 6172 795f 636f  ight_boundary_co
+00003860: 6c5d 295b 7269 6768 745f 626f 756e 645f  l])[right_bound_
+00003870: 636f 6c5d 2e6d 6178 2829 2e75 6e73 7461  col].max().unsta
+00003880: 636b 2872 6967 6874 5f62 6f75 6e64 6172  ck(right_boundar
+00003890: 795f 636f 6c29 0d0a 2020 2020 2320 4372  y_col)..    # Cr
+000038a0: 6561 7465 206d 6973 7369 6e67 2063 6f6c  eate missing col
+000038b0: 756d 6e73 0d0a 2020 2020 666f 7220 6974  umns..    for it
+000038c0: 656d 2069 6e20 5b27 4f70 656e 272c 2743  em in ['Open','C
+000038d0: 6c6f 7365 6427 5d3a 0d0a 2020 2020 2020  losed']:..      
+000038e0: 2020 6966 2069 7465 6d20 6e6f 7420 696e    if item not in
+000038f0: 2072 6967 6874 2e63 6f6c 756d 6e73 3a0d   right.columns:.
+00003900: 0a20 2020 2020 2020 2020 2020 2072 6967  .            rig
+00003910: 6874 5b69 7465 6d5d 203d 206e 702e 6e61  ht[item] = np.na
+00003920: 6e0d 0a20 2020 2023 2055 7365 2074 6865  n..    # Use the
+00003930: 206d 6178 696d 756d 2063 6c6f 7365 6420   maximum closed 
+00003940: 626f 756e 6461 7279 2069 6620 7468 6572  boundary if ther
+00003950: 6520 6172 6520 6e6f 206f 7065 6e20 626f  e are no open bo
+00003960: 756e 6461 7269 6573 206f 720d 0a20 2020  undaries or..   
+00003970: 2023 2069 6620 7468 6520 636c 6f73 6564   # if the closed
+00003980: 2062 6f75 6e64 6172 7920 6973 206c 6172   boundary is lar
+00003990: 6765 7220 7468 616e 206f 7220 6571 7561  ger than or equa
+000039a0: 6c20 746f 2074 6865 206c 6172 6765 7374  l to the largest
+000039b0: 206f 7065 6e20 626f 756e 6461 7279 0d0a   open boundary..
+000039c0: 2020 2020 636f 6e64 6974 696f 6e20 3d20      condition = 
+000039d0: 2872 6967 6874 5b27 436c 6f73 6564 275d  (right['Closed']
+000039e0: 203e 3d20 7269 6768 745b 274f 7065 6e27   >= right['Open'
+000039f0: 5d29 207c 2028 7269 6768 745b 274f 7065  ]) | (right['Ope
+00003a00: 6e27 5d2e 6973 6e61 2829 290d 0a20 2020  n'].isna())..   
+00003a10: 2072 6967 6874 5b72 6967 6874 5f62 6f75   right[right_bou
+00003a20: 6e64 5f63 6f6c 5d20 3d20 6e70 2e77 6865  nd_col] = np.whe
+00003a30: 7265 2863 6f6e 6469 7469 6f6e 2c72 6967  re(condition,rig
+00003a40: 6874 5b27 436c 6f73 6564 275d 2c72 6967  ht['Closed'],rig
+00003a50: 6874 5b27 4f70 656e 275d 290d 0a20 2020  ht['Open'])..   
+00003a60: 2072 6967 6874 5b72 6967 6874 5f62 6f75   right[right_bou
+00003a70: 6e64 6172 795f 636f 6c5d 203d 206e 702e  ndary_col] = np.
+00003a80: 7768 6572 6528 636f 6e64 6974 696f 6e2c  where(condition,
+00003a90: 2743 6c6f 7365 6427 2c27 4f70 656e 2729  'Closed','Open')
+00003aa0: 0d0a 2020 2020 7269 6768 7420 3d20 7269  ..    right = ri
+00003ab0: 6768 745b 5b72 6967 6874 5f62 6f75 6e64  ght[[right_bound
+00003ac0: 5f63 6f6c 2c72 6967 6874 5f62 6f75 6e64  _col,right_bound
+00003ad0: 6172 795f 636f 6c5d 5d0d 0a20 2020 200d  ary_col]]..    .
+00003ae0: 0a20 2020 2023 204d 6572 6765 2074 6865  .    # Merge the
+00003af0: 2074 776f 2062 6f75 6e64 6172 6965 7320   two boundaries 
+00003b00: 746f 2063 7265 6174 6520 7468 6520 696e  to create the in
+00003b10: 7465 7276 616c 2066 6f72 2074 6865 206d  terval for the m
+00003b20: 6178 696d 756d 0d0a 2020 2020 2320 4368  aximum..    # Ch
+00003b30: 6563 6b20 7468 6174 2074 6865 206d 6572  eck that the mer
+00003b40: 6765 2069 7320 312d 746f 2d31 0d0a 2020  ge is 1-to-1..  
+00003b50: 2020 6466 203d 206c 6566 742e 6d65 7267    df = left.merg
+00003b60: 6528 7269 6768 742c 2068 6f77 203d 2027  e(right, how = '
+00003b70: 6f75 7465 7227 2c20 6f6e 203d 2067 726f  outer', on = gro
+00003b80: 7570 6279 5f63 6f6c 756d 6e73 2c20 7661  upby_columns, va
+00003b90: 6c69 6461 7465 203d 2027 313a 3127 290d  lidate = '1:1').
+00003ba0: 0a20 2020 200d 0a20 2020 2023 2052 6573  .    ..    # Res
+00003bb0: 6574 2069 6e64 6578 0d0a 2020 2020 6466  et index..    df
+00003bc0: 203d 2064 662e 7265 7365 745f 696e 6465   = df.reset_inde
+00003bd0: 7828 290d 0a20 2020 200d 0a20 2020 2072  x()..    ..    r
+00003be0: 6574 7572 6e20 6466 0d0a 0d0a 6465 6620  eturn df....def 
+00003bf0: 6d61 7869 6d75 6d28 6466 2c0d 0a20 2020  maximum(df,..   
+00003c00: 2020 2020 2020 2020 2072 6573 756c 745f           result_
+00003c10: 636f 6c2c 0d0a 2020 2020 2020 2020 2020  col,..          
+00003c20: 2020 6772 6f75 7062 795f 636f 6c75 6d6e    groupby_column
+00003c30: 7320 3d20 4e6f 6e65 2c0d 0a20 2020 2020  s = None,..     
+00003c40: 2020 2020 2020 2069 6e63 6c75 6465 5f6e         include_n
+00003c50: 6567 6174 6976 655f 696e 7465 7276 616c  egative_interval
+00003c60: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
+00003c70: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
+00003c80: 5f74 6f6c 6572 616e 6365 5f74 6f5f 6472  _tolerance_to_dr
+00003c90: 6f70 5f63 656e 736f 7220 3d20 302e 3235  op_censor = 0.25
+00003ca0: 2c0d 0a20 2020 2020 2020 2020 2020 2070  ,..            p
+00003cb0: 7265 6369 7369 6f6e 5f72 6f75 6e64 696e  recision_roundin
+00003cc0: 6720 3d20 5472 7565 293a 0d0a 2020 2020  g = True):..    
+00003cd0: 2727 270d 0a20 2020 2041 2066 756e 6374  '''..    A funct
+00003ce0: 696f 6e20 7468 6174 2063 6f6d 6269 6e65  ion that combine
+00003cf0: 7320 7468 6520 7265 6c65 7661 6e74 206d  s the relevant m
+00003d00: 6178 696d 756d 2061 6e64 2075 7469 6c69  aximum and utili
+00003d10: 7479 2066 756e 6374 696f 6e73 2074 6f0d  ty functions to.
+00003d20: 0a20 2020 2067 656e 6572 6174 6520 7468  .    generate th
+00003d30: 6520 6d61 7869 6d61 2072 6573 756c 7473  e maxima results
+00003d40: 2066 6f72 2067 726f 7570 7320 7769 7468   for groups with
+00003d50: 696e 2061 2044 6174 6146 7261 6d65 2e0d  in a DataFrame..
+00003d60: 0a0d 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
+00003d70: 730d 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  s..    ---------
+00003d80: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
+00003d90: 4672 616d 650d 0a20 2020 2020 2020 2044  Frame..        D
+00003da0: 6174 6146 7261 6d65 2074 6861 7420 636f  ataFrame that co
+00003db0: 6e74 6169 6e73 2063 656e 736f 7265 6420  ntains censored 
+00003dc0: 6f72 2075 6e63 656e 736f 7265 6420 7265  or uncensored re
+00003dd0: 7375 6c74 730d 0a20 2020 2072 6573 756c  sults..    resul
+00003de0: 745f 636f 6c20 3a20 7374 7269 6e67 0d0a  t_col : string..
+00003df0: 2020 2020 2020 2020 5468 6520 636f 6c75          The colu
+00003e00: 6d6e 206e 616d 6520 666f 7220 7468 6520  mn name for the 
+00003e10: 636f 6c75 6d6e 2074 6861 7420 636f 6e74  column that cont
+00003e20: 6169 6e20 7468 6520 7265 7375 6c74 7320  ain the results 
+00003e30: 6173 2074 6578 742e 0d0a 2020 2020 2020  as text...      
+00003e40: 2020 4f6e 6c79 2066 6f75 7220 706f 7373    Only four poss
+00003e50: 6962 6c65 2063 656e 736f 7273 2073 686f  ible censors sho
+00003e60: 756c 6420 6265 2075 7365 6420 283c 2ce2  uld be used (<,.
+00003e70: 89a4 2ce2 89a5 2c3e 292e 0d0a 2020 2020  ..,...,>)...    
+00003e80: 6772 6f75 7062 795f 636f 6c75 6d6e 7320  groupby_columns 
+00003e90: 3a20 6c69 7374 7320 6f66 2073 7472 696e  : lists of strin
+00003ea0: 6773 2028 6f72 206c 6973 7420 6f66 206c  gs (or list of l
+00003eb0: 6973 7473 292c 206f 7074 696f 6e61 6c0d  ists), optional.
+00003ec0: 0a20 2020 2020 2020 204c 6973 7420 6f66  .        List of
+00003ed0: 2063 6f6c 756d 6e20 6e61 6d65 7320 7468   column names th
+00003ee0: 6174 2073 686f 756c 6420 6265 2075 7365  at should be use
+00003ef0: 6420 746f 2063 7265 6174 6520 6772 6f75  d to create grou
+00003f00: 7073 2e20 4120 6d61 7869 6d75 6d0d 0a20  ps. A maximum.. 
+00003f10: 2020 2020 2020 2077 696c 6c20 6265 2066         will be f
+00003f20: 6f75 6e64 2077 6974 6869 6e20 6561 6368  ound within each
+00003f30: 2067 726f 7570 2e20 4d75 6c74 6970 6c65   group. Multiple
+00003f40: 206c 6973 7473 2063 616e 2062 6520 7375   lists can be su
+00003f50: 7070 6c69 6564 2074 6f0d 0a20 2020 2020  pplied to..     
+00003f60: 2020 2070 6572 666f 726d 2073 6571 7565     perform seque
+00003f70: 6e74 6961 6c20 6d61 7869 6d61 2062 6566  ntial maxima bef
+00003f80: 6f72 6520 636f 6e76 6572 7469 6e67 2069  ore converting i
+00003f90: 6e74 6572 7661 6c73 2074 6f20 6120 7265  ntervals to a re
+00003fa0: 7375 6c74 2e0d 0a20 2020 2020 2020 2054  sult...        T
+00003fb0: 6865 2064 6566 6175 6c74 2069 7320 4e6f  he default is No
+00003fc0: 6e65 2e0d 0a20 2020 2069 6e63 6c75 6465  ne...    include
+00003fd0: 5f6e 6567 6174 6976 655f 696e 7465 7276  _negative_interv
+00003fe0: 616c 203a 2062 6f6f 6c65 616e 2c20 6f70  al : boolean, op
+00003ff0: 7469 6f6e 616c 0d0a 2020 2020 2020 2020  tional..        
+00004000: 4966 2054 7275 652c 2074 6865 6e20 616c  If True, then al
+00004010: 6c20 706f 7369 7469 7665 2061 6e64 206e  l positive and n
+00004020: 6567 6174 6976 6520 7661 6c75 6573 2061  egative values a
+00004030: 7265 2063 6f6e 7369 6465 7265 640d 0a20  re considered.. 
+00004040: 2020 2020 2020 2065 2e67 2e2c 203c 302e         e.g., <0.
+00004050: 3520 776f 756c 6420 6265 2063 6f6e 7665  5 would be conve
+00004060: 7274 6564 2074 6f20 282d 6e70 2e69 6e66  rted to (-np.inf
+00004070: 2c35 292e 0d0a 2020 2020 2020 2020 4966  ,5)...        If
+00004080: 2046 616c 7365 2c20 7468 656e 206f 6e6c   False, then onl
+00004090: 7920 6e6f 6e2d 6e65 6761 7469 7665 2076  y non-negative v
+000040a0: 616c 7565 7320 6172 6520 636f 6e73 6964  alues are consid
+000040b0: 6572 6564 0d0a 2020 2020 2020 2020 652e  ered..        e.
+000040c0: 672e 2c20 3c30 2e35 2077 6f75 6c64 2062  g., <0.5 would b
+000040d0: 6520 636f 6e76 6572 7465 6420 746f 205b  e converted to [
+000040e0: 302c 3529 2e0d 0a20 2020 2020 2020 2054  0,5)...        T
+000040f0: 6869 7320 7365 7474 696e 6720 6f6e 6c79  his setting only
+00004100: 2061 6666 6563 7473 2072 6573 756c 7473   affects results
+00004110: 2069 6620 666f 6375 735f 6869 6768 5f70   if focus_high_p
+00004120: 6f74 656e 7469 616c 2069 7320 4661 6c73  otential is Fals
+00004130: 652e 0d0a 2020 2020 2020 2020 5468 6520  e...        The 
+00004140: 6465 6661 756c 7420 6973 2046 616c 7365  default is False
+00004150: 2e0d 0a20 2020 2070 7265 6369 7369 6f6e  ...    precision
+00004160: 5f74 6f6c 6572 616e 6365 5f74 6f5f 6472  _tolerance_to_dr
+00004170: 6f70 5f63 656e 736f 7220 3a20 666c 6f61  op_censor : floa
+00004180: 742c 206f 7074 696f 6e61 6c0d 0a20 2020  t, optional..   
+00004190: 2020 2020 2054 6872 6573 686f 6c64 2066       Threshold f
+000041a0: 6f72 2072 6570 6f72 7469 6e67 2063 656e  or reporting cen
+000041b0: 736f 7265 6420 7673 206e 6f6e 2d63 656e  sored vs non-cen
+000041c0: 736f 7265 6420 7265 7375 6c74 732e 0d0a  sored results...
+000041d0: 2020 2020 2020 2020 5573 696e 6720 7468          Using th
+000041e0: 6520 6465 6661 756c 742c 2061 2072 6573  e default, a res
+000041f0: 756c 7420 7468 6174 2069 7320 6b6e 6f77  ult that is know
+00004200: 6e20 746f 2062 6520 696e 2074 6865 2069  n to be in the i
+00004210: 6e74 6572 7661 6c20 2830 2e33 2c20 302e  nterval (0.3, 0.
+00004220: 3529 0d0a 2020 2020 2020 2020 776f 756c  5)..        woul
+00004230: 6420 6265 2072 6574 7572 6e65 6420 6173  d be returned as
+00004240: 2030 2e34 2c20 7768 6572 6561 7320 6120   0.4, whereas a 
+00004250: 746f 6c65 7261 6e63 6520 6f66 2030 2077  tolerance of 0 w
+00004260: 6f75 6c64 2079 6965 6c64 2061 0d0a 2020  ould yield a..  
+00004270: 2020 2020 2020 7265 7375 6c74 206f 6620        result of 
+00004280: 3c30 2e35 206f 7220 3e30 2e33 2064 6570  <0.5 or >0.3 dep
+00004290: 656e 6469 6e67 206f 6e20 7468 6520 7661  ending on the va
+000042a0: 6c75 6520 6f66 2066 6f63 7573 5f68 6967  lue of focus_hig
+000042b0: 6865 7374 5f70 6f74 656e 7469 616c 2e0d  hest_potential..
+000042c0: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
+000042d0: 6175 6c74 2069 7320 302e 3235 2e0d 0a20  ault is 0.25... 
+000042e0: 2020 2070 7265 6369 7369 6f6e 5f72 6f75     precision_rou
+000042f0: 6e64 696e 6720 3a20 626f 6f6c 6561 6e2c  nding : boolean,
+00004300: 206f 7074 696f 6e61 6c0d 0a20 2020 2020   optional..     
+00004310: 2020 2049 6620 5472 7565 2c20 6120 726f     If True, a ro
+00004320: 756e 6469 6e67 206d 6574 686f 6420 6973  unding method is
+00004330: 2061 7070 6c69 6564 2074 6f20 726f 756e   applied to roun
+00004340: 6420 7265 7375 6c74 7320 746f 2068 6176  d results to hav
+00004350: 6520 6e6f 206d 6f72 650d 0a20 2020 2020  e no more..     
+00004360: 2020 2064 6563 696d 616c 7320 7468 616e     decimals than
+00004370: 2077 6861 7420 6361 6e20 6265 206d 6561   what can be mea
+00004380: 7375 7265 642e 0d0a 2020 2020 2020 2020  sured...        
+00004390: 5468 6520 6465 6661 756c 7420 6973 2054  The default is T
+000043a0: 7275 652e 0d0a 0d0a 2020 2020 5265 7475  rue.....    Retu
+000043b0: 726e 730d 0a20 2020 202d 2d2d 2d2d 2d2d  rns..    -------
+000043c0: 0d0a 2020 2020 6466 203a 2044 6174 6146  ..    df : DataF
+000043d0: 7261 6d65 0d0a 2020 2020 2020 2020 4461  rame..        Da
+000043e0: 7461 4672 616d 6520 7468 6174 2063 6f6e  taFrame that con
+000043f0: 7461 696e 7320 6120 636f 6c75 6d6e 2077  tains a column w
+00004400: 6974 6820 7468 6520 7265 6c65 7661 6e74  ith the relevant
+00004410: 206d 6178 696d 756d 206f 7220 6d61 7869   maximum or maxi
+00004420: 6d61 0d0a 0d0a 2020 2020 2727 270d 0a20  ma....    '''.. 
+00004430: 2020 200d 0a20 2020 2023 2043 7265 6174     ..    # Creat
+00004440: 6520 6120 636f 7079 206f 6620 7468 6520  e a copy of the 
+00004450: 4461 7461 4672 616d 650d 0a20 2020 2064  DataFrame..    d
+00004460: 6620 3d20 6466 2e63 6f70 7928 290d 0a20  f = df.copy().. 
+00004470: 2020 200d 0a20 2020 2023 2053 706c 6974     ..    # Split
+00004480: 2074 6865 2072 6573 756c 7420 696e 746f   the result into
+00004490: 2063 656e 736f 7220 616e 6420 6e75 6d65   censor and nume
+000044a0: 7269 6320 636f 6d70 6f6e 656e 7473 0d0a  ric components..
+000044b0: 2020 2020 6466 203d 2072 6573 756c 745f      df = result_
+000044c0: 746f 5f63 6f6d 706f 6e65 6e74 7328 6466  to_components(df
+000044d0: 2c72 6573 756c 745f 636f 6c29 0d0a 2020  ,result_col)..  
+000044e0: 2020 0d0a 2020 2020 2320 436f 6e76 6572    ..    # Conver
+000044f0: 7420 7468 6520 7265 7375 6c74 7320 6672  t the results fr
+00004500: 6f6d 2063 656e 736f 7220 616e 6420 6e75  om censor and nu
+00004510: 6d65 7269 6320 636f 6d70 6f6e 656e 7473  meric components
+00004520: 2074 6f20 616e 2069 6e74 6572 7661 6c20   to an interval 
+00004530: 7265 7072 6573 656e 7461 7469 6f6e 0d0a  representation..
+00004540: 2020 2020 6466 203d 2063 6f6d 706f 6e65      df = compone
+00004550: 6e74 735f 746f 5f69 6e74 6572 7661 6c28  nts_to_interval(
+00004560: 6466 2c20 696e 636c 7564 655f 6e65 6761  df, include_nega
+00004570: 7469 7665 5f69 6e74 6572 7661 6c29 0d0a  tive_interval)..
+00004580: 2020 2020 0d0a 2020 2020 2320 5573 696e      ..    # Usin
+00004590: 6720 7468 6520 696e 7465 7276 616c 732c  g the intervals,
+000045a0: 2064 6574 6572 6d69 6e65 2074 6865 2072   determine the r
+000045b0: 616e 6765 206f 6620 706f 7373 6962 6c65  ange of possible
+000045c0: 206d 6178 696d 610d 0a20 2020 200d 0a20   maxima..    .. 
+000045d0: 2020 2023 2049 6620 7468 6572 6520 6172     # If there ar
+000045e0: 6520 6e6f 2067 726f 7570 6279 2d63 6f6c  e no groupby-col
+000045f0: 756d 6e73 2c20 7468 656e 2074 616b 6520  umns, then take 
+00004600: 6d61 7820 6f66 2061 6c6c 2072 6573 756c  max of all resul
+00004610: 7473 0d0a 2020 2020 6966 206e 6f74 2067  ts..    if not g
+00004620: 726f 7570 6279 5f63 6f6c 756d 6e73 3a0d  roupby_columns:.
+00004630: 0a20 2020 2020 2020 2064 6620 3d20 6d61  .        df = ma
+00004640: 7869 6d75 6d5f 696e 7465 7276 616c 2864  ximum_interval(d
+00004650: 662c 2067 726f 7570 6279 5f63 6f6c 756d  f, groupby_colum
+00004660: 6e73 3d5b 5d29 0d0a 2020 2020 2320 4966  ns=[])..    # If
+00004670: 2074 6865 2067 726f 7570 6279 5f63 6f6c   the groupby_col
+00004680: 756d 6e73 2069 7320 6120 6c69 7374 206f  umns is a list o
+00004690: 6620 6c69 7374 732c 2074 6865 6e20 7065  f lists, then pe
+000046a0: 7266 6f72 6d20 6d75 6c74 6970 6c65 206d  rform multiple m
+000046b0: 6178 696d 756d 730d 0a20 2020 2065 6c69  aximums..    eli
+000046c0: 6620 6973 696e 7374 616e 6365 2867 726f  f isinstance(gro
+000046d0: 7570 6279 5f63 6f6c 756d 6e73 5b30 5d2c  upby_columns[0],
+000046e0: 6c69 7374 293a 0d0a 2020 2020 2020 2020  list):..        
+000046f0: 666f 7220 6772 6f75 7069 6e67 2069 6e20  for grouping in 
+00004700: 6772 6f75 7062 795f 636f 6c75 6d6e 733a  groupby_columns:
+00004710: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00004720: 5573 696e 6720 7468 6520 696e 7465 7276  Using the interv
+00004730: 616c 732c 2064 6574 6572 6d69 6e65 2074  als, determine t
+00004740: 6865 2072 616e 6765 206f 6620 706f 7373  he range of poss
+00004750: 6962 6c65 206d 6178 696d 610d 0a20 2020  ible maxima..   
+00004760: 2020 2020 2020 2020 2064 6620 3d20 6d61           df = ma
+00004770: 7869 6d75 6d5f 696e 7465 7276 616c 2864  ximum_interval(d
+00004780: 662c 2067 726f 7570 696e 6729 0d0a 2020  f, grouping)..  
+00004790: 2020 2320 456c 7365 2074 6865 2067 726f    # Else the gro
+000047a0: 7570 6279 5f63 6f6c 756d 6e73 2069 7320  upby_columns is 
+000047b0: 6120 6c69 7374 206f 6620 636f 6c75 6d6e  a list of column
+000047c0: 206e 616d 6573 0d0a 2020 2020 656c 7365   names..    else
+000047d0: 3a0d 0a20 2020 2020 2020 2064 6620 3d20  :..        df = 
+000047e0: 6d61 7869 6d75 6d5f 696e 7465 7276 616c  maximum_interval
+000047f0: 2864 662c 2067 726f 7570 6279 5f63 6f6c  (df, groupby_col
+00004800: 756d 6e73 290d 0a20 2020 200d 0a20 2020  umns)..    ..   
+00004810: 2023 2043 6f6e 7665 7274 2074 6865 2069   # Convert the i
+00004820: 6e74 6572 7661 6c20 666f 7220 7468 6520  nterval for the 
+00004830: 6d61 7869 6d75 6d20 696e 746f 2063 656e  maximum into cen
+00004840: 736f 7220 616e 6420 6e75 6d65 7269 6320  sor and numeric 
+00004850: 6e6f 7461 7469 6f6e 0d0a 2020 2020 6466  notation..    df
+00004860: 203d 2069 6e74 6572 7661 6c5f 746f 5f63   = interval_to_c
+00004870: 6f6d 706f 6e65 6e74 7328 6466 2c0d 0a20  omponents(df,.. 
+00004880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004890: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000048a0: 6f63 7573 5f68 6967 685f 706f 7465 6e74  ocus_high_potent
+000048b0: 6961 6c20 3d20 5472 7565 2c0d 0a20 2020  ial = True,..   
+000048c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048d0: 2020 2020 2020 2020 2020 2020 2069 6e63               inc
+000048e0: 6c75 6465 5f6e 6567 6174 6976 655f 696e  lude_negative_in
+000048f0: 7465 7276 616c 203d 2069 6e63 6c75 6465  terval = include
+00004900: 5f6e 6567 6174 6976 655f 696e 7465 7276  _negative_interv
+00004910: 616c 2c0d 0a20 2020 2020 2020 2020 2020  al,..           
 00004920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004930: 2020 2020 2020 696e 636c 7564 655f 6e65        include_ne
-00004940: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
-00004950: 3d20 696e 636c 7564 655f 6e65 6761 7469  = include_negati
-00004960: 7665 5f69 6e74 6572 7661 6c2c 0d0a 2020  ve_interval,..  
-00004970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004980: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00004990: 6563 6973 696f 6e5f 746f 6c65 7261 6e63  ecision_toleranc
-000049a0: 655f 746f 5f64 726f 705f 6365 6e73 6f72  e_to_drop_censor
-000049b0: 203d 2070 7265 6369 7369 6f6e 5f74 6f6c   = precision_tol
-000049c0: 6572 616e 6365 5f74 6f5f 6472 6f70 5f63  erance_to_drop_c
-000049d0: 656e 736f 7229 0d0a 2020 2020 0d0a 2020  ensor)..    ..  
-000049e0: 2020 2320 4372 6561 7465 2069 6e74 6572    # Create inter
-000049f0: 7661 6c20 6e6f 7461 7469 6f6e 2066 6f72  val notation for
-00004a00: 2074 6865 206d 6178 696d 756d 0d0a 2020   the maximum..  
-00004a10: 2020 6466 203d 2069 6e74 6572 7661 6c5f    df = interval_
-00004a20: 6e6f 7461 7469 6f6e 2864 662c 2070 7265  notation(df, pre
-00004a30: 6369 7369 6f6e 5f72 6f75 6e64 696e 6729  cision_rounding)
-00004a40: 0d0a 2020 2020 0d0a 2020 2020 2320 436f  ..    ..    # Co
-00004a50: 6d62 696e 6520 7468 6520 6365 6e73 6f72  mbine the censor
-00004a60: 2061 6e64 206e 756d 6572 6963 2063 6f6d   and numeric com
-00004a70: 706f 6e65 6e74 7320 696e 746f 2061 2072  ponents into a r
-00004a80: 6573 756c 740d 0a20 2020 2064 6620 3d20  esult..    df = 
-00004a90: 636f 6d70 6f6e 656e 7473 5f74 6f5f 7265  components_to_re
-00004aa0: 7375 6c74 2864 662c 2070 7265 6369 7369  sult(df, precisi
-00004ab0: 6f6e 5f72 6f75 6e64 696e 6729 0d0a 2020  on_rounding)..  
-00004ac0: 2020 0d0a 2020 2020 2320 4472 6f70 2077    ..    # Drop w
-00004ad0: 6f72 6b69 6e67 2063 6f6c 756d 6e73 0d0a  orking columns..
-00004ae0: 2020 2020 6466 203d 2064 662e 6472 6f70      df = df.drop
-00004af0: 2864 662e 6669 6c74 6572 2872 6567 6578  (df.filter(regex
-00004b00: 3d27 5f5f 2729 2e63 6f6c 756d 6e73 2c20  ='__').columns, 
-00004b10: 6178 6973 3d31 290d 0a20 2020 200d 0a20  axis=1)..    .. 
-00004b20: 2020 2023 2052 656f 7264 6572 2063 6f6c     # Reorder col
-00004b30: 756d 6e73 0d0a 2020 2020 666f 7220 636f  umns..    for co
-00004b40: 6c20 696e 205b 7374 6174 5f63 6f6c 2c72  l in [stat_col,r
-00004b50: 6573 756c 745f 636f 6c2c 6365 6e73 6f72  esult_col,censor
-00004b60: 5f63 6f6c 2c6e 756d 6572 6963 5f63 6f6c  _col,numeric_col
-00004b70: 2c69 6e74 6572 7661 6c5f 636f 6c5d 3a0d  ,interval_col]:.
-00004b80: 0a20 2020 2020 2020 2064 665b 636f 6c5d  .        df[col]
-00004b90: 203d 2064 662e 706f 7028 636f 6c29 0d0a   = df.pop(col)..
-00004ba0: 2020 2020 0d0a 2020 2020 7265 7475 726e      ..    return
-00004bb0: 2064 660d 0a0d 0a23 2525 204d 696e 696d   df....#%% Minim
-00004bc0: 756d 2052 6573 756c 740d 0a0d 0a64 6566  um Result....def
-00004bd0: 206d 696e 696d 756d 5f69 6e74 6572 7661   minimum_interva
-00004be0: 6c28 6466 2c0d 0a20 2020 2020 2020 2020  l(df,..         
-00004bf0: 2020 2020 2020 2020 2020 2020 6772 6f75              grou
-00004c00: 7062 795f 636f 6c75 6d6e 7329 3a0d 0a20  pby_columns):.. 
-00004c10: 2020 2027 2727 0d0a 2020 2020 4120 6675     '''..    A fu
-00004c20: 6e63 7469 6f6e 2074 6861 7420 616e 616c  nction that anal
-00004c30: 7973 6573 2074 6865 2069 6e74 6572 7661  yses the interva
-00004c40: 6c20 6e6f 7461 7469 6f6e 2066 6f72 6d20  l notation form 
-00004c50: 6f66 2072 6573 756c 7473 2072 6574 7572  of results retur
-00004c60: 6e65 640d 0a20 2020 2066 726f 6d20 636f  ned..    from co
-00004c70: 6d70 6f6e 656e 7473 5f74 6f5f 696e 7465  mponents_to_inte
-00004c80: 7276 616c 2074 6f20 6765 6e65 7261 7465  rval to generate
-00004c90: 2061 206e 6577 2069 6e74 6572 7661 6c20   a new interval 
-00004ca0: 666f 7220 7468 6520 6d69 6e69 6d75 6d2e  for the minimum.
-00004cb0: 2047 726f 7570 730d 0a20 2020 206f 6620   Groups..    of 
-00004cc0: 7265 7375 6c74 7320 6361 6e20 6265 2064  results can be d
-00004cd0: 6566 696e 6564 2062 7920 696e 636c 7564  efined by includ
-00004ce0: 696e 6720 7468 6520 636f 6c75 6d6e 7320  ing the columns 
-00004cf0: 7468 6174 2073 686f 756c 6420 6265 2075  that should be u
-00004d00: 7365 6420 746f 0d0a 2020 2020 6372 6561  sed to..    crea
-00004d10: 7465 2067 726f 7570 732e 0d0a 0d0a 2020  te groups.....  
-00004d20: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
-00004d30: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
-00004d40: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
-00004d50: 0d0a 2020 2020 2020 2020 4461 7461 4672  ..        DataFr
-00004d60: 616d 6520 7468 6174 2063 6f6e 7461 696e  ame that contain
-00004d70: 7320 7265 7375 6c74 7320 696e 2061 2073  s results in a s
-00004d80: 7065 6369 6669 6320 696e 7465 7276 616c  pecific interval
-00004d90: 206e 6f74 6174 696f 6e2e 0d0a 2020 2020   notation...    
-00004da0: 6772 6f75 7062 795f 636f 6c75 6d6e 7320  groupby_columns 
-00004db0: 3a20 6c69 7374 206f 6620 7374 7269 6e67  : list of string
-00004dc0: 730d 0a20 2020 2020 2020 204c 6973 7420  s..        List 
-00004dd0: 6f66 2063 6f6c 756d 6e20 6e61 6d65 7320  of column names 
-00004de0: 7468 6174 2073 686f 756c 6420 6265 2075  that should be u
-00004df0: 7365 6420 746f 2063 7265 6174 6520 6772  sed to create gr
-00004e00: 6f75 7073 2e0d 0a0d 0a20 2020 2052 6574  oups.....    Ret
-00004e10: 7572 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d  urns..    ------
-00004e20: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
-00004e30: 4672 616d 650d 0a20 2020 2020 2020 2044  Frame..        D
-00004e40: 6174 6146 7261 6d65 2074 6861 7420 6861  ataFrame that ha
-00004e50: 7320 7468 6520 696e 7465 7276 616c 2066  s the interval f
-00004e60: 6f72 2074 6865 206d 696e 696d 756d 2028  or the minimum (
-00004e70: 666f 7220 6561 6368 2067 726f 7570 2069  for each group i
-00004e80: 660d 0a20 2020 2020 2020 2063 6f6c 756d  f..        colum
-00004e90: 6e20 6e61 6d65 7320 6172 6520 7072 6f76  n names are prov
-00004ea0: 6964 6564 2066 6f72 2067 726f 7570 696e  ided for groupin
-00004eb0: 6729 0d0a 0d0a 2020 2020 2727 270d 0a20  g)....    '''.. 
-00004ec0: 2020 200d 0a20 2020 2023 2043 7265 6174     ..    # Creat
-00004ed0: 6520 6120 636f 7079 206f 6620 7468 6520  e a copy of the 
-00004ee0: 4461 7461 4672 616d 650d 0a20 2020 2064  DataFrame..    d
-00004ef0: 6620 3d20 6466 2e63 6f70 7928 292e 7265  f = df.copy().re
-00004f00: 7365 745f 696e 6465 7828 290d 0a20 2020  set_index()..   
-00004f10: 200d 0a20 2020 2023 2043 7265 6174 6520   ..    # Create 
-00004f20: 636f 6c75 6d6e 2074 6861 7420 696e 6469  column that indi
-00004f30: 6361 7465 7320 7468 6520 6765 6e65 7261  cates the genera
-00004f40: 7465 6420 7374 6174 6973 7469 6320 616e  ted statistic an
-00004f50: 6420 6170 7065 6e64 2074 6f20 6772 6f75  d append to grou
-00004f60: 7069 6e67 206c 6973 740d 0a20 2020 2064  ping list..    d
-00004f70: 665b 7374 6174 5f63 6f6c 5d20 3d20 274d  f[stat_col] = 'M
-00004f80: 696e 696d 756d 270d 0a20 2020 2067 726f  inimum'..    gro
-00004f90: 7570 6279 5f63 6f6c 756d 6e73 2e61 7070  upby_columns.app
-00004fa0: 656e 6428 7374 6174 5f63 6f6c 290d 0a20  end(stat_col).. 
-00004fb0: 2020 200d 0a20 2020 2023 2044 6574 6572     ..    # Deter
-00004fc0: 6d69 6e65 206c 6566 7420 626f 756e 6420  mine left bound 
-00004fd0: 616e 6420 626f 756e 6461 7279 2066 6f72  and boundary for
-00004fe0: 206d 696e 696d 756d 2066 6f72 2065 6163   minimum for eac
-00004ff0: 6820 6772 6f75 702e 0d0a 2020 2020 0d0a  h group...    ..
-00005000: 2020 2020 2320 436f 6e73 6964 6572 2074      # Consider t
-00005010: 6865 206d 696e 696d 756d 2062 6f75 6e64  he minimum bound
-00005020: 2066 6f72 2065 6163 6820 6c65 6674 2062   for each left b
-00005030: 6f75 6e64 6172 7920 6f70 7469 6f6e 2074  oundary option t
-00005040: 6f20 6465 7465 726d 696e 650d 0a20 2020  o determine..   
-00005050: 2023 2077 6865 7468 6572 2074 6865 2062   # whether the b
-00005060: 6f75 6e64 2073 686f 756c 6420 6265 206f  ound should be o
-00005070: 7065 6e20 6f72 2063 6c6f 7365 642e 0d0a  pen or closed...
-00005080: 2020 2020 6c65 6674 203d 2064 662e 6772      left = df.gr
-00005090: 6f75 7062 7928 6772 6f75 7062 795f 636f  oupby(groupby_co
-000050a0: 6c75 6d6e 732b 5b6c 6566 745f 626f 756e  lumns+[left_boun
-000050b0: 6461 7279 5f63 6f6c 5d29 5b6c 6566 745f  dary_col])[left_
-000050c0: 626f 756e 645f 636f 6c5d 2e6d 696e 2829  bound_col].min()
-000050d0: 2e75 6e73 7461 636b 286c 6566 745f 626f  .unstack(left_bo
-000050e0: 756e 6461 7279 5f63 6f6c 290d 0a20 2020  undary_col)..   
-000050f0: 2023 2043 7265 6174 6520 6d69 7373 696e   # Create missin
-00005100: 6720 636f 6c75 6d6e 730d 0a20 2020 2066  g columns..    f
-00005110: 6f72 2069 7465 6d20 696e 205b 274f 7065  or item in ['Ope
-00005120: 6e27 2c27 436c 6f73 6564 275d 3a0d 0a20  n','Closed']:.. 
-00005130: 2020 2020 2020 2069 6620 6974 656d 206e         if item n
-00005140: 6f74 2069 6e20 6c65 6674 2e63 6f6c 756d  ot in left.colum
-00005150: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
-00005160: 206c 6566 745b 6974 656d 5d20 3d20 6e70   left[item] = np
-00005170: 2e6e 616e 0d0a 2020 2020 2320 5573 6520  .nan..    # Use 
-00005180: 7468 6520 6d69 6e69 6d75 6d20 636c 6f73  the minimum clos
-00005190: 6564 2062 6f75 6e64 6172 7920 6966 2074  ed boundary if t
-000051a0: 6865 7265 2061 7265 206e 6f20 6f70 656e  here are no open
-000051b0: 2062 6f75 6e64 6172 6965 7320 6f72 0d0a   boundaries or..
-000051c0: 2020 2020 2320 6966 2074 6865 2063 6c6f      # if the clo
-000051d0: 7365 6420 626f 756e 6461 7279 2069 7320  sed boundary is 
-000051e0: 6c65 7373 2074 6861 6e20 6f72 2065 7175  less than or equ
-000051f0: 616c 2074 6f20 7468 6520 6c65 6173 7420  al to the least 
-00005200: 6f70 656e 2062 6f75 6e64 6172 790d 0a20  open boundary.. 
-00005210: 2020 2063 6f6e 6469 7469 6f6e 203d 2028     condition = (
-00005220: 6c65 6674 5b27 436c 6f73 6564 275d 203c  left['Closed'] <
-00005230: 3d20 6c65 6674 5b27 4f70 656e 275d 2920  = left['Open']) 
-00005240: 7c20 286c 6566 745b 274f 7065 6e27 5d2e  | (left['Open'].
-00005250: 6973 6e61 2829 290d 0a20 2020 206c 6566  isna())..    lef
-00005260: 745b 6c65 6674 5f62 6f75 6e64 6172 795f  t[left_boundary_
-00005270: 636f 6c5d 203d 206e 702e 7768 6572 6528  col] = np.where(
-00005280: 636f 6e64 6974 696f 6e2c 2743 6c6f 7365  condition,'Close
-00005290: 6427 2c27 4f70 656e 2729 0d0a 2020 2020  d','Open')..    
-000052a0: 6c65 6674 5b6c 6566 745f 626f 756e 645f  left[left_bound_
-000052b0: 636f 6c5d 203d 206e 702e 7768 6572 6528  col] = np.where(
-000052c0: 636f 6e64 6974 696f 6e2c 6c65 6674 5b27  condition,left['
-000052d0: 436c 6f73 6564 275d 2c6c 6566 745b 274f  Closed'],left['O
-000052e0: 7065 6e27 5d29 0d0a 2020 2020 6c65 6674  pen'])..    left
-000052f0: 203d 206c 6566 745b 5b6c 6566 745f 626f   = left[[left_bo
-00005300: 756e 6461 7279 5f63 6f6c 2c6c 6566 745f  undary_col,left_
-00005310: 626f 756e 645f 636f 6c5d 5d0d 0a20 2020  bound_col]]..   
-00005320: 200d 0a20 2020 2023 2044 6574 6572 6d69   ..    # Determi
-00005330: 6e65 2072 6967 6874 2062 6f75 6e64 2061  ne right bound a
-00005340: 6e64 2062 6f75 6e64 6172 7920 666f 7220  nd boundary for 
-00005350: 6d69 6e69 6d75 6d20 666f 7220 6561 6368  minimum for each
-00005360: 2067 726f 7570 2e0d 0a20 2020 200d 0a20   group...    .. 
-00005370: 2020 2023 2043 6f6e 7369 6465 7220 7468     # Consider th
-00005380: 6520 6d69 6e69 6d75 6d20 626f 756e 6420  e minimum bound 
-00005390: 666f 7220 6561 6368 2072 6967 6874 2062  for each right b
-000053a0: 6f75 6e64 6172 7920 6f70 7469 6f6e 2074  oundary option t
-000053b0: 6f20 6465 7465 726d 696e 650d 0a20 2020  o determine..   
-000053c0: 2023 2077 6865 7468 6572 2074 6865 2062   # whether the b
-000053d0: 6f75 6e64 2073 686f 756c 6420 6265 206f  ound should be o
-000053e0: 7065 6e20 6f72 2063 6c6f 7365 642e 0d0a  pen or closed...
-000053f0: 2020 2020 7269 6768 7420 3d20 6466 2e67      right = df.g
-00005400: 726f 7570 6279 2867 726f 7570 6279 5f63  roupby(groupby_c
-00005410: 6f6c 756d 6e73 2b5b 7269 6768 745f 626f  olumns+[right_bo
-00005420: 756e 6461 7279 5f63 6f6c 5d29 5b72 6967  undary_col])[rig
-00005430: 6874 5f62 6f75 6e64 5f63 6f6c 5d2e 6d69  ht_bound_col].mi
-00005440: 6e28 292e 756e 7374 6163 6b28 7269 6768  n().unstack(righ
-00005450: 745f 626f 756e 6461 7279 5f63 6f6c 290d  t_boundary_col).
-00005460: 0a20 2020 2023 2043 7265 6174 6520 6d69  .    # Create mi
-00005470: 7373 696e 6720 636f 6c75 6d6e 730d 0a20  ssing columns.. 
-00005480: 2020 2066 6f72 2069 7465 6d20 696e 205b     for item in [
-00005490: 274f 7065 6e27 2c27 436c 6f73 6564 275d  'Open','Closed']
-000054a0: 3a0d 0a20 2020 2020 2020 2069 6620 6974  :..        if it
-000054b0: 656d 206e 6f74 2069 6e20 7269 6768 742e  em not in right.
-000054c0: 636f 6c75 6d6e 733a 0d0a 2020 2020 2020  columns:..      
-000054d0: 2020 2020 2020 7269 6768 745b 6974 656d        right[item
-000054e0: 5d20 3d20 6e70 2e6e 616e 0d0a 2020 2020  ] = np.nan..    
-000054f0: 2320 5573 6520 7468 6520 6d69 6e69 6d75  # Use the minimu
-00005500: 6d20 636c 6f73 6564 2062 6f75 6e64 6172  m closed boundar
-00005510: 7920 6966 2074 6865 7265 2061 7265 206e  y if there are n
-00005520: 6f20 6f70 656e 2062 6f75 6e64 6172 6965  o open boundarie
-00005530: 7320 6f72 0d0a 2020 2020 2320 6966 2074  s or..    # if t
-00005540: 6865 2063 6c6f 7365 6420 626f 756e 6461  he closed bounda
-00005550: 7279 2069 7320 6c65 7373 2074 6861 6e20  ry is less than 
-00005560: 7468 6520 6c65 6173 7420 6f70 656e 2062  the least open b
-00005570: 6f75 6e64 6172 790d 0a20 2020 2063 6f6e  oundary..    con
-00005580: 6469 7469 6f6e 203d 2028 7269 6768 745b  dition = (right[
-00005590: 2743 6c6f 7365 6427 5d20 3c20 7269 6768  'Closed'] < righ
-000055a0: 745b 274f 7065 6e27 5d29 207c 2028 7269  t['Open']) | (ri
-000055b0: 6768 745b 274f 7065 6e27 5d2e 6973 6e61  ght['Open'].isna
-000055c0: 2829 290d 0a20 2020 2072 6967 6874 5b72  ())..    right[r
-000055d0: 6967 6874 5f62 6f75 6e64 5f63 6f6c 5d20  ight_bound_col] 
-000055e0: 3d20 6e70 2e77 6865 7265 2863 6f6e 6469  = np.where(condi
-000055f0: 7469 6f6e 2c72 6967 6874 5b27 436c 6f73  tion,right['Clos
-00005600: 6564 275d 2c72 6967 6874 5b27 4f70 656e  ed'],right['Open
-00005610: 275d 290d 0a20 2020 2072 6967 6874 5b72  '])..    right[r
-00005620: 6967 6874 5f62 6f75 6e64 6172 795f 636f  ight_boundary_co
-00005630: 6c5d 203d 206e 702e 7768 6572 6528 636f  l] = np.where(co
-00005640: 6e64 6974 696f 6e2c 2743 6c6f 7365 6427  ndition,'Closed'
-00005650: 2c27 4f70 656e 2729 0d0a 2020 2020 7269  ,'Open')..    ri
-00005660: 6768 7420 3d20 7269 6768 745b 5b72 6967  ght = right[[rig
-00005670: 6874 5f62 6f75 6e64 5f63 6f6c 2c72 6967  ht_bound_col,rig
-00005680: 6874 5f62 6f75 6e64 6172 795f 636f 6c5d  ht_boundary_col]
-00005690: 5d0d 0a20 2020 200d 0a20 2020 2023 204d  ]..    ..    # M
-000056a0: 6572 6765 2074 6865 2074 776f 2062 6f75  erge the two bou
-000056b0: 6e64 6172 6965 7320 746f 2063 7265 6174  ndaries to creat
-000056c0: 6520 7468 6520 696e 7465 7276 616c 2066  e the interval f
-000056d0: 6f72 2074 6865 206d 696e 696d 756d 0d0a  or the minimum..
-000056e0: 2020 2020 2320 4368 6563 6b20 7468 6174      # Check that
-000056f0: 2074 6865 206d 6572 6765 2069 7320 312d   the merge is 1-
-00005700: 746f 2d31 0d0a 2020 2020 6466 203d 206c  to-1..    df = l
-00005710: 6566 742e 6d65 7267 6528 7269 6768 742c  eft.merge(right,
-00005720: 2068 6f77 203d 2027 6f75 7465 7227 2c20   how = 'outer', 
-00005730: 6f6e 203d 2067 726f 7570 6279 5f63 6f6c  on = groupby_col
-00005740: 756d 6e73 2c20 7661 6c69 6461 7465 203d  umns, validate =
-00005750: 2027 313a 3127 290d 0a20 2020 200d 0a20   '1:1')..    .. 
-00005760: 2020 2023 2052 6573 6574 2069 6e64 6578     # Reset index
-00005770: 0d0a 2020 2020 6466 203d 2064 662e 7265  ..    df = df.re
-00005780: 7365 745f 696e 6465 7828 290d 0a20 2020  set_index()..   
-00005790: 200d 0a20 2020 2072 6574 7572 6e20 6466   ..    return df
-000057a0: 0d0a 0d0a 6465 6620 6d69 6e69 6d75 6d28  ....def minimum(
-000057b0: 6466 2c0d 0a20 2020 2020 2020 2020 2020  df,..           
-000057c0: 2072 6573 756c 745f 636f 6c2c 0d0a 2020   result_col,..  
-000057d0: 2020 2020 2020 2020 2020 6772 6f75 7062            groupb
-000057e0: 795f 636f 6c75 6d6e 7320 3d20 4e6f 6e65  y_columns = None
-000057f0: 2c0d 0a20 2020 2020 2020 2020 2020 2069  ,..            i
-00005800: 6e63 6c75 6465 5f6e 6567 6174 6976 655f  nclude_negative_
-00005810: 696e 7465 7276 616c 203d 2046 616c 7365  interval = False
-00005820: 2c0d 0a20 2020 2020 2020 2020 2020 2070  ,..            p
-00005830: 7265 6369 7369 6f6e 5f74 6f6c 6572 616e  recision_toleran
-00005840: 6365 5f74 6f5f 6472 6f70 5f63 656e 736f  ce_to_drop_censo
-00005850: 7220 3d20 302e 3235 2c0d 0a20 2020 2020  r = 0.25,..     
-00005860: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
-00005870: 5f72 6f75 6e64 696e 6720 3d20 5472 7565  _rounding = True
-00005880: 293a 0d0a 2020 2020 2727 270d 0a20 2020  ):..    '''..   
-00005890: 2041 2066 756e 6374 696f 6e20 7468 6174   A function that
-000058a0: 2063 6f6d 6269 6e65 7320 7468 6520 7265   combines the re
-000058b0: 6c65 7661 6e74 206d 696e 696d 756d 2061  levant minimum a
-000058c0: 6e64 2075 7469 6c69 7479 2066 756e 6374  nd utility funct
-000058d0: 696f 6e73 2074 6f0d 0a20 2020 2067 656e  ions to..    gen
-000058e0: 6572 6174 6520 7468 6520 6d69 6e69 6d61  erate the minima
-000058f0: 2072 6573 756c 7473 2066 6f72 2067 726f   results for gro
-00005900: 7570 7320 7769 7468 696e 2061 2044 6174  ups within a Dat
-00005910: 6146 7261 6d65 2e0d 0a0d 0a20 2020 2050  aFrame.....    P
-00005920: 6172 616d 6574 6572 730d 0a20 2020 202d  arameters..    -
-00005930: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
-00005940: 6620 3a20 4461 7461 4672 616d 650d 0a20  f : DataFrame.. 
-00005950: 2020 2020 2020 2044 6174 6146 7261 6d65         DataFrame
-00005960: 2074 6861 7420 636f 6e74 6169 6e73 2063   that contains c
-00005970: 656e 736f 7265 6420 6f72 2075 6e63 656e  ensored or uncen
-00005980: 736f 7265 6420 7265 7375 6c74 730d 0a20  sored results.. 
-00005990: 2020 2072 6573 756c 745f 636f 6c20 3a20     result_col : 
-000059a0: 7374 7269 6e67 0d0a 2020 2020 2020 2020  string..        
-000059b0: 5468 6520 636f 6c75 6d6e 206e 616d 6520  The column name 
-000059c0: 666f 7220 7468 6520 636f 6c75 6d6e 2074  for the column t
-000059d0: 6861 7420 636f 6e74 6169 6e20 7468 6520  hat contain the 
-000059e0: 7265 7375 6c74 7320 6173 2074 6578 742e  results as text.
-000059f0: 0d0a 2020 2020 2020 2020 4f6e 6c79 2066  ..        Only f
-00005a00: 6f75 7220 706f 7373 6962 6c65 2063 656e  our possible cen
-00005a10: 736f 7273 2073 686f 756c 6420 6265 2075  sors should be u
-00005a20: 7365 6420 283c 2ce2 89a4 2ce2 89a5 2c3e  sed (<,...,...,>
-00005a30: 292e 0d0a 2020 2020 6772 6f75 7062 795f  )...    groupby_
-00005a40: 636f 6c75 6d6e 7320 3a20 6c69 7374 7320  columns : lists 
-00005a50: 6f66 2073 7472 696e 6773 2028 6f72 206c  of strings (or l
-00005a60: 6973 7420 6f66 206c 6973 7473 292c 206f  ist of lists), o
-00005a70: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
-00005a80: 204c 6973 7420 6f66 2063 6f6c 756d 6e20   List of column 
-00005a90: 6e61 6d65 7320 7468 6174 2073 686f 756c  names that shoul
-00005aa0: 6420 6265 2075 7365 6420 746f 2063 7265  d be used to cre
-00005ab0: 6174 6520 6772 6f75 7073 2e20 4120 6d69  ate groups. A mi
-00005ac0: 6e69 6d75 6d0d 0a20 2020 2020 2020 2077  nimum..        w
-00005ad0: 696c 6c20 6265 2066 6f75 6e64 2077 6974  ill be found wit
-00005ae0: 6869 6e20 6561 6368 2067 726f 7570 2e20  hin each group. 
-00005af0: 4d75 6c74 6970 6c65 206c 6973 7473 2063  Multiple lists c
-00005b00: 616e 2062 6520 7375 7070 6c69 6564 2074  an be supplied t
-00005b10: 6f0d 0a20 2020 2020 2020 2070 6572 666f  o..        perfo
-00005b20: 726d 2073 6571 7565 6e74 6961 6c20 6d69  rm sequential mi
-00005b30: 6e69 6d61 2062 6566 6f72 6520 636f 6e76  nima before conv
-00005b40: 6572 7469 6e67 2069 6e74 6572 7661 6c73  erting intervals
-00005b50: 2074 6f20 6120 7265 7375 6c74 2e0d 0a20   to a result... 
-00005b60: 2020 2020 2020 2054 6865 2064 6566 6175         The defau
-00005b70: 6c74 2069 7320 4e6f 6e65 2e0d 0a20 2020  lt is None...   
-00005b80: 2069 6e63 6c75 6465 5f6e 6567 6174 6976   include_negativ
-00005b90: 655f 696e 7465 7276 616c 203a 2062 6f6f  e_interval : boo
-00005ba0: 6c65 616e 2c20 6f70 7469 6f6e 616c 0d0a  lean, optional..
-00005bb0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-00005bc0: 2074 6865 6e20 616c 6c20 706f 7369 7469   then all positi
-00005bd0: 7665 2061 6e64 206e 6567 6174 6976 6520  ve and negative 
-00005be0: 7661 6c75 6573 2061 7265 2063 6f6e 7369  values are consi
-00005bf0: 6465 7265 640d 0a20 2020 2020 2020 2065  dered..        e
-00005c00: 2e67 2e2c 203c 302e 3520 776f 756c 6420  .g., <0.5 would 
-00005c10: 6265 2063 6f6e 7665 7274 6564 2074 6f20  be converted to 
-00005c20: 282d 6e70 2e69 6e66 2c35 292e 0d0a 2020  (-np.inf,5)...  
-00005c30: 2020 2020 2020 4966 2046 616c 7365 2c20        If False, 
-00005c40: 7468 656e 206f 6e6c 7920 6e6f 6e2d 6e65  then only non-ne
-00005c50: 6761 7469 7665 2076 616c 7565 7320 6172  gative values ar
-00005c60: 6520 636f 6e73 6964 6572 6564 0d0a 2020  e considered..  
-00005c70: 2020 2020 2020 652e 672e 2c20 3c30 2e35        e.g., <0.5
-00005c80: 2077 6f75 6c64 2062 6520 636f 6e76 6572   would be conver
-00005c90: 7465 6420 746f 205b 302c 3529 2e0d 0a20  ted to [0,5)... 
-00005ca0: 2020 2020 2020 2054 6869 7320 7365 7474         This sett
-00005cb0: 696e 6720 6f6e 6c79 2061 6666 6563 7473  ing only affects
-00005cc0: 2072 6573 756c 7473 2069 6620 666f 6375   results if focu
-00005cd0: 735f 6869 6768 5f70 6f74 656e 7469 616c  s_high_potential
-00005ce0: 2069 7320 4661 6c73 652e 0d0a 2020 2020   is False...    
-00005cf0: 2020 2020 5468 6520 6465 6661 756c 7420      The default 
-00005d00: 6973 2046 616c 7365 2e0d 0a20 2020 2070  is False...    p
-00005d10: 7265 6369 7369 6f6e 5f74 6f6c 6572 616e  recision_toleran
-00005d20: 6365 5f74 6f5f 6472 6f70 5f63 656e 736f  ce_to_drop_censo
-00005d30: 7220 3a20 666c 6f61 742c 206f 7074 696f  r : float, optio
-00005d40: 6e61 6c0d 0a20 2020 2020 2020 2054 6872  nal..        Thr
-00005d50: 6573 686f 6c64 2066 6f72 2072 6570 6f72  eshold for repor
-00005d60: 7469 6e67 2063 656e 736f 7265 6420 7673  ting censored vs
-00005d70: 206e 6f6e 2d63 656e 736f 7265 6420 7265   non-censored re
-00005d80: 7375 6c74 732e 0d0a 2020 2020 2020 2020  sults...        
-00005d90: 5573 696e 6720 7468 6520 6465 6661 756c  Using the defaul
-00005da0: 742c 2061 2072 6573 756c 7420 7468 6174  t, a result that
-00005db0: 2069 7320 6b6e 6f77 6e20 746f 2062 6520   is known to be 
-00005dc0: 696e 2074 6865 2069 6e74 6572 7661 6c20  in the interval 
-00005dd0: 2830 2e33 2c20 302e 3529 0d0a 2020 2020  (0.3, 0.5)..    
-00005de0: 2020 2020 776f 756c 6420 6265 2072 6574      would be ret
-00005df0: 7572 6e65 6420 6173 2030 2e34 2c20 7768  urned as 0.4, wh
-00005e00: 6572 6561 7320 6120 746f 6c65 7261 6e63  ereas a toleranc
-00005e10: 6520 6f66 2030 2077 6f75 6c64 2079 6965  e of 0 would yie
-00005e20: 6c64 2061 0d0a 2020 2020 2020 2020 7265  ld a..        re
-00005e30: 7375 6c74 206f 6620 3c30 2e35 206f 7220  sult of <0.5 or 
-00005e40: 3e30 2e33 2064 6570 656e 6469 6e67 206f  >0.3 depending o
-00005e50: 6e20 7468 6520 7661 6c75 6520 6f66 2066  n the value of f
-00005e60: 6f63 7573 5f68 6967 6865 7374 5f70 6f74  ocus_highest_pot
-00005e70: 656e 7469 616c 2e0d 0a20 2020 2020 2020  ential...       
-00005e80: 2054 6865 2064 6566 6175 6c74 2069 7320   The default is 
-00005e90: 302e 3235 2e0d 0a20 2020 2070 7265 6369  0.25...    preci
-00005ea0: 7369 6f6e 5f72 6f75 6e64 696e 6720 3a20  sion_rounding : 
-00005eb0: 626f 6f6c 6561 6e2c 206f 7074 696f 6e61  boolean, optiona
-00005ec0: 6c0d 0a20 2020 2020 2020 2049 6620 5472  l..        If Tr
-00005ed0: 7565 2c20 6120 726f 756e 6469 6e67 206d  ue, a rounding m
-00005ee0: 6574 686f 6420 6973 2061 7070 6c69 6564  ethod is applied
-00005ef0: 2074 6f20 726f 756e 6420 7265 7375 6c74   to round result
-00005f00: 7320 746f 2068 6176 6520 6e6f 206d 6f72  s to have no mor
-00005f10: 650d 0a20 2020 2020 2020 2064 6563 696d  e..        decim
-00005f20: 616c 7320 7468 616e 2077 6861 7420 6361  als than what ca
-00005f30: 6e20 6265 206d 6561 7375 7265 642e 0d0a  n be measured...
-00005f40: 2020 2020 2020 2020 5468 6520 6465 6661          The defa
-00005f50: 756c 7420 6973 2054 7275 652e 0d0a 0d0a  ult is True.....
-00005f60: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
-00005f70: 202d 2d2d 2d2d 2d2d 0d0a 2020 2020 6466   -------..    df
-00005f80: 203a 2044 6174 6146 7261 6d65 0d0a 2020   : DataFrame..  
-00005f90: 2020 2020 2020 4461 7461 4672 616d 6520        DataFrame 
-00005fa0: 7468 6174 2063 6f6e 7461 696e 7320 6120  that contains a 
-00005fb0: 636f 6c75 6d6e 2077 6974 6820 7468 6520  column with the 
-00005fc0: 7265 6c65 7661 6e74 206d 696e 696d 756d  relevant minimum
-00005fd0: 206f 7220 6d69 6e69 6d61 0d0a 0d0a 2020   or minima....  
-00005fe0: 2020 2727 270d 0a20 2020 200d 0a20 2020    '''..    ..   
-00005ff0: 2023 2043 7265 6174 6520 6120 636f 7079   # Create a copy
-00006000: 206f 6620 7468 6520 4461 7461 4672 616d   of the DataFram
-00006010: 650d 0a20 2020 2064 6620 3d20 6466 2e63  e..    df = df.c
-00006020: 6f70 7928 290d 0a20 2020 200d 0a20 2020  opy()..    ..   
-00006030: 2023 2053 706c 6974 2074 6865 2072 6573   # Split the res
-00006040: 756c 7420 696e 746f 2063 656e 736f 7220  ult into censor 
-00006050: 616e 6420 6e75 6d65 7269 6320 636f 6d70  and numeric comp
-00006060: 6f6e 656e 7473 0d0a 2020 2020 6466 203d  onents..    df =
-00006070: 2072 6573 756c 745f 746f 5f63 6f6d 706f   result_to_compo
-00006080: 6e65 6e74 7328 6466 2c72 6573 756c 745f  nents(df,result_
-00006090: 636f 6c29 0d0a 2020 2020 0d0a 2020 2020  col)..    ..    
-000060a0: 2320 436f 6e76 6572 7420 7468 6520 7265  # Convert the re
-000060b0: 7375 6c74 7320 6672 6f6d 2063 656e 736f  sults from censo
-000060c0: 7220 616e 6420 6e75 6d65 7269 6320 636f  r and numeric co
-000060d0: 6d70 6f6e 656e 7473 2074 6f20 616e 2069  mponents to an i
-000060e0: 6e74 6572 7661 6c20 7265 7072 6573 656e  nterval represen
-000060f0: 7461 7469 6f6e 0d0a 2020 2020 6466 203d  tation..    df =
-00006100: 2063 6f6d 706f 6e65 6e74 735f 746f 5f69   components_to_i
-00006110: 6e74 6572 7661 6c28 6466 2c20 696e 636c  nterval(df, incl
-00006120: 7564 655f 6e65 6761 7469 7665 5f69 6e74  ude_negative_int
-00006130: 6572 7661 6c29 0d0a 2020 2020 0d0a 2020  erval)..    ..  
-00006140: 2020 2320 5573 696e 6720 7468 6520 696e    # Using the in
-00006150: 7465 7276 616c 732c 2064 6574 6572 6d69  tervals, determi
-00006160: 6e65 2074 6865 2072 616e 6765 206f 6620  ne the range of 
-00006170: 706f 7373 6962 6c65 206d 696e 696d 610d  possible minima.
-00006180: 0a20 2020 200d 0a20 2020 2023 2049 6620  .    ..    # If 
-00006190: 7468 6572 6520 6172 6520 6e6f 2067 726f  there are no gro
-000061a0: 7570 6279 2d63 6f6c 756d 6e73 2c20 7468  upby-columns, th
-000061b0: 656e 2074 616b 6520 6d69 6e20 6f66 2061  en take min of a
-000061c0: 6c6c 2072 6573 756c 7473 0d0a 2020 2020  ll results..    
-000061d0: 6966 206e 6f74 2067 726f 7570 6279 5f63  if not groupby_c
-000061e0: 6f6c 756d 6e73 3a0d 0a20 2020 2020 2020  olumns:..       
-000061f0: 2064 6620 3d20 6d69 6e69 6d75 6d5f 696e   df = minimum_in
-00006200: 7465 7276 616c 2864 662c 2067 726f 7570  terval(df, group
-00006210: 6279 5f63 6f6c 756d 6e73 3d5b 5d29 0d0a  by_columns=[])..
-00006220: 2020 2020 2320 4966 2074 6865 2067 726f      # If the gro
-00006230: 7570 6279 5f63 6f6c 756d 6e73 2069 7320  upby_columns is 
-00006240: 6120 6c69 7374 206f 6620 6c69 7374 732c  a list of lists,
-00006250: 2074 6865 6e20 7065 7266 6f72 6d20 6d75   then perform mu
-00006260: 6c74 6970 6c65 206d 696e 696d 756d 730d  ltiple minimums.
-00006270: 0a20 2020 2065 6c69 6620 6973 696e 7374  .    elif isinst
-00006280: 616e 6365 2867 726f 7570 6279 5f63 6f6c  ance(groupby_col
-00006290: 756d 6e73 5b30 5d2c 6c69 7374 293a 0d0a  umns[0],list):..
-000062a0: 2020 2020 2020 2020 666f 7220 6772 6f75          for grou
-000062b0: 7069 6e67 2069 6e20 6772 6f75 7062 795f  ping in groupby_
-000062c0: 636f 6c75 6d6e 733a 0d0a 2020 2020 2020  columns:..      
-000062d0: 2020 2020 2020 2320 5573 696e 6720 7468        # Using th
-000062e0: 6520 696e 7465 7276 616c 732c 2064 6574  e intervals, det
-000062f0: 6572 6d69 6e65 2074 6865 2072 616e 6765  ermine the range
-00006300: 206f 6620 706f 7373 6962 6c65 206d 6178   of possible max
-00006310: 696d 610d 0a20 2020 2020 2020 2020 2020  ima..           
-00006320: 2064 6620 3d20 6d69 6e69 6d75 6d5f 696e   df = minimum_in
-00006330: 7465 7276 616c 2864 662c 2067 726f 7570  terval(df, group
-00006340: 696e 6729 0d0a 2020 2020 2320 456c 7365  ing)..    # Else
-00006350: 2074 6865 2067 726f 7570 6279 5f63 6f6c   the groupby_col
-00006360: 756d 6e73 2069 7320 6120 6c69 7374 206f  umns is a list o
-00006370: 6620 636f 6c75 6d6e 206e 616d 6573 0d0a  f column names..
-00006380: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00006390: 2020 2064 6620 3d20 6d69 6e69 6d75 6d5f     df = minimum_
-000063a0: 696e 7465 7276 616c 2864 662c 2067 726f  interval(df, gro
-000063b0: 7570 6279 5f63 6f6c 756d 6e73 290d 0a20  upby_columns).. 
-000063c0: 2020 200d 0a20 2020 2023 2043 6f6e 7665     ..    # Conve
-000063d0: 7274 2074 6865 2069 6e74 6572 7661 6c20  rt the interval 
-000063e0: 666f 7220 7468 6520 6d69 6e69 6d75 6d20  for the minimum 
-000063f0: 696e 746f 2063 656e 736f 7220 616e 6420  into censor and 
-00006400: 6e75 6d65 7269 6320 6e6f 7461 7469 6f6e  numeric notation
-00006410: 0d0a 2020 2020 6466 203d 2069 6e74 6572  ..    df = inter
-00006420: 7661 6c5f 746f 5f63 6f6d 706f 6e65 6e74  val_to_component
-00006430: 7328 6466 2c0d 0a20 2020 2020 2020 2020  s(df,..         
-00006440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006450: 2020 2020 2020 2066 6f63 7573 5f68 6967         focus_hig
-00006460: 685f 706f 7465 6e74 6961 6c20 3d20 4661  h_potential = Fa
-00006470: 6c73 652c 0d0a 2020 2020 2020 2020 2020  lse,..          
+00004930: 2020 2020 2070 7265 6369 7369 6f6e 5f74       precision_t
+00004940: 6f6c 6572 616e 6365 5f74 6f5f 6472 6f70  olerance_to_drop
+00004950: 5f63 656e 736f 7220 3d20 7072 6563 6973  _censor = precis
+00004960: 696f 6e5f 746f 6c65 7261 6e63 655f 746f  ion_tolerance_to
+00004970: 5f64 726f 705f 6365 6e73 6f72 290d 0a20  _drop_censor).. 
+00004980: 2020 200d 0a20 2020 2023 2043 7265 6174     ..    # Creat
+00004990: 6520 696e 7465 7276 616c 206e 6f74 6174  e interval notat
+000049a0: 696f 6e20 666f 7220 7468 6520 6d61 7869  ion for the maxi
+000049b0: 6d75 6d0d 0a20 2020 2064 6620 3d20 696e  mum..    df = in
+000049c0: 7465 7276 616c 5f6e 6f74 6174 696f 6e28  terval_notation(
+000049d0: 6466 2c20 7072 6563 6973 696f 6e5f 726f  df, precision_ro
+000049e0: 756e 6469 6e67 290d 0a20 2020 200d 0a20  unding)..    .. 
+000049f0: 2020 2023 2043 6f6d 6269 6e65 2074 6865     # Combine the
+00004a00: 2063 656e 736f 7220 616e 6420 6e75 6d65   censor and nume
+00004a10: 7269 6320 636f 6d70 6f6e 656e 7473 2069  ric components i
+00004a20: 6e74 6f20 6120 7265 7375 6c74 0d0a 2020  nto a result..  
+00004a30: 2020 6466 203d 2063 6f6d 706f 6e65 6e74    df = component
+00004a40: 735f 746f 5f72 6573 756c 7428 6466 2c20  s_to_result(df, 
+00004a50: 7072 6563 6973 696f 6e5f 726f 756e 6469  precision_roundi
+00004a60: 6e67 290d 0a20 2020 200d 0a20 2020 2023  ng)..    ..    #
+00004a70: 2044 726f 7020 776f 726b 696e 6720 636f   Drop working co
+00004a80: 6c75 6d6e 730d 0a20 2020 2064 6620 3d20  lumns..    df = 
+00004a90: 6466 2e64 726f 7028 6466 2e66 696c 7465  df.drop(df.filte
+00004aa0: 7228 7265 6765 783d 275f 5f27 292e 636f  r(regex='__').co
+00004ab0: 6c75 6d6e 732c 2061 7869 733d 3129 0d0a  lumns, axis=1)..
+00004ac0: 2020 2020 0d0a 2020 2020 2320 5265 6f72      ..    # Reor
+00004ad0: 6465 7220 636f 6c75 6d6e 730d 0a20 2020  der columns..   
+00004ae0: 2066 6f72 2063 6f6c 2069 6e20 5b73 7461   for col in [sta
+00004af0: 745f 636f 6c2c 7265 7375 6c74 5f63 6f6c  t_col,result_col
+00004b00: 2c63 656e 736f 725f 636f 6c2c 6e75 6d65  ,censor_col,nume
+00004b10: 7269 635f 636f 6c2c 696e 7465 7276 616c  ric_col,interval
+00004b20: 5f63 6f6c 5d3a 0d0a 2020 2020 2020 2020  _col]:..        
+00004b30: 6466 5b63 6f6c 5d20 3d20 6466 2e70 6f70  df[col] = df.pop
+00004b40: 2863 6f6c 290d 0a20 2020 200d 0a20 2020  (col)..    ..   
+00004b50: 2072 6574 7572 6e20 6466 0d0a 0d0a 2325   return df....#%
+00004b60: 2520 4d69 6e69 6d75 6d20 5265 7375 6c74  % Minimum Result
+00004b70: 0d0a 0d0a 6465 6620 6d69 6e69 6d75 6d5f  ....def minimum_
+00004b80: 696e 7465 7276 616c 2864 662c 0d0a 2020  interval(df,..  
+00004b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ba0: 2020 2067 726f 7570 6279 5f63 6f6c 756d     groupby_colum
+00004bb0: 6e73 293a 0d0a 2020 2020 2727 270d 0a20  ns):..    '''.. 
+00004bc0: 2020 2041 2066 756e 6374 696f 6e20 7468     A function th
+00004bd0: 6174 2061 6e61 6c79 7365 7320 7468 6520  at analyses the 
+00004be0: 696e 7465 7276 616c 206e 6f74 6174 696f  interval notatio
+00004bf0: 6e20 666f 726d 206f 6620 7265 7375 6c74  n form of result
+00004c00: 7320 7265 7475 726e 6564 0d0a 2020 2020  s returned..    
+00004c10: 6672 6f6d 2063 6f6d 706f 6e65 6e74 735f  from components_
+00004c20: 746f 5f69 6e74 6572 7661 6c20 746f 2067  to_interval to g
+00004c30: 656e 6572 6174 6520 6120 6e65 7720 696e  enerate a new in
+00004c40: 7465 7276 616c 2066 6f72 2074 6865 206d  terval for the m
+00004c50: 696e 696d 756d 2e20 4772 6f75 7073 0d0a  inimum. Groups..
+00004c60: 2020 2020 6f66 2072 6573 756c 7473 2063      of results c
+00004c70: 616e 2062 6520 6465 6669 6e65 6420 6279  an be defined by
+00004c80: 2069 6e63 6c75 6469 6e67 2074 6865 2063   including the c
+00004c90: 6f6c 756d 6e73 2074 6861 7420 7368 6f75  olumns that shou
+00004ca0: 6c64 2062 6520 7573 6564 2074 6f0d 0a20  ld be used to.. 
+00004cb0: 2020 2063 7265 6174 6520 6772 6f75 7073     create groups
+00004cc0: 2e0d 0a0d 0a20 2020 2050 6172 616d 6574  .....    Paramet
+00004cd0: 6572 730d 0a20 2020 202d 2d2d 2d2d 2d2d  ers..    -------
+00004ce0: 2d2d 2d0d 0a20 2020 2064 6620 3a20 4461  ---..    df : Da
+00004cf0: 7461 4672 616d 650d 0a20 2020 2020 2020  taFrame..       
+00004d00: 2044 6174 6146 7261 6d65 2074 6861 7420   DataFrame that 
+00004d10: 636f 6e74 6169 6e73 2072 6573 756c 7473  contains results
+00004d20: 2069 6e20 6120 7370 6563 6966 6963 2069   in a specific i
+00004d30: 6e74 6572 7661 6c20 6e6f 7461 7469 6f6e  nterval notation
+00004d40: 2e0d 0a20 2020 2067 726f 7570 6279 5f63  ...    groupby_c
+00004d50: 6f6c 756d 6e73 203a 206c 6973 7420 6f66  olumns : list of
+00004d60: 2073 7472 696e 6773 0d0a 2020 2020 2020   strings..      
+00004d70: 2020 4c69 7374 206f 6620 636f 6c75 6d6e    List of column
+00004d80: 206e 616d 6573 2074 6861 7420 7368 6f75   names that shou
+00004d90: 6c64 2062 6520 7573 6564 2074 6f20 6372  ld be used to cr
+00004da0: 6561 7465 2067 726f 7570 732e 0d0a 0d0a  eate groups.....
+00004db0: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
+00004dc0: 202d 2d2d 2d2d 2d2d 0d0a 2020 2020 6466   -------..    df
+00004dd0: 203a 2044 6174 6146 7261 6d65 0d0a 2020   : DataFrame..  
+00004de0: 2020 2020 2020 4461 7461 4672 616d 6520        DataFrame 
+00004df0: 7468 6174 2068 6173 2074 6865 2069 6e74  that has the int
+00004e00: 6572 7661 6c20 666f 7220 7468 6520 6d69  erval for the mi
+00004e10: 6e69 6d75 6d20 2866 6f72 2065 6163 6820  nimum (for each 
+00004e20: 6772 6f75 7020 6966 0d0a 2020 2020 2020  group if..      
+00004e30: 2020 636f 6c75 6d6e 206e 616d 6573 2061    column names a
+00004e40: 7265 2070 726f 7669 6465 6420 666f 7220  re provided for 
+00004e50: 6772 6f75 7069 6e67 290d 0a0d 0a20 2020  grouping)....   
+00004e60: 2027 2727 0d0a 2020 2020 0d0a 2020 2020   '''..    ..    
+00004e70: 2320 4372 6561 7465 2061 2063 6f70 7920  # Create a copy 
+00004e80: 6f66 2074 6865 2044 6174 6146 7261 6d65  of the DataFrame
+00004e90: 0d0a 2020 2020 6466 203d 2064 662e 636f  ..    df = df.co
+00004ea0: 7079 2829 2e72 6573 6574 5f69 6e64 6578  py().reset_index
+00004eb0: 2829 0d0a 2020 2020 0d0a 2020 2020 2320  ()..    ..    # 
+00004ec0: 4372 6561 7465 2063 6f6c 756d 6e20 7468  Create column th
+00004ed0: 6174 2069 6e64 6963 6174 6573 2074 6865  at indicates the
+00004ee0: 2067 656e 6572 6174 6564 2073 7461 7469   generated stati
+00004ef0: 7374 6963 2061 6e64 2061 7070 656e 6420  stic and append 
+00004f00: 746f 2067 726f 7570 696e 6720 6c69 7374  to grouping list
+00004f10: 0d0a 2020 2020 6466 5b73 7461 745f 636f  ..    df[stat_co
+00004f20: 6c5d 203d 2027 4d69 6e69 6d75 6d27 0d0a  l] = 'Minimum'..
+00004f30: 2020 2020 6772 6f75 7062 795f 636f 6c75      groupby_colu
+00004f40: 6d6e 732e 6170 7065 6e64 2873 7461 745f  mns.append(stat_
+00004f50: 636f 6c29 0d0a 2020 2020 0d0a 2020 2020  col)..    ..    
+00004f60: 2320 4465 7465 726d 696e 6520 6c65 6674  # Determine left
+00004f70: 2062 6f75 6e64 2061 6e64 2062 6f75 6e64   bound and bound
+00004f80: 6172 7920 666f 7220 6d69 6e69 6d75 6d20  ary for minimum 
+00004f90: 666f 7220 6561 6368 2067 726f 7570 2e0d  for each group..
+00004fa0: 0a20 2020 200d 0a20 2020 2023 2043 6f6e  .    ..    # Con
+00004fb0: 7369 6465 7220 7468 6520 6d69 6e69 6d75  sider the minimu
+00004fc0: 6d20 626f 756e 6420 666f 7220 6561 6368  m bound for each
+00004fd0: 206c 6566 7420 626f 756e 6461 7279 206f   left boundary o
+00004fe0: 7074 696f 6e20 746f 2064 6574 6572 6d69  ption to determi
+00004ff0: 6e65 0d0a 2020 2020 2320 7768 6574 6865  ne..    # whethe
+00005000: 7220 7468 6520 626f 756e 6420 7368 6f75  r the bound shou
+00005010: 6c64 2062 6520 6f70 656e 206f 7220 636c  ld be open or cl
+00005020: 6f73 6564 2e0d 0a20 2020 206c 6566 7420  osed...    left 
+00005030: 3d20 6466 2e67 726f 7570 6279 2867 726f  = df.groupby(gro
+00005040: 7570 6279 5f63 6f6c 756d 6e73 2b5b 6c65  upby_columns+[le
+00005050: 6674 5f62 6f75 6e64 6172 795f 636f 6c5d  ft_boundary_col]
+00005060: 295b 6c65 6674 5f62 6f75 6e64 5f63 6f6c  )[left_bound_col
+00005070: 5d2e 6d69 6e28 292e 756e 7374 6163 6b28  ].min().unstack(
+00005080: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
+00005090: 6c29 0d0a 2020 2020 2320 4372 6561 7465  l)..    # Create
+000050a0: 206d 6973 7369 6e67 2063 6f6c 756d 6e73   missing columns
+000050b0: 0d0a 2020 2020 666f 7220 6974 656d 2069  ..    for item i
+000050c0: 6e20 5b27 4f70 656e 272c 2743 6c6f 7365  n ['Open','Close
+000050d0: 6427 5d3a 0d0a 2020 2020 2020 2020 6966  d']:..        if
+000050e0: 2069 7465 6d20 6e6f 7420 696e 206c 6566   item not in lef
+000050f0: 742e 636f 6c75 6d6e 733a 0d0a 2020 2020  t.columns:..    
+00005100: 2020 2020 2020 2020 6c65 6674 5b69 7465          left[ite
+00005110: 6d5d 203d 206e 702e 6e61 6e0d 0a20 2020  m] = np.nan..   
+00005120: 2023 2055 7365 2074 6865 206d 696e 696d   # Use the minim
+00005130: 756d 2063 6c6f 7365 6420 626f 756e 6461  um closed bounda
+00005140: 7279 2069 6620 7468 6572 6520 6172 6520  ry if there are 
+00005150: 6e6f 206f 7065 6e20 626f 756e 6461 7269  no open boundari
+00005160: 6573 206f 720d 0a20 2020 2023 2069 6620  es or..    # if 
+00005170: 7468 6520 636c 6f73 6564 2062 6f75 6e64  the closed bound
+00005180: 6172 7920 6973 206c 6573 7320 7468 616e  ary is less than
+00005190: 206f 7220 6571 7561 6c20 746f 2074 6865   or equal to the
+000051a0: 206c 6561 7374 206f 7065 6e20 626f 756e   least open boun
+000051b0: 6461 7279 0d0a 2020 2020 636f 6e64 6974  dary..    condit
+000051c0: 696f 6e20 3d20 286c 6566 745b 2743 6c6f  ion = (left['Clo
+000051d0: 7365 6427 5d20 3c3d 206c 6566 745b 274f  sed'] <= left['O
+000051e0: 7065 6e27 5d29 207c 2028 6c65 6674 5b27  pen']) | (left['
+000051f0: 4f70 656e 275d 2e69 736e 6128 2929 0d0a  Open'].isna())..
+00005200: 2020 2020 6c65 6674 5b6c 6566 745f 626f      left[left_bo
+00005210: 756e 6461 7279 5f63 6f6c 5d20 3d20 6e70  undary_col] = np
+00005220: 2e77 6865 7265 2863 6f6e 6469 7469 6f6e  .where(condition
+00005230: 2c27 436c 6f73 6564 272c 274f 7065 6e27  ,'Closed','Open'
+00005240: 290d 0a20 2020 206c 6566 745b 6c65 6674  )..    left[left
+00005250: 5f62 6f75 6e64 5f63 6f6c 5d20 3d20 6e70  _bound_col] = np
+00005260: 2e77 6865 7265 2863 6f6e 6469 7469 6f6e  .where(condition
+00005270: 2c6c 6566 745b 2743 6c6f 7365 6427 5d2c  ,left['Closed'],
+00005280: 6c65 6674 5b27 4f70 656e 275d 290d 0a20  left['Open']).. 
+00005290: 2020 206c 6566 7420 3d20 6c65 6674 5b5b     left = left[[
+000052a0: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
+000052b0: 6c2c 6c65 6674 5f62 6f75 6e64 5f63 6f6c  l,left_bound_col
+000052c0: 5d5d 0d0a 2020 2020 0d0a 2020 2020 2320  ]]..    ..    # 
+000052d0: 4465 7465 726d 696e 6520 7269 6768 7420  Determine right 
+000052e0: 626f 756e 6420 616e 6420 626f 756e 6461  bound and bounda
+000052f0: 7279 2066 6f72 206d 696e 696d 756d 2066  ry for minimum f
+00005300: 6f72 2065 6163 6820 6772 6f75 702e 0d0a  or each group...
+00005310: 2020 2020 0d0a 2020 2020 2320 436f 6e73      ..    # Cons
+00005320: 6964 6572 2074 6865 206d 696e 696d 756d  ider the minimum
+00005330: 2062 6f75 6e64 2066 6f72 2065 6163 6820   bound for each 
+00005340: 7269 6768 7420 626f 756e 6461 7279 206f  right boundary o
+00005350: 7074 696f 6e20 746f 2064 6574 6572 6d69  ption to determi
+00005360: 6e65 0d0a 2020 2020 2320 7768 6574 6865  ne..    # whethe
+00005370: 7220 7468 6520 626f 756e 6420 7368 6f75  r the bound shou
+00005380: 6c64 2062 6520 6f70 656e 206f 7220 636c  ld be open or cl
+00005390: 6f73 6564 2e0d 0a20 2020 2072 6967 6874  osed...    right
+000053a0: 203d 2064 662e 6772 6f75 7062 7928 6772   = df.groupby(gr
+000053b0: 6f75 7062 795f 636f 6c75 6d6e 732b 5b72  oupby_columns+[r
+000053c0: 6967 6874 5f62 6f75 6e64 6172 795f 636f  ight_boundary_co
+000053d0: 6c5d 295b 7269 6768 745f 626f 756e 645f  l])[right_bound_
+000053e0: 636f 6c5d 2e6d 696e 2829 2e75 6e73 7461  col].min().unsta
+000053f0: 636b 2872 6967 6874 5f62 6f75 6e64 6172  ck(right_boundar
+00005400: 795f 636f 6c29 0d0a 2020 2020 2320 4372  y_col)..    # Cr
+00005410: 6561 7465 206d 6973 7369 6e67 2063 6f6c  eate missing col
+00005420: 756d 6e73 0d0a 2020 2020 666f 7220 6974  umns..    for it
+00005430: 656d 2069 6e20 5b27 4f70 656e 272c 2743  em in ['Open','C
+00005440: 6c6f 7365 6427 5d3a 0d0a 2020 2020 2020  losed']:..      
+00005450: 2020 6966 2069 7465 6d20 6e6f 7420 696e    if item not in
+00005460: 2072 6967 6874 2e63 6f6c 756d 6e73 3a0d   right.columns:.
+00005470: 0a20 2020 2020 2020 2020 2020 2072 6967  .            rig
+00005480: 6874 5b69 7465 6d5d 203d 206e 702e 6e61  ht[item] = np.na
+00005490: 6e0d 0a20 2020 2023 2055 7365 2074 6865  n..    # Use the
+000054a0: 206d 696e 696d 756d 2063 6c6f 7365 6420   minimum closed 
+000054b0: 626f 756e 6461 7279 2069 6620 7468 6572  boundary if ther
+000054c0: 6520 6172 6520 6e6f 206f 7065 6e20 626f  e are no open bo
+000054d0: 756e 6461 7269 6573 206f 720d 0a20 2020  undaries or..   
+000054e0: 2023 2069 6620 7468 6520 636c 6f73 6564   # if the closed
+000054f0: 2062 6f75 6e64 6172 7920 6973 206c 6573   boundary is les
+00005500: 7320 7468 616e 2074 6865 206c 6561 7374  s than the least
+00005510: 206f 7065 6e20 626f 756e 6461 7279 0d0a   open boundary..
+00005520: 2020 2020 636f 6e64 6974 696f 6e20 3d20      condition = 
+00005530: 2872 6967 6874 5b27 436c 6f73 6564 275d  (right['Closed']
+00005540: 203c 2072 6967 6874 5b27 4f70 656e 275d   < right['Open']
+00005550: 2920 7c20 2872 6967 6874 5b27 4f70 656e  ) | (right['Open
+00005560: 275d 2e69 736e 6128 2929 0d0a 2020 2020  '].isna())..    
+00005570: 7269 6768 745b 7269 6768 745f 626f 756e  right[right_boun
+00005580: 645f 636f 6c5d 203d 206e 702e 7768 6572  d_col] = np.wher
+00005590: 6528 636f 6e64 6974 696f 6e2c 7269 6768  e(condition,righ
+000055a0: 745b 2743 6c6f 7365 6427 5d2c 7269 6768  t['Closed'],righ
+000055b0: 745b 274f 7065 6e27 5d29 0d0a 2020 2020  t['Open'])..    
+000055c0: 7269 6768 745b 7269 6768 745f 626f 756e  right[right_boun
+000055d0: 6461 7279 5f63 6f6c 5d20 3d20 6e70 2e77  dary_col] = np.w
+000055e0: 6865 7265 2863 6f6e 6469 7469 6f6e 2c27  here(condition,'
+000055f0: 436c 6f73 6564 272c 274f 7065 6e27 290d  Closed','Open').
+00005600: 0a20 2020 2072 6967 6874 203d 2072 6967  .    right = rig
+00005610: 6874 5b5b 7269 6768 745f 626f 756e 645f  ht[[right_bound_
+00005620: 636f 6c2c 7269 6768 745f 626f 756e 6461  col,right_bounda
+00005630: 7279 5f63 6f6c 5d5d 0d0a 2020 2020 0d0a  ry_col]]..    ..
+00005640: 2020 2020 2320 4d65 7267 6520 7468 6520      # Merge the 
+00005650: 7477 6f20 626f 756e 6461 7269 6573 2074  two boundaries t
+00005660: 6f20 6372 6561 7465 2074 6865 2069 6e74  o create the int
+00005670: 6572 7661 6c20 666f 7220 7468 6520 6d69  erval for the mi
+00005680: 6e69 6d75 6d0d 0a20 2020 2023 2043 6865  nimum..    # Che
+00005690: 636b 2074 6861 7420 7468 6520 6d65 7267  ck that the merg
+000056a0: 6520 6973 2031 2d74 6f2d 310d 0a20 2020  e is 1-to-1..   
+000056b0: 2064 6620 3d20 6c65 6674 2e6d 6572 6765   df = left.merge
+000056c0: 2872 6967 6874 2c20 686f 7720 3d20 276f  (right, how = 'o
+000056d0: 7574 6572 272c 206f 6e20 3d20 6772 6f75  uter', on = grou
+000056e0: 7062 795f 636f 6c75 6d6e 732c 2076 616c  pby_columns, val
+000056f0: 6964 6174 6520 3d20 2731 3a31 2729 0d0a  idate = '1:1')..
+00005700: 2020 2020 0d0a 2020 2020 2320 5265 7365      ..    # Rese
+00005710: 7420 696e 6465 780d 0a20 2020 2064 6620  t index..    df 
+00005720: 3d20 6466 2e72 6573 6574 5f69 6e64 6578  = df.reset_index
+00005730: 2829 0d0a 2020 2020 0d0a 2020 2020 7265  ()..    ..    re
+00005740: 7475 726e 2064 660d 0a0d 0a64 6566 206d  turn df....def m
+00005750: 696e 696d 756d 2864 662c 0d0a 2020 2020  inimum(df,..    
+00005760: 2020 2020 2020 2020 7265 7375 6c74 5f63          result_c
+00005770: 6f6c 2c0d 0a20 2020 2020 2020 2020 2020  ol,..           
+00005780: 2067 726f 7570 6279 5f63 6f6c 756d 6e73   groupby_columns
+00005790: 203d 204e 6f6e 652c 0d0a 2020 2020 2020   = None,..      
+000057a0: 2020 2020 2020 696e 636c 7564 655f 6e65        include_ne
+000057b0: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
+000057c0: 3d20 4661 6c73 652c 0d0a 2020 2020 2020  = False,..      
+000057d0: 2020 2020 2020 7072 6563 6973 696f 6e5f        precision_
+000057e0: 746f 6c65 7261 6e63 655f 746f 5f64 726f  tolerance_to_dro
+000057f0: 705f 6365 6e73 6f72 203d 2030 2e32 352c  p_censor = 0.25,
+00005800: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+00005810: 6563 6973 696f 6e5f 726f 756e 6469 6e67  ecision_rounding
+00005820: 203d 2054 7275 6529 3a0d 0a20 2020 2027   = True):..    '
+00005830: 2727 0d0a 2020 2020 4120 6675 6e63 7469  ''..    A functi
+00005840: 6f6e 2074 6861 7420 636f 6d62 696e 6573  on that combines
+00005850: 2074 6865 2072 656c 6576 616e 7420 6d69   the relevant mi
+00005860: 6e69 6d75 6d20 616e 6420 7574 696c 6974  nimum and utilit
+00005870: 7920 6675 6e63 7469 6f6e 7320 746f 0d0a  y functions to..
+00005880: 2020 2020 6765 6e65 7261 7465 2074 6865      generate the
+00005890: 206d 696e 696d 6120 7265 7375 6c74 7320   minima results 
+000058a0: 666f 7220 6772 6f75 7073 2077 6974 6869  for groups withi
+000058b0: 6e20 6120 4461 7461 4672 616d 652e 0d0a  n a DataFrame...
+000058c0: 0d0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
+000058d0: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  ..    ----------
+000058e0: 0d0a 2020 2020 6466 203a 2044 6174 6146  ..    df : DataF
+000058f0: 7261 6d65 0d0a 2020 2020 2020 2020 4461  rame..        Da
+00005900: 7461 4672 616d 6520 7468 6174 2063 6f6e  taFrame that con
+00005910: 7461 696e 7320 6365 6e73 6f72 6564 206f  tains censored o
+00005920: 7220 756e 6365 6e73 6f72 6564 2072 6573  r uncensored res
+00005930: 756c 7473 0d0a 2020 2020 7265 7375 6c74  ults..    result
+00005940: 5f63 6f6c 203a 2073 7472 696e 670d 0a20  _col : string.. 
+00005950: 2020 2020 2020 2054 6865 2063 6f6c 756d         The colum
+00005960: 6e20 6e61 6d65 2066 6f72 2074 6865 2063  n name for the c
+00005970: 6f6c 756d 6e20 7468 6174 2063 6f6e 7461  olumn that conta
+00005980: 696e 2074 6865 2072 6573 756c 7473 2061  in the results a
+00005990: 7320 7465 7874 2e0d 0a20 2020 2020 2020  s text...       
+000059a0: 204f 6e6c 7920 666f 7572 2070 6f73 7369   Only four possi
+000059b0: 626c 6520 6365 6e73 6f72 7320 7368 6f75  ble censors shou
+000059c0: 6c64 2062 6520 7573 6564 2028 3c2c e289  ld be used (<,..
+000059d0: a42c e289 a52c 3e29 2e0d 0a20 2020 2067  .,...,>)...    g
+000059e0: 726f 7570 6279 5f63 6f6c 756d 6e73 203a  roupby_columns :
+000059f0: 206c 6973 7473 206f 6620 7374 7269 6e67   lists of string
+00005a00: 7320 286f 7220 6c69 7374 206f 6620 6c69  s (or list of li
+00005a10: 7374 7329 2c20 6f70 7469 6f6e 616c 0d0a  sts), optional..
+00005a20: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
+00005a30: 636f 6c75 6d6e 206e 616d 6573 2074 6861  column names tha
+00005a40: 7420 7368 6f75 6c64 2062 6520 7573 6564  t should be used
+00005a50: 2074 6f20 6372 6561 7465 2067 726f 7570   to create group
+00005a60: 732e 2041 206d 696e 696d 756d 0d0a 2020  s. A minimum..  
+00005a70: 2020 2020 2020 7769 6c6c 2062 6520 666f        will be fo
+00005a80: 756e 6420 7769 7468 696e 2065 6163 6820  und within each 
+00005a90: 6772 6f75 702e 204d 756c 7469 706c 6520  group. Multiple 
+00005aa0: 6c69 7374 7320 6361 6e20 6265 2073 7570  lists can be sup
+00005ab0: 706c 6965 6420 746f 0d0a 2020 2020 2020  plied to..      
+00005ac0: 2020 7065 7266 6f72 6d20 7365 7175 656e    perform sequen
+00005ad0: 7469 616c 206d 696e 696d 6120 6265 666f  tial minima befo
+00005ae0: 7265 2063 6f6e 7665 7274 696e 6720 696e  re converting in
+00005af0: 7465 7276 616c 7320 746f 2061 2072 6573  tervals to a res
+00005b00: 756c 742e 0d0a 2020 2020 2020 2020 5468  ult...        Th
+00005b10: 6520 6465 6661 756c 7420 6973 204e 6f6e  e default is Non
+00005b20: 652e 0d0a 2020 2020 696e 636c 7564 655f  e...    include_
+00005b30: 6e65 6761 7469 7665 5f69 6e74 6572 7661  negative_interva
+00005b40: 6c20 3a20 626f 6f6c 6561 6e2c 206f 7074  l : boolean, opt
+00005b50: 696f 6e61 6c0d 0a20 2020 2020 2020 2049  ional..        I
+00005b60: 6620 5472 7565 2c20 7468 656e 2061 6c6c  f True, then all
+00005b70: 2070 6f73 6974 6976 6520 616e 6420 6e65   positive and ne
+00005b80: 6761 7469 7665 2076 616c 7565 7320 6172  gative values ar
+00005b90: 6520 636f 6e73 6964 6572 6564 0d0a 2020  e considered..  
+00005ba0: 2020 2020 2020 652e 672e 2c20 3c30 2e35        e.g., <0.5
+00005bb0: 2077 6f75 6c64 2062 6520 636f 6e76 6572   would be conver
+00005bc0: 7465 6420 746f 2028 2d6e 702e 696e 662c  ted to (-np.inf,
+00005bd0: 3529 2e0d 0a20 2020 2020 2020 2049 6620  5)...        If 
+00005be0: 4661 6c73 652c 2074 6865 6e20 6f6e 6c79  False, then only
+00005bf0: 206e 6f6e 2d6e 6567 6174 6976 6520 7661   non-negative va
+00005c00: 6c75 6573 2061 7265 2063 6f6e 7369 6465  lues are conside
+00005c10: 7265 640d 0a20 2020 2020 2020 2065 2e67  red..        e.g
+00005c20: 2e2c 203c 302e 3520 776f 756c 6420 6265  ., <0.5 would be
+00005c30: 2063 6f6e 7665 7274 6564 2074 6f20 5b30   converted to [0
+00005c40: 2c35 292e 0d0a 2020 2020 2020 2020 5468  ,5)...        Th
+00005c50: 6973 2073 6574 7469 6e67 206f 6e6c 7920  is setting only 
+00005c60: 6166 6665 6374 7320 7265 7375 6c74 7320  affects results 
+00005c70: 6966 2066 6f63 7573 5f68 6967 685f 706f  if focus_high_po
+00005c80: 7465 6e74 6961 6c20 6973 2046 616c 7365  tential is False
+00005c90: 2e0d 0a20 2020 2020 2020 2054 6865 2064  ...        The d
+00005ca0: 6566 6175 6c74 2069 7320 4661 6c73 652e  efault is False.
+00005cb0: 0d0a 2020 2020 7072 6563 6973 696f 6e5f  ..    precision_
+00005cc0: 746f 6c65 7261 6e63 655f 746f 5f64 726f  tolerance_to_dro
+00005cd0: 705f 6365 6e73 6f72 203a 2066 6c6f 6174  p_censor : float
+00005ce0: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
+00005cf0: 2020 2020 5468 7265 7368 6f6c 6420 666f      Threshold fo
+00005d00: 7220 7265 706f 7274 696e 6720 6365 6e73  r reporting cens
+00005d10: 6f72 6564 2076 7320 6e6f 6e2d 6365 6e73  ored vs non-cens
+00005d20: 6f72 6564 2072 6573 756c 7473 2e0d 0a20  ored results... 
+00005d30: 2020 2020 2020 2055 7369 6e67 2074 6865         Using the
+00005d40: 2064 6566 6175 6c74 2c20 6120 7265 7375   default, a resu
+00005d50: 6c74 2074 6861 7420 6973 206b 6e6f 776e  lt that is known
+00005d60: 2074 6f20 6265 2069 6e20 7468 6520 696e   to be in the in
+00005d70: 7465 7276 616c 2028 302e 332c 2030 2e35  terval (0.3, 0.5
+00005d80: 290d 0a20 2020 2020 2020 2077 6f75 6c64  )..        would
+00005d90: 2062 6520 7265 7475 726e 6564 2061 7320   be returned as 
+00005da0: 302e 342c 2077 6865 7265 6173 2061 2074  0.4, whereas a t
+00005db0: 6f6c 6572 616e 6365 206f 6620 3020 776f  olerance of 0 wo
+00005dc0: 756c 6420 7969 656c 6420 610d 0a20 2020  uld yield a..   
+00005dd0: 2020 2020 2072 6573 756c 7420 6f66 203c       result of <
+00005de0: 302e 3520 6f72 203e 302e 3320 6465 7065  0.5 or >0.3 depe
+00005df0: 6e64 696e 6720 6f6e 2074 6865 2076 616c  nding on the val
+00005e00: 7565 206f 6620 666f 6375 735f 6869 6768  ue of focus_high
+00005e10: 6573 745f 706f 7465 6e74 6961 6c2e 0d0a  est_potential...
+00005e20: 2020 2020 2020 2020 5468 6520 6465 6661          The defa
+00005e30: 756c 7420 6973 2030 2e32 352e 0d0a 2020  ult is 0.25...  
+00005e40: 2020 7072 6563 6973 696f 6e5f 726f 756e    precision_roun
+00005e50: 6469 6e67 203a 2062 6f6f 6c65 616e 2c20  ding : boolean, 
+00005e60: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
+00005e70: 2020 4966 2054 7275 652c 2061 2072 6f75    If True, a rou
+00005e80: 6e64 696e 6720 6d65 7468 6f64 2069 7320  nding method is 
+00005e90: 6170 706c 6965 6420 746f 2072 6f75 6e64  applied to round
+00005ea0: 2072 6573 756c 7473 2074 6f20 6861 7665   results to have
+00005eb0: 206e 6f20 6d6f 7265 0d0a 2020 2020 2020   no more..      
+00005ec0: 2020 6465 6369 6d61 6c73 2074 6861 6e20    decimals than 
+00005ed0: 7768 6174 2063 616e 2062 6520 6d65 6173  what can be meas
+00005ee0: 7572 6564 2e0d 0a20 2020 2020 2020 2054  ured...        T
+00005ef0: 6865 2064 6566 6175 6c74 2069 7320 5472  he default is Tr
+00005f00: 7565 2e0d 0a0d 0a20 2020 2052 6574 7572  ue.....    Retur
+00005f10: 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d 2d0d  ns..    -------.
+00005f20: 0a20 2020 2064 6620 3a20 4461 7461 4672  .    df : DataFr
+00005f30: 616d 650d 0a20 2020 2020 2020 2044 6174  ame..        Dat
+00005f40: 6146 7261 6d65 2074 6861 7420 636f 6e74  aFrame that cont
+00005f50: 6169 6e73 2061 2063 6f6c 756d 6e20 7769  ains a column wi
+00005f60: 7468 2074 6865 2072 656c 6576 616e 7420  th the relevant 
+00005f70: 6d69 6e69 6d75 6d20 6f72 206d 696e 696d  minimum or minim
+00005f80: 610d 0a0d 0a20 2020 2027 2727 0d0a 2020  a....    '''..  
+00005f90: 2020 0d0a 2020 2020 2320 4372 6561 7465    ..    # Create
+00005fa0: 2061 2063 6f70 7920 6f66 2074 6865 2044   a copy of the D
+00005fb0: 6174 6146 7261 6d65 0d0a 2020 2020 6466  ataFrame..    df
+00005fc0: 203d 2064 662e 636f 7079 2829 0d0a 2020   = df.copy()..  
+00005fd0: 2020 0d0a 2020 2020 2320 5370 6c69 7420    ..    # Split 
+00005fe0: 7468 6520 7265 7375 6c74 2069 6e74 6f20  the result into 
+00005ff0: 6365 6e73 6f72 2061 6e64 206e 756d 6572  censor and numer
+00006000: 6963 2063 6f6d 706f 6e65 6e74 730d 0a20  ic components.. 
+00006010: 2020 2064 6620 3d20 7265 7375 6c74 5f74     df = result_t
+00006020: 6f5f 636f 6d70 6f6e 656e 7473 2864 662c  o_components(df,
+00006030: 7265 7375 6c74 5f63 6f6c 290d 0a20 2020  result_col)..   
+00006040: 200d 0a20 2020 2023 2043 6f6e 7665 7274   ..    # Convert
+00006050: 2074 6865 2072 6573 756c 7473 2066 726f   the results fro
+00006060: 6d20 6365 6e73 6f72 2061 6e64 206e 756d  m censor and num
+00006070: 6572 6963 2063 6f6d 706f 6e65 6e74 7320  eric components 
+00006080: 746f 2061 6e20 696e 7465 7276 616c 2072  to an interval r
+00006090: 6570 7265 7365 6e74 6174 696f 6e0d 0a20  epresentation.. 
+000060a0: 2020 2064 6620 3d20 636f 6d70 6f6e 656e     df = componen
+000060b0: 7473 5f74 6f5f 696e 7465 7276 616c 2864  ts_to_interval(d
+000060c0: 662c 2069 6e63 6c75 6465 5f6e 6567 6174  f, include_negat
+000060d0: 6976 655f 696e 7465 7276 616c 290d 0a20  ive_interval).. 
+000060e0: 2020 200d 0a20 2020 2023 2055 7369 6e67     ..    # Using
+000060f0: 2074 6865 2069 6e74 6572 7661 6c73 2c20   the intervals, 
+00006100: 6465 7465 726d 696e 6520 7468 6520 7261  determine the ra
+00006110: 6e67 6520 6f66 2070 6f73 7369 626c 6520  nge of possible 
+00006120: 6d69 6e69 6d61 0d0a 2020 2020 0d0a 2020  minima..    ..  
+00006130: 2020 2320 4966 2074 6865 7265 2061 7265    # If there are
+00006140: 206e 6f20 6772 6f75 7062 792d 636f 6c75   no groupby-colu
+00006150: 6d6e 732c 2074 6865 6e20 7461 6b65 206d  mns, then take m
+00006160: 696e 206f 6620 616c 6c20 7265 7375 6c74  in of all result
+00006170: 730d 0a20 2020 2069 6620 6e6f 7420 6772  s..    if not gr
+00006180: 6f75 7062 795f 636f 6c75 6d6e 733a 0d0a  oupby_columns:..
+00006190: 2020 2020 2020 2020 6466 203d 206d 696e          df = min
+000061a0: 696d 756d 5f69 6e74 6572 7661 6c28 6466  imum_interval(df
+000061b0: 2c20 6772 6f75 7062 795f 636f 6c75 6d6e  , groupby_column
+000061c0: 733d 5b5d 290d 0a20 2020 2023 2049 6620  s=[])..    # If 
+000061d0: 7468 6520 6772 6f75 7062 795f 636f 6c75  the groupby_colu
+000061e0: 6d6e 7320 6973 2061 206c 6973 7420 6f66  mns is a list of
+000061f0: 206c 6973 7473 2c20 7468 656e 2070 6572   lists, then per
+00006200: 666f 726d 206d 756c 7469 706c 6520 6d69  form multiple mi
+00006210: 6e69 6d75 6d73 0d0a 2020 2020 656c 6966  nimums..    elif
+00006220: 2069 7369 6e73 7461 6e63 6528 6772 6f75   isinstance(grou
+00006230: 7062 795f 636f 6c75 6d6e 735b 305d 2c6c  pby_columns[0],l
+00006240: 6973 7429 3a0d 0a20 2020 2020 2020 2066  ist):..        f
+00006250: 6f72 2067 726f 7570 696e 6720 696e 2067  or grouping in g
+00006260: 726f 7570 6279 5f63 6f6c 756d 6e73 3a0d  roupby_columns:.
+00006270: 0a20 2020 2020 2020 2020 2020 2023 2055  .            # U
+00006280: 7369 6e67 2074 6865 2069 6e74 6572 7661  sing the interva
+00006290: 6c73 2c20 6465 7465 726d 696e 6520 7468  ls, determine th
+000062a0: 6520 7261 6e67 6520 6f66 2070 6f73 7369  e range of possi
+000062b0: 626c 6520 6d61 7869 6d61 0d0a 2020 2020  ble maxima..    
+000062c0: 2020 2020 2020 2020 6466 203d 206d 696e          df = min
+000062d0: 696d 756d 5f69 6e74 6572 7661 6c28 6466  imum_interval(df
+000062e0: 2c20 6772 6f75 7069 6e67 290d 0a20 2020  , grouping)..   
+000062f0: 2023 2045 6c73 6520 7468 6520 6772 6f75   # Else the grou
+00006300: 7062 795f 636f 6c75 6d6e 7320 6973 2061  pby_columns is a
+00006310: 206c 6973 7420 6f66 2063 6f6c 756d 6e20   list of column 
+00006320: 6e61 6d65 730d 0a20 2020 2065 6c73 653a  names..    else:
+00006330: 0d0a 2020 2020 2020 2020 6466 203d 206d  ..        df = m
+00006340: 696e 696d 756d 5f69 6e74 6572 7661 6c28  inimum_interval(
+00006350: 6466 2c20 6772 6f75 7062 795f 636f 6c75  df, groupby_colu
+00006360: 6d6e 7329 0d0a 2020 2020 0d0a 2020 2020  mns)..    ..    
+00006370: 2320 436f 6e76 6572 7420 7468 6520 696e  # Convert the in
+00006380: 7465 7276 616c 2066 6f72 2074 6865 206d  terval for the m
+00006390: 696e 696d 756d 2069 6e74 6f20 6365 6e73  inimum into cens
+000063a0: 6f72 2061 6e64 206e 756d 6572 6963 206e  or and numeric n
+000063b0: 6f74 6174 696f 6e0d 0a20 2020 2064 6620  otation..    df 
+000063c0: 3d20 696e 7465 7276 616c 5f74 6f5f 636f  = interval_to_co
+000063d0: 6d70 6f6e 656e 7473 2864 662c 0d0a 2020  mponents(df,..  
+000063e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063f0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00006400: 6375 735f 6869 6768 5f70 6f74 656e 7469  cus_high_potenti
+00006410: 616c 203d 2046 616c 7365 2c0d 0a20 2020  al = False,..   
+00006420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006430: 2020 2020 2020 2020 2020 2020 2069 6e63               inc
+00006440: 6c75 6465 5f6e 6567 6174 6976 655f 696e  lude_negative_in
+00006450: 7465 7276 616c 203d 2069 6e63 6c75 6465  terval = include
+00006460: 5f6e 6567 6174 6976 655f 696e 7465 7276  _negative_interv
+00006470: 616c 2c0d 0a20 2020 2020 2020 2020 2020  al,..           
 00006480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006490: 2020 2020 2020 696e 636c 7564 655f 6e65        include_ne
-000064a0: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
-000064b0: 3d20 696e 636c 7564 655f 6e65 6761 7469  = include_negati
-000064c0: 7665 5f69 6e74 6572 7661 6c2c 0d0a 2020  ve_interval,..  
-000064d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000064e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000064f0: 6563 6973 696f 6e5f 746f 6c65 7261 6e63  ecision_toleranc
-00006500: 655f 746f 5f64 726f 705f 6365 6e73 6f72  e_to_drop_censor
-00006510: 203d 2070 7265 6369 7369 6f6e 5f74 6f6c   = precision_tol
-00006520: 6572 616e 6365 5f74 6f5f 6472 6f70 5f63  erance_to_drop_c
-00006530: 656e 736f 7229 0d0a 2020 2020 0d0a 2020  ensor)..    ..  
-00006540: 2020 2320 4372 6561 7465 2069 6e74 6572    # Create inter
-00006550: 7661 6c20 6e6f 7461 7469 6f6e 2066 6f72  val notation for
-00006560: 2074 6865 206d 696e 696d 756d 0d0a 2020   the minimum..  
-00006570: 2020 6466 203d 2069 6e74 6572 7661 6c5f    df = interval_
-00006580: 6e6f 7461 7469 6f6e 2864 662c 2070 7265  notation(df, pre
-00006590: 6369 7369 6f6e 5f72 6f75 6e64 696e 6729  cision_rounding)
-000065a0: 0d0a 2020 2020 0d0a 2020 2020 2320 436f  ..    ..    # Co
-000065b0: 6d62 696e 6520 7468 6520 6365 6e73 6f72  mbine the censor
-000065c0: 2061 6e64 206e 756d 6572 6963 2063 6f6d   and numeric com
-000065d0: 706f 6e65 6e74 7320 696e 746f 2061 2072  ponents into a r
-000065e0: 6573 756c 740d 0a20 2020 2064 6620 3d20  esult..    df = 
-000065f0: 636f 6d70 6f6e 656e 7473 5f74 6f5f 7265  components_to_re
-00006600: 7375 6c74 2864 662c 2063 656e 736f 725f  sult(df, censor_
-00006610: 636f 6c2c 206e 756d 6572 6963 5f63 6f6c  col, numeric_col
-00006620: 2c20 7072 6563 6973 696f 6e5f 726f 756e  , precision_roun
-00006630: 6469 6e67 290d 0a20 2020 200d 0a20 2020  ding)..    ..   
-00006640: 2023 2044 726f 7020 776f 726b 696e 6720   # Drop working 
-00006650: 636f 6c75 6d6e 730d 0a20 2020 2064 6620  columns..    df 
-00006660: 3d20 6466 2e64 726f 7028 6466 2e66 696c  = df.drop(df.fil
-00006670: 7465 7228 7265 6765 783d 275f 5f27 292e  ter(regex='__').
-00006680: 636f 6c75 6d6e 732c 2061 7869 733d 3129  columns, axis=1)
-00006690: 0d0a 2020 2020 0d0a 2020 2020 2320 5265  ..    ..    # Re
-000066a0: 6f72 6465 7220 636f 6c75 6d6e 730d 0a20  order columns.. 
-000066b0: 2020 2066 6f72 2063 6f6c 2069 6e20 5b73     for col in [s
-000066c0: 7461 745f 636f 6c2c 7265 7375 6c74 5f63  tat_col,result_c
-000066d0: 6f6c 2c63 656e 736f 725f 636f 6c2c 6e75  ol,censor_col,nu
-000066e0: 6d65 7269 635f 636f 6c2c 696e 7465 7276  meric_col,interv
-000066f0: 616c 5f63 6f6c 5d3a 0d0a 2020 2020 2020  al_col]:..      
-00006700: 2020 6466 5b63 6f6c 5d20 3d20 6466 2e70    df[col] = df.p
-00006710: 6f70 2863 6f6c 290d 0a20 2020 200d 0a20  op(col)..    .. 
-00006720: 2020 2072 6574 7572 6e20 6466 0d0a 0d0a     return df....
-00006730: 2325 2520 4176 6572 6167 6520 5265 7375  #%% Average Resu
-00006740: 6c74 0d0a 0d0a 6465 6620 6176 6572 6167  lt....def averag
-00006750: 655f 696e 7465 7276 616c 2864 662c 0d0a  e_interval(df,..
-00006760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006770: 2020 2020 2067 726f 7570 6279 5f63 6f6c       groupby_col
-00006780: 756d 6e73 293a 0d0a 2020 2020 2727 270d  umns):..    '''.
-00006790: 0a20 2020 2041 2066 756e 6374 696f 6e20  .    A function 
-000067a0: 7468 6174 2061 6e61 6c79 7365 7320 7468  that analyses th
-000067b0: 6520 696e 7465 7276 616c 206e 6f74 6174  e interval notat
-000067c0: 696f 6e20 666f 726d 206f 6620 7265 7375  ion form of resu
-000067d0: 6c74 7320 7265 7475 726e 6564 0d0a 2020  lts returned..  
-000067e0: 2020 6672 6f6d 2063 6f6d 706f 6e65 6e74    from component
-000067f0: 735f 746f 5f69 6e74 6572 7661 6c20 746f  s_to_interval to
-00006800: 2067 656e 6572 6174 6520 6120 6e65 7720   generate a new 
-00006810: 696e 7465 7276 616c 2066 6f72 2074 6865  interval for the
-00006820: 2061 7665 7261 6765 2e20 4772 6f75 7073   average. Groups
-00006830: 0d0a 2020 2020 6f66 2072 6573 756c 7473  ..    of results
-00006840: 2063 616e 2062 6520 6465 6669 6e65 6420   can be defined 
-00006850: 6279 2069 6e63 6c75 6469 6e67 2074 6865  by including the
-00006860: 2063 6f6c 756d 6e73 2074 6861 7420 7368   columns that sh
-00006870: 6f75 6c64 2062 6520 7573 6564 2074 6f0d  ould be used to.
-00006880: 0a20 2020 2063 7265 6174 6520 6772 6f75  .    create grou
-00006890: 7073 2e0d 0a0d 0a20 2020 2050 6172 616d  ps.....    Param
-000068a0: 6574 6572 730d 0a20 2020 202d 2d2d 2d2d  eters..    -----
-000068b0: 2d2d 2d2d 2d0d 0a20 2020 2064 6620 3a20  -----..    df : 
-000068c0: 4461 7461 4672 616d 650d 0a20 2020 2020  DataFrame..     
-000068d0: 2020 2044 6174 6146 7261 6d65 2074 6861     DataFrame tha
-000068e0: 7420 636f 6e74 6169 6e73 2072 6573 756c  t contains resul
-000068f0: 7473 2069 6e20 6120 7370 6563 6966 6963  ts in a specific
-00006900: 2069 6e74 6572 7661 6c20 6e6f 7461 7469   interval notati
-00006910: 6f6e 2e0d 0a20 2020 2067 726f 7570 6279  on...    groupby
-00006920: 5f63 6f6c 756d 6e73 203a 206c 6973 7420  _columns : list 
-00006930: 6f66 2073 7472 696e 6773 0d0a 2020 2020  of strings..    
-00006940: 2020 2020 4c69 7374 206f 6620 636f 6c75      List of colu
-00006950: 6d6e 206e 616d 6573 2074 6861 7420 7368  mn names that sh
-00006960: 6f75 6c64 2062 6520 7573 6564 2074 6f20  ould be used to 
-00006970: 6372 6561 7465 2067 726f 7570 732e 0d0a  create groups...
-00006980: 0d0a 2020 2020 5265 7475 726e 730d 0a20  ..    Returns.. 
-00006990: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
-000069a0: 6466 203a 2044 6174 6146 7261 6d65 0d0a  df : DataFrame..
-000069b0: 2020 2020 2020 2020 4461 7461 4672 616d          DataFram
-000069c0: 6520 7468 6174 2068 6173 2074 6865 2069  e that has the i
-000069d0: 6e74 6572 7661 6c20 666f 7220 7468 6520  nterval for the 
-000069e0: 6176 6572 6167 6520 2866 6f72 2065 6163  average (for eac
-000069f0: 6820 6772 6f75 7020 6966 0d0a 2020 2020  h group if..    
-00006a00: 2020 2020 636f 6c75 6d6e 206e 616d 6573      column names
-00006a10: 2061 7265 2070 726f 7669 6465 6420 666f   are provided fo
-00006a20: 7220 6772 6f75 7069 6e67 290d 0a0d 0a20  r grouping).... 
-00006a30: 2020 2027 2727 0d0a 2020 2020 0d0a 2020     '''..    ..  
-00006a40: 2020 2320 4372 6561 7465 2061 2063 6f70    # Create a cop
-00006a50: 7920 6f66 2074 6865 2044 6174 6146 7261  y of the DataFra
-00006a60: 6d65 0d0a 2020 2020 6466 203d 2064 662e  me..    df = df.
-00006a70: 636f 7079 2829 2e72 6573 6574 5f69 6e64  copy().reset_ind
-00006a80: 6578 2829 0d0a 2020 2020 0d0a 2020 2020  ex()..    ..    
-00006a90: 2320 4372 6561 7465 2063 6f6c 756d 6e20  # Create column 
-00006aa0: 7468 6174 2069 6e64 6963 6174 6573 2074  that indicates t
-00006ab0: 6865 2067 656e 6572 6174 6564 2073 7461  he generated sta
-00006ac0: 7469 7374 6963 2061 6e64 2061 7070 656e  tistic and appen
-00006ad0: 6420 746f 2067 726f 7570 696e 6720 6c69  d to grouping li
-00006ae0: 7374 0d0a 2020 2020 6466 5b73 7461 745f  st..    df[stat_
-00006af0: 636f 6c5d 203d 2027 4176 6572 6167 6527  col] = 'Average'
-00006b00: 0d0a 2020 2020 6772 6f75 7062 795f 636f  ..    groupby_co
-00006b10: 6c75 6d6e 732e 6170 7065 6e64 2873 7461  lumns.append(sta
-00006b20: 745f 636f 6c29 0d0a 2020 2020 0d0a 2020  t_col)..    ..  
-00006b30: 2020 2320 4368 616e 6765 206e 6f74 6174    # Change notat
-00006b40: 696f 6e20 6f66 2027 436c 6f73 6564 2720  ion of 'Closed' 
-00006b50: 616e 6420 274f 7065 6e27 2062 6f75 6e64  and 'Open' bound
-00006b60: 6172 6965 7320 746f 2030 2061 6e64 2031  aries to 0 and 1
-00006b70: 2c20 7265 7370 6563 7469 7665 6c79 0d0a  , respectively..
-00006b80: 2020 2020 2320 5468 6520 7072 6573 656e      # The presen
-00006b90: 6365 206f 6620 616e 7920 6f70 656e 2062  ce of any open b
-00006ba0: 6f75 6e64 6172 6965 7320 6f6e 206f 6e65  oundaries on one
-00006bb0: 2073 6964 6520 656e 7375 7265 2074 6861   side ensure tha
-00006bc0: 7420 7468 6520 696e 7465 7276 616c 2066  t the interval f
-00006bd0: 6f72 2074 6865 2061 7665 7261 6765 2069  or the average i
-00006be0: 7320 616c 736f 0d0a 2020 2020 2320 6f70  s also..    # op
-00006bf0: 656e 206f 6e20 7468 6174 2073 6964 650d  en on that side.
-00006c00: 0a20 2020 2064 665b 5b6c 6566 745f 626f  .    df[[left_bo
-00006c10: 756e 6461 7279 5f63 6f6c 2c72 6967 6874  undary_col,right
-00006c20: 5f62 6f75 6e64 6172 795f 636f 6c5d 5d20  _boundary_col]] 
-00006c30: 3d20 6466 5b5b 6c65 6674 5f62 6f75 6e64  = df[[left_bound
-00006c40: 6172 795f 636f 6c2c 7269 6768 745f 626f  ary_col,right_bo
-00006c50: 756e 6461 7279 5f63 6f6c 5d5d 2e72 6570  undary_col]].rep
-00006c60: 6c61 6365 285b 2743 6c6f 7365 6427 2c27  lace(['Closed','
-00006c70: 4f70 656e 275d 2c20 5b30 2c31 5d29 0d0a  Open'], [0,1])..
-00006c80: 2020 2020 0d0a 2020 2020 2320 4765 7420      ..    # Get 
-00006c90: 7468 6520 6c65 6674 2f72 6967 6874 2062  the left/right b
-00006ca0: 6f75 6e64 7320 6f66 2074 6865 2061 7665  ounds of the ave
-00006cb0: 7261 6765 2062 7920 6176 6572 6167 696e  rage by averagin
-00006cc0: 6720 626f 756e 6473 2077 6974 6869 6e20  g bounds within 
-00006cd0: 7468 6520 6772 6f75 700d 0a20 2020 2023  the group..    #
-00006ce0: 2044 6574 6572 6d69 6e65 2077 6865 7468   Determine wheth
-00006cf0: 6572 2061 6e79 204f 7065 6e20 286e 6f77  er any Open (now
-00006d00: 2076 616c 7565 206f 6620 3129 2062 6f75   value of 1) bou
-00006d10: 6e64 6172 6965 7320 6578 6973 742e 2049  ndaries exist. I
-00006d20: 6620 7468 6572 6520 6172 650d 0a20 2020  f there are..   
-00006d30: 2023 2061 6e79 206f 7065 6e20 626f 756e   # any open boun
-00006d40: 6461 7269 6573 2075 7365 6420 696e 2074  daries used in t
-00006d50: 6865 2061 7665 7261 6765 2c20 7468 656e  he average, then
-00006d60: 2074 6865 2072 6573 756c 7469 6e67 2061   the resulting a
-00006d70: 7665 7261 6765 2077 696c 6c20 6265 206f  verage will be o
-00006d80: 7065 6e0d 0a20 2020 2064 6620 3d20 6466  pen..    df = df
-00006d90: 2e67 726f 7570 6279 2867 726f 7570 6279  .groupby(groupby
-00006da0: 5f63 6f6c 756d 6e73 292e 6167 6728 2a2a  _columns).agg(**
-00006db0: 7b0d 0a20 2020 2020 2020 2020 2020 2020  {..             
-00006dc0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00006dd0: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
-00006de0: 3a20 286c 6566 745f 626f 756e 6461 7279  : (left_boundary
-00006df0: 5f63 6f6c 2c20 276d 6178 2729 2c0d 0a20  _col, 'max'),.. 
-00006e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e10: 2020 2020 2020 2020 2020 2027 5f5f 4d69             '__Mi
-00006e20: 6e69 6d75 6d5f 5f27 3a20 286c 6566 745f  nimum__': (left_
-00006e30: 626f 756e 645f 636f 6c2c 276d 696e 2729  bound_col,'min')
-00006e40: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00006e50: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00006e60: 6566 745f 626f 756e 645f 636f 6c3a 2028  eft_bound_col: (
-00006e70: 6c65 6674 5f62 6f75 6e64 5f63 6f6c 2c27  left_bound_col,'
-00006e80: 6d65 616e 2729 2c0d 0a20 2020 2020 2020  mean'),..       
-00006e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ea0: 2020 2020 2072 6967 6874 5f62 6f75 6e64       right_bound
-00006eb0: 5f63 6f6c 3a20 2872 6967 6874 5f62 6f75  _col: (right_bou
-00006ec0: 6e64 5f63 6f6c 2c27 6d65 616e 2729 2c0d  nd_col,'mean'),.
-00006ed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006ee0: 2020 2020 2020 2020 2020 2020 2027 5f5f               '__
-00006ef0: 4d61 7869 6d75 6d5f 5f27 3a20 286c 6566  Maximum__': (lef
-00006f00: 745f 626f 756e 645f 636f 6c2c 276d 6178  t_bound_col,'max
-00006f10: 2729 2c0d 0a20 2020 2020 2020 2020 2020  '),..           
-00006f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f30: 2072 6967 6874 5f62 6f75 6e64 6172 795f   right_boundary_
-00006f40: 636f 6c3a 2028 7269 6768 745f 626f 756e  col: (right_boun
-00006f50: 6461 7279 5f63 6f6c 2c27 6d61 7827 290d  dary_col,'max').
-00006f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006f70: 2020 2020 2020 2020 2020 2020 207d 290d               }).
-00006f80: 0a20 2020 200d 0a20 2020 2023 2052 6570  .    ..    # Rep
-00006f90: 6c61 6365 2069 6e74 6567 6572 7320 7769  lace integers wi
-00006fa0: 7468 2074 6578 7420 666f 7220 626f 756e  th text for boun
-00006fb0: 6461 7269 6573 0d0a 2020 2020 6466 5b5b  daries..    df[[
-00006fc0: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
-00006fd0: 6c2c 7269 6768 745f 626f 756e 6461 7279  l,right_boundary
-00006fe0: 5f63 6f6c 5d5d 203d 2064 665b 5b6c 6566  _col]] = df[[lef
-00006ff0: 745f 626f 756e 6461 7279 5f63 6f6c 2c72  t_boundary_col,r
-00007000: 6967 6874 5f62 6f75 6e64 6172 795f 636f  ight_boundary_co
-00007010: 6c5d 5d2e 7265 706c 6163 6528 5b30 2c31  l]].replace([0,1
-00007020: 5d2c 205b 2743 6c6f 7365 6427 2c27 4f70  ], ['Closed','Op
-00007030: 656e 275d 290d 0a20 2020 200d 0a20 2020  en'])..    ..   
-00007040: 2023 204d 6561 6e73 2077 6974 6820 696e   # Means with in
-00007050: 6669 6e69 7465 2076 616c 7565 7320 7072  finite values pr
-00007060: 6f64 7563 6520 6e61 6e20 7661 6c75 6573  oduce nan values
-00007070: 2072 6174 6865 7220 7468 616e 206e 702e   rather than np.
-00007080: 696e 6620 7661 6c75 6573 0d0a 2020 2020  inf values..    
-00007090: 2320 436f 6e76 6572 7420 6e61 6e20 746f  # Convert nan to
-000070a0: 2069 6e66 206f 6e6c 7920 6966 2069 6e66   inf only if inf
-000070b0: 696e 6974 6520 7661 6c75 6573 2061 7265  inite values are
-000070c0: 2069 6e63 6c75 6465 6420 696e 2074 6865   included in the
-000070d0: 206d 6561 6e0d 0a20 2020 2064 665b 6c65   mean..    df[le
-000070e0: 6674 5f62 6f75 6e64 5f63 6f6c 5d20 3d20  ft_bound_col] = 
-000070f0: 6e70 2e77 6865 7265 2864 665b 275f 5f4d  np.where(df['__M
-00007100: 696e 696d 756d 5f5f 275d 203d 3d20 2d6e  inimum__'] == -n
-00007110: 702e 696e 662c 202d 6e70 2e69 6e66 2c20  p.inf, -np.inf, 
-00007120: 6466 5b6c 6566 745f 626f 756e 645f 636f  df[left_bound_co
-00007130: 6c5d 290d 0a20 2020 2064 665b 7269 6768  l])..    df[righ
-00007140: 745f 626f 756e 645f 636f 6c5d 203d 206e  t_bound_col] = n
-00007150: 702e 7768 6572 6528 6466 5b27 5f5f 4d61  p.where(df['__Ma
-00007160: 7869 6d75 6d5f 5f27 5d20 3d3d 206e 702e  ximum__'] == np.
-00007170: 696e 662c 206e 702e 696e 662c 2064 665b  inf, np.inf, df[
-00007180: 7269 6768 745f 626f 756e 645f 636f 6c5d  right_bound_col]
-00007190: 290d 0a20 2020 200d 0a20 2020 2023 2052  )..    ..    # R
-000071a0: 6573 6574 2069 6e64 6578 0d0a 2020 2020  eset index..    
-000071b0: 6466 203d 2064 662e 7265 7365 745f 696e  df = df.reset_in
-000071c0: 6465 7828 290d 0a20 2020 200d 0a20 2020  dex()..    ..   
-000071d0: 2072 6574 7572 6e20 6466 0d0a 0d0a 6465   return df....de
-000071e0: 6620 6176 6572 6167 6528 6466 2c0d 0a20  f average(df,.. 
-000071f0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00007200: 745f 636f 6c2c 0d0a 2020 2020 2020 2020  t_col,..        
-00007210: 2020 2020 6772 6f75 7062 795f 636f 6c75      groupby_colu
-00007220: 6d6e 7320 3d20 4e6f 6e65 2c0d 0a20 2020  mns = None,..   
-00007230: 2020 2020 2020 2020 2066 6f63 7573 5f68           focus_h
-00007240: 6967 685f 706f 7465 6e74 6961 6c20 3d20  igh_potential = 
-00007250: 5472 7565 2c0d 0a20 2020 2020 2020 2020  True,..         
-00007260: 2020 2069 6e63 6c75 6465 5f6e 6567 6174     include_negat
-00007270: 6976 655f 696e 7465 7276 616c 203d 2046  ive_interval = F
-00007280: 616c 7365 2c0d 0a20 2020 2020 2020 2020  alse,..         
-00007290: 2020 2070 7265 6369 7369 6f6e 5f74 6f6c     precision_tol
-000072a0: 6572 616e 6365 5f74 6f5f 6472 6f70 5f63  erance_to_drop_c
-000072b0: 656e 736f 7220 3d20 302e 3235 2c0d 0a20  ensor = 0.25,.. 
-000072c0: 2020 2020 2020 2020 2020 2070 7265 6369             preci
-000072d0: 7369 6f6e 5f72 6f75 6e64 696e 6720 3d20  sion_rounding = 
-000072e0: 5472 7565 293a 0d0a 2020 2020 2727 270d  True):..    '''.
-000072f0: 0a20 2020 2041 2066 756e 6374 696f 6e20  .    A function 
-00007300: 7468 6174 2063 6f6d 6269 6e65 7320 7468  that combines th
-00007310: 6520 7265 6c65 7661 6e74 2061 7665 7261  e relevant avera
-00007320: 6765 2061 6e64 2075 7469 6c69 7479 2066  ge and utility f
-00007330: 756e 6374 696f 6e73 2074 6f0d 0a20 2020  unctions to..   
-00007340: 2067 656e 6572 6174 6520 7468 6520 6176   generate the av
-00007350: 6572 6167 6520 7265 7375 6c74 7320 666f  erage results fo
-00007360: 7220 6772 6f75 7073 2077 6974 6869 6e20  r groups within 
-00007370: 6120 4461 7461 4672 616d 652e 0d0a 0d0a  a DataFrame.....
-00007380: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
-00007390: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a      ----------..
-000073a0: 2020 2020 6466 203a 2044 6174 6146 7261      df : DataFra
-000073b0: 6d65 0d0a 2020 2020 2020 2020 4461 7461  me..        Data
-000073c0: 4672 616d 6520 7468 6174 2063 6f6e 7461  Frame that conta
-000073d0: 696e 7320 6365 6e73 6f72 6564 206f 7220  ins censored or 
-000073e0: 756e 6365 6e73 6f72 6564 2072 6573 756c  uncensored resul
-000073f0: 7473 0d0a 2020 2020 7265 7375 6c74 5f63  ts..    result_c
-00007400: 6f6c 203a 2073 7472 696e 670d 0a20 2020  ol : string..   
-00007410: 2020 2020 2054 6865 2063 6f6c 756d 6e20       The column 
-00007420: 6e61 6d65 2066 6f72 2074 6865 2063 6f6c  name for the col
-00007430: 756d 6e20 7468 6174 2063 6f6e 7461 696e  umn that contain
-00007440: 2074 6865 2072 6573 756c 7473 2061 7320   the results as 
-00007450: 7465 7874 2e0d 0a20 2020 2020 2020 204f  text...        O
-00007460: 6e6c 7920 666f 7572 2070 6f73 7369 626c  nly four possibl
-00007470: 6520 6365 6e73 6f72 7320 7368 6f75 6c64  e censors should
-00007480: 2062 6520 7573 6564 2028 3c2c e289 a42c   be used (<,...,
-00007490: e289 a52c 3e29 2e0d 0a20 2020 2067 726f  ...,>)...    gro
-000074a0: 7570 6279 5f63 6f6c 756d 6e73 203a 206c  upby_columns : l
-000074b0: 6973 7473 206f 6620 7374 7269 6e67 7320  ists of strings 
-000074c0: 286f 7220 6c69 7374 206f 6620 6c69 7374  (or list of list
-000074d0: 7329 2c20 6f70 7469 6f6e 616c 0d0a 2020  s), optional..  
-000074e0: 2020 2020 2020 4c69 7374 206f 6620 636f        List of co
-000074f0: 6c75 6d6e 206e 616d 6573 2074 6861 7420  lumn names that 
-00007500: 7368 6f75 6c64 2062 6520 7573 6564 2074  should be used t
-00007510: 6f20 6372 6561 7465 2067 726f 7570 732e  o create groups.
-00007520: 2041 6e20 6176 6572 6167 650d 0a20 2020   An average..   
-00007530: 2020 2020 2077 696c 6c20 6265 2066 6f75       will be fou
-00007540: 6e64 2077 6974 6869 6e20 6561 6368 2067  nd within each g
-00007550: 726f 7570 2e20 4d75 6c74 6970 6c65 206c  roup. Multiple l
-00007560: 6973 7473 2063 616e 2062 6520 7375 7070  ists can be supp
-00007570: 6c69 6564 2074 6f0d 0a20 2020 2020 2020  lied to..       
-00007580: 2070 6572 666f 726d 2073 6571 7565 6e74   perform sequent
-00007590: 6961 6c20 6176 6572 6167 696e 6720 6265  ial averaging be
-000075a0: 666f 7265 2063 6f6e 7665 7274 696e 6720  fore converting 
-000075b0: 696e 7465 7276 616c 7320 746f 2061 2072  intervals to a r
-000075c0: 6573 756c 742e 0d0a 2020 2020 2020 2020  esult...        
-000075d0: 5468 6520 6465 6661 756c 7420 6973 204e  The default is N
-000075e0: 6f6e 652e 0d0a 2020 2020 666f 6375 735f  one...    focus_
-000075f0: 6869 6768 5f70 6f74 656e 7469 616c 203a  high_potential :
-00007600: 2062 6f6f 6c65 616e 2c20 6f70 7469 6f6e   boolean, option
-00007610: 616c 0d0a 2020 2020 2020 2020 4966 2054  al..        If T
-00007620: 7275 652c 2074 6865 6e20 696e 666f 726d  rue, then inform
-00007630: 6174 696f 6e20 6f6e 2074 6865 2068 6967  ation on the hig
-00007640: 6865 7374 2070 6f74 656e 7469 616c 2072  hest potential r
-00007650: 6573 756c 7420 7769 6c6c 2062 650d 0a20  esult will be.. 
-00007660: 2020 2020 2020 2066 6f63 7573 6564 206f         focused o
-00007670: 7665 7220 7468 6520 6c6f 7765 7374 2070  ver the lowest p
-00007680: 6f74 656e 7469 616c 2072 6573 756c 742e  otential result.
-00007690: 0d0a 2020 2020 696e 636c 7564 655f 6e65  ..    include_ne
-000076a0: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
-000076b0: 3a20 626f 6f6c 6561 6e2c 206f 7074 696f  : boolean, optio
-000076c0: 6e61 6c0d 0a20 2020 2020 2020 2049 6620  nal..        If 
-000076d0: 5472 7565 2c20 7468 656e 2061 6c6c 2070  True, then all p
-000076e0: 6f73 6974 6976 6520 616e 6420 6e65 6761  ositive and nega
-000076f0: 7469 7665 2076 616c 7565 7320 6172 6520  tive values are 
-00007700: 636f 6e73 6964 6572 6564 0d0a 2020 2020  considered..    
-00007710: 2020 2020 652e 672e 2c20 3c30 2e35 2077      e.g., <0.5 w
-00007720: 6f75 6c64 2062 6520 636f 6e76 6572 7465  ould be converte
-00007730: 6420 746f 2028 2d6e 702e 696e 662c 3529  d to (-np.inf,5)
-00007740: 2e0d 0a20 2020 2020 2020 2049 6620 4661  ...        If Fa
-00007750: 6c73 652c 2074 6865 6e20 6f6e 6c79 206e  lse, then only n
-00007760: 6f6e 2d6e 6567 6174 6976 6520 7661 6c75  on-negative valu
-00007770: 6573 2061 7265 2063 6f6e 7369 6465 7265  es are considere
-00007780: 640d 0a20 2020 2020 2020 2065 2e67 2e2c  d..        e.g.,
-00007790: 203c 302e 3520 776f 756c 6420 6265 2063   <0.5 would be c
-000077a0: 6f6e 7665 7274 6564 2074 6f20 5b30 2c35  onverted to [0,5
-000077b0: 292e 0d0a 2020 2020 2020 2020 5468 6973  )...        This
-000077c0: 2073 6574 7469 6e67 206f 6e6c 7920 6166   setting only af
-000077d0: 6665 6374 7320 7265 7375 6c74 7320 6966  fects results if
-000077e0: 2066 6f63 7573 5f68 6967 685f 706f 7465   focus_high_pote
-000077f0: 6e74 6961 6c20 6973 2046 616c 7365 2e0d  ntial is False..
-00007800: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
-00007810: 6175 6c74 2069 7320 4661 6c73 652e 0d0a  ault is False...
-00007820: 2020 2020 7072 6563 6973 696f 6e5f 746f      precision_to
-00007830: 6c65 7261 6e63 655f 746f 5f64 726f 705f  lerance_to_drop_
-00007840: 6365 6e73 6f72 203a 2066 6c6f 6174 2c20  censor : float, 
-00007850: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
-00007860: 2020 5468 7265 7368 6f6c 6420 666f 7220    Threshold for 
-00007870: 7265 706f 7274 696e 6720 6365 6e73 6f72  reporting censor
-00007880: 6564 2076 7320 6e6f 6e2d 6365 6e73 6f72  ed vs non-censor
-00007890: 6564 2072 6573 756c 7473 2e0d 0a20 2020  ed results...   
-000078a0: 2020 2020 2055 7369 6e67 2074 6865 2064       Using the d
-000078b0: 6566 6175 6c74 2c20 6120 7265 7375 6c74  efault, a result
-000078c0: 2074 6861 7420 6973 206b 6e6f 776e 2074   that is known t
-000078d0: 6f20 6265 2069 6e20 7468 6520 696e 7465  o be in the inte
-000078e0: 7276 616c 2028 302e 332c 2030 2e35 290d  rval (0.3, 0.5).
-000078f0: 0a20 2020 2020 2020 2077 6f75 6c64 2062  .        would b
-00007900: 6520 7265 7475 726e 6564 2061 7320 302e  e returned as 0.
-00007910: 342c 2077 6865 7265 6173 2061 2074 6f6c  4, whereas a tol
-00007920: 6572 616e 6365 206f 6620 3020 776f 756c  erance of 0 woul
-00007930: 6420 7969 656c 6420 610d 0a20 2020 2020  d yield a..     
-00007940: 2020 2072 6573 756c 7420 6f66 203c 302e     result of <0.
-00007950: 3520 6f72 203e 302e 3320 6465 7065 6e64  5 or >0.3 depend
-00007960: 696e 6720 6f6e 2074 6865 2076 616c 7565  ing on the value
-00007970: 206f 6620 666f 6375 735f 6869 6768 6573   of focus_highes
-00007980: 745f 706f 7465 6e74 6961 6c2e 0d0a 2020  t_potential...  
-00007990: 2020 2020 2020 5468 6520 6465 6661 756c        The defaul
-000079a0: 7420 6973 2030 2e32 352e 0d0a 2020 2020  t is 0.25...    
-000079b0: 7072 6563 6973 696f 6e5f 726f 756e 6469  precision_roundi
-000079c0: 6e67 203a 2062 6f6f 6c65 616e 2c20 6f70  ng : boolean, op
-000079d0: 7469 6f6e 616c 0d0a 2020 2020 2020 2020  tional..        
-000079e0: 4966 2054 7275 652c 2061 2072 6f75 6e64  If True, a round
-000079f0: 696e 6720 6d65 7468 6f64 2069 7320 6170  ing method is ap
-00007a00: 706c 6965 6420 746f 2072 6f75 6e64 2072  plied to round r
-00007a10: 6573 756c 7473 2074 6f20 6861 7665 206e  esults to have n
-00007a20: 6f20 6d6f 7265 0d0a 2020 2020 2020 2020  o more..        
-00007a30: 6465 6369 6d61 6c73 2074 6861 6e20 7768  decimals than wh
-00007a40: 6174 2063 616e 2062 6520 6d65 6173 7572  at can be measur
-00007a50: 6564 2e0d 0a20 2020 2020 2020 2054 6865  ed...        The
-00007a60: 2064 6566 6175 6c74 2069 7320 5472 7565   default is True
-00007a70: 2e0d 0a0d 0a20 2020 2052 6574 7572 6e73  .....    Returns
-00007a80: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20  ..    -------.. 
-00007a90: 2020 2064 6620 3a20 4461 7461 4672 616d     df : DataFram
-00007aa0: 650d 0a20 2020 2020 2020 2044 6174 6146  e..        DataF
-00007ab0: 7261 6d65 2074 6861 7420 636f 6e74 6169  rame that contai
-00007ac0: 6e73 2063 616c 6375 6c61 7465 6420 6176  ns calculated av
-00007ad0: 6572 6167 6573 0d0a 0d0a 2020 2020 2727  erages....    ''
-00007ae0: 270d 0a20 2020 200d 0a20 2020 2023 2043  '..    ..    # C
-00007af0: 7265 6174 6520 6120 636f 7079 206f 6620  reate a copy of 
-00007b00: 7468 6520 4461 7461 4672 616d 650d 0a20  the DataFrame.. 
-00007b10: 2020 2064 6620 3d20 6466 2e63 6f70 7928     df = df.copy(
-00007b20: 290d 0a20 2020 200d 0a20 2020 2023 2053  )..    ..    # S
-00007b30: 706c 6974 2074 6865 2072 6573 756c 7420  plit the result 
-00007b40: 696e 746f 2063 656e 736f 7220 616e 6420  into censor and 
-00007b50: 6e75 6d65 7269 6320 636f 6d70 6f6e 656e  numeric componen
-00007b60: 7473 0d0a 2020 2020 6466 203d 2072 6573  ts..    df = res
-00007b70: 756c 745f 746f 5f63 6f6d 706f 6e65 6e74  ult_to_component
-00007b80: 7328 6466 2c72 6573 756c 745f 636f 6c29  s(df,result_col)
-00007b90: 0d0a 2020 2020 0d0a 2020 2020 2320 436f  ..    ..    # Co
-00007ba0: 6e76 6572 7420 7468 6520 7265 7375 6c74  nvert the result
-00007bb0: 7320 6672 6f6d 2063 656e 736f 7220 616e  s from censor an
-00007bc0: 6420 6e75 6d65 7269 6320 636f 6d70 6f6e  d numeric compon
-00007bd0: 656e 7473 2074 6f20 616e 2069 6e74 6572  ents to an inter
-00007be0: 7661 6c20 7265 7072 6573 656e 7461 7469  val representati
-00007bf0: 6f6e 0d0a 2020 2020 6466 203d 2063 6f6d  on..    df = com
-00007c00: 706f 6e65 6e74 735f 746f 5f69 6e74 6572  ponents_to_inter
-00007c10: 7661 6c28 6466 2c20 696e 636c 7564 655f  val(df, include_
-00007c20: 6e65 6761 7469 7665 5f69 6e74 6572 7661  negative_interva
-00007c30: 6c29 0d0a 2020 2020 0d0a 2020 2020 2320  l)..    ..    # 
-00007c40: 5573 696e 6720 7468 6520 696e 7465 7276  Using the interv
-00007c50: 616c 732c 2064 6574 6572 6d69 6e65 2074  als, determine t
-00007c60: 6865 2072 616e 6765 206f 6620 706f 7373  he range of poss
-00007c70: 6962 6c65 2061 7665 7261 6765 730d 0a20  ible averages.. 
-00007c80: 2020 200d 0a20 2020 2023 2049 6620 7468     ..    # If th
-00007c90: 6572 6520 6172 6520 6e6f 2067 726f 7570  ere are no group
-00007ca0: 6279 2d63 6f6c 756d 6e73 2c20 7468 656e  by-columns, then
-00007cb0: 2074 616b 6520 6176 6572 6167 6520 6f66   take average of
-00007cc0: 2061 6c6c 2072 6573 756c 7473 0d0a 2020   all results..  
-00007cd0: 2020 6966 206e 6f74 2067 726f 7570 6279    if not groupby
-00007ce0: 5f63 6f6c 756d 6e73 3a0d 0a20 2020 2020  _columns:..     
-00007cf0: 2020 2064 6620 3d20 6176 6572 6167 655f     df = average_
-00007d00: 696e 7465 7276 616c 2864 662c 2067 726f  interval(df, gro
-00007d10: 7570 6279 5f63 6f6c 756d 6e73 3d5b 5d29  upby_columns=[])
-00007d20: 0d0a 2020 2020 2320 4966 2074 6865 2067  ..    # If the g
-00007d30: 726f 7570 6279 5f63 6f6c 756d 6e73 2069  roupby_columns i
-00007d40: 7320 6120 6c69 7374 206f 6620 6c69 7374  s a list of list
-00007d50: 732c 2074 6865 6e20 7065 7266 6f72 6d20  s, then perform 
-00007d60: 6d75 6c74 6970 6c65 2061 7665 7261 6765  multiple average
-00007d70: 730d 0a20 2020 2065 6c69 6620 6973 696e  s..    elif isin
-00007d80: 7374 616e 6365 2867 726f 7570 6279 5f63  stance(groupby_c
-00007d90: 6f6c 756d 6e73 5b30 5d2c 6c69 7374 293a  olumns[0],list):
-00007da0: 0d0a 2020 2020 2020 2020 666f 7220 6772  ..        for gr
-00007db0: 6f75 7069 6e67 2069 6e20 6772 6f75 7062  ouping in groupb
-00007dc0: 795f 636f 6c75 6d6e 733a 0d0a 2020 2020  y_columns:..    
-00007dd0: 2020 2020 2020 2020 2320 5573 696e 6720          # Using 
-00007de0: 7468 6520 696e 7465 7276 616c 732c 2064  the intervals, d
-00007df0: 6574 6572 6d69 6e65 2074 6865 2072 616e  etermine the ran
-00007e00: 6765 206f 6620 706f 7373 6962 6c65 206d  ge of possible m
-00007e10: 6178 696d 610d 0a20 2020 2020 2020 2020  axima..         
-00007e20: 2020 2064 6620 3d20 6176 6572 6167 655f     df = average_
-00007e30: 696e 7465 7276 616c 2864 662c 2067 726f  interval(df, gro
-00007e40: 7570 696e 6729 0d0a 2020 2020 2320 456c  uping)..    # El
-00007e50: 7365 2074 6865 2067 726f 7570 6279 5f63  se the groupby_c
-00007e60: 6f6c 756d 6e73 2069 7320 6120 6c69 7374  olumns is a list
-00007e70: 206f 6620 636f 6c75 6d6e 206e 616d 6573   of column names
-00007e80: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
-00007e90: 2020 2020 2064 6620 3d20 6176 6572 6167       df = averag
-00007ea0: 655f 696e 7465 7276 616c 2864 662c 2067  e_interval(df, g
-00007eb0: 726f 7570 6279 5f63 6f6c 756d 6e73 290d  roupby_columns).
-00007ec0: 0a20 2020 200d 0a20 2020 2023 2043 6f6e  .    ..    # Con
-00007ed0: 7665 7274 2074 6865 2069 6e74 6572 7661  vert the interva
-00007ee0: 6c20 666f 7220 7468 6520 6176 6572 6167  l for the averag
-00007ef0: 6520 696e 746f 2063 656e 736f 7220 616e  e into censor an
-00007f00: 6420 6e75 6d65 7269 6320 6e6f 7461 7469  d numeric notati
-00007f10: 6f6e 0d0a 2020 2020 6466 203d 2069 6e74  on..    df = int
-00007f20: 6572 7661 6c5f 746f 5f63 6f6d 706f 6e65  erval_to_compone
-00007f30: 6e74 7328 6466 2c0d 0a20 2020 2020 2020  nts(df,..       
-00007f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007f50: 2020 2020 2020 2020 2066 6f63 7573 5f68           focus_h
-00007f60: 6967 685f 706f 7465 6e74 6961 6c20 3d20  igh_potential = 
-00007f70: 666f 6375 735f 6869 6768 5f70 6f74 656e  focus_high_poten
-00007f80: 7469 616c 2c0d 0a20 2020 2020 2020 2020  tial,..         
+00006490: 2020 2020 2070 7265 6369 7369 6f6e 5f74       precision_t
+000064a0: 6f6c 6572 616e 6365 5f74 6f5f 6472 6f70  olerance_to_drop
+000064b0: 5f63 656e 736f 7220 3d20 7072 6563 6973  _censor = precis
+000064c0: 696f 6e5f 746f 6c65 7261 6e63 655f 746f  ion_tolerance_to
+000064d0: 5f64 726f 705f 6365 6e73 6f72 290d 0a20  _drop_censor).. 
+000064e0: 2020 200d 0a20 2020 2023 2043 7265 6174     ..    # Creat
+000064f0: 6520 696e 7465 7276 616c 206e 6f74 6174  e interval notat
+00006500: 696f 6e20 666f 7220 7468 6520 6d69 6e69  ion for the mini
+00006510: 6d75 6d0d 0a20 2020 2064 6620 3d20 696e  mum..    df = in
+00006520: 7465 7276 616c 5f6e 6f74 6174 696f 6e28  terval_notation(
+00006530: 6466 2c20 7072 6563 6973 696f 6e5f 726f  df, precision_ro
+00006540: 756e 6469 6e67 290d 0a20 2020 200d 0a20  unding)..    .. 
+00006550: 2020 2023 2043 6f6d 6269 6e65 2074 6865     # Combine the
+00006560: 2063 656e 736f 7220 616e 6420 6e75 6d65   censor and nume
+00006570: 7269 6320 636f 6d70 6f6e 656e 7473 2069  ric components i
+00006580: 6e74 6f20 6120 7265 7375 6c74 0d0a 2020  nto a result..  
+00006590: 2020 6466 203d 2063 6f6d 706f 6e65 6e74    df = component
+000065a0: 735f 746f 5f72 6573 756c 7428 6466 2c20  s_to_result(df, 
+000065b0: 6365 6e73 6f72 5f63 6f6c 2c20 6e75 6d65  censor_col, nume
+000065c0: 7269 635f 636f 6c2c 2070 7265 6369 7369  ric_col, precisi
+000065d0: 6f6e 5f72 6f75 6e64 696e 6729 0d0a 2020  on_rounding)..  
+000065e0: 2020 0d0a 2020 2020 2320 4472 6f70 2077    ..    # Drop w
+000065f0: 6f72 6b69 6e67 2063 6f6c 756d 6e73 0d0a  orking columns..
+00006600: 2020 2020 6466 203d 2064 662e 6472 6f70      df = df.drop
+00006610: 2864 662e 6669 6c74 6572 2872 6567 6578  (df.filter(regex
+00006620: 3d27 5f5f 2729 2e63 6f6c 756d 6e73 2c20  ='__').columns, 
+00006630: 6178 6973 3d31 290d 0a20 2020 200d 0a20  axis=1)..    .. 
+00006640: 2020 2023 2052 656f 7264 6572 2063 6f6c     # Reorder col
+00006650: 756d 6e73 0d0a 2020 2020 666f 7220 636f  umns..    for co
+00006660: 6c20 696e 205b 7374 6174 5f63 6f6c 2c72  l in [stat_col,r
+00006670: 6573 756c 745f 636f 6c2c 6365 6e73 6f72  esult_col,censor
+00006680: 5f63 6f6c 2c6e 756d 6572 6963 5f63 6f6c  _col,numeric_col
+00006690: 2c69 6e74 6572 7661 6c5f 636f 6c5d 3a0d  ,interval_col]:.
+000066a0: 0a20 2020 2020 2020 2064 665b 636f 6c5d  .        df[col]
+000066b0: 203d 2064 662e 706f 7028 636f 6c29 0d0a   = df.pop(col)..
+000066c0: 2020 2020 0d0a 2020 2020 7265 7475 726e      ..    return
+000066d0: 2064 660d 0a0d 0a23 2525 2041 7665 7261   df....#%% Avera
+000066e0: 6765 2052 6573 756c 740d 0a0d 0a64 6566  ge Result....def
+000066f0: 2061 7665 7261 6765 5f69 6e74 6572 7661   average_interva
+00006700: 6c28 6466 2c0d 0a20 2020 2020 2020 2020  l(df,..         
+00006710: 2020 2020 2020 2020 2020 2020 6772 6f75              grou
+00006720: 7062 795f 636f 6c75 6d6e 7329 3a0d 0a20  pby_columns):.. 
+00006730: 2020 2027 2727 0d0a 2020 2020 4120 6675     '''..    A fu
+00006740: 6e63 7469 6f6e 2074 6861 7420 616e 616c  nction that anal
+00006750: 7973 6573 2074 6865 2069 6e74 6572 7661  yses the interva
+00006760: 6c20 6e6f 7461 7469 6f6e 2066 6f72 6d20  l notation form 
+00006770: 6f66 2072 6573 756c 7473 2072 6574 7572  of results retur
+00006780: 6e65 640d 0a20 2020 2066 726f 6d20 636f  ned..    from co
+00006790: 6d70 6f6e 656e 7473 5f74 6f5f 696e 7465  mponents_to_inte
+000067a0: 7276 616c 2074 6f20 6765 6e65 7261 7465  rval to generate
+000067b0: 2061 206e 6577 2069 6e74 6572 7661 6c20   a new interval 
+000067c0: 666f 7220 7468 6520 6176 6572 6167 652e  for the average.
+000067d0: 2047 726f 7570 730d 0a20 2020 206f 6620   Groups..    of 
+000067e0: 7265 7375 6c74 7320 6361 6e20 6265 2064  results can be d
+000067f0: 6566 696e 6564 2062 7920 696e 636c 7564  efined by includ
+00006800: 696e 6720 7468 6520 636f 6c75 6d6e 7320  ing the columns 
+00006810: 7468 6174 2073 686f 756c 6420 6265 2075  that should be u
+00006820: 7365 6420 746f 0d0a 2020 2020 6372 6561  sed to..    crea
+00006830: 7465 2067 726f 7570 732e 0d0a 0d0a 2020  te groups.....  
+00006840: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+00006850: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
+00006860: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
+00006870: 0d0a 2020 2020 2020 2020 4461 7461 4672  ..        DataFr
+00006880: 616d 6520 7468 6174 2063 6f6e 7461 696e  ame that contain
+00006890: 7320 7265 7375 6c74 7320 696e 2061 2073  s results in a s
+000068a0: 7065 6369 6669 6320 696e 7465 7276 616c  pecific interval
+000068b0: 206e 6f74 6174 696f 6e2e 0d0a 2020 2020   notation...    
+000068c0: 6772 6f75 7062 795f 636f 6c75 6d6e 7320  groupby_columns 
+000068d0: 3a20 6c69 7374 206f 6620 7374 7269 6e67  : list of string
+000068e0: 730d 0a20 2020 2020 2020 204c 6973 7420  s..        List 
+000068f0: 6f66 2063 6f6c 756d 6e20 6e61 6d65 7320  of column names 
+00006900: 7468 6174 2073 686f 756c 6420 6265 2075  that should be u
+00006910: 7365 6420 746f 2063 7265 6174 6520 6772  sed to create gr
+00006920: 6f75 7073 2e0d 0a0d 0a20 2020 2052 6574  oups.....    Ret
+00006930: 7572 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d  urns..    ------
+00006940: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
+00006950: 4672 616d 650d 0a20 2020 2020 2020 2044  Frame..        D
+00006960: 6174 6146 7261 6d65 2074 6861 7420 6861  ataFrame that ha
+00006970: 7320 7468 6520 696e 7465 7276 616c 2066  s the interval f
+00006980: 6f72 2074 6865 2061 7665 7261 6765 2028  or the average (
+00006990: 666f 7220 6561 6368 2067 726f 7570 2069  for each group i
+000069a0: 660d 0a20 2020 2020 2020 2063 6f6c 756d  f..        colum
+000069b0: 6e20 6e61 6d65 7320 6172 6520 7072 6f76  n names are prov
+000069c0: 6964 6564 2066 6f72 2067 726f 7570 696e  ided for groupin
+000069d0: 6729 0d0a 0d0a 2020 2020 2727 270d 0a20  g)....    '''.. 
+000069e0: 2020 200d 0a20 2020 2023 2043 7265 6174     ..    # Creat
+000069f0: 6520 6120 636f 7079 206f 6620 7468 6520  e a copy of the 
+00006a00: 4461 7461 4672 616d 650d 0a20 2020 2064  DataFrame..    d
+00006a10: 6620 3d20 6466 2e63 6f70 7928 292e 7265  f = df.copy().re
+00006a20: 7365 745f 696e 6465 7828 290d 0a20 2020  set_index()..   
+00006a30: 200d 0a20 2020 2023 2043 7265 6174 6520   ..    # Create 
+00006a40: 636f 6c75 6d6e 2074 6861 7420 696e 6469  column that indi
+00006a50: 6361 7465 7320 7468 6520 6765 6e65 7261  cates the genera
+00006a60: 7465 6420 7374 6174 6973 7469 6320 616e  ted statistic an
+00006a70: 6420 6170 7065 6e64 2074 6f20 6772 6f75  d append to grou
+00006a80: 7069 6e67 206c 6973 740d 0a20 2020 2064  ping list..    d
+00006a90: 665b 7374 6174 5f63 6f6c 5d20 3d20 2741  f[stat_col] = 'A
+00006aa0: 7665 7261 6765 270d 0a20 2020 2067 726f  verage'..    gro
+00006ab0: 7570 6279 5f63 6f6c 756d 6e73 2e61 7070  upby_columns.app
+00006ac0: 656e 6428 7374 6174 5f63 6f6c 290d 0a20  end(stat_col).. 
+00006ad0: 2020 200d 0a20 2020 2023 2043 6861 6e67     ..    # Chang
+00006ae0: 6520 6e6f 7461 7469 6f6e 206f 6620 2743  e notation of 'C
+00006af0: 6c6f 7365 6427 2061 6e64 2027 4f70 656e  losed' and 'Open
+00006b00: 2720 626f 756e 6461 7269 6573 2074 6f20  ' boundaries to 
+00006b10: 3020 616e 6420 312c 2072 6573 7065 6374  0 and 1, respect
+00006b20: 6976 656c 790d 0a20 2020 2023 2054 6865  ively..    # The
+00006b30: 2070 7265 7365 6e63 6520 6f66 2061 6e79   presence of any
+00006b40: 206f 7065 6e20 626f 756e 6461 7269 6573   open boundaries
+00006b50: 206f 6e20 6f6e 6520 7369 6465 2065 6e73   on one side ens
+00006b60: 7572 6520 7468 6174 2074 6865 2069 6e74  ure that the int
+00006b70: 6572 7661 6c20 666f 7220 7468 6520 6176  erval for the av
+00006b80: 6572 6167 6520 6973 2061 6c73 6f0d 0a20  erage is also.. 
+00006b90: 2020 2023 206f 7065 6e20 6f6e 2074 6861     # open on tha
+00006ba0: 7420 7369 6465 0d0a 2020 2020 6466 5b5b  t side..    df[[
+00006bb0: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
+00006bc0: 6c2c 7269 6768 745f 626f 756e 6461 7279  l,right_boundary
+00006bd0: 5f63 6f6c 5d5d 203d 2064 665b 5b6c 6566  _col]] = df[[lef
+00006be0: 745f 626f 756e 6461 7279 5f63 6f6c 2c72  t_boundary_col,r
+00006bf0: 6967 6874 5f62 6f75 6e64 6172 795f 636f  ight_boundary_co
+00006c00: 6c5d 5d2e 7265 706c 6163 6528 5b27 436c  l]].replace(['Cl
+00006c10: 6f73 6564 272c 274f 7065 6e27 5d2c 205b  osed','Open'], [
+00006c20: 302c 315d 290d 0a20 2020 200d 0a20 2020  0,1])..    ..   
+00006c30: 2023 2047 6574 2074 6865 206c 6566 742f   # Get the left/
+00006c40: 7269 6768 7420 626f 756e 6473 206f 6620  right bounds of 
+00006c50: 7468 6520 6176 6572 6167 6520 6279 2061  the average by a
+00006c60: 7665 7261 6769 6e67 2062 6f75 6e64 7320  veraging bounds 
+00006c70: 7769 7468 696e 2074 6865 2067 726f 7570  within the group
+00006c80: 0d0a 2020 2020 2320 4465 7465 726d 696e  ..    # Determin
+00006c90: 6520 7768 6574 6865 7220 616e 7920 4f70  e whether any Op
+00006ca0: 656e 2028 6e6f 7720 7661 6c75 6520 6f66  en (now value of
+00006cb0: 2031 2920 626f 756e 6461 7269 6573 2065   1) boundaries e
+00006cc0: 7869 7374 2e20 4966 2074 6865 7265 2061  xist. If there a
+00006cd0: 7265 0d0a 2020 2020 2320 616e 7920 6f70  re..    # any op
+00006ce0: 656e 2062 6f75 6e64 6172 6965 7320 7573  en boundaries us
+00006cf0: 6564 2069 6e20 7468 6520 6176 6572 6167  ed in the averag
+00006d00: 652c 2074 6865 6e20 7468 6520 7265 7375  e, then the resu
+00006d10: 6c74 696e 6720 6176 6572 6167 6520 7769  lting average wi
+00006d20: 6c6c 2062 6520 6f70 656e 0d0a 2020 2020  ll be open..    
+00006d30: 6466 203d 2064 662e 6772 6f75 7062 7928  df = df.groupby(
+00006d40: 6772 6f75 7062 795f 636f 6c75 6d6e 7329  groupby_columns)
+00006d50: 2e61 6767 282a 2a7b 0d0a 2020 2020 2020  .agg(**{..      
+00006d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d70: 2020 2020 2020 6c65 6674 5f62 6f75 6e64        left_bound
+00006d80: 6172 795f 636f 6c3a 2028 6c65 6674 5f62  ary_col: (left_b
+00006d90: 6f75 6e64 6172 795f 636f 6c2c 2027 6d61  oundary_col, 'ma
+00006da0: 7827 292c 0d0a 2020 2020 2020 2020 2020  x'),..          
+00006db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006dc0: 2020 275f 5f4d 696e 696d 756d 5f5f 273a    '__Minimum__':
+00006dd0: 2028 6c65 6674 5f62 6f75 6e64 5f63 6f6c   (left_bound_col
+00006de0: 2c27 6d69 6e27 292c 0d0a 2020 2020 2020  ,'min'),..      
+00006df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e00: 2020 2020 2020 6c65 6674 5f62 6f75 6e64        left_bound
+00006e10: 5f63 6f6c 3a20 286c 6566 745f 626f 756e  _col: (left_boun
+00006e20: 645f 636f 6c2c 276d 6561 6e27 292c 0d0a  d_col,'mean'),..
+00006e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e40: 2020 2020 2020 2020 2020 2020 7269 6768              righ
+00006e50: 745f 626f 756e 645f 636f 6c3a 2028 7269  t_bound_col: (ri
+00006e60: 6768 745f 626f 756e 645f 636f 6c2c 276d  ght_bound_col,'m
+00006e70: 6561 6e27 292c 0d0a 2020 2020 2020 2020  ean'),..        
+00006e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e90: 2020 2020 275f 5f4d 6178 696d 756d 5f5f      '__Maximum__
+00006ea0: 273a 2028 6c65 6674 5f62 6f75 6e64 5f63  ': (left_bound_c
+00006eb0: 6f6c 2c27 6d61 7827 292c 0d0a 2020 2020  ol,'max'),..    
+00006ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ed0: 2020 2020 2020 2020 7269 6768 745f 626f          right_bo
+00006ee0: 756e 6461 7279 5f63 6f6c 3a20 2872 6967  undary_col: (rig
+00006ef0: 6874 5f62 6f75 6e64 6172 795f 636f 6c2c  ht_boundary_col,
+00006f00: 276d 6178 2729 0d0a 2020 2020 2020 2020  'max')..        
+00006f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f20: 2020 2020 7d29 0d0a 2020 2020 0d0a 2020      })..    ..  
+00006f30: 2020 2320 5265 706c 6163 6520 696e 7465    # Replace inte
+00006f40: 6765 7273 2077 6974 6820 7465 7874 2066  gers with text f
+00006f50: 6f72 2062 6f75 6e64 6172 6965 730d 0a20  or boundaries.. 
+00006f60: 2020 2064 665b 5b6c 6566 745f 626f 756e     df[[left_boun
+00006f70: 6461 7279 5f63 6f6c 2c72 6967 6874 5f62  dary_col,right_b
+00006f80: 6f75 6e64 6172 795f 636f 6c5d 5d20 3d20  oundary_col]] = 
+00006f90: 6466 5b5b 6c65 6674 5f62 6f75 6e64 6172  df[[left_boundar
+00006fa0: 795f 636f 6c2c 7269 6768 745f 626f 756e  y_col,right_boun
+00006fb0: 6461 7279 5f63 6f6c 5d5d 2e72 6570 6c61  dary_col]].repla
+00006fc0: 6365 285b 302c 315d 2c20 5b27 436c 6f73  ce([0,1], ['Clos
+00006fd0: 6564 272c 274f 7065 6e27 5d29 0d0a 2020  ed','Open'])..  
+00006fe0: 2020 0d0a 2020 2020 2320 4d65 616e 7320    ..    # Means 
+00006ff0: 7769 7468 2069 6e66 696e 6974 6520 7661  with infinite va
+00007000: 6c75 6573 2070 726f 6475 6365 206e 616e  lues produce nan
+00007010: 2076 616c 7565 7320 7261 7468 6572 2074   values rather t
+00007020: 6861 6e20 6e70 2e69 6e66 2076 616c 7565  han np.inf value
+00007030: 730d 0a20 2020 2023 2043 6f6e 7665 7274  s..    # Convert
+00007040: 206e 616e 2074 6f20 696e 6620 6f6e 6c79   nan to inf only
+00007050: 2069 6620 696e 6669 6e69 7465 2076 616c   if infinite val
+00007060: 7565 7320 6172 6520 696e 636c 7564 6564  ues are included
+00007070: 2069 6e20 7468 6520 6d65 616e 0d0a 2020   in the mean..  
+00007080: 2020 6466 5b6c 6566 745f 626f 756e 645f    df[left_bound_
+00007090: 636f 6c5d 203d 206e 702e 7768 6572 6528  col] = np.where(
+000070a0: 6466 5b27 5f5f 4d69 6e69 6d75 6d5f 5f27  df['__Minimum__'
+000070b0: 5d20 3d3d 202d 6e70 2e69 6e66 2c20 2d6e  ] == -np.inf, -n
+000070c0: 702e 696e 662c 2064 665b 6c65 6674 5f62  p.inf, df[left_b
+000070d0: 6f75 6e64 5f63 6f6c 5d29 0d0a 2020 2020  ound_col])..    
+000070e0: 6466 5b72 6967 6874 5f62 6f75 6e64 5f63  df[right_bound_c
+000070f0: 6f6c 5d20 3d20 6e70 2e77 6865 7265 2864  ol] = np.where(d
+00007100: 665b 275f 5f4d 6178 696d 756d 5f5f 275d  f['__Maximum__']
+00007110: 203d 3d20 6e70 2e69 6e66 2c20 6e70 2e69   == np.inf, np.i
+00007120: 6e66 2c20 6466 5b72 6967 6874 5f62 6f75  nf, df[right_bou
+00007130: 6e64 5f63 6f6c 5d29 0d0a 2020 2020 0d0a  nd_col])..    ..
+00007140: 2020 2020 2320 5265 7365 7420 696e 6465      # Reset inde
+00007150: 780d 0a20 2020 2064 6620 3d20 6466 2e72  x..    df = df.r
+00007160: 6573 6574 5f69 6e64 6578 2829 0d0a 2020  eset_index()..  
+00007170: 2020 0d0a 2020 2020 7265 7475 726e 2064    ..    return d
+00007180: 660d 0a0d 0a64 6566 2061 7665 7261 6765  f....def average
+00007190: 2864 662c 0d0a 2020 2020 2020 2020 2020  (df,..          
+000071a0: 2020 7265 7375 6c74 5f63 6f6c 2c0d 0a20    result_col,.. 
+000071b0: 2020 2020 2020 2020 2020 2067 726f 7570             group
+000071c0: 6279 5f63 6f6c 756d 6e73 203d 204e 6f6e  by_columns = Non
+000071d0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+000071e0: 666f 6375 735f 6869 6768 5f70 6f74 656e  focus_high_poten
+000071f0: 7469 616c 203d 2054 7275 652c 0d0a 2020  tial = True,..  
+00007200: 2020 2020 2020 2020 2020 696e 636c 7564            includ
+00007210: 655f 6e65 6761 7469 7665 5f69 6e74 6572  e_negative_inter
+00007220: 7661 6c20 3d20 4661 6c73 652c 0d0a 2020  val = False,..  
+00007230: 2020 2020 2020 2020 2020 7072 6563 6973            precis
+00007240: 696f 6e5f 746f 6c65 7261 6e63 655f 746f  ion_tolerance_to
+00007250: 5f64 726f 705f 6365 6e73 6f72 203d 2030  _drop_censor = 0
+00007260: 2e32 352c 0d0a 2020 2020 2020 2020 2020  .25,..          
+00007270: 2020 7072 6563 6973 696f 6e5f 726f 756e    precision_roun
+00007280: 6469 6e67 203d 2054 7275 6529 3a0d 0a20  ding = True):.. 
+00007290: 2020 2027 2727 0d0a 2020 2020 4120 6675     '''..    A fu
+000072a0: 6e63 7469 6f6e 2074 6861 7420 636f 6d62  nction that comb
+000072b0: 696e 6573 2074 6865 2072 656c 6576 616e  ines the relevan
+000072c0: 7420 6176 6572 6167 6520 616e 6420 7574  t average and ut
+000072d0: 696c 6974 7920 6675 6e63 7469 6f6e 7320  ility functions 
+000072e0: 746f 0d0a 2020 2020 6765 6e65 7261 7465  to..    generate
+000072f0: 2074 6865 2061 7665 7261 6765 2072 6573   the average res
+00007300: 756c 7473 2066 6f72 2067 726f 7570 7320  ults for groups 
+00007310: 7769 7468 696e 2061 2044 6174 6146 7261  within a DataFra
+00007320: 6d65 2e0d 0a0d 0a20 2020 2050 6172 616d  me.....    Param
+00007330: 6574 6572 730d 0a20 2020 202d 2d2d 2d2d  eters..    -----
+00007340: 2d2d 2d2d 2d0d 0a20 2020 2064 6620 3a20  -----..    df : 
+00007350: 4461 7461 4672 616d 650d 0a20 2020 2020  DataFrame..     
+00007360: 2020 2044 6174 6146 7261 6d65 2074 6861     DataFrame tha
+00007370: 7420 636f 6e74 6169 6e73 2063 656e 736f  t contains censo
+00007380: 7265 6420 6f72 2075 6e63 656e 736f 7265  red or uncensore
+00007390: 6420 7265 7375 6c74 730d 0a20 2020 2072  d results..    r
+000073a0: 6573 756c 745f 636f 6c20 3a20 7374 7269  esult_col : stri
+000073b0: 6e67 0d0a 2020 2020 2020 2020 5468 6520  ng..        The 
+000073c0: 636f 6c75 6d6e 206e 616d 6520 666f 7220  column name for 
+000073d0: 7468 6520 636f 6c75 6d6e 2074 6861 7420  the column that 
+000073e0: 636f 6e74 6169 6e20 7468 6520 7265 7375  contain the resu
+000073f0: 6c74 7320 6173 2074 6578 742e 0d0a 2020  lts as text...  
+00007400: 2020 2020 2020 4f6e 6c79 2066 6f75 7220        Only four 
+00007410: 706f 7373 6962 6c65 2063 656e 736f 7273  possible censors
+00007420: 2073 686f 756c 6420 6265 2075 7365 6420   should be used 
+00007430: 283c 2ce2 89a4 2ce2 89a5 2c3e 292e 0d0a  (<,...,...,>)...
+00007440: 2020 2020 6772 6f75 7062 795f 636f 6c75      groupby_colu
+00007450: 6d6e 7320 3a20 6c69 7374 7320 6f66 2073  mns : lists of s
+00007460: 7472 696e 6773 2028 6f72 206c 6973 7420  trings (or list 
+00007470: 6f66 206c 6973 7473 292c 206f 7074 696f  of lists), optio
+00007480: 6e61 6c0d 0a20 2020 2020 2020 204c 6973  nal..        Lis
+00007490: 7420 6f66 2063 6f6c 756d 6e20 6e61 6d65  t of column name
+000074a0: 7320 7468 6174 2073 686f 756c 6420 6265  s that should be
+000074b0: 2075 7365 6420 746f 2063 7265 6174 6520   used to create 
+000074c0: 6772 6f75 7073 2e20 416e 2061 7665 7261  groups. An avera
+000074d0: 6765 0d0a 2020 2020 2020 2020 7769 6c6c  ge..        will
+000074e0: 2062 6520 666f 756e 6420 7769 7468 696e   be found within
+000074f0: 2065 6163 6820 6772 6f75 702e 204d 756c   each group. Mul
+00007500: 7469 706c 6520 6c69 7374 7320 6361 6e20  tiple lists can 
+00007510: 6265 2073 7570 706c 6965 6420 746f 0d0a  be supplied to..
+00007520: 2020 2020 2020 2020 7065 7266 6f72 6d20          perform 
+00007530: 7365 7175 656e 7469 616c 2061 7665 7261  sequential avera
+00007540: 6769 6e67 2062 6566 6f72 6520 636f 6e76  ging before conv
+00007550: 6572 7469 6e67 2069 6e74 6572 7661 6c73  erting intervals
+00007560: 2074 6f20 6120 7265 7375 6c74 2e0d 0a20   to a result... 
+00007570: 2020 2020 2020 2054 6865 2064 6566 6175         The defau
+00007580: 6c74 2069 7320 4e6f 6e65 2e0d 0a20 2020  lt is None...   
+00007590: 2066 6f63 7573 5f68 6967 685f 706f 7465   focus_high_pote
+000075a0: 6e74 6961 6c20 3a20 626f 6f6c 6561 6e2c  ntial : boolean,
+000075b0: 206f 7074 696f 6e61 6c0d 0a20 2020 2020   optional..     
+000075c0: 2020 2049 6620 5472 7565 2c20 7468 656e     If True, then
+000075d0: 2069 6e66 6f72 6d61 7469 6f6e 206f 6e20   information on 
+000075e0: 7468 6520 6869 6768 6573 7420 706f 7465  the highest pote
+000075f0: 6e74 6961 6c20 7265 7375 6c74 2077 696c  ntial result wil
+00007600: 6c20 6265 0d0a 2020 2020 2020 2020 666f  l be..        fo
+00007610: 6375 7365 6420 6f76 6572 2074 6865 206c  cused over the l
+00007620: 6f77 6573 7420 706f 7465 6e74 6961 6c20  owest potential 
+00007630: 7265 7375 6c74 2e0d 0a20 2020 2069 6e63  result...    inc
+00007640: 6c75 6465 5f6e 6567 6174 6976 655f 696e  lude_negative_in
+00007650: 7465 7276 616c 203a 2062 6f6f 6c65 616e  terval : boolean
+00007660: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
+00007670: 2020 2020 4966 2054 7275 652c 2074 6865      If True, the
+00007680: 6e20 616c 6c20 706f 7369 7469 7665 2061  n all positive a
+00007690: 6e64 206e 6567 6174 6976 6520 7661 6c75  nd negative valu
+000076a0: 6573 2061 7265 2063 6f6e 7369 6465 7265  es are considere
+000076b0: 640d 0a20 2020 2020 2020 2065 2e67 2e2c  d..        e.g.,
+000076c0: 203c 302e 3520 776f 756c 6420 6265 2063   <0.5 would be c
+000076d0: 6f6e 7665 7274 6564 2074 6f20 282d 6e70  onverted to (-np
+000076e0: 2e69 6e66 2c35 292e 0d0a 2020 2020 2020  .inf,5)...      
+000076f0: 2020 4966 2046 616c 7365 2c20 7468 656e    If False, then
+00007700: 206f 6e6c 7920 6e6f 6e2d 6e65 6761 7469   only non-negati
+00007710: 7665 2076 616c 7565 7320 6172 6520 636f  ve values are co
+00007720: 6e73 6964 6572 6564 0d0a 2020 2020 2020  nsidered..      
+00007730: 2020 652e 672e 2c20 3c30 2e35 2077 6f75    e.g., <0.5 wou
+00007740: 6c64 2062 6520 636f 6e76 6572 7465 6420  ld be converted 
+00007750: 746f 205b 302c 3529 2e0d 0a20 2020 2020  to [0,5)...     
+00007760: 2020 2054 6869 7320 7365 7474 696e 6720     This setting 
+00007770: 6f6e 6c79 2061 6666 6563 7473 2072 6573  only affects res
+00007780: 756c 7473 2069 6620 666f 6375 735f 6869  ults if focus_hi
+00007790: 6768 5f70 6f74 656e 7469 616c 2069 7320  gh_potential is 
+000077a0: 4661 6c73 652e 0d0a 2020 2020 2020 2020  False...        
+000077b0: 5468 6520 6465 6661 756c 7420 6973 2046  The default is F
+000077c0: 616c 7365 2e0d 0a20 2020 2070 7265 6369  alse...    preci
+000077d0: 7369 6f6e 5f74 6f6c 6572 616e 6365 5f74  sion_tolerance_t
+000077e0: 6f5f 6472 6f70 5f63 656e 736f 7220 3a20  o_drop_censor : 
+000077f0: 666c 6f61 742c 206f 7074 696f 6e61 6c0d  float, optional.
+00007800: 0a20 2020 2020 2020 2054 6872 6573 686f  .        Thresho
+00007810: 6c64 2066 6f72 2072 6570 6f72 7469 6e67  ld for reporting
+00007820: 2063 656e 736f 7265 6420 7673 206e 6f6e   censored vs non
+00007830: 2d63 656e 736f 7265 6420 7265 7375 6c74  -censored result
+00007840: 732e 0d0a 2020 2020 2020 2020 5573 696e  s...        Usin
+00007850: 6720 7468 6520 6465 6661 756c 742c 2061  g the default, a
+00007860: 2072 6573 756c 7420 7468 6174 2069 7320   result that is 
+00007870: 6b6e 6f77 6e20 746f 2062 6520 696e 2074  known to be in t
+00007880: 6865 2069 6e74 6572 7661 6c20 2830 2e33  he interval (0.3
+00007890: 2c20 302e 3529 0d0a 2020 2020 2020 2020  , 0.5)..        
+000078a0: 776f 756c 6420 6265 2072 6574 7572 6e65  would be returne
+000078b0: 6420 6173 2030 2e34 2c20 7768 6572 6561  d as 0.4, wherea
+000078c0: 7320 6120 746f 6c65 7261 6e63 6520 6f66  s a tolerance of
+000078d0: 2030 2077 6f75 6c64 2079 6965 6c64 2061   0 would yield a
+000078e0: 0d0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
+000078f0: 206f 6620 3c30 2e35 206f 7220 3e30 2e33   of <0.5 or >0.3
+00007900: 2064 6570 656e 6469 6e67 206f 6e20 7468   depending on th
+00007910: 6520 7661 6c75 6520 6f66 2066 6f63 7573  e value of focus
+00007920: 5f68 6967 6865 7374 5f70 6f74 656e 7469  _highest_potenti
+00007930: 616c 2e0d 0a20 2020 2020 2020 2054 6865  al...        The
+00007940: 2064 6566 6175 6c74 2069 7320 302e 3235   default is 0.25
+00007950: 2e0d 0a20 2020 2070 7265 6369 7369 6f6e  ...    precision
+00007960: 5f72 6f75 6e64 696e 6720 3a20 626f 6f6c  _rounding : bool
+00007970: 6561 6e2c 206f 7074 696f 6e61 6c0d 0a20  ean, optional.. 
+00007980: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+00007990: 6120 726f 756e 6469 6e67 206d 6574 686f  a rounding metho
+000079a0: 6420 6973 2061 7070 6c69 6564 2074 6f20  d is applied to 
+000079b0: 726f 756e 6420 7265 7375 6c74 7320 746f  round results to
+000079c0: 2068 6176 6520 6e6f 206d 6f72 650d 0a20   have no more.. 
+000079d0: 2020 2020 2020 2064 6563 696d 616c 7320         decimals 
+000079e0: 7468 616e 2077 6861 7420 6361 6e20 6265  than what can be
+000079f0: 206d 6561 7375 7265 642e 0d0a 2020 2020   measured...    
+00007a00: 2020 2020 5468 6520 6465 6661 756c 7420      The default 
+00007a10: 6973 2054 7275 652e 0d0a 0d0a 2020 2020  is True.....    
+00007a20: 5265 7475 726e 730d 0a20 2020 202d 2d2d  Returns..    ---
+00007a30: 2d2d 2d2d 0d0a 2020 2020 6466 203a 2044  ----..    df : D
+00007a40: 6174 6146 7261 6d65 0d0a 2020 2020 2020  ataFrame..      
+00007a50: 2020 4461 7461 4672 616d 6520 7468 6174    DataFrame that
+00007a60: 2063 6f6e 7461 696e 7320 6361 6c63 756c   contains calcul
+00007a70: 6174 6564 2061 7665 7261 6765 730d 0a0d  ated averages...
+00007a80: 0a20 2020 2027 2727 0d0a 2020 2020 0d0a  .    '''..    ..
+00007a90: 2020 2020 2320 4372 6561 7465 2061 2063      # Create a c
+00007aa0: 6f70 7920 6f66 2074 6865 2044 6174 6146  opy of the DataF
+00007ab0: 7261 6d65 0d0a 2020 2020 6466 203d 2064  rame..    df = d
+00007ac0: 662e 636f 7079 2829 0d0a 2020 2020 0d0a  f.copy()..    ..
+00007ad0: 2020 2020 2320 5370 6c69 7420 7468 6520      # Split the 
+00007ae0: 7265 7375 6c74 2069 6e74 6f20 6365 6e73  result into cens
+00007af0: 6f72 2061 6e64 206e 756d 6572 6963 2063  or and numeric c
+00007b00: 6f6d 706f 6e65 6e74 730d 0a20 2020 2064  omponents..    d
+00007b10: 6620 3d20 7265 7375 6c74 5f74 6f5f 636f  f = result_to_co
+00007b20: 6d70 6f6e 656e 7473 2864 662c 7265 7375  mponents(df,resu
+00007b30: 6c74 5f63 6f6c 290d 0a20 2020 200d 0a20  lt_col)..    .. 
+00007b40: 2020 2023 2043 6f6e 7665 7274 2074 6865     # Convert the
+00007b50: 2072 6573 756c 7473 2066 726f 6d20 6365   results from ce
+00007b60: 6e73 6f72 2061 6e64 206e 756d 6572 6963  nsor and numeric
+00007b70: 2063 6f6d 706f 6e65 6e74 7320 746f 2061   components to a
+00007b80: 6e20 696e 7465 7276 616c 2072 6570 7265  n interval repre
+00007b90: 7365 6e74 6174 696f 6e0d 0a20 2020 2064  sentation..    d
+00007ba0: 6620 3d20 636f 6d70 6f6e 656e 7473 5f74  f = components_t
+00007bb0: 6f5f 696e 7465 7276 616c 2864 662c 2069  o_interval(df, i
+00007bc0: 6e63 6c75 6465 5f6e 6567 6174 6976 655f  nclude_negative_
+00007bd0: 696e 7465 7276 616c 290d 0a20 2020 200d  interval)..    .
+00007be0: 0a20 2020 2023 2055 7369 6e67 2074 6865  .    # Using the
+00007bf0: 2069 6e74 6572 7661 6c73 2c20 6465 7465   intervals, dete
+00007c00: 726d 696e 6520 7468 6520 7261 6e67 6520  rmine the range 
+00007c10: 6f66 2070 6f73 7369 626c 6520 6176 6572  of possible aver
+00007c20: 6167 6573 0d0a 2020 2020 0d0a 2020 2020  ages..    ..    
+00007c30: 2320 4966 2074 6865 7265 2061 7265 206e  # If there are n
+00007c40: 6f20 6772 6f75 7062 792d 636f 6c75 6d6e  o groupby-column
+00007c50: 732c 2074 6865 6e20 7461 6b65 2061 7665  s, then take ave
+00007c60: 7261 6765 206f 6620 616c 6c20 7265 7375  rage of all resu
+00007c70: 6c74 730d 0a20 2020 2069 6620 6e6f 7420  lts..    if not 
+00007c80: 6772 6f75 7062 795f 636f 6c75 6d6e 733a  groupby_columns:
+00007c90: 0d0a 2020 2020 2020 2020 6466 203d 2061  ..        df = a
+00007ca0: 7665 7261 6765 5f69 6e74 6572 7661 6c28  verage_interval(
+00007cb0: 6466 2c20 6772 6f75 7062 795f 636f 6c75  df, groupby_colu
+00007cc0: 6d6e 733d 5b5d 290d 0a20 2020 2023 2049  mns=[])..    # I
+00007cd0: 6620 7468 6520 6772 6f75 7062 795f 636f  f the groupby_co
+00007ce0: 6c75 6d6e 7320 6973 2061 206c 6973 7420  lumns is a list 
+00007cf0: 6f66 206c 6973 7473 2c20 7468 656e 2070  of lists, then p
+00007d00: 6572 666f 726d 206d 756c 7469 706c 6520  erform multiple 
+00007d10: 6176 6572 6167 6573 0d0a 2020 2020 656c  averages..    el
+00007d20: 6966 2069 7369 6e73 7461 6e63 6528 6772  if isinstance(gr
+00007d30: 6f75 7062 795f 636f 6c75 6d6e 735b 305d  oupby_columns[0]
+00007d40: 2c6c 6973 7429 3a0d 0a20 2020 2020 2020  ,list):..       
+00007d50: 2066 6f72 2067 726f 7570 696e 6720 696e   for grouping in
+00007d60: 2067 726f 7570 6279 5f63 6f6c 756d 6e73   groupby_columns
+00007d70: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+00007d80: 2055 7369 6e67 2074 6865 2069 6e74 6572   Using the inter
+00007d90: 7661 6c73 2c20 6465 7465 726d 696e 6520  vals, determine 
+00007da0: 7468 6520 7261 6e67 6520 6f66 2070 6f73  the range of pos
+00007db0: 7369 626c 6520 6d61 7869 6d61 0d0a 2020  sible maxima..  
+00007dc0: 2020 2020 2020 2020 2020 6466 203d 2061            df = a
+00007dd0: 7665 7261 6765 5f69 6e74 6572 7661 6c28  verage_interval(
+00007de0: 6466 2c20 6772 6f75 7069 6e67 290d 0a20  df, grouping).. 
+00007df0: 2020 2023 2045 6c73 6520 7468 6520 6772     # Else the gr
+00007e00: 6f75 7062 795f 636f 6c75 6d6e 7320 6973  oupby_columns is
+00007e10: 2061 206c 6973 7420 6f66 2063 6f6c 756d   a list of colum
+00007e20: 6e20 6e61 6d65 730d 0a20 2020 2065 6c73  n names..    els
+00007e30: 653a 0d0a 2020 2020 2020 2020 6466 203d  e:..        df =
+00007e40: 2061 7665 7261 6765 5f69 6e74 6572 7661   average_interva
+00007e50: 6c28 6466 2c20 6772 6f75 7062 795f 636f  l(df, groupby_co
+00007e60: 6c75 6d6e 7329 0d0a 2020 2020 0d0a 2020  lumns)..    ..  
+00007e70: 2020 2320 436f 6e76 6572 7420 7468 6520    # Convert the 
+00007e80: 696e 7465 7276 616c 2066 6f72 2074 6865  interval for the
+00007e90: 2061 7665 7261 6765 2069 6e74 6f20 6365   average into ce
+00007ea0: 6e73 6f72 2061 6e64 206e 756d 6572 6963  nsor and numeric
+00007eb0: 206e 6f74 6174 696f 6e0d 0a20 2020 2064   notation..    d
+00007ec0: 6620 3d20 696e 7465 7276 616c 5f74 6f5f  f = interval_to_
+00007ed0: 636f 6d70 6f6e 656e 7473 2864 662c 0d0a  components(df,..
+00007ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007f00: 666f 6375 735f 6869 6768 5f70 6f74 656e  focus_high_poten
+00007f10: 7469 616c 203d 2066 6f63 7573 5f68 6967  tial = focus_hig
+00007f20: 685f 706f 7465 6e74 6961 6c2c 0d0a 2020  h_potential,..  
+00007f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007f40: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00007f50: 636c 7564 655f 6e65 6761 7469 7665 5f69  clude_negative_i
+00007f60: 6e74 6572 7661 6c20 3d20 696e 636c 7564  nterval = includ
+00007f70: 655f 6e65 6761 7469 7665 5f69 6e74 6572  e_negative_inter
+00007f80: 7661 6c2c 0d0a 2020 2020 2020 2020 2020  val,..          
 00007f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007fa0: 2020 2020 2020 2069 6e63 6c75 6465 5f6e         include_n
-00007fb0: 6567 6174 6976 655f 696e 7465 7276 616c  egative_interval
-00007fc0: 203d 2069 6e63 6c75 6465 5f6e 6567 6174   = include_negat
-00007fd0: 6976 655f 696e 7465 7276 616c 2c0d 0a20  ive_interval,.. 
-00007fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ff0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00008000: 7265 6369 7369 6f6e 5f74 6f6c 6572 616e  recision_toleran
-00008010: 6365 5f74 6f5f 6472 6f70 5f63 656e 736f  ce_to_drop_censo
-00008020: 7220 3d20 7072 6563 6973 696f 6e5f 746f  r = precision_to
-00008030: 6c65 7261 6e63 655f 746f 5f64 726f 705f  lerance_to_drop_
-00008040: 6365 6e73 6f72 290d 0a20 2020 200d 0a20  censor)..    .. 
-00008050: 2020 2023 2043 7265 6174 6520 696e 7465     # Create inte
-00008060: 7276 616c 206e 6f74 6174 696f 6e20 666f  rval notation fo
-00008070: 7220 7468 6520 6176 6572 6167 650d 0a20  r the average.. 
-00008080: 2020 2064 6620 3d20 696e 7465 7276 616c     df = interval
-00008090: 5f6e 6f74 6174 696f 6e28 6466 2c20 7072  _notation(df, pr
-000080a0: 6563 6973 696f 6e5f 726f 756e 6469 6e67  ecision_rounding
-000080b0: 290d 0a20 2020 200d 0a20 2020 2023 2043  )..    ..    # C
-000080c0: 6f6d 6269 6e65 2074 6865 2063 656e 736f  ombine the censo
-000080d0: 7220 616e 6420 6e75 6d65 7269 6320 636f  r and numeric co
-000080e0: 6d70 6f6e 656e 7473 2069 6e74 6f20 6120  mponents into a 
-000080f0: 7265 7375 6c74 0d0a 2020 2020 6466 203d  result..    df =
-00008100: 2063 6f6d 706f 6e65 6e74 735f 746f 5f72   components_to_r
-00008110: 6573 756c 7428 6466 2c20 7072 6563 6973  esult(df, precis
-00008120: 696f 6e5f 726f 756e 6469 6e67 290d 0a20  ion_rounding).. 
-00008130: 2020 200d 0a20 2020 2023 2044 726f 7020     ..    # Drop 
-00008140: 776f 726b 696e 6720 636f 6c75 6d6e 730d  working columns.
-00008150: 0a20 2020 2064 6620 3d20 6466 2e64 726f  .    df = df.dro
-00008160: 7028 6466 2e66 696c 7465 7228 7265 6765  p(df.filter(rege
-00008170: 783d 275f 5f27 292e 636f 6c75 6d6e 732c  x='__').columns,
-00008180: 2061 7869 733d 3129 0d0a 2020 2020 0d0a   axis=1)..    ..
-00008190: 2020 2020 2320 5265 6f72 6465 7220 636f      # Reorder co
-000081a0: 6c75 6d6e 730d 0a20 2020 2066 6f72 2063  lumns..    for c
-000081b0: 6f6c 2069 6e20 5b73 7461 745f 636f 6c2c  ol in [stat_col,
-000081c0: 7265 7375 6c74 5f63 6f6c 2c63 656e 736f  result_col,censo
-000081d0: 725f 636f 6c2c 6e75 6d65 7269 635f 636f  r_col,numeric_co
-000081e0: 6c2c 696e 7465 7276 616c 5f63 6f6c 5d3a  l,interval_col]:
-000081f0: 0d0a 2020 2020 2020 2020 6466 5b63 6f6c  ..        df[col
-00008200: 5d20 3d20 6466 2e70 6f70 2863 6f6c 290d  ] = df.pop(col).
-00008210: 0a20 2020 200d 0a20 2020 2072 6574 7572  .    ..    retur
-00008220: 6e20 6466 0d0a 0d0a 2325 2520 5065 7263  n df....#%% Perc
-00008230: 656e 7469 6c65 2052 6573 756c 740d 0a0d  entile Result...
-00008240: 0a64 6566 2070 6572 6365 6e74 696c 655f  .def percentile_
-00008250: 696e 7465 7276 616c 2864 662c 0d0a 2020  interval(df,..  
-00008260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008270: 2020 2020 2020 6772 6f75 7062 795f 636f        groupby_co
-00008280: 6c75 6d6e 732c 0d0a 2020 2020 2020 2020  lumns,..        
-00008290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000082a0: 7065 7263 656e 7469 6c65 2c0d 0a20 2020  percentile,..   
-000082b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000082c0: 2020 2020 206d 6574 686f 6420 3d20 2768       method = 'h
-000082d0: 617a 656e 272c 293a 0d0a 2020 2020 2727  azen',):..    ''
-000082e0: 270d 0a20 2020 2041 2066 756e 6374 696f  '..    A functio
-000082f0: 6e20 7468 6174 2061 6e61 6c79 7365 7320  n that analyses 
-00008300: 7468 6520 696e 7465 7276 616c 206e 6f74  the interval not
-00008310: 6174 696f 6e20 666f 726d 206f 6620 7265  ation form of re
-00008320: 7375 6c74 7320 7265 7475 726e 6564 0d0a  sults returned..
-00008330: 2020 2020 6672 6f6d 2063 6f6d 706f 6e65      from compone
-00008340: 6e74 735f 746f 5f69 6e74 6572 7661 6c20  nts_to_interval 
-00008350: 746f 2067 656e 6572 6174 6520 6120 6e65  to generate a ne
-00008360: 7720 696e 7465 7276 616c 2066 6f72 2070  w interval for p
-00008370: 6572 6365 6e74 696c 6573 2e20 4772 6f75  ercentiles. Grou
-00008380: 7073 0d0a 2020 2020 6f66 2072 6573 756c  ps..    of resul
-00008390: 7473 2063 616e 2062 6520 6465 6669 6e65  ts can be define
-000083a0: 6420 6279 2069 6e63 6c75 6469 6e67 2074  d by including t
-000083b0: 6865 2063 6f6c 756d 6e73 2074 6861 7420  he columns that 
-000083c0: 7368 6f75 6c64 2062 6520 7573 6564 2074  should be used t
-000083d0: 6f0d 0a20 2020 2063 7265 6174 6520 6772  o..    create gr
-000083e0: 6f75 7073 2e0d 0a0d 0a20 2020 2050 6172  oups.....    Par
-000083f0: 616d 6574 6572 730d 0a20 2020 202d 2d2d  ameters..    ---
-00008400: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6620  -------..    df 
-00008410: 3a20 4461 7461 4672 616d 650d 0a20 2020  : DataFrame..   
-00008420: 2020 2020 2044 6174 6146 7261 6d65 2074       DataFrame t
-00008430: 6861 7420 636f 6e74 6169 6e73 2072 6573  hat contains res
-00008440: 756c 7473 2069 6e20 6120 7370 6563 6966  ults in a specif
-00008450: 6963 2069 6e74 6572 7661 6c20 6e6f 7461  ic interval nota
-00008460: 7469 6f6e 2e0d 0a20 2020 2067 726f 7570  tion...    group
-00008470: 6279 5f63 6f6c 756d 6e73 203a 206c 6973  by_columns : lis
-00008480: 7420 6f66 2073 7472 696e 6773 0d0a 2020  t of strings..  
-00008490: 2020 2020 2020 4c69 7374 206f 6620 636f        List of co
-000084a0: 6c75 6d6e 206e 616d 6573 2074 6861 7420  lumn names that 
-000084b0: 7368 6f75 6c64 2062 6520 7573 6564 2074  should be used t
-000084c0: 6f20 6372 6561 7465 2067 726f 7570 732e  o create groups.
-000084d0: 0d0a 2020 2020 7065 7263 656e 7469 6c65  ..    percentile
-000084e0: 203a 2066 6c6f 6174 0d0a 2020 2020 2020   : float..      
-000084f0: 2020 5468 6520 6465 7369 7265 6420 7065    The desired pe
-00008500: 7263 656e 7469 6c65 2e20 5661 6c75 6573  rcentile. Values
-00008510: 2073 686f 756c 6420 6265 2062 6574 7765   should be betwe
-00008520: 656e 2030 2061 6e64 2031 3030 2e0d 0a20  en 0 and 100... 
-00008530: 2020 206d 6574 686f 6420 3a20 7374 7269     method : stri
-00008540: 6e67 0d0a 2020 2020 2020 2020 5468 6520  ng..        The 
-00008550: 7065 7263 656e 7469 6c65 206d 6574 686f  percentile metho
-00008560: 642e 2054 6865 206f 7074 696f 6e73 2061  d. The options a
-00008570: 6e64 2064 6566 696e 6974 696f 6e73 2063  nd definitions c
-00008580: 6f6d 6520 6672 6f6d 3a0d 0a20 2020 2020  ome from:..     
-00008590: 2020 2020 2020 2068 7474 7073 3a2f 2f65         https://e
-000085a0: 6e76 6972 6f6e 6d65 6e74 2e67 6f76 742e  nvironment.govt.
-000085b0: 6e7a 2f61 7373 6574 732f 5075 626c 6963  nz/assets/Public
-000085c0: 6174 696f 6e73 2f46 696c 6573 2f68 617a  ations/Files/haz
-000085d0: 656e 2d70 6572 6365 6e74 696c 652d 6361  en-percentile-ca
-000085e0: 6c63 756c 6174 6f72 2d32 2e78 6c73 0d0a  lculator-2.xls..
-000085f0: 2020 2020 2020 2020 2020 2020 4f70 7469              Opti
-00008600: 6f6e 7320 696e 636c 7564 6520 7468 6520  ons include the 
-00008610: 666f 6c6c 6f77 696e 672c 206f 7264 6572  following, order
-00008620: 6564 2066 726f 6d20 6c61 7267 6573 7420  ed from largest 
-00008630: 746f 2073 6d61 6c6c 6573 7420 7265 7375  to smallest resu
-00008640: 6c74 2e0d 0a20 2020 2020 2020 2020 2020  lt...           
-00008650: 202d 2077 6569 6261 6c6c 0d0a 2020 2020   - weiball..    
-00008660: 2020 2020 2020 2020 2d20 7475 6b65 790d          - tukey.
-00008670: 0a20 2020 2020 2020 2020 2020 202d 2062  .            - b
-00008680: 6c6f 6d0d 0a20 2020 2020 2020 2020 2020  lom..           
-00008690: 202d 2068 617a 656e 0d0a 2020 2020 2020   - hazen..      
-000086a0: 2020 2020 2020 2d20 6578 6365 6c0d 0a20        - excel.. 
-000086b0: 2020 2020 2020 2054 6865 2064 6566 6175         The defau
-000086c0: 6c74 2069 7320 6861 7a65 6e2e 0d0a 0d0a  lt is hazen.....
-000086d0: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
-000086e0: 202d 2d2d 2d2d 2d2d 0d0a 2020 2020 6466   -------..    df
-000086f0: 203a 2044 6174 6146 7261 6d65 0d0a 2020   : DataFrame..  
-00008700: 2020 2020 2020 4461 7461 4672 616d 6520        DataFrame 
-00008710: 7468 6174 2068 6173 2074 6865 2069 6e74  that has the int
-00008720: 6572 7661 6c20 666f 7220 7468 6520 7065  erval for the pe
-00008730: 7263 656e 7469 6c65 2028 666f 7220 6561  rcentile (for ea
-00008740: 6368 2067 726f 7570 2069 660d 0a20 2020  ch group if..   
-00008750: 2020 2020 2063 6f6c 756d 6e20 6e61 6d65       column name
-00008760: 7320 6172 6520 7072 6f76 6964 6564 2066  s are provided f
-00008770: 6f72 2067 726f 7570 696e 6729 0d0a 0d0a  or grouping)....
-00008780: 2020 2020 2727 270d 0a20 2020 200d 0a20      '''..    .. 
-00008790: 2020 2023 2043 7265 6174 6520 6120 636f     # Create a co
-000087a0: 7079 206f 6620 7468 6520 4461 7461 4672  py of the DataFr
-000087b0: 616d 650d 0a20 2020 2064 6620 3d20 6466  ame..    df = df
-000087c0: 2e63 6f70 7928 292e 7265 7365 745f 696e  .copy().reset_in
-000087d0: 6465 7828 290d 0a20 2020 200d 0a20 2020  dex()..    ..   
-000087e0: 2023 2043 6865 636b 2074 6865 2070 6572   # Check the per
-000087f0: 6365 6e74 696c 6520 6973 2062 6574 7765  centile is betwe
-00008800: 656e 2030 2061 6e64 2031 0d0a 2020 2020  en 0 and 1..    
-00008810: 6966 2070 6572 6365 6e74 696c 6520 3c20  if percentile < 
-00008820: 3020 6f72 2070 6572 6365 6e74 696c 6520  0 or percentile 
-00008830: 3e20 3130 303a 0d0a 2020 2020 2020 2020  > 100:..        
-00008840: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-00008850: 6627 5065 7263 656e 7469 6c65 206f 7574  f'Percentile out
-00008860: 206f 6620 7261 6e67 652e 2041 7474 656d   of range. Attem
-00008870: 7074 6564 2070 6572 6365 6e74 696c 653a  pted percentile:
-00008880: 207b 7065 7263 656e 7469 6c65 7d27 290d   {percentile}').
-00008890: 0a20 2020 200d 0a20 2020 2023 2043 7265  .    ..    # Cre
-000088a0: 6174 6520 636f 6c75 6d6e 2074 6861 7420  ate column that 
-000088b0: 696e 6469 6361 7465 7320 7468 6520 6765  indicates the ge
-000088c0: 6e65 7261 7465 6420 7374 6174 6973 7469  nerated statisti
-000088d0: 6320 616e 6420 6170 7065 6e64 2074 6f20  c and append to 
-000088e0: 6772 6f75 7069 6e67 206c 6973 740d 0a20  grouping list.. 
-000088f0: 2020 2064 665b 7374 6174 5f63 6f6c 5d20     df[stat_col] 
-00008900: 3d20 6627 5065 7263 656e 7469 6c65 2d7b  = f'Percentile-{
-00008910: 7065 7263 656e 7469 6c65 7d27 0d0a 2020  percentile}'..  
-00008920: 2020 6772 6f75 7062 795f 636f 6c75 6d6e    groupby_column
-00008930: 732e 6170 7065 6e64 2873 7461 745f 636f  s.append(stat_co
-00008940: 6c29 0d0a 2020 2020 0d0a 2020 2020 2320  l)..    ..    # 
-00008950: 436f 6e76 6572 7420 7065 7263 656e 7469  Convert percenti
-00008960: 6c65 2074 6f20 6265 2062 6574 7765 656e  le to be between
-00008970: 2030 2061 6e64 2031 0d0a 2020 2020 7065   0 and 1..    pe
-00008980: 7263 656e 7469 6c65 203d 2070 6572 6365  rcentile = perce
-00008990: 6e74 696c 652f 3130 300d 0a20 2020 200d  ntile/100..    .
-000089a0: 0a20 2020 2023 2044 6574 6572 6d69 6e65  .    # Determine
-000089b0: 2073 697a 6520 6f66 2065 6163 6820 6772   size of each gr
-000089c0: 6f75 700d 0a20 2020 2064 665b 275f 5f53  oup..    df['__S
-000089d0: 697a 655f 5f27 5d20 3d20 6466 2e67 726f  ize__'] = df.gro
-000089e0: 7570 6279 2867 726f 7570 6279 5f63 6f6c  upby(groupby_col
-000089f0: 756d 6e73 292e 7472 616e 7366 6f72 6d28  umns).transform(
-00008a00: 2773 697a 6527 290d 0a20 2020 200d 0a20  'size')..    .. 
-00008a10: 2020 2023 2053 6574 2076 616c 7565 7320     # Set values 
-00008a20: 666f 7220 7065 7263 656e 7469 6c65 206d  for percentile m
-00008a30: 6574 686f 6473 0d0a 2020 2020 6d65 7468  ethods..    meth
-00008a40: 6f64 5f64 6963 7420 3d20 7b27 7765 6962  od_dict = {'weib
-00008a50: 616c 6c27 3a30 2e30 2c20 2774 756b 6579  all':0.0, 'tukey
-00008a60: 273a 312f 332c 2027 626c 6f6d 273a 332f  ':1/3, 'blom':3/
-00008a70: 382c 2027 6861 7a65 6e27 3a31 2f32 2c20  8, 'hazen':1/2, 
-00008a80: 2765 7863 656c 273a 312e 307d 0d0a 2020  'excel':1.0}..  
-00008a90: 2020 2320 6874 7470 733a 2f2f 656e 2e77    # https://en.w
-00008aa0: 696b 6970 6564 6961 2e6f 7267 2f77 696b  ikipedia.org/wik
-00008ab0: 692f 5065 7263 656e 7469 6c65 0d0a 2020  i/Percentile..  
-00008ac0: 2020 4320 3d20 6d65 7468 6f64 5f64 6963    C = method_dic
-00008ad0: 745b 6d65 7468 6f64 5d0d 0a20 2020 200d  t[method]..    .
-00008ae0: 0a20 2020 2023 2043 616c 6375 6c61 7465  .    # Calculate
-00008af0: 206d 696e 696d 756d 2064 6174 6120 7369   minimum data si
-00008b00: 7a65 2066 6f72 2070 6572 6365 6e74 696c  ze for percentil
-00008b10: 6520 6d65 7468 6f64 2074 6f20 0d0a 2020  e method to ..  
-00008b20: 2020 2320 656e 7375 7265 2072 616e 6b20    # ensure rank 
-00008b30: 6973 2061 7420 6c65 6173 7420 3120 616e  is at least 1 an
-00008b40: 6420 6e6f 206d 6f72 6520 7468 616e 206c  d no more than l
-00008b50: 656e 2864 6174 6129 0d0a 2020 2020 6d69  en(data)..    mi
-00008b60: 6e69 6d75 6d5f 7369 7a65 203d 2072 6f75  nimum_size = rou
-00008b70: 6e64 2843 202b 2028 312d 4329 2a6d 6178  nd(C + (1-C)*max
-00008b80: 2828 312d 7065 7263 656e 7469 6c65 292f  ((1-percentile)/
-00008b90: 7065 7263 656e 7469 6c65 2c0d 0a20 2020  percentile,..   
-00008ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008bc0: 2020 2020 7065 7263 656e 7469 6c65 2f28      percentile/(
-00008bd0: 312d 7065 7263 656e 7469 6c65 2929 2c31  1-percentile)),1
-00008be0: 3029 0d0a 2020 2020 0d0a 2020 2020 2320  0)..    ..    # 
-00008bf0: 4f6e 6c79 2063 6f6e 7369 6465 7220 6772  Only consider gr
-00008c00: 6f75 7073 2074 6861 7420 6d65 6574 2074  oups that meet t
-00008c10: 6865 206d 696e 696d 756d 2073 697a 6520  he minimum size 
-00008c20: 7265 7175 6972 656d 656e 740d 0a20 2020  requirement..   
-00008c30: 2064 6620 3d20 6466 5b64 665b 275f 5f53   df = df[df['__S
-00008c40: 697a 655f 5f27 5d20 3e3d 206d 696e 696d  ize__'] >= minim
-00008c50: 756d 5f73 697a 655d 0d0a 2020 2020 0d0a  um_size]..    ..
-00008c60: 2020 2020 2320 4465 7465 726d 696e 6520      # Determine 
-00008c70: 6c65 6674 2062 6f75 6e64 2061 6e64 2062  left bound and b
-00008c80: 6f75 6e64 6172 7920 666f 7220 6561 6368  oundary for each
-00008c90: 2067 726f 7570 0d0a 2020 2020 0d0a 2020   group..    ..  
-00008ca0: 2020 2320 4368 616e 6765 206e 6f74 6174    # Change notat
-00008cb0: 696f 6e20 6f66 2027 436c 6f73 6564 2720  ion of 'Closed' 
-00008cc0: 616e 6420 274f 7065 6e27 2062 6f75 6e64  and 'Open' bound
-00008cd0: 6172 6965 7320 746f 2030 2061 6e64 2031  aries to 0 and 1
-00008ce0: 2c20 7265 7370 6563 7469 7665 6c79 0d0a  , respectively..
-00008cf0: 2020 2020 2320 5573 6520 3020 666f 7220      # Use 0 for 
-00008d00: 636c 6f73 6564 2074 6f20 656e 7375 7265  closed to ensure
-00008d10: 2074 6861 7420 636c 6f73 6564 2062 6f75   that closed bou
-00008d20: 6e64 6172 6965 7320 6172 6520 736f 7274  ndaries are sort
-00008d30: 6564 206c 6573 7320 7468 616e 206f 7065  ed less than ope
-00008d40: 6e0d 0a20 2020 2023 2062 6f75 6e64 6172  n..    # boundar
-00008d50: 6965 7320 7768 656e 2074 6865 206c 6566  ies when the lef
-00008d60: 7420 626f 756e 6420 6973 2074 6965 640d  t bound is tied.
-00008d70: 0a20 2020 2064 665b 6c65 6674 5f62 6f75  .    df[left_bou
-00008d80: 6e64 6172 795f 636f 6c5d 203d 2064 665b  ndary_col] = df[
-00008d90: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
-00008da0: 6c5d 2e72 6570 6c61 6365 285b 2743 6c6f  l].replace(['Clo
-00008db0: 7365 6427 2c27 4f70 656e 275d 2c20 5b30  sed','Open'], [0
-00008dc0: 2c31 5d29 0d0a 2020 2020 0d0a 2020 2020  ,1])..    ..    
-00008dd0: 2320 536f 7274 206c 6566 7420 626f 756e  # Sort left boun
-00008de0: 6420 7661 6c75 6573 0d0a 2020 2020 6c65  d values..    le
-00008df0: 6674 203d 2064 662e 636f 7079 2829 5b67  ft = df.copy()[g
-00008e00: 726f 7570 6279 5f63 6f6c 756d 6e73 2b5b  roupby_columns+[
-00008e10: 275f 5f53 697a 655f 5f27 2c6c 6566 745f  '__Size__',left_
-00008e20: 626f 756e 6461 7279 5f63 6f6c 2c6c 6566  boundary_col,lef
-00008e30: 745f 626f 756e 645f 636f 6c5d 5d2e 736f  t_bound_col]].so
-00008e40: 7274 5f76 616c 7565 7328 6279 3d5b 6c65  rt_values(by=[le
-00008e50: 6674 5f62 6f75 6e64 5f63 6f6c 2c6c 6566  ft_bound_col,lef
-00008e60: 745f 626f 756e 6461 7279 5f63 6f6c 5d29  t_boundary_col])
-00008e70: 0d0a 2020 2020 0d0a 2020 2020 2320 4164  ..    ..    # Ad
-00008e80: 6420 696e 6465 7820 666f 7220 6561 6368  d index for each
-00008e90: 2067 726f 7570 0d0a 2020 2020 6c65 6674   group..    left
-00008ea0: 5b27 5f5f 496e 6465 785f 5f27 5d20 3d20  ['__Index__'] = 
-00008eb0: 6c65 6674 2e67 726f 7570 6279 2867 726f  left.groupby(gro
-00008ec0: 7570 6279 5f63 6f6c 756d 6e73 292e 6375  upby_columns).cu
-00008ed0: 6d63 6f75 6e74 2829 202b 2031 0d0a 2020  mcount() + 1..  
-00008ee0: 2020 0d0a 2020 2020 2320 4465 7465 726d    ..    # Determ
-00008ef0: 696e 6520 7468 6520 7261 6e6b 2069 6e20  ine the rank in 
-00008f00: 6561 6368 2067 726f 7570 2066 6f72 2074  each group for t
-00008f10: 6865 2070 6572 6365 6e74 696c 650d 0a20  he percentile.. 
-00008f20: 2020 206c 6566 745b 275f 5f52 616e 6b5f     left['__Rank_
-00008f30: 5f27 5d20 3d20 726f 756e 6428 4320 2b20  _'] = round(C + 
-00008f40: 7065 7263 656e 7469 6c65 2a28 6c65 6674  percentile*(left
-00008f50: 5b27 5f5f 5369 7a65 5f5f 275d 202b 2031  ['__Size__'] + 1
-00008f60: 202d 2032 2a43 292c 3829 0d0a 2020 2020   - 2*C),8)..    
-00008f70: 0d0a 2020 2020 2320 4765 6e65 7261 7465  ..    # Generate
-00008f80: 2070 726f 7869 6d69 7479 206f 6620 6561   proximity of ea
-00008f90: 6368 2072 6573 756c 7420 746f 2070 6572  ch result to per
-00008fa0: 6365 6e74 696c 6520 7261 6e6b 2075 7369  centile rank usi
-00008fb0: 6e67 2074 6865 2069 6e64 6578 0d0a 2020  ng the index..  
-00008fc0: 2020 6c65 6674 5b27 5f5f 5072 6f78 696d    left['__Proxim
-00008fd0: 6974 795f 5f27 5d20 3d20 300d 0a20 2020  ity__'] = 0..   
-00008fe0: 200d 0a20 2020 2063 6f6e 6469 7469 6f6e   ..    condition
-00008ff0: 7320 3d20 5b0d 0a20 2020 2020 2020 2023  s = [..        #
-00009000: 2049 6620 7468 6520 7065 7263 656e 7469   If the percenti
-00009010: 6c65 2072 616e 6b20 6973 2061 2077 686f  le rank is a who
-00009020: 6c65 206e 756d 6265 722c 2074 6865 6e20  le number, then 
-00009030: 7573 6520 7468 6174 2069 6e64 6578 2072  use that index r
-00009040: 6573 756c 740d 0a20 2020 2020 2020 2028  esult..        (
-00009050: 6c65 6674 5b27 5f5f 5261 6e6b 5f5f 275d  left['__Rank__']
-00009060: 203d 3d20 6c65 6674 5b27 5f5f 496e 6465   == left['__Inde
-00009070: 785f 5f27 5d29 2c0d 0a20 2020 2020 2020  x__']),..       
-00009080: 2023 2049 6620 7468 6520 7065 7263 656e   # If the percen
-00009090: 7469 6c65 2072 616e 6b20 6973 206c 6573  tile rank is les
-000090a0: 7320 7468 616e 2031 2061 626f 7665 2074  s than 1 above t
-000090b0: 6865 2069 6e64 6578 2076 616c 7565 2c0d  he index value,.
-000090c0: 0a20 2020 2020 2020 2023 2074 6865 6e20  .        # then 
-000090d0: 6173 7369 676e 2074 6865 2061 7070 726f  assign the appro
-000090e0: 7072 6961 7465 2063 6f6e 7472 6962 7574  priate contribut
-000090f0: 696f 6e20 746f 2074 6861 7420 696e 6465  ion to that inde
-00009100: 7820 7661 6c75 650d 0a20 2020 2020 2020  x value..       
-00009110: 2028 6c65 6674 5b27 5f5f 5261 6e6b 5f5f   (left['__Rank__
-00009120: 275d 202d 206c 6566 745b 275f 5f49 6e64  '] - left['__Ind
-00009130: 6578 5f5f 275d 292e 6265 7477 6565 6e28  ex__']).between(
-00009140: 302c 312c 696e 636c 7573 6976 653d 276e  0,1,inclusive='n
-00009150: 6569 7468 6572 2729 2c0d 0a20 2020 2020  either'),..     
-00009160: 2020 2023 2049 6620 7468 6520 7065 7263     # If the perc
-00009170: 656e 7469 6c65 2072 616e 6b20 6973 206c  entile rank is l
-00009180: 6573 7320 7468 616e 2031 2062 656c 6f77  ess than 1 below
-00009190: 2074 6865 2069 6e64 6578 2076 616c 7565   the index value
-000091a0: 2c0d 0a20 2020 2020 2020 2023 2074 6865  ,..        # the
-000091b0: 6e20 6173 7369 676e 2074 6865 2061 7070  n assign the app
-000091c0: 726f 7072 6961 7465 2063 6f6e 7472 6962  ropriate contrib
-000091d0: 7574 696f 6e20 746f 2074 6861 7420 696e  ution to that in
-000091e0: 6465 7820 7661 6c75 650d 0a20 2020 2020  dex value..     
-000091f0: 2020 2028 6c65 6674 5b27 5f5f 496e 6465     (left['__Inde
-00009200: 785f 5f27 5d20 2d20 6c65 6674 5b27 5f5f  x__'] - left['__
-00009210: 5261 6e6b 5f5f 275d 292e 6265 7477 6565  Rank__']).betwee
-00009220: 6e28 302c 312c 696e 636c 7573 6976 653d  n(0,1,inclusive=
-00009230: 276e 6569 7468 6572 2729 0d0a 2020 2020  'neither')..    
-00009240: 2020 2020 5d0d 0a20 2020 200d 0a20 2020      ]..    ..   
-00009250: 2072 6573 756c 7473 203d 205b 0d0a 2020   results = [..  
-00009260: 2020 2020 2020 312c 0d0a 2020 2020 2020        1,..      
-00009270: 2020 3120 2d20 286c 6566 745b 275f 5f52    1 - (left['__R
-00009280: 616e 6b5f 5f27 5d20 2d20 6c65 6674 5b27  ank__'] - left['
-00009290: 5f5f 496e 6465 785f 5f27 5d29 2c0d 0a20  __Index__']),.. 
-000092a0: 2020 2020 2020 2031 202d 2028 6c65 6674         1 - (left
-000092b0: 5b27 5f5f 496e 6465 785f 5f27 5d20 2d20  ['__Index__'] - 
-000092c0: 6c65 6674 5b27 5f5f 5261 6e6b 5f5f 275d  left['__Rank__']
-000092d0: 292c 0d0a 2020 2020 2020 2020 5d0d 0a20  ),..        ].. 
-000092e0: 2020 200d 0a20 2020 206c 6566 745b 275f     ..    left['_
-000092f0: 5f50 726f 7869 6d69 7479 5f5f 275d 203d  _Proximity__'] =
-00009300: 206e 702e 7365 6c65 6374 2863 6f6e 6469   np.select(condi
-00009310: 7469 6f6e 732c 2072 6573 756c 7473 2c20  tions, results, 
-00009320: 6e70 2e6e 616e 290d 0a20 2020 200d 0a20  np.nan)..    .. 
-00009330: 2020 2023 2044 726f 7020 6e6f 6e2d 636f     # Drop non-co
-00009340: 6e74 7269 6275 7469 6e67 2072 6f77 730d  ntributing rows.
-00009350: 0a20 2020 206c 6566 7420 3d20 6c65 6674  .    left = left
-00009360: 5b6c 6566 745b 275f 5f50 726f 7869 6d69  [left['__Proximi
-00009370: 7479 5f5f 275d 203e 2030 5d0d 0a20 2020  ty__'] > 0]..   
-00009380: 200d 0a20 2020 2023 2043 616c 6375 6c61   ..    # Calcula
-00009390: 7465 2063 6f6e 7472 6962 7574 696f 6e20  te contribution 
-000093a0: 666f 7220 696e 6465 7820 7661 6c75 6573  for index values
-000093b0: 2074 6861 7420 636f 6e74 7269 6275 7465   that contribute
-000093c0: 2074 6f20 7468 6520 7265 7375 6c74 0d0a   to the result..
-000093d0: 2020 2020 6c65 6674 5b27 5f5f 436f 6e74      left['__Cont
-000093e0: 7269 6275 7469 6f6e 5f5f 275d 203d 206c  ribution__'] = l
-000093f0: 6566 745b 275f 5f50 726f 7869 6d69 7479  eft['__Proximity
-00009400: 5f5f 275d 202a 206c 6566 745b 6c65 6674  __'] * left[left
-00009410: 5f62 6f75 6e64 5f63 6f6c 5d0d 0a20 2020  _bound_col]..   
-00009420: 200d 0a20 2020 2023 2044 6574 6572 6d69   ..    # Determi
-00009430: 6e65 206c 6566 7420 626f 756e 6420 616e  ne left bound an
-00009440: 6420 626f 756e 6461 7279 2075 7369 6e67  d boundary using
-00009450: 2074 6865 2073 756d 206f 6620 7468 6520   the sum of the 
-00009460: 636f 6e74 7269 6275 7469 6f6e 730d 0a20  contributions.. 
-00009470: 2020 2023 2061 6e64 2061 6e20 6f70 656e     # and an open
-00009480: 2062 6f75 6e64 6172 7920 6966 2061 6e79   boundary if any
-00009490: 206f 6620 7468 6520 636f 6e74 7269 6275   of the contribu
-000094a0: 7469 6e67 2076 616c 7565 7320 6973 206f  ting values is o
-000094b0: 7065 6e0d 0a20 2020 206c 6566 7420 3d20  pen..    left = 
-000094c0: 6c65 6674 2e67 726f 7570 6279 2867 726f  left.groupby(gro
-000094d0: 7570 6279 5f63 6f6c 756d 6e73 292e 6167  upby_columns).ag
-000094e0: 6728 2a2a 7b0d 0a20 2020 2020 2020 2020  g(**{..         
-000094f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009500: 2020 206c 6566 745f 626f 756e 6461 7279     left_boundary
-00009510: 5f63 6f6c 3a20 286c 6566 745f 626f 756e  _col: (left_boun
-00009520: 6461 7279 5f63 6f6c 2c20 276d 6178 2729  dary_col, 'max')
-00009530: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00009540: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00009550: 6566 745f 626f 756e 645f 636f 6c3a 2028  eft_bound_col: (
-00009560: 275f 5f43 6f6e 7472 6962 7574 696f 6e5f  '__Contribution_
-00009570: 5f27 2c27 7375 6d27 292c 0d0a 2020 2020  _','sum'),..    
-00009580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009590: 2020 2020 2020 2020 275f 5f4d 696e 696d          '__Minim
-000095a0: 756d 5f5f 273a 2028 275f 5f43 6f6e 7472  um__': ('__Contr
-000095b0: 6962 7574 696f 6e5f 5f27 2c27 6d69 6e27  ibution__','min'
-000095c0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000095d0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-000095e0: 290d 0a20 2020 200d 0a20 2020 2023 2052  )..    ..    # R
-000095f0: 6570 6c61 6365 2074 6865 206e 756d 6572  eplace the numer
-00009600: 6963 2076 616c 7565 2066 6f72 2074 6865  ic value for the
-00009610: 2062 6f75 6e64 6172 790d 0a20 2020 206c   boundary..    l
-00009620: 6566 745b 6c65 6674 5f62 6f75 6e64 6172  eft[left_boundar
-00009630: 795f 636f 6c5d 203d 206c 6566 745b 6c65  y_col] = left[le
-00009640: 6674 5f62 6f75 6e64 6172 795f 636f 6c5d  ft_boundary_col]
-00009650: 2e72 6570 6c61 6365 285b 302c 315d 2c20  .replace([0,1], 
-00009660: 5b27 436c 6f73 6564 272c 274f 7065 6e27  ['Closed','Open'
-00009670: 5d29 0d0a 2020 2020 0d0a 2020 2020 2320  ])..    ..    # 
-00009680: 4d65 616e 7320 7769 7468 2069 6e66 696e  Means with infin
-00009690: 6974 6520 7661 6c75 6573 2070 726f 6475  ite values produ
-000096a0: 6365 206e 616e 2076 616c 7565 7320 7261  ce nan values ra
-000096b0: 7468 6572 2074 6861 6e20 6e70 2e69 6e66  ther than np.inf
-000096c0: 2076 616c 7565 730d 0a20 2020 2023 2043   values..    # C
-000096d0: 6f6e 7665 7274 206e 616e 2074 6f20 696e  onvert nan to in
-000096e0: 6620 6f6e 6c79 2069 6620 696e 6669 6e69  f only if infini
-000096f0: 7465 2076 616c 7565 7320 6172 6520 696e  te values are in
-00009700: 636c 7564 6564 2069 6e20 7468 6520 6d65  cluded in the me
-00009710: 616e 0d0a 2020 2020 6c65 6674 5b6c 6566  an..    left[lef
-00009720: 745f 626f 756e 645f 636f 6c5d 203d 206e  t_bound_col] = n
-00009730: 702e 7768 6572 6528 6c65 6674 5b27 5f5f  p.where(left['__
-00009740: 4d69 6e69 6d75 6d5f 5f27 5d20 3d3d 202d  Minimum__'] == -
-00009750: 6e70 2e69 6e66 2c20 2d6e 702e 696e 662c  np.inf, -np.inf,
-00009760: 206c 6566 745b 6c65 6674 5f62 6f75 6e64   left[left_bound
-00009770: 5f63 6f6c 5d29 0d0a 2020 2020 0d0a 2020  _col])..    ..  
-00009780: 2020 2320 4465 7465 726d 696e 6520 7269    # Determine ri
-00009790: 6768 7420 626f 756e 6420 616e 6420 626f  ght bound and bo
-000097a0: 756e 6461 7279 2066 6f72 2065 6163 6820  undary for each 
-000097b0: 6772 6f75 700d 0a20 2020 200d 0a20 2020  group..    ..   
-000097c0: 2023 2043 6861 6e67 6520 6e6f 7461 7469   # Change notati
-000097d0: 6f6e 206f 6620 2743 6c6f 7365 6427 2061  on of 'Closed' a
-000097e0: 6e64 2027 4f70 656e 2720 626f 756e 6461  nd 'Open' bounda
-000097f0: 7269 6573 2074 6f20 3120 616e 6420 302c  ries to 1 and 0,
-00009800: 2072 6573 7065 6374 6976 656c 790d 0a20   respectively.. 
-00009810: 2020 2023 2055 7365 2031 2066 6f72 2063     # Use 1 for c
-00009820: 6c6f 7365 6420 746f 2065 6e73 7572 6520  losed to ensure 
-00009830: 7468 6174 2063 6c6f 7365 6420 626f 756e  that closed boun
-00009840: 6461 7269 6573 2061 7265 2073 6f72 7465  daries are sorte
-00009850: 6420 6c61 7267 6572 2074 6861 6e20 6f70  d larger than op
-00009860: 656e 0d0a 2020 2020 2320 626f 756e 6461  en..    # bounda
-00009870: 7269 6573 2077 6865 6e20 7468 6520 7269  ries when the ri
-00009880: 6768 7420 626f 756e 6420 6973 2074 6965  ght bound is tie
-00009890: 640d 0a20 2020 2064 665b 7269 6768 745f  d..    df[right_
-000098a0: 626f 756e 6461 7279 5f63 6f6c 5d20 3d20  boundary_col] = 
-000098b0: 6466 5b72 6967 6874 5f62 6f75 6e64 6172  df[right_boundar
-000098c0: 795f 636f 6c5d 2e72 6570 6c61 6365 285b  y_col].replace([
-000098d0: 2743 6c6f 7365 6427 2c27 4f70 656e 275d  'Closed','Open']
-000098e0: 2c20 5b31 2c30 5d29 0d0a 2020 2020 0d0a  , [1,0])..    ..
-000098f0: 2020 2020 2320 536f 7274 2072 6967 6874      # Sort right
-00009900: 2062 6f75 6e64 2076 616c 7565 730d 0a20   bound values.. 
-00009910: 2020 2072 6967 6874 203d 2064 662e 636f     right = df.co
-00009920: 7079 2829 5b67 726f 7570 6279 5f63 6f6c  py()[groupby_col
-00009930: 756d 6e73 2b5b 275f 5f53 697a 655f 5f27  umns+['__Size__'
-00009940: 2c72 6967 6874 5f62 6f75 6e64 6172 795f  ,right_boundary_
-00009950: 636f 6c2c 7269 6768 745f 626f 756e 645f  col,right_bound_
-00009960: 636f 6c5d 5d2e 736f 7274 5f76 616c 7565  col]].sort_value
-00009970: 7328 6279 3d5b 7269 6768 745f 626f 756e  s(by=[right_boun
-00009980: 645f 636f 6c2c 7269 6768 745f 626f 756e  d_col,right_boun
-00009990: 6461 7279 5f63 6f6c 5d29 0d0a 2020 2020  dary_col])..    
-000099a0: 0d0a 2020 2020 2320 4164 6420 696e 6465  ..    # Add inde
-000099b0: 7820 666f 7220 6561 6368 2067 726f 7570  x for each group
-000099c0: 0d0a 2020 2020 7269 6768 745b 275f 5f49  ..    right['__I
-000099d0: 6e64 6578 5f5f 275d 203d 2072 6967 6874  ndex__'] = right
-000099e0: 2e67 726f 7570 6279 2867 726f 7570 6279  .groupby(groupby
-000099f0: 5f63 6f6c 756d 6e73 292e 6375 6d63 6f75  _columns).cumcou
-00009a00: 6e74 2829 202b 2031 0d0a 2020 2020 0d0a  nt() + 1..    ..
-00009a10: 2020 2020 2320 4465 7465 726d 696e 6520      # Determine 
-00009a20: 7468 6520 7261 6e6b 2069 6e20 6561 6368  the rank in each
-00009a30: 2067 726f 7570 2066 6f72 2074 6865 2070   group for the p
-00009a40: 6572 6365 6e74 696c 650d 0a20 2020 2072  ercentile..    r
-00009a50: 6967 6874 5b27 5f5f 5261 6e6b 5f5f 275d  ight['__Rank__']
-00009a60: 203d 2072 6f75 6e64 2843 202b 2070 6572   = round(C + per
-00009a70: 6365 6e74 696c 652a 2872 6967 6874 5b27  centile*(right['
-00009a80: 5f5f 5369 7a65 5f5f 275d 202b 2031 202d  __Size__'] + 1 -
-00009a90: 2032 2a43 292c 3829 0d0a 2020 2020 0d0a   2*C),8)..    ..
-00009aa0: 2020 2020 2320 4765 6e65 7261 7465 2070      # Generate p
-00009ab0: 726f 7869 6d69 7479 206f 6620 6561 6368  roximity of each
-00009ac0: 2072 6573 756c 7420 746f 2070 6572 6365   result to perce
-00009ad0: 6e74 696c 6520 7261 6e6b 2075 7369 6e67  ntile rank using
-00009ae0: 2074 6865 2069 6e64 6578 0d0a 2020 2020   the index..    
-00009af0: 7269 6768 745b 275f 5f50 726f 7869 6d69  right['__Proximi
-00009b00: 7479 5f5f 275d 203d 2030 0d0a 2020 2020  ty__'] = 0..    
-00009b10: 0d0a 2020 2020 636f 6e64 6974 696f 6e73  ..    conditions
-00009b20: 203d 205b 0d0a 2020 2020 2020 2020 2320   = [..        # 
-00009b30: 4966 2074 6865 2070 6572 6365 6e74 696c  If the percentil
-00009b40: 6520 7261 6e6b 2069 7320 6120 7768 6f6c  e rank is a whol
-00009b50: 6520 6e75 6d62 6572 2c20 7468 656e 2075  e number, then u
-00009b60: 7365 2074 6861 7420 696e 6465 7820 7265  se that index re
-00009b70: 7375 6c74 0d0a 2020 2020 2020 2020 2872  sult..        (r
-00009b80: 6967 6874 5b27 5f5f 5261 6e6b 5f5f 275d  ight['__Rank__']
-00009b90: 203d 3d20 7269 6768 745b 275f 5f49 6e64   == right['__Ind
-00009ba0: 6578 5f5f 275d 292c 0d0a 2020 2020 2020  ex__']),..      
-00009bb0: 2020 2320 4966 2074 6865 2070 6572 6365    # If the perce
-00009bc0: 6e74 696c 6520 7261 6e6b 2069 7320 6c65  ntile rank is le
-00009bd0: 7373 2074 6861 6e20 3120 6162 6f76 6520  ss than 1 above 
-00009be0: 7468 6520 696e 6465 7820 7661 6c75 652c  the index value,
-00009bf0: 0d0a 2020 2020 2020 2020 2320 7468 656e  ..        # then
-00009c00: 2061 7373 6967 6e20 7468 6520 6170 7072   assign the appr
-00009c10: 6f70 7269 6174 6520 636f 6e74 7269 6275  opriate contribu
-00009c20: 7469 6f6e 2074 6f20 7468 6174 2069 6e64  tion to that ind
-00009c30: 6578 2076 616c 7565 0d0a 2020 2020 2020  ex value..      
-00009c40: 2020 2872 6967 6874 5b27 5f5f 5261 6e6b    (right['__Rank
-00009c50: 5f5f 275d 202d 2072 6967 6874 5b27 5f5f  __'] - right['__
-00009c60: 496e 6465 785f 5f27 5d29 2e62 6574 7765  Index__']).betwe
-00009c70: 656e 2830 2c31 2c69 6e63 6c75 7369 7665  en(0,1,inclusive
-00009c80: 3d27 6e65 6974 6865 7227 292c 0d0a 2020  ='neither'),..  
-00009c90: 2020 2020 2020 2320 4966 2074 6865 2070        # If the p
-00009ca0: 6572 6365 6e74 696c 6520 7261 6e6b 2069  ercentile rank i
-00009cb0: 7320 6c65 7373 2074 6861 6e20 3120 6265  s less than 1 be
-00009cc0: 6c6f 7720 7468 6520 696e 6465 7820 7661  low the index va
-00009cd0: 6c75 652c 0d0a 2020 2020 2020 2020 2320  lue,..        # 
-00009ce0: 7468 656e 2061 7373 6967 6e20 7468 6520  then assign the 
-00009cf0: 6170 7072 6f70 7269 6174 6520 636f 6e74  appropriate cont
-00009d00: 7269 6275 7469 6f6e 2074 6f20 7468 6174  ribution to that
-00009d10: 2069 6e64 6578 2076 616c 7565 0d0a 2020   index value..  
-00009d20: 2020 2020 2020 2872 6967 6874 5b27 5f5f        (right['__
-00009d30: 496e 6465 785f 5f27 5d20 2d20 7269 6768  Index__'] - righ
-00009d40: 745b 275f 5f52 616e 6b5f 5f27 5d29 2e62  t['__Rank__']).b
-00009d50: 6574 7765 656e 2830 2c31 2c69 6e63 6c75  etween(0,1,inclu
-00009d60: 7369 7665 3d27 6e65 6974 6865 7227 290d  sive='neither').
-00009d70: 0a20 2020 2020 2020 205d 0d0a 2020 2020  .        ]..    
-00009d80: 0d0a 2020 2020 7265 7375 6c74 7320 3d20  ..    results = 
-00009d90: 5b0d 0a20 2020 2020 2020 2031 2c0d 0a20  [..        1,.. 
-00009da0: 2020 2020 2020 2031 202d 2028 7269 6768         1 - (righ
-00009db0: 745b 275f 5f52 616e 6b5f 5f27 5d20 2d20  t['__Rank__'] - 
-00009dc0: 7269 6768 745b 275f 5f49 6e64 6578 5f5f  right['__Index__
-00009dd0: 275d 292c 0d0a 2020 2020 2020 2020 3120  ']),..        1 
-00009de0: 2d20 2872 6967 6874 5b27 5f5f 496e 6465  - (right['__Inde
-00009df0: 785f 5f27 5d20 2d20 7269 6768 745b 275f  x__'] - right['_
-00009e00: 5f52 616e 6b5f 5f27 5d29 2c0d 0a20 2020  _Rank__']),..   
-00009e10: 2020 2020 205d 0d0a 2020 2020 0d0a 2020       ]..    ..  
-00009e20: 2020 7269 6768 745b 275f 5f50 726f 7869    right['__Proxi
-00009e30: 6d69 7479 5f5f 275d 203d 206e 702e 7365  mity__'] = np.se
-00009e40: 6c65 6374 2863 6f6e 6469 7469 6f6e 732c  lect(conditions,
-00009e50: 2072 6573 756c 7473 2c20 6e70 2e6e 616e   results, np.nan
-00009e60: 290d 0a20 2020 200d 0a20 2020 2023 2044  )..    ..    # D
-00009e70: 726f 7020 6e6f 6e2d 636f 6e74 7269 6275  rop non-contribu
-00009e80: 7469 6e67 2072 6f77 730d 0a20 2020 2072  ting rows..    r
-00009e90: 6967 6874 203d 2072 6967 6874 5b72 6967  ight = right[rig
-00009ea0: 6874 5b27 5f5f 5072 6f78 696d 6974 795f  ht['__Proximity_
-00009eb0: 5f27 5d20 3e20 305d 0d0a 2020 2020 0d0a  _'] > 0]..    ..
-00009ec0: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
-00009ed0: 636f 6e74 7269 6275 7469 6f6e 2066 6f72  contribution for
-00009ee0: 2069 6e64 6578 2076 616c 7565 7320 7468   index values th
-00009ef0: 6174 2063 6f6e 7472 6962 7574 6520 746f  at contribute to
-00009f00: 2074 6865 2072 6573 756c 740d 0a20 2020   the result..   
-00009f10: 2072 6967 6874 5b27 5f5f 436f 6e74 7269   right['__Contri
-00009f20: 6275 7469 6f6e 5f5f 275d 203d 2072 6967  bution__'] = rig
-00009f30: 6874 5b27 5f5f 5072 6f78 696d 6974 795f  ht['__Proximity_
-00009f40: 5f27 5d20 2a20 7269 6768 745b 7269 6768  _'] * right[righ
-00009f50: 745f 626f 756e 645f 636f 6c5d 0d0a 2020  t_bound_col]..  
-00009f60: 2020 0d0a 2020 2020 2320 4465 7465 726d    ..    # Determ
-00009f70: 696e 6520 7269 6768 7420 626f 756e 6420  ine right bound 
-00009f80: 616e 6420 626f 756e 6461 7279 2075 7369  and boundary usi
-00009f90: 6e67 2074 6865 2073 756d 206f 6620 7468  ng the sum of th
-00009fa0: 6520 636f 6e74 7269 6275 7469 6f6e 730d  e contributions.
-00009fb0: 0a20 2020 2023 2061 6e64 2061 6e20 6f70  .    # and an op
-00009fc0: 656e 2062 6f75 6e64 6172 7920 6966 2061  en boundary if a
-00009fd0: 6e79 206f 6620 7468 6520 636f 6e74 7269  ny of the contri
-00009fe0: 6275 7469 6e67 2076 616c 7565 7320 6973  buting values is
-00009ff0: 206f 7065 6e0d 0a20 2020 2072 6967 6874   open..    right
-0000a000: 203d 2072 6967 6874 2e67 726f 7570 6279   = right.groupby
-0000a010: 2867 726f 7570 6279 5f63 6f6c 756d 6e73  (groupby_columns
-0000a020: 292e 6167 6728 2a2a 7b0d 0a20 2020 2020  ).agg(**{..     
-0000a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a040: 2020 2020 2020 2072 6967 6874 5f62 6f75         right_bou
-0000a050: 6e64 5f63 6f6c 3a20 2827 5f5f 436f 6e74  nd_col: ('__Cont
-0000a060: 7269 6275 7469 6f6e 5f5f 272c 2773 756d  ribution__','sum
-0000a070: 2729 2c0d 0a20 2020 2020 2020 2020 2020  '),..           
-0000a080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a090: 2072 6967 6874 5f62 6f75 6e64 6172 795f   right_boundary_
-0000a0a0: 636f 6c3a 2028 7269 6768 745f 626f 756e  col: (right_boun
-0000a0b0: 6461 7279 5f63 6f6c 2c20 276d 696e 2729  dary_col, 'min')
-0000a0c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000a0d0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0000a0e0: 5f5f 4d61 7869 6d75 6d5f 5f27 3a20 2827  __Maximum__': ('
-0000a0f0: 5f5f 436f 6e74 7269 6275 7469 6f6e 5f5f  __Contribution__
-0000a100: 272c 276d 6178 2729 0d0a 2020 2020 2020  ','max')..      
-0000a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a120: 2020 2020 2020 7d29 0d0a 2020 2020 0d0a        })..    ..
-0000a130: 2020 2020 2320 5265 706c 6163 6520 7468      # Replace th
-0000a140: 6520 6e75 6d65 7269 6320 7661 6c75 6520  e numeric value 
-0000a150: 666f 7220 7468 6520 626f 756e 6461 7279  for the boundary
-0000a160: 0d0a 2020 2020 7269 6768 745b 7269 6768  ..    right[righ
-0000a170: 745f 626f 756e 6461 7279 5f63 6f6c 5d20  t_boundary_col] 
-0000a180: 3d20 7269 6768 745b 7269 6768 745f 626f  = right[right_bo
-0000a190: 756e 6461 7279 5f63 6f6c 5d2e 7265 706c  undary_col].repl
-0000a1a0: 6163 6528 5b31 2c30 5d2c 205b 2743 6c6f  ace([1,0], ['Clo
-0000a1b0: 7365 6427 2c27 4f70 656e 275d 290d 0a20  sed','Open']).. 
-0000a1c0: 2020 200d 0a20 2020 2023 204d 6561 6e73     ..    # Means
-0000a1d0: 2077 6974 6820 696e 6669 6e69 7465 2076   with infinite v
-0000a1e0: 616c 7565 7320 7072 6f64 7563 6520 6e61  alues produce na
-0000a1f0: 6e20 7661 6c75 6573 2072 6174 6865 7220  n values rather 
-0000a200: 7468 616e 206e 702e 696e 6620 7661 6c75  than np.inf valu
-0000a210: 6573 0d0a 2020 2020 2320 436f 6e76 6572  es..    # Conver
-0000a220: 7420 6e61 6e20 746f 2069 6e66 206f 6e6c  t nan to inf onl
-0000a230: 7920 6966 2069 6e66 696e 6974 6520 7661  y if infinite va
-0000a240: 6c75 6573 2061 7265 2069 6e63 6c75 6465  lues are include
-0000a250: 6420 696e 2074 6865 206d 6561 6e0d 0a20  d in the mean.. 
-0000a260: 2020 2072 6967 6874 5b72 6967 6874 5f62     right[right_b
-0000a270: 6f75 6e64 5f63 6f6c 5d20 3d20 6e70 2e77  ound_col] = np.w
-0000a280: 6865 7265 2872 6967 6874 5b27 5f5f 4d61  here(right['__Ma
-0000a290: 7869 6d75 6d5f 5f27 5d20 3d3d 206e 702e  ximum__'] == np.
-0000a2a0: 696e 662c 206e 702e 696e 662c 2072 6967  inf, np.inf, rig
-0000a2b0: 6874 5b72 6967 6874 5f62 6f75 6e64 5f63  ht[right_bound_c
-0000a2c0: 6f6c 5d29 0d0a 2020 2020 0d0a 2020 2020  ol])..    ..    
-0000a2d0: 2320 4d65 7267 6520 7468 6520 7477 6f20  # Merge the two 
-0000a2e0: 626f 756e 6461 7269 6573 2074 6f20 6372  boundaries to cr
-0000a2f0: 6561 7465 2074 6865 2069 6e74 6572 7661  eate the interva
-0000a300: 6c20 666f 7220 7468 6520 7065 7263 656e  l for the percen
-0000a310: 7469 6c65 0d0a 2020 2020 2320 4368 6563  tile..    # Chec
-0000a320: 6b20 7468 6174 2074 6865 206d 6572 6765  k that the merge
-0000a330: 2069 7320 312d 746f 2d31 0d0a 2020 2020   is 1-to-1..    
-0000a340: 6466 203d 206c 6566 742e 6d65 7267 6528  df = left.merge(
-0000a350: 7269 6768 742c 2068 6f77 203d 2027 6f75  right, how = 'ou
-0000a360: 7465 7227 2c20 6f6e 203d 2067 726f 7570  ter', on = group
-0000a370: 6279 5f63 6f6c 756d 6e73 2c20 7661 6c69  by_columns, vali
-0000a380: 6461 7465 203d 2027 313a 3127 290d 0a20  date = '1:1').. 
-0000a390: 2020 200d 0a20 2020 2023 2052 6573 6574     ..    # Reset
-0000a3a0: 2069 6e64 6578 0d0a 2020 2020 6466 203d   index..    df =
-0000a3b0: 2064 662e 7265 7365 745f 696e 6465 7828   df.reset_index(
-0000a3c0: 290d 0a20 2020 200d 0a20 2020 2072 6574  )..    ..    ret
-0000a3d0: 7572 6e20 6466 0d0a 0d0a 6465 6620 7065  urn df....def pe
-0000a3e0: 7263 656e 7469 6c65 2864 662c 0d0a 2020  rcentile(df,..  
-0000a3f0: 2020 2020 2020 2020 2020 2020 2072 6573               res
-0000a400: 756c 745f 636f 6c2c 0d0a 2020 2020 2020  ult_col,..      
-0000a410: 2020 2020 2020 2020 2070 6572 6365 6e74           percent
-0000a420: 696c 652c 0d0a 2020 2020 2020 2020 2020  ile,..          
-0000a430: 2020 2020 206d 6574 686f 6420 3d20 2768       method = 'h
-0000a440: 617a 656e 272c 0d0a 2020 2020 2020 2020  azen',..        
-0000a450: 2020 2020 2020 2067 726f 7570 6279 5f63         groupby_c
-0000a460: 6f6c 756d 6e73 203d 204e 6f6e 652c 0d0a  olumns = None,..
-0000a470: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000a480: 6f63 7573 5f68 6967 685f 706f 7465 6e74  ocus_high_potent
-0000a490: 6961 6c20 3d20 5472 7565 2c0d 0a20 2020  ial = True,..   
-0000a4a0: 2020 2020 2020 2020 2020 2020 696e 636c              incl
-0000a4b0: 7564 655f 6e65 6761 7469 7665 5f69 6e74  ude_negative_int
-0000a4c0: 6572 7661 6c20 3d20 4661 6c73 652c 0d0a  erval = False,..
-0000a4d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000a4e0: 7265 6369 7369 6f6e 5f74 6f6c 6572 616e  recision_toleran
-0000a4f0: 6365 5f74 6f5f 6472 6f70 5f63 656e 736f  ce_to_drop_censo
-0000a500: 7220 3d20 302e 3235 2c0d 0a20 2020 2020  r = 0.25,..     
-0000a510: 2020 2020 2020 2020 2020 7072 6563 6973            precis
-0000a520: 696f 6e5f 726f 756e 6469 6e67 203d 2054  ion_rounding = T
-0000a530: 7275 6529 3a0d 0a20 2020 2027 2727 0d0a  rue):..    '''..
-0000a540: 2020 2020 4120 6675 6e63 7469 6f6e 2074      A function t
-0000a550: 6861 7420 636f 6d62 696e 6573 2074 6865  hat combines the
-0000a560: 2072 656c 6576 616e 7420 7065 7263 656e   relevant percen
-0000a570: 7469 6c65 2061 6e64 2075 7469 6c69 7479  tile and utility
-0000a580: 2066 756e 6374 696f 6e73 2074 6f0d 0a20   functions to.. 
-0000a590: 2020 2067 656e 6572 6174 6520 7468 6520     generate the 
-0000a5a0: 7065 7263 656e 6974 6c65 2072 6573 756c  percenitle resul
-0000a5b0: 7473 2066 6f72 2067 726f 7570 7320 7769  ts for groups wi
-0000a5c0: 7468 696e 2061 2044 6174 6146 7261 6d65  thin a DataFrame
-0000a5d0: 2e0d 0a0d 0a20 2020 2050 6172 616d 6574  .....    Paramet
-0000a5e0: 6572 730d 0a20 2020 202d 2d2d 2d2d 2d2d  ers..    -------
-0000a5f0: 2d2d 2d0d 0a20 2020 2064 6620 3a20 4461  ---..    df : Da
-0000a600: 7461 4672 616d 650d 0a20 2020 2020 2020  taFrame..       
-0000a610: 2044 6174 6146 7261 6d65 2074 6861 7420   DataFrame that 
-0000a620: 636f 6e74 6169 6e73 2063 656e 736f 7265  contains censore
-0000a630: 6420 6f72 2075 6e63 656e 736f 7265 6420  d or uncensored 
-0000a640: 7265 7375 6c74 730d 0a20 2020 2072 6573  results..    res
-0000a650: 756c 745f 636f 6c20 3a20 7374 7269 6e67  ult_col : string
-0000a660: 0d0a 2020 2020 2020 2020 5468 6520 636f  ..        The co
-0000a670: 6c75 6d6e 206e 616d 6520 666f 7220 7468  lumn name for th
-0000a680: 6520 636f 6c75 6d6e 2074 6861 7420 636f  e column that co
-0000a690: 6e74 6169 6e20 7468 6520 7265 7375 6c74  ntain the result
-0000a6a0: 7320 6173 2074 6578 742e 0d0a 2020 2020  s as text...    
-0000a6b0: 2020 2020 4f6e 6c79 2066 6f75 7220 706f      Only four po
-0000a6c0: 7373 6962 6c65 2063 656e 736f 7273 2073  ssible censors s
-0000a6d0: 686f 756c 6420 6265 2075 7365 6420 283c  hould be used (<
-0000a6e0: 2ce2 89a4 2ce2 89a5 2c3e 292e 0d0a 2020  ,...,...,>)...  
-0000a6f0: 2020 7065 7263 656e 7469 6c65 203a 2066    percentile : f
-0000a700: 6c6f 6174 0d0a 2020 2020 2020 2020 5468  loat..        Th
-0000a710: 6520 6465 7369 7265 6420 7065 7263 656e  e desired percen
-0000a720: 7469 6c65 2e20 5661 6c75 6573 2073 686f  tile. Values sho
-0000a730: 756c 6420 6265 2062 6574 7765 656e 2030  uld be between 0
-0000a740: 2061 6e64 2031 3030 2e0d 0a20 2020 206d   and 100...    m
-0000a750: 6574 686f 6420 3a20 7374 7269 6e67 0d0a  ethod : string..
-0000a760: 2020 2020 2020 2020 5468 6520 7065 7263          The perc
-0000a770: 656e 7469 6c65 206d 6574 686f 642e 2054  entile method. T
-0000a780: 6865 206f 7074 696f 6e73 2061 6e64 2064  he options and d
-0000a790: 6566 696e 6974 696f 6e73 2063 6f6d 6520  efinitions come 
-0000a7a0: 6672 6f6d 3a0d 0a20 2020 2020 2020 2020  from:..         
-0000a7b0: 2020 2068 7474 7073 3a2f 2f65 6e76 6972     https://envir
-0000a7c0: 6f6e 6d65 6e74 2e67 6f76 742e 6e7a 2f61  onment.govt.nz/a
-0000a7d0: 7373 6574 732f 5075 626c 6963 6174 696f  ssets/Publicatio
-0000a7e0: 6e73 2f46 696c 6573 2f68 617a 656e 2d70  ns/Files/hazen-p
-0000a7f0: 6572 6365 6e74 696c 652d 6361 6c63 756c  ercentile-calcul
-0000a800: 6174 6f72 2d32 2e78 6c73 0d0a 2020 2020  ator-2.xls..    
-0000a810: 2020 2020 2020 2020 4f70 7469 6f6e 7320          Options 
-0000a820: 696e 636c 7564 6520 7468 6520 666f 6c6c  include the foll
-0000a830: 6f77 696e 672c 206f 7264 6572 6564 2066  owing, ordered f
-0000a840: 726f 6d20 6c61 7267 6573 7420 746f 2073  rom largest to s
-0000a850: 6d61 6c6c 6573 7420 7265 7375 6c74 2e0d  mallest result..
-0000a860: 0a20 2020 2020 2020 2020 2020 202d 2077  .            - w
-0000a870: 6569 6261 6c6c 0d0a 2020 2020 2020 2020  eiball..        
-0000a880: 2020 2020 2d20 7475 6b65 790d 0a20 2020      - tukey..   
-0000a890: 2020 2020 2020 2020 202d 2062 6c6f 6d0d           - blom.
-0000a8a0: 0a20 2020 2020 2020 2020 2020 202d 2068  .            - h
-0000a8b0: 617a 656e 0d0a 2020 2020 2020 2020 2020  azen..          
-0000a8c0: 2020 2d20 6578 6365 6c0d 0a20 2020 2020    - excel..     
-0000a8d0: 2020 2054 6865 2064 6566 6175 6c74 2069     The default i
-0000a8e0: 7320 6861 7a65 6e2e 0d0a 2020 2020 6772  s hazen...    gr
-0000a8f0: 6f75 7062 795f 636f 6c75 6d6e 7320 3a20  oupby_columns : 
-0000a900: 6c69 7374 7320 6f66 2073 7472 696e 6773  lists of strings
-0000a910: 2028 6f72 206c 6973 7420 6f66 206c 6973   (or list of lis
-0000a920: 7473 292c 206f 7074 696f 6e61 6c0d 0a20  ts), optional.. 
-0000a930: 2020 2020 2020 204c 6973 7420 6f66 2063         List of c
-0000a940: 6f6c 756d 6e20 6e61 6d65 7320 7468 6174  olumn names that
-0000a950: 2073 686f 756c 6420 6265 2075 7365 6420   should be used 
-0000a960: 746f 2063 7265 6174 6520 6772 6f75 7073  to create groups
-0000a970: 2e20 4120 7065 7263 656e 7469 6c65 0d0a  . A percentile..
-0000a980: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
-0000a990: 666f 756e 6420 7769 7468 696e 2065 6163  found within eac
-0000a9a0: 6820 6772 6f75 702e 204d 756c 7469 706c  h group. Multipl
-0000a9b0: 6520 6c69 7374 7320 6361 6e20 6265 2073  e lists can be s
-0000a9c0: 7570 706c 6965 6420 746f 0d0a 2020 2020  upplied to..    
-0000a9d0: 2020 2020 7065 7266 6f72 6d20 7365 7175      perform sequ
-0000a9e0: 656e 7469 616c 206d 6564 6961 6e20 7065  ential median pe
-0000a9f0: 7263 656e 7469 6c65 7320 6265 666f 7265  rcentiles before
-0000aa00: 2063 616c 6375 6c61 7469 6e67 2061 2070   calculating a p
-0000aa10: 6572 6365 6e74 696c 650d 0a20 2020 2020  ercentile..     
-0000aa20: 2020 206f 7665 7220 7468 6520 6669 6e61     over the fina
-0000aa30: 6c20 6772 6f75 7069 6e67 2e0d 0a20 2020  l grouping...   
-0000aa40: 2020 2020 2054 6865 2064 6566 6175 6c74       The default
-0000aa50: 2069 7320 4e6f 6e65 2e0d 0a20 2020 2066   is None...    f
-0000aa60: 6f63 7573 5f68 6967 685f 706f 7465 6e74  ocus_high_potent
-0000aa70: 6961 6c20 3a20 626f 6f6c 6561 6e2c 206f  ial : boolean, o
-0000aa80: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
-0000aa90: 2049 6620 5472 7565 2c20 7468 656e 2069   If True, then i
-0000aaa0: 6e66 6f72 6d61 7469 6f6e 206f 6e20 7468  nformation on th
-0000aab0: 6520 6869 6768 6573 7420 706f 7465 6e74  e highest potent
-0000aac0: 6961 6c20 7265 7375 6c74 2077 696c 6c20  ial result will 
-0000aad0: 6265 0d0a 2020 2020 2020 2020 666f 6375  be..        focu
-0000aae0: 7365 6420 6f76 6572 2074 6865 206c 6f77  sed over the low
-0000aaf0: 6573 7420 706f 7465 6e74 6961 6c20 7265  est potential re
-0000ab00: 7375 6c74 2e0d 0a20 2020 2069 6e63 6c75  sult...    inclu
-0000ab10: 6465 5f6e 6567 6174 6976 655f 696e 7465  de_negative_inte
-0000ab20: 7276 616c 203a 2062 6f6f 6c65 616e 2c20  rval : boolean, 
-0000ab30: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
-0000ab40: 2020 4966 2054 7275 652c 2074 6865 6e20    If True, then 
-0000ab50: 616c 6c20 706f 7369 7469 7665 2061 6e64  all positive and
-0000ab60: 206e 6567 6174 6976 6520 7661 6c75 6573   negative values
-0000ab70: 2061 7265 2063 6f6e 7369 6465 7265 640d   are considered.
-0000ab80: 0a20 2020 2020 2020 2065 2e67 2e2c 203c  .        e.g., <
-0000ab90: 302e 3520 776f 756c 6420 6265 2063 6f6e  0.5 would be con
-0000aba0: 7665 7274 6564 2074 6f20 282d 6e70 2e69  verted to (-np.i
-0000abb0: 6e66 2c35 292e 0d0a 2020 2020 2020 2020  nf,5)...        
-0000abc0: 4966 2046 616c 7365 2c20 7468 656e 206f  If False, then o
-0000abd0: 6e6c 7920 6e6f 6e2d 6e65 6761 7469 7665  nly non-negative
-0000abe0: 2076 616c 7565 7320 6172 6520 636f 6e73   values are cons
-0000abf0: 6964 6572 6564 0d0a 2020 2020 2020 2020  idered..        
-0000ac00: 652e 672e 2c20 3c30 2e35 2077 6f75 6c64  e.g., <0.5 would
-0000ac10: 2062 6520 636f 6e76 6572 7465 6420 746f   be converted to
-0000ac20: 205b 302c 3529 2e0d 0a20 2020 2020 2020   [0,5)...       
-0000ac30: 2054 6869 7320 7365 7474 696e 6720 6f6e   This setting on
-0000ac40: 6c79 2061 6666 6563 7473 2072 6573 756c  ly affects resul
-0000ac50: 7473 2069 6620 666f 6375 735f 6869 6768  ts if focus_high
-0000ac60: 5f70 6f74 656e 7469 616c 2069 7320 4661  _potential is Fa
-0000ac70: 6c73 652e 0d0a 2020 2020 2020 2020 5468  lse...        Th
-0000ac80: 6520 6465 6661 756c 7420 6973 2046 616c  e default is Fal
-0000ac90: 7365 2e0d 0a20 2020 2070 7265 6369 7369  se...    precisi
-0000aca0: 6f6e 5f74 6f6c 6572 616e 6365 5f74 6f5f  on_tolerance_to_
-0000acb0: 6472 6f70 5f63 656e 736f 7220 3a20 666c  drop_censor : fl
-0000acc0: 6f61 742c 206f 7074 696f 6e61 6c0d 0a20  oat, optional.. 
-0000acd0: 2020 2020 2020 2054 6872 6573 686f 6c64         Threshold
-0000ace0: 2066 6f72 2072 6570 6f72 7469 6e67 2063   for reporting c
-0000acf0: 656e 736f 7265 6420 7673 206e 6f6e 2d63  ensored vs non-c
-0000ad00: 656e 736f 7265 6420 7265 7375 6c74 732e  ensored results.
-0000ad10: 0d0a 2020 2020 2020 2020 5573 696e 6720  ..        Using 
-0000ad20: 7468 6520 6465 6661 756c 742c 2061 2072  the default, a r
-0000ad30: 6573 756c 7420 7468 6174 2069 7320 6b6e  esult that is kn
-0000ad40: 6f77 6e20 746f 2062 6520 696e 2074 6865  own to be in the
-0000ad50: 2069 6e74 6572 7661 6c20 2830 2e33 2c20   interval (0.3, 
-0000ad60: 302e 3529 0d0a 2020 2020 2020 2020 776f  0.5)..        wo
-0000ad70: 756c 6420 6265 2072 6574 7572 6e65 6420  uld be returned 
-0000ad80: 6173 2030 2e34 2c20 7768 6572 6561 7320  as 0.4, whereas 
-0000ad90: 6120 746f 6c65 7261 6e63 6520 6f66 2030  a tolerance of 0
-0000ada0: 2077 6f75 6c64 2079 6965 6c64 2061 0d0a   would yield a..
-0000adb0: 2020 2020 2020 2020 7265 7375 6c74 206f          result o
-0000adc0: 6620 3c30 2e35 206f 7220 3e30 2e33 2064  f <0.5 or >0.3 d
-0000add0: 6570 656e 6469 6e67 206f 6e20 7468 6520  epending on the 
-0000ade0: 7661 6c75 6520 6f66 2066 6f63 7573 5f68  value of focus_h
-0000adf0: 6967 6865 7374 5f70 6f74 656e 7469 616c  ighest_potential
-0000ae00: 2e0d 0a20 2020 2020 2020 2054 6865 2064  ...        The d
-0000ae10: 6566 6175 6c74 2069 7320 302e 3235 2e0d  efault is 0.25..
-0000ae20: 0a20 2020 2070 7265 6369 7369 6f6e 5f72  .    precision_r
-0000ae30: 6f75 6e64 696e 6720 3a20 626f 6f6c 6561  ounding : boolea
-0000ae40: 6e2c 206f 7074 696f 6e61 6c0d 0a20 2020  n, optional..   
-0000ae50: 2020 2020 2049 6620 5472 7565 2c20 6120       If True, a 
-0000ae60: 726f 756e 6469 6e67 206d 6574 686f 6420  rounding method 
-0000ae70: 6973 2061 7070 6c69 6564 2074 6f20 726f  is applied to ro
-0000ae80: 756e 6420 7265 7375 6c74 7320 746f 2068  und results to h
-0000ae90: 6176 6520 6e6f 206d 6f72 650d 0a20 2020  ave no more..   
-0000aea0: 2020 2020 2064 6563 696d 616c 7320 7468       decimals th
-0000aeb0: 616e 2077 6861 7420 6361 6e20 6265 206d  an what can be m
-0000aec0: 6561 7375 7265 642e 0d0a 2020 2020 2020  easured...      
-0000aed0: 2020 5468 6520 6465 6661 756c 7420 6973    The default is
-0000aee0: 2054 7275 652e 0d0a 0d0a 2020 2020 5265   True.....    Re
-0000aef0: 7475 726e 730d 0a20 2020 202d 2d2d 2d2d  turns..    -----
-0000af00: 2d2d 0d0a 2020 2020 6466 203a 2044 6174  --..    df : Dat
-0000af10: 6146 7261 6d65 0d0a 2020 2020 2020 2020  aFrame..        
-0000af20: 4461 7461 4672 616d 6520 7468 6174 2063  DataFrame that c
-0000af30: 6f6e 7461 696e 7320 6361 6c63 756c 6174  ontains calculat
-0000af40: 6564 2070 6572 6365 6e74 696c 6573 0d0a  ed percentiles..
-0000af50: 0d0a 2020 2020 2727 270d 0a20 2020 200d  ..    '''..    .
-0000af60: 0a20 2020 2023 2043 7265 6174 6520 6120  .    # Create a 
-0000af70: 636f 7079 206f 6620 7468 6520 4461 7461  copy of the Data
-0000af80: 4672 616d 650d 0a20 2020 2064 6620 3d20  Frame..    df = 
-0000af90: 6466 2e63 6f70 7928 290d 0a20 2020 200d  df.copy()..    .
-0000afa0: 0a20 2020 2023 2053 706c 6974 2074 6865  .    # Split the
-0000afb0: 2072 6573 756c 7420 696e 746f 2063 656e   result into cen
-0000afc0: 736f 7220 616e 6420 6e75 6d65 7269 6320  sor and numeric 
-0000afd0: 636f 6d70 6f6e 656e 7473 0d0a 2020 2020  components..    
-0000afe0: 6466 203d 2072 6573 756c 745f 746f 5f63  df = result_to_c
-0000aff0: 6f6d 706f 6e65 6e74 7328 6466 2c72 6573  omponents(df,res
-0000b000: 756c 745f 636f 6c29 0d0a 2020 2020 0d0a  ult_col)..    ..
-0000b010: 2020 2020 2320 436f 6e76 6572 7420 7468      # Convert th
-0000b020: 6520 7265 7375 6c74 7320 6672 6f6d 2063  e results from c
-0000b030: 656e 736f 7220 616e 6420 6e75 6d65 7269  ensor and numeri
-0000b040: 6320 636f 6d70 6f6e 656e 7473 2074 6f20  c components to 
-0000b050: 616e 2069 6e74 6572 7661 6c20 7265 7072  an interval repr
-0000b060: 6573 656e 7461 7469 6f6e 0d0a 2020 2020  esentation..    
-0000b070: 6466 203d 2063 6f6d 706f 6e65 6e74 735f  df = components_
-0000b080: 746f 5f69 6e74 6572 7661 6c28 6466 2c20  to_interval(df, 
-0000b090: 696e 636c 7564 655f 6e65 6761 7469 7665  include_negative
-0000b0a0: 5f69 6e74 6572 7661 6c29 0d0a 2020 2020  _interval)..    
-0000b0b0: 0d0a 2020 2020 2320 5573 696e 6720 7468  ..    # Using th
-0000b0c0: 6520 696e 7465 7276 616c 732c 2064 6574  e intervals, det
-0000b0d0: 6572 6d69 6e65 2074 6865 2072 616e 6765  ermine the range
-0000b0e0: 206f 6620 706f 7373 6962 6c65 2070 6572   of possible per
-0000b0f0: 6365 6e74 696c 6573 0d0a 2020 2020 0d0a  centiles..    ..
-0000b100: 2020 2020 2320 4966 2074 6865 7265 2061      # If there a
-0000b110: 7265 206e 6f20 6772 6f75 7062 792d 636f  re no groupby-co
-0000b120: 6c75 6d6e 732c 2074 6865 6e20 7461 6b65  lumns, then take
-0000b130: 2070 6572 6365 6e74 696c 6520 6f66 2061   percentile of a
-0000b140: 6c6c 2072 6573 756c 7473 0d0a 2020 2020  ll results..    
-0000b150: 6966 206e 6f74 2067 726f 7570 6279 5f63  if not groupby_c
-0000b160: 6f6c 756d 6e73 3a0d 0a20 2020 2020 2020  olumns:..       
-0000b170: 2064 6620 3d20 7065 7263 656e 7469 6c65   df = percentile
-0000b180: 5f69 6e74 6572 7661 6c28 6466 2c20 6772  _interval(df, gr
-0000b190: 6f75 7062 795f 636f 6c75 6d6e 733d 5b5d  oupby_columns=[]
-0000b1a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1c0: 2020 2020 7065 7263 656e 7469 6c65 3d70      percentile=p
-0000b1d0: 6572 6365 6e74 696c 652c 0d0a 2020 2020  ercentile,..    
-0000b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1f0: 2020 2020 2020 2020 2020 2020 206d 6574               met
-0000b200: 686f 643d 6d65 7468 6f64 290d 0a20 2020  hod=method)..   
-0000b210: 2023 2049 6620 7468 6520 6772 6f75 7062   # If the groupb
-0000b220: 795f 636f 6c75 6d6e 7320 6973 2061 206c  y_columns is a l
-0000b230: 6973 7420 6f66 206c 6973 7473 2c20 7468  ist of lists, th
-0000b240: 656e 2070 6572 666f 726d 206d 756c 7469  en perform multi
-0000b250: 706c 6520 7065 7263 656e 7469 6c65 730d  ple percentiles.
-0000b260: 0a20 2020 2065 6c69 6620 6973 696e 7374  .    elif isinst
-0000b270: 616e 6365 2867 726f 7570 6279 5f63 6f6c  ance(groupby_col
-0000b280: 756d 6e73 5b30 5d2c 6c69 7374 293a 0d0a  umns[0],list):..
-0000b290: 2020 2020 2020 2020 666f 7220 6772 6f75          for grou
-0000b2a0: 7069 6e67 2069 6e20 6772 6f75 7062 795f  ping in groupby_
-0000b2b0: 636f 6c75 6d6e 733a 0d0a 2020 2020 2020  columns:..      
-0000b2c0: 2020 2020 2020 2320 4f6e 6c79 2061 7070        # Only app
-0000b2d0: 6c79 2070 6572 6365 6e74 696c 6520 746f  ly percentile to
-0000b2e0: 2066 696e 616c 2067 726f 7570 696e 670d   final grouping.
-0000b2f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000b300: 6772 6f75 7069 6e67 203d 3d20 6772 6f75  grouping == grou
-0000b310: 7062 795f 636f 6c75 6d6e 735b 2d31 5d3a  pby_columns[-1]:
-0000b320: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b330: 2020 2320 5573 696e 6720 7468 6520 696e    # Using the in
-0000b340: 7465 7276 616c 732c 2064 6574 6572 6d69  tervals, determi
-0000b350: 6e65 2074 6865 2072 616e 6765 206f 6620  ne the range of 
-0000b360: 706f 7373 6962 6c65 2070 6572 6365 6e74  possible percent
-0000b370: 696c 6573 0d0a 2020 2020 2020 2020 2020  iles..          
-0000b380: 2020 2020 2020 6466 203d 2070 6572 6365        df = perce
-0000b390: 6e74 696c 655f 696e 7465 7276 616c 2864  ntile_interval(d
-0000b3a0: 662c 2067 726f 7570 696e 672c 2070 6572  f, grouping, per
-0000b3b0: 6365 6e74 696c 652c 206d 6574 686f 6429  centile, method)
-0000b3c0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0000b3d0: 4170 706c 7920 6d65 6469 616e 2074 6f20  Apply median to 
-0000b3e0: 616c 6c20 7072 696f 7220 6772 6f75 7069  all prior groupi
-0000b3f0: 6e67 730d 0a20 2020 2020 2020 2020 2020  ngs..           
-0000b400: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0000b410: 2020 2020 2020 2020 2320 5573 696e 6720          # Using 
-0000b420: 7468 6520 696e 7465 7276 616c 732c 2064  the intervals, d
-0000b430: 6574 6572 6d69 6e65 2074 6865 2072 616e  etermine the ran
-0000b440: 6765 206f 6620 706f 7373 6962 6c65 206d  ge of possible m
-0000b450: 6564 6961 6e73 0d0a 2020 2020 2020 2020  edians..        
-0000b460: 2020 2020 2020 2020 6466 203d 2070 6572          df = per
-0000b470: 6365 6e74 696c 655f 696e 7465 7276 616c  centile_interval
-0000b480: 2864 662c 2067 726f 7570 696e 672c 2035  (df, grouping, 5
-0000b490: 302c 206d 6574 686f 6429 0d0a 2020 2020  0, method)..    
-0000b4a0: 2320 456c 7365 2074 6865 2067 726f 7570  # Else the group
-0000b4b0: 6279 5f63 6f6c 756d 6e73 2069 7320 6120  by_columns is a 
-0000b4c0: 6c69 7374 206f 6620 636f 6c75 6d6e 206e  list of column n
-0000b4d0: 616d 6573 0d0a 2020 2020 656c 7365 3a0d  ames..    else:.
-0000b4e0: 0a20 2020 2020 2020 2064 6620 3d20 7065  .        df = pe
-0000b4f0: 7263 656e 7469 6c65 5f69 6e74 6572 7661  rcentile_interva
-0000b500: 6c28 6466 2c20 6772 6f75 7062 795f 636f  l(df, groupby_co
-0000b510: 6c75 6d6e 732c 2070 6572 6365 6e74 696c  lumns, percentil
-0000b520: 652c 206d 6574 686f 6429 0d0a 2020 2020  e, method)..    
-0000b530: 0d0a 2020 2020 2320 436f 6e76 6572 7420  ..    # Convert 
-0000b540: 7468 6520 696e 7465 7276 616c 2066 6f72  the interval for
-0000b550: 2074 6865 206d 696e 696d 756d 2069 6e74   the minimum int
-0000b560: 6f20 6365 6e73 6f72 2061 6e64 206e 756d  o censor and num
-0000b570: 6572 6963 206e 6f74 6174 696f 6e0d 0a20  eric notation.. 
-0000b580: 2020 2064 6620 3d20 696e 7465 7276 616c     df = interval
-0000b590: 5f74 6f5f 636f 6d70 6f6e 656e 7473 2864  _to_components(d
-0000b5a0: 662c 0d0a 2020 2020 2020 2020 2020 2020  f,..            
-0000b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b5c0: 2020 2020 666f 6375 735f 6869 6768 5f70      focus_high_p
-0000b5d0: 6f74 656e 7469 616c 203d 2066 6f63 7573  otential = focus
-0000b5e0: 5f68 6967 685f 706f 7465 6e74 6961 6c2c  _high_potential,
-0000b5f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00007fa0: 2020 2020 2020 7072 6563 6973 696f 6e5f        precision_
+00007fb0: 746f 6c65 7261 6e63 655f 746f 5f64 726f  tolerance_to_dro
+00007fc0: 705f 6365 6e73 6f72 203d 2070 7265 6369  p_censor = preci
+00007fd0: 7369 6f6e 5f74 6f6c 6572 616e 6365 5f74  sion_tolerance_t
+00007fe0: 6f5f 6472 6f70 5f63 656e 736f 7229 0d0a  o_drop_censor)..
+00007ff0: 2020 2020 0d0a 2020 2020 2320 4372 6561      ..    # Crea
+00008000: 7465 2069 6e74 6572 7661 6c20 6e6f 7461  te interval nota
+00008010: 7469 6f6e 2066 6f72 2074 6865 2061 7665  tion for the ave
+00008020: 7261 6765 0d0a 2020 2020 6466 203d 2069  rage..    df = i
+00008030: 6e74 6572 7661 6c5f 6e6f 7461 7469 6f6e  nterval_notation
+00008040: 2864 662c 2070 7265 6369 7369 6f6e 5f72  (df, precision_r
+00008050: 6f75 6e64 696e 6729 0d0a 2020 2020 0d0a  ounding)..    ..
+00008060: 2020 2020 2320 436f 6d62 696e 6520 7468      # Combine th
+00008070: 6520 6365 6e73 6f72 2061 6e64 206e 756d  e censor and num
+00008080: 6572 6963 2063 6f6d 706f 6e65 6e74 7320  eric components 
+00008090: 696e 746f 2061 2072 6573 756c 740d 0a20  into a result.. 
+000080a0: 2020 2064 6620 3d20 636f 6d70 6f6e 656e     df = componen
+000080b0: 7473 5f74 6f5f 7265 7375 6c74 2864 662c  ts_to_result(df,
+000080c0: 2070 7265 6369 7369 6f6e 5f72 6f75 6e64   precision_round
+000080d0: 696e 6729 0d0a 2020 2020 0d0a 2020 2020  ing)..    ..    
+000080e0: 2320 4472 6f70 2077 6f72 6b69 6e67 2063  # Drop working c
+000080f0: 6f6c 756d 6e73 0d0a 2020 2020 6466 203d  olumns..    df =
+00008100: 2064 662e 6472 6f70 2864 662e 6669 6c74   df.drop(df.filt
+00008110: 6572 2872 6567 6578 3d27 5f5f 2729 2e63  er(regex='__').c
+00008120: 6f6c 756d 6e73 2c20 6178 6973 3d31 290d  olumns, axis=1).
+00008130: 0a20 2020 200d 0a20 2020 2023 2052 656f  .    ..    # Reo
+00008140: 7264 6572 2063 6f6c 756d 6e73 0d0a 2020  rder columns..  
+00008150: 2020 666f 7220 636f 6c20 696e 205b 7374    for col in [st
+00008160: 6174 5f63 6f6c 2c72 6573 756c 745f 636f  at_col,result_co
+00008170: 6c2c 6365 6e73 6f72 5f63 6f6c 2c6e 756d  l,censor_col,num
+00008180: 6572 6963 5f63 6f6c 2c69 6e74 6572 7661  eric_col,interva
+00008190: 6c5f 636f 6c5d 3a0d 0a20 2020 2020 2020  l_col]:..       
+000081a0: 2064 665b 636f 6c5d 203d 2064 662e 706f   df[col] = df.po
+000081b0: 7028 636f 6c29 0d0a 2020 2020 0d0a 2020  p(col)..    ..  
+000081c0: 2020 7265 7475 726e 2064 660d 0a0d 0a23    return df....#
+000081d0: 2525 2050 6572 6365 6e74 696c 6520 5265  %% Percentile Re
+000081e0: 7375 6c74 0d0a 0d0a 6465 6620 7065 7263  sult....def perc
+000081f0: 656e 7469 6c65 5f69 6e74 6572 7661 6c28  entile_interval(
+00008200: 6466 2c0d 0a20 2020 2020 2020 2020 2020  df,..           
+00008210: 2020 2020 2020 2020 2020 2020 2067 726f               gro
+00008220: 7570 6279 5f63 6f6c 756d 6e73 2c0d 0a20  upby_columns,.. 
+00008230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008240: 2020 2020 2020 2070 6572 6365 6e74 696c         percentil
+00008250: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00008260: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+00008270: 6f64 203d 2027 6861 7a65 6e27 2c29 3a0d  od = 'hazen',):.
+00008280: 0a20 2020 2027 2727 0d0a 2020 2020 4120  .    '''..    A 
+00008290: 6675 6e63 7469 6f6e 2074 6861 7420 616e  function that an
+000082a0: 616c 7973 6573 2074 6865 2069 6e74 6572  alyses the inter
+000082b0: 7661 6c20 6e6f 7461 7469 6f6e 2066 6f72  val notation for
+000082c0: 6d20 6f66 2072 6573 756c 7473 2072 6574  m of results ret
+000082d0: 7572 6e65 640d 0a20 2020 2066 726f 6d20  urned..    from 
+000082e0: 636f 6d70 6f6e 656e 7473 5f74 6f5f 696e  components_to_in
+000082f0: 7465 7276 616c 2074 6f20 6765 6e65 7261  terval to genera
+00008300: 7465 2061 206e 6577 2069 6e74 6572 7661  te a new interva
+00008310: 6c20 666f 7220 7065 7263 656e 7469 6c65  l for percentile
+00008320: 732e 2047 726f 7570 730d 0a20 2020 206f  s. Groups..    o
+00008330: 6620 7265 7375 6c74 7320 6361 6e20 6265  f results can be
+00008340: 2064 6566 696e 6564 2062 7920 696e 636c   defined by incl
+00008350: 7564 696e 6720 7468 6520 636f 6c75 6d6e  uding the column
+00008360: 7320 7468 6174 2073 686f 756c 6420 6265  s that should be
+00008370: 2075 7365 6420 746f 0d0a 2020 2020 6372   used to..    cr
+00008380: 6561 7465 2067 726f 7570 732e 0d0a 0d0a  eate groups.....
+00008390: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
+000083a0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a      ----------..
+000083b0: 2020 2020 6466 203a 2044 6174 6146 7261      df : DataFra
+000083c0: 6d65 0d0a 2020 2020 2020 2020 4461 7461  me..        Data
+000083d0: 4672 616d 6520 7468 6174 2063 6f6e 7461  Frame that conta
+000083e0: 696e 7320 7265 7375 6c74 7320 696e 2061  ins results in a
+000083f0: 2073 7065 6369 6669 6320 696e 7465 7276   specific interv
+00008400: 616c 206e 6f74 6174 696f 6e2e 0d0a 2020  al notation...  
+00008410: 2020 6772 6f75 7062 795f 636f 6c75 6d6e    groupby_column
+00008420: 7320 3a20 6c69 7374 206f 6620 7374 7269  s : list of stri
+00008430: 6e67 730d 0a20 2020 2020 2020 204c 6973  ngs..        Lis
+00008440: 7420 6f66 2063 6f6c 756d 6e20 6e61 6d65  t of column name
+00008450: 7320 7468 6174 2073 686f 756c 6420 6265  s that should be
+00008460: 2075 7365 6420 746f 2063 7265 6174 6520   used to create 
+00008470: 6772 6f75 7073 2e0d 0a20 2020 2070 6572  groups...    per
+00008480: 6365 6e74 696c 6520 3a20 666c 6f61 740d  centile : float.
+00008490: 0a20 2020 2020 2020 2054 6865 2064 6573  .        The des
+000084a0: 6972 6564 2070 6572 6365 6e74 696c 652e  ired percentile.
+000084b0: 2056 616c 7565 7320 7368 6f75 6c64 2062   Values should b
+000084c0: 6520 6265 7477 6565 6e20 3020 616e 6420  e between 0 and 
+000084d0: 3130 302e 0d0a 2020 2020 6d65 7468 6f64  100...    method
+000084e0: 203a 2073 7472 696e 670d 0a20 2020 2020   : string..     
+000084f0: 2020 2054 6865 2070 6572 6365 6e74 696c     The percentil
+00008500: 6520 6d65 7468 6f64 2e20 5468 6520 6f70  e method. The op
+00008510: 7469 6f6e 7320 616e 6420 6465 6669 6e69  tions and defini
+00008520: 7469 6f6e 7320 636f 6d65 2066 726f 6d3a  tions come from:
+00008530: 0d0a 2020 2020 2020 2020 2020 2020 6874  ..            ht
+00008540: 7470 733a 2f2f 656e 7669 726f 6e6d 656e  tps://environmen
+00008550: 742e 676f 7674 2e6e 7a2f 6173 7365 7473  t.govt.nz/assets
+00008560: 2f50 7562 6c69 6361 7469 6f6e 732f 4669  /Publications/Fi
+00008570: 6c65 732f 6861 7a65 6e2d 7065 7263 656e  les/hazen-percen
+00008580: 7469 6c65 2d63 616c 6375 6c61 746f 722d  tile-calculator-
+00008590: 322e 786c 730d 0a20 2020 2020 2020 2020  2.xls..         
+000085a0: 2020 204f 7074 696f 6e73 2069 6e63 6c75     Options inclu
+000085b0: 6465 2074 6865 2066 6f6c 6c6f 7769 6e67  de the following
+000085c0: 2c20 6f72 6465 7265 6420 6672 6f6d 206c  , ordered from l
+000085d0: 6172 6765 7374 2074 6f20 736d 616c 6c65  argest to smalle
+000085e0: 7374 2072 6573 756c 742e 0d0a 2020 2020  st result...    
+000085f0: 2020 2020 2020 2020 2d20 7765 6962 616c          - weibal
+00008600: 6c0d 0a20 2020 2020 2020 2020 2020 202d  l..            -
+00008610: 2074 756b 6579 0d0a 2020 2020 2020 2020   tukey..        
+00008620: 2020 2020 2d20 626c 6f6d 0d0a 2020 2020      - blom..    
+00008630: 2020 2020 2020 2020 2d20 6861 7a65 6e0d          - hazen.
+00008640: 0a20 2020 2020 2020 2020 2020 202d 2065  .            - e
+00008650: 7863 656c 0d0a 2020 2020 2020 2020 5468  xcel..        Th
+00008660: 6520 6465 6661 756c 7420 6973 2068 617a  e default is haz
+00008670: 656e 2e0d 0a0d 0a20 2020 2052 6574 7572  en.....    Retur
+00008680: 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d 2d0d  ns..    -------.
+00008690: 0a20 2020 2064 6620 3a20 4461 7461 4672  .    df : DataFr
+000086a0: 616d 650d 0a20 2020 2020 2020 2044 6174  ame..        Dat
+000086b0: 6146 7261 6d65 2074 6861 7420 6861 7320  aFrame that has 
+000086c0: 7468 6520 696e 7465 7276 616c 2066 6f72  the interval for
+000086d0: 2074 6865 2070 6572 6365 6e74 696c 6520   the percentile 
+000086e0: 2866 6f72 2065 6163 6820 6772 6f75 7020  (for each group 
+000086f0: 6966 0d0a 2020 2020 2020 2020 636f 6c75  if..        colu
+00008700: 6d6e 206e 616d 6573 2061 7265 2070 726f  mn names are pro
+00008710: 7669 6465 6420 666f 7220 6772 6f75 7069  vided for groupi
+00008720: 6e67 290d 0a0d 0a20 2020 2027 2727 0d0a  ng)....    '''..
+00008730: 2020 2020 0d0a 2020 2020 2320 4372 6561      ..    # Crea
+00008740: 7465 2061 2063 6f70 7920 6f66 2074 6865  te a copy of the
+00008750: 2044 6174 6146 7261 6d65 0d0a 2020 2020   DataFrame..    
+00008760: 6466 203d 2064 662e 636f 7079 2829 2e72  df = df.copy().r
+00008770: 6573 6574 5f69 6e64 6578 2829 0d0a 2020  eset_index()..  
+00008780: 2020 0d0a 2020 2020 2320 4368 6563 6b20    ..    # Check 
+00008790: 7468 6520 7065 7263 656e 7469 6c65 2069  the percentile i
+000087a0: 7320 6265 7477 6565 6e20 3020 616e 6420  s between 0 and 
+000087b0: 310d 0a20 2020 2069 6620 7065 7263 656e  1..    if percen
+000087c0: 7469 6c65 203c 2030 206f 7220 7065 7263  tile < 0 or perc
+000087d0: 656e 7469 6c65 203e 2031 3030 3a0d 0a20  entile > 100:.. 
+000087e0: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+000087f0: 6570 7469 6f6e 2866 2750 6572 6365 6e74  eption(f'Percent
+00008800: 696c 6520 6f75 7420 6f66 2072 616e 6765  ile out of range
+00008810: 2e20 4174 7465 6d70 7465 6420 7065 7263  . Attempted perc
+00008820: 656e 7469 6c65 3a20 7b70 6572 6365 6e74  entile: {percent
+00008830: 696c 657d 2729 0d0a 2020 2020 0d0a 2020  ile}')..    ..  
+00008840: 2020 2320 4372 6561 7465 2063 6f6c 756d    # Create colum
+00008850: 6e20 7468 6174 2069 6e64 6963 6174 6573  n that indicates
+00008860: 2074 6865 2067 656e 6572 6174 6564 2073   the generated s
+00008870: 7461 7469 7374 6963 2061 6e64 2061 7070  tatistic and app
+00008880: 656e 6420 746f 2067 726f 7570 696e 6720  end to grouping 
+00008890: 6c69 7374 0d0a 2020 2020 6466 5b73 7461  list..    df[sta
+000088a0: 745f 636f 6c5d 203d 2066 2750 6572 6365  t_col] = f'Perce
+000088b0: 6e74 696c 652d 7b70 6572 6365 6e74 696c  ntile-{percentil
+000088c0: 657d 270d 0a20 2020 2067 726f 7570 6279  e}'..    groupby
+000088d0: 5f63 6f6c 756d 6e73 2e61 7070 656e 6428  _columns.append(
+000088e0: 7374 6174 5f63 6f6c 290d 0a20 2020 200d  stat_col)..    .
+000088f0: 0a20 2020 2023 2043 6f6e 7665 7274 2070  .    # Convert p
+00008900: 6572 6365 6e74 696c 6520 746f 2062 6520  ercentile to be 
+00008910: 6265 7477 6565 6e20 3020 616e 6420 310d  between 0 and 1.
+00008920: 0a20 2020 2070 6572 6365 6e74 696c 6520  .    percentile 
+00008930: 3d20 7065 7263 656e 7469 6c65 2f31 3030  = percentile/100
+00008940: 0d0a 2020 2020 0d0a 2020 2020 2320 4465  ..    ..    # De
+00008950: 7465 726d 696e 6520 7369 7a65 206f 6620  termine size of 
+00008960: 6561 6368 2067 726f 7570 0d0a 2020 2020  each group..    
+00008970: 6466 5b27 5f5f 5369 7a65 5f5f 275d 203d  df['__Size__'] =
+00008980: 2064 662e 6772 6f75 7062 7928 6772 6f75   df.groupby(grou
+00008990: 7062 795f 636f 6c75 6d6e 7329 2e74 7261  pby_columns).tra
+000089a0: 6e73 666f 726d 2827 7369 7a65 2729 0d0a  nsform('size')..
+000089b0: 2020 2020 0d0a 2020 2020 2320 5365 7420      ..    # Set 
+000089c0: 7661 6c75 6573 2066 6f72 2070 6572 6365  values for perce
+000089d0: 6e74 696c 6520 6d65 7468 6f64 730d 0a20  ntile methods.. 
+000089e0: 2020 206d 6574 686f 645f 6469 6374 203d     method_dict =
+000089f0: 207b 2777 6569 6261 6c6c 273a 302e 302c   {'weiball':0.0,
+00008a00: 2027 7475 6b65 7927 3a31 2f33 2c20 2762   'tukey':1/3, 'b
+00008a10: 6c6f 6d27 3a33 2f38 2c20 2768 617a 656e  lom':3/8, 'hazen
+00008a20: 273a 312f 322c 2027 6578 6365 6c27 3a31  ':1/2, 'excel':1
+00008a30: 2e30 7d0d 0a20 2020 2023 2068 7474 7073  .0}..    # https
+00008a40: 3a2f 2f65 6e2e 7769 6b69 7065 6469 612e  ://en.wikipedia.
+00008a50: 6f72 672f 7769 6b69 2f50 6572 6365 6e74  org/wiki/Percent
+00008a60: 696c 650d 0a20 2020 2043 203d 206d 6574  ile..    C = met
+00008a70: 686f 645f 6469 6374 5b6d 6574 686f 645d  hod_dict[method]
+00008a80: 0d0a 2020 2020 0d0a 2020 2020 2320 4361  ..    ..    # Ca
+00008a90: 6c63 756c 6174 6520 6d69 6e69 6d75 6d20  lculate minimum 
+00008aa0: 6461 7461 2073 697a 6520 666f 7220 7065  data size for pe
+00008ab0: 7263 656e 7469 6c65 206d 6574 686f 6420  rcentile method 
+00008ac0: 746f 200d 0a20 2020 2023 2065 6e73 7572  to ..    # ensur
+00008ad0: 6520 7261 6e6b 2069 7320 6174 206c 6561  e rank is at lea
+00008ae0: 7374 2031 2061 6e64 206e 6f20 6d6f 7265  st 1 and no more
+00008af0: 2074 6861 6e20 6c65 6e28 6461 7461 290d   than len(data).
+00008b00: 0a20 2020 206d 696e 696d 756d 5f73 697a  .    minimum_siz
+00008b10: 6520 3d20 726f 756e 6428 4320 2b20 2831  e = round(C + (1
+00008b20: 2d43 292a 6d61 7828 2831 2d70 6572 6365  -C)*max((1-perce
+00008b30: 6e74 696c 6529 2f70 6572 6365 6e74 696c  ntile)/percentil
+00008b40: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00008b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008b60: 2020 2020 2020 2020 2020 2070 6572 6365             perce
+00008b70: 6e74 696c 652f 2831 2d70 6572 6365 6e74  ntile/(1-percent
+00008b80: 696c 6529 292c 3130 290d 0a20 2020 200d  ile)),10)..    .
+00008b90: 0a20 2020 2023 204f 6e6c 7920 636f 6e73  .    # Only cons
+00008ba0: 6964 6572 2067 726f 7570 7320 7468 6174  ider groups that
+00008bb0: 206d 6565 7420 7468 6520 6d69 6e69 6d75   meet the minimu
+00008bc0: 6d20 7369 7a65 2072 6571 7569 7265 6d65  m size requireme
+00008bd0: 6e74 0d0a 2020 2020 6466 203d 2064 665b  nt..    df = df[
+00008be0: 6466 5b27 5f5f 5369 7a65 5f5f 275d 203e  df['__Size__'] >
+00008bf0: 3d20 6d69 6e69 6d75 6d5f 7369 7a65 5d0d  = minimum_size].
+00008c00: 0a20 2020 200d 0a20 2020 2023 2044 6574  .    ..    # Det
+00008c10: 6572 6d69 6e65 206c 6566 7420 626f 756e  ermine left boun
+00008c20: 6420 616e 6420 626f 756e 6461 7279 2066  d and boundary f
+00008c30: 6f72 2065 6163 6820 6772 6f75 700d 0a20  or each group.. 
+00008c40: 2020 200d 0a20 2020 2023 2043 6861 6e67     ..    # Chang
+00008c50: 6520 6e6f 7461 7469 6f6e 206f 6620 2743  e notation of 'C
+00008c60: 6c6f 7365 6427 2061 6e64 2027 4f70 656e  losed' and 'Open
+00008c70: 2720 626f 756e 6461 7269 6573 2074 6f20  ' boundaries to 
+00008c80: 3020 616e 6420 312c 2072 6573 7065 6374  0 and 1, respect
+00008c90: 6976 656c 790d 0a20 2020 2023 2055 7365  ively..    # Use
+00008ca0: 2030 2066 6f72 2063 6c6f 7365 6420 746f   0 for closed to
+00008cb0: 2065 6e73 7572 6520 7468 6174 2063 6c6f   ensure that clo
+00008cc0: 7365 6420 626f 756e 6461 7269 6573 2061  sed boundaries a
+00008cd0: 7265 2073 6f72 7465 6420 6c65 7373 2074  re sorted less t
+00008ce0: 6861 6e20 6f70 656e 0d0a 2020 2020 2320  han open..    # 
+00008cf0: 626f 756e 6461 7269 6573 2077 6865 6e20  boundaries when 
+00008d00: 7468 6520 6c65 6674 2062 6f75 6e64 2069  the left bound i
+00008d10: 7320 7469 6564 0d0a 2020 2020 6466 5b6c  s tied..    df[l
+00008d20: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
+00008d30: 5d20 3d20 6466 5b6c 6566 745f 626f 756e  ] = df[left_boun
+00008d40: 6461 7279 5f63 6f6c 5d2e 7265 706c 6163  dary_col].replac
+00008d50: 6528 5b27 436c 6f73 6564 272c 274f 7065  e(['Closed','Ope
+00008d60: 6e27 5d2c 205b 302c 315d 290d 0a20 2020  n'], [0,1])..   
+00008d70: 200d 0a20 2020 2023 2053 6f72 7420 6c65   ..    # Sort le
+00008d80: 6674 2062 6f75 6e64 2076 616c 7565 730d  ft bound values.
+00008d90: 0a20 2020 206c 6566 7420 3d20 6466 2e63  .    left = df.c
+00008da0: 6f70 7928 295b 6772 6f75 7062 795f 636f  opy()[groupby_co
+00008db0: 6c75 6d6e 732b 5b27 5f5f 5369 7a65 5f5f  lumns+['__Size__
+00008dc0: 272c 6c65 6674 5f62 6f75 6e64 6172 795f  ',left_boundary_
+00008dd0: 636f 6c2c 6c65 6674 5f62 6f75 6e64 5f63  col,left_bound_c
+00008de0: 6f6c 5d5d 2e73 6f72 745f 7661 6c75 6573  ol]].sort_values
+00008df0: 2862 793d 5b6c 6566 745f 626f 756e 645f  (by=[left_bound_
+00008e00: 636f 6c2c 6c65 6674 5f62 6f75 6e64 6172  col,left_boundar
+00008e10: 795f 636f 6c5d 290d 0a20 2020 200d 0a20  y_col])..    .. 
+00008e20: 2020 2023 2041 6464 2069 6e64 6578 2066     # Add index f
+00008e30: 6f72 2065 6163 6820 6772 6f75 700d 0a20  or each group.. 
+00008e40: 2020 206c 6566 745b 275f 5f49 6e64 6578     left['__Index
+00008e50: 5f5f 275d 203d 206c 6566 742e 6772 6f75  __'] = left.grou
+00008e60: 7062 7928 6772 6f75 7062 795f 636f 6c75  pby(groupby_colu
+00008e70: 6d6e 7329 2e63 756d 636f 756e 7428 2920  mns).cumcount() 
+00008e80: 2b20 310d 0a20 2020 200d 0a20 2020 2023  + 1..    ..    #
+00008e90: 2044 6574 6572 6d69 6e65 2074 6865 2072   Determine the r
+00008ea0: 616e 6b20 696e 2065 6163 6820 6772 6f75  ank in each grou
+00008eb0: 7020 666f 7220 7468 6520 7065 7263 656e  p for the percen
+00008ec0: 7469 6c65 0d0a 2020 2020 6c65 6674 5b27  tile..    left['
+00008ed0: 5f5f 5261 6e6b 5f5f 275d 203d 2072 6f75  __Rank__'] = rou
+00008ee0: 6e64 2843 202b 2070 6572 6365 6e74 696c  nd(C + percentil
+00008ef0: 652a 286c 6566 745b 275f 5f53 697a 655f  e*(left['__Size_
+00008f00: 5f27 5d20 2b20 3120 2d20 322a 4329 2c38  _'] + 1 - 2*C),8
+00008f10: 290d 0a20 2020 200d 0a20 2020 2023 2047  )..    ..    # G
+00008f20: 656e 6572 6174 6520 7072 6f78 696d 6974  enerate proximit
+00008f30: 7920 6f66 2065 6163 6820 7265 7375 6c74  y of each result
+00008f40: 2074 6f20 7065 7263 656e 7469 6c65 2072   to percentile r
+00008f50: 616e 6b20 7573 696e 6720 7468 6520 696e  ank using the in
+00008f60: 6465 780d 0a20 2020 206c 6566 745b 275f  dex..    left['_
+00008f70: 5f50 726f 7869 6d69 7479 5f5f 275d 203d  _Proximity__'] =
+00008f80: 2030 0d0a 2020 2020 0d0a 2020 2020 636f   0..    ..    co
+00008f90: 6e64 6974 696f 6e73 203d 205b 0d0a 2020  nditions = [..  
+00008fa0: 2020 2020 2020 2320 4966 2074 6865 2070        # If the p
+00008fb0: 6572 6365 6e74 696c 6520 7261 6e6b 2069  ercentile rank i
+00008fc0: 7320 6120 7768 6f6c 6520 6e75 6d62 6572  s a whole number
+00008fd0: 2c20 7468 656e 2075 7365 2074 6861 7420  , then use that 
+00008fe0: 696e 6465 7820 7265 7375 6c74 0d0a 2020  index result..  
+00008ff0: 2020 2020 2020 286c 6566 745b 275f 5f52        (left['__R
+00009000: 616e 6b5f 5f27 5d20 3d3d 206c 6566 745b  ank__'] == left[
+00009010: 275f 5f49 6e64 6578 5f5f 275d 292c 0d0a  '__Index__']),..
+00009020: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
+00009030: 2070 6572 6365 6e74 696c 6520 7261 6e6b   percentile rank
+00009040: 2069 7320 6c65 7373 2074 6861 6e20 3120   is less than 1 
+00009050: 6162 6f76 6520 7468 6520 696e 6465 7820  above the index 
+00009060: 7661 6c75 652c 0d0a 2020 2020 2020 2020  value,..        
+00009070: 2320 7468 656e 2061 7373 6967 6e20 7468  # then assign th
+00009080: 6520 6170 7072 6f70 7269 6174 6520 636f  e appropriate co
+00009090: 6e74 7269 6275 7469 6f6e 2074 6f20 7468  ntribution to th
+000090a0: 6174 2069 6e64 6578 2076 616c 7565 0d0a  at index value..
+000090b0: 2020 2020 2020 2020 286c 6566 745b 275f          (left['_
+000090c0: 5f52 616e 6b5f 5f27 5d20 2d20 6c65 6674  _Rank__'] - left
+000090d0: 5b27 5f5f 496e 6465 785f 5f27 5d29 2e62  ['__Index__']).b
+000090e0: 6574 7765 656e 2830 2c31 2c69 6e63 6c75  etween(0,1,inclu
+000090f0: 7369 7665 3d27 6e65 6974 6865 7227 292c  sive='neither'),
+00009100: 0d0a 2020 2020 2020 2020 2320 4966 2074  ..        # If t
+00009110: 6865 2070 6572 6365 6e74 696c 6520 7261  he percentile ra
+00009120: 6e6b 2069 7320 6c65 7373 2074 6861 6e20  nk is less than 
+00009130: 3120 6265 6c6f 7720 7468 6520 696e 6465  1 below the inde
+00009140: 7820 7661 6c75 652c 0d0a 2020 2020 2020  x value,..      
+00009150: 2020 2320 7468 656e 2061 7373 6967 6e20    # then assign 
+00009160: 7468 6520 6170 7072 6f70 7269 6174 6520  the appropriate 
+00009170: 636f 6e74 7269 6275 7469 6f6e 2074 6f20  contribution to 
+00009180: 7468 6174 2069 6e64 6578 2076 616c 7565  that index value
+00009190: 0d0a 2020 2020 2020 2020 286c 6566 745b  ..        (left[
+000091a0: 275f 5f49 6e64 6578 5f5f 275d 202d 206c  '__Index__'] - l
+000091b0: 6566 745b 275f 5f52 616e 6b5f 5f27 5d29  eft['__Rank__'])
+000091c0: 2e62 6574 7765 656e 2830 2c31 2c69 6e63  .between(0,1,inc
+000091d0: 6c75 7369 7665 3d27 6e65 6974 6865 7227  lusive='neither'
+000091e0: 290d 0a20 2020 2020 2020 205d 0d0a 2020  )..        ]..  
+000091f0: 2020 0d0a 2020 2020 7265 7375 6c74 7320    ..    results 
+00009200: 3d20 5b0d 0a20 2020 2020 2020 2031 2c0d  = [..        1,.
+00009210: 0a20 2020 2020 2020 2031 202d 2028 6c65  .        1 - (le
+00009220: 6674 5b27 5f5f 5261 6e6b 5f5f 275d 202d  ft['__Rank__'] -
+00009230: 206c 6566 745b 275f 5f49 6e64 6578 5f5f   left['__Index__
+00009240: 275d 292c 0d0a 2020 2020 2020 2020 3120  ']),..        1 
+00009250: 2d20 286c 6566 745b 275f 5f49 6e64 6578  - (left['__Index
+00009260: 5f5f 275d 202d 206c 6566 745b 275f 5f52  __'] - left['__R
+00009270: 616e 6b5f 5f27 5d29 2c0d 0a20 2020 2020  ank__']),..     
+00009280: 2020 205d 0d0a 2020 2020 0d0a 2020 2020     ]..    ..    
+00009290: 6c65 6674 5b27 5f5f 5072 6f78 696d 6974  left['__Proximit
+000092a0: 795f 5f27 5d20 3d20 6e70 2e73 656c 6563  y__'] = np.selec
+000092b0: 7428 636f 6e64 6974 696f 6e73 2c20 7265  t(conditions, re
+000092c0: 7375 6c74 732c 206e 702e 6e61 6e29 0d0a  sults, np.nan)..
+000092d0: 2020 2020 0d0a 2020 2020 2320 4472 6f70      ..    # Drop
+000092e0: 206e 6f6e 2d63 6f6e 7472 6962 7574 696e   non-contributin
+000092f0: 6720 726f 7773 0d0a 2020 2020 6c65 6674  g rows..    left
+00009300: 203d 206c 6566 745b 6c65 6674 5b27 5f5f   = left[left['__
+00009310: 5072 6f78 696d 6974 795f 5f27 5d20 3e20  Proximity__'] > 
+00009320: 305d 0d0a 2020 2020 0d0a 2020 2020 2320  0]..    ..    # 
+00009330: 4361 6c63 756c 6174 6520 636f 6e74 7269  Calculate contri
+00009340: 6275 7469 6f6e 2066 6f72 2069 6e64 6578  bution for index
+00009350: 2076 616c 7565 7320 7468 6174 2063 6f6e   values that con
+00009360: 7472 6962 7574 6520 746f 2074 6865 2072  tribute to the r
+00009370: 6573 756c 740d 0a20 2020 206c 6566 745b  esult..    left[
+00009380: 275f 5f43 6f6e 7472 6962 7574 696f 6e5f  '__Contribution_
+00009390: 5f27 5d20 3d20 6c65 6674 5b27 5f5f 5072  _'] = left['__Pr
+000093a0: 6f78 696d 6974 795f 5f27 5d20 2a20 6c65  oximity__'] * le
+000093b0: 6674 5b6c 6566 745f 626f 756e 645f 636f  ft[left_bound_co
+000093c0: 6c5d 0d0a 2020 2020 0d0a 2020 2020 2320  l]..    ..    # 
+000093d0: 4465 7465 726d 696e 6520 6c65 6674 2062  Determine left b
+000093e0: 6f75 6e64 2061 6e64 2062 6f75 6e64 6172  ound and boundar
+000093f0: 7920 7573 696e 6720 7468 6520 7375 6d20  y using the sum 
+00009400: 6f66 2074 6865 2063 6f6e 7472 6962 7574  of the contribut
+00009410: 696f 6e73 0d0a 2020 2020 2320 616e 6420  ions..    # and 
+00009420: 616e 206f 7065 6e20 626f 756e 6461 7279  an open boundary
+00009430: 2069 6620 616e 7920 6f66 2074 6865 2063   if any of the c
+00009440: 6f6e 7472 6962 7574 696e 6720 7661 6c75  ontributing valu
+00009450: 6573 2069 7320 6f70 656e 0d0a 2020 2020  es is open..    
+00009460: 6c65 6674 203d 206c 6566 742e 6772 6f75  left = left.grou
+00009470: 7062 7928 6772 6f75 7062 795f 636f 6c75  pby(groupby_colu
+00009480: 6d6e 7329 2e61 6767 282a 2a7b 0d0a 2020  mns).agg(**{..  
+00009490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094a0: 2020 2020 2020 2020 2020 6c65 6674 5f62            left_b
+000094b0: 6f75 6e64 6172 795f 636f 6c3a 2028 6c65  oundary_col: (le
+000094c0: 6674 5f62 6f75 6e64 6172 795f 636f 6c2c  ft_boundary_col,
+000094d0: 2027 6d61 7827 292c 0d0a 2020 2020 2020   'max'),..      
+000094e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094f0: 2020 2020 2020 6c65 6674 5f62 6f75 6e64        left_bound
+00009500: 5f63 6f6c 3a20 2827 5f5f 436f 6e74 7269  _col: ('__Contri
+00009510: 6275 7469 6f6e 5f5f 272c 2773 756d 2729  bution__','sum')
+00009520: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00009530: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00009540: 5f5f 4d69 6e69 6d75 6d5f 5f27 3a20 2827  __Minimum__': ('
+00009550: 5f5f 436f 6e74 7269 6275 7469 6f6e 5f5f  __Contribution__
+00009560: 272c 276d 696e 2729 0d0a 2020 2020 2020  ','min')..      
+00009570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009580: 2020 2020 2020 7d29 0d0a 2020 2020 0d0a        })..    ..
+00009590: 2020 2020 2320 5265 706c 6163 6520 7468      # Replace th
+000095a0: 6520 6e75 6d65 7269 6320 7661 6c75 6520  e numeric value 
+000095b0: 666f 7220 7468 6520 626f 756e 6461 7279  for the boundary
+000095c0: 0d0a 2020 2020 6c65 6674 5b6c 6566 745f  ..    left[left_
+000095d0: 626f 756e 6461 7279 5f63 6f6c 5d20 3d20  boundary_col] = 
+000095e0: 6c65 6674 5b6c 6566 745f 626f 756e 6461  left[left_bounda
+000095f0: 7279 5f63 6f6c 5d2e 7265 706c 6163 6528  ry_col].replace(
+00009600: 5b30 2c31 5d2c 205b 2743 6c6f 7365 6427  [0,1], ['Closed'
+00009610: 2c27 4f70 656e 275d 290d 0a20 2020 200d  ,'Open'])..    .
+00009620: 0a20 2020 2023 204d 6561 6e73 2077 6974  .    # Means wit
+00009630: 6820 696e 6669 6e69 7465 2076 616c 7565  h infinite value
+00009640: 7320 7072 6f64 7563 6520 6e61 6e20 7661  s produce nan va
+00009650: 6c75 6573 2072 6174 6865 7220 7468 616e  lues rather than
+00009660: 206e 702e 696e 6620 7661 6c75 6573 0d0a   np.inf values..
+00009670: 2020 2020 2320 436f 6e76 6572 7420 6e61      # Convert na
+00009680: 6e20 746f 2069 6e66 206f 6e6c 7920 6966  n to inf only if
+00009690: 2069 6e66 696e 6974 6520 7661 6c75 6573   infinite values
+000096a0: 2061 7265 2069 6e63 6c75 6465 6420 696e   are included in
+000096b0: 2074 6865 206d 6561 6e0d 0a20 2020 206c   the mean..    l
+000096c0: 6566 745b 6c65 6674 5f62 6f75 6e64 5f63  eft[left_bound_c
+000096d0: 6f6c 5d20 3d20 6e70 2e77 6865 7265 286c  ol] = np.where(l
+000096e0: 6566 745b 275f 5f4d 696e 696d 756d 5f5f  eft['__Minimum__
+000096f0: 275d 203d 3d20 2d6e 702e 696e 662c 202d  '] == -np.inf, -
+00009700: 6e70 2e69 6e66 2c20 6c65 6674 5b6c 6566  np.inf, left[lef
+00009710: 745f 626f 756e 645f 636f 6c5d 290d 0a20  t_bound_col]).. 
+00009720: 2020 200d 0a20 2020 2023 2044 6574 6572     ..    # Deter
+00009730: 6d69 6e65 2072 6967 6874 2062 6f75 6e64  mine right bound
+00009740: 2061 6e64 2062 6f75 6e64 6172 7920 666f   and boundary fo
+00009750: 7220 6561 6368 2067 726f 7570 0d0a 2020  r each group..  
+00009760: 2020 0d0a 2020 2020 2320 4368 616e 6765    ..    # Change
+00009770: 206e 6f74 6174 696f 6e20 6f66 2027 436c   notation of 'Cl
+00009780: 6f73 6564 2720 616e 6420 274f 7065 6e27  osed' and 'Open'
+00009790: 2062 6f75 6e64 6172 6965 7320 746f 2031   boundaries to 1
+000097a0: 2061 6e64 2030 2c20 7265 7370 6563 7469   and 0, respecti
+000097b0: 7665 6c79 0d0a 2020 2020 2320 5573 6520  vely..    # Use 
+000097c0: 3120 666f 7220 636c 6f73 6564 2074 6f20  1 for closed to 
+000097d0: 656e 7375 7265 2074 6861 7420 636c 6f73  ensure that clos
+000097e0: 6564 2062 6f75 6e64 6172 6965 7320 6172  ed boundaries ar
+000097f0: 6520 736f 7274 6564 206c 6172 6765 7220  e sorted larger 
+00009800: 7468 616e 206f 7065 6e0d 0a20 2020 2023  than open..    #
+00009810: 2062 6f75 6e64 6172 6965 7320 7768 656e   boundaries when
+00009820: 2074 6865 2072 6967 6874 2062 6f75 6e64   the right bound
+00009830: 2069 7320 7469 6564 0d0a 2020 2020 6466   is tied..    df
+00009840: 5b72 6967 6874 5f62 6f75 6e64 6172 795f  [right_boundary_
+00009850: 636f 6c5d 203d 2064 665b 7269 6768 745f  col] = df[right_
+00009860: 626f 756e 6461 7279 5f63 6f6c 5d2e 7265  boundary_col].re
+00009870: 706c 6163 6528 5b27 436c 6f73 6564 272c  place(['Closed',
+00009880: 274f 7065 6e27 5d2c 205b 312c 305d 290d  'Open'], [1,0]).
+00009890: 0a20 2020 200d 0a20 2020 2023 2053 6f72  .    ..    # Sor
+000098a0: 7420 7269 6768 7420 626f 756e 6420 7661  t right bound va
+000098b0: 6c75 6573 0d0a 2020 2020 7269 6768 7420  lues..    right 
+000098c0: 3d20 6466 2e63 6f70 7928 295b 6772 6f75  = df.copy()[grou
+000098d0: 7062 795f 636f 6c75 6d6e 732b 5b27 5f5f  pby_columns+['__
+000098e0: 5369 7a65 5f5f 272c 7269 6768 745f 626f  Size__',right_bo
+000098f0: 756e 6461 7279 5f63 6f6c 2c72 6967 6874  undary_col,right
+00009900: 5f62 6f75 6e64 5f63 6f6c 5d5d 2e73 6f72  _bound_col]].sor
+00009910: 745f 7661 6c75 6573 2862 793d 5b72 6967  t_values(by=[rig
+00009920: 6874 5f62 6f75 6e64 5f63 6f6c 2c72 6967  ht_bound_col,rig
+00009930: 6874 5f62 6f75 6e64 6172 795f 636f 6c5d  ht_boundary_col]
+00009940: 290d 0a20 2020 200d 0a20 2020 2023 2041  )..    ..    # A
+00009950: 6464 2069 6e64 6578 2066 6f72 2065 6163  dd index for eac
+00009960: 6820 6772 6f75 700d 0a20 2020 2072 6967  h group..    rig
+00009970: 6874 5b27 5f5f 496e 6465 785f 5f27 5d20  ht['__Index__'] 
+00009980: 3d20 7269 6768 742e 6772 6f75 7062 7928  = right.groupby(
+00009990: 6772 6f75 7062 795f 636f 6c75 6d6e 7329  groupby_columns)
+000099a0: 2e63 756d 636f 756e 7428 2920 2b20 310d  .cumcount() + 1.
+000099b0: 0a20 2020 200d 0a20 2020 2023 2044 6574  .    ..    # Det
+000099c0: 6572 6d69 6e65 2074 6865 2072 616e 6b20  ermine the rank 
+000099d0: 696e 2065 6163 6820 6772 6f75 7020 666f  in each group fo
+000099e0: 7220 7468 6520 7065 7263 656e 7469 6c65  r the percentile
+000099f0: 0d0a 2020 2020 7269 6768 745b 275f 5f52  ..    right['__R
+00009a00: 616e 6b5f 5f27 5d20 3d20 726f 756e 6428  ank__'] = round(
+00009a10: 4320 2b20 7065 7263 656e 7469 6c65 2a28  C + percentile*(
+00009a20: 7269 6768 745b 275f 5f53 697a 655f 5f27  right['__Size__'
+00009a30: 5d20 2b20 3120 2d20 322a 4329 2c38 290d  ] + 1 - 2*C),8).
+00009a40: 0a20 2020 200d 0a20 2020 2023 2047 656e  .    ..    # Gen
+00009a50: 6572 6174 6520 7072 6f78 696d 6974 7920  erate proximity 
+00009a60: 6f66 2065 6163 6820 7265 7375 6c74 2074  of each result t
+00009a70: 6f20 7065 7263 656e 7469 6c65 2072 616e  o percentile ran
+00009a80: 6b20 7573 696e 6720 7468 6520 696e 6465  k using the inde
+00009a90: 780d 0a20 2020 2072 6967 6874 5b27 5f5f  x..    right['__
+00009aa0: 5072 6f78 696d 6974 795f 5f27 5d20 3d20  Proximity__'] = 
+00009ab0: 300d 0a20 2020 200d 0a20 2020 2063 6f6e  0..    ..    con
+00009ac0: 6469 7469 6f6e 7320 3d20 5b0d 0a20 2020  ditions = [..   
+00009ad0: 2020 2020 2023 2049 6620 7468 6520 7065       # If the pe
+00009ae0: 7263 656e 7469 6c65 2072 616e 6b20 6973  rcentile rank is
+00009af0: 2061 2077 686f 6c65 206e 756d 6265 722c   a whole number,
+00009b00: 2074 6865 6e20 7573 6520 7468 6174 2069   then use that i
+00009b10: 6e64 6578 2072 6573 756c 740d 0a20 2020  ndex result..   
+00009b20: 2020 2020 2028 7269 6768 745b 275f 5f52       (right['__R
+00009b30: 616e 6b5f 5f27 5d20 3d3d 2072 6967 6874  ank__'] == right
+00009b40: 5b27 5f5f 496e 6465 785f 5f27 5d29 2c0d  ['__Index__']),.
+00009b50: 0a20 2020 2020 2020 2023 2049 6620 7468  .        # If th
+00009b60: 6520 7065 7263 656e 7469 6c65 2072 616e  e percentile ran
+00009b70: 6b20 6973 206c 6573 7320 7468 616e 2031  k is less than 1
+00009b80: 2061 626f 7665 2074 6865 2069 6e64 6578   above the index
+00009b90: 2076 616c 7565 2c0d 0a20 2020 2020 2020   value,..       
+00009ba0: 2023 2074 6865 6e20 6173 7369 676e 2074   # then assign t
+00009bb0: 6865 2061 7070 726f 7072 6961 7465 2063  he appropriate c
+00009bc0: 6f6e 7472 6962 7574 696f 6e20 746f 2074  ontribution to t
+00009bd0: 6861 7420 696e 6465 7820 7661 6c75 650d  hat index value.
+00009be0: 0a20 2020 2020 2020 2028 7269 6768 745b  .        (right[
+00009bf0: 275f 5f52 616e 6b5f 5f27 5d20 2d20 7269  '__Rank__'] - ri
+00009c00: 6768 745b 275f 5f49 6e64 6578 5f5f 275d  ght['__Index__']
+00009c10: 292e 6265 7477 6565 6e28 302c 312c 696e  ).between(0,1,in
+00009c20: 636c 7573 6976 653d 276e 6569 7468 6572  clusive='neither
+00009c30: 2729 2c0d 0a20 2020 2020 2020 2023 2049  '),..        # I
+00009c40: 6620 7468 6520 7065 7263 656e 7469 6c65  f the percentile
+00009c50: 2072 616e 6b20 6973 206c 6573 7320 7468   rank is less th
+00009c60: 616e 2031 2062 656c 6f77 2074 6865 2069  an 1 below the i
+00009c70: 6e64 6578 2076 616c 7565 2c0d 0a20 2020  ndex value,..   
+00009c80: 2020 2020 2023 2074 6865 6e20 6173 7369       # then assi
+00009c90: 676e 2074 6865 2061 7070 726f 7072 6961  gn the appropria
+00009ca0: 7465 2063 6f6e 7472 6962 7574 696f 6e20  te contribution 
+00009cb0: 746f 2074 6861 7420 696e 6465 7820 7661  to that index va
+00009cc0: 6c75 650d 0a20 2020 2020 2020 2028 7269  lue..        (ri
+00009cd0: 6768 745b 275f 5f49 6e64 6578 5f5f 275d  ght['__Index__']
+00009ce0: 202d 2072 6967 6874 5b27 5f5f 5261 6e6b   - right['__Rank
+00009cf0: 5f5f 275d 292e 6265 7477 6565 6e28 302c  __']).between(0,
+00009d00: 312c 696e 636c 7573 6976 653d 276e 6569  1,inclusive='nei
+00009d10: 7468 6572 2729 0d0a 2020 2020 2020 2020  ther')..        
+00009d20: 5d0d 0a20 2020 200d 0a20 2020 2072 6573  ]..    ..    res
+00009d30: 756c 7473 203d 205b 0d0a 2020 2020 2020  ults = [..      
+00009d40: 2020 312c 0d0a 2020 2020 2020 2020 3120    1,..        1 
+00009d50: 2d20 2872 6967 6874 5b27 5f5f 5261 6e6b  - (right['__Rank
+00009d60: 5f5f 275d 202d 2072 6967 6874 5b27 5f5f  __'] - right['__
+00009d70: 496e 6465 785f 5f27 5d29 2c0d 0a20 2020  Index__']),..   
+00009d80: 2020 2020 2031 202d 2028 7269 6768 745b       1 - (right[
+00009d90: 275f 5f49 6e64 6578 5f5f 275d 202d 2072  '__Index__'] - r
+00009da0: 6967 6874 5b27 5f5f 5261 6e6b 5f5f 275d  ight['__Rank__']
+00009db0: 292c 0d0a 2020 2020 2020 2020 5d0d 0a20  ),..        ].. 
+00009dc0: 2020 200d 0a20 2020 2072 6967 6874 5b27     ..    right['
+00009dd0: 5f5f 5072 6f78 696d 6974 795f 5f27 5d20  __Proximity__'] 
+00009de0: 3d20 6e70 2e73 656c 6563 7428 636f 6e64  = np.select(cond
+00009df0: 6974 696f 6e73 2c20 7265 7375 6c74 732c  itions, results,
+00009e00: 206e 702e 6e61 6e29 0d0a 2020 2020 0d0a   np.nan)..    ..
+00009e10: 2020 2020 2320 4472 6f70 206e 6f6e 2d63      # Drop non-c
+00009e20: 6f6e 7472 6962 7574 696e 6720 726f 7773  ontributing rows
+00009e30: 0d0a 2020 2020 7269 6768 7420 3d20 7269  ..    right = ri
+00009e40: 6768 745b 7269 6768 745b 275f 5f50 726f  ght[right['__Pro
+00009e50: 7869 6d69 7479 5f5f 275d 203e 2030 5d0d  ximity__'] > 0].
+00009e60: 0a20 2020 200d 0a20 2020 2023 2043 616c  .    ..    # Cal
+00009e70: 6375 6c61 7465 2063 6f6e 7472 6962 7574  culate contribut
+00009e80: 696f 6e20 666f 7220 696e 6465 7820 7661  ion for index va
+00009e90: 6c75 6573 2074 6861 7420 636f 6e74 7269  lues that contri
+00009ea0: 6275 7465 2074 6f20 7468 6520 7265 7375  bute to the resu
+00009eb0: 6c74 0d0a 2020 2020 7269 6768 745b 275f  lt..    right['_
+00009ec0: 5f43 6f6e 7472 6962 7574 696f 6e5f 5f27  _Contribution__'
+00009ed0: 5d20 3d20 7269 6768 745b 275f 5f50 726f  ] = right['__Pro
+00009ee0: 7869 6d69 7479 5f5f 275d 202a 2072 6967  ximity__'] * rig
+00009ef0: 6874 5b72 6967 6874 5f62 6f75 6e64 5f63  ht[right_bound_c
+00009f00: 6f6c 5d0d 0a20 2020 200d 0a20 2020 2023  ol]..    ..    #
+00009f10: 2044 6574 6572 6d69 6e65 2072 6967 6874   Determine right
+00009f20: 2062 6f75 6e64 2061 6e64 2062 6f75 6e64   bound and bound
+00009f30: 6172 7920 7573 696e 6720 7468 6520 7375  ary using the su
+00009f40: 6d20 6f66 2074 6865 2063 6f6e 7472 6962  m of the contrib
+00009f50: 7574 696f 6e73 0d0a 2020 2020 2320 616e  utions..    # an
+00009f60: 6420 616e 206f 7065 6e20 626f 756e 6461  d an open bounda
+00009f70: 7279 2069 6620 616e 7920 6f66 2074 6865  ry if any of the
+00009f80: 2063 6f6e 7472 6962 7574 696e 6720 7661   contributing va
+00009f90: 6c75 6573 2069 7320 6f70 656e 0d0a 2020  lues is open..  
+00009fa0: 2020 7269 6768 7420 3d20 7269 6768 742e    right = right.
+00009fb0: 6772 6f75 7062 7928 6772 6f75 7062 795f  groupby(groupby_
+00009fc0: 636f 6c75 6d6e 7329 2e61 6767 282a 2a7b  columns).agg(**{
+00009fd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009fe0: 2020 2020 2020 2020 2020 2020 2020 7269                ri
+00009ff0: 6768 745f 626f 756e 645f 636f 6c3a 2028  ght_bound_col: (
+0000a000: 275f 5f43 6f6e 7472 6962 7574 696f 6e5f  '__Contribution_
+0000a010: 5f27 2c27 7375 6d27 292c 0d0a 2020 2020  _','sum'),..    
+0000a020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a030: 2020 2020 2020 2020 7269 6768 745f 626f          right_bo
+0000a040: 756e 6461 7279 5f63 6f6c 3a20 2872 6967  undary_col: (rig
+0000a050: 6874 5f62 6f75 6e64 6172 795f 636f 6c2c  ht_boundary_col,
+0000a060: 2027 6d69 6e27 292c 0d0a 2020 2020 2020   'min'),..      
+0000a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a080: 2020 2020 2020 275f 5f4d 6178 696d 756d        '__Maximum
+0000a090: 5f5f 273a 2028 275f 5f43 6f6e 7472 6962  __': ('__Contrib
+0000a0a0: 7574 696f 6e5f 5f27 2c27 6d61 7827 290d  ution__','max').
+0000a0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a0c0: 2020 2020 2020 2020 2020 2020 207d 290d               }).
+0000a0d0: 0a20 2020 200d 0a20 2020 2023 2052 6570  .    ..    # Rep
+0000a0e0: 6c61 6365 2074 6865 206e 756d 6572 6963  lace the numeric
+0000a0f0: 2076 616c 7565 2066 6f72 2074 6865 2062   value for the b
+0000a100: 6f75 6e64 6172 790d 0a20 2020 2072 6967  oundary..    rig
+0000a110: 6874 5b72 6967 6874 5f62 6f75 6e64 6172  ht[right_boundar
+0000a120: 795f 636f 6c5d 203d 2072 6967 6874 5b72  y_col] = right[r
+0000a130: 6967 6874 5f62 6f75 6e64 6172 795f 636f  ight_boundary_co
+0000a140: 6c5d 2e72 6570 6c61 6365 285b 312c 305d  l].replace([1,0]
+0000a150: 2c20 5b27 436c 6f73 6564 272c 274f 7065  , ['Closed','Ope
+0000a160: 6e27 5d29 0d0a 2020 2020 0d0a 2020 2020  n'])..    ..    
+0000a170: 2320 4d65 616e 7320 7769 7468 2069 6e66  # Means with inf
+0000a180: 696e 6974 6520 7661 6c75 6573 2070 726f  inite values pro
+0000a190: 6475 6365 206e 616e 2076 616c 7565 7320  duce nan values 
+0000a1a0: 7261 7468 6572 2074 6861 6e20 6e70 2e69  rather than np.i
+0000a1b0: 6e66 2076 616c 7565 730d 0a20 2020 2023  nf values..    #
+0000a1c0: 2043 6f6e 7665 7274 206e 616e 2074 6f20   Convert nan to 
+0000a1d0: 696e 6620 6f6e 6c79 2069 6620 696e 6669  inf only if infi
+0000a1e0: 6e69 7465 2076 616c 7565 7320 6172 6520  nite values are 
+0000a1f0: 696e 636c 7564 6564 2069 6e20 7468 6520  included in the 
+0000a200: 6d65 616e 0d0a 2020 2020 7269 6768 745b  mean..    right[
+0000a210: 7269 6768 745f 626f 756e 645f 636f 6c5d  right_bound_col]
+0000a220: 203d 206e 702e 7768 6572 6528 7269 6768   = np.where(righ
+0000a230: 745b 275f 5f4d 6178 696d 756d 5f5f 275d  t['__Maximum__']
+0000a240: 203d 3d20 6e70 2e69 6e66 2c20 6e70 2e69   == np.inf, np.i
+0000a250: 6e66 2c20 7269 6768 745b 7269 6768 745f  nf, right[right_
+0000a260: 626f 756e 645f 636f 6c5d 290d 0a20 2020  bound_col])..   
+0000a270: 200d 0a20 2020 2023 204d 6572 6765 2074   ..    # Merge t
+0000a280: 6865 2074 776f 2062 6f75 6e64 6172 6965  he two boundarie
+0000a290: 7320 746f 2063 7265 6174 6520 7468 6520  s to create the 
+0000a2a0: 696e 7465 7276 616c 2066 6f72 2074 6865  interval for the
+0000a2b0: 2070 6572 6365 6e74 696c 650d 0a20 2020   percentile..   
+0000a2c0: 2023 2043 6865 636b 2074 6861 7420 7468   # Check that th
+0000a2d0: 6520 6d65 7267 6520 6973 2031 2d74 6f2d  e merge is 1-to-
+0000a2e0: 310d 0a20 2020 2064 6620 3d20 6c65 6674  1..    df = left
+0000a2f0: 2e6d 6572 6765 2872 6967 6874 2c20 686f  .merge(right, ho
+0000a300: 7720 3d20 276f 7574 6572 272c 206f 6e20  w = 'outer', on 
+0000a310: 3d20 6772 6f75 7062 795f 636f 6c75 6d6e  = groupby_column
+0000a320: 732c 2076 616c 6964 6174 6520 3d20 2731  s, validate = '1
+0000a330: 3a31 2729 0d0a 2020 2020 0d0a 2020 2020  :1')..    ..    
+0000a340: 2320 5265 7365 7420 696e 6465 780d 0a20  # Reset index.. 
+0000a350: 2020 2064 6620 3d20 6466 2e72 6573 6574     df = df.reset
+0000a360: 5f69 6e64 6578 2829 0d0a 2020 2020 0d0a  _index()..    ..
+0000a370: 2020 2020 7265 7475 726e 2064 660d 0a0d      return df...
+0000a380: 0a64 6566 2070 6572 6365 6e74 696c 6528  .def percentile(
+0000a390: 6466 2c0d 0a20 2020 2020 2020 2020 2020  df,..           
+0000a3a0: 2020 2020 7265 7375 6c74 5f63 6f6c 2c0d      result_col,.
+0000a3b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a3c0: 7065 7263 656e 7469 6c65 2c0d 0a20 2020  percentile,..   
+0000a3d0: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+0000a3e0: 6f64 203d 2027 6861 7a65 6e27 2c0d 0a20  od = 'hazen',.. 
+0000a3f0: 2020 2020 2020 2020 2020 2020 2020 6772                gr
+0000a400: 6f75 7062 795f 636f 6c75 6d6e 7320 3d20  oupby_columns = 
+0000a410: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
+0000a420: 2020 2020 2020 666f 6375 735f 6869 6768        focus_high
+0000a430: 5f70 6f74 656e 7469 616c 203d 2054 7275  _potential = Tru
+0000a440: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0000a450: 2020 2069 6e63 6c75 6465 5f6e 6567 6174     include_negat
+0000a460: 6976 655f 696e 7465 7276 616c 203d 2046  ive_interval = F
+0000a470: 616c 7365 2c0d 0a20 2020 2020 2020 2020  alse,..         
+0000a480: 2020 2020 2020 7072 6563 6973 696f 6e5f        precision_
+0000a490: 746f 6c65 7261 6e63 655f 746f 5f64 726f  tolerance_to_dro
+0000a4a0: 705f 6365 6e73 6f72 203d 2030 2e32 352c  p_censor = 0.25,
+0000a4b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a4c0: 2070 7265 6369 7369 6f6e 5f72 6f75 6e64   precision_round
+0000a4d0: 696e 6720 3d20 5472 7565 293a 0d0a 2020  ing = True):..  
+0000a4e0: 2020 2727 270d 0a20 2020 2041 2066 756e    '''..    A fun
+0000a4f0: 6374 696f 6e20 7468 6174 2063 6f6d 6269  ction that combi
+0000a500: 6e65 7320 7468 6520 7265 6c65 7661 6e74  nes the relevant
+0000a510: 2070 6572 6365 6e74 696c 6520 616e 6420   percentile and 
+0000a520: 7574 696c 6974 7920 6675 6e63 7469 6f6e  utility function
+0000a530: 7320 746f 0d0a 2020 2020 6765 6e65 7261  s to..    genera
+0000a540: 7465 2074 6865 2070 6572 6365 6e69 746c  te the percenitl
+0000a550: 6520 7265 7375 6c74 7320 666f 7220 6772  e results for gr
+0000a560: 6f75 7073 2077 6974 6869 6e20 6120 4461  oups within a Da
+0000a570: 7461 4672 616d 652e 0d0a 0d0a 2020 2020  taFrame.....    
+0000a580: 5061 7261 6d65 7465 7273 0d0a 2020 2020  Parameters..    
+0000a590: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
+0000a5a0: 6466 203a 2044 6174 6146 7261 6d65 0d0a  df : DataFrame..
+0000a5b0: 2020 2020 2020 2020 4461 7461 4672 616d          DataFram
+0000a5c0: 6520 7468 6174 2063 6f6e 7461 696e 7320  e that contains 
+0000a5d0: 6365 6e73 6f72 6564 206f 7220 756e 6365  censored or unce
+0000a5e0: 6e73 6f72 6564 2072 6573 756c 7473 0d0a  nsored results..
+0000a5f0: 2020 2020 7265 7375 6c74 5f63 6f6c 203a      result_col :
+0000a600: 2073 7472 696e 670d 0a20 2020 2020 2020   string..       
+0000a610: 2054 6865 2063 6f6c 756d 6e20 6e61 6d65   The column name
+0000a620: 2066 6f72 2074 6865 2063 6f6c 756d 6e20   for the column 
+0000a630: 7468 6174 2063 6f6e 7461 696e 2074 6865  that contain the
+0000a640: 2072 6573 756c 7473 2061 7320 7465 7874   results as text
+0000a650: 2e0d 0a20 2020 2020 2020 204f 6e6c 7920  ...        Only 
+0000a660: 666f 7572 2070 6f73 7369 626c 6520 6365  four possible ce
+0000a670: 6e73 6f72 7320 7368 6f75 6c64 2062 6520  nsors should be 
+0000a680: 7573 6564 2028 3c2c e289 a42c e289 a52c  used (<,...,...,
+0000a690: 3e29 2e0d 0a20 2020 2070 6572 6365 6e74  >)...    percent
+0000a6a0: 696c 6520 3a20 666c 6f61 740d 0a20 2020  ile : float..   
+0000a6b0: 2020 2020 2054 6865 2064 6573 6972 6564       The desired
+0000a6c0: 2070 6572 6365 6e74 696c 652e 2056 616c   percentile. Val
+0000a6d0: 7565 7320 7368 6f75 6c64 2062 6520 6265  ues should be be
+0000a6e0: 7477 6565 6e20 3020 616e 6420 3130 302e  tween 0 and 100.
+0000a6f0: 0d0a 2020 2020 6d65 7468 6f64 203a 2073  ..    method : s
+0000a700: 7472 696e 670d 0a20 2020 2020 2020 2054  tring..        T
+0000a710: 6865 2070 6572 6365 6e74 696c 6520 6d65  he percentile me
+0000a720: 7468 6f64 2e20 5468 6520 6f70 7469 6f6e  thod. The option
+0000a730: 7320 616e 6420 6465 6669 6e69 7469 6f6e  s and definition
+0000a740: 7320 636f 6d65 2066 726f 6d3a 0d0a 2020  s come from:..  
+0000a750: 2020 2020 2020 2020 2020 6874 7470 733a            https:
+0000a760: 2f2f 656e 7669 726f 6e6d 656e 742e 676f  //environment.go
+0000a770: 7674 2e6e 7a2f 6173 7365 7473 2f50 7562  vt.nz/assets/Pub
+0000a780: 6c69 6361 7469 6f6e 732f 4669 6c65 732f  lications/Files/
+0000a790: 6861 7a65 6e2d 7065 7263 656e 7469 6c65  hazen-percentile
+0000a7a0: 2d63 616c 6375 6c61 746f 722d 322e 786c  -calculator-2.xl
+0000a7b0: 730d 0a20 2020 2020 2020 2020 2020 204f  s..            O
+0000a7c0: 7074 696f 6e73 2069 6e63 6c75 6465 2074  ptions include t
+0000a7d0: 6865 2066 6f6c 6c6f 7769 6e67 2c20 6f72  he following, or
+0000a7e0: 6465 7265 6420 6672 6f6d 206c 6172 6765  dered from large
+0000a7f0: 7374 2074 6f20 736d 616c 6c65 7374 2072  st to smallest r
+0000a800: 6573 756c 742e 0d0a 2020 2020 2020 2020  esult...        
+0000a810: 2020 2020 2d20 7765 6962 616c 6c0d 0a20      - weiball.. 
+0000a820: 2020 2020 2020 2020 2020 202d 2074 756b             - tuk
+0000a830: 6579 0d0a 2020 2020 2020 2020 2020 2020  ey..            
+0000a840: 2d20 626c 6f6d 0d0a 2020 2020 2020 2020  - blom..        
+0000a850: 2020 2020 2d20 6861 7a65 6e0d 0a20 2020      - hazen..   
+0000a860: 2020 2020 2020 2020 202d 2065 7863 656c           - excel
+0000a870: 0d0a 2020 2020 2020 2020 5468 6520 6465  ..        The de
+0000a880: 6661 756c 7420 6973 2068 617a 656e 2e0d  fault is hazen..
+0000a890: 0a20 2020 2067 726f 7570 6279 5f63 6f6c  .    groupby_col
+0000a8a0: 756d 6e73 203a 206c 6973 7473 206f 6620  umns : lists of 
+0000a8b0: 7374 7269 6e67 7320 286f 7220 6c69 7374  strings (or list
+0000a8c0: 206f 6620 6c69 7374 7329 2c20 6f70 7469   of lists), opti
+0000a8d0: 6f6e 616c 0d0a 2020 2020 2020 2020 4c69  onal..        Li
+0000a8e0: 7374 206f 6620 636f 6c75 6d6e 206e 616d  st of column nam
+0000a8f0: 6573 2074 6861 7420 7368 6f75 6c64 2062  es that should b
+0000a900: 6520 7573 6564 2074 6f20 6372 6561 7465  e used to create
+0000a910: 2067 726f 7570 732e 2041 2070 6572 6365   groups. A perce
+0000a920: 6e74 696c 650d 0a20 2020 2020 2020 2077  ntile..        w
+0000a930: 696c 6c20 6265 2066 6f75 6e64 2077 6974  ill be found wit
+0000a940: 6869 6e20 6561 6368 2067 726f 7570 2e20  hin each group. 
+0000a950: 4d75 6c74 6970 6c65 206c 6973 7473 2063  Multiple lists c
+0000a960: 616e 2062 6520 7375 7070 6c69 6564 2074  an be supplied t
+0000a970: 6f0d 0a20 2020 2020 2020 2070 6572 666f  o..        perfo
+0000a980: 726d 2073 6571 7565 6e74 6961 6c20 6d65  rm sequential me
+0000a990: 6469 616e 2070 6572 6365 6e74 696c 6573  dian percentiles
+0000a9a0: 2062 6566 6f72 6520 6361 6c63 756c 6174   before calculat
+0000a9b0: 696e 6720 6120 7065 7263 656e 7469 6c65  ing a percentile
+0000a9c0: 0d0a 2020 2020 2020 2020 6f76 6572 2074  ..        over t
+0000a9d0: 6865 2066 696e 616c 2067 726f 7570 696e  he final groupin
+0000a9e0: 672e 0d0a 2020 2020 2020 2020 5468 6520  g...        The 
+0000a9f0: 6465 6661 756c 7420 6973 204e 6f6e 652e  default is None.
+0000aa00: 0d0a 2020 2020 666f 6375 735f 6869 6768  ..    focus_high
+0000aa10: 5f70 6f74 656e 7469 616c 203a 2062 6f6f  _potential : boo
+0000aa20: 6c65 616e 2c20 6f70 7469 6f6e 616c 0d0a  lean, optional..
+0000aa30: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+0000aa40: 2074 6865 6e20 696e 666f 726d 6174 696f   then informatio
+0000aa50: 6e20 6f6e 2074 6865 2068 6967 6865 7374  n on the highest
+0000aa60: 2070 6f74 656e 7469 616c 2072 6573 756c   potential resul
+0000aa70: 7420 7769 6c6c 2062 650d 0a20 2020 2020  t will be..     
+0000aa80: 2020 2066 6f63 7573 6564 206f 7665 7220     focused over 
+0000aa90: 7468 6520 6c6f 7765 7374 2070 6f74 656e  the lowest poten
+0000aaa0: 7469 616c 2072 6573 756c 742e 0d0a 2020  tial result...  
+0000aab0: 2020 696e 636c 7564 655f 6e65 6761 7469    include_negati
+0000aac0: 7665 5f69 6e74 6572 7661 6c20 3a20 626f  ve_interval : bo
+0000aad0: 6f6c 6561 6e2c 206f 7074 696f 6e61 6c0d  olean, optional.
+0000aae0: 0a20 2020 2020 2020 2049 6620 5472 7565  .        If True
+0000aaf0: 2c20 7468 656e 2061 6c6c 2070 6f73 6974  , then all posit
+0000ab00: 6976 6520 616e 6420 6e65 6761 7469 7665  ive and negative
+0000ab10: 2076 616c 7565 7320 6172 6520 636f 6e73   values are cons
+0000ab20: 6964 6572 6564 0d0a 2020 2020 2020 2020  idered..        
+0000ab30: 652e 672e 2c20 3c30 2e35 2077 6f75 6c64  e.g., <0.5 would
+0000ab40: 2062 6520 636f 6e76 6572 7465 6420 746f   be converted to
+0000ab50: 2028 2d6e 702e 696e 662c 3529 2e0d 0a20   (-np.inf,5)... 
+0000ab60: 2020 2020 2020 2049 6620 4661 6c73 652c         If False,
+0000ab70: 2074 6865 6e20 6f6e 6c79 206e 6f6e 2d6e   then only non-n
+0000ab80: 6567 6174 6976 6520 7661 6c75 6573 2061  egative values a
+0000ab90: 7265 2063 6f6e 7369 6465 7265 640d 0a20  re considered.. 
+0000aba0: 2020 2020 2020 2065 2e67 2e2c 203c 302e         e.g., <0.
+0000abb0: 3520 776f 756c 6420 6265 2063 6f6e 7665  5 would be conve
+0000abc0: 7274 6564 2074 6f20 5b30 2c35 292e 0d0a  rted to [0,5)...
+0000abd0: 2020 2020 2020 2020 5468 6973 2073 6574          This set
+0000abe0: 7469 6e67 206f 6e6c 7920 6166 6665 6374  ting only affect
+0000abf0: 7320 7265 7375 6c74 7320 6966 2066 6f63  s results if foc
+0000ac00: 7573 5f68 6967 685f 706f 7465 6e74 6961  us_high_potentia
+0000ac10: 6c20 6973 2046 616c 7365 2e0d 0a20 2020  l is False...   
+0000ac20: 2020 2020 2054 6865 2064 6566 6175 6c74       The default
+0000ac30: 2069 7320 4661 6c73 652e 0d0a 2020 2020   is False...    
+0000ac40: 7072 6563 6973 696f 6e5f 746f 6c65 7261  precision_tolera
+0000ac50: 6e63 655f 746f 5f64 726f 705f 6365 6e73  nce_to_drop_cens
+0000ac60: 6f72 203a 2066 6c6f 6174 2c20 6f70 7469  or : float, opti
+0000ac70: 6f6e 616c 0d0a 2020 2020 2020 2020 5468  onal..        Th
+0000ac80: 7265 7368 6f6c 6420 666f 7220 7265 706f  reshold for repo
+0000ac90: 7274 696e 6720 6365 6e73 6f72 6564 2076  rting censored v
+0000aca0: 7320 6e6f 6e2d 6365 6e73 6f72 6564 2072  s non-censored r
+0000acb0: 6573 756c 7473 2e0d 0a20 2020 2020 2020  esults...       
+0000acc0: 2055 7369 6e67 2074 6865 2064 6566 6175   Using the defau
+0000acd0: 6c74 2c20 6120 7265 7375 6c74 2074 6861  lt, a result tha
+0000ace0: 7420 6973 206b 6e6f 776e 2074 6f20 6265  t is known to be
+0000acf0: 2069 6e20 7468 6520 696e 7465 7276 616c   in the interval
+0000ad00: 2028 302e 332c 2030 2e35 290d 0a20 2020   (0.3, 0.5)..   
+0000ad10: 2020 2020 2077 6f75 6c64 2062 6520 7265       would be re
+0000ad20: 7475 726e 6564 2061 7320 302e 342c 2077  turned as 0.4, w
+0000ad30: 6865 7265 6173 2061 2074 6f6c 6572 616e  hereas a toleran
+0000ad40: 6365 206f 6620 3020 776f 756c 6420 7969  ce of 0 would yi
+0000ad50: 656c 6420 610d 0a20 2020 2020 2020 2072  eld a..        r
+0000ad60: 6573 756c 7420 6f66 203c 302e 3520 6f72  esult of <0.5 or
+0000ad70: 203e 302e 3320 6465 7065 6e64 696e 6720   >0.3 depending 
+0000ad80: 6f6e 2074 6865 2076 616c 7565 206f 6620  on the value of 
+0000ad90: 666f 6375 735f 6869 6768 6573 745f 706f  focus_highest_po
+0000ada0: 7465 6e74 6961 6c2e 0d0a 2020 2020 2020  tential...      
+0000adb0: 2020 5468 6520 6465 6661 756c 7420 6973    The default is
+0000adc0: 2030 2e32 352e 0d0a 2020 2020 7072 6563   0.25...    prec
+0000add0: 6973 696f 6e5f 726f 756e 6469 6e67 203a  ision_rounding :
+0000ade0: 2062 6f6f 6c65 616e 2c20 6f70 7469 6f6e   boolean, option
+0000adf0: 616c 0d0a 2020 2020 2020 2020 4966 2054  al..        If T
+0000ae00: 7275 652c 2061 2072 6f75 6e64 696e 6720  rue, a rounding 
+0000ae10: 6d65 7468 6f64 2069 7320 6170 706c 6965  method is applie
+0000ae20: 6420 746f 2072 6f75 6e64 2072 6573 756c  d to round resul
+0000ae30: 7473 2074 6f20 6861 7665 206e 6f20 6d6f  ts to have no mo
+0000ae40: 7265 0d0a 2020 2020 2020 2020 6465 6369  re..        deci
+0000ae50: 6d61 6c73 2074 6861 6e20 7768 6174 2063  mals than what c
+0000ae60: 616e 2062 6520 6d65 6173 7572 6564 2e0d  an be measured..
+0000ae70: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
+0000ae80: 6175 6c74 2069 7320 5472 7565 2e0d 0a0d  ault is True....
+0000ae90: 0a20 2020 2052 6574 7572 6e73 0d0a 2020  .    Returns..  
+0000aea0: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064    -------..    d
+0000aeb0: 6620 3a20 4461 7461 4672 616d 650d 0a20  f : DataFrame.. 
+0000aec0: 2020 2020 2020 2044 6174 6146 7261 6d65         DataFrame
+0000aed0: 2074 6861 7420 636f 6e74 6169 6e73 2063   that contains c
+0000aee0: 616c 6375 6c61 7465 6420 7065 7263 656e  alculated percen
+0000aef0: 7469 6c65 730d 0a0d 0a20 2020 2027 2727  tiles....    '''
+0000af00: 0d0a 2020 2020 0d0a 2020 2020 2320 4372  ..    ..    # Cr
+0000af10: 6561 7465 2061 2063 6f70 7920 6f66 2074  eate a copy of t
+0000af20: 6865 2044 6174 6146 7261 6d65 0d0a 2020  he DataFrame..  
+0000af30: 2020 6466 203d 2064 662e 636f 7079 2829    df = df.copy()
+0000af40: 0d0a 2020 2020 0d0a 2020 2020 2320 5370  ..    ..    # Sp
+0000af50: 6c69 7420 7468 6520 7265 7375 6c74 2069  lit the result i
+0000af60: 6e74 6f20 6365 6e73 6f72 2061 6e64 206e  nto censor and n
+0000af70: 756d 6572 6963 2063 6f6d 706f 6e65 6e74  umeric component
+0000af80: 730d 0a20 2020 2064 6620 3d20 7265 7375  s..    df = resu
+0000af90: 6c74 5f74 6f5f 636f 6d70 6f6e 656e 7473  lt_to_components
+0000afa0: 2864 662c 7265 7375 6c74 5f63 6f6c 290d  (df,result_col).
+0000afb0: 0a20 2020 200d 0a20 2020 2023 2043 6f6e  .    ..    # Con
+0000afc0: 7665 7274 2074 6865 2072 6573 756c 7473  vert the results
+0000afd0: 2066 726f 6d20 6365 6e73 6f72 2061 6e64   from censor and
+0000afe0: 206e 756d 6572 6963 2063 6f6d 706f 6e65   numeric compone
+0000aff0: 6e74 7320 746f 2061 6e20 696e 7465 7276  nts to an interv
+0000b000: 616c 2072 6570 7265 7365 6e74 6174 696f  al representatio
+0000b010: 6e0d 0a20 2020 2064 6620 3d20 636f 6d70  n..    df = comp
+0000b020: 6f6e 656e 7473 5f74 6f5f 696e 7465 7276  onents_to_interv
+0000b030: 616c 2864 662c 2069 6e63 6c75 6465 5f6e  al(df, include_n
+0000b040: 6567 6174 6976 655f 696e 7465 7276 616c  egative_interval
+0000b050: 290d 0a20 2020 200d 0a20 2020 2023 2055  )..    ..    # U
+0000b060: 7369 6e67 2074 6865 2069 6e74 6572 7661  sing the interva
+0000b070: 6c73 2c20 6465 7465 726d 696e 6520 7468  ls, determine th
+0000b080: 6520 7261 6e67 6520 6f66 2070 6f73 7369  e range of possi
+0000b090: 626c 6520 7065 7263 656e 7469 6c65 730d  ble percentiles.
+0000b0a0: 0a20 2020 200d 0a20 2020 2023 2049 6620  .    ..    # If 
+0000b0b0: 7468 6572 6520 6172 6520 6e6f 2067 726f  there are no gro
+0000b0c0: 7570 6279 2d63 6f6c 756d 6e73 2c20 7468  upby-columns, th
+0000b0d0: 656e 2074 616b 6520 7065 7263 656e 7469  en take percenti
+0000b0e0: 6c65 206f 6620 616c 6c20 7265 7375 6c74  le of all result
+0000b0f0: 730d 0a20 2020 2069 6620 6e6f 7420 6772  s..    if not gr
+0000b100: 6f75 7062 795f 636f 6c75 6d6e 733a 0d0a  oupby_columns:..
+0000b110: 2020 2020 2020 2020 6466 203d 2070 6572          df = per
+0000b120: 6365 6e74 696c 655f 696e 7465 7276 616c  centile_interval
+0000b130: 2864 662c 2067 726f 7570 6279 5f63 6f6c  (df, groupby_col
+0000b140: 756d 6e73 3d5b 5d2c 0d0a 2020 2020 2020  umns=[],..      
+0000b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b160: 2020 2020 2020 2020 2020 2070 6572 6365             perce
+0000b170: 6e74 696c 653d 7065 7263 656e 7469 6c65  ntile=percentile
+0000b180: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1a0: 2020 2020 6d65 7468 6f64 3d6d 6574 686f      method=metho
+0000b1b0: 6429 0d0a 2020 2020 2320 4966 2074 6865  d)..    # If the
+0000b1c0: 2067 726f 7570 6279 5f63 6f6c 756d 6e73   groupby_columns
+0000b1d0: 2069 7320 6120 6c69 7374 206f 6620 6c69   is a list of li
+0000b1e0: 7374 732c 2074 6865 6e20 7065 7266 6f72  sts, then perfor
+0000b1f0: 6d20 6d75 6c74 6970 6c65 2070 6572 6365  m multiple perce
+0000b200: 6e74 696c 6573 0d0a 2020 2020 656c 6966  ntiles..    elif
+0000b210: 2069 7369 6e73 7461 6e63 6528 6772 6f75   isinstance(grou
+0000b220: 7062 795f 636f 6c75 6d6e 735b 305d 2c6c  pby_columns[0],l
+0000b230: 6973 7429 3a0d 0a20 2020 2020 2020 2066  ist):..        f
+0000b240: 6f72 2067 726f 7570 696e 6720 696e 2067  or grouping in g
+0000b250: 726f 7570 6279 5f63 6f6c 756d 6e73 3a0d  roupby_columns:.
+0000b260: 0a20 2020 2020 2020 2020 2020 2023 204f  .            # O
+0000b270: 6e6c 7920 6170 706c 7920 7065 7263 656e  nly apply percen
+0000b280: 7469 6c65 2074 6f20 6669 6e61 6c20 6772  tile to final gr
+0000b290: 6f75 7069 6e67 0d0a 2020 2020 2020 2020  ouping..        
+0000b2a0: 2020 2020 6966 2067 726f 7570 696e 6720      if grouping 
+0000b2b0: 3d3d 2067 726f 7570 6279 5f63 6f6c 756d  == groupby_colum
+0000b2c0: 6e73 5b2d 315d 3a0d 0a20 2020 2020 2020  ns[-1]:..       
+0000b2d0: 2020 2020 2020 2020 2023 2055 7369 6e67           # Using
+0000b2e0: 2074 6865 2069 6e74 6572 7661 6c73 2c20   the intervals, 
+0000b2f0: 6465 7465 726d 696e 6520 7468 6520 7261  determine the ra
+0000b300: 6e67 6520 6f66 2070 6f73 7369 626c 6520  nge of possible 
+0000b310: 7065 7263 656e 7469 6c65 730d 0a20 2020  percentiles..   
+0000b320: 2020 2020 2020 2020 2020 2020 2064 6620               df 
+0000b330: 3d20 7065 7263 656e 7469 6c65 5f69 6e74  = percentile_int
+0000b340: 6572 7661 6c28 6466 2c20 6772 6f75 7069  erval(df, groupi
+0000b350: 6e67 2c20 7065 7263 656e 7469 6c65 2c20  ng, percentile, 
+0000b360: 6d65 7468 6f64 290d 0a20 2020 2020 2020  method)..       
+0000b370: 2020 2020 2023 2041 7070 6c79 206d 6564       # Apply med
+0000b380: 6961 6e20 746f 2061 6c6c 2070 7269 6f72  ian to all prior
+0000b390: 2067 726f 7570 696e 6773 0d0a 2020 2020   groupings..    
+0000b3a0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0000b3b0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000b3c0: 2055 7369 6e67 2074 6865 2069 6e74 6572   Using the inter
+0000b3d0: 7661 6c73 2c20 6465 7465 726d 696e 6520  vals, determine 
+0000b3e0: 7468 6520 7261 6e67 6520 6f66 2070 6f73  the range of pos
+0000b3f0: 7369 626c 6520 6d65 6469 616e 730d 0a20  sible medians.. 
+0000b400: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000b410: 6620 3d20 7065 7263 656e 7469 6c65 5f69  f = percentile_i
+0000b420: 6e74 6572 7661 6c28 6466 2c20 6772 6f75  nterval(df, grou
+0000b430: 7069 6e67 2c20 3530 2c20 6d65 7468 6f64  ping, 50, method
+0000b440: 290d 0a20 2020 2023 2045 6c73 6520 7468  )..    # Else th
+0000b450: 6520 6772 6f75 7062 795f 636f 6c75 6d6e  e groupby_column
+0000b460: 7320 6973 2061 206c 6973 7420 6f66 2063  s is a list of c
+0000b470: 6f6c 756d 6e20 6e61 6d65 730d 0a20 2020  olumn names..   
+0000b480: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0000b490: 6466 203d 2070 6572 6365 6e74 696c 655f  df = percentile_
+0000b4a0: 696e 7465 7276 616c 2864 662c 2067 726f  interval(df, gro
+0000b4b0: 7570 6279 5f63 6f6c 756d 6e73 2c20 7065  upby_columns, pe
+0000b4c0: 7263 656e 7469 6c65 2c20 6d65 7468 6f64  rcentile, method
+0000b4d0: 290d 0a20 2020 200d 0a20 2020 2023 2043  )..    ..    # C
+0000b4e0: 6f6e 7665 7274 2074 6865 2069 6e74 6572  onvert the inter
+0000b4f0: 7661 6c20 666f 7220 7468 6520 6d69 6e69  val for the mini
+0000b500: 6d75 6d20 696e 746f 2063 656e 736f 7220  mum into censor 
+0000b510: 616e 6420 6e75 6d65 7269 6320 6e6f 7461  and numeric nota
+0000b520: 7469 6f6e 0d0a 2020 2020 6466 203d 2069  tion..    df = i
+0000b530: 6e74 6572 7661 6c5f 746f 5f63 6f6d 706f  nterval_to_compo
+0000b540: 6e65 6e74 7328 6466 2c0d 0a20 2020 2020  nents(df,..     
+0000b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b560: 2020 2020 2020 2020 2020 2066 6f63 7573             focus
+0000b570: 5f68 6967 685f 706f 7465 6e74 6961 6c20  _high_potential 
+0000b580: 3d20 666f 6375 735f 6869 6768 5f70 6f74  = focus_high_pot
+0000b590: 656e 7469 616c 2c0d 0a20 2020 2020 2020  ential,..       
+0000b5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5b0: 2020 2020 2020 2020 2069 6e63 6c75 6465           include
+0000b5c0: 5f6e 6567 6174 6976 655f 696e 7465 7276  _negative_interv
+0000b5d0: 616c 203d 2069 6e63 6c75 6465 5f6e 6567  al = include_neg
+0000b5e0: 6174 6976 655f 696e 7465 7276 616c 2c0d  ative_interval,.
+0000b5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0000b600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b610: 2020 696e 636c 7564 655f 6e65 6761 7469    include_negati
-0000b620: 7665 5f69 6e74 6572 7661 6c20 3d20 696e  ve_interval = in
-0000b630: 636c 7564 655f 6e65 6761 7469 7665 5f69  clude_negative_i
-0000b640: 6e74 6572 7661 6c2c 0d0a 2020 2020 2020  nterval,..      
-0000b650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b660: 2020 2020 2020 2020 2020 7072 6563 6973            precis
-0000b670: 696f 6e5f 746f 6c65 7261 6e63 655f 746f  ion_tolerance_to
-0000b680: 5f64 726f 705f 6365 6e73 6f72 203d 2070  _drop_censor = p
-0000b690: 7265 6369 7369 6f6e 5f74 6f6c 6572 616e  recision_toleran
-0000b6a0: 6365 5f74 6f5f 6472 6f70 5f63 656e 736f  ce_to_drop_censo
-0000b6b0: 7229 0d0a 2020 2020 0d0a 2020 2020 2320  r)..    ..    # 
-0000b6c0: 4372 6561 7465 2069 6e74 6572 7661 6c20  Create interval 
-0000b6d0: 6e6f 7461 7469 6f6e 2066 6f72 2074 6865  notation for the
-0000b6e0: 2070 6572 6365 6e74 696c 650d 0a20 2020   percentile..   
-0000b6f0: 2064 6620 3d20 696e 7465 7276 616c 5f6e   df = interval_n
-0000b700: 6f74 6174 696f 6e28 6466 2c20 7072 6563  otation(df, prec
-0000b710: 6973 696f 6e5f 726f 756e 6469 6e67 290d  ision_rounding).
-0000b720: 0a20 2020 200d 0a20 2020 2023 2043 6f6d  .    ..    # Com
-0000b730: 6269 6e65 2074 6865 2063 656e 736f 7220  bine the censor 
-0000b740: 616e 6420 6e75 6d65 7269 6320 636f 6d70  and numeric comp
-0000b750: 6f6e 656e 7473 2069 6e74 6f20 6120 7265  onents into a re
-0000b760: 7375 6c74 0d0a 2020 2020 6466 203d 2063  sult..    df = c
-0000b770: 6f6d 706f 6e65 6e74 735f 746f 5f72 6573  omponents_to_res
-0000b780: 756c 7428 6466 2c20 7072 6563 6973 696f  ult(df, precisio
-0000b790: 6e5f 726f 756e 6469 6e67 290d 0a20 2020  n_rounding)..   
-0000b7a0: 200d 0a20 2020 2023 2044 726f 7020 776f   ..    # Drop wo
-0000b7b0: 726b 696e 6720 636f 6c75 6d6e 730d 0a20  rking columns.. 
-0000b7c0: 2020 2064 6620 3d20 6466 2e64 726f 7028     df = df.drop(
-0000b7d0: 6466 2e66 696c 7465 7228 7265 6765 783d  df.filter(regex=
-0000b7e0: 275f 5f27 292e 636f 6c75 6d6e 732c 2061  '__').columns, a
-0000b7f0: 7869 733d 3129 0d0a 2020 2020 0d0a 2020  xis=1)..    ..  
-0000b800: 2020 2320 5265 6f72 6465 7220 636f 6c75    # Reorder colu
-0000b810: 6d6e 730d 0a20 2020 2066 6f72 2063 6f6c  mns..    for col
-0000b820: 2069 6e20 5b73 7461 745f 636f 6c2c 7265   in [stat_col,re
-0000b830: 7375 6c74 5f63 6f6c 2c63 656e 736f 725f  sult_col,censor_
-0000b840: 636f 6c2c 6e75 6d65 7269 635f 636f 6c2c  col,numeric_col,
-0000b850: 696e 7465 7276 616c 5f63 6f6c 5d3a 0d0a  interval_col]:..
-0000b860: 2020 2020 2020 2020 6466 5b63 6f6c 5d20          df[col] 
-0000b870: 3d20 6466 2e70 6f70 2863 6f6c 290d 0a20  = df.pop(col).. 
-0000b880: 2020 200d 0a20 2020 2072 6574 7572 6e20     ..    return 
-0000b890: 6466 0d0a 0d0a 6465 6620 6d65 6469 616e  df....def median
-0000b8a0: 2864 662c 0d0a 2020 2020 2020 2020 2020  (df,..          
-0000b8b0: 2072 6573 756c 745f 636f 6c2c 0d0a 2020   result_col,..  
-0000b8c0: 2020 2020 2020 2020 2067 726f 7570 6279           groupby
-0000b8d0: 5f63 6f6c 756d 6e73 203d 204e 6f6e 652c  _columns = None,
-0000b8e0: 0d0a 2020 2020 2020 2020 2020 2066 6f63  ..           foc
-0000b8f0: 7573 5f68 6967 685f 706f 7465 6e74 6961  us_high_potentia
-0000b900: 6c20 3d20 5472 7565 2c0d 0a20 2020 2020  l = True,..     
-0000b910: 2020 2020 2020 696e 636c 7564 655f 6e65        include_ne
-0000b920: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
-0000b930: 3d20 4661 6c73 652c 0d0a 2020 2020 2020  = False,..      
-0000b940: 2020 2020 2070 7265 6369 7369 6f6e 5f74       precision_t
-0000b950: 6f6c 6572 616e 6365 5f74 6f5f 6472 6f70  olerance_to_drop
-0000b960: 5f63 656e 736f 7220 3d20 302e 3235 2c0d  _censor = 0.25,.
-0000b970: 0a20 2020 2020 2020 2020 2020 7072 6563  .           prec
-0000b980: 6973 696f 6e5f 726f 756e 6469 6e67 203d  ision_rounding =
-0000b990: 2054 7275 6529 3a0d 0a20 2020 2027 2727   True):..    '''
-0000b9a0: 0d0a 2020 2020 4120 6675 6e63 7469 6f6e  ..    A function
-0000b9b0: 2074 6861 7420 6765 6e65 7261 7465 7320   that generates 
-0000b9c0: 6d65 6469 616e 2072 6573 756c 7473 2066  median results f
-0000b9d0: 6f72 2067 726f 7570 7320 7769 7468 696e  or groups within
-0000b9e0: 2061 2044 6174 6146 7261 6d65 2e0d 0a0d   a DataFrame....
-0000b9f0: 0a20 2020 2050 6172 616d 6574 6572 730d  .    Parameters.
-0000ba00: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d  .    ----------.
-0000ba10: 0a20 2020 2064 6620 3a20 4461 7461 4672  .    df : DataFr
-0000ba20: 616d 650d 0a20 2020 2020 2020 2044 6174  ame..        Dat
-0000ba30: 6146 7261 6d65 2074 6861 7420 636f 6e74  aFrame that cont
-0000ba40: 6169 6e73 2063 656e 736f 7265 6420 6f72  ains censored or
-0000ba50: 2075 6e63 656e 736f 7265 6420 7265 7375   uncensored resu
-0000ba60: 6c74 730d 0a20 2020 2072 6573 756c 745f  lts..    result_
-0000ba70: 636f 6c20 3a20 7374 7269 6e67 0d0a 2020  col : string..  
-0000ba80: 2020 2020 2020 5468 6520 636f 6c75 6d6e        The column
-0000ba90: 206e 616d 6520 666f 7220 7468 6520 636f   name for the co
-0000baa0: 6c75 6d6e 2074 6861 7420 636f 6e74 6169  lumn that contai
-0000bab0: 6e20 7468 6520 7265 7375 6c74 7320 6173  n the results as
-0000bac0: 2074 6578 742e 0d0a 2020 2020 2020 2020   text...        
-0000bad0: 4f6e 6c79 2066 6f75 7220 706f 7373 6962  Only four possib
-0000bae0: 6c65 2063 656e 736f 7273 2073 686f 756c  le censors shoul
-0000baf0: 6420 6265 2075 7365 6420 283c 2ce2 89a4  d be used (<,...
-0000bb00: 2ce2 89a5 2c3e 292e 0d0a 2020 2020 6772  ,...,>)...    gr
-0000bb10: 6f75 7062 795f 636f 6c75 6d6e 7320 3a20  oupby_columns : 
-0000bb20: 6c69 7374 7320 6f66 2073 7472 696e 6773  lists of strings
-0000bb30: 2028 6f72 206c 6973 7420 6f66 206c 6973   (or list of lis
-0000bb40: 7473 292c 206f 7074 696f 6e61 6c0d 0a20  ts), optional.. 
-0000bb50: 2020 2020 2020 204c 6973 7420 6f66 2063         List of c
-0000bb60: 6f6c 756d 6e20 6e61 6d65 7320 7468 6174  olumn names that
-0000bb70: 2073 686f 756c 6420 6265 2075 7365 6420   should be used 
-0000bb80: 746f 2063 7265 6174 6520 6772 6f75 7073  to create groups
-0000bb90: 2e20 4120 6d65 6469 616e 0d0a 2020 2020  . A median..    
-0000bba0: 2020 2020 7769 6c6c 2062 6520 666f 756e      will be foun
-0000bbb0: 6420 7769 7468 696e 2065 6163 6820 6772  d within each gr
-0000bbc0: 6f75 702e 204d 756c 7469 706c 6520 6c69  oup. Multiple li
-0000bbd0: 7374 7320 6361 6e20 6265 2073 7570 706c  sts can be suppl
-0000bbe0: 6965 6420 746f 0d0a 2020 2020 2020 2020  ied to..        
-0000bbf0: 7065 7266 6f72 6d20 7365 7175 656e 7469  perform sequenti
-0000bc00: 616c 206d 6564 6961 6e20 7065 7263 656e  al median percen
-0000bc10: 7469 6c65 7320 6265 666f 7265 2063 616c  tiles before cal
-0000bc20: 6375 6c61 7469 6e67 2061 206d 6564 6961  culating a media
-0000bc30: 6e0d 0a20 2020 2020 2020 206f 7665 7220  n..        over 
-0000bc40: 7468 6520 6669 6e61 6c20 6772 6f75 7069  the final groupi
-0000bc50: 6e67 2e0d 0a20 2020 2020 2020 2054 6865  ng...        The
-0000bc60: 2064 6566 6175 6c74 2069 7320 4e6f 6e65   default is None
-0000bc70: 2e0d 0a20 2020 2066 6f63 7573 5f68 6967  ...    focus_hig
-0000bc80: 685f 706f 7465 6e74 6961 6c20 3a20 626f  h_potential : bo
-0000bc90: 6f6c 6561 6e2c 206f 7074 696f 6e61 6c0d  olean, optional.
-0000bca0: 0a20 2020 2020 2020 2049 6620 5472 7565  .        If True
-0000bcb0: 2c20 7468 656e 2069 6e66 6f72 6d61 7469  , then informati
-0000bcc0: 6f6e 206f 6e20 7468 6520 6869 6768 6573  on on the highes
-0000bcd0: 7420 706f 7465 6e74 6961 6c20 7265 7375  t potential resu
-0000bce0: 6c74 2077 696c 6c20 6265 0d0a 2020 2020  lt will be..    
-0000bcf0: 2020 2020 666f 6375 7365 6420 6f76 6572      focused over
-0000bd00: 2074 6865 206c 6f77 6573 7420 706f 7465   the lowest pote
-0000bd10: 6e74 6961 6c20 7265 7375 6c74 2e0d 0a20  ntial result... 
-0000bd20: 2020 2069 6e63 6c75 6465 5f6e 6567 6174     include_negat
-0000bd30: 6976 655f 696e 7465 7276 616c 203a 2062  ive_interval : b
-0000bd40: 6f6f 6c65 616e 2c20 6f70 7469 6f6e 616c  oolean, optional
-0000bd50: 0d0a 2020 2020 2020 2020 4966 2054 7275  ..        If Tru
-0000bd60: 652c 2074 6865 6e20 616c 6c20 706f 7369  e, then all posi
-0000bd70: 7469 7665 2061 6e64 206e 6567 6174 6976  tive and negativ
-0000bd80: 6520 7661 6c75 6573 2061 7265 2063 6f6e  e values are con
-0000bd90: 7369 6465 7265 640d 0a20 2020 2020 2020  sidered..       
-0000bda0: 2065 2e67 2e2c 203c 302e 3520 776f 756c   e.g., <0.5 woul
-0000bdb0: 6420 6265 2063 6f6e 7665 7274 6564 2074  d be converted t
-0000bdc0: 6f20 282d 6e70 2e69 6e66 2c35 292e 0d0a  o (-np.inf,5)...
-0000bdd0: 2020 2020 2020 2020 4966 2046 616c 7365          If False
-0000bde0: 2c20 7468 656e 206f 6e6c 7920 6e6f 6e2d  , then only non-
-0000bdf0: 6e65 6761 7469 7665 2076 616c 7565 7320  negative values 
-0000be00: 6172 6520 636f 6e73 6964 6572 6564 0d0a  are considered..
-0000be10: 2020 2020 2020 2020 652e 672e 2c20 3c30          e.g., <0
-0000be20: 2e35 2077 6f75 6c64 2062 6520 636f 6e76  .5 would be conv
-0000be30: 6572 7465 6420 746f 205b 302c 3529 2e0d  erted to [0,5)..
-0000be40: 0a20 2020 2020 2020 2054 6869 7320 7365  .        This se
-0000be50: 7474 696e 6720 6f6e 6c79 2061 6666 6563  tting only affec
-0000be60: 7473 2072 6573 756c 7473 2069 6620 666f  ts results if fo
-0000be70: 6375 735f 6869 6768 5f70 6f74 656e 7469  cus_high_potenti
-0000be80: 616c 2069 7320 4661 6c73 652e 0d0a 2020  al is False...  
-0000be90: 2020 2020 2020 5468 6520 6465 6661 756c        The defaul
-0000bea0: 7420 6973 2046 616c 7365 2e0d 0a20 2020  t is False...   
-0000beb0: 2070 7265 6369 7369 6f6e 5f74 6f6c 6572   precision_toler
-0000bec0: 616e 6365 5f74 6f5f 6472 6f70 5f63 656e  ance_to_drop_cen
-0000bed0: 736f 7220 3a20 666c 6f61 742c 206f 7074  sor : float, opt
-0000bee0: 696f 6e61 6c0d 0a20 2020 2020 2020 2054  ional..        T
-0000bef0: 6872 6573 686f 6c64 2066 6f72 2072 6570  hreshold for rep
-0000bf00: 6f72 7469 6e67 2063 656e 736f 7265 6420  orting censored 
-0000bf10: 7673 206e 6f6e 2d63 656e 736f 7265 6420  vs non-censored 
-0000bf20: 7265 7375 6c74 732e 0d0a 2020 2020 2020  results...      
-0000bf30: 2020 5573 696e 6720 7468 6520 6465 6661    Using the defa
-0000bf40: 756c 742c 2061 2072 6573 756c 7420 7468  ult, a result th
-0000bf50: 6174 2069 7320 6b6e 6f77 6e20 746f 2062  at is known to b
-0000bf60: 6520 696e 2074 6865 2069 6e74 6572 7661  e in the interva
-0000bf70: 6c20 2830 2e33 2c20 302e 3529 0d0a 2020  l (0.3, 0.5)..  
-0000bf80: 2020 2020 2020 776f 756c 6420 6265 2072        would be r
-0000bf90: 6574 7572 6e65 6420 6173 2030 2e34 2c20  eturned as 0.4, 
-0000bfa0: 7768 6572 6561 7320 6120 746f 6c65 7261  whereas a tolera
-0000bfb0: 6e63 6520 6f66 2030 2077 6f75 6c64 2079  nce of 0 would y
-0000bfc0: 6965 6c64 2061 0d0a 2020 2020 2020 2020  ield a..        
-0000bfd0: 7265 7375 6c74 206f 6620 3c30 2e35 206f  result of <0.5 o
-0000bfe0: 7220 3e30 2e33 2064 6570 656e 6469 6e67  r >0.3 depending
-0000bff0: 206f 6e20 7468 6520 7661 6c75 6520 6f66   on the value of
-0000c000: 2066 6f63 7573 5f68 6967 6865 7374 5f70   focus_highest_p
-0000c010: 6f74 656e 7469 616c 2e0d 0a20 2020 2020  otential...     
-0000c020: 2020 2054 6865 2064 6566 6175 6c74 2069     The default i
-0000c030: 7320 302e 3235 2e0d 0a20 2020 2070 7265  s 0.25...    pre
-0000c040: 6369 7369 6f6e 5f72 6f75 6e64 696e 6720  cision_rounding 
-0000c050: 3a20 626f 6f6c 6561 6e2c 206f 7074 696f  : boolean, optio
-0000c060: 6e61 6c0d 0a20 2020 2020 2020 2049 6620  nal..        If 
-0000c070: 5472 7565 2c20 6120 726f 756e 6469 6e67  True, a rounding
-0000c080: 206d 6574 686f 6420 6973 2061 7070 6c69   method is appli
-0000c090: 6564 2074 6f20 726f 756e 6420 7265 7375  ed to round resu
-0000c0a0: 6c74 7320 746f 2068 6176 6520 6e6f 206d  lts to have no m
-0000c0b0: 6f72 650d 0a20 2020 2020 2020 2064 6563  ore..        dec
-0000c0c0: 696d 616c 7320 7468 616e 2077 6861 7420  imals than what 
-0000c0d0: 6361 6e20 6265 206d 6561 7375 7265 642e  can be measured.
-0000c0e0: 0d0a 2020 2020 2020 2020 5468 6520 6465  ..        The de
-0000c0f0: 6661 756c 7420 6973 2054 7275 652e 0d0a  fault is True...
-0000c100: 0d0a 2020 2020 5265 7475 726e 730d 0a20  ..    Returns.. 
-0000c110: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
-0000c120: 6466 203a 2044 6174 6146 7261 6d65 0d0a  df : DataFrame..
-0000c130: 2020 2020 2020 2020 4461 7461 4672 616d          DataFram
-0000c140: 6520 7468 6174 2063 6f6e 7461 696e 7320  e that contains 
-0000c150: 6361 6c63 756c 6174 6564 2070 6572 6365  calculated perce
-0000c160: 6e74 696c 6573 0d0a 0d0a 2020 2020 2727  ntiles....    ''
-0000c170: 270d 0a20 2020 200d 0a20 2020 2023 2043  '..    ..    # C
-0000c180: 7265 6174 6520 6120 636f 7079 206f 6620  reate a copy of 
-0000c190: 7468 6520 4461 7461 4672 616d 650d 0a20  the DataFrame.. 
-0000c1a0: 2020 2064 6620 3d20 6466 2e63 6f70 7928     df = df.copy(
-0000c1b0: 290d 0a20 2020 200d 0a20 2020 2023 2043  )..    ..    # C
-0000c1c0: 616c 6c20 7065 7263 656e 7469 6c65 2066  all percentile f
-0000c1d0: 756e 6374 696f 6e20 7769 7468 2070 6572  unction with per
-0000c1e0: 6365 6e74 696c 6520 3d20 3530 0d0a 2020  centile = 50..  
-0000c1f0: 2020 6466 203d 2070 6572 6365 6e74 696c    df = percentil
-0000c200: 6528 6466 2c0d 0a20 2020 2020 2020 2020  e(df,..         
-0000c210: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-0000c220: 745f 636f 6c2c 0d0a 2020 2020 2020 2020  t_col,..        
-0000c230: 2020 2020 2020 2020 2020 2020 3530 2c0d              50,.
-0000c240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c250: 2020 2020 2067 726f 7570 6279 5f63 6f6c       groupby_col
-0000c260: 756d 6e73 203d 2067 726f 7570 6279 5f63  umns = groupby_c
-0000c270: 6f6c 756d 6e73 2c0d 0a20 2020 2020 2020  olumns,..       
-0000c280: 2020 2020 2020 2020 2020 2020 2066 6f63               foc
-0000c290: 7573 5f68 6967 685f 706f 7465 6e74 6961  us_high_potentia
-0000c2a0: 6c20 3d20 666f 6375 735f 6869 6768 5f70  l = focus_high_p
-0000c2b0: 6f74 656e 7469 616c 2c0d 0a20 2020 2020  otential,..     
-0000c2c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000c2d0: 6e63 6c75 6465 5f6e 6567 6174 6976 655f  nclude_negative_
-0000c2e0: 696e 7465 7276 616c 203d 2069 6e63 6c75  interval = inclu
-0000c2f0: 6465 5f6e 6567 6174 6976 655f 696e 7465  de_negative_inte
-0000c300: 7276 616c 2c0d 0a20 2020 2020 2020 2020  rval,..         
-0000c310: 2020 2020 2020 2020 2020 2070 7265 6369             preci
-0000c320: 7369 6f6e 5f74 6f6c 6572 616e 6365 5f74  sion_tolerance_t
-0000c330: 6f5f 6472 6f70 5f63 656e 736f 7220 3d20  o_drop_censor = 
-0000c340: 7072 6563 6973 696f 6e5f 746f 6c65 7261  precision_tolera
-0000c350: 6e63 655f 746f 5f64 726f 705f 6365 6e73  nce_to_drop_cens
-0000c360: 6f72 2c0d 0a20 2020 2020 2020 2020 2020  or,..           
-0000c370: 2020 2020 2020 2020 2070 7265 6369 7369           precisi
-0000c380: 6f6e 5f72 6f75 6e64 696e 6720 3d20 7072  on_rounding = pr
-0000c390: 6563 6973 696f 6e5f 726f 756e 6469 6e67  ecision_rounding
-0000c3a0: 290d 0a20 2020 200d 0a20 2020 2072 6574  )..    ..    ret
-0000c3b0: 7572 6e20 6466 0d0a 0d0a                 urn df....
+0000b610: 2070 7265 6369 7369 6f6e 5f74 6f6c 6572   precision_toler
+0000b620: 616e 6365 5f74 6f5f 6472 6f70 5f63 656e  ance_to_drop_cen
+0000b630: 736f 7220 3d20 7072 6563 6973 696f 6e5f  sor = precision_
+0000b640: 746f 6c65 7261 6e63 655f 746f 5f64 726f  tolerance_to_dro
+0000b650: 705f 6365 6e73 6f72 290d 0a20 2020 200d  p_censor)..    .
+0000b660: 0a20 2020 2023 2043 7265 6174 6520 696e  .    # Create in
+0000b670: 7465 7276 616c 206e 6f74 6174 696f 6e20  terval notation 
+0000b680: 666f 7220 7468 6520 7065 7263 656e 7469  for the percenti
+0000b690: 6c65 0d0a 2020 2020 6466 203d 2069 6e74  le..    df = int
+0000b6a0: 6572 7661 6c5f 6e6f 7461 7469 6f6e 2864  erval_notation(d
+0000b6b0: 662c 2070 7265 6369 7369 6f6e 5f72 6f75  f, precision_rou
+0000b6c0: 6e64 696e 6729 0d0a 2020 2020 0d0a 2020  nding)..    ..  
+0000b6d0: 2020 2320 436f 6d62 696e 6520 7468 6520    # Combine the 
+0000b6e0: 6365 6e73 6f72 2061 6e64 206e 756d 6572  censor and numer
+0000b6f0: 6963 2063 6f6d 706f 6e65 6e74 7320 696e  ic components in
+0000b700: 746f 2061 2072 6573 756c 740d 0a20 2020  to a result..   
+0000b710: 2064 6620 3d20 636f 6d70 6f6e 656e 7473   df = components
+0000b720: 5f74 6f5f 7265 7375 6c74 2864 662c 2070  _to_result(df, p
+0000b730: 7265 6369 7369 6f6e 5f72 6f75 6e64 696e  recision_roundin
+0000b740: 6729 0d0a 2020 2020 0d0a 2020 2020 2320  g)..    ..    # 
+0000b750: 4472 6f70 2077 6f72 6b69 6e67 2063 6f6c  Drop working col
+0000b760: 756d 6e73 0d0a 2020 2020 6466 203d 2064  umns..    df = d
+0000b770: 662e 6472 6f70 2864 662e 6669 6c74 6572  f.drop(df.filter
+0000b780: 2872 6567 6578 3d27 5f5f 2729 2e63 6f6c  (regex='__').col
+0000b790: 756d 6e73 2c20 6178 6973 3d31 290d 0a20  umns, axis=1).. 
+0000b7a0: 2020 200d 0a20 2020 2023 2052 656f 7264     ..    # Reord
+0000b7b0: 6572 2063 6f6c 756d 6e73 0d0a 2020 2020  er columns..    
+0000b7c0: 666f 7220 636f 6c20 696e 205b 7374 6174  for col in [stat
+0000b7d0: 5f63 6f6c 2c72 6573 756c 745f 636f 6c2c  _col,result_col,
+0000b7e0: 6365 6e73 6f72 5f63 6f6c 2c6e 756d 6572  censor_col,numer
+0000b7f0: 6963 5f63 6f6c 2c69 6e74 6572 7661 6c5f  ic_col,interval_
+0000b800: 636f 6c5d 3a0d 0a20 2020 2020 2020 2064  col]:..        d
+0000b810: 665b 636f 6c5d 203d 2064 662e 706f 7028  f[col] = df.pop(
+0000b820: 636f 6c29 0d0a 2020 2020 0d0a 2020 2020  col)..    ..    
+0000b830: 7265 7475 726e 2064 660d 0a0d 0a64 6566  return df....def
+0000b840: 206d 6564 6961 6e28 6466 2c0d 0a20 2020   median(df,..   
+0000b850: 2020 2020 2020 2020 7265 7375 6c74 5f63          result_c
+0000b860: 6f6c 2c0d 0a20 2020 2020 2020 2020 2020  ol,..           
+0000b870: 6772 6f75 7062 795f 636f 6c75 6d6e 7320  groupby_columns 
+0000b880: 3d20 4e6f 6e65 2c0d 0a20 2020 2020 2020  = None,..       
+0000b890: 2020 2020 666f 6375 735f 6869 6768 5f70      focus_high_p
+0000b8a0: 6f74 656e 7469 616c 203d 2054 7275 652c  otential = True,
+0000b8b0: 0d0a 2020 2020 2020 2020 2020 2069 6e63  ..           inc
+0000b8c0: 6c75 6465 5f6e 6567 6174 6976 655f 696e  lude_negative_in
+0000b8d0: 7465 7276 616c 203d 2046 616c 7365 2c0d  terval = False,.
+0000b8e0: 0a20 2020 2020 2020 2020 2020 7072 6563  .           prec
+0000b8f0: 6973 696f 6e5f 746f 6c65 7261 6e63 655f  ision_tolerance_
+0000b900: 746f 5f64 726f 705f 6365 6e73 6f72 203d  to_drop_censor =
+0000b910: 2030 2e32 352c 0d0a 2020 2020 2020 2020   0.25,..        
+0000b920: 2020 2070 7265 6369 7369 6f6e 5f72 6f75     precision_rou
+0000b930: 6e64 696e 6720 3d20 5472 7565 293a 0d0a  nding = True):..
+0000b940: 2020 2020 2727 270d 0a20 2020 2041 2066      '''..    A f
+0000b950: 756e 6374 696f 6e20 7468 6174 2067 656e  unction that gen
+0000b960: 6572 6174 6573 206d 6564 6961 6e20 7265  erates median re
+0000b970: 7375 6c74 7320 666f 7220 6772 6f75 7073  sults for groups
+0000b980: 2077 6974 6869 6e20 6120 4461 7461 4672   within a DataFr
+0000b990: 616d 652e 0d0a 0d0a 2020 2020 5061 7261  ame.....    Para
+0000b9a0: 6d65 7465 7273 0d0a 2020 2020 2d2d 2d2d  meters..    ----
+0000b9b0: 2d2d 2d2d 2d2d 0d0a 2020 2020 6466 203a  ------..    df :
+0000b9c0: 2044 6174 6146 7261 6d65 0d0a 2020 2020   DataFrame..    
+0000b9d0: 2020 2020 4461 7461 4672 616d 6520 7468      DataFrame th
+0000b9e0: 6174 2063 6f6e 7461 696e 7320 6365 6e73  at contains cens
+0000b9f0: 6f72 6564 206f 7220 756e 6365 6e73 6f72  ored or uncensor
+0000ba00: 6564 2072 6573 756c 7473 0d0a 2020 2020  ed results..    
+0000ba10: 7265 7375 6c74 5f63 6f6c 203a 2073 7472  result_col : str
+0000ba20: 696e 670d 0a20 2020 2020 2020 2054 6865  ing..        The
+0000ba30: 2063 6f6c 756d 6e20 6e61 6d65 2066 6f72   column name for
+0000ba40: 2074 6865 2063 6f6c 756d 6e20 7468 6174   the column that
+0000ba50: 2063 6f6e 7461 696e 2074 6865 2072 6573   contain the res
+0000ba60: 756c 7473 2061 7320 7465 7874 2e0d 0a20  ults as text... 
+0000ba70: 2020 2020 2020 204f 6e6c 7920 666f 7572         Only four
+0000ba80: 2070 6f73 7369 626c 6520 6365 6e73 6f72   possible censor
+0000ba90: 7320 7368 6f75 6c64 2062 6520 7573 6564  s should be used
+0000baa0: 2028 3c2c e289 a42c e289 a52c 3e29 2e0d   (<,...,...,>)..
+0000bab0: 0a20 2020 2067 726f 7570 6279 5f63 6f6c  .    groupby_col
+0000bac0: 756d 6e73 203a 206c 6973 7473 206f 6620  umns : lists of 
+0000bad0: 7374 7269 6e67 7320 286f 7220 6c69 7374  strings (or list
+0000bae0: 206f 6620 6c69 7374 7329 2c20 6f70 7469   of lists), opti
+0000baf0: 6f6e 616c 0d0a 2020 2020 2020 2020 4c69  onal..        Li
+0000bb00: 7374 206f 6620 636f 6c75 6d6e 206e 616d  st of column nam
+0000bb10: 6573 2074 6861 7420 7368 6f75 6c64 2062  es that should b
+0000bb20: 6520 7573 6564 2074 6f20 6372 6561 7465  e used to create
+0000bb30: 2067 726f 7570 732e 2041 206d 6564 6961   groups. A media
+0000bb40: 6e0d 0a20 2020 2020 2020 2077 696c 6c20  n..        will 
+0000bb50: 6265 2066 6f75 6e64 2077 6974 6869 6e20  be found within 
+0000bb60: 6561 6368 2067 726f 7570 2e20 4d75 6c74  each group. Mult
+0000bb70: 6970 6c65 206c 6973 7473 2063 616e 2062  iple lists can b
+0000bb80: 6520 7375 7070 6c69 6564 2074 6f0d 0a20  e supplied to.. 
+0000bb90: 2020 2020 2020 2070 6572 666f 726d 2073         perform s
+0000bba0: 6571 7565 6e74 6961 6c20 6d65 6469 616e  equential median
+0000bbb0: 2070 6572 6365 6e74 696c 6573 2062 6566   percentiles bef
+0000bbc0: 6f72 6520 6361 6c63 756c 6174 696e 6720  ore calculating 
+0000bbd0: 6120 6d65 6469 616e 0d0a 2020 2020 2020  a median..      
+0000bbe0: 2020 6f76 6572 2074 6865 2066 696e 616c    over the final
+0000bbf0: 2067 726f 7570 696e 672e 0d0a 2020 2020   grouping...    
+0000bc00: 2020 2020 5468 6520 6465 6661 756c 7420      The default 
+0000bc10: 6973 204e 6f6e 652e 0d0a 2020 2020 666f  is None...    fo
+0000bc20: 6375 735f 6869 6768 5f70 6f74 656e 7469  cus_high_potenti
+0000bc30: 616c 203a 2062 6f6f 6c65 616e 2c20 6f70  al : boolean, op
+0000bc40: 7469 6f6e 616c 0d0a 2020 2020 2020 2020  tional..        
+0000bc50: 4966 2054 7275 652c 2074 6865 6e20 696e  If True, then in
+0000bc60: 666f 726d 6174 696f 6e20 6f6e 2074 6865  formation on the
+0000bc70: 2068 6967 6865 7374 2070 6f74 656e 7469   highest potenti
+0000bc80: 616c 2072 6573 756c 7420 7769 6c6c 2062  al result will b
+0000bc90: 650d 0a20 2020 2020 2020 2066 6f63 7573  e..        focus
+0000bca0: 6564 206f 7665 7220 7468 6520 6c6f 7765  ed over the lowe
+0000bcb0: 7374 2070 6f74 656e 7469 616c 2072 6573  st potential res
+0000bcc0: 756c 742e 0d0a 2020 2020 696e 636c 7564  ult...    includ
+0000bcd0: 655f 6e65 6761 7469 7665 5f69 6e74 6572  e_negative_inter
+0000bce0: 7661 6c20 3a20 626f 6f6c 6561 6e2c 206f  val : boolean, o
+0000bcf0: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
+0000bd00: 2049 6620 5472 7565 2c20 7468 656e 2061   If True, then a
+0000bd10: 6c6c 2070 6f73 6974 6976 6520 616e 6420  ll positive and 
+0000bd20: 6e65 6761 7469 7665 2076 616c 7565 7320  negative values 
+0000bd30: 6172 6520 636f 6e73 6964 6572 6564 0d0a  are considered..
+0000bd40: 2020 2020 2020 2020 652e 672e 2c20 3c30          e.g., <0
+0000bd50: 2e35 2077 6f75 6c64 2062 6520 636f 6e76  .5 would be conv
+0000bd60: 6572 7465 6420 746f 2028 2d6e 702e 696e  erted to (-np.in
+0000bd70: 662c 3529 2e0d 0a20 2020 2020 2020 2049  f,5)...        I
+0000bd80: 6620 4661 6c73 652c 2074 6865 6e20 6f6e  f False, then on
+0000bd90: 6c79 206e 6f6e 2d6e 6567 6174 6976 6520  ly non-negative 
+0000bda0: 7661 6c75 6573 2061 7265 2063 6f6e 7369  values are consi
+0000bdb0: 6465 7265 640d 0a20 2020 2020 2020 2065  dered..        e
+0000bdc0: 2e67 2e2c 203c 302e 3520 776f 756c 6420  .g., <0.5 would 
+0000bdd0: 6265 2063 6f6e 7665 7274 6564 2074 6f20  be converted to 
+0000bde0: 5b30 2c35 292e 0d0a 2020 2020 2020 2020  [0,5)...        
+0000bdf0: 5468 6973 2073 6574 7469 6e67 206f 6e6c  This setting onl
+0000be00: 7920 6166 6665 6374 7320 7265 7375 6c74  y affects result
+0000be10: 7320 6966 2066 6f63 7573 5f68 6967 685f  s if focus_high_
+0000be20: 706f 7465 6e74 6961 6c20 6973 2046 616c  potential is Fal
+0000be30: 7365 2e0d 0a20 2020 2020 2020 2054 6865  se...        The
+0000be40: 2064 6566 6175 6c74 2069 7320 4661 6c73   default is Fals
+0000be50: 652e 0d0a 2020 2020 7072 6563 6973 696f  e...    precisio
+0000be60: 6e5f 746f 6c65 7261 6e63 655f 746f 5f64  n_tolerance_to_d
+0000be70: 726f 705f 6365 6e73 6f72 203a 2066 6c6f  rop_censor : flo
+0000be80: 6174 2c20 6f70 7469 6f6e 616c 0d0a 2020  at, optional..  
+0000be90: 2020 2020 2020 5468 7265 7368 6f6c 6420        Threshold 
+0000bea0: 666f 7220 7265 706f 7274 696e 6720 6365  for reporting ce
+0000beb0: 6e73 6f72 6564 2076 7320 6e6f 6e2d 6365  nsored vs non-ce
+0000bec0: 6e73 6f72 6564 2072 6573 756c 7473 2e0d  nsored results..
+0000bed0: 0a20 2020 2020 2020 2055 7369 6e67 2074  .        Using t
+0000bee0: 6865 2064 6566 6175 6c74 2c20 6120 7265  he default, a re
+0000bef0: 7375 6c74 2074 6861 7420 6973 206b 6e6f  sult that is kno
+0000bf00: 776e 2074 6f20 6265 2069 6e20 7468 6520  wn to be in the 
+0000bf10: 696e 7465 7276 616c 2028 302e 332c 2030  interval (0.3, 0
+0000bf20: 2e35 290d 0a20 2020 2020 2020 2077 6f75  .5)..        wou
+0000bf30: 6c64 2062 6520 7265 7475 726e 6564 2061  ld be returned a
+0000bf40: 7320 302e 342c 2077 6865 7265 6173 2061  s 0.4, whereas a
+0000bf50: 2074 6f6c 6572 616e 6365 206f 6620 3020   tolerance of 0 
+0000bf60: 776f 756c 6420 7969 656c 6420 610d 0a20  would yield a.. 
+0000bf70: 2020 2020 2020 2072 6573 756c 7420 6f66         result of
+0000bf80: 203c 302e 3520 6f72 203e 302e 3320 6465   <0.5 or >0.3 de
+0000bf90: 7065 6e64 696e 6720 6f6e 2074 6865 2076  pending on the v
+0000bfa0: 616c 7565 206f 6620 666f 6375 735f 6869  alue of focus_hi
+0000bfb0: 6768 6573 745f 706f 7465 6e74 6961 6c2e  ghest_potential.
+0000bfc0: 0d0a 2020 2020 2020 2020 5468 6520 6465  ..        The de
+0000bfd0: 6661 756c 7420 6973 2030 2e32 352e 0d0a  fault is 0.25...
+0000bfe0: 2020 2020 7072 6563 6973 696f 6e5f 726f      precision_ro
+0000bff0: 756e 6469 6e67 203a 2062 6f6f 6c65 616e  unding : boolean
+0000c000: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
+0000c010: 2020 2020 4966 2054 7275 652c 2061 2072      If True, a r
+0000c020: 6f75 6e64 696e 6720 6d65 7468 6f64 2069  ounding method i
+0000c030: 7320 6170 706c 6965 6420 746f 2072 6f75  s applied to rou
+0000c040: 6e64 2072 6573 756c 7473 2074 6f20 6861  nd results to ha
+0000c050: 7665 206e 6f20 6d6f 7265 0d0a 2020 2020  ve no more..    
+0000c060: 2020 2020 6465 6369 6d61 6c73 2074 6861      decimals tha
+0000c070: 6e20 7768 6174 2063 616e 2062 6520 6d65  n what can be me
+0000c080: 6173 7572 6564 2e0d 0a20 2020 2020 2020  asured...       
+0000c090: 2054 6865 2064 6566 6175 6c74 2069 7320   The default is 
+0000c0a0: 5472 7565 2e0d 0a0d 0a20 2020 2052 6574  True.....    Ret
+0000c0b0: 7572 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d  urns..    ------
+0000c0c0: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
+0000c0d0: 4672 616d 650d 0a20 2020 2020 2020 2044  Frame..        D
+0000c0e0: 6174 6146 7261 6d65 2074 6861 7420 636f  ataFrame that co
+0000c0f0: 6e74 6169 6e73 2063 616c 6375 6c61 7465  ntains calculate
+0000c100: 6420 7065 7263 656e 7469 6c65 730d 0a0d  d percentiles...
+0000c110: 0a20 2020 2027 2727 0d0a 2020 2020 0d0a  .    '''..    ..
+0000c120: 2020 2020 2320 4372 6561 7465 2061 2063      # Create a c
+0000c130: 6f70 7920 6f66 2074 6865 2044 6174 6146  opy of the DataF
+0000c140: 7261 6d65 0d0a 2020 2020 6466 203d 2064  rame..    df = d
+0000c150: 662e 636f 7079 2829 0d0a 2020 2020 0d0a  f.copy()..    ..
+0000c160: 2020 2020 2320 4361 6c6c 2070 6572 6365      # Call perce
+0000c170: 6e74 696c 6520 6675 6e63 7469 6f6e 2077  ntile function w
+0000c180: 6974 6820 7065 7263 656e 7469 6c65 203d  ith percentile =
+0000c190: 2035 300d 0a20 2020 2064 6620 3d20 7065   50..    df = pe
+0000c1a0: 7263 656e 7469 6c65 2864 662c 0d0a 2020  rcentile(df,..  
+0000c1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c1c0: 2020 7265 7375 6c74 5f63 6f6c 2c0d 0a20    result_col,.. 
+0000c1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c1e0: 2020 2035 302c 0d0a 2020 2020 2020 2020     50,..        
+0000c1f0: 2020 2020 2020 2020 2020 2020 6772 6f75              grou
+0000c200: 7062 795f 636f 6c75 6d6e 7320 3d20 6772  pby_columns = gr
+0000c210: 6f75 7062 795f 636f 6c75 6d6e 732c 0d0a  oupby_columns,..
+0000c220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c230: 2020 2020 666f 6375 735f 6869 6768 5f70      focus_high_p
+0000c240: 6f74 656e 7469 616c 203d 2066 6f63 7573  otential = focus
+0000c250: 5f68 6967 685f 706f 7465 6e74 6961 6c2c  _high_potential,
+0000c260: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c270: 2020 2020 2020 696e 636c 7564 655f 6e65        include_ne
+0000c280: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
+0000c290: 3d20 696e 636c 7564 655f 6e65 6761 7469  = include_negati
+0000c2a0: 7665 5f69 6e74 6572 7661 6c2c 0d0a 2020  ve_interval,..  
+0000c2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c2c0: 2020 7072 6563 6973 696f 6e5f 746f 6c65    precision_tole
+0000c2d0: 7261 6e63 655f 746f 5f64 726f 705f 6365  rance_to_drop_ce
+0000c2e0: 6e73 6f72 203d 2070 7265 6369 7369 6f6e  nsor = precision
+0000c2f0: 5f74 6f6c 6572 616e 6365 5f74 6f5f 6472  _tolerance_to_dr
+0000c300: 6f70 5f63 656e 736f 722c 0d0a 2020 2020  op_censor,..    
+0000c310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c320: 7072 6563 6973 696f 6e5f 726f 756e 6469  precision_roundi
+0000c330: 6e67 203d 2070 7265 6369 7369 6f6e 5f72  ng = precision_r
+0000c340: 6f75 6e64 696e 6729 0d0a 2020 2020 0d0a  ounding)..    ..
+0000c350: 2020 2020 7265 7475 726e 2064 660d 0a0d      return df...
+0000c360: 0a                                       .
```

### Comparing `censoredsummarystats-1.1.0/censoredsummarystats/utils.py` & `censoredsummarystats-1.1.1/censoredsummarystats/utils.py`

 * *Files identical despite different names*

### Comparing `censoredsummarystats-1.1.0/LICENSE` & `censoredsummarystats-1.1.1/LICENSE`

 * *Files identical despite different names*

### Comparing `censoredsummarystats-1.1.0/pyproject.toml` & `censoredsummarystats-1.1.1/pyproject.toml`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 [tool.poetry]
 name = "censoredsummarystats"
-version = "1.1.0"
+version = "1.1.1"
 description = "A python package for calculating summary stats on censored data (data that contains < and > symbols)."
 authors = ["Kurt van Ness <vanness.kurt@gmail.com>"]
 readme = "README.md"
 repository = "https://github.com/kurtvanness/CensoredSummaryStats"
 license = "Apache-2.0"
 packages = [{include = "censoredsummarystats"}]
```

### Comparing `censoredsummarystats-1.1.0/PKG-INFO` & `censoredsummarystats-1.1.1/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: censoredsummarystats
-Version: 1.1.0
+Version: 1.1.1
 Summary: A python package for calculating summary stats on censored data (data that contains < and > symbols).
 Home-page: https://github.com/kurtvanness/CensoredSummaryStats
 License: Apache-2.0
 Author: Kurt van Ness
 Author-email: vanness.kurt@gmail.com
 Requires-Python: >=3.9,<4.0
 Classifier: License :: OSI Approved :: Apache Software License
```

